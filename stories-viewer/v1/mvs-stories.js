"use strict";var mvsStories=(()=>{var A3e=Object.create;var mD=Object.defineProperty;var T3e=Object.getOwnPropertyDescriptor;var P3e=Object.getOwnPropertyNames;var _3e=Object.getPrototypeOf,R3e=Object.prototype.hasOwnProperty;var Ad=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Bi=(e,t)=>{for(var r in t)mD(e,r,{get:t[r],enumerable:!0})},Oq=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of P3e(t))!R3e.call(e,o)&&o!==r&&mD(e,o,{get:()=>t[o],enumerable:!(n=T3e(t,o))||n.enumerable});return e};var Rt=(e,t,r)=>(r=e!=null?A3e(_3e(e)):{},Oq(t||!e||!e.__esModule?mD(r,"default",{value:e,enumerable:!0}):r,e)),D3e=e=>Oq(mD({},"__esModule",{value:!0}),e);var LY=Ad(ho=>{"use strict";var NT=Symbol.for("react.element"),Y3e=Symbol.for("react.portal"),K3e=Symbol.for("react.fragment"),J3e=Symbol.for("react.strict_mode"),$3e=Symbol.for("react.profiler"),ewe=Symbol.for("react.provider"),twe=Symbol.for("react.context"),rwe=Symbol.for("react.forward_ref"),nwe=Symbol.for("react.suspense"),owe=Symbol.for("react.memo"),iwe=Symbol.for("react.lazy"),AY=Symbol.iterator;function awe(e){return e===null||typeof e!="object"?null:(e=AY&&e[AY]||e["@@iterator"],typeof e=="function"?e:null)}var _Y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},RY=Object.assign,DY={};function u1(e,t,r){this.props=e,this.context=t,this.refs=DY,this.updater=r||_Y}u1.prototype.isReactComponent={};u1.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};u1.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function wY(){}wY.prototype=u1.prototype;function DG(e,t,r){this.props=e,this.context=t,this.refs=DY,this.updater=r||_Y}var wG=DG.prototype=new wY;wG.constructor=DG;RY(wG,u1.prototype);wG.isPureReactComponent=!0;var TY=Array.isArray,EY=Object.prototype.hasOwnProperty,EG={current:null},MY={key:!0,ref:!0,__self:!0,__source:!0};function BY(e,t,r){var n,o={},i=null,a=null;if(t!=null)for(n in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(i=""+t.key),t)EY.call(t,n)&&!MY.hasOwnProperty(n)&&(o[n]=t[n]);var s=arguments.length-2;if(s===1)o.children=r;else if(1<s){for(var l=Array(s),u=0;u<s;u++)l[u]=arguments[u+2];o.children=l}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)o[n]===void 0&&(o[n]=s[n]);return{$$typeof:NT,type:e,key:i,ref:a,props:o,_owner:EG.current}}function swe(e,t){return{$$typeof:NT,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function MG(e){return typeof e=="object"&&e!==null&&e.$$typeof===NT}function lwe(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var PY=/\/+/g;function RG(e,t){return typeof e=="object"&&e!==null&&e.key!=null?lwe(""+e.key):t.toString(36)}function FD(e,t,r,n,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case NT:case Y3e:a=!0}}if(a)return a=e,o=o(a),e=n===""?"."+RG(a,0):n,TY(o)?(r="",e!=null&&(r=e.replace(PY,"$&/")+"/"),FD(o,t,r,"",function(u){return u})):o!=null&&(MG(o)&&(o=swe(o,r+(!o.key||a&&a.key===o.key?"":(""+o.key).replace(PY,"$&/")+"/")+e)),t.push(o)),1;if(a=0,n=n===""?".":n+":",TY(e))for(var s=0;s<e.length;s++){i=e[s];var l=n+RG(i,s);a+=FD(i,t,r,l,o)}else if(l=awe(e),typeof l=="function")for(e=l.call(e),s=0;!(i=e.next()).done;)i=i.value,l=n+RG(i,s++),a+=FD(i,t,r,l,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function LD(e,t,r){if(e==null)return e;var n=[],o=0;return FD(e,n,"","",function(i){return t.call(r,i,o++)}),n}function uwe(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ac={current:null},VD={transition:null},cwe={ReactCurrentDispatcher:ac,ReactCurrentBatchConfig:VD,ReactCurrentOwner:EG};function kY(){throw Error("act(...) is not supported in production builds of React.")}ho.Children={map:LD,forEach:function(e,t,r){LD(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return LD(e,function(){t++}),t},toArray:function(e){return LD(e,function(t){return t})||[]},only:function(e){if(!MG(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ho.Component=u1;ho.Fragment=K3e;ho.Profiler=$3e;ho.PureComponent=DG;ho.StrictMode=J3e;ho.Suspense=nwe;ho.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cwe;ho.act=kY;ho.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=RY({},e.props),o=e.key,i=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,a=EG.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(l in t)EY.call(t,l)&&!MY.hasOwnProperty(l)&&(n[l]=t[l]===void 0&&s!==void 0?s[l]:t[l])}var l=arguments.length-2;if(l===1)n.children=r;else if(1<l){s=Array(l);for(var u=0;u<l;u++)s[u]=arguments[u+2];n.children=s}return{$$typeof:NT,type:e.type,key:o,ref:i,props:n,_owner:a}};ho.createContext=function(e){return e={$$typeof:twe,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:ewe,_context:e},e.Consumer=e};ho.createElement=BY;ho.createFactory=function(e){var t=BY.bind(null,e);return t.type=e,t};ho.createRef=function(){return{current:null}};ho.forwardRef=function(e){return{$$typeof:rwe,render:e}};ho.isValidElement=MG;ho.lazy=function(e){return{$$typeof:iwe,_payload:{_status:-1,_result:e},_init:uwe}};ho.memo=function(e,t){return{$$typeof:owe,type:e,compare:t===void 0?null:t}};ho.startTransition=function(e){var t=VD.transition;VD.transition={};try{e()}finally{VD.transition=t}};ho.unstable_act=kY;ho.useCallback=function(e,t){return ac.current.useCallback(e,t)};ho.useContext=function(e){return ac.current.useContext(e)};ho.useDebugValue=function(){};ho.useDeferredValue=function(e){return ac.current.useDeferredValue(e)};ho.useEffect=function(e,t){return ac.current.useEffect(e,t)};ho.useId=function(){return ac.current.useId()};ho.useImperativeHandle=function(e,t,r){return ac.current.useImperativeHandle(e,t,r)};ho.useInsertionEffect=function(e,t){return ac.current.useInsertionEffect(e,t)};ho.useLayoutEffect=function(e,t){return ac.current.useLayoutEffect(e,t)};ho.useMemo=function(e,t){return ac.current.useMemo(e,t)};ho.useReducer=function(e,t,r){return ac.current.useReducer(e,t,r)};ho.useRef=function(e){return ac.current.useRef(e)};ho.useState=function(e){return ac.current.useState(e)};ho.useSyncExternalStore=function(e,t,r){return ac.current.useSyncExternalStore(e,t,r)};ho.useTransition=function(){return ac.current.useTransition()};ho.version="18.3.1"});var Pi=Ad((cSt,FY)=>{"use strict";FY.exports=LY()});var XY=Ad(Hi=>{"use strict";function FG(e,t){var r=e.length;e.push(t);e:for(;0<r;){var n=r-1>>>1,o=e[n];if(0<OD(o,t))e[n]=t,e[r]=o,r=n;else break e}}function Gp(e){return e.length===0?null:e[0]}function UD(e){if(e.length===0)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;e:for(var n=0,o=e.length,i=o>>>1;n<i;){var a=2*(n+1)-1,s=e[a],l=a+1,u=e[l];if(0>OD(s,r))l<o&&0>OD(u,s)?(e[n]=u,e[l]=r,n=l):(e[n]=s,e[a]=r,n=a);else if(l<o&&0>OD(u,r))e[n]=u,e[l]=r,n=l;else break e}}return t}function OD(e,t){var r=e.sortIndex-t.sortIndex;return r!==0?r:e.id-t.id}typeof performance=="object"&&typeof performance.now=="function"?(VY=performance,Hi.unstable_now=function(){return VY.now()}):(BG=Date,OY=BG.now(),Hi.unstable_now=function(){return BG.now()-OY});var VY,BG,OY,Hf=[],sb=[],fwe=1,_d=null,Iu=3,ND=!1,LC=!1,HT=!1,NY=typeof setTimeout=="function"?setTimeout:null,zY=typeof clearTimeout=="function"?clearTimeout:null,GY=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function VG(e){for(var t=Gp(sb);t!==null;){if(t.callback===null)UD(sb);else if(t.startTime<=e)UD(sb),t.sortIndex=t.expirationTime,FG(Hf,t);else break;t=Gp(sb)}}function OG(e){if(HT=!1,VG(e),!LC)if(Gp(Hf)!==null)LC=!0,UG(GG);else{var t=Gp(sb);t!==null&&NG(OG,t.startTime-e)}}function GG(e,t){LC=!1,HT&&(HT=!1,zY(jT),jT=-1),ND=!0;var r=Iu;try{for(VG(t),_d=Gp(Hf);_d!==null&&(!(_d.expirationTime>t)||e&&!WY());){var n=_d.callback;if(typeof n=="function"){_d.callback=null,Iu=_d.priorityLevel;var o=n(_d.expirationTime<=t);t=Hi.unstable_now(),typeof o=="function"?_d.callback=o:_d===Gp(Hf)&&UD(Hf),VG(t)}else UD(Hf);_d=Gp(Hf)}if(_d!==null)var i=!0;else{var a=Gp(sb);a!==null&&NG(OG,a.startTime-t),i=!1}return i}finally{_d=null,Iu=r,ND=!1}}var zD=!1,GD=null,jT=-1,HY=5,jY=-1;function WY(){return!(Hi.unstable_now()-jY<HY)}function kG(){if(GD!==null){var e=Hi.unstable_now();jY=e;var t=!0;try{t=GD(!0,e)}finally{t?zT():(zD=!1,GD=null)}}else zD=!1}var zT;typeof GY=="function"?zT=function(){GY(kG)}:typeof MessageChannel<"u"?(LG=new MessageChannel,UY=LG.port2,LG.port1.onmessage=kG,zT=function(){UY.postMessage(null)}):zT=function(){NY(kG,0)};var LG,UY;function UG(e){GD=e,zD||(zD=!0,zT())}function NG(e,t){jT=NY(function(){e(Hi.unstable_now())},t)}Hi.unstable_IdlePriority=5;Hi.unstable_ImmediatePriority=1;Hi.unstable_LowPriority=4;Hi.unstable_NormalPriority=3;Hi.unstable_Profiling=null;Hi.unstable_UserBlockingPriority=2;Hi.unstable_cancelCallback=function(e){e.callback=null};Hi.unstable_continueExecution=function(){LC||ND||(LC=!0,UG(GG))};Hi.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):HY=0<e?Math.floor(1e3/e):5};Hi.unstable_getCurrentPriorityLevel=function(){return Iu};Hi.unstable_getFirstCallbackNode=function(){return Gp(Hf)};Hi.unstable_next=function(e){switch(Iu){case 1:case 2:case 3:var t=3;break;default:t=Iu}var r=Iu;Iu=t;try{return e()}finally{Iu=r}};Hi.unstable_pauseExecution=function(){};Hi.unstable_requestPaint=function(){};Hi.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=Iu;Iu=e;try{return t()}finally{Iu=r}};Hi.unstable_scheduleCallback=function(e,t,r){var n=Hi.unstable_now();switch(typeof r=="object"&&r!==null?(r=r.delay,r=typeof r=="number"&&0<r?n+r:n):r=n,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return o=r+o,e={id:fwe++,callback:t,priorityLevel:e,startTime:r,expirationTime:o,sortIndex:-1},r>n?(e.sortIndex=r,FG(sb,e),Gp(Hf)===null&&e===Gp(sb)&&(HT?(zY(jT),jT=-1):HT=!0,NG(OG,r-n))):(e.sortIndex=o,FG(Hf,e),LC||ND||(LC=!0,UG(GG))),e};Hi.unstable_shouldYield=WY;Hi.unstable_wrapCallback=function(e){var t=Iu;return function(){var r=Iu;Iu=t;try{return e.apply(this,arguments)}finally{Iu=r}}}});var ZY=Ad((fSt,QY)=>{"use strict";QY.exports=XY()});var J$=Ad(km=>{"use strict";var hwe=Pi(),Mm=ZY();function Yt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var tJ=new Set,dP={};function ZC(e,t){w1(e,t),w1(e+"Capture",t)}function w1(e,t){for(dP[e]=t,e=0;e<t.length;e++)tJ.add(t[e])}var kg=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),c4=Object.prototype.hasOwnProperty,gwe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qY={},YY={};function ywe(e){return c4.call(YY,e)?!0:c4.call(qY,e)?!1:gwe.test(e)?YY[e]=!0:(qY[e]=!0,!1)}function bwe(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function xwe(e,t,r,n){if(t===null||typeof t>"u"||bwe(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function uc(e,t,r,n,o,i,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=o,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var ou={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ou[e]=new uc(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ou[t]=new uc(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ou[e]=new uc(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ou[e]=new uc(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ou[e]=new uc(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ou[e]=new uc(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ou[e]=new uc(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ou[e]=new uc(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ou[e]=new uc(e,5,!1,e.toLowerCase(),null,!1,!1)});var rU=/[\-:]([a-z])/g;function nU(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(rU,nU);ou[t]=new uc(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(rU,nU);ou[t]=new uc(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(rU,nU);ou[t]=new uc(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ou[e]=new uc(e,1,!1,e.toLowerCase(),null,!1,!1)});ou.xlinkHref=new uc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ou[e]=new uc(e,1,!1,e.toLowerCase(),null,!0,!0)});function oU(e,t,r,n){var o=ou.hasOwnProperty(t)?ou[t]:null;(o!==null?o.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(xwe(t,r,o,n)&&(r=null),n||o===null?ywe(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):o.mustUseProperty?e[o.propertyName]=r===null?o.type===3?!1:"":r:(t=o.attributeName,n=o.attributeNamespace,r===null?e.removeAttribute(t):(o=o.type,r=o===3||o===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Og=hwe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,HD=Symbol.for("react.element"),d1=Symbol.for("react.portal"),p1=Symbol.for("react.fragment"),iU=Symbol.for("react.strict_mode"),m4=Symbol.for("react.profiler"),rJ=Symbol.for("react.provider"),nJ=Symbol.for("react.context"),aU=Symbol.for("react.forward_ref"),d4=Symbol.for("react.suspense"),p4=Symbol.for("react.suspense_list"),sU=Symbol.for("react.memo"),ub=Symbol.for("react.lazy");Symbol.for("react.scope");Symbol.for("react.debug_trace_mode");var oJ=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden");Symbol.for("react.cache");Symbol.for("react.tracing_marker");var KY=Symbol.iterator;function WT(e){return e===null||typeof e!="object"?null:(e=KY&&e[KY]||e["@@iterator"],typeof e=="function"?e:null)}var wa=Object.assign,zG;function $T(e){if(zG===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);zG=t&&t[1]||""}return`
`+zG+e}var HG=!1;function jG(e,t){if(!e||HG)return"";HG=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var n=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){n=u}e.call(t.prototype)}else{try{throw Error()}catch(u){n=u}e()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var o=u.stack.split(`
`),i=n.stack.split(`
`),a=o.length-1,s=i.length-1;1<=a&&0<=s&&o[a]!==i[s];)s--;for(;1<=a&&0<=s;a--,s--)if(o[a]!==i[s]){if(a!==1||s!==1)do if(a--,s--,0>s||o[a]!==i[s]){var l=`
`+o[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=a&&0<=s);break}}}finally{HG=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?$T(e):""}function Cwe(e){switch(e.tag){case 5:return $T(e.type);case 16:return $T("Lazy");case 13:return $T("Suspense");case 19:return $T("SuspenseList");case 0:case 2:case 15:return e=jG(e.type,!1),e;case 11:return e=jG(e.type.render,!1),e;case 1:return e=jG(e.type,!0),e;default:return""}}function f4(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case p1:return"Fragment";case d1:return"Portal";case m4:return"Profiler";case iU:return"StrictMode";case d4:return"Suspense";case p4:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case nJ:return(e.displayName||"Context")+".Consumer";case rJ:return(e._context.displayName||"Context")+".Provider";case aU:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case sU:return t=e.displayName||null,t!==null?t:f4(e.type)||"Memo";case ub:t=e._payload,e=e._init;try{return f4(e(t))}catch{}}return null}function Swe(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return f4(t);case 8:return t===iU?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Ib(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function iJ(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function vwe(e){var t=iJ(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var o=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(a){n=""+a,i.call(this,a)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function jD(e){e._valueTracker||(e._valueTracker=vwe(e))}function aJ(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=iJ(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function b3(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function h4(e,t){var r=t.checked;return wa({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function JY(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=Ib(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function sJ(e,t){t=t.checked,t!=null&&oU(e,"checked",t,!1)}function g4(e,t){sJ(e,t);var r=Ib(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?y4(e,t.type,r):t.hasOwnProperty("defaultValue")&&y4(e,t.type,Ib(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function $Y(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function y4(e,t,r){(t!=="number"||b3(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var eP=Array.isArray;function A1(e,t,r,n){if(e=e.options,t){t={};for(var o=0;o<r.length;o++)t["$"+r[o]]=!0;for(r=0;r<e.length;r++)o=t.hasOwnProperty("$"+e[r].value),e[r].selected!==o&&(e[r].selected=o),o&&n&&(e[r].defaultSelected=!0)}else{for(r=""+Ib(r),t=null,o=0;o<e.length;o++){if(e[o].value===r){e[o].selected=!0,n&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function b4(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Yt(91));return wa({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function eK(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Yt(92));if(eP(r)){if(1<r.length)throw Error(Yt(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Ib(r)}}function lJ(e,t){var r=Ib(t.value),n=Ib(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function tK(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function uJ(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function x4(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?uJ(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var WD,cJ=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,o){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(WD=WD||document.createElement("div"),WD.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=WD.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function pP(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var nP={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Iwe=["Webkit","ms","Moz","O"];Object.keys(nP).forEach(function(e){Iwe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),nP[t]=nP[e]})});function mJ(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||nP.hasOwnProperty(e)&&nP[e]?(""+t).trim():t+"px"}function dJ(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,o=mJ(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,o):e[r]=o}}var Awe=wa({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function C4(e,t){if(t){if(Awe[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Yt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Yt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Yt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Yt(62))}}function S4(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var v4=null;function lU(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var I4=null,T1=null,P1=null;function rK(e){if(e=EP(e)){if(typeof I4!="function")throw Error(Yt(280));var t=e.stateNode;t&&(t=X3(t),I4(e.stateNode,e.type,t))}}function pJ(e){T1?P1?P1.push(e):P1=[e]:T1=e}function fJ(){if(T1){var e=T1,t=P1;if(P1=T1=null,rK(e),t)for(e=0;e<t.length;e++)rK(t[e])}}function hJ(e,t){return e(t)}function gJ(){}var WG=!1;function yJ(e,t,r){if(WG)return e(t,r);WG=!0;try{return hJ(e,t,r)}finally{WG=!1,(T1!==null||P1!==null)&&(gJ(),fJ())}}function fP(e,t){var r=e.stateNode;if(r===null)return null;var n=X3(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Yt(231,t,typeof r));return r}var A4=!1;if(kg)try{c1={},Object.defineProperty(c1,"passive",{get:function(){A4=!0}}),window.addEventListener("test",c1,c1),window.removeEventListener("test",c1,c1)}catch{A4=!1}var c1;function Twe(e,t,r,n,o,i,a,s,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(r,u)}catch(c){this.onError(c)}}var oP=!1,x3=null,C3=!1,T4=null,Pwe={onError:function(e){oP=!0,x3=e}};function _we(e,t,r,n,o,i,a,s,l){oP=!1,x3=null,Twe.apply(Pwe,arguments)}function Rwe(e,t,r,n,o,i,a,s,l){if(_we.apply(this,arguments),oP){if(oP){var u=x3;oP=!1,x3=null}else throw Error(Yt(198));C3||(C3=!0,T4=u)}}function qC(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function bJ(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function nK(e){if(qC(e)!==e)throw Error(Yt(188))}function Dwe(e){var t=e.alternate;if(!t){if(t=qC(e),t===null)throw Error(Yt(188));return t!==e?null:e}for(var r=e,n=t;;){var o=r.return;if(o===null)break;var i=o.alternate;if(i===null){if(n=o.return,n!==null){r=n;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===r)return nK(o),e;if(i===n)return nK(o),t;i=i.sibling}throw Error(Yt(188))}if(r.return!==n.return)r=o,n=i;else{for(var a=!1,s=o.child;s;){if(s===r){a=!0,r=o,n=i;break}if(s===n){a=!0,n=o,r=i;break}s=s.sibling}if(!a){for(s=i.child;s;){if(s===r){a=!0,r=i,n=o;break}if(s===n){a=!0,n=i,r=o;break}s=s.sibling}if(!a)throw Error(Yt(189))}}if(r.alternate!==n)throw Error(Yt(190))}if(r.tag!==3)throw Error(Yt(188));return r.stateNode.current===r?e:t}function xJ(e){return e=Dwe(e),e!==null?CJ(e):null}function CJ(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=CJ(e);if(t!==null)return t;e=e.sibling}return null}var SJ=Mm.unstable_scheduleCallback,oK=Mm.unstable_cancelCallback,wwe=Mm.unstable_shouldYield,Ewe=Mm.unstable_requestPaint,xs=Mm.unstable_now,Mwe=Mm.unstable_getCurrentPriorityLevel,uU=Mm.unstable_ImmediatePriority,vJ=Mm.unstable_UserBlockingPriority,S3=Mm.unstable_NormalPriority,Bwe=Mm.unstable_LowPriority,IJ=Mm.unstable_IdlePriority,z3=null,Qf=null;function kwe(e){if(Qf&&typeof Qf.onCommitFiberRoot=="function")try{Qf.onCommitFiberRoot(z3,e,void 0,(e.current.flags&128)===128)}catch{}}var jp=Math.clz32?Math.clz32:Vwe,Lwe=Math.log,Fwe=Math.LN2;function Vwe(e){return e>>>=0,e===0?32:31-(Lwe(e)/Fwe|0)|0}var XD=64,QD=4194304;function tP(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function v3(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,o=e.suspendedLanes,i=e.pingedLanes,a=r&268435455;if(a!==0){var s=a&~o;s!==0?n=tP(s):(i&=a,i!==0&&(n=tP(i)))}else a=r&~o,a!==0?n=tP(a):i!==0&&(n=tP(i));if(n===0)return 0;if(t!==0&&t!==n&&(t&o)===0&&(o=n&-n,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if((n&4)!==0&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-jp(t),o=1<<r,n|=e[r],t&=~o;return n}function Owe(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Gwe(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-jp(i),s=1<<a,l=o[a];l===-1?((s&r)===0||(s&n)!==0)&&(o[a]=Owe(s,t)):l<=t&&(e.expiredLanes|=s),i&=~s}}function P4(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function AJ(){var e=XD;return XD<<=1,(XD&4194240)===0&&(XD=64),e}function XG(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function DP(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-jp(t),e[t]=r}function Uwe(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var o=31-jp(r),i=1<<o;t[o]=0,n[o]=-1,e[o]=-1,r&=~i}}function cU(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-jp(r),o=1<<n;o&t|e[n]&t&&(e[n]|=t),r&=~o}}var yi=0;function TJ(e){return e&=-e,1<e?4<e?(e&268435455)!==0?16:536870912:4:1}var PJ,mU,_J,RJ,DJ,_4=!1,ZD=[],hb=null,gb=null,yb=null,hP=new Map,gP=new Map,mb=[],Nwe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function iK(e,t){switch(e){case"focusin":case"focusout":hb=null;break;case"dragenter":case"dragleave":gb=null;break;case"mouseover":case"mouseout":yb=null;break;case"pointerover":case"pointerout":hP.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":gP.delete(t.pointerId)}}function XT(e,t,r,n,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:i,targetContainers:[o]},t!==null&&(t=EP(t),t!==null&&mU(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function zwe(e,t,r,n,o){switch(t){case"focusin":return hb=XT(hb,e,t,r,n,o),!0;case"dragenter":return gb=XT(gb,e,t,r,n,o),!0;case"mouseover":return yb=XT(yb,e,t,r,n,o),!0;case"pointerover":var i=o.pointerId;return hP.set(i,XT(hP.get(i)||null,e,t,r,n,o)),!0;case"gotpointercapture":return i=o.pointerId,gP.set(i,XT(gP.get(i)||null,e,t,r,n,o)),!0}return!1}function wJ(e){var t=OC(e.target);if(t!==null){var r=qC(t);if(r!==null){if(t=r.tag,t===13){if(t=bJ(r),t!==null){e.blockedOn=t,DJ(e.priority,function(){_J(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function l3(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=R4(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);v4=n,r.target.dispatchEvent(n),v4=null}else return t=EP(r),t!==null&&mU(t),e.blockedOn=r,!1;t.shift()}return!0}function aK(e,t,r){l3(e)&&r.delete(t)}function Hwe(){_4=!1,hb!==null&&l3(hb)&&(hb=null),gb!==null&&l3(gb)&&(gb=null),yb!==null&&l3(yb)&&(yb=null),hP.forEach(aK),gP.forEach(aK)}function QT(e,t){e.blockedOn===t&&(e.blockedOn=null,_4||(_4=!0,Mm.unstable_scheduleCallback(Mm.unstable_NormalPriority,Hwe)))}function yP(e){function t(o){return QT(o,e)}if(0<ZD.length){QT(ZD[0],e);for(var r=1;r<ZD.length;r++){var n=ZD[r];n.blockedOn===e&&(n.blockedOn=null)}}for(hb!==null&&QT(hb,e),gb!==null&&QT(gb,e),yb!==null&&QT(yb,e),hP.forEach(t),gP.forEach(t),r=0;r<mb.length;r++)n=mb[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<mb.length&&(r=mb[0],r.blockedOn===null);)wJ(r),r.blockedOn===null&&mb.shift()}var _1=Og.ReactCurrentBatchConfig,I3=!0;function jwe(e,t,r,n){var o=yi,i=_1.transition;_1.transition=null;try{yi=1,dU(e,t,r,n)}finally{yi=o,_1.transition=i}}function Wwe(e,t,r,n){var o=yi,i=_1.transition;_1.transition=null;try{yi=4,dU(e,t,r,n)}finally{yi=o,_1.transition=i}}function dU(e,t,r,n){if(I3){var o=R4(e,t,r,n);if(o===null)$G(e,t,n,A3,r),iK(e,n);else if(zwe(o,e,t,r,n))n.stopPropagation();else if(iK(e,n),t&4&&-1<Nwe.indexOf(e)){for(;o!==null;){var i=EP(o);if(i!==null&&PJ(i),i=R4(e,t,r,n),i===null&&$G(e,t,n,A3,r),i===o)break;o=i}o!==null&&n.stopPropagation()}else $G(e,t,n,null,r)}}var A3=null;function R4(e,t,r,n){if(A3=null,e=lU(n),e=OC(e),e!==null)if(t=qC(e),t===null)e=null;else if(r=t.tag,r===13){if(e=bJ(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return A3=e,null}function EJ(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Mwe()){case uU:return 1;case vJ:return 4;case S3:case Bwe:return 16;case IJ:return 536870912;default:return 16}default:return 16}}var pb=null,pU=null,u3=null;function MJ(){if(u3)return u3;var e,t=pU,r=t.length,n,o="value"in pb?pb.value:pb.textContent,i=o.length;for(e=0;e<r&&t[e]===o[e];e++);var a=r-e;for(n=1;n<=a&&t[r-n]===o[i-n];n++);return u3=o.slice(e,1<n?1-n:void 0)}function c3(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function qD(){return!0}function sK(){return!1}function Bm(e){function t(r,n,o,i,a){this._reactName=r,this._targetInst=o,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(i):i[s]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?qD:sK,this.isPropagationStopped=sK,this}return wa(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=qD)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=qD)},persist:function(){},isPersistent:qD}),t}var V1={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fU=Bm(V1),wP=wa({},V1,{view:0,detail:0}),Xwe=Bm(wP),QG,ZG,ZT,H3=wa({},wP,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hU,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ZT&&(ZT&&e.type==="mousemove"?(QG=e.screenX-ZT.screenX,ZG=e.screenY-ZT.screenY):ZG=QG=0,ZT=e),QG)},movementY:function(e){return"movementY"in e?e.movementY:ZG}}),lK=Bm(H3),Qwe=wa({},H3,{dataTransfer:0}),Zwe=Bm(Qwe),qwe=wa({},wP,{relatedTarget:0}),qG=Bm(qwe),Ywe=wa({},V1,{animationName:0,elapsedTime:0,pseudoElement:0}),Kwe=Bm(Ywe),Jwe=wa({},V1,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),$we=Bm(Jwe),eEe=wa({},V1,{data:0}),uK=Bm(eEe),tEe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rEe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nEe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function oEe(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=nEe[e])?!!t[e]:!1}function hU(){return oEe}var iEe=wa({},wP,{key:function(e){if(e.key){var t=tEe[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=c3(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?rEe[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hU,charCode:function(e){return e.type==="keypress"?c3(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?c3(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),aEe=Bm(iEe),sEe=wa({},H3,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cK=Bm(sEe),lEe=wa({},wP,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hU}),uEe=Bm(lEe),cEe=wa({},V1,{propertyName:0,elapsedTime:0,pseudoElement:0}),mEe=Bm(cEe),dEe=wa({},H3,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),pEe=Bm(dEe),fEe=[9,13,27,32],gU=kg&&"CompositionEvent"in window,iP=null;kg&&"documentMode"in document&&(iP=document.documentMode);var hEe=kg&&"TextEvent"in window&&!iP,BJ=kg&&(!gU||iP&&8<iP&&11>=iP),mK=" ",dK=!1;function kJ(e,t){switch(e){case"keyup":return fEe.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function LJ(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var f1=!1;function gEe(e,t){switch(e){case"compositionend":return LJ(t);case"keypress":return t.which!==32?null:(dK=!0,mK);case"textInput":return e=t.data,e===mK&&dK?null:e;default:return null}}function yEe(e,t){if(f1)return e==="compositionend"||!gU&&kJ(e,t)?(e=MJ(),u3=pU=pb=null,f1=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return BJ&&t.locale!=="ko"?null:t.data;default:return null}}var bEe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pK(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!bEe[e.type]:t==="textarea"}function FJ(e,t,r,n){pJ(n),t=T3(t,"onChange"),0<t.length&&(r=new fU("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var aP=null,bP=null;function xEe(e){QJ(e,0)}function j3(e){var t=y1(e);if(aJ(t))return e}function CEe(e,t){if(e==="change")return t}var VJ=!1;kg&&(kg?(KD="oninput"in document,KD||(YG=document.createElement("div"),YG.setAttribute("oninput","return;"),KD=typeof YG.oninput=="function"),YD=KD):YD=!1,VJ=YD&&(!document.documentMode||9<document.documentMode));var YD,KD,YG;function fK(){aP&&(aP.detachEvent("onpropertychange",OJ),bP=aP=null)}function OJ(e){if(e.propertyName==="value"&&j3(bP)){var t=[];FJ(t,bP,e,lU(e)),yJ(xEe,t)}}function SEe(e,t,r){e==="focusin"?(fK(),aP=t,bP=r,aP.attachEvent("onpropertychange",OJ)):e==="focusout"&&fK()}function vEe(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return j3(bP)}function IEe(e,t){if(e==="click")return j3(t)}function AEe(e,t){if(e==="input"||e==="change")return j3(t)}function TEe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Xp=typeof Object.is=="function"?Object.is:TEe;function xP(e,t){if(Xp(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var o=r[n];if(!c4.call(t,o)||!Xp(e[o],t[o]))return!1}return!0}function hK(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function gK(e,t){var r=hK(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=hK(r)}}function GJ(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?GJ(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function UJ(){for(var e=window,t=b3();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=b3(e.document)}return t}function yU(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function PEe(e){var t=UJ(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&GJ(r.ownerDocument.documentElement,r)){if(n!==null&&yU(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=r.textContent.length,i=Math.min(n.start,o);n=n.end===void 0?i:Math.min(n.end,o),!e.extend&&i>n&&(o=n,n=i,i=o),o=gK(r,i);var a=gK(r,n);o&&a&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>n?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var _Ee=kg&&"documentMode"in document&&11>=document.documentMode,h1=null,D4=null,sP=null,w4=!1;function yK(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;w4||h1==null||h1!==b3(n)||(n=h1,"selectionStart"in n&&yU(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),sP&&xP(sP,n)||(sP=n,n=T3(D4,"onSelect"),0<n.length&&(t=new fU("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=h1)))}function JD(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var g1={animationend:JD("Animation","AnimationEnd"),animationiteration:JD("Animation","AnimationIteration"),animationstart:JD("Animation","AnimationStart"),transitionend:JD("Transition","TransitionEnd")},KG={},NJ={};kg&&(NJ=document.createElement("div").style,"AnimationEvent"in window||(delete g1.animationend.animation,delete g1.animationiteration.animation,delete g1.animationstart.animation),"TransitionEvent"in window||delete g1.transitionend.transition);function W3(e){if(KG[e])return KG[e];if(!g1[e])return e;var t=g1[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in NJ)return KG[e]=t[r];return e}var zJ=W3("animationend"),HJ=W3("animationiteration"),jJ=W3("animationstart"),WJ=W3("transitionend"),XJ=new Map,bK="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Tb(e,t){XJ.set(e,t),ZC(t,[e])}for($D=0;$D<bK.length;$D++)e3=bK[$D],xK=e3.toLowerCase(),CK=e3[0].toUpperCase()+e3.slice(1),Tb(xK,"on"+CK);var e3,xK,CK,$D;Tb(zJ,"onAnimationEnd");Tb(HJ,"onAnimationIteration");Tb(jJ,"onAnimationStart");Tb("dblclick","onDoubleClick");Tb("focusin","onFocus");Tb("focusout","onBlur");Tb(WJ,"onTransitionEnd");w1("onMouseEnter",["mouseout","mouseover"]);w1("onMouseLeave",["mouseout","mouseover"]);w1("onPointerEnter",["pointerout","pointerover"]);w1("onPointerLeave",["pointerout","pointerover"]);ZC("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ZC("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ZC("onBeforeInput",["compositionend","keypress","textInput","paste"]);ZC("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ZC("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ZC("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var rP="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),REe=new Set("cancel close invalid load scroll toggle".split(" ").concat(rP));function SK(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,Rwe(n,t,void 0,e),e.currentTarget=null}function QJ(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],o=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var a=n.length-1;0<=a;a--){var s=n[a],l=s.instance,u=s.currentTarget;if(s=s.listener,l!==i&&o.isPropagationStopped())break e;SK(o,s,u),i=l}else for(a=0;a<n.length;a++){if(s=n[a],l=s.instance,u=s.currentTarget,s=s.listener,l!==i&&o.isPropagationStopped())break e;SK(o,s,u),i=l}}}if(C3)throw e=T4,C3=!1,T4=null,e}function $i(e,t){var r=t[L4];r===void 0&&(r=t[L4]=new Set);var n=e+"__bubble";r.has(n)||(ZJ(t,e,2,!1),r.add(n))}function JG(e,t,r){var n=0;t&&(n|=4),ZJ(r,e,n,t)}var t3="_reactListening"+Math.random().toString(36).slice(2);function CP(e){if(!e[t3]){e[t3]=!0,tJ.forEach(function(r){r!=="selectionchange"&&(REe.has(r)||JG(r,!1,e),JG(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[t3]||(t[t3]=!0,JG("selectionchange",!1,t))}}function ZJ(e,t,r,n){switch(EJ(t)){case 1:var o=jwe;break;case 4:o=Wwe;break;default:o=dU}r=o.bind(null,t,r,e),o=void 0,!A4||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),n?o!==void 0?e.addEventListener(t,r,{capture:!0,passive:o}):e.addEventListener(t,r,!0):o!==void 0?e.addEventListener(t,r,{passive:o}):e.addEventListener(t,r,!1)}function $G(e,t,r,n,o){var i=n;if((t&1)===0&&(t&2)===0&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var s=n.stateNode.containerInfo;if(s===o||s.nodeType===8&&s.parentNode===o)break;if(a===4)for(a=n.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===o||l.nodeType===8&&l.parentNode===o))return;a=a.return}for(;s!==null;){if(a=OC(s),a===null)return;if(l=a.tag,l===5||l===6){n=i=a;continue e}s=s.parentNode}}n=n.return}yJ(function(){var u=i,c=lU(r),m=[];e:{var d=XJ.get(e);if(d!==void 0){var p=fU,h=e;switch(e){case"keypress":if(c3(r)===0)break e;case"keydown":case"keyup":p=aEe;break;case"focusin":h="focus",p=qG;break;case"focusout":h="blur",p=qG;break;case"beforeblur":case"afterblur":p=qG;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=lK;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Zwe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=uEe;break;case zJ:case HJ:case jJ:p=Kwe;break;case WJ:p=mEe;break;case"scroll":p=Xwe;break;case"wheel":p=pEe;break;case"copy":case"cut":case"paste":p=$we;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=cK}var f=(t&4)!==0,y=!f&&e==="scroll",g=f?d!==null?d+"Capture":null:d;f=[];for(var x=u,S;x!==null;){S=x;var I=S.stateNode;if(S.tag===5&&I!==null&&(S=I,g!==null&&(I=fP(x,g),I!=null&&f.push(SP(x,I,S)))),y)break;x=x.return}0<f.length&&(d=new p(d,h,null,r,c),m.push({event:d,listeners:f}))}}if((t&7)===0){e:{if(d=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",d&&r!==v4&&(h=r.relatedTarget||r.fromElement)&&(OC(h)||h[Lg]))break e;if((p||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,p?(h=r.relatedTarget||r.toElement,p=u,h=h?OC(h):null,h!==null&&(y=qC(h),h!==y||h.tag!==5&&h.tag!==6)&&(h=null)):(p=null,h=u),p!==h)){if(f=lK,I="onMouseLeave",g="onMouseEnter",x="mouse",(e==="pointerout"||e==="pointerover")&&(f=cK,I="onPointerLeave",g="onPointerEnter",x="pointer"),y=p==null?d:y1(p),S=h==null?d:y1(h),d=new f(I,x+"leave",p,r,c),d.target=y,d.relatedTarget=S,I=null,OC(c)===u&&(f=new f(g,x+"enter",h,r,c),f.target=S,f.relatedTarget=y,I=f),y=I,p&&h)t:{for(f=p,g=h,x=0,S=f;S;S=m1(S))x++;for(S=0,I=g;I;I=m1(I))S++;for(;0<x-S;)f=m1(f),x--;for(;0<S-x;)g=m1(g),S--;for(;x--;){if(f===g||g!==null&&f===g.alternate)break t;f=m1(f),g=m1(g)}f=null}else f=null;p!==null&&vK(m,d,p,f,!1),h!==null&&y!==null&&vK(m,y,h,f,!0)}}e:{if(d=u?y1(u):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var v=CEe;else if(pK(d))if(VJ)v=AEe;else{v=vEe;var A=SEe}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(v=IEe);if(v&&(v=v(e,u))){FJ(m,v,r,c);break e}A&&A(e,d,u),e==="focusout"&&(A=d._wrapperState)&&A.controlled&&d.type==="number"&&y4(d,"number",d.value)}switch(A=u?y1(u):window,e){case"focusin":(pK(A)||A.contentEditable==="true")&&(h1=A,D4=u,sP=null);break;case"focusout":sP=D4=h1=null;break;case"mousedown":w4=!0;break;case"contextmenu":case"mouseup":case"dragend":w4=!1,yK(m,r,c);break;case"selectionchange":if(_Ee)break;case"keydown":case"keyup":yK(m,r,c)}var _;if(gU)e:{switch(e){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else f1?kJ(e,r)&&(T="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(T="onCompositionStart");T&&(BJ&&r.locale!=="ko"&&(f1||T!=="onCompositionStart"?T==="onCompositionEnd"&&f1&&(_=MJ()):(pb=c,pU="value"in pb?pb.value:pb.textContent,f1=!0)),A=T3(u,T),0<A.length&&(T=new uK(T,e,null,r,c),m.push({event:T,listeners:A}),_?T.data=_:(_=LJ(r),_!==null&&(T.data=_)))),(_=hEe?gEe(e,r):yEe(e,r))&&(u=T3(u,"onBeforeInput"),0<u.length&&(c=new uK("onBeforeInput","beforeinput",null,r,c),m.push({event:c,listeners:u}),c.data=_))}QJ(m,t)})}function SP(e,t,r){return{instance:e,listener:t,currentTarget:r}}function T3(e,t){for(var r=t+"Capture",n=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=fP(e,r),i!=null&&n.unshift(SP(e,i,o)),i=fP(e,t),i!=null&&n.push(SP(e,i,o))),e=e.return}return n}function m1(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function vK(e,t,r,n,o){for(var i=t._reactName,a=[];r!==null&&r!==n;){var s=r,l=s.alternate,u=s.stateNode;if(l!==null&&l===n)break;s.tag===5&&u!==null&&(s=u,o?(l=fP(r,i),l!=null&&a.unshift(SP(r,l,s))):o||(l=fP(r,i),l!=null&&a.push(SP(r,l,s)))),r=r.return}a.length!==0&&e.push({event:t,listeners:a})}var DEe=/\r\n?/g,wEe=/\u0000|\uFFFD/g;function IK(e){return(typeof e=="string"?e:""+e).replace(DEe,`
`).replace(wEe,"")}function r3(e,t,r){if(t=IK(t),IK(e)!==t&&r)throw Error(Yt(425))}function P3(){}var E4=null,M4=null;function B4(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var k4=typeof setTimeout=="function"?setTimeout:void 0,EEe=typeof clearTimeout=="function"?clearTimeout:void 0,AK=typeof Promise=="function"?Promise:void 0,MEe=typeof queueMicrotask=="function"?queueMicrotask:typeof AK<"u"?function(e){return AK.resolve(null).then(e).catch(BEe)}:k4;function BEe(e){setTimeout(function(){throw e})}function e4(e,t){var r=t,n=0;do{var o=r.nextSibling;if(e.removeChild(r),o&&o.nodeType===8)if(r=o.data,r==="/$"){if(n===0){e.removeChild(o),yP(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=o}while(r);yP(t)}function bb(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function TK(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var O1=Math.random().toString(36).slice(2),Xf="__reactFiber$"+O1,vP="__reactProps$"+O1,Lg="__reactContainer$"+O1,L4="__reactEvents$"+O1,kEe="__reactListeners$"+O1,LEe="__reactHandles$"+O1;function OC(e){var t=e[Xf];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Lg]||r[Xf]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=TK(e);e!==null;){if(r=e[Xf])return r;e=TK(e)}return t}e=r,r=e.parentNode}return null}function EP(e){return e=e[Xf]||e[Lg],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function y1(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Yt(33))}function X3(e){return e[vP]||null}var F4=[],b1=-1;function Pb(e){return{current:e}}function ea(e){0>b1||(e.current=F4[b1],F4[b1]=null,b1--)}function ji(e,t){b1++,F4[b1]=e.current,e.current=t}var Ab={},_u=Pb(Ab),Qc=Pb(!1),HC=Ab;function E1(e,t){var r=e.type.contextTypes;if(!r)return Ab;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in r)o[i]=t[i];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Zc(e){return e=e.childContextTypes,e!=null}function _3(){ea(Qc),ea(_u)}function PK(e,t,r){if(_u.current!==Ab)throw Error(Yt(168));ji(_u,t),ji(Qc,r)}function qJ(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var o in n)if(!(o in t))throw Error(Yt(108,Swe(e)||"Unknown",o));return wa({},r,n)}function R3(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ab,HC=_u.current,ji(_u,e),ji(Qc,Qc.current),!0}function _K(e,t,r){var n=e.stateNode;if(!n)throw Error(Yt(169));r?(e=qJ(e,t,HC),n.__reactInternalMemoizedMergedChildContext=e,ea(Qc),ea(_u),ji(_u,e)):ea(Qc),ji(Qc,r)}var wg=null,Q3=!1,t4=!1;function YJ(e){wg===null?wg=[e]:wg.push(e)}function FEe(e){Q3=!0,YJ(e)}function _b(){if(!t4&&wg!==null){t4=!0;var e=0,t=yi;try{var r=wg;for(yi=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}wg=null,Q3=!1}catch(o){throw wg!==null&&(wg=wg.slice(e+1)),SJ(uU,_b),o}finally{yi=t,t4=!1}}return null}var x1=[],C1=0,D3=null,w3=0,Rd=[],Dd=0,jC=null,Eg=1,Mg="";function FC(e,t){x1[C1++]=w3,x1[C1++]=D3,D3=e,w3=t}function KJ(e,t,r){Rd[Dd++]=Eg,Rd[Dd++]=Mg,Rd[Dd++]=jC,jC=e;var n=Eg;e=Mg;var o=32-jp(n)-1;n&=~(1<<o),r+=1;var i=32-jp(t)+o;if(30<i){var a=o-o%5;i=(n&(1<<a)-1).toString(32),n>>=a,o-=a,Eg=1<<32-jp(t)+o|r<<o|n,Mg=i+e}else Eg=1<<i|r<<o|n,Mg=e}function bU(e){e.return!==null&&(FC(e,1),KJ(e,1,0))}function xU(e){for(;e===D3;)D3=x1[--C1],x1[C1]=null,w3=x1[--C1],x1[C1]=null;for(;e===jC;)jC=Rd[--Dd],Rd[Dd]=null,Mg=Rd[--Dd],Rd[Dd]=null,Eg=Rd[--Dd],Rd[Dd]=null}var Em=null,wm=null,ca=!1,Hp=null;function JJ(e,t){var r=wd(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function RK(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Em=e,wm=bb(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Em=e,wm=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=jC!==null?{id:Eg,overflow:Mg}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=wd(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Em=e,wm=null,!0):!1;default:return!1}}function V4(e){return(e.mode&1)!==0&&(e.flags&128)===0}function O4(e){if(ca){var t=wm;if(t){var r=t;if(!RK(e,t)){if(V4(e))throw Error(Yt(418));t=bb(r.nextSibling);var n=Em;t&&RK(e,t)?JJ(n,r):(e.flags=e.flags&-4097|2,ca=!1,Em=e)}}else{if(V4(e))throw Error(Yt(418));e.flags=e.flags&-4097|2,ca=!1,Em=e}}}function DK(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Em=e}function n3(e){if(e!==Em)return!1;if(!ca)return DK(e),ca=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!B4(e.type,e.memoizedProps)),t&&(t=wm)){if(V4(e))throw $J(),Error(Yt(418));for(;t;)JJ(e,t),t=bb(t.nextSibling)}if(DK(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Yt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){wm=bb(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}wm=null}}else wm=Em?bb(e.stateNode.nextSibling):null;return!0}function $J(){for(var e=wm;e;)e=bb(e.nextSibling)}function M1(){wm=Em=null,ca=!1}function CU(e){Hp===null?Hp=[e]:Hp.push(e)}var VEe=Og.ReactCurrentBatchConfig;function qT(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Yt(309));var n=r.stateNode}if(!n)throw Error(Yt(147,e));var o=n,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(a){var s=o.refs;a===null?delete s[i]:s[i]=a},t._stringRef=i,t)}if(typeof e!="string")throw Error(Yt(284));if(!r._owner)throw Error(Yt(290,e))}return e}function o3(e,t){throw e=Object.prototype.toString.call(t),Error(Yt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function wK(e){var t=e._init;return t(e._payload)}function e$(e){function t(g,x){if(e){var S=g.deletions;S===null?(g.deletions=[x],g.flags|=16):S.push(x)}}function r(g,x){if(!e)return null;for(;x!==null;)t(g,x),x=x.sibling;return null}function n(g,x){for(g=new Map;x!==null;)x.key!==null?g.set(x.key,x):g.set(x.index,x),x=x.sibling;return g}function o(g,x){return g=vb(g,x),g.index=0,g.sibling=null,g}function i(g,x,S){return g.index=S,e?(S=g.alternate,S!==null?(S=S.index,S<x?(g.flags|=2,x):S):(g.flags|=2,x)):(g.flags|=1048576,x)}function a(g){return e&&g.alternate===null&&(g.flags|=2),g}function s(g,x,S,I){return x===null||x.tag!==6?(x=l4(S,g.mode,I),x.return=g,x):(x=o(x,S),x.return=g,x)}function l(g,x,S,I){var v=S.type;return v===p1?c(g,x,S.props.children,I,S.key):x!==null&&(x.elementType===v||typeof v=="object"&&v!==null&&v.$$typeof===ub&&wK(v)===x.type)?(I=o(x,S.props),I.ref=qT(g,x,S),I.return=g,I):(I=y3(S.type,S.key,S.props,null,g.mode,I),I.ref=qT(g,x,S),I.return=g,I)}function u(g,x,S,I){return x===null||x.tag!==4||x.stateNode.containerInfo!==S.containerInfo||x.stateNode.implementation!==S.implementation?(x=u4(S,g.mode,I),x.return=g,x):(x=o(x,S.children||[]),x.return=g,x)}function c(g,x,S,I,v){return x===null||x.tag!==7?(x=zC(S,g.mode,I,v),x.return=g,x):(x=o(x,S),x.return=g,x)}function m(g,x,S){if(typeof x=="string"&&x!==""||typeof x=="number")return x=l4(""+x,g.mode,S),x.return=g,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case HD:return S=y3(x.type,x.key,x.props,null,g.mode,S),S.ref=qT(g,null,x),S.return=g,S;case d1:return x=u4(x,g.mode,S),x.return=g,x;case ub:var I=x._init;return m(g,I(x._payload),S)}if(eP(x)||WT(x))return x=zC(x,g.mode,S,null),x.return=g,x;o3(g,x)}return null}function d(g,x,S,I){var v=x!==null?x.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return v!==null?null:s(g,x,""+S,I);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case HD:return S.key===v?l(g,x,S,I):null;case d1:return S.key===v?u(g,x,S,I):null;case ub:return v=S._init,d(g,x,v(S._payload),I)}if(eP(S)||WT(S))return v!==null?null:c(g,x,S,I,null);o3(g,S)}return null}function p(g,x,S,I,v){if(typeof I=="string"&&I!==""||typeof I=="number")return g=g.get(S)||null,s(x,g,""+I,v);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case HD:return g=g.get(I.key===null?S:I.key)||null,l(x,g,I,v);case d1:return g=g.get(I.key===null?S:I.key)||null,u(x,g,I,v);case ub:var A=I._init;return p(g,x,S,A(I._payload),v)}if(eP(I)||WT(I))return g=g.get(S)||null,c(x,g,I,v,null);o3(x,I)}return null}function h(g,x,S,I){for(var v=null,A=null,_=x,T=x=0,w=null;_!==null&&T<S.length;T++){_.index>T?(w=_,_=null):w=_.sibling;var D=d(g,_,S[T],I);if(D===null){_===null&&(_=w);break}e&&_&&D.alternate===null&&t(g,_),x=i(D,x,T),A===null?v=D:A.sibling=D,A=D,_=w}if(T===S.length)return r(g,_),ca&&FC(g,T),v;if(_===null){for(;T<S.length;T++)_=m(g,S[T],I),_!==null&&(x=i(_,x,T),A===null?v=_:A.sibling=_,A=_);return ca&&FC(g,T),v}for(_=n(g,_);T<S.length;T++)w=p(_,g,T,S[T],I),w!==null&&(e&&w.alternate!==null&&_.delete(w.key===null?T:w.key),x=i(w,x,T),A===null?v=w:A.sibling=w,A=w);return e&&_.forEach(function(M){return t(g,M)}),ca&&FC(g,T),v}function f(g,x,S,I){var v=WT(S);if(typeof v!="function")throw Error(Yt(150));if(S=v.call(S),S==null)throw Error(Yt(151));for(var A=v=null,_=x,T=x=0,w=null,D=S.next();_!==null&&!D.done;T++,D=S.next()){_.index>T?(w=_,_=null):w=_.sibling;var M=d(g,_,D.value,I);if(M===null){_===null&&(_=w);break}e&&_&&M.alternate===null&&t(g,_),x=i(M,x,T),A===null?v=M:A.sibling=M,A=M,_=w}if(D.done)return r(g,_),ca&&FC(g,T),v;if(_===null){for(;!D.done;T++,D=S.next())D=m(g,D.value,I),D!==null&&(x=i(D,x,T),A===null?v=D:A.sibling=D,A=D);return ca&&FC(g,T),v}for(_=n(g,_);!D.done;T++,D=S.next())D=p(_,g,T,D.value,I),D!==null&&(e&&D.alternate!==null&&_.delete(D.key===null?T:D.key),x=i(D,x,T),A===null?v=D:A.sibling=D,A=D);return e&&_.forEach(function(E){return t(g,E)}),ca&&FC(g,T),v}function y(g,x,S,I){if(typeof S=="object"&&S!==null&&S.type===p1&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case HD:e:{for(var v=S.key,A=x;A!==null;){if(A.key===v){if(v=S.type,v===p1){if(A.tag===7){r(g,A.sibling),x=o(A,S.props.children),x.return=g,g=x;break e}}else if(A.elementType===v||typeof v=="object"&&v!==null&&v.$$typeof===ub&&wK(v)===A.type){r(g,A.sibling),x=o(A,S.props),x.ref=qT(g,A,S),x.return=g,g=x;break e}r(g,A);break}else t(g,A);A=A.sibling}S.type===p1?(x=zC(S.props.children,g.mode,I,S.key),x.return=g,g=x):(I=y3(S.type,S.key,S.props,null,g.mode,I),I.ref=qT(g,x,S),I.return=g,g=I)}return a(g);case d1:e:{for(A=S.key;x!==null;){if(x.key===A)if(x.tag===4&&x.stateNode.containerInfo===S.containerInfo&&x.stateNode.implementation===S.implementation){r(g,x.sibling),x=o(x,S.children||[]),x.return=g,g=x;break e}else{r(g,x);break}else t(g,x);x=x.sibling}x=u4(S,g.mode,I),x.return=g,g=x}return a(g);case ub:return A=S._init,y(g,x,A(S._payload),I)}if(eP(S))return h(g,x,S,I);if(WT(S))return f(g,x,S,I);o3(g,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,x!==null&&x.tag===6?(r(g,x.sibling),x=o(x,S),x.return=g,g=x):(r(g,x),x=l4(S,g.mode,I),x.return=g,g=x),a(g)):r(g,x)}return y}var B1=e$(!0),t$=e$(!1),E3=Pb(null),M3=null,S1=null,SU=null;function vU(){SU=S1=M3=null}function IU(e){var t=E3.current;ea(E3),e._currentValue=t}function G4(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function R1(e,t){M3=e,SU=S1=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(Xc=!0),e.firstContext=null)}function Md(e){var t=e._currentValue;if(SU!==e)if(e={context:e,memoizedValue:t,next:null},S1===null){if(M3===null)throw Error(Yt(308));S1=e,M3.dependencies={lanes:0,firstContext:e}}else S1=S1.next=e;return t}var GC=null;function AU(e){GC===null?GC=[e]:GC.push(e)}function r$(e,t,r,n){var o=t.interleaved;return o===null?(r.next=r,AU(t)):(r.next=o.next,o.next=r),t.interleaved=r,Fg(e,n)}function Fg(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var cb=!1;function TU(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function n$(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Bg(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function xb(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,(Uo&2)!==0){var o=n.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),n.pending=t,Fg(e,r)}return o=n.interleaved,o===null?(t.next=t,AU(n)):(t.next=o.next,o.next=t),n.interleaved=t,Fg(e,r)}function m3(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,cU(e,r)}}function EK(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var o=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?o=i=a:i=i.next=a,r=r.next}while(r!==null);i===null?o=i=t:i=i.next=t}else o=i=t;r={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function B3(e,t,r,n){var o=e.updateQueue;cb=!1;var i=o.firstBaseUpdate,a=o.lastBaseUpdate,s=o.shared.pending;if(s!==null){o.shared.pending=null;var l=s,u=l.next;l.next=null,a===null?i=u:a.next=u,a=l;var c=e.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==a&&(s===null?c.firstBaseUpdate=u:s.next=u,c.lastBaseUpdate=l))}if(i!==null){var m=o.baseState;a=0,c=u=l=null,s=i;do{var d=s.lane,p=s.eventTime;if((n&d)===d){c!==null&&(c=c.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=e,f=s;switch(d=t,p=r,f.tag){case 1:if(h=f.payload,typeof h=="function"){m=h.call(p,m,d);break e}m=h;break e;case 3:h.flags=h.flags&-65537|128;case 0:if(h=f.payload,d=typeof h=="function"?h.call(p,m,d):h,d==null)break e;m=wa({},m,d);break e;case 2:cb=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,d=o.effects,d===null?o.effects=[s]:d.push(s))}else p={eventTime:p,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(u=c=p,l=m):c=c.next=p,a|=d;if(s=s.next,s===null){if(s=o.shared.pending,s===null)break;d=s,s=d.next,d.next=null,o.lastBaseUpdate=d,o.shared.pending=null}}while(!0);if(c===null&&(l=m),o.baseState=l,o.firstBaseUpdate=u,o.lastBaseUpdate=c,t=o.shared.interleaved,t!==null){o=t;do a|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);XC|=a,e.lanes=a,e.memoizedState=m}}function MK(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],o=n.callback;if(o!==null){if(n.callback=null,n=r,typeof o!="function")throw Error(Yt(191,o));o.call(n)}}}var MP={},Zf=Pb(MP),IP=Pb(MP),AP=Pb(MP);function UC(e){if(e===MP)throw Error(Yt(174));return e}function PU(e,t){switch(ji(AP,t),ji(IP,e),ji(Zf,MP),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:x4(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=x4(t,e)}ea(Zf),ji(Zf,t)}function k1(){ea(Zf),ea(IP),ea(AP)}function o$(e){UC(AP.current);var t=UC(Zf.current),r=x4(t,e.type);t!==r&&(ji(IP,e),ji(Zf,r))}function _U(e){IP.current===e&&(ea(Zf),ea(IP))}var Ra=Pb(0);function k3(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var r4=[];function RU(){for(var e=0;e<r4.length;e++)r4[e]._workInProgressVersionPrimary=null;r4.length=0}var d3=Og.ReactCurrentDispatcher,n4=Og.ReactCurrentBatchConfig,WC=0,Da=null,il=null,yl=null,L3=!1,lP=!1,TP=0,OEe=0;function Au(){throw Error(Yt(321))}function DU(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Xp(e[r],t[r]))return!1;return!0}function wU(e,t,r,n,o,i){if(WC=i,Da=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,d3.current=e===null||e.memoizedState===null?zEe:HEe,e=r(n,o),lP){i=0;do{if(lP=!1,TP=0,25<=i)throw Error(Yt(301));i+=1,yl=il=null,t.updateQueue=null,d3.current=jEe,e=r(n,o)}while(lP)}if(d3.current=F3,t=il!==null&&il.next!==null,WC=0,yl=il=Da=null,L3=!1,t)throw Error(Yt(300));return e}function EU(){var e=TP!==0;return TP=0,e}function Wf(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yl===null?Da.memoizedState=yl=e:yl=yl.next=e,yl}function Bd(){if(il===null){var e=Da.alternate;e=e!==null?e.memoizedState:null}else e=il.next;var t=yl===null?Da.memoizedState:yl.next;if(t!==null)yl=t,il=e;else{if(e===null)throw Error(Yt(310));il=e,e={memoizedState:il.memoizedState,baseState:il.baseState,baseQueue:il.baseQueue,queue:il.queue,next:null},yl===null?Da.memoizedState=yl=e:yl=yl.next=e}return yl}function PP(e,t){return typeof t=="function"?t(e):t}function o4(e){var t=Bd(),r=t.queue;if(r===null)throw Error(Yt(311));r.lastRenderedReducer=e;var n=il,o=n.baseQueue,i=r.pending;if(i!==null){if(o!==null){var a=o.next;o.next=i.next,i.next=a}n.baseQueue=o=i,r.pending=null}if(o!==null){i=o.next,n=n.baseState;var s=a=null,l=null,u=i;do{var c=u.lane;if((WC&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:e(n,u.action);else{var m={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(s=l=m,a=n):l=l.next=m,Da.lanes|=c,XC|=c}u=u.next}while(u!==null&&u!==i);l===null?a=n:l.next=s,Xp(n,t.memoizedState)||(Xc=!0),t.memoizedState=n,t.baseState=a,t.baseQueue=l,r.lastRenderedState=n}if(e=r.interleaved,e!==null){o=e;do i=o.lane,Da.lanes|=i,XC|=i,o=o.next;while(o!==e)}else o===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function i4(e){var t=Bd(),r=t.queue;if(r===null)throw Error(Yt(311));r.lastRenderedReducer=e;var n=r.dispatch,o=r.pending,i=t.memoizedState;if(o!==null){r.pending=null;var a=o=o.next;do i=e(i,a.action),a=a.next;while(a!==o);Xp(i,t.memoizedState)||(Xc=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,n]}function i$(){}function a$(e,t){var r=Da,n=Bd(),o=t(),i=!Xp(n.memoizedState,o);if(i&&(n.memoizedState=o,Xc=!0),n=n.queue,MU(u$.bind(null,r,n,e),[e]),n.getSnapshot!==t||i||yl!==null&&yl.memoizedState.tag&1){if(r.flags|=2048,_P(9,l$.bind(null,r,n,o,t),void 0,null),bl===null)throw Error(Yt(349));(WC&30)!==0||s$(r,t,o)}return o}function s$(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Da.updateQueue,t===null?(t={lastEffect:null,stores:null},Da.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function l$(e,t,r,n){t.value=r,t.getSnapshot=n,c$(t)&&m$(e)}function u$(e,t,r){return r(function(){c$(t)&&m$(e)})}function c$(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Xp(e,r)}catch{return!0}}function m$(e){var t=Fg(e,1);t!==null&&Wp(t,e,1,-1)}function BK(e){var t=Wf();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:PP,lastRenderedState:e},t.queue=e,e=e.dispatch=NEe.bind(null,Da,e),[t.memoizedState,e]}function _P(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Da.updateQueue,t===null?(t={lastEffect:null,stores:null},Da.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function d$(){return Bd().memoizedState}function p3(e,t,r,n){var o=Wf();Da.flags|=e,o.memoizedState=_P(1|t,r,void 0,n===void 0?null:n)}function Z3(e,t,r,n){var o=Bd();n=n===void 0?null:n;var i=void 0;if(il!==null){var a=il.memoizedState;if(i=a.destroy,n!==null&&DU(n,a.deps)){o.memoizedState=_P(t,r,i,n);return}}Da.flags|=e,o.memoizedState=_P(1|t,r,i,n)}function kK(e,t){return p3(8390656,8,e,t)}function MU(e,t){return Z3(2048,8,e,t)}function p$(e,t){return Z3(4,2,e,t)}function f$(e,t){return Z3(4,4,e,t)}function h$(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function g$(e,t,r){return r=r!=null?r.concat([e]):null,Z3(4,4,h$.bind(null,t,e),r)}function BU(){}function y$(e,t){var r=Bd();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&DU(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function b$(e,t){var r=Bd();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&DU(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function x$(e,t,r){return(WC&21)===0?(e.baseState&&(e.baseState=!1,Xc=!0),e.memoizedState=r):(Xp(r,t)||(r=AJ(),Da.lanes|=r,XC|=r,e.baseState=!0),t)}function GEe(e,t){var r=yi;yi=r!==0&&4>r?r:4,e(!0);var n=n4.transition;n4.transition={};try{e(!1),t()}finally{yi=r,n4.transition=n}}function C$(){return Bd().memoizedState}function UEe(e,t,r){var n=Sb(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},S$(e))v$(t,r);else if(r=r$(e,t,r,n),r!==null){var o=lc();Wp(r,e,n,o),I$(r,t,n)}}function NEe(e,t,r){var n=Sb(e),o={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(S$(e))v$(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var a=t.lastRenderedState,s=i(a,r);if(o.hasEagerState=!0,o.eagerState=s,Xp(s,a)){var l=t.interleaved;l===null?(o.next=o,AU(t)):(o.next=l.next,l.next=o),t.interleaved=o;return}}catch{}finally{}r=r$(e,t,o,n),r!==null&&(o=lc(),Wp(r,e,n,o),I$(r,t,n))}}function S$(e){var t=e.alternate;return e===Da||t!==null&&t===Da}function v$(e,t){lP=L3=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function I$(e,t,r){if((r&4194240)!==0){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,cU(e,r)}}var F3={readContext:Md,useCallback:Au,useContext:Au,useEffect:Au,useImperativeHandle:Au,useInsertionEffect:Au,useLayoutEffect:Au,useMemo:Au,useReducer:Au,useRef:Au,useState:Au,useDebugValue:Au,useDeferredValue:Au,useTransition:Au,useMutableSource:Au,useSyncExternalStore:Au,useId:Au,unstable_isNewReconciler:!1},zEe={readContext:Md,useCallback:function(e,t){return Wf().memoizedState=[e,t===void 0?null:t],e},useContext:Md,useEffect:kK,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,p3(4194308,4,h$.bind(null,t,e),r)},useLayoutEffect:function(e,t){return p3(4194308,4,e,t)},useInsertionEffect:function(e,t){return p3(4,2,e,t)},useMemo:function(e,t){var r=Wf();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Wf();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=UEe.bind(null,Da,e),[n.memoizedState,e]},useRef:function(e){var t=Wf();return e={current:e},t.memoizedState=e},useState:BK,useDebugValue:BU,useDeferredValue:function(e){return Wf().memoizedState=e},useTransition:function(){var e=BK(!1),t=e[0];return e=GEe.bind(null,e[1]),Wf().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Da,o=Wf();if(ca){if(r===void 0)throw Error(Yt(407));r=r()}else{if(r=t(),bl===null)throw Error(Yt(349));(WC&30)!==0||s$(n,t,r)}o.memoizedState=r;var i={value:r,getSnapshot:t};return o.queue=i,kK(u$.bind(null,n,i,e),[e]),n.flags|=2048,_P(9,l$.bind(null,n,i,r,t),void 0,null),r},useId:function(){var e=Wf(),t=bl.identifierPrefix;if(ca){var r=Mg,n=Eg;r=(n&~(1<<32-jp(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=TP++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=OEe++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},HEe={readContext:Md,useCallback:y$,useContext:Md,useEffect:MU,useImperativeHandle:g$,useInsertionEffect:p$,useLayoutEffect:f$,useMemo:b$,useReducer:o4,useRef:d$,useState:function(){return o4(PP)},useDebugValue:BU,useDeferredValue:function(e){var t=Bd();return x$(t,il.memoizedState,e)},useTransition:function(){var e=o4(PP)[0],t=Bd().memoizedState;return[e,t]},useMutableSource:i$,useSyncExternalStore:a$,useId:C$,unstable_isNewReconciler:!1},jEe={readContext:Md,useCallback:y$,useContext:Md,useEffect:MU,useImperativeHandle:g$,useInsertionEffect:p$,useLayoutEffect:f$,useMemo:b$,useReducer:i4,useRef:d$,useState:function(){return i4(PP)},useDebugValue:BU,useDeferredValue:function(e){var t=Bd();return il===null?t.memoizedState=e:x$(t,il.memoizedState,e)},useTransition:function(){var e=i4(PP)[0],t=Bd().memoizedState;return[e,t]},useMutableSource:i$,useSyncExternalStore:a$,useId:C$,unstable_isNewReconciler:!1};function Np(e,t){if(e&&e.defaultProps){t=wa({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function U4(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:wa({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var q3={isMounted:function(e){return(e=e._reactInternals)?qC(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=lc(),o=Sb(e),i=Bg(n,o);i.payload=t,r!=null&&(i.callback=r),t=xb(e,i,o),t!==null&&(Wp(t,e,o,n),m3(t,e,o))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=lc(),o=Sb(e),i=Bg(n,o);i.tag=1,i.payload=t,r!=null&&(i.callback=r),t=xb(e,i,o),t!==null&&(Wp(t,e,o,n),m3(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=lc(),n=Sb(e),o=Bg(r,n);o.tag=2,t!=null&&(o.callback=t),t=xb(e,o,n),t!==null&&(Wp(t,e,n,r),m3(t,e,n))}};function LK(e,t,r,n,o,i,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,i,a):t.prototype&&t.prototype.isPureReactComponent?!xP(r,n)||!xP(o,i):!0}function A$(e,t,r){var n=!1,o=Ab,i=t.contextType;return typeof i=="object"&&i!==null?i=Md(i):(o=Zc(t)?HC:_u.current,n=t.contextTypes,i=(n=n!=null)?E1(e,o):Ab),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=q3,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function FK(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&q3.enqueueReplaceState(t,t.state,null)}function N4(e,t,r,n){var o=e.stateNode;o.props=r,o.state=e.memoizedState,o.refs={},TU(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=Md(i):(i=Zc(t)?HC:_u.current,o.context=E1(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(U4(e,t,i,r),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&q3.enqueueReplaceState(o,o.state,null),B3(e,r,o,n),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function L1(e,t){try{var r="",n=t;do r+=Cwe(n),n=n.return;while(n);var o=r}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function a4(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function z4(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var WEe=typeof WeakMap=="function"?WeakMap:Map;function T$(e,t,r){r=Bg(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){O3||(O3=!0,J4=n),z4(e,t)},r}function P$(e,t,r){r=Bg(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var o=t.value;r.payload=function(){return n(o)},r.callback=function(){z4(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){z4(e,t),typeof n!="function"&&(Cb===null?Cb=new Set([this]):Cb.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),r}function VK(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new WEe;var o=new Set;n.set(t,o)}else o=n.get(t),o===void 0&&(o=new Set,n.set(t,o));o.has(r)||(o.add(r),e=iMe.bind(null,e,t,r),t.then(e,e))}function OK(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function GK(e,t,r,n,o){return(e.mode&1)===0?(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Bg(-1,1),t.tag=2,xb(r,t,1))),r.lanes|=1),e):(e.flags|=65536,e.lanes=o,e)}var XEe=Og.ReactCurrentOwner,Xc=!1;function sc(e,t,r,n){t.child=e===null?t$(t,null,r,n):B1(t,e.child,r,n)}function UK(e,t,r,n,o){r=r.render;var i=t.ref;return R1(t,o),n=wU(e,t,r,n,i,o),r=EU(),e!==null&&!Xc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Vg(e,t,o)):(ca&&r&&bU(t),t.flags|=1,sc(e,t,n,o),t.child)}function NK(e,t,r,n,o){if(e===null){var i=r.type;return typeof i=="function"&&!NU(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=i,_$(e,t,i,n,o)):(e=y3(r.type,null,n,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,(e.lanes&o)===0){var a=i.memoizedProps;if(r=r.compare,r=r!==null?r:xP,r(a,n)&&e.ref===t.ref)return Vg(e,t,o)}return t.flags|=1,e=vb(i,n),e.ref=t.ref,e.return=t,t.child=e}function _$(e,t,r,n,o){if(e!==null){var i=e.memoizedProps;if(xP(i,n)&&e.ref===t.ref)if(Xc=!1,t.pendingProps=n=i,(e.lanes&o)!==0)(e.flags&131072)!==0&&(Xc=!0);else return t.lanes=e.lanes,Vg(e,t,o)}return H4(e,t,r,n,o)}function R$(e,t,r){var n=t.pendingProps,o=n.children,i=e!==null?e.memoizedState:null;if(n.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ji(I1,Dm),Dm|=r;else{if((r&1073741824)===0)return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ji(I1,Dm),Dm|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:r,ji(I1,Dm),Dm|=n}else i!==null?(n=i.baseLanes|r,t.memoizedState=null):n=r,ji(I1,Dm),Dm|=n;return sc(e,t,o,r),t.child}function D$(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function H4(e,t,r,n,o){var i=Zc(r)?HC:_u.current;return i=E1(t,i),R1(t,o),r=wU(e,t,r,n,i,o),n=EU(),e!==null&&!Xc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Vg(e,t,o)):(ca&&n&&bU(t),t.flags|=1,sc(e,t,r,o),t.child)}function zK(e,t,r,n,o){if(Zc(r)){var i=!0;R3(t)}else i=!1;if(R1(t,o),t.stateNode===null)f3(e,t),A$(t,r,n),N4(t,r,n,o),n=!0;else if(e===null){var a=t.stateNode,s=t.memoizedProps;a.props=s;var l=a.context,u=r.contextType;typeof u=="object"&&u!==null?u=Md(u):(u=Zc(r)?HC:_u.current,u=E1(t,u));var c=r.getDerivedStateFromProps,m=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";m||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==n||l!==u)&&FK(t,a,n,u),cb=!1;var d=t.memoizedState;a.state=d,B3(t,n,a,o),l=t.memoizedState,s!==n||d!==l||Qc.current||cb?(typeof c=="function"&&(U4(t,r,c,n),l=t.memoizedState),(s=cb||LK(t,r,s,n,d,l,u))?(m||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),a.props=n,a.state=l,a.context=u,n=s):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{a=t.stateNode,n$(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:Np(t.type,s),a.props=u,m=t.pendingProps,d=a.context,l=r.contextType,typeof l=="object"&&l!==null?l=Md(l):(l=Zc(r)?HC:_u.current,l=E1(t,l));var p=r.getDerivedStateFromProps;(c=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==m||d!==l)&&FK(t,a,n,l),cb=!1,d=t.memoizedState,a.state=d,B3(t,n,a,o);var h=t.memoizedState;s!==m||d!==h||Qc.current||cb?(typeof p=="function"&&(U4(t,r,p,n),h=t.memoizedState),(u=cb||LK(t,r,u,n,d,h,l)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(n,h,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(n,h,l)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=h),a.props=n,a.state=h,a.context=l,n=u):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),n=!1)}return j4(e,t,r,n,i,o)}function j4(e,t,r,n,o,i){D$(e,t);var a=(t.flags&128)!==0;if(!n&&!a)return o&&_K(t,r,!1),Vg(e,t,i);n=t.stateNode,XEe.current=t;var s=a&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&a?(t.child=B1(t,e.child,null,i),t.child=B1(t,null,s,i)):sc(e,t,s,i),t.memoizedState=n.state,o&&_K(t,r,!0),t.child}function w$(e){var t=e.stateNode;t.pendingContext?PK(e,t.pendingContext,t.pendingContext!==t.context):t.context&&PK(e,t.context,!1),PU(e,t.containerInfo)}function HK(e,t,r,n,o){return M1(),CU(o),t.flags|=256,sc(e,t,r,n),t.child}var W4={dehydrated:null,treeContext:null,retryLane:0};function X4(e){return{baseLanes:e,cachePool:null,transitions:null}}function E$(e,t,r){var n=t.pendingProps,o=Ra.current,i=!1,a=(t.flags&128)!==0,s;if((s=a)||(s=e!==null&&e.memoizedState===null?!1:(o&2)!==0),s?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),ji(Ra,o&1),e===null)return O4(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?((t.mode&1)===0?t.lanes=1:e.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(a=n.children,e=n.fallback,i?(n=t.mode,i=t.child,a={mode:"hidden",children:a},(n&1)===0&&i!==null?(i.childLanes=0,i.pendingProps=a):i=J3(a,n,0,null),e=zC(e,n,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=X4(r),t.memoizedState=W4,e):kU(t,a));if(o=e.memoizedState,o!==null&&(s=o.dehydrated,s!==null))return QEe(e,t,a,n,s,o,r);if(i){i=n.fallback,a=t.mode,o=e.child,s=o.sibling;var l={mode:"hidden",children:n.children};return(a&1)===0&&t.child!==o?(n=t.child,n.childLanes=0,n.pendingProps=l,t.deletions=null):(n=vb(o,l),n.subtreeFlags=o.subtreeFlags&14680064),s!==null?i=vb(s,i):(i=zC(i,a,r,null),i.flags|=2),i.return=t,n.return=t,n.sibling=i,t.child=n,n=i,i=t.child,a=e.child.memoizedState,a=a===null?X4(r):{baseLanes:a.baseLanes|r,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=e.childLanes&~r,t.memoizedState=W4,n}return i=e.child,e=i.sibling,n=vb(i,{mode:"visible",children:n.children}),(t.mode&1)===0&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function kU(e,t){return t=J3({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function i3(e,t,r,n){return n!==null&&CU(n),B1(t,e.child,null,r),e=kU(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function QEe(e,t,r,n,o,i,a){if(r)return t.flags&256?(t.flags&=-257,n=a4(Error(Yt(422))),i3(e,t,a,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=n.fallback,o=t.mode,n=J3({mode:"visible",children:n.children},o,0,null),i=zC(i,o,a,null),i.flags|=2,n.return=t,i.return=t,n.sibling=i,t.child=n,(t.mode&1)!==0&&B1(t,e.child,null,a),t.child.memoizedState=X4(a),t.memoizedState=W4,i);if((t.mode&1)===0)return i3(e,t,a,null);if(o.data==="$!"){if(n=o.nextSibling&&o.nextSibling.dataset,n)var s=n.dgst;return n=s,i=Error(Yt(419)),n=a4(i,n,void 0),i3(e,t,a,n)}if(s=(a&e.childLanes)!==0,Xc||s){if(n=bl,n!==null){switch(a&-a){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=(o&(n.suspendedLanes|a))!==0?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,Fg(e,o),Wp(n,e,o,-1))}return UU(),n=a4(Error(Yt(421))),i3(e,t,a,n)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=aMe.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,wm=bb(o.nextSibling),Em=t,ca=!0,Hp=null,e!==null&&(Rd[Dd++]=Eg,Rd[Dd++]=Mg,Rd[Dd++]=jC,Eg=e.id,Mg=e.overflow,jC=t),t=kU(t,n.children),t.flags|=4096,t)}function jK(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),G4(e.return,t,r)}function s4(e,t,r,n,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=r,i.tailMode=o)}function M$(e,t,r){var n=t.pendingProps,o=n.revealOrder,i=n.tail;if(sc(e,t,n.children,r),n=Ra.current,(n&2)!==0)n=n&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&jK(e,r,t);else if(e.tag===19)jK(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(ji(Ra,n),(t.mode&1)===0)t.memoizedState=null;else switch(o){case"forwards":for(r=t.child,o=null;r!==null;)e=r.alternate,e!==null&&k3(e)===null&&(o=r),r=r.sibling;r=o,r===null?(o=t.child,t.child=null):(o=r.sibling,r.sibling=null),s4(t,!1,o,r,i);break;case"backwards":for(r=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&k3(e)===null){t.child=o;break}e=o.sibling,o.sibling=r,r=o,o=e}s4(t,!0,r,null,i);break;case"together":s4(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function f3(e,t){(t.mode&1)===0&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vg(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),XC|=t.lanes,(r&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(Yt(153));if(t.child!==null){for(e=t.child,r=vb(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=vb(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function ZEe(e,t,r){switch(t.tag){case 3:w$(t),M1();break;case 5:o$(t);break;case 1:Zc(t.type)&&R3(t);break;case 4:PU(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,o=t.memoizedProps.value;ji(E3,n._currentValue),n._currentValue=o;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(ji(Ra,Ra.current&1),t.flags|=128,null):(r&t.child.childLanes)!==0?E$(e,t,r):(ji(Ra,Ra.current&1),e=Vg(e,t,r),e!==null?e.sibling:null);ji(Ra,Ra.current&1);break;case 19:if(n=(r&t.childLanes)!==0,(e.flags&128)!==0){if(n)return M$(e,t,r);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),ji(Ra,Ra.current),n)break;return null;case 22:case 23:return t.lanes=0,R$(e,t,r)}return Vg(e,t,r)}var B$,Q4,k$,L$;B$=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Q4=function(){};k$=function(e,t,r,n){var o=e.memoizedProps;if(o!==n){e=t.stateNode,UC(Zf.current);var i=null;switch(r){case"input":o=h4(e,o),n=h4(e,n),i=[];break;case"select":o=wa({},o,{value:void 0}),n=wa({},n,{value:void 0}),i=[];break;case"textarea":o=b4(e,o),n=b4(e,n),i=[];break;default:typeof o.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=P3)}C4(r,n);var a;r=null;for(u in o)if(!n.hasOwnProperty(u)&&o.hasOwnProperty(u)&&o[u]!=null)if(u==="style"){var s=o[u];for(a in s)s.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(dP.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in n){var l=n[u];if(s=o?.[u],n.hasOwnProperty(u)&&l!==s&&(l!=null||s!=null))if(u==="style")if(s){for(a in s)!s.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in l)l.hasOwnProperty(a)&&s[a]!==l[a]&&(r||(r={}),r[a]=l[a])}else r||(i||(i=[]),i.push(u,r)),r=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,s=s?s.__html:void 0,l!=null&&s!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(dP.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&$i("scroll",e),i||s===l||(i=[])):(i=i||[]).push(u,l))}r&&(i=i||[]).push("style",r);var u=i;(t.updateQueue=u)&&(t.flags|=4)}};L$=function(e,t,r,n){r!==n&&(t.flags|=4)};function YT(e,t){if(!ca)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Tu(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var o=e.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags&14680064,n|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function qEe(e,t,r){var n=t.pendingProps;switch(xU(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Tu(t),null;case 1:return Zc(t.type)&&_3(),Tu(t),null;case 3:return n=t.stateNode,k1(),ea(Qc),ea(_u),RU(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(n3(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Hp!==null&&(tU(Hp),Hp=null))),Q4(e,t),Tu(t),null;case 5:_U(t);var o=UC(AP.current);if(r=t.type,e!==null&&t.stateNode!=null)k$(e,t,r,n,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Yt(166));return Tu(t),null}if(e=UC(Zf.current),n3(t)){n=t.stateNode,r=t.type;var i=t.memoizedProps;switch(n[Xf]=t,n[vP]=i,e=(t.mode&1)!==0,r){case"dialog":$i("cancel",n),$i("close",n);break;case"iframe":case"object":case"embed":$i("load",n);break;case"video":case"audio":for(o=0;o<rP.length;o++)$i(rP[o],n);break;case"source":$i("error",n);break;case"img":case"image":case"link":$i("error",n),$i("load",n);break;case"details":$i("toggle",n);break;case"input":JY(n,i),$i("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},$i("invalid",n);break;case"textarea":eK(n,i),$i("invalid",n)}C4(r,i),o=null;for(var a in i)if(i.hasOwnProperty(a)){var s=i[a];a==="children"?typeof s=="string"?n.textContent!==s&&(i.suppressHydrationWarning!==!0&&r3(n.textContent,s,e),o=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(i.suppressHydrationWarning!==!0&&r3(n.textContent,s,e),o=["children",""+s]):dP.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&$i("scroll",n)}switch(r){case"input":jD(n),$Y(n,i,!0);break;case"textarea":jD(n),tK(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=P3)}n=o,t.updateQueue=n,n!==null&&(t.flags|=4)}else{a=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=uJ(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=a.createElement(r,{is:n.is}):(e=a.createElement(r),r==="select"&&(a=e,n.multiple?a.multiple=!0:n.size&&(a.size=n.size))):e=a.createElementNS(e,r),e[Xf]=t,e[vP]=n,B$(e,t,!1,!1),t.stateNode=e;e:{switch(a=S4(r,n),r){case"dialog":$i("cancel",e),$i("close",e),o=n;break;case"iframe":case"object":case"embed":$i("load",e),o=n;break;case"video":case"audio":for(o=0;o<rP.length;o++)$i(rP[o],e);o=n;break;case"source":$i("error",e),o=n;break;case"img":case"image":case"link":$i("error",e),$i("load",e),o=n;break;case"details":$i("toggle",e),o=n;break;case"input":JY(e,n),o=h4(e,n),$i("invalid",e);break;case"option":o=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},o=wa({},n,{value:void 0}),$i("invalid",e);break;case"textarea":eK(e,n),o=b4(e,n),$i("invalid",e);break;default:o=n}C4(r,o),s=o;for(i in s)if(s.hasOwnProperty(i)){var l=s[i];i==="style"?dJ(e,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&cJ(e,l)):i==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&pP(e,l):typeof l=="number"&&pP(e,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(dP.hasOwnProperty(i)?l!=null&&i==="onScroll"&&$i("scroll",e):l!=null&&oU(e,i,l,a))}switch(r){case"input":jD(e),$Y(e,n,!1);break;case"textarea":jD(e),tK(e);break;case"option":n.value!=null&&e.setAttribute("value",""+Ib(n.value));break;case"select":e.multiple=!!n.multiple,i=n.value,i!=null?A1(e,!!n.multiple,i,!1):n.defaultValue!=null&&A1(e,!!n.multiple,n.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=P3)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Tu(t),null;case 6:if(e&&t.stateNode!=null)L$(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Yt(166));if(r=UC(AP.current),UC(Zf.current),n3(t)){if(n=t.stateNode,r=t.memoizedProps,n[Xf]=t,(i=n.nodeValue!==r)&&(e=Em,e!==null))switch(e.tag){case 3:r3(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&r3(n.nodeValue,r,(e.mode&1)!==0)}i&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Xf]=t,t.stateNode=n}return Tu(t),null;case 13:if(ea(Ra),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ca&&wm!==null&&(t.mode&1)!==0&&(t.flags&128)===0)$J(),M1(),t.flags|=98560,i=!1;else if(i=n3(t),n!==null&&n.dehydrated!==null){if(e===null){if(!i)throw Error(Yt(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Yt(317));i[Xf]=t}else M1(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Tu(t),i=!1}else Hp!==null&&(tU(Hp),Hp=null),i=!0;if(!i)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,(t.mode&1)!==0&&(e===null||(Ra.current&1)!==0?al===0&&(al=3):UU())),t.updateQueue!==null&&(t.flags|=4),Tu(t),null);case 4:return k1(),Q4(e,t),e===null&&CP(t.stateNode.containerInfo),Tu(t),null;case 10:return IU(t.type._context),Tu(t),null;case 17:return Zc(t.type)&&_3(),Tu(t),null;case 19:if(ea(Ra),i=t.memoizedState,i===null)return Tu(t),null;if(n=(t.flags&128)!==0,a=i.rendering,a===null)if(n)YT(i,!1);else{if(al!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(a=k3(e),a!==null){for(t.flags|=128,YT(i,!1),n=a.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)i=r,e=n,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,e=a.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return ji(Ra,Ra.current&1|2),t.child}e=e.sibling}i.tail!==null&&xs()>F1&&(t.flags|=128,n=!0,YT(i,!1),t.lanes=4194304)}else{if(!n)if(e=k3(a),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),YT(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!ca)return Tu(t),null}else 2*xs()-i.renderingStartTime>F1&&r!==1073741824&&(t.flags|=128,n=!0,YT(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(r=i.last,r!==null?r.sibling=a:t.child=a,i.last=a)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=xs(),t.sibling=null,r=Ra.current,ji(Ra,n?r&1|2:r&1),t):(Tu(t),null);case 22:case 23:return GU(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&(t.mode&1)!==0?(Dm&1073741824)!==0&&(Tu(t),t.subtreeFlags&6&&(t.flags|=8192)):Tu(t),null;case 24:return null;case 25:return null}throw Error(Yt(156,t.tag))}function YEe(e,t){switch(xU(t),t.tag){case 1:return Zc(t.type)&&_3(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return k1(),ea(Qc),ea(_u),RU(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 5:return _U(t),null;case 13:if(ea(Ra),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Yt(340));M1()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ea(Ra),null;case 4:return k1(),null;case 10:return IU(t.type._context),null;case 22:case 23:return GU(),null;case 24:return null;default:return null}}var a3=!1,Pu=!1,KEe=typeof WeakSet=="function"?WeakSet:Set,_r=null;function v1(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Ka(e,t,n)}else r.current=null}function Z4(e,t,r){try{r()}catch(n){Ka(e,t,n)}}var WK=!1;function JEe(e,t){if(E4=I3,e=UJ(),yU(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var o=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var a=0,s=-1,l=-1,u=0,c=0,m=e,d=null;t:for(;;){for(var p;m!==r||o!==0&&m.nodeType!==3||(s=a+o),m!==i||n!==0&&m.nodeType!==3||(l=a+n),m.nodeType===3&&(a+=m.nodeValue.length),(p=m.firstChild)!==null;)d=m,m=p;for(;;){if(m===e)break t;if(d===r&&++u===o&&(s=a),d===i&&++c===n&&(l=a),(p=m.nextSibling)!==null)break;m=d,d=m.parentNode}m=p}r=s===-1||l===-1?null:{start:s,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(M4={focusedElem:e,selectionRange:r},I3=!1,_r=t;_r!==null;)if(t=_r,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,_r=e;else for(;_r!==null;){t=_r;try{var h=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(h!==null){var f=h.memoizedProps,y=h.memoizedState,g=t.stateNode,x=g.getSnapshotBeforeUpdate(t.elementType===t.type?f:Np(t.type,f),y);g.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var S=t.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Yt(163))}}catch(I){Ka(t,t.return,I)}if(e=t.sibling,e!==null){e.return=t.return,_r=e;break}_r=t.return}return h=WK,WK=!1,h}function uP(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&Z4(t,r,i)}o=o.next}while(o!==n)}}function Y3(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function q4(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function F$(e){var t=e.alternate;t!==null&&(e.alternate=null,F$(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Xf],delete t[vP],delete t[L4],delete t[kEe],delete t[LEe])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function V$(e){return e.tag===5||e.tag===3||e.tag===4}function XK(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||V$(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Y4(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=P3));else if(n!==4&&(e=e.child,e!==null))for(Y4(e,t,r),e=e.sibling;e!==null;)Y4(e,t,r),e=e.sibling}function K4(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(K4(e,t,r),e=e.sibling;e!==null;)K4(e,t,r),e=e.sibling}var ru=null,zp=!1;function lb(e,t,r){for(r=r.child;r!==null;)O$(e,t,r),r=r.sibling}function O$(e,t,r){if(Qf&&typeof Qf.onCommitFiberUnmount=="function")try{Qf.onCommitFiberUnmount(z3,r)}catch{}switch(r.tag){case 5:Pu||v1(r,t);case 6:var n=ru,o=zp;ru=null,lb(e,t,r),ru=n,zp=o,ru!==null&&(zp?(e=ru,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):ru.removeChild(r.stateNode));break;case 18:ru!==null&&(zp?(e=ru,r=r.stateNode,e.nodeType===8?e4(e.parentNode,r):e.nodeType===1&&e4(e,r),yP(e)):e4(ru,r.stateNode));break;case 4:n=ru,o=zp,ru=r.stateNode.containerInfo,zp=!0,lb(e,t,r),ru=n,zp=o;break;case 0:case 11:case 14:case 15:if(!Pu&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){o=n=n.next;do{var i=o,a=i.destroy;i=i.tag,a!==void 0&&((i&2)!==0||(i&4)!==0)&&Z4(r,t,a),o=o.next}while(o!==n)}lb(e,t,r);break;case 1:if(!Pu&&(v1(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){Ka(r,t,s)}lb(e,t,r);break;case 21:lb(e,t,r);break;case 22:r.mode&1?(Pu=(n=Pu)||r.memoizedState!==null,lb(e,t,r),Pu=n):lb(e,t,r);break;default:lb(e,t,r)}}function QK(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new KEe),t.forEach(function(n){var o=sMe.bind(null,e,n);r.has(n)||(r.add(n),n.then(o,o))})}}function Up(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var o=r[n];try{var i=e,a=t,s=a;e:for(;s!==null;){switch(s.tag){case 5:ru=s.stateNode,zp=!1;break e;case 3:ru=s.stateNode.containerInfo,zp=!0;break e;case 4:ru=s.stateNode.containerInfo,zp=!0;break e}s=s.return}if(ru===null)throw Error(Yt(160));O$(i,a,o),ru=null,zp=!1;var l=o.alternate;l!==null&&(l.return=null),o.return=null}catch(u){Ka(o,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)G$(t,e),t=t.sibling}function G$(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Up(t,e),jf(e),n&4){try{uP(3,e,e.return),Y3(3,e)}catch(f){Ka(e,e.return,f)}try{uP(5,e,e.return)}catch(f){Ka(e,e.return,f)}}break;case 1:Up(t,e),jf(e),n&512&&r!==null&&v1(r,r.return);break;case 5:if(Up(t,e),jf(e),n&512&&r!==null&&v1(r,r.return),e.flags&32){var o=e.stateNode;try{pP(o,"")}catch(f){Ka(e,e.return,f)}}if(n&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,a=r!==null?r.memoizedProps:i,s=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{s==="input"&&i.type==="radio"&&i.name!=null&&sJ(o,i),S4(s,a);var u=S4(s,i);for(a=0;a<l.length;a+=2){var c=l[a],m=l[a+1];c==="style"?dJ(o,m):c==="dangerouslySetInnerHTML"?cJ(o,m):c==="children"?pP(o,m):oU(o,c,m,u)}switch(s){case"input":g4(o,i);break;case"textarea":lJ(o,i);break;case"select":var d=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?A1(o,!!i.multiple,p,!1):d!==!!i.multiple&&(i.defaultValue!=null?A1(o,!!i.multiple,i.defaultValue,!0):A1(o,!!i.multiple,i.multiple?[]:"",!1))}o[vP]=i}catch(f){Ka(e,e.return,f)}}break;case 6:if(Up(t,e),jf(e),n&4){if(e.stateNode===null)throw Error(Yt(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(f){Ka(e,e.return,f)}}break;case 3:if(Up(t,e),jf(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{yP(t.containerInfo)}catch(f){Ka(e,e.return,f)}break;case 4:Up(t,e),jf(e);break;case 13:Up(t,e),jf(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(VU=xs())),n&4&&QK(e);break;case 22:if(c=r!==null&&r.memoizedState!==null,e.mode&1?(Pu=(u=Pu)||c,Up(t,e),Pu=u):Up(t,e),jf(e),n&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!c&&(e.mode&1)!==0)for(_r=e,c=e.child;c!==null;){for(m=_r=c;_r!==null;){switch(d=_r,p=d.child,d.tag){case 0:case 11:case 14:case 15:uP(4,d,d.return);break;case 1:v1(d,d.return);var h=d.stateNode;if(typeof h.componentWillUnmount=="function"){n=d,r=d.return;try{t=n,h.props=t.memoizedProps,h.state=t.memoizedState,h.componentWillUnmount()}catch(f){Ka(n,r,f)}}break;case 5:v1(d,d.return);break;case 22:if(d.memoizedState!==null){qK(m);continue}}p!==null?(p.return=d,_r=p):qK(m)}c=c.sibling}e:for(c=null,m=e;;){if(m.tag===5){if(c===null){c=m;try{o=m.stateNode,u?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(s=m.stateNode,l=m.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,s.style.display=mJ("display",a))}catch(f){Ka(e,e.return,f)}}}else if(m.tag===6){if(c===null)try{m.stateNode.nodeValue=u?"":m.memoizedProps}catch(f){Ka(e,e.return,f)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===e)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===e)break e;for(;m.sibling===null;){if(m.return===null||m.return===e)break e;c===m&&(c=null),m=m.return}c===m&&(c=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:Up(t,e),jf(e),n&4&&QK(e);break;case 21:break;default:Up(t,e),jf(e)}}function jf(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(V$(r)){var n=r;break e}r=r.return}throw Error(Yt(160))}switch(n.tag){case 5:var o=n.stateNode;n.flags&32&&(pP(o,""),n.flags&=-33);var i=XK(e);K4(e,i,o);break;case 3:case 4:var a=n.stateNode.containerInfo,s=XK(e);Y4(e,s,a);break;default:throw Error(Yt(161))}}catch(l){Ka(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function $Ee(e,t,r){_r=e,U$(e,t,r)}function U$(e,t,r){for(var n=(e.mode&1)!==0;_r!==null;){var o=_r,i=o.child;if(o.tag===22&&n){var a=o.memoizedState!==null||a3;if(!a){var s=o.alternate,l=s!==null&&s.memoizedState!==null||Pu;s=a3;var u=Pu;if(a3=a,(Pu=l)&&!u)for(_r=o;_r!==null;)a=_r,l=a.child,a.tag===22&&a.memoizedState!==null?YK(o):l!==null?(l.return=a,_r=l):YK(o);for(;i!==null;)_r=i,U$(i,t,r),i=i.sibling;_r=o,a3=s,Pu=u}ZK(e,t,r)}else(o.subtreeFlags&8772)!==0&&i!==null?(i.return=o,_r=i):ZK(e,t,r)}}function ZK(e){for(;_r!==null;){var t=_r;if((t.flags&8772)!==0){var r=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:Pu||Y3(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Pu)if(r===null)n.componentDidMount();else{var o=t.elementType===t.type?r.memoizedProps:Np(t.type,r.memoizedProps);n.componentDidUpdate(o,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&MK(t,i,n);break;case 3:var a=t.updateQueue;if(a!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}MK(t,a,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var m=c.dehydrated;m!==null&&yP(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Yt(163))}Pu||t.flags&512&&q4(t)}catch(d){Ka(t,t.return,d)}}if(t===e){_r=null;break}if(r=t.sibling,r!==null){r.return=t.return,_r=r;break}_r=t.return}}function qK(e){for(;_r!==null;){var t=_r;if(t===e){_r=null;break}var r=t.sibling;if(r!==null){r.return=t.return,_r=r;break}_r=t.return}}function YK(e){for(;_r!==null;){var t=_r;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{Y3(4,t)}catch(l){Ka(t,r,l)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var o=t.return;try{n.componentDidMount()}catch(l){Ka(t,o,l)}}var i=t.return;try{q4(t)}catch(l){Ka(t,i,l)}break;case 5:var a=t.return;try{q4(t)}catch(l){Ka(t,a,l)}}}catch(l){Ka(t,t.return,l)}if(t===e){_r=null;break}var s=t.sibling;if(s!==null){s.return=t.return,_r=s;break}_r=t.return}}var eMe=Math.ceil,V3=Og.ReactCurrentDispatcher,LU=Og.ReactCurrentOwner,Ed=Og.ReactCurrentBatchConfig,Uo=0,bl=null,ks=null,nu=0,Dm=0,I1=Pb(0),al=0,RP=null,XC=0,K3=0,FU=0,cP=null,Wc=null,VU=0,F1=1/0,Dg=null,O3=!1,J4=null,Cb=null,s3=!1,fb=null,G3=0,mP=0,$4=null,h3=-1,g3=0;function lc(){return(Uo&6)!==0?xs():h3!==-1?h3:h3=xs()}function Sb(e){return(e.mode&1)===0?1:(Uo&2)!==0&&nu!==0?nu&-nu:VEe.transition!==null?(g3===0&&(g3=AJ()),g3):(e=yi,e!==0||(e=window.event,e=e===void 0?16:EJ(e.type)),e)}function Wp(e,t,r,n){if(50<mP)throw mP=0,$4=null,Error(Yt(185));DP(e,r,n),((Uo&2)===0||e!==bl)&&(e===bl&&((Uo&2)===0&&(K3|=r),al===4&&db(e,nu)),qc(e,n),r===1&&Uo===0&&(t.mode&1)===0&&(F1=xs()+500,Q3&&_b()))}function qc(e,t){var r=e.callbackNode;Gwe(e,t);var n=v3(e,e===bl?nu:0);if(n===0)r!==null&&oK(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&oK(r),t===1)e.tag===0?FEe(KK.bind(null,e)):YJ(KK.bind(null,e)),MEe(function(){(Uo&6)===0&&_b()}),r=null;else{switch(TJ(n)){case 1:r=uU;break;case 4:r=vJ;break;case 16:r=S3;break;case 536870912:r=IJ;break;default:r=S3}r=Z$(r,N$.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function N$(e,t){if(h3=-1,g3=0,(Uo&6)!==0)throw Error(Yt(327));var r=e.callbackNode;if(D1()&&e.callbackNode!==r)return null;var n=v3(e,e===bl?nu:0);if(n===0)return null;if((n&30)!==0||(n&e.expiredLanes)!==0||t)t=U3(e,n);else{t=n;var o=Uo;Uo|=2;var i=H$();(bl!==e||nu!==t)&&(Dg=null,F1=xs()+500,NC(e,t));do try{nMe();break}catch(s){z$(e,s)}while(!0);vU(),V3.current=i,Uo=o,ks!==null?t=0:(bl=null,nu=0,t=al)}if(t!==0){if(t===2&&(o=P4(e),o!==0&&(n=o,t=eU(e,o))),t===1)throw r=RP,NC(e,0),db(e,n),qc(e,xs()),r;if(t===6)db(e,n);else{if(o=e.current.alternate,(n&30)===0&&!tMe(o)&&(t=U3(e,n),t===2&&(i=P4(e),i!==0&&(n=i,t=eU(e,i))),t===1))throw r=RP,NC(e,0),db(e,n),qc(e,xs()),r;switch(e.finishedWork=o,e.finishedLanes=n,t){case 0:case 1:throw Error(Yt(345));case 2:VC(e,Wc,Dg);break;case 3:if(db(e,n),(n&130023424)===n&&(t=VU+500-xs(),10<t)){if(v3(e,0)!==0)break;if(o=e.suspendedLanes,(o&n)!==n){lc(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=k4(VC.bind(null,e,Wc,Dg),t);break}VC(e,Wc,Dg);break;case 4:if(db(e,n),(n&4194240)===n)break;for(t=e.eventTimes,o=-1;0<n;){var a=31-jp(n);i=1<<a,a=t[a],a>o&&(o=a),n&=~i}if(n=o,n=xs()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*eMe(n/1960))-n,10<n){e.timeoutHandle=k4(VC.bind(null,e,Wc,Dg),n);break}VC(e,Wc,Dg);break;case 5:VC(e,Wc,Dg);break;default:throw Error(Yt(329))}}}return qc(e,xs()),e.callbackNode===r?N$.bind(null,e):null}function eU(e,t){var r=cP;return e.current.memoizedState.isDehydrated&&(NC(e,t).flags|=256),e=U3(e,t),e!==2&&(t=Wc,Wc=r,t!==null&&tU(t)),e}function tU(e){Wc===null?Wc=e:Wc.push.apply(Wc,e)}function tMe(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var o=r[n],i=o.getSnapshot;o=o.value;try{if(!Xp(i(),o))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function db(e,t){for(t&=~FU,t&=~K3,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-jp(t),n=1<<r;e[r]=-1,t&=~n}}function KK(e){if((Uo&6)!==0)throw Error(Yt(327));D1();var t=v3(e,0);if((t&1)===0)return qc(e,xs()),null;var r=U3(e,t);if(e.tag!==0&&r===2){var n=P4(e);n!==0&&(t=n,r=eU(e,n))}if(r===1)throw r=RP,NC(e,0),db(e,t),qc(e,xs()),r;if(r===6)throw Error(Yt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,VC(e,Wc,Dg),qc(e,xs()),null}function OU(e,t){var r=Uo;Uo|=1;try{return e(t)}finally{Uo=r,Uo===0&&(F1=xs()+500,Q3&&_b())}}function QC(e){fb!==null&&fb.tag===0&&(Uo&6)===0&&D1();var t=Uo;Uo|=1;var r=Ed.transition,n=yi;try{if(Ed.transition=null,yi=1,e)return e()}finally{yi=n,Ed.transition=r,Uo=t,(Uo&6)===0&&_b()}}function GU(){Dm=I1.current,ea(I1)}function NC(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,EEe(r)),ks!==null)for(r=ks.return;r!==null;){var n=r;switch(xU(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&_3();break;case 3:k1(),ea(Qc),ea(_u),RU();break;case 5:_U(n);break;case 4:k1();break;case 13:ea(Ra);break;case 19:ea(Ra);break;case 10:IU(n.type._context);break;case 22:case 23:GU()}r=r.return}if(bl=e,ks=e=vb(e.current,null),nu=Dm=t,al=0,RP=null,FU=K3=XC=0,Wc=cP=null,GC!==null){for(t=0;t<GC.length;t++)if(r=GC[t],n=r.interleaved,n!==null){r.interleaved=null;var o=n.next,i=r.pending;if(i!==null){var a=i.next;i.next=o,n.next=a}r.pending=n}GC=null}return e}function z$(e,t){do{var r=ks;try{if(vU(),d3.current=F3,L3){for(var n=Da.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}L3=!1}if(WC=0,yl=il=Da=null,lP=!1,TP=0,LU.current=null,r===null||r.return===null){al=1,RP=t,ks=null;break}e:{var i=e,a=r.return,s=r,l=t;if(t=nu,s.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=s,m=c.tag;if((c.mode&1)===0&&(m===0||m===11||m===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var p=OK(a);if(p!==null){p.flags&=-257,GK(p,a,s,i,t),p.mode&1&&VK(i,u,t),t=p,l=u;var h=t.updateQueue;if(h===null){var f=new Set;f.add(l),t.updateQueue=f}else h.add(l);break e}else{if((t&1)===0){VK(i,u,t),UU();break e}l=Error(Yt(426))}}else if(ca&&s.mode&1){var y=OK(a);if(y!==null){(y.flags&65536)===0&&(y.flags|=256),GK(y,a,s,i,t),CU(L1(l,s));break e}}i=l=L1(l,s),al!==4&&(al=2),cP===null?cP=[i]:cP.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var g=T$(i,l,t);EK(i,g);break e;case 1:s=l;var x=i.type,S=i.stateNode;if((i.flags&128)===0&&(typeof x.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Cb===null||!Cb.has(S)))){i.flags|=65536,t&=-t,i.lanes|=t;var I=P$(i,s,t);EK(i,I);break e}}i=i.return}while(i!==null)}W$(r)}catch(v){t=v,ks===r&&r!==null&&(ks=r=r.return);continue}break}while(!0)}function H$(){var e=V3.current;return V3.current=F3,e===null?F3:e}function UU(){(al===0||al===3||al===2)&&(al=4),bl===null||(XC&268435455)===0&&(K3&268435455)===0||db(bl,nu)}function U3(e,t){var r=Uo;Uo|=2;var n=H$();(bl!==e||nu!==t)&&(Dg=null,NC(e,t));do try{rMe();break}catch(o){z$(e,o)}while(!0);if(vU(),Uo=r,V3.current=n,ks!==null)throw Error(Yt(261));return bl=null,nu=0,al}function rMe(){for(;ks!==null;)j$(ks)}function nMe(){for(;ks!==null&&!wwe();)j$(ks)}function j$(e){var t=Q$(e.alternate,e,Dm);e.memoizedProps=e.pendingProps,t===null?W$(e):ks=t,LU.current=null}function W$(e){var t=e;do{var r=t.alternate;if(e=t.return,(t.flags&32768)===0){if(r=qEe(r,t,Dm),r!==null){ks=r;return}}else{if(r=YEe(r,t),r!==null){r.flags&=32767,ks=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{al=6,ks=null;return}}if(t=t.sibling,t!==null){ks=t;return}ks=t=e}while(t!==null);al===0&&(al=5)}function VC(e,t,r){var n=yi,o=Ed.transition;try{Ed.transition=null,yi=1,oMe(e,t,r,n)}finally{Ed.transition=o,yi=n}return null}function oMe(e,t,r,n){do D1();while(fb!==null);if((Uo&6)!==0)throw Error(Yt(327));r=e.finishedWork;var o=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Yt(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(Uwe(e,i),e===bl&&(ks=bl=null,nu=0),(r.subtreeFlags&2064)===0&&(r.flags&2064)===0||s3||(s3=!0,Z$(S3,function(){return D1(),null})),i=(r.flags&15990)!==0,(r.subtreeFlags&15990)!==0||i){i=Ed.transition,Ed.transition=null;var a=yi;yi=1;var s=Uo;Uo|=4,LU.current=null,JEe(e,r),G$(r,e),PEe(M4),I3=!!E4,M4=E4=null,e.current=r,$Ee(r,e,o),Ewe(),Uo=s,yi=a,Ed.transition=i}else e.current=r;if(s3&&(s3=!1,fb=e,G3=o),i=e.pendingLanes,i===0&&(Cb=null),kwe(r.stateNode,n),qc(e,xs()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)o=t[r],n(o.value,{componentStack:o.stack,digest:o.digest});if(O3)throw O3=!1,e=J4,J4=null,e;return(G3&1)!==0&&e.tag!==0&&D1(),i=e.pendingLanes,(i&1)!==0?e===$4?mP++:(mP=0,$4=e):mP=0,_b(),null}function D1(){if(fb!==null){var e=TJ(G3),t=Ed.transition,r=yi;try{if(Ed.transition=null,yi=16>e?16:e,fb===null)var n=!1;else{if(e=fb,fb=null,G3=0,(Uo&6)!==0)throw Error(Yt(331));var o=Uo;for(Uo|=4,_r=e.current;_r!==null;){var i=_r,a=i.child;if((_r.flags&16)!==0){var s=i.deletions;if(s!==null){for(var l=0;l<s.length;l++){var u=s[l];for(_r=u;_r!==null;){var c=_r;switch(c.tag){case 0:case 11:case 15:uP(8,c,i)}var m=c.child;if(m!==null)m.return=c,_r=m;else for(;_r!==null;){c=_r;var d=c.sibling,p=c.return;if(F$(c),c===u){_r=null;break}if(d!==null){d.return=p,_r=d;break}_r=p}}}var h=i.alternate;if(h!==null){var f=h.child;if(f!==null){h.child=null;do{var y=f.sibling;f.sibling=null,f=y}while(f!==null)}}_r=i}}if((i.subtreeFlags&2064)!==0&&a!==null)a.return=i,_r=a;else e:for(;_r!==null;){if(i=_r,(i.flags&2048)!==0)switch(i.tag){case 0:case 11:case 15:uP(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,_r=g;break e}_r=i.return}}var x=e.current;for(_r=x;_r!==null;){a=_r;var S=a.child;if((a.subtreeFlags&2064)!==0&&S!==null)S.return=a,_r=S;else e:for(a=x;_r!==null;){if(s=_r,(s.flags&2048)!==0)try{switch(s.tag){case 0:case 11:case 15:Y3(9,s)}}catch(v){Ka(s,s.return,v)}if(s===a){_r=null;break e}var I=s.sibling;if(I!==null){I.return=s.return,_r=I;break e}_r=s.return}}if(Uo=o,_b(),Qf&&typeof Qf.onPostCommitFiberRoot=="function")try{Qf.onPostCommitFiberRoot(z3,e)}catch{}n=!0}return n}finally{yi=r,Ed.transition=t}}return!1}function JK(e,t,r){t=L1(r,t),t=T$(e,t,1),e=xb(e,t,1),t=lc(),e!==null&&(DP(e,1,t),qc(e,t))}function Ka(e,t,r){if(e.tag===3)JK(e,e,r);else for(;t!==null;){if(t.tag===3){JK(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Cb===null||!Cb.has(n))){e=L1(r,e),e=P$(t,e,1),t=xb(t,e,1),e=lc(),t!==null&&(DP(t,1,e),qc(t,e));break}}t=t.return}}function iMe(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=lc(),e.pingedLanes|=e.suspendedLanes&r,bl===e&&(nu&r)===r&&(al===4||al===3&&(nu&130023424)===nu&&500>xs()-VU?NC(e,0):FU|=r),qc(e,t)}function X$(e,t){t===0&&((e.mode&1)===0?t=1:(t=QD,QD<<=1,(QD&130023424)===0&&(QD=4194304)));var r=lc();e=Fg(e,t),e!==null&&(DP(e,t,r),qc(e,r))}function aMe(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),X$(e,r)}function sMe(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,o=e.memoizedState;o!==null&&(r=o.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Yt(314))}n!==null&&n.delete(t),X$(e,r)}var Q$;Q$=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Qc.current)Xc=!0;else{if((e.lanes&r)===0&&(t.flags&128)===0)return Xc=!1,ZEe(e,t,r);Xc=(e.flags&131072)!==0}else Xc=!1,ca&&(t.flags&1048576)!==0&&KJ(t,w3,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;f3(e,t),e=t.pendingProps;var o=E1(t,_u.current);R1(t,r),o=wU(null,t,n,e,o,r);var i=EU();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Zc(n)?(i=!0,R3(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,TU(t),o.updater=q3,t.stateNode=o,o._reactInternals=t,N4(t,n,e,r),t=j4(null,t,n,!0,i,r)):(t.tag=0,ca&&i&&bU(t),sc(null,t,o,r),t=t.child),t;case 16:n=t.elementType;e:{switch(f3(e,t),e=t.pendingProps,o=n._init,n=o(n._payload),t.type=n,o=t.tag=uMe(n),e=Np(n,e),o){case 0:t=H4(null,t,n,e,r);break e;case 1:t=zK(null,t,n,e,r);break e;case 11:t=UK(null,t,n,e,r);break e;case 14:t=NK(null,t,n,Np(n.type,e),r);break e}throw Error(Yt(306,n,""))}return t;case 0:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:Np(n,o),H4(e,t,n,o,r);case 1:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:Np(n,o),zK(e,t,n,o,r);case 3:e:{if(w$(t),e===null)throw Error(Yt(387));n=t.pendingProps,i=t.memoizedState,o=i.element,n$(e,t),B3(t,n,null,r);var a=t.memoizedState;if(n=a.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=L1(Error(Yt(423)),t),t=HK(e,t,n,r,o);break e}else if(n!==o){o=L1(Error(Yt(424)),t),t=HK(e,t,n,r,o);break e}else for(wm=bb(t.stateNode.containerInfo.firstChild),Em=t,ca=!0,Hp=null,r=t$(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(M1(),n===o){t=Vg(e,t,r);break e}sc(e,t,n,r)}t=t.child}return t;case 5:return o$(t),e===null&&O4(t),n=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,a=o.children,B4(n,o)?a=null:i!==null&&B4(n,i)&&(t.flags|=32),D$(e,t),sc(e,t,a,r),t.child;case 6:return e===null&&O4(t),null;case 13:return E$(e,t,r);case 4:return PU(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=B1(t,null,n,r):sc(e,t,n,r),t.child;case 11:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:Np(n,o),UK(e,t,n,o,r);case 7:return sc(e,t,t.pendingProps,r),t.child;case 8:return sc(e,t,t.pendingProps.children,r),t.child;case 12:return sc(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,o=t.pendingProps,i=t.memoizedProps,a=o.value,ji(E3,n._currentValue),n._currentValue=a,i!==null)if(Xp(i.value,a)){if(i.children===o.children&&!Qc.current){t=Vg(e,t,r);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var s=i.dependencies;if(s!==null){a=i.child;for(var l=s.firstContext;l!==null;){if(l.context===n){if(i.tag===1){l=Bg(-1,r&-r),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=r,l=i.alternate,l!==null&&(l.lanes|=r),G4(i.return,r,t),s.lanes|=r;break}l=l.next}}else if(i.tag===10)a=i.type===t.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(Yt(341));a.lanes|=r,s=a.alternate,s!==null&&(s.lanes|=r),G4(a,r,t),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}sc(e,t,o.children,r),t=t.child}return t;case 9:return o=t.type,n=t.pendingProps.children,R1(t,r),o=Md(o),n=n(o),t.flags|=1,sc(e,t,n,r),t.child;case 14:return n=t.type,o=Np(n,t.pendingProps),o=Np(n.type,o),NK(e,t,n,o,r);case 15:return _$(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:Np(n,o),f3(e,t),t.tag=1,Zc(n)?(e=!0,R3(t)):e=!1,R1(t,r),A$(t,n,o),N4(t,n,o,r),j4(null,t,n,!0,e,r);case 19:return M$(e,t,r);case 22:return R$(e,t,r)}throw Error(Yt(156,t.tag))};function Z$(e,t){return SJ(e,t)}function lMe(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wd(e,t,r,n){return new lMe(e,t,r,n)}function NU(e){return e=e.prototype,!(!e||!e.isReactComponent)}function uMe(e){if(typeof e=="function")return NU(e)?1:0;if(e!=null){if(e=e.$$typeof,e===aU)return 11;if(e===sU)return 14}return 2}function vb(e,t){var r=e.alternate;return r===null?(r=wd(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function y3(e,t,r,n,o,i){var a=2;if(n=e,typeof e=="function")NU(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case p1:return zC(r.children,o,i,t);case iU:a=8,o|=8;break;case m4:return e=wd(12,r,t,o|2),e.elementType=m4,e.lanes=i,e;case d4:return e=wd(13,r,t,o),e.elementType=d4,e.lanes=i,e;case p4:return e=wd(19,r,t,o),e.elementType=p4,e.lanes=i,e;case oJ:return J3(r,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case rJ:a=10;break e;case nJ:a=9;break e;case aU:a=11;break e;case sU:a=14;break e;case ub:a=16,n=null;break e}throw Error(Yt(130,e==null?e:typeof e,""))}return t=wd(a,r,t,o),t.elementType=e,t.type=n,t.lanes=i,t}function zC(e,t,r,n){return e=wd(7,e,n,t),e.lanes=r,e}function J3(e,t,r,n){return e=wd(22,e,n,t),e.elementType=oJ,e.lanes=r,e.stateNode={isHidden:!1},e}function l4(e,t,r){return e=wd(6,e,null,t),e.lanes=r,e}function u4(e,t,r){return t=wd(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function cMe(e,t,r,n,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=XG(0),this.expirationTimes=XG(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=XG(0),this.identifierPrefix=n,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function zU(e,t,r,n,o,i,a,s,l){return e=new cMe(e,t,r,s,l),t===1?(t=1,i===!0&&(t|=8)):t=0,i=wd(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},TU(i),e}function mMe(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:d1,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function q$(e){if(!e)return Ab;e=e._reactInternals;e:{if(qC(e)!==e||e.tag!==1)throw Error(Yt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Zc(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Yt(171))}if(e.tag===1){var r=e.type;if(Zc(r))return qJ(e,r,t)}return t}function Y$(e,t,r,n,o,i,a,s,l){return e=zU(r,n,!0,e,o,i,a,s,l),e.context=q$(null),r=e.current,n=lc(),o=Sb(r),i=Bg(n,o),i.callback=t??null,xb(r,i,o),e.current.lanes=o,DP(e,o,n),qc(e,n),e}function $3(e,t,r,n){var o=t.current,i=lc(),a=Sb(o);return r=q$(r),t.context===null?t.context=r:t.pendingContext=r,t=Bg(i,a),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=xb(o,t,a),e!==null&&(Wp(e,o,a,i),m3(e,o,a)),a}function N3(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function $K(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function HU(e,t){$K(e,t),(e=e.alternate)&&$K(e,t)}function dMe(){return null}var K$=typeof reportError=="function"?reportError:function(e){console.error(e)};function jU(e){this._internalRoot=e}ew.prototype.render=jU.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Yt(409));$3(e,t,null,null)};ew.prototype.unmount=jU.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;QC(function(){$3(null,e,null,null)}),t[Lg]=null}};function ew(e){this._internalRoot=e}ew.prototype.unstable_scheduleHydration=function(e){if(e){var t=RJ();e={blockedOn:null,target:e,priority:t};for(var r=0;r<mb.length&&t!==0&&t<mb[r].priority;r++);mb.splice(r,0,e),r===0&&wJ(e)}};function WU(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function tw(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function eJ(){}function pMe(e,t,r,n,o){if(o){if(typeof n=="function"){var i=n;n=function(){var u=N3(a);i.call(u)}}var a=Y$(t,n,e,0,null,!1,!1,"",eJ);return e._reactRootContainer=a,e[Lg]=a.current,CP(e.nodeType===8?e.parentNode:e),QC(),a}for(;o=e.lastChild;)e.removeChild(o);if(typeof n=="function"){var s=n;n=function(){var u=N3(l);s.call(u)}}var l=zU(e,0,!1,null,null,!1,!1,"",eJ);return e._reactRootContainer=l,e[Lg]=l.current,CP(e.nodeType===8?e.parentNode:e),QC(function(){$3(t,l,r,n)}),l}function rw(e,t,r,n,o){var i=r._reactRootContainer;if(i){var a=i;if(typeof o=="function"){var s=o;o=function(){var l=N3(a);s.call(l)}}$3(t,a,e,o)}else a=pMe(r,t,e,o,n);return N3(a)}PJ=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=tP(t.pendingLanes);r!==0&&(cU(t,r|1),qc(t,xs()),(Uo&6)===0&&(F1=xs()+500,_b()))}break;case 13:QC(function(){var n=Fg(e,1);if(n!==null){var o=lc();Wp(n,e,1,o)}}),HU(e,1)}};mU=function(e){if(e.tag===13){var t=Fg(e,134217728);if(t!==null){var r=lc();Wp(t,e,134217728,r)}HU(e,134217728)}};_J=function(e){if(e.tag===13){var t=Sb(e),r=Fg(e,t);if(r!==null){var n=lc();Wp(r,e,t,n)}HU(e,t)}};RJ=function(){return yi};DJ=function(e,t){var r=yi;try{return yi=e,t()}finally{yi=r}};I4=function(e,t,r){switch(t){case"input":if(g4(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var o=X3(n);if(!o)throw Error(Yt(90));aJ(n),g4(n,o)}}}break;case"textarea":lJ(e,r);break;case"select":t=r.value,t!=null&&A1(e,!!r.multiple,t,!1)}};hJ=OU;gJ=QC;var fMe={usingClientEntryPoint:!1,Events:[EP,y1,X3,pJ,fJ,OU]},KT={findFiberByHostInstance:OC,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},hMe={bundleType:KT.bundleType,version:KT.version,rendererPackageName:KT.rendererPackageName,rendererConfig:KT.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Og.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=xJ(e),e===null?null:e.stateNode},findFiberByHostInstance:KT.findFiberByHostInstance||dMe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(JT=__REACT_DEVTOOLS_GLOBAL_HOOK__,!JT.isDisabled&&JT.supportsFiber))try{z3=JT.inject(hMe),Qf=JT}catch{}var JT;km.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fMe;km.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!WU(t))throw Error(Yt(200));return mMe(e,t,null,r)};km.createRoot=function(e,t){if(!WU(e))throw Error(Yt(299));var r=!1,n="",o=K$;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=zU(e,1,!1,null,null,r,!1,n,o),e[Lg]=t.current,CP(e.nodeType===8?e.parentNode:e),new jU(t)};km.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Yt(188)):(e=Object.keys(e).join(","),Error(Yt(268,e)));return e=xJ(t),e=e===null?null:e.stateNode,e};km.flushSync=function(e){return QC(e)};km.hydrate=function(e,t,r){if(!tw(t))throw Error(Yt(200));return rw(null,e,t,!0,r)};km.hydrateRoot=function(e,t,r){if(!WU(e))throw Error(Yt(405));var n=r!=null&&r.hydratedSources||null,o=!1,i="",a=K$;if(r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(a=r.onRecoverableError)),t=Y$(t,null,e,1,r??null,o,!1,i,a),e[Lg]=t.current,CP(e),n)for(e=0;e<n.length;e++)r=n[e],o=r._getVersion,o=o(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,o]:t.mutableSourceEagerHydrationData.push(r,o);return new ew(t)};km.render=function(e,t,r){if(!tw(t))throw Error(Yt(200));return rw(null,e,t,!1,r)};km.unmountComponentAtNode=function(e){if(!tw(e))throw Error(Yt(40));return e._reactRootContainer?(QC(function(){rw(null,null,e,!1,function(){e._reactRootContainer=null,e[Lg]=null})}),!0):!1};km.unstable_batchedUpdates=OU;km.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!tw(r))throw Error(Yt(200));if(e==null||e._reactInternals===void 0)throw Error(Yt(38));return rw(e,t,r,!1,n)};km.version="18.3.1-next-f1338f8080-20240426"});var tee=Ad((gSt,eee)=>{"use strict";function $$(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE($$)}catch(e){console.error(e)}}$$(),eee.exports=J$()});var QU=Ad(XU=>{"use strict";var ree=tee();XU.createRoot=ree.createRoot,XU.hydrateRoot=ree.hydrateRoot;var ySt});var Ote=Ad(Aw=>{"use strict";var cBe=Pi(),mBe=Symbol.for("react.element"),dBe=Symbol.for("react.fragment"),pBe=Object.prototype.hasOwnProperty,fBe=cBe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hBe={key:!0,ref:!0,__self:!0,__source:!0};function Vte(e,t,r){var n,o={},i=null,a=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(n in t)pBe.call(t,n)&&!hBe.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)o[n]===void 0&&(o[n]=t[n]);return{$$typeof:mBe,type:e,key:i,ref:a,props:o,_owner:fBe.current}}Aw.Fragment=dBe;Aw.jsx=Vte;Aw.jsxs=Vte});var nr=Ad((eIt,Gte)=>{"use strict";Gte.exports=Ote()});var Ire=Ad((sAt,vre)=>{"use strict";var bre=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,kke=/\n/g,Lke=/^\s*/,Fke=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,Vke=/^:\s*/,Oke=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,Gke=/^[;\s]*/,Uke=/^\s+|\s+$/g,Nke=`
`,xre="/",Cre="*",u0="",zke="comment",Hke="declaration";vre.exports=function(e,t){if(typeof e!="string")throw new TypeError("First argument must be a string");if(!e)return[];t=t||{};var r=1,n=1;function o(f){var y=f.match(kke);y&&(r+=y.length);var g=f.lastIndexOf(Nke);n=~g?f.length-g:n+f.length}function i(){var f={line:r,column:n};return function(y){return y.position=new a(f),c(),y}}function a(f){this.start=f,this.end={line:r,column:n},this.source=t.source}a.prototype.content=e;var s=[];function l(f){var y=new Error(t.source+":"+r+":"+n+": "+f);if(y.reason=f,y.filename=t.source,y.line=r,y.column=n,y.source=e,t.silent)s.push(y);else throw y}function u(f){var y=f.exec(e);if(y){var g=y[0];return o(g),e=e.slice(g.length),y}}function c(){u(Lke)}function m(f){var y;for(f=f||[];y=d();)y!==!1&&f.push(y);return f}function d(){var f=i();if(!(xre!=e.charAt(0)||Cre!=e.charAt(1))){for(var y=2;u0!=e.charAt(y)&&(Cre!=e.charAt(y)||xre!=e.charAt(y+1));)++y;if(y+=2,u0===e.charAt(y-1))return l("End of comment missing");var g=e.slice(2,y-2);return n+=2,o(g),e=e.slice(y),n+=2,f({type:zke,comment:g})}}function p(){var f=i(),y=u(Fke);if(y){if(d(),!u(Vke))return l("property missing ':'");var g=u(Oke),x=f({type:Hke,property:Sre(y[0].replace(bre,u0)),value:g?Sre(g[0].replace(bre,u0)):u0});return u(Gke),x}}function h(){var f=[];m(f);for(var y;y=p();)y!==!1&&(f.push(y),m(f));return f}return c(),h()};function Sre(e){return e?e.replace(Uke,u0):u0}});var Tre=Ad((lAt,FN)=>{"use strict";var jke=Ire();function Are(e,t){var r=null;if(!e||typeof e!="string")return r;for(var n,o=jke(e),i=typeof t=="function",a,s,l=0,u=o.length;l<u;l++)n=o[l],a=n.property,s=n.value,i?t(a,s,n):s&&(r||(r={}),r[a]=s);return r}FN.exports=Are;FN.exports.default=Are});var zne=Ad((ORt,Nne)=>{"use strict";var aE=Object.prototype.hasOwnProperty,Une=Object.prototype.toString,kne=Object.defineProperty,Lne=Object.getOwnPropertyDescriptor,Fne=function(t){return typeof Array.isArray=="function"?Array.isArray(t):Une.call(t)==="[object Array]"},Vne=function(t){if(!t||Une.call(t)!=="[object Object]")return!1;var r=aE.call(t,"constructor"),n=t.constructor&&t.constructor.prototype&&aE.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!r&&!n)return!1;var o;for(o in t);return typeof o>"u"||aE.call(t,o)},One=function(t,r){kne&&r.name==="__proto__"?kne(t,r.name,{enumerable:!0,configurable:!0,value:r.newValue,writable:!0}):t[r.name]=r.newValue},Gne=function(t,r){if(r==="__proto__")if(aE.call(t,r)){if(Lne)return Lne(t,r).value}else return;return t[r]};Nne.exports=function e(){var t,r,n,o,i,a,s=arguments[0],l=1,u=arguments.length,c=!1;for(typeof s=="boolean"&&(c=s,s=arguments[1]||{},l=2),(s==null||typeof s!="object"&&typeof s!="function")&&(s={});l<u;++l)if(t=arguments[l],t!=null)for(r in t)n=Gne(s,r),o=Gne(t,r),s!==o&&(c&&o&&(Vne(o)||(i=Fne(o)))?(i?(i=!1,a=n&&Fne(n)?n:[]):a=n&&Vne(n)?n:{},One(s,{name:r,newValue:e(c,a,o)})):typeof o<"u"&&One(s,{name:r,newValue:o}));return s}});var Uyt={};Bi(Uyt,{MVSData:()=>Cm,downloadCurrentStory:()=>Gyt,getContext:()=>mG,loadFromData:()=>Fyt,loadFromID:()=>Oyt,loadFromURL:()=>v3e});var pG=function(e,t){return pG=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},pG(e,t)};function xu(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");pG(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function Gq(e,t,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function s(c){try{u(n.next(c))}catch(m){a(m)}}function l(c){try{u(n.throw(c))}catch(m){a(m)}}function u(c){c.done?i(c.value):o(c.value).then(s,l)}u((n=n.apply(e,t||[])).next())})}function dD(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(r=0)),r;)try{if(n=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,o=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(c){u=[6,c],o=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Ig(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ag(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],a;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return i}function Tg(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function wC(e){return this instanceof wC?(this.v=e,this):new wC(e)}function Uq(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",a),o[Symbol.asyncIterator]=function(){return this},o;function a(p){return function(h){return Promise.resolve(h).then(p,m)}}function s(p,h){n[p]&&(o[p]=function(f){return new Promise(function(y,g){i.push([p,f,y,g])>1||l(p,f)})},h&&(o[p]=h(o[p])))}function l(p,h){try{u(n[p](h))}catch(f){d(i[0][3],f)}}function u(p){p.value instanceof wC?Promise.resolve(p.value.v).then(c,m):d(i[0][2],p)}function c(p){l("next",p)}function m(p){l("throw",p)}function d(p,h){p(h),i.shift(),i.length&&l(i[0][0],i[0][1])}}function Nq(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof Ig=="function"?Ig(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(a){return new Promise(function(s,l){a=e[i](a),o(s,l,a.done,a.value)})}}function o(i,a,s,l){Promise.resolve(l).then(function(u){i({value:u,done:s})},a)}}function Zo(e){return typeof e=="function"}function pD(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var fD=pD(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function EC(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Jy=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,o,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=Ig(a),l=s.next();!l.done;l=s.next()){var u=l.value;u.remove(this)}}catch(f){t={error:f}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}else a.remove(this);var c=this.initialTeardown;if(Zo(c))try{c()}catch(f){i=f instanceof fD?f.errors:[f]}var m=this._finalizers;if(m){this._finalizers=null;try{for(var d=Ig(m),p=d.next();!p.done;p=d.next()){var h=p.value;try{zq(h)}catch(f){i=i??[],f instanceof fD?i=Tg(Tg([],Ag(i)),Ag(f.errors)):i.push(f)}}}catch(f){n={error:f}}finally{try{p&&!p.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}}if(i)throw new fD(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)zq(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&EC(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&EC(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}();var fG=Jy.EMPTY;function hD(e){return e instanceof Jy||e&&"closed"in e&&Zo(e.remove)&&Zo(e.add)&&Zo(e.unsubscribe)}function zq(e){Zo(e)?e():e.unsubscribe()}var Op={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var r1={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=r1.delegate;return o?.setTimeout?o.setTimeout.apply(o,Tg([e,t],Ag(r))):setTimeout.apply(void 0,Tg([e,t],Ag(r)))},clearTimeout:function(e){var t=r1.delegate;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function gD(e){r1.setTimeout(function(){var t=Op.onUnhandledError;if(t)t(e);else throw e})}function hG(){}var Hq=function(){return gG("C",void 0,void 0)}();function jq(e){return gG("E",void 0,e)}function Wq(e){return gG("N",e,void 0)}function gG(e,t,r){return{kind:e,value:t,error:r}}var MC=null;function n1(e){if(Op.useDeprecatedSynchronousErrorHandling){var t=!MC;if(t&&(MC={errorThrown:!1,error:null}),e(),t){var r=MC,n=r.errorThrown,o=r.error;if(MC=null,n)throw o}}else e()}function Xq(e){Op.useDeprecatedSynchronousErrorHandling&&MC&&(MC.errorThrown=!0,MC.error=e)}var kT=function(e){xu(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,hD(r)&&r.add(n)):n.destination=B3e,n}return t.create=function(r,n,o){return new bD(r,n,o)},t.prototype.next=function(r){this.isStopped?bG(Wq(r),this):this._next(r)},t.prototype.error=function(r){this.isStopped?bG(jq(r),this):(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped?bG(Hq,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Jy);var w3e=Function.prototype.bind;function yG(e,t){return w3e.call(e,t)}var E3e=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){yD(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){yD(n)}else yD(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){yD(r)}},e}(),bD=function(e){xu(t,e);function t(r,n,o){var i=e.call(this)||this,a;if(Zo(r)||!r)a={next:r??void 0,error:n??void 0,complete:o??void 0};else{var s;i&&Op.useDeprecatedNextContext?(s=Object.create(r),s.unsubscribe=function(){return i.unsubscribe()},a={next:r.next&&yG(r.next,s),error:r.error&&yG(r.error,s),complete:r.complete&&yG(r.complete,s)}):a=r}return i.destination=new E3e(a),i}return t}(kT);function yD(e){Op.useDeprecatedSynchronousErrorHandling?Xq(e):gD(e)}function M3e(e){throw e}function bG(e,t){var r=Op.onStoppedNotification;r&&r1.setTimeout(function(){return r(e,t)})}var B3e={closed:!0,next:hG,error:M3e,complete:hG};var o1=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function i1(e){return e}function Qq(e){return e.length===0?i1:e.length===1?e[0]:function(r){return e.reduce(function(n,o){return o(n)},r)}}var Ms=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var o=this,i=L3e(t)?t:new bD(t,r,n);return n1(function(){var a=o,s=a.operator,l=a.source;i.add(s?s.call(i,l):l?o._subscribe(i):o._trySubscribe(i))}),i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=Zq(r),new r(function(o,i){var a=new bD({next:function(s){try{t(s)}catch(l){i(l),a.unsubscribe()}},error:i,complete:o});n.subscribe(a)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[o1]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Qq(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=Zq(t),new t(function(n,o){var i;r.subscribe(function(a){return i=a},function(a){return o(a)},function(){return n(i)})})},e.create=function(t){return new e(t)},e}();function Zq(e){var t;return(t=e??Op.Promise)!==null&&t!==void 0?t:Promise}function k3e(e){return e&&Zo(e.next)&&Zo(e.error)&&Zo(e.complete)}function L3e(e){return e&&e instanceof kT||k3e(e)&&hD(e)}function F3e(e){return Zo(e?.lift)}function hl(e){return function(t){if(F3e(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function gl(e,t,r,n,o){return new V3e(e,t,r,n,o)}var V3e=function(e){xu(t,e);function t(r,n,o,i,a,s){var l=e.call(this,r)||this;return l.onFinalize=a,l.shouldUnsubscribe=s,l._next=n?function(u){try{n(u)}catch(c){r.error(c)}}:e.prototype._next,l._error=i?function(u){try{i(u)}catch(c){r.error(c)}finally{this.unsubscribe()}}:e.prototype._error,l._complete=o?function(){try{o()}catch(u){r.error(u)}finally{this.unsubscribe()}}:e.prototype._complete,l}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t}(kT);var qq=pD(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var En=function(e){xu(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new Yq(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new qq},t.prototype.next=function(r){var n=this;n1(function(){var o,i;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var a=Ig(n.currentObservers),s=a.next();!s.done;s=a.next()){var l=s.value;l.next(r)}}catch(u){o={error:u}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}}})},t.prototype.error=function(r){var n=this;n1(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var o=n.observers;o.length;)o.shift().error(r)}})},t.prototype.complete=function(){var r=this;n1(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,o=this,i=o.hasError,a=o.isStopped,s=o.observers;return i||a?fG:(this.currentObservers=null,s.push(r),new Jy(function(){n.currentObservers=null,EC(s,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,o=n.hasError,i=n.thrownError,a=n.isStopped;o?r.error(i):a&&r.complete()},t.prototype.asObservable=function(){var r=new Ms;return r.source=this,r},t.create=function(r,n){return new Yq(r,n)},t}(Ms);var Yq=function(e){xu(t,e);function t(r,n){var o=e.call(this)||this;return o.destination=r,o.source=n,o}return t.prototype.next=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.next)===null||o===void 0||o.call(n,r)},t.prototype.error=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.error)===null||o===void 0||o.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,o;return(o=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&o!==void 0?o:fG},t}(En);var Pa=function(e){xu(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,o=r.thrownError,i=r._value;if(n)throw o;return this._throwIfClosed(),i},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(En);var xG={now:function(){return(xG.delegate||Date).now()},delegate:void 0};var Kq=function(e){xu(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return n===void 0&&(n=0),this},t}(Jy);var LT={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=LT.delegate;return o?.setInterval?o.setInterval.apply(o,Tg([e,t],Ag(r))):setInterval.apply(void 0,Tg([e,t],Ag(r)))},clearInterval:function(e){var t=LT.delegate;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};var Jq=function(e){xu(t,e);function t(r,n){var o=e.call(this,r,n)||this;return o.scheduler=r,o.work=n,o.pending=!1,o}return t.prototype.schedule=function(r,n){var o;if(n===void 0&&(n=0),this.closed)return this;this.state=r;var i=this.id,a=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(a,i,n)),this.pending=!0,this.delay=n,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(a,this.id,n),this},t.prototype.requestAsyncId=function(r,n,o){return o===void 0&&(o=0),LT.setInterval(r.flush.bind(r,this),o)},t.prototype.recycleAsyncId=function(r,n,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return n;n!=null&&LT.clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(r,n);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var o=!1,i;try{this.work(r)}catch(a){o=!0,i=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},t.prototype.unsubscribe=function(){if(!this.closed){var r=this,n=r.id,o=r.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,EC(i,this),n!=null&&(this.id=this.recycleAsyncId(o,n,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Kq);var CG=function(){function e(t,r){r===void 0&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.schedulerActionCtor(this,t).schedule(n,r)},e.now=xG.now,e}();var $q=function(e){xu(t,e);function t(r,n){n===void 0&&(n=CG.now);var o=e.call(this,r,n)||this;return o.actions=[],o._active=!1,o}return t.prototype.flush=function(r){var n=this.actions;if(this._active){n.push(r);return}var o;this._active=!0;do if(o=r.execute(r.state,r.delay))break;while(r=n.shift());if(this._active=!1,o){for(;r=n.shift();)r.unsubscribe();throw o}},t}(CG);var FT=new $q(Jq),eY=FT;var xD=new Ms(function(e){return e.complete()});function CD(e){return e&&Zo(e.schedule)}function tY(e){return e[e.length-1]}function rY(e){return CD(tY(e))?e.pop():void 0}function nY(e,t){return typeof tY(e)=="number"?e.pop():t}var SD=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function vD(e){return Zo(e?.then)}function ID(e){return Zo(e[o1])}function AD(e){return Symbol.asyncIterator&&Zo(e?.[Symbol.asyncIterator])}function TD(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function O3e(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var PD=O3e();function _D(e){return Zo(e?.[PD])}function RD(e){return Uq(this,arguments,function(){var r,n,o,i;return dD(this,function(a){switch(a.label){case 0:r=e.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,wC(r.read())];case 3:return n=a.sent(),o=n.value,i=n.done,i?[4,wC(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,wC(o)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function DD(e){return Zo(e?.getReader)}function Hc(e){if(e instanceof Ms)return e;if(e!=null){if(ID(e))return G3e(e);if(SD(e))return U3e(e);if(vD(e))return N3e(e);if(AD(e))return oY(e);if(_D(e))return z3e(e);if(DD(e))return H3e(e)}throw TD(e)}function G3e(e){return new Ms(function(t){var r=e[o1]();if(Zo(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function U3e(e){return new Ms(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function N3e(e){return new Ms(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,gD)})}function z3e(e){return new Ms(function(t){var r,n;try{for(var o=Ig(e),i=o.next();!i.done;i=o.next()){var a=i.value;if(t.next(a),t.closed)return}}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}t.complete()})}function oY(e){return new Ms(function(t){j3e(e,t).catch(function(r){return t.error(r)})})}function H3e(e){return oY(RD(e))}function j3e(e,t){var r,n,o,i;return Gq(this,void 0,void 0,function(){var a,s;return dD(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),r=Nq(e),l.label=1;case 1:return[4,r.next()];case 2:if(n=l.sent(),!!n.done)return[3,4];if(a=n.value,t.next(a),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=l.sent(),o={error:s},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function Td(e,t,r,n,o){n===void 0&&(n=0),o===void 0&&(o=!1);var i=t.schedule(function(){r(),o?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!o)return i}function wD(e,t){return t===void 0&&(t=0),hl(function(r,n){r.subscribe(gl(n,function(o){return Td(n,e,function(){return n.next(o)},t)},function(){return Td(n,e,function(){return n.complete()},t)},function(o){return Td(n,e,function(){return n.error(o)},t)}))})}function ED(e,t){return t===void 0&&(t=0),hl(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function iY(e,t){return Hc(e).pipe(ED(t),wD(t))}function aY(e,t){return Hc(e).pipe(ED(t),wD(t))}function sY(e,t){return new Ms(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function lY(e,t){return new Ms(function(r){var n;return Td(r,t,function(){n=e[PD](),Td(r,t,function(){var o,i,a;try{o=n.next(),i=o.value,a=o.done}catch(s){r.error(s);return}a?r.complete():r.next(i)},0,!0)}),function(){return Zo(n?.return)&&n.return()}})}function MD(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ms(function(r){Td(r,t,function(){var n=e[Symbol.asyncIterator]();Td(r,t,function(){n.next().then(function(o){o.done?r.complete():r.next(o.value)})},0,!0)})})}function uY(e,t){return MD(RD(e),t)}function cY(e,t){if(e!=null){if(ID(e))return iY(e,t);if(SD(e))return sY(e,t);if(vD(e))return aY(e,t);if(AD(e))return MD(e,t);if(_D(e))return lY(e,t);if(DD(e))return uY(e,t)}throw TD(e)}function mY(e,t){return t?cY(e,t):Hc(e)}function dY(e){return e instanceof Date&&!isNaN(e)}function BC(e,t){return hl(function(r,n){var o=0;r.subscribe(gl(n,function(i){n.next(e.call(t,i,o++))}))})}function pY(e,t,r,n,o,i,a,s){var l=[],u=0,c=0,m=!1,d=function(){m&&!l.length&&!u&&t.complete()},p=function(f){return u<n?h(f):l.push(f)},h=function(f){i&&t.next(f),u++;var y=!1;Hc(r(f,c++)).subscribe(gl(t,function(g){o?.(g),i?p(g):t.next(g)},function(){y=!0},void 0,function(){if(y)try{u--;for(var g=function(){var x=l.shift();a?Td(t,a,function(){return h(x)}):h(x)};l.length&&u<n;)g();d()}catch(x){t.error(x)}}))};return e.subscribe(gl(t,p,function(){m=!0,d()})),function(){s?.()}}function SG(e,t,r){return r===void 0&&(r=1/0),Zo(t)?SG(function(n,o){return BC(function(i,a){return t(n,i,o,a)})(Hc(e(n,o)))},r):(typeof t=="number"&&(r=t),hl(function(n,o){return pY(n,o,e,r)}))}function fY(e){return e===void 0&&(e=1/0),SG(i1,e)}function hY(e,t,r){e===void 0&&(e=0),r===void 0&&(r=eY);var n=-1;return t!=null&&(CD(t)?r=t:n=t),new Ms(function(o){var i=dY(e)?+e-r.now():e;i<0&&(i=0);var a=0;return r.schedule(function(){o.closed||(o.next(a++),0<=n?this.schedule(void 0,n):o.complete())},i)})}function jc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=rY(e),n=nY(e,1/0),o=e;return o.length?o.length===1?Hc(o[0]):fY(n)(mY(o,r)):xD}function zf(e,t){return hl(function(r,n){var o=0;r.subscribe(gl(n,function(i){return e.call(t,i,o++)&&n.next(i)}))})}function $y(e,t){return t===void 0&&(t=FT),hl(function(r,n){var o=null,i=null,a=null,s=function(){if(o){o.unsubscribe(),o=null;var u=i;i=null,n.next(u)}};function l(){var u=a+e,c=t.now();if(c<u){o=this.schedule(void 0,u-c),n.add(o);return}s()}r.subscribe(gl(n,function(u){i=u,a=t.now(),o||(o=t.schedule(l,e),n.add(o))},function(){s(),n.complete()},void 0,function(){i=o=null}))})}function vG(e){return e<=0?function(){return xD}:hl(function(t,r){var n=0;t.subscribe(gl(r,function(o){++n<=e&&(r.next(o),e<=n&&r.complete())}))})}function VT(e,t){return t===void 0&&(t=i1),e=e??W3e,hl(function(r,n){var o,i=!0;r.subscribe(gl(n,function(a){var s=t(a);(i||!e(o,s))&&(i=!1,o=s,n.next(a))}))})}function W3e(e,t){return e===t}function OT(e){return zf(function(t,r){return e<=r})}function gY(e,t){return hl(function(r,n){var o=t??{},i=o.leading,a=i===void 0?!0:i,s=o.trailing,l=s===void 0?!1:s,u=!1,c=null,m=null,d=!1,p=function(){m?.unsubscribe(),m=null,l&&(y(),d&&n.complete())},h=function(){m=null,d&&n.complete()},f=function(g){return m=Hc(e(g)).subscribe(gl(n,p,h))},y=function(){if(u){u=!1;var g=c;c=null,n.next(g),!d&&f(g)}};r.subscribe(gl(n,function(g){u=!0,c=g,!(m&&!m.closed)&&(a?y():f(g))},function(){d=!0,!(l&&u&&m&&!m.closed)&&n.complete()}))})}function Cu(e,t,r){t===void 0&&(t=FT);var n=hY(e,t);return gY(function(){return n},r)}var IG=class{constructor(t){this.name=t;this.commands=new Pa(void 0);this.state={viewers:new Pa([]),currentStoryData:new Pa(void 0),isLoading:new Pa(!1)}}dispatch(t){this.commands.next(t)}};function a1(e){let t=e?.container??window;t.componentContexts??={};let r=e?.name??"<default>";return t.componentContexts[r]||(t.componentContexts[r]=new IG(e?.name)),t.componentContexts[r]}var BD=Object.prototype.hasOwnProperty;function yY(e,t){for(let r of Object.keys(t))BD.call(t,r)&&typeof e[r]>"u"&&(e[r]=t[r]);return e}function X3e(e,t){let r=!1;for(let n of Object.keys(t))if(BD.call(t,n)&&t[n]!==e[n]){r=!0;break}return r?Object.assign({},e,t):e}function eb(e,t){if(!e)return!t;if(!t)return!1;let r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(let n of r)if(!BD.call(e,n)||e[n]!==t[n])return!1;return!0}function bY(e,t){let r=e;for(let n=0;n<t.length;n++)if(t[n]&&(r=X3e(e,t[n]),r!==e)){for(let o=n+1;o<t.length;o++)r=Object.assign(r,t[o]);break}return r}function Ya(e){if(e===null||typeof e!="object")return e;if(e instanceof Array){let t=[];for(let r=0,n=e.length;r<n;r++)t[r]=Ya(e[r]);return t}if(typeof e=="object"&&!("prototype"in e)){let t={};for(let r in e)BD.call(e,r)&&(t[r]=Ya(e[r]));return t}throw new Error(`Can't clone, type "${typeof e}" unsupported`)}function GT(e,t){let r={};for(let n of Object.keys(e))r[n]=t(e[n]);return r}function xY(e,t){let r={};for(let n of e)r[n]=t(n);return r}function gi(e,t){if(e)for(let r of Object.keys(e))t(e[r],r)}function rc(e,t){let r={};for(let n of t)Object.hasOwn(e,n)&&(r[n]=e[n]);return r}function AG(e,t,r){let n={};for(let o of t){let i=r[o];i!==null&&(i===void 0&&(i=o),Object.hasOwn(e,i)&&(n[o]=e[i]))}return n}function TG(e){let t;for(let n in e){let o=e[n].length;if(t!==void 0&&t!==o)throw new Error("FormatError: arrays must have the same length.");t=o}if(t===void 0)return[];let r=new Array(t);for(let n=0;n<t;n++){let o={};for(let i in e)o[i]=e[i][n];r[n]=o}return r}function nc(e,t){let r={...e};for(let n of t)delete r[n];return r}function Q3e(e,t){let r={};for(let n=0;n<e.length;n++)r[e[n]]=t[n];return r}function s1(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}async function CY(e){let t=Object.keys(e),r=Object.values(e),n=await Promise.all(r);return Q3e(t,n)}var oc;(t=>{function e(){let r=new PG,n=()=>r.create();return n.dispose=()=>r.dispose(),n.behavior=o=>r.behavior(o),n}t.create=e})(oc||={});var PG=class{constructor(){this._eventList=[];this._disposed=!1}create(){let t=new En;return this._eventList.push(t),t}behavior(t){let r=new Pa(t);return this._eventList.push(r),r}dispose(){if(!this._disposed){for(let t of this._eventList)t.complete();this._disposed=!0}}};function Pg(e){return JSON.stringify(e,(t,r)=>s1(r)?Z3e(r):r)}function kD(e){return JSON.stringify(e,void 0,"	").replace(/,\n\t*/g,", ").replace(/\n\t*/g,"")}function Z3e(e){let t={};for(let r of Object.keys(e).sort()){let n=e[r];n!==void 0&&(t[r]=n)}return t}function ol(e){let t=-1/0;for(let r=0,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function tb(e){let t=1/0;for(let r=0,n=e.length;r<n;++r)e[r]<t&&(t=e[r]);return t}function Su(e){let t=1/0,r=-1/0;for(let n=0,o=e.length;n<o;++n)e[n]<t&&(t=e[n]),e[n]>r&&(r=e[n]);return[t,r]}function _G(e,t=1,r=0){let n=e.length,o=0;for(let i=r;i<n;i+=t)o+=e[i];return o}function rb(e,t=1,r=0){return _G(e,t,r)/(e.length/t)}function nb(e){let t=e.length,r=0;for(let n=0;n<t;++n){let o=e[n];r+=o*o}return Math.sqrt(r/t)}function _a(e,t){for(let r=0,n=t?Math.min(t,e.length):e.length;r<n;++r)e[r]=r;return e}function _g(e,t){let r=0,n=!1;for(let o=e.length;r<o;r++)if(e[r]===t){n=!0;break}return n?(ob(e,r),!0):!1}function ob(e,t){for(let r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function qo(e,t){return e.indexOf(t)>=0?!1:(e.push(t),!0)}function Pd(e,t){let r=e.indexOf(t);if(r<0)return!1;for(let n=r,o=e.length-1;n<o;n++)e[n]=e[n+1];return e.pop(),!0}function l1(e,t){let r=0;for(let n=0,o=e.length;n<o;++n)t.includes(e[n])&&(r+=1);return r}function kC(e,t){if(!e||e.length===0)return!t||t.length===0;if(!t)return!1;let r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function SY(e){for(let t=0,r=e.length;t<r;t++)if(e[t]!==t)return!1;return!0}function UT(e,t,r){for(let n=0,o=e.length;n<o;++n)if(e[n][0]===t){e[n][1]=r;return}e.push([t,r])}function Rm(e,t){t===void 0&&(t=e,e=0);let r=Math.max(t-e,0),n=Array(r);for(let o=0;o<r;o++)n[o]=e+o;return n}function ib(e,t){let r=e.length,n=t.length;e.length+=n;for(let o=0;o<n;o++)e[r+o]=t[o];return e}function vY(e,t){return q3e(e,t)?e:e.sort(t)}function q3e(e,t){for(let r=1,n=e.length;r<n;r++)if(t(e[r-1],e[r])>0)return!1;return!0}function Rg(e,t){let r=e.length,n=0;for(let o=0;o<r;o++)t(e[o])&&(e[n++]=e[o]);return e.length=n,e}function IY(e){let t=new Set,r=[];for(let n of e){let o=Pg(n);t.has(o)||(t.add(o),r.push(n))}return r}var ic=class{constructor(){this.subs=void 0}subscribe(t,r){if(!t)return{unsubscribe:()=>{}};typeof this.subs>"u"&&(this.subs=[]);let n=t.subscribe(r);return this.subs.push(n),{unsubscribe:()=>{n&&this.subs&&Pd(this.subs,n)&&(n.unsubscribe(),n=void 0)}}}get ev(){return this._ev||(this._ev=oc.create())}dispose(){if(this._ev&&this._ev.dispose(),this.subs){for(let t of this.subs)t.unsubscribe();this.subs=void 0}}},Bs=class extends ic{updateState(...t){let r=this.state,n=bY(r,t);return n!==r?(this._state=n,!0):!1}get state(){return this._state}constructor(t){super(),this._state=t}};var ab=Rt(Pi());function mwe(e){let[,t]=ab.default.useState({}),r=ab.default.useRef();return r.current=e?.value,ab.default.useEffect(()=>{if(!e)return;let n=e.subscribe(o=>{r.current!==o&&t({})});return()=>n.unsubscribe()},[e]),e?.value}function dwe(e){return ab.default.useSyncExternalStore(ab.default.useCallback(t=>{let r=e?.pipe(OT(1)).subscribe(t);return()=>r?.unsubscribe()},[e]),ab.default.useCallback(()=>e?.value,[e]))}var pwe=ab.default.useSyncExternalStore?dwe:mwe;function vu(e){return pwe(e)}var zoe=Rt(QU());var W1=Rt(Pi());var Zg=Rt(Pi());var YC=Math.PI/2,nee=Math.PI/180;function vr(e){return e*nee}function Ea(e){return e/nee}function Rb(e){return e!==0&&(e&e-1)===0}function oee(...e){let t=0,r=0;for(let n=0,o=e.length;n<o;++n){let i=e[n],a=Math.abs(i);a>r&&(t=i,r=a)}return t}function nw(e,t){return e*t}function ow(e){let t=0,r=0,n=0,o=-1,i=e*2+1,a=i/2,s=[];for(let l=Math.pow(i,2);l>0;--l){if(-a<t&&t<=a&&-a<r&&r<=a&&s.push([t,r]),t===r||t<0&&t===-r||t>0&&t===1-r){let u=n;n=-o,o=u}t+=n,r+=o}return s}function Qp(e,t,r){return(e-t)/(r-t)}function Br(e,t,r){return Math.max(t,Math.min(r,e))}function gMe(e){return Br(e,0,1)}function $n(e,t,r){return e+(t-e)*r}function G1(e,t,r,n,o,i){let a=(r-e)*i,s=(n-t)*i,l=o*o,u=o*l;return(2*t-2*r+a+s)*u+(-3*t+3*r-2*a-s)*l+a*o+t}function iw(e,t,r,n){let o=1-n;return o*o*e+2*o*n*t+n*n*r}function aw(e,t,r){return r=gMe(Qp(r,e,t)),r*r*(3-2*r)}function ma(){return ma.zero()}(M=>{function e(){let E=[.1,0,0];return E[0]=0,E}M.zero=e;function t(E,R,k){let B=e();return B[0]=E,B[1]=R,B[2]=k,B}M.create=t;function r(E,R,k,B){return E[0]=R,E[1]=k,E[2]=B,E}M.set=r;function n(E,R){let k=R[0]-E[0],B=R[1]-E[1],L=R[2]-E[2];return Math.sqrt(k*k+B*B+L*L)}M.distance=n;function o(E,R){let[k,B,L]=Fe.toRgb(R),[V,U,Q]=D(k,B,L),O=116*U-16;return E[0]=O<0?0:O,E[1]=500*(V-U),E[2]=200*(U-Q),E}M.fromColor=o;function i(E,R){return Yc.toLab(E,R)}M.fromHcl=i;function a(E){let R=(E[0]+16)/116,k=isNaN(E[1])?R:R+E[1]/500,B=isNaN(E[2])?R:R-E[2]/200;R=y*_(R),k=f*_(k),B=g*_(B);let L=A(3.2404542*k-1.5371385*R-.4985314*B),V=A(-.969266*k+1.8760108*R+.041556*B),U=A(.0556434*k-.2040259*R+1.0572252*B);return Fe.fromRgb(Math.round(Br(L,0,255)),Math.round(Br(V,0,255)),Math.round(Br(U,0,255)))}M.toColor=a;function s(E,R){let[k,B,L]=R,V=Math.sqrt(B*B+L*L),U=(Ea(Math.atan2(L,B))+360)%360;return Math.round(V*1e4)===0&&(U=Number.NaN),E[0]=U,E[1]=V,E[2]=k,E}M.toHcl=s;function l(E,R){return E[0]=R[0],E[1]=R[1],E[2]=R[2],E}M.copy=l;function u(E,R,k){return E[0]=R[0]-h*k,E[1]=R[1],E[2]=R[2],E}M.darken=u;function c(E,R,k){return u(E,R,-k)}M.lighten=c;let m=[0,0,0];function d(E,R,k){return s(m,R),Yc.toLab(E,Yc.saturate(m,m,k))}M.saturate=d;function p(E,R,k){return d(E,R,-k)}M.desaturate=p;let h=18,f=.95047,y=1,g=1.08883,x=.137931034,S=.206896552,I=.12841855,v=.008856452;function A(E){return 255*(E<=.00304?12.92*E:1.055*Math.pow(E,1/2.4)-.055)}function _(E){return E>S?E*E*E:I*(E-x)}function T(E){return(E/=255)<=.04045?E/12.92:Math.pow((E+.055)/1.055,2.4)}function w(E){return E>v?Math.pow(E,1/3):E/I+x}function D(E,R,k){E=T(E),R=T(R),k=T(k);let B=w((.4124564*E+.3575761*R+.1804375*k)/f),L=w((.2126729*E+.7151522*R+.072175*k)/y),V=w((.0193339*E+.119192*R+.9503041*k)/g);return[B,L,V]}})(ma||={});function Yc(){return Yc.zero()}(g=>{function e(){let x=[.1,0,0];return x[0]=0,x}g.zero=e;function t(x,S,I){let v=e();return v[0]=x,v[1]=S,v[2]=I,v}g.create=t;function r(x,S,I,v){return x[0]=S,x[1]=I,x[2]=v,x}g.set=r;function n(x){return!isNaN(x[0])}g.hasHue=n;let o=[0,0,0];function i(x,S){return ma.toHcl(x,ma.fromColor(o,S))}g.fromColor=i;function a(x,S){return ma.toHcl(x,S)}g.fromLab=a;let s=[0,0,0];function l(x){return ma.toColor(u(s,x))}g.toColor=l;function u(x,S){let[I,v,A]=S;return isNaN(I)&&(I=0),I=vr(I),x[0]=A,x[1]=Math.cos(I)*v,x[2]=Math.sin(I)*v,x}g.toLab=u;function c(x,S){return x[0]=S[0],x[1]=S[1],x[2]=S[2],x}g.copy=c;function m(x,S,I){return x[0]=S[0],x[1]=Math.max(0,S[1]+y*I),x[2]=S[2],x}g.saturate=m;function d(x,S,I){return m(x,S,-I)}g.desaturate=d;let p=[0,0,0];function h(x,S,I){return u(p,S),ma.toHcl(x,ma.darken(p,p,I))}g.darken=h;function f(x,S,I){return h(x,S,-I)}g.lighten=f;let y=18})(Yc||={});function Fe(e){return e}(L=>{function e(V){return`rgb(${V>>16&255}, ${V>>8&255}, ${V&255})`}L.toStyle=e;function t(V){return"#"+("000000"+V.toString(16)).slice(-6)}L.toHexStyle=t;function r(V){return"0x"+("000000"+V.toString(16)).slice(-6)}L.toHexString=r;function n(V){return`RGB: ${L.toRgb(V).join(", ")}`}L.toRgbString=n;function o(V){return[V>>16&255,V>>8&255,V&255]}L.toRgb=o;function i(V){return[(V>>16&255)/255,(V>>8&255)/255,(V&255)/255]}L.toRgbNormalized=i;function a(V){return parseInt(V.replace("#","0x"))}L.fromHexStyle=a;function s(V){return parseInt(V)}L.fromHexString=s;function l(V,U,Q){return V<<16|U<<8|Q}L.fromRgb=l;function u(V,U,Q){return V*255<<16|U*255<<8|Q*255}L.fromNormalizedRgb=u;function c(V,U){return l(V[U],V[U+1],V[U+2])}L.fromArray=c;function m(V,U){return u(V[U],V[U+1],V[U+2])}L.fromNormalizedArray=m;function d(V){return typeof V=="number"?V:V[0]}L.fromColorListEntry=d;function p(V,U,Q){return U[Q]=V>>16&255,U[Q+1]=V>>8&255,U[Q+2]=V&255,U}L.toArray=p;function h(V,U,Q){return U[Q]=(V>>16&255)/255,U[Q+1]=(V>>8&255)/255,U[Q+2]=(V&255)/255,U}L.toArrayNormalized=h;function f(V,U){return V[0]=U>>16&255,V[1]=U>>8&255,V[2]=U&255,V}L.toVec3=f;function y(V,U){return V[0]=(U>>16&255)/255,V[1]=(U>>8&255)/255,V[2]=(U&255)/255,V}L.toVec3Normalized=y;function g(V,U,Q){let O=V>>16&255,q=V>>8&255,X=V&255,F=U>>16&255,Y=U>>8&255,$=U&255,ce=O+(F-O)*Q,ie=q+(Y-q)*Q,oe=X+($-X)*Q;return ce<<16|ie<<8|oe}L.interpolate=g;function x(V){let U=V>>16&255,Q=V>>8&255,O=V&255;return U!==Q||U!==O}L.hasHue=x;let S=[0,0,0];function I(V,U){return x(V)?(Yc.fromColor(S,V),Yc.toColor(Yc.saturate(S,S,U))):V}L.saturate=I;function v(V,U){return I(V,-U)}L.desaturate=v;let A=[0,0,0];function _(V,U){return ma.fromColor(A,V),ma.toColor(ma.darken(A,A,U))}L.darken=_;function T(V,U){return _(V,-U)}L.lighten=T;function w(V){return V<=.03928?V/12.92:Math.pow((V+.055)/1.055,2.4)}function D(V){let U=w((V>>16&255)/255),Q=w((V>>8&255)/255),O=w((V&255)/255);return .2126*U+.7152*Q+.0722*O}L.luminance=D;function M(V,U){let Q=D(V),O=D(U);return Q>O?(Q+.05)/(O+.05):(O+.05)/(Q+.05)}L.contrast=M;function E(V){return V<.04045?V*.0773993808:Math.pow(V*.9478672986+.0521327014,2.4)}function R(V){return u(E((V>>16&255)/255),E((V>>8&255)/255),E((V&255)/255))}L.sRGBToLinear=R;function k(V){return V<.0031308?V*12.92:1.055*Math.pow(V,.41666)-.055}function B(V){return u(k((V>>16&255)/255),k((V>>8&255)/255),k((V&255)/255))}L.linearToSRGB=B})(Fe||={});function Hr(e,t,r,n){return{label:e,description:r,list:n,type:t}}function Db(e,t,r){let n={};for(let o in e){let i=e[o];i=Fe.saturate(i,t),i=Fe.darken(i,-r),n[o]=i}return n}function iee(e,t=" "){return e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,`$1${t}$2`)}function Ls(e){return Kc(iee(e))}var yMe=e=>e.toUpperCase();function aee(e){return e?typeof e=="string"?e.toUpperCase():`${e}`.toUpperCase():""}function Kc(e){return e.toLowerCase().replace(/^\w|\s\w/g,yMe)}function bMe(e){return e.replace(/_/g," ")}function xMe(e){return e.replace(/-/g," ")}function ta(e){return Kc(iee(bMe(xMe(e))))}function ra(e,t,r,n){let o=n.length;if(o>r-t)return!1;for(let i=0;i<o;i++)if(e.charCodeAt(t+i)!==n.charCodeAt(i))return!1;return!0}function see(e,t){let r=Object.keys(t),n=Object.values(t);return new Function(...r,`return \`${e}\`;`)(...n)}function Zp(e){return e.replace(/<\/?[^>]+>/g,"")}function Gg(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var lr={reds:Hr("Reds","sequential","Reds, sequential color scheme from ColorBrewer 2.0",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),oranges:Hr("Oranges","sequential","Oranges, sequential color scheme from ColorBrewer 2.0",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),greens:Hr("Greens","sequential","Greens, sequential color scheme from ColorBrewer 2.0",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),blues:Hr("Blues","sequential","Blues, sequential color scheme from ColorBrewer 2.0",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),purples:Hr("Purples","sequential","Purples, sequential color scheme from ColorBrewer 2.0",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),greys:Hr("Greys","sequential","Greys, sequential color scheme from ColorBrewer 2.0",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"orange-red":Hr("Orange-Red","sequential","OrRd, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"blue-green":Hr("Blue-Green","sequential","BuGn, sequential color scheme from ColorBrewer 2.0",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"purple-blue-green":Hr("Purple-Blue-Green","sequential","PuBuGn, sequential color scheme from ColorBrewer 2.0",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),"green-blue":Hr("Green-Blue","sequential","GnBu, sequential color scheme from ColorBrewer 2.0",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),"purple-blue":Hr("Purple-Blue","sequential","PuBu, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":Hr("Blue-Purple","sequential","BuPu, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),"red-purple":Hr("Red-Purple","sequential","RdPu, sequential color scheme from ColorBrewer 2.0",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),"purple-red":Hr("Purple-Red","sequential","PuRd, sequential color scheme from ColorBrewer 2.0",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),"yellow-orange-red":Hr("Yellow-Orange-Red","sequential","YlOrRd, sequential color scheme from ColorBrewer 2.0",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"yellow-orange-brown":Hr("Yellow-Orange-Brown","sequential","YlOrBr, sequential color scheme from ColorBrewer 2.0",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":Hr("Yellow-Green","sequential","YlGn, sequential color scheme from ColorBrewer 2.0",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),"yellow-green-blue":Hr("Yellow-Green-Blue","sequential","YlGnBu, sequential color scheme from ColorBrewer 2.0",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),"red-blue":Hr("Red-Blue","diverging","RdBu, diverging color scheme from ColorBrewer 2.0",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"red-grey":Hr("Red-Grey","diverging","RdGy, diverging color scheme from ColorBrewer 2.0",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"pink-yellow-green":Hr("Pink-Yellow-Green","diverging","PiYG, diverging color scheme from ColorBrewer 2.0",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"brown-white-green":Hr("Brown-White-Green","diverging","BrBG, diverging color scheme from ColorBrewer 2.0",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"purple-green":Hr("Purple-Green","diverging","PRGn, diverging color scheme from ColorBrewer 2.0",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"purple-orange":Hr("Purple-Orange","diverging","PuOr, diverging color scheme from ColorBrewer 2.0",[2949195,5515144,8418220,11709394,14211819,16250871,16703670,16627811,14713364,11753478,8338184]),"orange-purple":Hr("Orange-Purple","diverging","Reversed PuOr, diverging color scheme from ColorBrewer 2.0",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"red-yellow-green":Hr("Red-Yellow-Green","diverging","RdYlGn, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-yellow-blue":Hr("Red-Yellow-Blue","diverging","RdYlBu, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),spectral:Hr("Spectral","diverging","Spectral, diverging color scheme from ColorBrewer 2.0",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),magma:Hr("Magma","sequential","Magma, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-white",[4,131595,328726,591648,920363,1314358,1708098,2167117,2691418,3346535,3870576,4460406,4985210,5510013,5969279,6560384,7019905,7676289,8135554,8660609,9185665,9710720,10235519,10826110,11351164,12007289,12532343,13057395,13516656,14042475,14567784,14962532,15357537,15687006,16017244,16216156,16349533,16483167,16551011,16619112,16686957,16689523,16692347,16694658,16696970,16699282,16701594,16638627,16640940,16577718,16580031]),"magma-no-black":Hr("Magma (no black)","sequential","Magma, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-white (with the black region removed)",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:Hr("Inferno","sequential","Inferno, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-yellow",[4,131596,328727,657186,1050925,1444665,1969221,2427985,3082843,3737955,4328040,4852843,5377645,5902702,6427502,6952814,7477870,8133997,8659051,9184105,9643623,10168676,10693729,11218782,11743834,12334932,12794703,13254730,13583429,14109502,14504250,14833460,15162926,15427112,15757088,15955993,16154643,16288012,16421383,16489222,16557322,16559634,16497183,16434218,16305463,16176966,16048470,15919721,15921789,16120210,16580516]),"inferno-no-black":Hr("Inferno (no black)","sequential","Inferno, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-yellow (with the black region removed)",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:Hr("Plasma","sequential","Plasma, sequential color scheme from Matplotlib, perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:Hr("Viridis","sequential","Viridis, sequential color scheme from Matplotlib, perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:Hr("Cividis","sequential","Cividis, sequential color scheme from Matplotlib, perceptually uniform shades of blue-grey-yellow, should look effectively identical to colorblind and non-colorblind users",[8273,9305,10079,76644,339560,668266,1062508,1390957,1916270,2375790,2835566,3295342,3754862,4214638,4543085,5068397,5462638,5856878,6185326,6579567,6908272,7236721,7499890,7828595,8091764,8354933,8617846,8946551,9209463,9472888,9736056,10064760,10327928,10656632,10985591,11379830,11708532,12102770,12497264,12891501,13285994,13745766,14140259,14600287,14994522,15389014,15717970,16046926,16310347,16508232,16640581]),twilight:Hr("Twilight","cyclical","Twilight, cyclical color scheme from Matplotlib, perceptually uniform shades of white-blue-black-red-white",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),"set-2":Hr("Set-2","qualitative","Set2, categorical color scheme from ColorBrewer 2.0",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:Hr("Accent","qualitative","Accent, categorical color scheme from ColorBrewer 2.0",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":Hr("Set-1","qualitative","Set1, categorical color scheme from ColorBrewer 2.0",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":Hr("Set-3","qualitative","Set3, categorical color scheme from ColorBrewer 2.0",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":Hr("Dark-2","qualitative","Dark2, categorical color scheme from ColorBrewer 2.0",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:Hr("Paired","qualitative","Paired, categorical color scheme from ColorBrewer 2.0",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":Hr("Pastel-2","qualitative","Pastel2, categorical color scheme from ColorBrewer 2.0",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":Hr("Pastel-1","qualitative","Pastel1, categorical color scheme from ColorBrewer 2.0",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),turbo:Hr("Turbo","sequential","Turbo color scheme from D3.js, improved (smooth) rainbow colormap for visualization",[2299675,3547990,4337541,4799658,4934343,4872413,4613867,4289780,3900152,3510520,3120629,2796271,2602726,2474716,2477264,2611140,2875575,3270826,3731101,4387984,5109892,5897080,6815085,7798371,8781145,9829201,10811209,11858498,12774460,13755446,14605618,15389486,16042283,16563496,16757029,16753699,16750369,16746782,16743196,16608538,16146200,15487253,14763026,13973263,13052940,12198408,11344133,10621442,9965056,9571328,9440256]),"turbo-no-black":Hr("Turbo (no black)","sequential","Turbo color scheme from D3.js, improved (smooth) rainbow colormap for visualization, with black region removed",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),warm:Hr("Warm","sequential","Warm, sequential color scheme from D3.js",[7225514,7684013,8208303,8797873,9322162,9846195,10370483,10960051,11484338,12008625,12532911,13057452,13581737,14040742,14434210,14959005,15352473,15746196,16074382,16402824,16665475,16731772,16732790,16733808,16734826,16735843,16737117,16738135,16739409,16740939,16742471,16743746,16745277,16747065,16748598,16487987,16162097,15901743,15575598,15184174,14858031,14466608,14140466,13748788,13422648,13030972,12704833,12378438,12052044,11791187,11530331]),cool:Hr("Cool","sequential","Cool, sequential color scheme from D3.js",[7225514,7095217,6899639,6769597,6574275,6313160,6117837,5856977,5596117,5335513,5009115,4748510,4422368,4161761,3835361,3575009,3314401,3053791,2793438,2598363,2337752,2208213,2013137,1883340,1819335,1755074,1691068,1692086,1758640,1825706,1957795,2155164,2352790,2615695,2878601,3207042,3600764,3994230,4453489,4912492,5437031,5961315,6551391,7140956,7730778,8386136,8975703,9630807,10285911,10940761,11530331]),"cubehelix-default":Hr("CubehelixDefault","sequential","CubehelixDefault, sequential color scheme from D3.js",[0,525064,984594,1313308,1576742,1709360,1776697,1712705,1649479,1520715,1457486,1394254,1396557,1529674,1662534,2057794,2518076,3109175,3765555,4618288,5536047,6519343,7568178,8550967,9599551,10516809,11368789,12155235,12745329,13270146,13663891,13861539,13928371,13929921,13800654,13606106,13411811,13217514,12957935,12829170,12700403,12768243,12835826,13099761,13428976,13823727,14349039,14939888,15530483,16186616,16777215]),rainbow:Hr("Rainbow","cyclical","Rainbow, cyclical color scheme from D3.js",[7225514,8208303,9322162,10370483,11484338,12532911,13581737,14434210,15352473,16074382,16665475,16732790,16734826,16737117,16739409,16742471,16745277,16748598,16162097,15575598,14858031,14140466,13422648,12704833,12052044,11530331,10285911,8975703,7730777,6485855,5437031,4453489,3600764,2878601,2352790,1957795,1758896,1691068,1819335,2013137,2337752,2793438,3314401,3835617,4422368,5009115,5596117,6117837,6574275,6899639,7225514]),sinebow:Hr("Sinebow","cyclical","Sinebow, cyclical color scheme from D3.js",[16728128,16666162,16473382,16149788,15695122,15174923,14458117,13740802,12892928,11978752,10999043,9953287,8972813,7860757,6879262,5831722,4849463,3931972,3079507,2357858,1635442,1109378,648082,317858,118193,49087,111053,303833,561890,1081837,1602292,2319098,3036157,3884287,4798463,5778172,6823928,7804402,8916458,9897952,10945493,11927752,12845243,13697708,14419357,15141773,15667837,16129133,16459357,16659022,16728128]),"category-10":Hr("Category10","qualitative","Category10, categorical color scheme from D3.js / tab10 from Matplotlib (default in Matplotlib)",[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175]),"observable-10":Hr("Observable10","qualitative","Observable10, categorical color scheme from D3.js",[4352464,15708440,16740956,7128496,3975505,16747191,10773490,9944053,10251086,9738400]),"tableau-10":Hr("Tableau10","qualitative","Tableau10, categorical color scheme from D3.js",[5142951,15896108,14767961,7780274,5873999,15583561,11500193,16752039,10253663,12234923]),"simple-rainbow":Hr("Simple rainbow","sequential","Simple 5-color rainbow (blue-green-yellow-orange-red)",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":Hr("Red-White-Blue","diverging","Diverging color scheme with red-white-blue",[12526114,16777215,3367393]),"many-distinct":Hr("Many-Distinct","qualitative","Customized color scheme combining colors from multiple standard schemes (Dark2, Set1, Set2)",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947])},CMe=Object.keys(lr),sw=CMe.map(e=>[e,lr[e].label,Kc(lr[e].type),lr[e].description]),lee=sw.filter(e=>lr[e[0]].type==="sequential"||lr[e[0]].type==="diverging"||lr[e[0]].type==="cyclical"),uee=sw.filter(e=>lr[e[0]].type==="qualitative");function Ma(e){return e in lr?lr[e]:(console.warn(`unknown color list named '${e}'`),lr["red-yellow-blue"])}var na;(n=>{function e(o){return o}n.create=e;function t(o,i){return(o&i)!==0}n.has=t;function r(o,i){return!!i&&(o&i)===i}n.hasAll=r})(na||={});var Hn;(I=>{function e(v=512){return{current:[],offset:0,capacity:v,chunks:[]}}I.create=e;function t(v){return v.chunks.length?(v.offset>0&&(v.chunks[v.chunks.length]=v.current.length===v.offset?v.current.join(""):v.current.slice(0,v.offset).join("")),v.chunks.join("")):v.current.length===v.offset?v.current.join(""):v.current.splice(0,v.offset).join("")}I.getString=t;function r(v){let A=0;for(let _ of v.chunks)A+=_.length;for(let _=0;_<v.offset;_++)A+=v.current[_].length;return A}I.getSize=r;function n(v){return v.offset>0&&(v.current.length===v.offset?v.chunks[v.chunks.length]=v.current.join(""):v.chunks[v.chunks.length]=v.current.slice(0,v.offset).join(""),v.offset=0),v.chunks}I.getChunks=n;let o;(A=>A[A.Count=512]="Count")(o||={});let i=[];(function(){let v="";for(let A=0;A<512;A++)i[A]=v,v=v+" "})();function a(v){c(v,`
`)}I.newline=a;function s(v,A){A>0&&c(v,i[A])}I.whitespace=s;function l(v){c(v," ")}I.whitespace1=l;function u(v,A){A&&(v.offset===v.capacity&&(v.chunks[v.chunks.length]=v.current.join(""),v.offset=0),v.current[v.offset++]=A)}I.write=u;function c(v,A){v.offset===v.capacity&&(v.chunks[v.chunks.length]=v.current.join(""),v.offset=0),v.current[v.offset++]=A}I.writeSafe=c;function m(v,A,_){if(!A){s(v,_);return}let T=_-A.length;s(v,T),c(v,A)}I.writePadLeft=m;function d(v,A,_){if(!A){s(v,_);return}let T=_-A.length;c(v,A),s(v,T)}I.writePadRight=d;function p(v,A){c(v,""+A)}I.writeInteger=p;function h(v,A){c(v,""+A+" ")}I.writeIntegerAndSpace=h;function f(v,A,_){let T=""+A,w=_-T.length;s(v,w),c(v,T)}I.writeIntegerPadLeft=f;function y(v,A,_){let T=""+A,w=_-T.length;c(v,T),s(v,w)}I.writeIntegerPadRight=y;function g(v,A,_){c(v,""+Math.round(_*A)/_)}I.writeFloat=g;function x(v,A,_,T){let w=""+Math.round(_*A)/_,D=T-w.length;s(v,D),c(v,w)}I.writeFloatPadLeft=x;function S(v,A,_,T){let w=""+Math.round(_*A)/_,D=T-w.length;c(v,w),s(v,D)}I.writeFloatPadRight=S})(Hn||={});var Mn=function(){if(typeof window<"u"&&window.performance){let e=window.performance;return()=>e.now()}else return typeof process<"u"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?()=>{let e=process.hrtime();return e[0]*1e3+e[1]/1e6}:Date.now?()=>Date.now():()=>+new Date}();function U1(e,t=!0){if(isNaN(e))return"n/a";let r=Math.floor(e/(60*60*1e3)),n=Math.floor(e/(60*1e3)%60),o=Math.floor(e/1e3%60),i=Math.floor(e%1e3).toString();for(;i.length<3;)i="0"+i;for(;!t&&i.length>1&&i[i.length-1]==="0";)i=i.substr(0,i.length-1);return r>0?`${r}h${n}m${o}.${i}s`:n>0?`${n}m${o}.${i}s`:o>0?`${o}.${i}s`:`${e.toFixed(0)}ms`}var en;(i=>{let e=typeof btoa<"u"?btoa:a=>Buffer.from(a).toString("base64"),t=[];function r(){let a=+new Date+Mn();for(let s=0;s<16;s++)t[s]=String.fromCharCode((a+Math.random()*255)%255|0),a=Math.floor(a/255);return e(t.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)}i.create22=r;function n(){let a=+new Date+Mn();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){let u=(a+Math.random()*16)%16|0;return a=Math.floor(a/16),(l==="x"?u:u&3|8).toString(16)})}i.createv4=n;function o(a){return typeof a=="string"}i.is=o})(en||={});function SMe(e,t){return e-t}function vMe(e){return Array.prototype.sort.call(e,SMe),e}var cee;(p=>{class e{constructor(){this.size=0}has(f){return!1}forEach(f,y){return y}}class t{constructor(f){this.idx=f;this.size=1}has(f){return f===this.idx}forEach(f,y){return f(this.idx,y),y}}class r{constructor(f,y){this.mask=f;this.size=y;this.length=f.length}has(f){return f<this.length&&!!this.mask[f]}_forEach(f,y){for(let g=0;g<this.length;g++)this.mask[g]&&f(g,y)}forEach(f,y){return this._forEach(f,y),y}}class n{constructor(f){this.size=f}has(f){return!0}_forEach(f,y){for(let g=0;g<this.size;g++)f(g,y)}forEach(f,y){return this._forEach(f,y),y}}class o{constructor(f){this.set=f;this._flat=void 0;this.size=f.size}has(f){return this.set.has(f)}_forEach(f,y){for(let g of this.flatten())f(g,y)}flatten(){if(this._flat)return this._flat;let f=new Int32Array(this.size),y=0;return this.set.forEach(g=>f[y++]=g),vMe(f),this._flat=f,this._flat}forEach(f,y){return this._forEach(f,y),y}}function i(h){return new n(h)}p.always=i,p.never=new e;function s(h){return new o(h)}p.ofSet=s;function l(h){return new t(h)}p.singleton=l;function u(h){let f=h.length;if(f===0)return new e;if(f===1)return new t(h[0]);let y=0;for(let S of h)S>y&&(y=S);if(f===y)return new n(f);if(f/y<1/12){let S=new Set;for(let I of h)S.add(I);return new o(S)}let x=new Int8Array(y+1);for(let S of h)x[S]=1;return new r(x,h.length)}p.ofUniqueIndices=u;function c(h,f){return new r(h,f)}p.ofMask=c;function m(h,f){for(let y of f)if(h.has(y))return!0;return!1}p.hasAny=m;function d(h,f){let y=0,g=0;if(f.forEach(x=>{h.has(x)||(y++,x>g&&(g=x))}),y/g<1/12){let x=new Set;return f.forEach(S=>{h.has(S)||x.add(S)}),s(x)}else{let x=new Uint8Array(g+1);return f.forEach(S=>{h.has(S)||(x[S]=1)}),c(x,y)}}p.complement=d})(cee||={});function oi(e=0,t=Number.MAX_SAFE_INTEGER){let r=e;return()=>{let n=r;return r=(r+1)%t,n}}var lw;(r=>{function e(n){return{ref:n}}r.create=e;function t(n,o){return n.ref=o,n}r.set=t})(lw||={});var IMe=oi(0,2147483647),Ug;(r=>{function e(n,o){return{id:IMe(),version:0,value:n,metadata:o}}r.create=e;function t(n,o){return{id:n.id,version:n.version+1,value:o,metadata:n.metadata}}r.withValue=t})(Ug||={});var P;(o=>{function e(i,a){return lw.create(Ug.create(i,a))}o.create=e;function t(i,a){return lw.set(i,Ug.withValue(i.ref,a))}o.update=t;function r(i,a){return lw.set(i,a)}o.set=r;function n(i,a){return i.ref.value!==a?t(i,a):i}o.updateIfChanged=n})(P||={});var iu=function(){};function qf(e,t){let r=Math.pow(10,t);return Math.round(r*e)/r}function ki(e,t){let r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var dee=Object.prototype.hasOwnProperty;function oa(e,t){if(e===t)return!0;let r=Array.isArray(e),n=Array.isArray(t);if(r&&n){if(e.length!==t.length)return!1;for(let o=0;o<e.length;o++)if(!oa(e[o],t[o]))return!1;return!0}if(r!==n)return!1;if(e&&t&&typeof e=="object"&&typeof t=="object"){let o=Object.keys(e);if(o.length!==Object.keys(t).length)return!1;let i=e instanceof Date,a=t instanceof Date;if(i&&a)return e.getTime()===t.getTime();if(i!==a)return!1;let s=e instanceof RegExp,l=t instanceof RegExp;if(s&&l)return e.toString()===t.toString();if(s!==l)return!1;for(let u=0;u<o.length;u++)if(!dee.call(t,o[u]))return!1;for(let u=0;u<o.length;u++)if(!oa(e[o[u]],t[o[u]]))return!1;return!0}return!1}function Ng(e,t){if(e===t)return!0;let r=Array.isArray(e),n=Array.isArray(t);return r&&n?AMe(e,t):r!==n?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Yf(e,t):!1}function Yf(e,t){if(e===t)return!0;if(!e||!t)return!1;let r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(let n of r)if(!dee.call(e,n)||e[n]!==t[n])return!1;return!0}function AMe(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function Wi(e,t){return e!==void 0?e:t}function mee(e){return(e<10?"0":"")+e}function pee(e){let t=e.getHours(),r=e.getMinutes(),n=e.getSeconds();return`${t}:${mee(r)}:${mee(n)}`}function Ru(e){return{kind:"table-legend",table:e}}function fee(e,t,r){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:r}}var Qe;(m=>{function e(d){return d.creator&&d.chunkSize}m.is=e;function t(d){let p=d.growBy*d.elementSize;d.currentSize=p,d.currentIndex=0,d.currentChunk=new d.ctor(p),d.allocatedSize+=p,d.chunks[d.chunks.length]=d.currentChunk}function r(d,p,h,f,y){d.currentIndex>=d.currentSize&&t(d);let g=d.currentChunk,x=d.currentIndex;return g[x]=p,g[x+1]=h,g[x+2]=f,g[x+3]=y,d.currentIndex+=4,d.elementCount++}m.add4=r;function n(d,p,h,f){d.currentIndex>=d.currentSize&&t(d);let y=d.currentChunk,g=d.currentIndex;return y[g]=p,y[g+1]=h,y[g+2]=f,d.currentIndex+=3,d.elementCount++}m.add3=n;function o(d,p,h){d.currentIndex>=d.currentSize&&t(d);let f=d.currentChunk,y=d.currentIndex;return f[y]=p,f[y+1]=h,d.currentIndex+=2,d.elementCount++}m.add2=o;function i(d,p){return d.currentIndex>=d.currentSize&&t(d),d.currentChunk[d.currentIndex]=p,d.currentIndex+=1,d.elementCount++}m.add=i;function a(d,p,h){for(let f=0;f<p;f++)d.currentIndex>=d.currentSize&&t(d),d.currentChunk[d.currentIndex++]=h,d.elementCount++;return d.elementCount}m.addRepeat=a;function s(d,p){let{elementSize:h}=d;for(let f=0,y=p.length;f<y;f+=h){d.currentIndex>=d.currentSize&&t(d);let{currentChunk:g}=d;for(let x=0;x<h;x++)g[d.currentIndex++]=p[f+x];d.elementCount++}return d.elementCount}m.addMany=s;function l(d,p=!1){return u(d,p)}m.compact=l;function u(d,p){let{ctor:h,chunks:f,currentIndex:y}=d;if(!f.length)return new h(0);if(f.length===1&&(p||y===d.allocatedSize))return f[0];let g=0;for(let v=0,A=f.length-1;v<A;v++)g+=f[v].length;g+=d.currentIndex;let x=new h(g),S=0;if(x.buffer)for(let v=0,A=f.length-1;v<A;v++)x.set(f[v],S),S+=f[v].length;else for(let v=0,A=f.length-1;v<A;v++){let _=f[v];for(let T=0,w=_.length;T<w;T++)x[S+T]=_[T];S+=_.length}let I=f[f.length-1];if(x.buffer&&y>=d.currentSize)x.set(I,S);else for(let v=0,A=I.length;v<A;v++)x[S+v]=I[v];return x}m._compact=u;function c(d,p,h,f){let y={ctor:d,elementSize:p,growBy:Math.max(1,Math.ceil(h)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof f>"u")return y;if(typeof f=="number")return y.currentChunk=new d(f*p),y.allocatedSize=f*p,y.currentSize=y.currentChunk.length,y.chunks[0]=y.currentChunk,y;let g=f;if(g.length%p!==0)throw new Error("initialChunk length must be a multiple of the element size.");return y.currentChunk=g,y.allocatedSize=g.length,y.currentSize=g.length,y.chunks[0]=g,y}m.create=c})(Qe||={});function uw(e,t,r){return e[t]-e[r]}function zg(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function hee(e,t,r,n){let o=r+n>>1;return t(e,r,n)>0?t(e,r,o)>0?t(e,o,n)>0?o:n:r:t(e,n,o)>0?t(e,o,r)>0?o:r:n}function TMe(e,t,r){let{cmp:n,swap:o,data:i,parts:a}=e,s=t+1,l=r;for(o(i,t,hee(i,n,t,r));n(i,l,t)>0;)--l;for(let u=t+1;u<=l;u++){let c=n(i,u,t);if(c>0){for(o(i,u,l),--l;n(i,l,t)>0;)--l;u--}else c===0&&(o(i,u,s),s++)}for(let u=t;u<s;u++)o(i,u,t+l-u);a[0]=l-s+t+1,a[1]=l}function PMe({data:e,cmp:t,swap:r},n,o){for(let i=n+1;i<=o;i++){let a=i-1;for(;a>=n&&t(e,a,a+1)>0;)r(e,a,a+1),a=a-1}}function cw(e,t,r){let{parts:n}=e;for(;t<r;){if(r-t<16){PMe(e,t,r);return}TMe(e,t,r);let o=n[0],i=n[1];o-t<r-i?(cw(e,t,o-1),t=i+1):(cw(e,i+1,r),r=o-1)}}function _Me(e,t,r,n){let o=r+1,i=n;zg(e,r,hee(e,uw,r,n));let a=e[r];for(;e[i]>a;)--i;for(let s=r+1;s<=i;s++){let l=e[s];if(l>a){for(zg(e,s,i),--i;e[i]>a;)--i;s--}else l===a&&(zg(e,s,o),++o)}for(let s=r;s<o;s++)zg(e,s,r+i-s);t[0]=i-o+r+1,t[1]=i}function RMe(e,t,r){for(let n=t+1;n<=r;n++){let o=e[n],i=n-1;for(;i>=t&&e[i]>o;)e[i+1]=e[i],i=i-1;e[i+1]=o}}function ZU(e,t,r,n){for(;r<n;){if(n-r<16){RMe(e,r,n);return}_Me(e,t,r,n);let o=t[0],i=t[1];o-r<n-i?(ZU(e,t,r,o-1),r=i+1):(ZU(e,t,i+1,n),n=o-1)}}function Fs(e,t=uw){return DMe(e,0,e.length,t)}function DMe(e,t,r,n=uw){return n===uw?ZU(e,[0,0],t,r-1):cw({data:e,cmp:n,swap:zg,parts:[0,0]},t,r-1),e}function mw(e,t,r,n,o){return cw({data:e,cmp:n,swap:o,parts:[0,0]},t,r-1),e}function wMe(e,t,r){return e[t].key<e[r].key?-1:1}function EMe(e,t,r,n,o){let i=new Map,a=[],s=t(e[0]),l=!0;for(let p=n;p<o;p++){let h=t(e[p]);if(i.has(h))i.get(h).count++,s!==h&&(l=!1);else{let f={key:h,count:1,offset:p};i.set(h,f),a[a.length]=f}s=h}let u=new Int32Array(a.length+1);u[a.length]=o;let c=!0;if(r){for(let p=1,h=a.length;p<h;p++)if(a[p-1].key>a[p].key){c=!1;break}}if(l&&c){for(let p=0;p<a.length;p++)u[p]=a[p].offset;return u}r&&!c&&mw(a,0,a.length,wMe,zg);let m=0;for(let p=0;p<a.length;p++){let h=a[p];h.offset=m,m+=h.count}let d=new Int32Array(o-n);for(let p=n;p<o;p++){let h=t(e[p]),f=i.get(h);d[f.offset++]=e[p]}for(let p=0,h=d.length;p<h;p++)e[p+n]=d[p];u[0]=n;for(let p=1;p<a.length;p++)u[p]=a[p-1].offset+n;return u}function dw(e,t,r){let n=r&&r.start||0,o=r&&r.end||e.length;if(o-n<=0)throw new Error("Can only bucket non-empty collections.");return EMe(e,t,!!(r&&r.sort),n,o)}var qU=class{constructor(t,r){this.getHash=t;this.areEqual=r;this.id=0;this.byHash=new Map;this.groups=[]}createGroup(t,r){let n=this.id++,o=[t];return this.groups[n]=o,{id:n,keys:o,value:r}}add(t,r){let n=this.getHash(r);if(this.byHash.has(n)){let o=this.byHash.get(n);for(let a=0,s=o.length;a<s;a++){let l=o[a];if(this.areEqual(r,l.value))return l.keys[l.keys.length]=t,l.value}let i=this.createGroup(t,r);return o[o.length]=i,i.value}else{let o=this.createGroup(t,r);return this.byHash.set(n,[o]),o.value}}};function gee(e,t){return new qU(e,t)}function pw(e){let t=e^e>>4;return t=(t^3735928559)+(t<<5),t=t^t>>11,t}function Du(e,t){let r=23;return r=31*r+e|0,r=31*r+t|0,r=r^r>>4,r=(r^3735928559)+(r<<5),r=r^r>>11,r}function yee(e,t,r){let n=23;return n=31*n+e|0,n=31*n+t|0,n=31*n+r|0,n=n^n>>4,n=(n^3735928559)+(n<<5),n=n^n>>11,n}function bee(e,t,r,n){let o=23;return o=31*o+e|0,o=31*o+t|0,o=31*o+r|0,o=31*o+n|0,o=o^o>>4,o=(o^3735928559)+(o<<5),o=o^o>>11,o}function KC(e){let t=0;for(let r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return t}function Xi(e,t){return(e+t)*(e+t+1)/2+t}function cc(e,t){return e<t?Xi(e,t):Xi(t,e)}function N1(e,t){let r=Math.floor((Math.sqrt(8*t+1)-1)/2),n=(r*r+r)/2,o=t-n;return e[0]=r-o,e[1]=o,e}function Ro(e){let t=2166136261;for(let r=0,n=e.length;r<n;++r)t^=e[r],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}var bi={};Bi(bi,{createAndFillArray:()=>MMe,createArray:()=>JC,fillArrayValues:()=>xee,getArrayBounds:()=>wb,isTypedArray:()=>fw,typedArrayWindow:()=>hw});function wb(e,t){let r=t&&typeof t.start<"u"?Math.max(Math.min(t.start,e-1),0):0,n=t&&typeof t.end<"u"?Math.min(t.end,e):e;return{start:r,end:n}}function JC(e,t){let r=t&&typeof t.array<"u"?t.array:Array,{start:n,end:o}=wb(e,t);return{array:new r(o-n),start:n,end:o}}function xee(e,t,r){for(let n=0,o=t.length;n<o;n++)t[n]=e(r+n);return t}function MMe(e,t,r){let{array:n,start:o}=JC(e,r);return xee(t,n,o)}function fw(e){return!!e.buffer&&typeof e.byteLength=="number"&&typeof e.BYTES_PER_ELEMENT=="number"}function hw(e,t){let{constructor:r,buffer:n,length:o,byteOffset:i,BYTES_PER_ELEMENT:a}=e,{start:s,end:l}=wb(o,t);return s===0&&l===o?e:new r(n,i+a*s,Math.min(o,l-s))}function eo(e,t,r){return Math.abs(e-t)<=r}var YU=isFinite;function b(){return b.zero()}(qt=>{function e(){let pe=[.1,0,0];return pe[0]=0,pe}qt.zero=e;function t(pe){let _e=e();return _e[0]=pe[0],_e[1]=pe[1],_e[2]=pe[2],_e}qt.clone=t;function r(pe){return YU(pe[0])&&YU(pe[1])&&YU(pe[2])}qt.isFinite=r;function n(pe){return isNaN(pe[0])||isNaN(pe[1])||isNaN(pe[2])}qt.hasNaN=n;function o(pe){return pe[0]=NaN,pe[1]=NaN,pe[2]=NaN,pe}qt.setNaN=o;function i(pe){return u(pe.x,pe.y,pe.z)}qt.fromObj=i;function a(pe){return{x:pe[0],y:pe[1],z:pe[2]}}qt.toObj=a;function s(pe,_e,de){return pe[0]=_e[de+0],pe[1]=_e[de+1],pe[2]=_e[de+2],pe}qt.fromArray=s;function l(pe,_e,de){return _e[de+0]=pe[0],_e[de+1]=pe[1],_e[de+2]=pe[2],_e}qt.toArray=l;function u(pe,_e,de){let Me=e();return Me[0]=pe,Me[1]=_e,Me[2]=de,Me}qt.create=u;function c(pe){let _e=e();return _e[0]=pe[0],_e[1]=pe[1],_e[2]=pe[2],_e}qt.ofArray=c;function m(pe,_e,de,Me){return pe[0]=_e,pe[1]=de,pe[2]=Me,pe}qt.set=m;function d(pe,_e){return pe[0]=_e[0],pe[1]=_e[1],pe[2]=_e[2],pe}qt.copy=d;function p(pe,_e,de){return pe[0]=_e[0]+de[0],pe[1]=_e[1]+de[1],pe[2]=_e[2]+de[2],pe}qt.add=p;function h(pe,_e,de){return pe[0]=_e[0]-de[0],pe[1]=_e[1]-de[1],pe[2]=_e[2]-de[2],pe}qt.sub=h;function f(pe,_e,de){return pe[0]=_e[0]*de[0],pe[1]=_e[1]*de[1],pe[2]=_e[2]*de[2],pe}qt.mul=f;function y(pe,_e,de){return pe[0]=_e[0]/de[0],pe[1]=_e[1]/de[1],pe[2]=_e[2]/de[2],pe}qt.div=y;function g(pe,_e,de){return pe[0]=_e[0]*de,pe[1]=_e[1]*de,pe[2]=_e[2]*de,pe}qt.scale=g;function x(pe,_e,de,Me){return pe[0]=_e[0]+de[0]*Me,pe[1]=_e[1]+de[1]*Me,pe[2]=_e[2]+de[2]*Me,pe}qt.scaleAndAdd=x;function S(pe,_e,de,Me){return pe[0]=_e[0]-de[0]*Me,pe[1]=_e[1]-de[1]*Me,pe[2]=_e[2]-de[2]*Me,pe}qt.scaleAndSub=S;function I(pe,_e,de){return pe[0]=_e[0]+de,pe[1]=_e[1]+de,pe[2]=_e[2]+de,pe}qt.addScalar=I;function v(pe,_e,de){return pe[0]=_e[0]-de,pe[1]=_e[1]-de,pe[2]=_e[2]-de,pe}qt.subScalar=v;function A(pe,_e){return pe[0]=Math.round(_e[0]),pe[1]=Math.round(_e[1]),pe[2]=Math.round(_e[2]),pe}qt.round=A;function _(pe,_e){return pe[0]=Math.ceil(_e[0]),pe[1]=Math.ceil(_e[1]),pe[2]=Math.ceil(_e[2]),pe}qt.ceil=_;function T(pe,_e){return pe[0]=Math.floor(_e[0]),pe[1]=Math.floor(_e[1]),pe[2]=Math.floor(_e[2]),pe}qt.floor=T;function w(pe,_e){return pe[0]=Math.trunc(_e[0]),pe[1]=Math.trunc(_e[1]),pe[2]=Math.trunc(_e[2]),pe}qt.trunc=w;function D(pe,_e){return pe[0]=Math.abs(_e[0]),pe[1]=Math.abs(_e[1]),pe[2]=Math.abs(_e[2]),pe}qt.abs=D;function M(pe,_e,de){return pe[0]=Math.min(_e[0],de[0]),pe[1]=Math.min(_e[1],de[1]),pe[2]=Math.min(_e[2],de[2]),pe}qt.min=M;function E(pe,_e,de){return pe[0]=Math.max(_e[0],de[0]),pe[1]=Math.max(_e[1],de[1]),pe[2]=Math.max(_e[2],de[2]),pe}qt.max=E;function R(pe,_e,de,Me){return pe[0]=Math.max(de[0],Math.min(Me[0],_e[0])),pe[1]=Math.max(de[1],Math.min(Me[1],_e[1])),pe[2]=Math.max(de[2],Math.min(Me[2],_e[2])),pe}qt.clamp=R;function k(pe,_e){let de=_e[0]-pe[0],Me=_e[1]-pe[1],fe=_e[2]-pe[2];return Math.sqrt(de*de+Me*Me+fe*fe)}qt.distance=k;function B(pe,_e){let de=_e[0]-pe[0],Me=_e[1]-pe[1],fe=_e[2]-pe[2];return de*de+Me*Me+fe*fe}qt.squaredDistance=B;function L(pe){let _e=pe[0],de=pe[1],Me=pe[2];return Math.sqrt(_e*_e+de*de+Me*Me)}qt.magnitude=L;function V(pe){let _e=pe[0],de=pe[1],Me=pe[2];return _e*_e+de*de+Me*Me}qt.squaredMagnitude=V;function U(pe,_e,de){return g(pe,q(pe,_e),de)}qt.setMagnitude=U;function Q(pe,_e){return pe[0]=-_e[0],pe[1]=-_e[1],pe[2]=-_e[2],pe}qt.negate=Q;function O(pe,_e){return pe[0]=1/_e[0],pe[1]=1/_e[1],pe[2]=1/_e[2],pe}qt.inverse=O;function q(pe,_e){let de=_e[0],Me=_e[1],fe=_e[2],Le=de*de+Me*Me+fe*fe;return Le>0&&(Le=1/Math.sqrt(Le),pe[0]=_e[0]*Le,pe[1]=_e[1]*Le,pe[2]=_e[2]*Le),pe}qt.normalize=q;function X(pe,_e){return pe[0]*_e[0]+pe[1]*_e[1]+pe[2]*_e[2]}qt.dot=X;function F(pe,_e,de){let Me=_e[0],fe=_e[1],Le=_e[2],vt=de[0],zt=de[1],jt=de[2];return pe[0]=fe*jt-Le*zt,pe[1]=Le*vt-Me*jt,pe[2]=Me*zt-fe*vt,pe}qt.cross=F;function Y(pe,_e,de,Me){let fe=_e[0],Le=_e[1],vt=_e[2];return pe[0]=fe+Me*(de[0]-fe),pe[1]=Le+Me*(de[1]-Le),pe[2]=vt+Me*(de[2]-vt),pe}qt.lerp=Y;let $=e();function ce(pe,_e,de,Me){let fe=Br(X(_e,de),-1,1),Le=Math.acos(fe)*Me;return x($,de,_e,-fe),q($,$),p(pe,g(pe,_e,Math.cos(Le)),g($,$,Math.sin(Le)))}qt.slerp=ce;function ie(pe,_e,de,Me,fe,Le){let vt=Le*Le,zt=vt*(2*Le-3)+1,jt=vt*(Le-2)+Le,mr=vt*(Le-1),Io=vt*(3-2*Le);return pe[0]=_e[0]*zt+de[0]*jt+Me[0]*mr+fe[0]*Io,pe[1]=_e[1]*zt+de[1]*jt+Me[1]*mr+fe[1]*Io,pe[2]=_e[2]*zt+de[2]*jt+Me[2]*mr+fe[2]*Io,pe}qt.hermite=ie;function oe(pe,_e,de,Me,fe,Le){let vt=1-Le,zt=vt*vt,jt=Le*Le,mr=zt*vt,Io=3*Le*zt,ni=3*jt*vt,ua=jt*Le;return pe[0]=_e[0]*mr+de[0]*Io+Me[0]*ni+fe[0]*ua,pe[1]=_e[1]*mr+de[1]*Io+Me[1]*ni+fe[1]*ua,pe[2]=_e[2]*mr+de[2]*Io+Me[2]*ni+fe[2]*ua,pe}qt.bezier=oe;function W(pe,_e,de,Me,fe){return pe[0]=iw(_e[0],de[0],Me[0],fe),pe[1]=iw(_e[1],de[1],Me[1],fe),pe[2]=iw(_e[2],de[2],Me[2],fe),pe}qt.quadraticBezier=W;function N(pe,_e,de,Me,fe,Le,vt){return pe[0]=G1(_e[0],de[0],Me[0],fe[0],Le,vt),pe[1]=G1(_e[1],de[1],Me[1],fe[1],Le,vt),pe[2]=G1(_e[2],de[2],Me[2],fe[2],Le,vt),pe}qt.spline=N;function j(pe,_e){let de=Math.random()*2*Math.PI,Me=Math.random()*2-1,fe=Math.sqrt(1-Me*Me)*_e;return pe[0]=Math.cos(de)*fe,pe[1]=Math.sin(de)*fe,pe[2]=Me*_e,pe}qt.random=j;function ue(pe,_e,de){let Me=_e[0],fe=_e[1],Le=_e[2],vt=1/(de[3]*Me+de[7]*fe+de[11]*Le+de[15]||1);return pe[0]=(de[0]*Me+de[4]*fe+de[8]*Le+de[12])*vt,pe[1]=(de[1]*Me+de[5]*fe+de[9]*Le+de[13])*vt,pe[2]=(de[2]*Me+de[6]*fe+de[10]*Le+de[14])*vt,pe}qt.transformMat4=ue;function be(pe,_e,de){let Me=_e[0],fe=_e[1],Le=_e[2];return pe[0]=de[0]*Me+de[4]*fe+de[8]*Le,pe[1]=de[1]*Me+de[5]*fe+de[9]*Le,pe[2]=de[2]*Me+de[6]*fe+de[10]*Le,q(pe,pe)}qt.transformDirection=be;function ee(pe,_e,de,Me,fe,Le){let vt=_e[0+fe],zt=_e[1+fe],jt=_e[2+fe],mr=1/(de[3+Le]*vt+de[7+Le]*zt+de[11+Le]*jt+de[15+Le]||1);return pe[0+Me]=(de[0+Le]*vt+de[4+Le]*zt+de[8+Le]*jt+de[12+Le])*mr,pe[1+Me]=(de[1+Le]*vt+de[5+Le]*zt+de[9+Le]*jt+de[13+Le])*mr,pe[2+Me]=(de[2+Le]*vt+de[6+Le]*zt+de[10+Le]*jt+de[14+Le])*mr,pe}qt.transformMat4Offset=ee;function le(pe,_e,de,Me,fe,Le){let vt=_e[0+fe],zt=_e[1+fe],jt=_e[2+fe];pe[0+Me]=de[0+Le]*vt+de[4+Le]*zt+de[8+Le]*jt,pe[1+Me]=de[1+Le]*vt+de[5+Le]*zt+de[9+Le]*jt,pe[2+Me]=de[2+Le]*vt+de[6+Le]*zt+de[10+Le]*jt;let mr=Math.hypot(pe[0+Me],pe[1+Me],pe[2+Me]);return mr>0&&(pe[0+Me]/=mr,pe[1+Me]/=mr,pe[2+Me]/=mr),pe}qt.transformDirectionOffset=le;function Ae(pe,_e,de){let Me=_e[0],fe=_e[1],Le=_e[2];return pe[0]=Me*de[0]+fe*de[3]+Le*de[6],pe[1]=Me*de[1]+fe*de[4]+Le*de[7],pe[2]=Me*de[2]+fe*de[5]+Le*de[8],pe}qt.transformMat3=Ae;function Ce(pe,_e,de){let Me=_e[0],fe=_e[1],Le=_e[2],vt=de[0],zt=de[1],jt=de[2],mr=de[3],Io=mr*Me+zt*Le-jt*fe,ni=mr*fe+jt*Me-vt*Le,ua=mr*Le+vt*fe-zt*Me,Go=-vt*Me-zt*fe-jt*Le;return pe[0]=Io*mr+Go*-vt+ni*-jt-ua*-zt,pe[1]=ni*mr+Go*-zt+ua*-vt-Io*-jt,pe[2]=ua*mr+Go*-jt+Io*-zt-ni*-vt,pe}qt.transformQuat=Ce;function J(pe,_e){let de=Math.sqrt(V(pe)*V(_e));if(de===0)return Math.PI/2;let Me=X(pe,_e)/de;return Math.acos(Br(Me,-1,1))}qt.angle=J;let z=e(),ae=e(),ge=e(),ve=e(),Oe=e(),ze=e(),Re=e();function Ke(pe,_e,de,Me){h(z,pe,_e),h(ae,de,_e),h(ge,_e,de),h(ve,Me,de),F(Oe,z,ae),F(ze,ge,ve);let fe=J(Oe,ze);return F(Re,Oe,ze),X(ae,Re)>0?fe:-fe}qt.dihedralAngle=Ke;function tt(pe,_e,de,Me){return qt.set(pe,Me*Math.cos(de)*Math.sin(_e),Me*Math.sin(de)*Math.sin(_e),Me*Math.cos(_e))}qt.directionFromSpherical=tt;function bt(pe,_e){return pe[0]===_e[0]&&pe[1]===_e[1]&&pe[2]===_e[2]}qt.exactEquals=bt;function Pt(pe,_e){let de=pe[0],Me=pe[1],fe=pe[2],Le=_e[0],vt=_e[1],zt=_e[2];return Math.abs(de-Le)<=1e-6*Math.max(1,Math.abs(de),Math.abs(Le))&&Math.abs(Me-vt)<=1e-6*Math.max(1,Math.abs(Me),Math.abs(vt))&&Math.abs(fe-zt)<=1e-6*Math.max(1,Math.abs(fe),Math.abs(zt))}qt.equals=Pt;let fr=e();function gt(pe,_e,de){let Me=J(_e,de);if(Math.abs(Me)<1e-4)return Z.setIdentity(pe);if(Math.abs(Me-Math.PI)<1e-6)return Z.fromRotation(pe,Math.PI,Math.abs(_e[0])<.9?qt.unitX:qt.unitZ);let fe=F(fr,_e,de);return Z.fromRotation(pe,Me,fe)}qt.makeRotation=gt;function Sr(pe){return pe[0]===0&&pe[1]===0&&pe[2]===0}qt.isZero=Sr;function zr(pe,_e,de,Me){h(pe,_e,Me);let fe=X(de,pe)/V(de);return p(pe,g(pe,de,fe),Me)}qt.projectPointOnVector=zr;let Nn=e();function xn(pe,_e,de,Me){return q(Nn,de),h(pe,_e,Me),h(pe,_e,g(Nn,Nn,X(pe,Nn)))}qt.projectPointOnPlane=xn;function In(pe,_e,de){let Me=X(de,_e)/V(de);return g(pe,de,Me)}qt.projectOnVector=In;let zn=e();function hi(pe,_e,de){return In(zn,_e,de),h(pe,_e,zn)}qt.projectOnPlane=hi;function nl(pe,_e,de){return q(pe,F(pe,F(pe,_e,de),_e))}qt.orthogonalize=nl;function fo(pe,_e,de){return X(_e,de)>0?d(pe,_e):Q(pe,d(pe,_e)),pe}qt.matchDirection=fo;function G(pe,_e){if(Sr(_e))return d(pe,qt.unitX);{let de=e();return Math.abs(_e[0])<Math.abs(_e[1])&&Math.abs(_e[0])<Math.abs(_e[2])?(de[0]=0,de[1]=_e[2],de[2]=-_e[1]):Math.abs(_e[1])<Math.abs(_e[2])?(de[0]=-_e[2],de[1]=0,de[2]=_e[0]):(de[0]=_e[1],de[1]=-_e[0],de[2]=0),q(pe,de)}}qt.orthogonalDirection=G;let te=e(),Ge=e();function Ze(pe,_e,de,Me){return h(te,de,_e),h(Ge,Me,_e),q(pe,F(pe,te,Ge))}qt.triangleNormal=Ze;let lt=e();function xt(pe,_e,de){return qt.scaleAndAdd(pe,_e,qt.sub(lt,de,_e),.5)}qt.center=xt;function At(pe,_e){return`[${pe[0].toPrecision(_e)} ${pe[1].toPrecision(_e)} ${pe[2].toPrecision(_e)}]`}qt.toString=At,qt.origin=u(0,0,0),qt.unit=u(1,1,1),qt.negUnit=u(-1,-1,-1),qt.unitX=u(1,0,0),qt.unitY=u(0,1,0),qt.unitZ=u(0,0,1),qt.negUnitX=u(-1,0,0),qt.negUnitY=u(0,-1,0),qt.negUnitZ=u(0,0,-1)})(b||={});function Ot(){return Ot.zero()}(oe=>{function e(){let W=[.1,0,0,0,0,0,0,0,0];return W[0]=0,W}oe.zero=e;function t(){let W=e();return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=1,W[5]=0,W[6]=0,W[7]=0,W[8]=1,W}oe.identity=t;function r(W){return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=1,W[5]=0,W[6]=0,W[7]=0,W[8]=1,W}oe.setIdentity=r;function n(W,N,j){return N[j+0]=W[0],N[j+1]=W[1],N[j+2]=W[2],N[j+3]=W[3],N[j+4]=W[4],N[j+5]=W[5],N[j+6]=W[6],N[j+7]=W[7],N[j+8]=W[8],N}oe.toArray=n;function o(W,N,j){return W[0]=N[j+0],W[1]=N[j+1],W[2]=N[j+2],W[3]=N[j+3],W[4]=N[j+4],W[5]=N[j+5],W[6]=N[j+6],W[7]=N[j+7],W[8]=N[j+8],W}oe.fromArray=o;function i(W,N,j,ue){return W[0]=N[0],W[1]=N[1],W[2]=N[2],W[3]=j[0],W[4]=j[1],W[5]=j[2],W[6]=ue[0],W[7]=ue[1],W[8]=ue[2],W}oe.fromColumns=i;function a(W,N){return W[0]=N[0],W[1]=N[1],W[2]=N[2],W[3]=N[4],W[4]=N[5],W[5]=N[6],W[6]=N[8],W[7]=N[9],W[8]=N[10],W}oe.fromMat4=a;let s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function l(W,N,j){return Z.fromEuler(s,N,j),a(W,s)}oe.fromEuler=l;function u(W,N,j,ue,be,ee,le,Ae,Ce){let J=e();return J[0]=W,J[1]=N,J[2]=j,J[3]=ue,J[4]=be,J[5]=ee,J[6]=le,J[7]=Ae,J[8]=Ce,J}oe.create=u;let c=t();function m(W,N){return h(W,c,typeof N>"u"?1e-6:N)}oe.isIdentity=m;function d(W){for(let N=0;N<9;N++)if(isNaN(W[N]))return!0;return!1}oe.hasNaN=d;function p(W){return g(e(),W)}oe.clone=p;function h(W,N,j){for(let ue=0;ue<9;ue++)if(Math.abs(W[ue]-N[ue])>j)return!1;return!0}oe.areEqual=h;function f(W,N,j,ue){W[3*j+N]=ue}oe.setValue=f;function y(W,N,j){return W[3*j+N]}oe.getValue=y;function g(W,N){return W[0]=N[0],W[1]=N[1],W[2]=N[2],W[3]=N[3],W[4]=N[4],W[5]=N[5],W[6]=N[6],W[7]=N[7],W[8]=N[8],W}oe.copy=g;function x(W,N){if(W===N){let j=N[1],ue=N[2],be=N[5];W[1]=N[3],W[2]=N[6],W[3]=j,W[5]=N[7],W[6]=ue,W[7]=be}else W[0]=N[0],W[1]=N[3],W[2]=N[6],W[3]=N[1],W[4]=N[4],W[5]=N[7],W[6]=N[2],W[7]=N[5],W[8]=N[8];return W}oe.transpose=x;function S(W,N){let j=N[0],ue=N[1],be=N[2],ee=N[3],le=N[4],Ae=N[5],Ce=N[6],J=N[7],z=N[8],ae=z*le-Ae*J,ge=-z*ee+Ae*Ce,ve=J*ee-le*Ce,Oe=j*ae+ue*ge+be*ve;return Oe?(Oe=1/Oe,W[0]=ae*Oe,W[1]=(-z*ue+be*J)*Oe,W[2]=(Ae*ue-be*le)*Oe,W[3]=ge*Oe,W[4]=(z*j-be*Ce)*Oe,W[5]=(-Ae*j+be*ee)*Oe,W[6]=ve*Oe,W[7]=(-J*j+ue*Ce)*Oe,W[8]=(le*j-ue*ee)*Oe,W):(console.warn("non-invertible matrix.",N),W)}oe.invert=S;function I(W,N){return W===N?(W[3]=N[1],W[6]=N[2],W[7]=N[5]):(W[0]=N[0],W[1]=N[1],W[2]=N[2],W[3]=N[1],W[4]=N[4],W[5]=N[5],W[6]=N[2],W[7]=N[5],W[8]=N[8]),W}oe.symmtricFromUpper=I;function v(W,N){return W===N?(W[1]=N[3],W[2]=N[6],W[5]=N[7]):(W[0]=N[0],W[1]=N[3],W[2]=N[6],W[3]=N[3],W[4]=N[4],W[5]=N[7],W[6]=N[6],W[7]=N[7],W[8]=N[8]),W}oe.symmtricFromLower=v;function A(W){let N=W[0],j=W[1],ue=W[2],be=W[3],ee=W[4],le=W[5],Ae=W[6],Ce=W[7],J=W[8],z=J*ee-le*Ce,ae=-J*be+le*Ae,ge=Ce*be-ee*Ae;return N*z+j*ae+ue*ge}oe.determinant=A;function _(W){return W[0]+W[4]+W[8]}oe.trace=_;function T(W,N,j){return W[0]=N[0]-j[0],W[1]=N[1]-j[1],W[2]=N[2]-j[2],W[3]=N[3]-j[3],W[4]=N[4]-j[4],W[5]=N[5]-j[5],W[6]=N[6]-j[6],W[7]=N[7]-j[7],W[8]=N[8]-j[8],W}oe.sub=T;function w(W,N,j){return W[0]=N[0]+j[0],W[1]=N[1]+j[1],W[2]=N[2]+j[2],W[3]=N[3]+j[3],W[4]=N[4]+j[4],W[5]=N[5]+j[5],W[6]=N[6]+j[6],W[7]=N[7]+j[7],W[8]=N[8]+j[8],W}oe.add=w;function D(W,N,j){let ue=N[0],be=N[1],ee=N[2],le=N[3],Ae=N[4],Ce=N[5],J=N[6],z=N[7],ae=N[8],ge=j[0],ve=j[1],Oe=j[2],ze=j[3],Re=j[4],Ke=j[5],tt=j[6],bt=j[7],Pt=j[8];return W[0]=ge*ue+ve*le+Oe*J,W[1]=ge*be+ve*Ae+Oe*z,W[2]=ge*ee+ve*Ce+Oe*ae,W[3]=ze*ue+Re*le+Ke*J,W[4]=ze*be+Re*Ae+Ke*z,W[5]=ze*ee+Re*Ce+Ke*ae,W[6]=tt*ue+bt*le+Pt*J,W[7]=tt*be+bt*Ae+Pt*z,W[8]=tt*ee+bt*Ce+Pt*ae,W}oe.mul=D;function M(W,N,j){return W[0]=N[0]-j,W[1]=N[1]-j,W[2]=N[2]-j,W[3]=N[3]-j,W[4]=N[4]-j,W[5]=N[5]-j,W[6]=N[6]-j,W[7]=N[7]-j,W[8]=N[8]-j,W}oe.subScalar=M;function E(W,N,j){return W[0]=N[0]+j,W[1]=N[1]+j,W[2]=N[2]+j,W[3]=N[3]+j,W[4]=N[4]+j,W[5]=N[5]+j,W[6]=N[6]+j,W[7]=N[7]+j,W[8]=N[8]+j,W}oe.addScalar=E;function R(W,N,j){return W[0]=N[0]*j,W[1]=N[1]*j,W[2]=N[2]*j,W[3]=N[3]*j,W[4]=N[4]*j,W[5]=N[5]*j,W[6]=N[6]*j,W[7]=N[7]*j,W[8]=N[8]*j,W}oe.mulScalar=R;let k=Math.PI/3,B=e();function L(W,N){let j=N[1]*N[1]+N[2]*N[2]+N[5]*N[5];if(j===0)W[0]=N[0],W[1]=N[4],W[2]=N[8];else{let ue=_(N)/3,be=N[0]-ue,ee=N[4]-ue,le=N[8]-ue,Ae=be*be+ee*ee+le*le+2*j,Ce=Math.sqrt(Ae/6);R(B,oe.Identity,ue),T(B,N,B),R(B,B,1/Ce);let J=A(B)/2,z=J<=-1?k:J>=1?0:Math.acos(J)/3;W[0]=ue+2*Ce*Math.cos(z),W[2]=ue+2*Ce*Math.cos(z+2*k),W[1]=3*ue-W[0]-W[2]}return W}oe.symmetricEigenvalues=L;let V=[.1,0,0],U=[.1,0,0],Q=[.1,0,0],O=[.1,0,0],q=[.1,0,0],X=[.1,0,0];function F(W,N,j){b.set(V,N[0]-j,N[1],N[2]),b.set(U,N[1],N[4]-j,N[5]),b.set(Q,N[2],N[5],N[8]-j),b.cross(O,V,U),b.cross(q,V,Q),b.cross(X,U,Q);let ue=b.dot(O,O),be=b.dot(q,q),ee=b.dot(X,X),le=ue,Ae=0;return be>le&&(le=be,Ae=1),ee>le&&(Ae=2),Ae===0?b.scale(W,O,1/Math.sqrt(ue)):Ae===1?b.scale(W,q,1/Math.sqrt(be)):b.scale(W,X,1/Math.sqrt(ee)),W}oe.eigenvector=F;function Y(W,N){return a(W,N),S(W,W),x(W,W),W}oe.directionTransform=Y,oe.Identity=t();function ce(W,N){return W[0]*N[0]+W[1]*N[1]+W[2]*N[2]+W[3]*N[3]+W[4]*N[4]+W[5]*N[5]+W[6]*N[6]+W[7]*N[7]+W[8]*N[8]}oe.innerProduct=ce;function ie(W,N){let j=N[0],ue=N[1],be=N[2],ee=N[4],le=N[5],Ae=N[6],Ce=N[8],J=N[9],z=N[10];return W[0]=le*z-Ae*J,W[1]=Ae*Ce-ee*z,W[2]=ee*J-le*Ce,W[3]=J*be-z*ue,W[4]=z*j-Ce*be,W[5]=Ce*ue-J*j,W[6]=ue*Ae-be*le,W[7]=be*ee-j*Ae,W[8]=j*le-ue*ee,W}oe.adjointFromMat4=ie})(Ot||={});function $C(e){return Object.keys(e)}function Rr(e){throw new Error("unreachable")}function Eb(e){return typeof e?.then=="function"}function Tr(){return Tr.zero()}(be=>{function e(){let ee=[.1,0,0,0];return ee[0]=0,ee}be.zero=e;function t(){let ee=e();return ee[3]=1,ee}be.identity=t;function r(ee){ee[0]=0,ee[1]=0,ee[2]=0,ee[3]=1}be.setIdentity=r;function n(ee){return isNaN(ee[0])||isNaN(ee[1])||isNaN(ee[2])||isNaN(ee[3])}be.hasNaN=n;function o(ee,le,Ae,Ce){let J=t();return J[0]=ee,J[1]=le,J[2]=Ae,J[3]=Ce,J}be.create=o;function i(ee,le,Ae){Ae=Ae*.5;let Ce=Math.sin(Ae);return ee[0]=Ce*le[0],ee[1]=Ce*le[1],ee[2]=Ce*le[2],ee[3]=Math.cos(Ae),ee}be.setAxisAngle=i;function a(ee,le){let Ae=Math.acos(le[3])*2,Ce=Math.sin(Ae/2);return Ce!==0?(ee[0]=le[0]/Ce,ee[1]=le[1]/Ce,ee[2]=le[2]/Ce):(ee[0]=1,ee[1]=0,ee[2]=0),Ae}be.getAxisAngle=a;function s(ee,le,Ae){let Ce=le[0],J=le[1],z=le[2],ae=le[3],ge=Ae[0],ve=Ae[1],Oe=Ae[2],ze=Ae[3];return ee[0]=Ce*ze+ae*ge+J*Oe-z*ve,ee[1]=J*ze+ae*ve+z*ge-Ce*Oe,ee[2]=z*ze+ae*Oe+Ce*ve-J*ge,ee[3]=ae*ze-Ce*ge-J*ve-z*Oe,ee}be.multiply=s;function l(ee,le,Ae){Ae*=.5;let Ce=le[0],J=le[1],z=le[2],ae=le[3],ge=Math.sin(Ae),ve=Math.cos(Ae);return ee[0]=Ce*ve+ae*ge,ee[1]=J*ve+z*ge,ee[2]=z*ve-J*ge,ee[3]=ae*ve-Ce*ge,ee}be.rotateX=l;function u(ee,le,Ae){Ae*=.5;let Ce=le[0],J=le[1],z=le[2],ae=le[3],ge=Math.sin(Ae),ve=Math.cos(Ae);return ee[0]=Ce*ve-z*ge,ee[1]=J*ve+ae*ge,ee[2]=z*ve+Ce*ge,ee[3]=ae*ve-J*ge,ee}be.rotateY=u;function c(ee,le,Ae){Ae*=.5;let Ce=le[0],J=le[1],z=le[2],ae=le[3],ge=Math.sin(Ae),ve=Math.cos(Ae);return ee[0]=Ce*ve+J*ge,ee[1]=J*ve-Ce*ge,ee[2]=z*ve+ae*ge,ee[3]=ae*ve-z*ge,ee}be.rotateZ=c;function m(ee,le){let Ae=le[0],Ce=le[1],J=le[2];return ee[0]=Ae,ee[1]=Ce,ee[2]=J,ee[3]=Math.sqrt(Math.abs(1-Ae*Ae-Ce*Ce-J*J)),ee}be.calculateW=m;function d(ee,le,Ae,Ce){let J=le[0],z=le[1],ae=le[2],ge=le[3],ve=Ae[0],Oe=Ae[1],ze=Ae[2],Re=Ae[3],Ke,tt,bt,Pt,fr;return tt=J*ve+z*Oe+ae*ze+ge*Re,tt<0&&(tt=-tt,ve=-ve,Oe=-Oe,ze=-ze,Re=-Re),1-tt>1e-6?(Ke=Math.acos(tt),bt=Math.sin(Ke),Pt=Math.sin((1-Ce)*Ke)/bt,fr=Math.sin(Ce*Ke)/bt):(Pt=1-Ce,fr=Ce),ee[0]=Pt*J+fr*ve,ee[1]=Pt*z+fr*Oe,ee[2]=Pt*ae+fr*ze,ee[3]=Pt*ge+fr*Re,ee}be.slerp=d;function p(ee,le){let Ae=le[0],Ce=le[1],J=le[2],z=le[3],ae=Ae*Ae+Ce*Ce+J*J+z*z,ge=ae?1/ae:0;return ee[0]=-Ae*ge,ee[1]=-Ce*ge,ee[2]=-J*ge,ee[3]=z*ge,ee}be.invert=p;function h(ee,le){return ee[0]=-le[0],ee[1]=-le[1],ee[2]=-le[2],ee[3]=le[3],ee}be.conjugate=h;function f(ee,le){return ee[0]*le[0]+ee[1]*le[1]+ee[2]*le[2]+ee[3]*le[3]}be.dot=f;function y(ee,le){let Ae=le[0]+le[4]+le[8],Ce;if(Ae>0)Ce=Math.sqrt(Ae+1),ee[3]=.5*Ce,Ce=.5/Ce,ee[0]=(le[5]-le[7])*Ce,ee[1]=(le[6]-le[2])*Ce,ee[2]=(le[1]-le[3])*Ce;else{let J=0;le[4]>le[0]&&(J=1),le[8]>le[J*3+J]&&(J=2);let z=(J+1)%3,ae=(J+2)%3;Ce=Math.sqrt(le[J*3+J]-le[z*3+z]-le[ae*3+ae]+1),ee[J]=.5*Ce,Ce=.5/Ce,ee[3]=(le[z*3+ae]-le[ae*3+z])*Ce,ee[z]=(le[z*3+J]+le[J*3+z])*Ce,ee[ae]=(le[ae*3+J]+le[J*3+ae])*Ce}return ee}be.fromMat3=y;let g=[0,0,0,0,0,0,0,0,0,0,0,0];function x(ee,le){return Ot.fromMat4(g,le),y(ee,g)}be.fromMat4=x;function S(ee,le,Ae){let[Ce,J,z]=le,ae=Math.cos(Ce/2),ge=Math.cos(J/2),ve=Math.cos(z/2),Oe=Math.sin(Ce/2),ze=Math.sin(J/2),Re=Math.sin(z/2);switch(Ae){case"XYZ":ee[0]=Oe*ge*ve+ae*ze*Re,ee[1]=ae*ze*ve-Oe*ge*Re,ee[2]=ae*ge*Re+Oe*ze*ve,ee[3]=ae*ge*ve-Oe*ze*Re;break;case"YXZ":ee[0]=Oe*ge*ve+ae*ze*Re,ee[1]=ae*ze*ve-Oe*ge*Re,ee[2]=ae*ge*Re-Oe*ze*ve,ee[3]=ae*ge*ve+Oe*ze*Re;break;case"ZXY":ee[0]=Oe*ge*ve-ae*ze*Re,ee[1]=ae*ze*ve+Oe*ge*Re,ee[2]=ae*ge*Re+Oe*ze*ve,ee[3]=ae*ge*ve-Oe*ze*Re;break;case"ZYX":ee[0]=Oe*ge*ve-ae*ze*Re,ee[1]=ae*ze*ve+Oe*ge*Re,ee[2]=ae*ge*Re-Oe*ze*ve,ee[3]=ae*ge*ve+Oe*ze*Re;break;case"YZX":ee[0]=Oe*ge*ve+ae*ze*Re,ee[1]=ae*ze*ve+Oe*ge*Re,ee[2]=ae*ge*Re-Oe*ze*ve,ee[3]=ae*ge*ve-Oe*ze*Re;break;case"XZY":ee[0]=Oe*ge*ve-ae*ze*Re,ee[1]=ae*ze*ve-Oe*ge*Re,ee[2]=ae*ge*Re+Oe*ze*ve,ee[3]=ae*ge*ve+Oe*ze*Re;break;default:Rr(Ae)}return ee}be.fromEuler=S;let I=[0,0,0];function v(ee,le,Ae){let Ce=b.dot(le,Ae)+1;return Ce<1e-6?(Ce=0,Math.abs(le[0])>Math.abs(le[2])?b.set(I,-le[1],le[0],0):b.set(I,0,-le[2],le[1])):b.cross(I,le,Ae),ee[0]=I[0],ee[1]=I[1],ee[2]=I[2],ee[3]=Ce,q(ee,ee),ee}be.fromUnitVec3=v;let A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function _(ee,le,Ae,Ce){return Z.fromBasis(A,le,Ae,Ce),x(ee,A)}be.fromBasis=_;function T(ee){let le=e();return le[0]=ee[0],le[1]=ee[1],le[2]=ee[2],le[3]=ee[3],le}be.clone=T;function w(ee){return o(ee.x,ee.y,ee.z,ee.w)}be.fromObj=w;function D(ee){return{x:ee[0],y:ee[1],z:ee[2],w:ee[3]}}be.toObj=D;function M(ee,le,Ae){return le[Ae+0]=ee[0],le[Ae+1]=ee[1],le[Ae+2]=ee[2],le[Ae+3]=ee[3],le}be.toArray=M;function E(ee,le,Ae){return ee[0]=le[Ae+0],ee[1]=le[Ae+1],ee[2]=le[Ae+2],ee[3]=le[Ae+3],ee}be.fromArray=E;function R(ee,le){return ee[0]=le[0],ee[1]=le[1],ee[2]=le[2],ee[3]=le[3],ee}be.copy=R;function k(ee,le,Ae,Ce,J){return ee[0]=le,ee[1]=Ae,ee[2]=Ce,ee[3]=J,ee}be.set=k;function B(ee,le){return ee[0]===le[0]&&ee[1]===le[1]&&ee[2]===le[2]&&ee[3]===le[3]}be.exactEquals=B;function L(ee,le){let Ae=ee[0],Ce=ee[1],J=ee[2],z=ee[3],ae=le[0],ge=le[1],ve=le[2],Oe=le[3];return Math.abs(Ae-ae)<=1e-6*Math.max(1,Math.abs(Ae),Math.abs(ae))&&Math.abs(Ce-ge)<=1e-6*Math.max(1,Math.abs(Ce),Math.abs(ge))&&Math.abs(J-ve)<=1e-6*Math.max(1,Math.abs(J),Math.abs(ve))&&Math.abs(z-Oe)<=1e-6*Math.max(1,Math.abs(z),Math.abs(Oe))}be.equals=L;function V(ee,le,Ae){return ee[0]=le[0]+Ae[0],ee[1]=le[1]+Ae[1],ee[2]=le[2]+Ae[2],ee[3]=le[3]+Ae[3],ee}be.add=V;function U(ee){let le=ee[0],Ae=ee[1],Ce=ee[2],J=ee[3];return Math.sqrt(le*le+Ae*Ae+Ce*Ce+J*J)}be.magnitude=U;function Q(ee){let le=ee[0],Ae=ee[1],Ce=ee[2],J=ee[3];return le*le+Ae*Ae+Ce*Ce+J*J}be.squaredMagnitude=Q;function O(ee,le){return 2*Math.acos(Math.abs(Br(f(ee,le),-1,1)))}be.angle=O;function q(ee,le){let Ae=le[0],Ce=le[1],J=le[2],z=le[3],ae=Ae*Ae+Ce*Ce+J*J+z*z;return ae>0&&(ae=1/Math.sqrt(ae),ee[0]=Ae*ae,ee[1]=Ce*ae,ee[2]=J*ae,ee[3]=z*ae),ee}be.normalize=q;let X=[0,0,0],F=[1,0,0],Y=[0,1,0];function $(ee,le,Ae){let Ce=b.dot(le,Ae);return Ce<-.999999?(b.cross(X,F,le),b.magnitude(X)<1e-6&&b.cross(X,Y,le),b.normalize(X,X),i(ee,X,Math.PI),ee):Ce>.999999?(ee[0]=0,ee[1]=0,ee[2]=0,ee[3]=1,ee):(b.cross(X,le,Ae),ee[0]=X[0],ee[1]=X[1],ee[2]=X[2],ee[3]=1+Ce,q(ee,ee))}be.rotationTo=$;let ce=e(),ie=e();function oe(ee,le,Ae,Ce,J,z){return d(ce,le,J,z),d(ie,Ae,Ce,z),d(ee,ce,ie,2*z*(1-z)),ee}be.sqlerp=oe;let W=[0,0,0,0,0,0,0,0,0];function N(ee,le,Ae,Ce){return W[0]=Ae[0],W[3]=Ae[1],W[6]=Ae[2],W[1]=Ce[0],W[4]=Ce[1],W[7]=Ce[2],W[2]=-le[0],W[5]=-le[1],W[8]=-le[2],q(ee,y(ee,W))}be.setAxes=N;function j(ee,le){return`[${ee[0].toPrecision(le)} ${ee[1].toPrecision(le)} ${ee[2].toPrecision(le)}  ${ee[3].toPrecision(le)}]`}be.toString=j,be.Identity=t()})(Tr||={});function Z(){return Z.zero()}(fo=>{function e(){let G=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return G[0]=0,G}fo.zero=e;function t(){let G=e();return G[0]=1,G[1]=0,G[2]=0,G[3]=0,G[4]=0,G[5]=1,G[6]=0,G[7]=0,G[8]=0,G[9]=0,G[10]=1,G[11]=0,G[12]=0,G[13]=0,G[14]=0,G[15]=1,G}fo.identity=t;function r(G){return G[0]=1,G[1]=0,G[2]=0,G[3]=0,G[4]=0,G[5]=1,G[6]=0,G[7]=0,G[8]=0,G[9]=0,G[10]=1,G[11]=0,G[12]=0,G[13]=0,G[14]=0,G[15]=1,G}fo.setIdentity=r;function n(G){for(let te=0;te<16;te++)if(G[te]!==0)return!1;return!0}fo.isZero=n;function o(G){for(let te=0;te<16;te++)G[te]=0;return G}fo.setZero=o;function i(G){let te=e();for(let Ge=0;Ge<4;Ge++){let Ze=G[Ge];for(let lt=0;lt<4;lt++)te[4*lt+Ge]=Ze[lt]}return te}fo.ofRows=i;let a=t();function s(G,te){return u(G,a,typeof te>"u"?1e-6:te)}fo.isIdentity=s;function l(G){for(let te=0;te<16;te++)if(isNaN(G[te]))return!0;return!1}fo.hasNaN=l;function u(G,te,Ge){for(let Ze=0;Ze<16;Ze++)if(Math.abs(G[Ze]-te[Ze])>Ge)return!1;return!0}fo.areEqual=u;function c(G,te,Ge,Ze){G[4*Ge+te]=Ze}fo.setValue=c;function m(G,te,Ge){return G[4*Ge+te]}fo.getValue=m;function d(G,te,Ge){return te[Ge+0]=G[0],te[Ge+1]=G[1],te[Ge+2]=G[2],te[Ge+3]=G[3],te[Ge+4]=G[4],te[Ge+5]=G[5],te[Ge+6]=G[6],te[Ge+7]=G[7],te[Ge+8]=G[8],te[Ge+9]=G[9],te[Ge+10]=G[10],te[Ge+11]=G[11],te[Ge+12]=G[12],te[Ge+13]=G[13],te[Ge+14]=G[14],te[Ge+15]=G[15],te}fo.toArray=d;function p(G,te,Ge){return G[0]=te[Ge+0],G[1]=te[Ge+1],G[2]=te[Ge+2],G[3]=te[Ge+3],G[4]=te[Ge+4],G[5]=te[Ge+5],G[6]=te[Ge+6],G[7]=te[Ge+7],G[8]=te[Ge+8],G[9]=te[Ge+9],G[10]=te[Ge+10],G[11]=te[Ge+11],G[12]=te[Ge+12],G[13]=te[Ge+13],G[14]=te[Ge+14],G[15]=te[Ge+15],G}fo.fromArray=p;function h(G,te,Ge,Ze){return o(G),c(G,0,0,te[0]),c(G,1,0,te[1]),c(G,2,0,te[2]),c(G,0,1,Ge[0]),c(G,1,1,Ge[1]),c(G,2,1,Ge[2]),c(G,0,2,Ze[0]),c(G,1,2,Ze[1]),c(G,2,2,Ze[2]),c(G,3,3,1),G}fo.fromBasis=h;function f(G,te){return G[0]=te[0],G[1]=te[1],G[2]=te[2],G[3]=te[3],G[4]=te[4],G[5]=te[5],G[6]=te[6],G[7]=te[7],G[8]=te[8],G[9]=te[9],G[10]=te[10],G[11]=te[11],G[12]=te[12],G[13]=te[13],G[14]=te[14],G[15]=te[15],G}fo.copy=f;function y(G){return f(e(),G)}fo.clone=y;function g(G,te){return G[0]=te[12],G[1]=te[13],G[2]=te[14],G}fo.getTranslation=g;function x(G,te){let Ge=te[0],Ze=te[1],lt=te[2],xt=te[4],At=te[5],Dt=te[6],Mt=te[8],wt=te[9],ke=te[10];return G[0]=Math.sqrt(Ge*Ge+Ze*Ze+lt*lt),G[1]=Math.sqrt(xt*xt+At*At+Dt*Dt),G[2]=Math.sqrt(Mt*Mt+wt*wt+ke*ke),G}fo.getScaling=x;function S(G,te){let Ge=te[0]+te[5]+te[10],Ze=0;return Ge>0?(Ze=Math.sqrt(Ge+1)*2,G[3]=.25*Ze,G[0]=(te[6]-te[9])/Ze,G[1]=(te[8]-te[2])/Ze,G[2]=(te[1]-te[4])/Ze):te[0]>te[5]&&te[0]>te[10]?(Ze=Math.sqrt(1+te[0]-te[5]-te[10])*2,G[3]=(te[6]-te[9])/Ze,G[0]=.25*Ze,G[1]=(te[1]+te[4])/Ze,G[2]=(te[8]+te[2])/Ze):te[5]>te[10]?(Ze=Math.sqrt(1+te[5]-te[0]-te[10])*2,G[3]=(te[8]-te[2])/Ze,G[0]=(te[1]+te[4])/Ze,G[1]=.25*Ze,G[2]=(te[6]+te[9])/Ze):(Ze=Math.sqrt(1+te[10]-te[0]-te[5])*2,G[3]=(te[1]-te[4])/Ze,G[0]=(te[8]+te[2])/Ze,G[1]=(te[6]+te[9])/Ze,G[2]=.25*Ze),G}fo.getRotation=S;function I(G,te){let Ge=1/Math.sqrt(te[0]*te[0]+te[1]*te[1]+te[2]*te[2]),Ze=1/Math.sqrt(te[4]*te[4]+te[5]*te[5]+te[6]*te[6]),lt=1/Math.sqrt(te[8]*te[8]+te[9]*te[9]+te[10]*te[10]);return G[0]=te[0]*Ge,G[1]=te[1]*Ge,G[2]=te[2]*Ge,G[3]=0,G[4]=te[4]*Ze,G[5]=te[5]*Ze,G[6]=te[6]*Ze,G[7]=0,G[8]=te[8]*lt,G[9]=te[9]*lt,G[10]=te[10]*lt,G[11]=0,G[12]=0,G[13]=0,G[14]=0,G[15]=1,G}fo.extractRotation=I;function v(G,te){if(G===te){let Ge=te[1],Ze=te[2],lt=te[3],xt=te[6],At=te[7],Dt=te[11];G[1]=te[4],G[2]=te[8],G[3]=te[12],G[4]=Ge,G[6]=te[9],G[7]=te[13],G[8]=Ze,G[9]=xt,G[11]=te[14],G[12]=lt,G[13]=At,G[14]=Dt}else G[0]=te[0],G[1]=te[4],G[2]=te[8],G[3]=te[12],G[4]=te[1],G[5]=te[5],G[6]=te[9],G[7]=te[13],G[8]=te[2],G[9]=te[6],G[10]=te[10],G[11]=te[14],G[12]=te[3],G[13]=te[7],G[14]=te[11],G[15]=te[15];return G}fo.transpose=v;function A(G,te){let Ge=te[0],Ze=te[1],lt=te[2],xt=te[3],At=te[4],Dt=te[5],Mt=te[6],wt=te[7],ke=te[8],nt=te[9],Ue=te[10],ot=te[11],Tt=te[12],kt=te[13],qt=te[14],pe=te[15],_e=Ge*Dt-Ze*At,de=Ge*Mt-lt*At,Me=Ge*wt-xt*At,fe=Ze*Mt-lt*Dt,Le=Ze*wt-xt*Dt,vt=lt*wt-xt*Mt,zt=ke*kt-nt*Tt,jt=ke*qt-Ue*Tt,mr=ke*pe-ot*Tt,Io=nt*qt-Ue*kt,ni=nt*pe-ot*kt,ua=Ue*pe-ot*qt,Go=_e*ua-de*ni+Me*Io+fe*mr-Le*jt+vt*zt;return Go?(Go=1/Go,G[0]=(Dt*ua-Mt*ni+wt*Io)*Go,G[1]=(lt*ni-Ze*ua-xt*Io)*Go,G[2]=(kt*vt-qt*Le+pe*fe)*Go,G[3]=(Ue*Le-nt*vt-ot*fe)*Go,G[4]=(Mt*mr-At*ua-wt*jt)*Go,G[5]=(Ge*ua-lt*mr+xt*jt)*Go,G[6]=(qt*Me-Tt*vt-pe*de)*Go,G[7]=(ke*vt-Ue*Me+ot*de)*Go,G[8]=(At*ni-Dt*mr+wt*zt)*Go,G[9]=(Ze*mr-Ge*ni-xt*zt)*Go,G[10]=(Tt*Le-kt*Me+pe*_e)*Go,G[11]=(nt*Me-ke*Le-ot*_e)*Go,G[12]=(Dt*jt-At*Io-Mt*zt)*Go,G[13]=(Ge*Io-Ze*jt+lt*zt)*Go,G[14]=(kt*de-Tt*fe-qt*_e)*Go,G[15]=(ke*fe-nt*de+Ue*_e)*Go,!0):!1}fo.tryInvert=A;function _(G,te){return A(G,te)||console.warn("non-invertible matrix.",te),G}fo.invert=_;function T(G,te,Ge){let Ze=te[0],lt=te[1],xt=te[2],At=te[3],Dt=te[4],Mt=te[5],wt=te[6],ke=te[7],nt=te[8],Ue=te[9],ot=te[10],Tt=te[11],kt=te[12],qt=te[13],pe=te[14],_e=te[15],de=Ge[0],Me=Ge[1],fe=Ge[2],Le=Ge[3];return G[0]=de*Ze+Me*Dt+fe*nt+Le*kt,G[1]=de*lt+Me*Mt+fe*Ue+Le*qt,G[2]=de*xt+Me*wt+fe*ot+Le*pe,G[3]=de*At+Me*ke+fe*Tt+Le*_e,de=Ge[4],Me=Ge[5],fe=Ge[6],Le=Ge[7],G[4]=de*Ze+Me*Dt+fe*nt+Le*kt,G[5]=de*lt+Me*Mt+fe*Ue+Le*qt,G[6]=de*xt+Me*wt+fe*ot+Le*pe,G[7]=de*At+Me*ke+fe*Tt+Le*_e,de=Ge[8],Me=Ge[9],fe=Ge[10],Le=Ge[11],G[8]=de*Ze+Me*Dt+fe*nt+Le*kt,G[9]=de*lt+Me*Mt+fe*Ue+Le*qt,G[10]=de*xt+Me*wt+fe*ot+Le*pe,G[11]=de*At+Me*ke+fe*Tt+Le*_e,de=Ge[12],Me=Ge[13],fe=Ge[14],Le=Ge[15],G[12]=de*Ze+Me*Dt+fe*nt+Le*kt,G[13]=de*lt+Me*Mt+fe*Ue+Le*qt,G[14]=de*xt+Me*wt+fe*ot+Le*pe,G[15]=de*At+Me*ke+fe*Tt+Le*_e,G}fo.mul=T;function w(G,te,Ge,Ze,lt,xt){let At=te[0+lt],Dt=te[1+lt],Mt=te[2+lt],wt=te[3+lt],ke=te[4+lt],nt=te[5+lt],Ue=te[6+lt],ot=te[7+lt],Tt=te[8+lt],kt=te[9+lt],qt=te[10+lt],pe=te[11+lt],_e=te[12+lt],de=te[13+lt],Me=te[14+lt],fe=te[15+lt],Le=Ge[0+xt],vt=Ge[1+xt],zt=Ge[2+xt],jt=Ge[3+xt];return G[0+Ze]=Le*At+vt*ke+zt*Tt+jt*_e,G[1+Ze]=Le*Dt+vt*nt+zt*kt+jt*de,G[2+Ze]=Le*Mt+vt*Ue+zt*qt+jt*Me,G[3+Ze]=Le*wt+vt*ot+zt*pe+jt*fe,Le=Ge[4+xt],vt=Ge[5+xt],zt=Ge[6+xt],jt=Ge[7+xt],G[4+Ze]=Le*At+vt*ke+zt*Tt+jt*_e,G[5+Ze]=Le*Dt+vt*nt+zt*kt+jt*de,G[6+Ze]=Le*Mt+vt*Ue+zt*qt+jt*Me,G[7+Ze]=Le*wt+vt*ot+zt*pe+jt*fe,Le=Ge[8+xt],vt=Ge[9+xt],zt=Ge[10+xt],jt=Ge[11+xt],G[8+Ze]=Le*At+vt*ke+zt*Tt+jt*_e,G[9+Ze]=Le*Dt+vt*nt+zt*kt+jt*de,G[10+Ze]=Le*Mt+vt*Ue+zt*qt+jt*Me,G[11+Ze]=Le*wt+vt*ot+zt*pe+jt*fe,Le=Ge[12+xt],vt=Ge[13+xt],zt=Ge[14+xt],jt=Ge[15+xt],G[12+Ze]=Le*At+vt*ke+zt*Tt+jt*_e,G[13+Ze]=Le*Dt+vt*nt+zt*kt+jt*de,G[14+Ze]=Le*Mt+vt*Ue+zt*qt+jt*Me,G[15+Ze]=Le*wt+vt*ot+zt*pe+jt*fe,G}fo.mulOffset=w;function D(G,te,Ge,Ze){return T(G,T(G,te,Ge),Ze)}fo.mul3=D;function M(G,te,Ge){let Ze=Ge[0],lt=Ge[1],xt=Ge[2],At,Dt,Mt,wt,ke,nt,Ue,ot,Tt,kt,qt,pe;return te===G?(G[12]=te[0]*Ze+te[4]*lt+te[8]*xt+te[12],G[13]=te[1]*Ze+te[5]*lt+te[9]*xt+te[13],G[14]=te[2]*Ze+te[6]*lt+te[10]*xt+te[14],G[15]=te[3]*Ze+te[7]*lt+te[11]*xt+te[15]):(At=te[0],Dt=te[1],Mt=te[2],wt=te[3],ke=te[4],nt=te[5],Ue=te[6],ot=te[7],Tt=te[8],kt=te[9],qt=te[10],pe=te[11],G[0]=At,G[1]=Dt,G[2]=Mt,G[3]=wt,G[4]=ke,G[5]=nt,G[6]=Ue,G[7]=ot,G[8]=Tt,G[9]=kt,G[10]=qt,G[11]=pe,G[12]=At*Ze+ke*lt+Tt*xt+te[12],G[13]=Dt*Ze+nt*lt+kt*xt+te[13],G[14]=Mt*Ze+Ue*lt+qt*xt+te[14],G[15]=wt*Ze+ot*lt+pe*xt+te[15]),G}fo.translate=M;function E(G,te){return G[0]=1,G[1]=0,G[2]=0,G[3]=0,G[4]=0,G[5]=1,G[6]=0,G[7]=0,G[8]=0,G[9]=0,G[10]=1,G[11]=0,G[12]=te[0],G[13]=te[1],G[14]=te[2],G[15]=1,G}fo.fromTranslation=E;function R(G,te){return G[12]=te[0],G[13]=te[1],G[14]=te[2],G}fo.setTranslation=R;function k(G,te,Ge,Ze){return G[0]=Ge[0],G[4]=Ge[1],G[8]=Ge[2],G[1]=Ze[0],G[5]=Ze[1],G[9]=Ze[2],G[2]=te[0],G[6]=te[1],G[10]=te[2],G}fo.setAxes=k;function B(G,te,Ge,Ze){let lt=Ze[0],xt=Ze[1],At=Ze[2],Dt=Math.sqrt(lt*lt+xt*xt+At*At);if(Math.abs(Dt)<1e-6)return t();Dt=1/Dt,lt*=Dt,xt*=Dt,At*=Dt;let Mt=Math.sin(Ge),wt=Math.cos(Ge),ke=1-wt,nt=te[0],Ue=te[1],ot=te[2],Tt=te[3],kt=te[4],qt=te[5],pe=te[6],_e=te[7],de=te[8],Me=te[9],fe=te[10],Le=te[11],vt=lt*lt*ke+wt,zt=xt*lt*ke+At*Mt,jt=At*lt*ke-xt*Mt,mr=lt*xt*ke-At*Mt,Io=xt*xt*ke+wt,ni=At*xt*ke+lt*Mt,ua=lt*At*ke+xt*Mt,Go=xt*At*ke-lt*Mt,vg=At*At*ke+wt;return G[0]=nt*vt+kt*zt+de*jt,G[1]=Ue*vt+qt*zt+Me*jt,G[2]=ot*vt+pe*zt+fe*jt,G[3]=Tt*vt+_e*zt+Le*jt,G[4]=nt*mr+kt*Io+de*ni,G[5]=Ue*mr+qt*Io+Me*ni,G[6]=ot*mr+pe*Io+fe*ni,G[7]=Tt*mr+_e*Io+Le*ni,G[8]=nt*ua+kt*Go+de*vg,G[9]=Ue*ua+qt*Go+Me*vg,G[10]=ot*ua+pe*Go+fe*vg,G[11]=Tt*ua+_e*Go+Le*vg,te!==G&&(G[12]=te[12],G[13]=te[13],G[14]=te[14],G[15]=te[15]),G}fo.rotate=B;function L(G,te,Ge){let Ze=Ge[0],lt=Ge[1],xt=Ge[2],At=Math.sqrt(Ze*Ze+lt*lt+xt*xt);if(Math.abs(At)<1e-6)return r(G);At=1/At,Ze*=At,lt*=At,xt*=At;let Dt=Math.sin(te),Mt=Math.cos(te),wt=1-Mt;return G[0]=Ze*Ze*wt+Mt,G[1]=lt*Ze*wt+xt*Dt,G[2]=xt*Ze*wt-lt*Dt,G[3]=0,G[4]=Ze*lt*wt-xt*Dt,G[5]=lt*lt*wt+Mt,G[6]=xt*lt*wt+Ze*Dt,G[7]=0,G[8]=Ze*xt*wt+lt*Dt,G[9]=lt*xt*wt-Ze*Dt,G[10]=xt*xt*wt+Mt,G[11]=0,G[12]=0,G[13]=0,G[14]=0,G[15]=1,G}fo.fromRotation=L;function V(G,te,Ge){let Ze=Ge[0],lt=Ge[1],xt=Ge[2];return G[0]=te[0]*Ze,G[1]=te[1]*Ze,G[2]=te[2]*Ze,G[3]=te[3]*Ze,G[4]=te[4]*lt,G[5]=te[5]*lt,G[6]=te[6]*lt,G[7]=te[7]*lt,G[8]=te[8]*xt,G[9]=te[9]*xt,G[10]=te[10]*xt,G[11]=te[11]*xt,G[12]=te[12],G[13]=te[13],G[14]=te[14],G[15]=te[15],G}fo.scale=V;function U(G,te,Ge){return G[0]=te[0]*Ge,G[1]=te[1]*Ge,G[2]=te[2]*Ge,G[3]=te[3]*Ge,G[4]=te[4]*Ge,G[5]=te[5]*Ge,G[6]=te[6]*Ge,G[7]=te[7]*Ge,G[8]=te[8]*Ge,G[9]=te[9]*Ge,G[10]=te[10]*Ge,G[11]=te[11]*Ge,G[12]=te[12],G[13]=te[13],G[14]=te[14],G[15]=te[15],G}fo.scaleUniformly=U;function Q(G,te){return G[0]=te[0],G[1]=0,G[2]=0,G[3]=0,G[4]=0,G[5]=te[1],G[6]=0,G[7]=0,G[8]=0,G[9]=0,G[10]=te[2],G[11]=0,G[12]=0,G[13]=0,G[14]=0,G[15]=1,G}fo.fromScaling=Q;function O(G,te){return G[0]=te,G[1]=0,G[2]=0,G[3]=0,G[4]=0,G[5]=te,G[6]=0,G[7]=0,G[8]=0,G[9]=0,G[10]=te,G[11]=0,G[12]=0,G[13]=0,G[14]=0,G[15]=1,G}fo.fromUniformScaling=O;let q=[0,0,0],X=[0,0,0];function F(G,te,Ge){let Ze=b.cross(q,te,b.unitX);b.dot(Ze,Ze)<1e-6&&b.cross(Ze,te,b.unitY),b.normalize(Ze,Ze);let lt=b.cross(X,te,Ze);return b.normalize(lt,lt),k(G,te,Ze,lt),G[12]=Ge[0],G[13]=Ge[1],G[14]=Ge[2],G[15]=1,G}fo.fromPlane=F;function Y(G,te){return G[0]=te[0],G[1]=te[1],G[2]=te[2],G[4]=te[3],G[5]=te[4],G[6]=te[5],G[8]=te[6],G[9]=te[7],G[10]=te[8],G}fo.fromMat3=Y;function $(G,te,Ge,Ze){let[lt,xt,At,Dt]=Ge,Mt=lt+lt,wt=xt+xt,ke=At+At,nt=lt*Mt,Ue=lt*wt,ot=lt*ke,Tt=xt*wt,kt=xt*ke,qt=At*ke,pe=Dt*Mt,_e=Dt*wt,de=Dt*ke,[Me,fe,Le]=Ze;return G[0]=(1-(Tt+qt))*Me,G[1]=(Ue+de)*Me,G[2]=(ot-_e)*Me,G[3]=0,G[4]=(Ue-de)*fe,G[5]=(1-(nt+qt))*fe,G[6]=(kt+pe)*fe,G[7]=0,G[8]=(ot+_e)*Le,G[9]=(kt-pe)*Le,G[10]=(1-(nt+Tt))*Le,G[11]=0,G[12]=te[0],G[13]=te[1],G[14]=te[2],G[15]=1,G}fo.compose=$;let ce=[0,0,0],ie=e();function oe(G,te,Ge,Ze){let lt=b.magnitude(b.set(ce,G[0],G[1],G[2])),xt=b.magnitude(b.set(ce,G[4],G[5],G[6])),At=b.magnitude(b.set(ce,G[8],G[9],G[10]));j(G)<0&&(lt=-lt),te[0]=G[12],te[1]=G[13],te[2]=G[14],f(ie,G);let Mt=1/lt,wt=1/xt,ke=1/At;return ie[0]*=Mt,ie[1]*=Mt,ie[2]*=Mt,ie[4]*=wt,ie[5]*=wt,ie[6]*=wt,ie[8]*=ke,ie[9]*=ke,ie[10]*=ke,S(Ge,ie),Ze[0]=lt,Ze[1]=xt,Ze[2]=At,G}fo.decompose=oe;function W(G){let te=b(),Ge=Tr(),Ze=b();return oe(G,te,Ge,Ze),{position:te,quaternion:Ge,scale:Ze}}fo.getDecomposition=W;function N(G){let te="";for(let Ge=0;Ge<4;Ge++){for(let Ze=0;Ze<4;Ze++)te+=G[4*Ze+Ge].toString(),Ze<3&&(te+=" ");Ge<3&&(te+=`
`)}return te}fo.makeTable=N;function j(G){let te=G[0],Ge=G[1],Ze=G[2],lt=G[3],xt=G[4],At=G[5],Dt=G[6],Mt=G[7],wt=G[8],ke=G[9],nt=G[10],Ue=G[11],ot=G[12],Tt=G[13],kt=G[14],qt=G[15],pe=te*At-Ge*xt,_e=te*Dt-Ze*xt,de=te*Mt-lt*xt,Me=Ge*Dt-Ze*At,fe=Ge*Mt-lt*At,Le=Ze*Mt-lt*Dt,vt=wt*Tt-ke*ot,zt=wt*kt-nt*ot,jt=wt*qt-Ue*ot,mr=ke*kt-nt*Tt,Io=ke*qt-Ue*Tt,ni=nt*qt-Ue*kt;return pe*ni-_e*Io+de*mr+Me*jt-fe*zt+Le*vt}fo.determinant=j;function ue(G,te){return be(G,typeof te<"u"?te:1e-6)}fo.isRotationAndTranslation=ue;function be(G,te){let Ge=G[0],Ze=G[1],lt=G[2],xt=G[3],At=G[4],Dt=G[5],Mt=G[6],wt=G[7],ke=G[8],nt=G[9],Ue=G[10],ot=G[11],Tt=G[15];if(!eo(Tt,1,te)||!eo(xt,0,te)||!eo(wt,0,te)||!eo(ot,0,te))return!1;let kt=Math.abs(Ge*(Dt*Ue-Mt*nt)-Ze*(At*Ue-Mt*ke)+lt*(At*nt-Dt*ke));return!!eo(kt,1,te)}function ee(G,te){return le(G,typeof te<"u"?te:1e-6)}fo.isTranslationAndUniformScaling=ee;function le(G,te){let Ge=G[0];return eo(G[1],0,te)&&eo(G[2],0,te)&&eo(G[3],0,te)&&eo(G[4],0,te)&&eo(G[5],Ge,te)&&eo(G[6],0,te)&&eo(G[7],0,te)&&eo(G[8],0,te)&&eo(G[9],0,te)&&eo(G[10],Ge,te)&&eo(G[11],0,te)&&eo(G[15],1,te)}function Ae(G,te){let Ge=te[0],Ze=te[1],lt=te[2],xt=te[3],At=Ge+Ge,Dt=Ze+Ze,Mt=lt+lt,wt=Ge*At,ke=Ze*At,nt=Ze*Dt,Ue=lt*At,ot=lt*Dt,Tt=lt*Mt,kt=xt*At,qt=xt*Dt,pe=xt*Mt;return G[0]=1-nt-Tt,G[1]=ke+pe,G[2]=Ue-qt,G[3]=0,G[4]=ke-pe,G[5]=1-wt-Tt,G[6]=ot+kt,G[7]=0,G[8]=Ue+qt,G[9]=ot-kt,G[10]=1-wt-nt,G[11]=0,G[12]=0,G[13]=0,G[14]=0,G[15]=1,G}fo.fromQuat=Ae;function Ce(G,te,Ge){let Ze=te[0],lt=te[1],xt=te[2],At=Math.cos(Ze),Dt=Math.sin(Ze),Mt=Math.cos(lt),wt=Math.sin(lt),ke=Math.cos(xt),nt=Math.sin(xt);if(Ge==="XYZ"){let Ue=At*ke,ot=At*nt,Tt=Dt*ke,kt=Dt*nt;G[0]=Mt*ke,G[4]=-Mt*nt,G[8]=wt,G[1]=ot+Tt*wt,G[5]=Ue-kt*wt,G[9]=-Dt*Mt,G[2]=kt-Ue*wt,G[6]=Tt+ot*wt,G[10]=At*Mt}else if(Ge==="YXZ"){let Ue=Mt*ke,ot=Mt*nt,Tt=wt*ke,kt=wt*nt;G[0]=Ue+kt*Dt,G[4]=Tt*Dt-ot,G[8]=At*wt,G[1]=At*nt,G[5]=At*ke,G[9]=-Dt,G[2]=ot*Dt-Tt,G[6]=kt+Ue*Dt,G[10]=At*Mt}else if(Ge==="ZXY"){let Ue=Mt*ke,ot=Mt*nt,Tt=wt*ke,kt=wt*nt;G[0]=Ue-kt*Dt,G[4]=-At*nt,G[8]=Tt+ot*Dt,G[1]=ot+Tt*Dt,G[5]=At*ke,G[9]=kt-Ue*Dt,G[2]=-At*wt,G[6]=Dt,G[10]=At*Mt}else if(Ge==="ZYX"){let Ue=At*ke,ot=At*nt,Tt=Dt*ke,kt=Dt*nt;G[0]=Mt*ke,G[4]=Tt*wt-ot,G[8]=Ue*wt+kt,G[1]=Mt*nt,G[5]=kt*wt+Ue,G[9]=ot*wt-Tt,G[2]=-wt,G[6]=Dt*Mt,G[10]=At*Mt}else if(Ge==="YZX"){let Ue=At*Mt,ot=At*wt,Tt=Dt*Mt,kt=Dt*wt;G[0]=Mt*ke,G[4]=kt-Ue*nt,G[8]=Tt*nt+ot,G[1]=nt,G[5]=At*ke,G[9]=-Dt*ke,G[2]=-wt*ke,G[6]=ot*nt+Tt,G[10]=Ue-kt*nt}else if(Ge==="XZY"){let Ue=At*Mt,ot=At*wt,Tt=Dt*Mt,kt=Dt*wt;G[0]=Mt*ke,G[4]=-nt,G[8]=wt*ke,G[1]=Ue*nt+kt,G[5]=At*ke,G[9]=ot*nt-Tt,G[2]=Tt*nt-ot,G[6]=Dt*ke,G[10]=kt*nt+Ue}return G[3]=0,G[7]=0,G[11]=0,G[12]=0,G[13]=0,G[14]=0,G[15]=1,G}fo.fromEuler=Ce;function J(G,te,Ge,Ze,lt,xt,At){let Dt=2*xt/(Ge-te),Mt=2*xt/(Ze-lt),wt=(Ge+te)/(Ge-te),ke=(Ze+lt)/(Ze-lt),nt=-(At+xt)/(At-xt),Ue=-2*At*xt/(At-xt);return G[0]=Dt,G[1]=0,G[2]=0,G[3]=0,G[4]=0,G[5]=Mt,G[6]=0,G[7]=0,G[8]=wt,G[9]=ke,G[10]=nt,G[11]=-1,G[12]=0,G[13]=0,G[14]=Ue,G[15]=0,G}fo.perspective=J;function z(G,te,Ge,Ze,lt,xt,At){let Dt=1/(Ge-te),Mt=1/(Ze-lt),wt=1/(At-xt),ke=(Ge+te)*Dt,nt=(Ze+lt)*Mt,Ue=(At+xt)*wt;return G[0]=2*Dt,G[1]=0,G[2]=0,G[3]=0,G[4]=0,G[5]=2*Mt,G[6]=0,G[7]=0,G[8]=0,G[9]=0,G[10]=-2*wt,G[11]=0,G[12]=-ke,G[13]=-nt,G[14]=-Ue,G[15]=1,G}fo.ortho=z;function ae(G,te,Ge,Ze){let lt,xt,At,Dt,Mt,wt,ke,nt,Ue,ot,Tt=te[0],kt=te[1],qt=te[2],pe=Ze[0],_e=Ze[1],de=Ze[2],Me=Ge[0],fe=Ge[1],Le=Ge[2];return Math.abs(Tt-Me)<1e-6&&Math.abs(kt-fe)<1e-6&&Math.abs(qt-Le)<1e-6?r(G):(ke=Tt-Me,nt=kt-fe,Ue=qt-Le,ot=1/Math.sqrt(ke*ke+nt*nt+Ue*Ue),ke*=ot,nt*=ot,Ue*=ot,lt=_e*Ue-de*nt,xt=de*ke-pe*Ue,At=pe*nt-_e*ke,ot=Math.sqrt(lt*lt+xt*xt+At*At),ot?(ot=1/ot,lt*=ot,xt*=ot,At*=ot):(lt=0,xt=0,At=0),Dt=nt*At-Ue*xt,Mt=Ue*lt-ke*At,wt=ke*xt-nt*lt,ot=Math.sqrt(Dt*Dt+Mt*Mt+wt*wt),ot?(ot=1/ot,Dt*=ot,Mt*=ot,wt*=ot):(Dt=0,Mt=0,wt=0),G[0]=lt,G[1]=Dt,G[2]=ke,G[3]=0,G[4]=xt,G[5]=Mt,G[6]=nt,G[7]=0,G[8]=At,G[9]=wt,G[10]=Ue,G[11]=0,G[12]=-(lt*Tt+xt*kt+At*qt),G[13]=-(Dt*Tt+Mt*kt+wt*qt),G[14]=-(ke*Tt+nt*kt+Ue*qt),G[15]=1,G)}fo.lookAt=ae;function ge(G,te,Ge,Ze){let lt=te[0],xt=te[1],At=te[2],Dt=Ze[0],Mt=Ze[1],wt=Ze[2],ke=lt-Ge[0],nt=xt-Ge[1],Ue=At-Ge[2],ot=ke*ke+nt*nt+Ue*Ue;ot>0&&(ot=1/Math.sqrt(ot),ke*=ot,nt*=ot,Ue*=ot);let Tt=Mt*Ue-wt*nt,kt=wt*ke-Dt*Ue,qt=Dt*nt-Mt*ke;return ot=Tt*Tt+kt*kt+qt*qt,ot>0&&(ot=1/Math.sqrt(ot),Tt*=ot,kt*=ot,qt*=ot),G[0]=Tt,G[1]=kt,G[2]=qt,G[3]=0,G[4]=nt*qt-Ue*kt,G[5]=Ue*Tt-ke*qt,G[6]=ke*kt-nt*Tt,G[7]=0,G[8]=ke,G[9]=nt,G[10]=Ue,G[11]=0,G[12]=lt,G[13]=xt,G[14]=At,G[15]=1,G}fo.targetTo=ge;function ve(G,te){o(G);for(let Ge=0;Ge<4;Ge++){let Ze=te[Ge];c(G,Ge,Ze,1)}return G}fo.fromPermutation=ve;function Oe(G){let te=G[0]*G[0]+G[1]*G[1]+G[2]*G[2],Ge=G[4]*G[4]+G[5]*G[5]+G[6]*G[6],Ze=G[8]*G[8]+G[9]*G[9]+G[10]*G[10];return Math.sqrt(Math.max(te,Ge,Ze))}fo.getMaxScaleOnAxis=Oe;let ze=[1,0,0],Re=[0,1,0],Ke=[0,0,1];fo.rotX90=L(e(),vr(90),ze),fo.rotX180=L(e(),vr(180),ze),fo.rotY90=L(e(),vr(90),Re),fo.rotY180=L(e(),vr(180),Re),fo.rotY270=L(e(),vr(270),Re),fo.rotZ90=L(e(),vr(90),Ke),fo.rotZ180=L(e(),vr(180),Ke),fo.rotXY90=T(e(),fo.rotX90,fo.rotY90),fo.rotZY90=T(e(),fo.rotZ90,fo.rotY90),fo.rotZYZ90=T(e(),fo.rotZY90,fo.rotZ90),fo.rotZ90X180=T(e(),fo.rotZ90,fo.rotX180),fo.rotY90Z180=T(e(),fo.rotY90,fo.rotZ180),fo.id=t()})(Z||={});function Ie(){return Ie.zero()}(w=>{function e(){let D=[.1,0];return D[0]=0,D}w.zero=e;function t(D){let M=e();return M[0]=D[0],M[1]=D[1],M}w.clone=t;function r(D,M){let E=e();return E[0]=D,E[1]=M,E}w.create=r;function n(D){return isNaN(D[0])||isNaN(D[1])}w.hasNaN=n;function o(D,M,E){return M[E+0]=D[0],M[E+1]=D[1],M}w.toArray=o;function i(D,M,E){return D[0]=M[E+0],D[1]=M[E+1],D}w.fromArray=i;function a(D,M){return D[0]=M[0],D[1]=M[1],D}w.copy=a;function s(D,M,E){return D[0]=M,D[1]=E,D}w.set=s;function l(D,M,E){return D[0]=M[0]+E[0],D[1]=M[1]+E[1],D}w.add=l;function u(D,M,E){return D[0]=M[0]-E[0],D[1]=M[1]-E[1],D}w.sub=u;function c(D,M,E){return D[0]=M[0]*E[0],D[1]=M[1]*E[1],D}w.mul=c;function m(D,M,E){return D[0]=M[0]/E[0],D[1]=M[1]/E[1],D}w.div=m;function d(D,M,E){return D[0]=M[0]*E,D[1]=M[1]*E,D}w.scale=d;function p(D,M){return D[0]=Math.round(M[0]),D[1]=Math.round(M[1]),D}w.round=p;function h(D,M){return D[0]=Math.ceil(M[0]),D[1]=Math.ceil(M[1]),D}w.ceil=h;function f(D,M){return D[0]=Math.floor(M[0]),D[1]=Math.floor(M[1]),D}w.floor=f;function y(D,M){let E=M[0]-D[0],R=M[1]-D[1];return Math.sqrt(E*E+R*R)}w.distance=y;function g(D,M){let E=M[0]-D[0],R=M[1]-D[1];return E*E+R*R}w.squaredDistance=g;function x(D){let M=D[0],E=D[1];return Math.sqrt(M*M+E*E)}w.magnitude=x;function S(D){let M=D[0],E=D[1];return M*M+E*E}w.squaredMagnitude=S;function I(D,M,E){return d(D,A(D,M),E)}w.setMagnitude=I;function v(D,M){return D[0]=1/M[0],D[1]=1/M[1],D}w.inverse=v;function A(D,M){let E=M[0],R=M[1],k=E*E+R*R;return k>0&&(k=1/Math.sqrt(k),D[0]=M[0]*k,D[1]=M[1]*k),D}w.normalize=A;function _(D,M){return D[0]===M[0]&&D[1]===M[1]}w.areEqual=_;function T(D,M){return`[${D[0].toPrecision(M)} ${D[1].toPrecision(M)}}]`}w.toString=T})(Ie||={});function Ut(){return Ut.zero()}(M=>{function e(){let E=[.1,0,0,0];return E[0]=0,E}M.zero=e;function t(E){let R=e();return R[0]=E[0],R[1]=E[1],R[2]=E[2],R[3]=E[3],R}M.clone=t;function r(E,R,k,B){let L=e();return L[0]=E,L[1]=R,L[2]=k,L[3]=B,L}M.create=r;function n(E,R){return E[0]=R.center[0],E[1]=R.center[1],E[2]=R.center[2],E[3]=R.radius,E}M.fromSphere=n;function o(E){return n(e(),E)}M.ofSphere=o;function i(E){return isNaN(E[0])||isNaN(E[1])||isNaN(E[2])||isNaN(E[3])}M.hasNaN=i;function a(E,R,k){return R[k+0]=E[0],R[k+1]=E[1],R[k+2]=E[2],R[k+3]=E[3],R}M.toArray=a;function s(E,R,k){return E[0]=R[k+0],E[1]=R[k+1],E[2]=R[k+2],E[3]=R[k+3],E}M.fromArray=s;function l(E,R,k){R[k+0]=E[0],R[k+1]=E[1],R[k+2]=E[2]}M.toVec3Array=l;function u(E,R,k){return E[0]=R[k+0],E[1]=R[k+1],E[2]=R[k+2],E[3]=0,E}M.fromVec3Array=u;function c(E,R){return E[0]=R[0],E[1]=R[1],E[2]=R[2],E[3]=R[3],E}M.copy=c;function m(E,R,k,B,L){return E[0]=R,E[1]=k,E[2]=B,E[3]=L,E}M.set=m;function d(E,R,k){return E[0]=R[0]+k[0],E[1]=R[1]+k[1],E[2]=R[2]+k[2],E[3]=R[3]+k[3],E}M.add=d;function p(E,R){let k=R[0]-E[0],B=R[1]-E[1],L=R[2]-E[2],V=R[3]-E[3];return Math.sqrt(k*k+B*B+L*L+V*V)}M.distance=p;function h(E,R,k){return E[0]=R[0]*k,E[1]=R[1]*k,E[2]=R[2]*k,E[4]=R[4]*k,E}M.scale=h;function f(E,R){return E[0]=Math.round(R[0]),E[1]=Math.round(R[1]),E[2]=Math.round(R[2]),E[3]=Math.round(R[3]),E}M.round=f;function y(E,R){return E[0]=Math.ceil(R[0]),E[1]=Math.ceil(R[1]),E[2]=Math.ceil(R[2]),E[3]=Math.ceil(R[3]),E}M.ceil=y;function g(E,R){return E[0]=Math.floor(R[0]),E[1]=Math.floor(R[1]),E[2]=Math.floor(R[2]),E[3]=Math.floor(R[3]),E}M.floor=g;function x(E,R){let k=R[0]-E[0],B=R[1]-E[1],L=R[2]-E[2],V=R[3]-E[3];return k*k+B*B+L*L+V*V}M.squaredDistance=x;function S(E){let R=E[0],k=E[1],B=E[2],L=E[3];return Math.sqrt(R*R+k*k+B*B+L*L)}M.norm=S;function I(E){let R=E[0],k=E[1],B=E[2],L=E[3];return R*R+k*k+B*B+L*L}M.squaredNorm=I;function v(E,R,k){let B=R[0],L=R[1],V=R[2],U=R[3];return E[0]=k[0]*B+k[4]*L+k[8]*V+k[12]*U,E[1]=k[1]*B+k[5]*L+k[9]*V+k[13]*U,E[2]=k[2]*B+k[6]*L+k[10]*V+k[14]*U,E[3]=k[3]*B+k[7]*L+k[11]*V+k[15]*U,E}M.transformMat4=v;function A(E,R){return E[0]*R[0]+E[1]*R[1]+E[2]*R[2]+E[3]*R[3]}M.dot=A;function _(E,R){return E[0]=1/R[0],E[1]=1/R[1],E[2]=1/R[2],E[3]=1/R[3],E}M.inverse=_;function T(E,R){return E[0]===R[0]&&E[1]===R[1]&&E[2]===R[2]&&E[3]===R[3]}M.exactEquals=T;function w(E,R){let k=E[0],B=E[1],L=E[2],V=E[3],U=R[0],Q=R[1],O=R[2],q=R[3];return Math.abs(k-U)<=1e-6*Math.max(1,Math.abs(k),Math.abs(U))&&Math.abs(B-Q)<=1e-6*Math.max(1,Math.abs(B),Math.abs(Q))&&Math.abs(L-O)<=1e-6*Math.max(1,Math.abs(L),Math.abs(O))&&Math.abs(V-q)<=1e-6*Math.max(1,Math.abs(V),Math.abs(q))}M.equals=w;function D(E,R){return`[${E[0].toPrecision(R)} ${E[1].toPrecision(R)} ${E[2].toPrecision(R)}  ${E[3].toPrecision(R)}]`}M.toString=D})(Ut||={});var xr;(I=>{function e(v,A,_){let T=[];for(let D=0;D<A.length;D++)T[D]=A[A.length-D-1];let w=[1];for(let D=1;D<v.length;D++)w[D]=v[T[D-1]];return{dimensions:v,axisOrderFastToSlow:T,axisOrderSlowToFast:A,accessDimensions:w,defaultCtor:_||Float64Array}}function t(v,A){return{space:v,data:A}}I.create=t;function r(v,A,_){let T=e(v,A,_),{get:w,set:D,add:M,dataOffset:E,getCoords:R}=d(T);return{rank:v.length,dimensions:v,axisOrderSlowToFast:A,create:p(T),get:w,set:D,add:M,dataOffset:E,getCoords:R}}I.Space=r;function n(v){return v}I.Data1=n;function o(v,A){return r([v],[0],A)}I.Vector=o;function i(v,A,_){return r([v,A],[1,0],_)}I.ColumnMajorMatrix=i;function a(v,A,_){return r([v,A],[0,1],_)}I.RowMajorMatrix=a;function s(v,A,_){if(A.rank!==2)throw new Error("Invalid tensor rank");let T=Math.min(4,A.dimensions[0]),w=Math.min(4,A.dimensions[1]);for(let D=0;D<T;D++)for(let M=0;M<w;M++)Z.setValue(v,D,M,A.get(_,D,M));return v}I.toMat4=s;function l(v,A,_){if(A.rank!==2)throw new Error("Invalid tensor rank");let T=Math.min(3,A.dimensions[0]),w=Math.min(3,A.dimensions[1]);for(let D=0;D<T;D++)for(let M=0;M<w;M++)Ot.setValue(v,D,M,A.get(_,D,M));return v}I.toMat3=l;function u(v,A,_){if(A.rank!==1)throw new Error("Invalid tensor rank");let T=Math.min(3,A.dimensions[0]);for(let w=0;w<T;w++)v[w]=_[w];return v}I.toVec3=u;function c(v,A,_){if(A.rank!==1)throw new Error("Invalid tensor rank");let T=Math.min(4,A.dimensions[0]);for(let w=0;w<T;w++)v[w]=_[w];return v}I.toVec4=c;function m(v,A){let _=v.length;if(_!==A.length)return!1;for(let T=0;T<_;T++)if(v[T]!==A[T])return!1;return!0}I.areEqualExact=m;function d(v){let{dimensions:A,axisOrderFastToSlow:_}=v;switch(A.length){case 1:return{get:(T,w)=>T[w],set:(T,w,D)=>T[w]=D,add:(T,w,D)=>T[w]+=D,dataOffset:T=>T,getCoords:(T,w)=>(w[0]=T,w)};case 2:{if(_[0]===0&&_[1]===1){let T=A[0];return{get:(w,D,M)=>w[M*T+D],set:(w,D,M,E)=>w[M*T+D]=E,add:(w,D,M,E)=>w[M*T+D]+=E,dataOffset:(w,D)=>D*T+w,getCoords:(w,D)=>(D[0]=w%T,D[1]=Math.floor(w/T),D)}}if(_[0]===1&&_[1]===0){let T=A[1];return{get:(w,D,M)=>w[D*T+M],set:(w,D,M,E)=>w[D*T+M]=E,add:(w,D,M,E)=>w[D*T+M]+=E,dataOffset:(w,D)=>w*T+D,getCoords:(w,D)=>(D[0]=Math.floor(w/T),D[1]=w%T,D)}}throw new Error("bad axis order")}case 3:{if(_[0]===0&&_[1]===1&&_[2]===2){let T=A[0],w=A[1],D=T*w;return{get:(M,E,R,k)=>M[E+R*T+k*D],set:(M,E,R,k,B)=>M[E+R*T+k*D]=B,add:(M,E,R,k,B)=>M[E+R*T+k*D]+=B,dataOffset:(M,E,R)=>M+E*T+R*D,getCoords:(M,E)=>{let R=Math.floor(M/T);return E[0]=M%T,E[1]=R%w,E[2]=Math.floor(R/w),E}}}if(_[0]===0&&_[1]===2&&_[2]===1){let T=A[0],w=A[2],D=T*w;return{get:(M,E,R,k)=>M[E+k*T+R*D],set:(M,E,R,k,B)=>M[E+k*T+R*D]=B,add:(M,E,R,k,B)=>M[E+k*T+R*D]+=B,dataOffset:(M,E,R)=>M+R*T+E*D,getCoords:(M,E)=>{let R=Math.floor(M/T);return E[0]=M%T,E[1]=Math.floor(R/w),E[2]=R%w,E}}}if(_[0]===1&&_[1]===0&&_[2]===2){let T=A[1],w=A[0],D=T*w;return{get:(M,E,R,k)=>M[R+E*T+k*D],set:(M,E,R,k,B)=>M[R+E*T+k*D]=B,add:(M,E,R,k,B)=>M[R+E*T+k*D]+=B,dataOffset:(M,E,R)=>E+M*T+R*D,getCoords:(M,E)=>{let R=Math.floor(M/T);return E[0]=R%w,E[1]=M%T,E[2]=Math.floor(R/w),E}}}if(_[0]===1&&_[1]===2&&_[2]===0){let T=A[1],w=A[2],D=T*w;return{get:(M,E,R,k)=>M[R+k*T+E*D],set:(M,E,R,k,B)=>M[R+k*T+E*D]=B,add:(M,E,R,k,B)=>M[R+k*T+E*D]+=B,dataOffset:(M,E,R)=>E+R*T+M*D,getCoords:(M,E)=>{let R=Math.floor(M/T);return E[0]=Math.floor(R/w),E[1]=M%T,E[2]=R%w,E}}}if(_[0]===2&&_[1]===0&&_[2]===1){let T=A[2],w=A[0],D=T*w;return{get:(M,E,R,k)=>M[k+E*T+R*D],set:(M,E,R,k,B)=>M[k+E*T+R*D]=B,add:(M,E,R,k,B)=>M[k+E*T+R*D]+=B,dataOffset:(M,E,R)=>R+M*T+E*D,getCoords:(M,E)=>{let R=Math.floor(M/T);return E[0]=R%w,E[1]=Math.floor(R/w),E[2]=M%T,E}}}if(_[0]===2&&_[1]===1&&_[2]===0){let T=A[2],w=A[1],D=T*w;return{get:(M,E,R,k)=>M[k+R*T+E*D],set:(M,E,R,k,B)=>M[k+R*T+E*D]=B,add:(M,E,R,k,B)=>M[k+R*T+E*D]+=B,dataOffset:(M,E,R)=>R+E*T+M*D,getCoords:(M,E)=>{let R=Math.floor(M/T);return E[0]=Math.floor(R/w),E[1]=R%w,E[2]=M%T,E}}}throw new Error("bad axis order")}default:return{get:(T,...w)=>T[h(v,w)],set:(T,...w)=>T[h(v,w)]=w[w.length-1],add:(T,...w)=>T[h(v,w)]+=w[w.length-1],dataOffset:(...T)=>h(v,T),getCoords:(T,w)=>f(v,T,w)}}}function p(v){let{dimensions:A}=v,_=1;for(let T=0,w=A.length;T<w;T++)_*=A[T];return T=>new(T||v.defaultCtor)(_)}function h(v,A){let{accessDimensions:_,axisOrderFastToSlow:T}=v,w=_.length-1,D=_[w]*A[T[w]];for(let M=w-1;M>=0;M--)D=(D+A[T[M]])*_[M];return D}function f(v,A,_){let{dimensions:T,axisOrderFastToSlow:w}=v,D=T.length,M=A;for(let E=0;E<D;E++){let R=T[w[E]];_[w[E]]=M%R,M=Math.floor(M/R)}return _[w[D+1]]=M,_}function y(v){let A=[];for(let _=0;_<v.length;_++)A[_]=v[v.length-_-1];return A}I.invertAxisOrder=y;function g(v,A){let _=[];for(let T=0;T<v.length;T++)_[T]=v[A[T]];return _}function x(v){let A=new Int32Array(v.length);for(let _=0;_<v.length;_++)A[v[_]]=_;return _=>g(_,A)}I.convertToCanonicalAxisIndicesFastToSlow=x;function S(v){let A=new Int32Array(v.length);for(let _=0;_<v.length;_++)A[v[v.length-_-1]]=_;return _=>g(_,A)}I.convertToCanonicalAxisIndicesSlowToFast=S})(xr||={});function Hg(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return kd(e,t,r)}function kd(e,t,r){let n=t,o=0,i=1;for(e.charCodeAt(n)===45?(i=-1,++n):e.charCodeAt(n)===43&&++n;n<r;n++){let a=e.charCodeAt(n)-48;if(a>9||a<0)return i*o|0;o=10*o+a|0}return i*o}function Cee(e,t,r,n){return t.charCodeAt(r)===43&&r++,e*Math.pow(10,kd(t,r,n))}function See(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return mc(e,t,r)}function mc(e,t,r){let n=t,o=1,i=0,a=0,s=1;for(e.charCodeAt(n)===45?(o=-1,++n):e.charCodeAt(n)===43&&++n;n<r;){let l=e.charCodeAt(n)-48;if(l>=0&&l<10)i=i*10+l,++n;else if(l===-2){for(++n;n<r;)if(l=e.charCodeAt(n)-48,l>=0&&l<10)a=10*a+l,s=10*s,++n;else return l===53||l===21?Cee(o*(i+a/s),e,n+1,r):o*(i+a/s);return o*(i+a/s)}else{if(l===53||l===21)return Cee(o*i,e,n+1,r);break}}return o*i}var H;(M=>{let e;(ce=>{ce.str={"@type":"str",T:"",valueType:"str"},ce.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},ce.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},ce.int={"@type":"int",T:0,valueType:"int"},ce.coord={"@type":"coord",T:0,valueType:"float"},ce.float={"@type":"float",T:0,valueType:"float"};function U(ie){return{"@type":"str",T:ie?.defaultValue??"",transform:ie?.transform,valueType:"str"}}ce.Str=U;function Q(ie=0){return{"@type":"int",T:ie,valueType:"int"}}ce.Int=Q;function O(ie=0){return{"@type":"float",T:ie,valueType:"float"}}ce.Float=O;function q(ie,oe=ce.float){return{"@type":"tensor",T:ie.create(),space:ie,valueType:"tensor",baseType:oe}}ce.Tensor=q;function X(ie,oe=ce.float){return q(xr.Vector(ie,oe["@type"]==="int"?Int32Array:Float64Array),oe)}ce.Vector=X;function F(ie,oe,W=ce.float){return q(xr.ColumnMajorMatrix(ie,oe,W["@type"]==="int"?Int32Array:Float64Array),W)}ce.Matrix=F;function Y(ie){return ie}ce.Aliased=Y;function $(ie,oe,W=[]){return{"@type":"list",T:W,separator:ie,itemParse:oe,valueType:"list"}}ce.List=$})(e=M.Schema||={});function t(E){return!!E&&!!E.schema&&!!E.value}M.is=t;let r;(B=>(B[B.Present=0]="Present",B[B.NotPresent=1]="NotPresent",B[B.Unknown=2]="Unknown"))(r=M.ValueKinds||={}),M.ValueKind={Present:0,NotPresent:1,Unknown:2};function o(E,R){return vee(R.T,E,R,1)}M.Undefined=o;function i(E,R,k){return vee(E,R,k,0)}M.ofConst=i;function a(E){return gw(E)}M.ofLambda=a;function s(E,R){return a({value:k=>k+E,rowCount:Math.max(R-E+1,0),schema:e.int})}M.range=s;function l(E){return jg(E)}M.ofArray=l;function u(E){return jg({array:E,schema:e.int})}M.ofIntArray=u;function c(E){return jg({array:E,schema:e.float})}M.ofFloatArray=c;function m(E){return jg({array:E,schema:e.str})}M.ofStringArray=m;function d(E){return jg({array:E,schema:e.Aliased(e.str)})}M.ofStringAliasArray=d;function p(E,R=","){return jg({array:E,schema:e.List(R,k=>k)})}M.ofStringListArray=p;function h(E){let{count:R,data:k,indices:B}=E;return gw({value:L=>kd(k,B[2*L],B[2*L+1])||0,rowCount:R,schema:e.int})}M.ofIntTokens=h;function f(E){let{count:R,data:k,indices:B}=E;return gw({value:L=>mc(k,B[2*L],B[2*L+1])||0,rowCount:R,schema:e.float})}M.ofFloatTokens=f;function y(E){let{count:R,data:k,indices:B}=E;return gw({value:L=>{let V=k.substring(B[2*L],B[2*L+1]);return V==="."||V==="?"?"":V},rowCount:R,schema:e.str})}M.ofStringTokens=y;function g(E,R,k){return LMe(E,R,k)}M.window=g;function x(E,R,k=!0){return GMe(E,R,k)}M.view=x;function S(E){return BMe(E)}M.createFirstIndexMap=S;function I(E){return kMe(E)}M.createIndexer=I;function v(E,R,k){return zMe(E,R,k||Array)}M.mapToArray=v;function A(E,R){return HMe(E,R)}M.areEqual=A;function _(E,R){return XMe(E,R)}M.indicesOf=_;function T(E,R){return E.__array?E:E.isDefined?jg({array:E.toArray({array:R}),schema:E.schema,valueKind:E.valueKind}):o(E.rowCount,E.schema)}M.asArrayColumn=T;function w(E,R,k=0){if(!E.isDefined)return;let B=E.__array;if(B)for(let L=0,V=B.length;L<V;L++)R[k+L]=B[L];else for(let L=0,V=E.rowCount;L<V;L++)R[k+L]=E.value(L)}M.copyToArray=w;function D(E){for(let R=0,k=E.rowCount;R<k;R++)if(R!==E.value(R))return!1;return!0}M.isIdentity=D})(H||={});function BMe(e){let t=new Map;for(let r=0,n=e.rowCount;r<n;r++){let o=e.value(r);t.has(o)||t.set(e.value(r),r)}return t}function kMe(e){let t=new Map;for(let r=0,n=e.rowCount;r<n;r++){let o=e.value(r);t.has(o)||t.set(e.value(r),r)}return r=>t.has(r)?t.get(r):-1}function vee(e,t,r,n){return{schema:r,__array:void 0,isDefined:n===0,rowCount:t,value:i=>e,valueKind:i=>n,toArray:i=>{let{array:a}=JC(t,i);for(let s=0,l=a.length;s<l;s++)a[s]=e;return a},areValuesEqual:(i,a)=>!0}}function gw({value:e,valueKind:t,areValuesEqual:r,rowCount:n,schema:o}){return{schema:o,__array:void 0,isDefined:!0,rowCount:n,value:e,valueKind:t||(i=>0),toArray:i=>{let{array:a,start:s}=JC(n,i);for(let l=0,u=a.length;l<u;l++)a[l]=e(l+s);return a},areValuesEqual:r||((i,a)=>e(i)===e(a))}}function jg({array:e,schema:t,valueKind:r}){let n=e.length,o=t.T,i=t.valueType==="str"?t.transform==="lowercase"?s=>{let l=e[s];return typeof l=="string"?l.toLowerCase():`${l??o}`.toLowerCase()}:t.transform==="uppercase"?s=>{let l=e[s];return typeof l=="string"?l.toUpperCase():`${l??o}`.toUpperCase()}:s=>{let l=e[s];return typeof l=="string"?l:`${l??o}`}:s=>e[s],a=fw(e);return{schema:t,__array:e,isDefined:!0,rowCount:n,value:i,valueKind:r||(s=>0),toArray:t.valueType==="str"?t.transform==="lowercase"?s=>{let{start:l,end:u}=wb(n,s),c=new(s&&typeof s.array<"u"?s.array:e.constructor)(u-l);for(let m=0,d=u-l;m<d;m++){let p=e[l+m];c[m]=typeof p=="string"?p.toLowerCase():`${p??o}`.toLowerCase()}return c}:t.transform==="uppercase"?s=>{let{start:l,end:u}=wb(n,s),c=new(s&&typeof s.array<"u"?s.array:e.constructor)(u-l);for(let m=0,d=u-l;m<d;m++){let p=e[l+m];c[m]=typeof p=="string"?p.toUpperCase():`${p??o}`.toUpperCase()}return c}:s=>{let{start:l,end:u}=wb(n,s),c=new(s&&typeof s.array<"u"?s.array:e.constructor)(u-l);for(let m=0,d=u-l;m<d;m++){let p=e[l+m];c[m]=typeof p=="string"?p:`${p??o}`}return c}:a?s=>hw(e,s):s=>{let{start:l,end:u}=wb(n,s);if(l===0&&u===e.length)return e;let c=new(s&&typeof s.array<"u"?s.array:e.constructor)(u-l);for(let m=0,d=u-l;m<d;m++)c[m]=e[l+m];return c},areValuesEqual:(s,l)=>e[s]===e[l]}}function LMe(e,t,r){return e.isDefined?t===0&&r===e.rowCount?e:e.__array&&fw(e.__array)?FMe(e,t,r):VMe(e,t,r):H.Undefined(r-t,e.schema)}function FMe(e,t,r){let n=hw(e.__array,{start:t,end:r}),o=e.valueKind;return jg({array:n,schema:e.schema,valueKind:i=>o(t+i)})}function VMe(e,t,r){let n=e.value,o=e.valueKind,i=e.areValuesEqual,a=t===0?n:l=>n(l+t),s=r-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:a,valueKind:t===0?o:l=>o(l+t),toArray:l=>{let{array:u}=JC(s,l);for(let c=0,m=u.length;c<m;c++)u[c]=n(c+t);return u},areValuesEqual:t===0?i:(l,u)=>i(l+t,u+t)}}function OMe(e,t){if(e.length!==t)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==r)return!1;return!0}function GMe(e,t,r){return e.rowCount===0||r&&OMe(t,e.rowCount)?e:e.__array&&typeof e.value(0)==typeof e.__array[0]?UMe(e,t):NMe(e,t)}function UMe(e,t){let r=e.__array,n=new r.constructor(t.length);for(let i=0,a=t.length;i<a;i++)n[i]=r[t[i]];let o=e.valueKind;return jg({array:n,schema:e.schema,valueKind:i=>o(t[i])})}function NMe(e,t){let r=e.value,n=e.valueKind,o=e.areValuesEqual,i=s=>r(t[s]),a=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:a,value:i,valueKind:s=>n(t[s]),toArray:s=>{let{array:l}=JC(a,s);for(let u=0,c=l.length;u<c;u++)l[u]=r(t[u]);return l},areValuesEqual:(s,l)=>o(t[s],t[l])}}function zMe(e,t,r){let n=new r(e.rowCount);for(let o=0,i=e.rowCount;o<i;o++)n[o]=t(e.value(o));return n}function HMe(e,t){return e===t?!0:e.rowCount!==t.rowCount||e.isDefined!==t.isDefined||e.schema.valueType!==t.schema.valueType?!1:e.__array&&t.__array?jMe(e,t):WMe(e,t)}function jMe(e,t){let r=e.__array,n=t.__array;for(let o=0,i=e.rowCount;o<i;o++)if(r[o]!==n[o])return!1;return!0}function WMe(e,t){let r=e.value,n=t.value;for(let o=0,i=e.rowCount;o<i;o++)if(r(o)!==n(o))return!1;return!0}function XMe(e,t){let r=[],n=e.value;for(let o=0,i=e.rowCount;o<i;o++)t(n(o))&&(r[r.length]=o);return r}var Cr;(S=>{function e(I){return I&&typeof I._rowCount=="number"&&!!I._columns&&!!I._schema}S.is=e;function t(I,v,A={}){let _=Object.create(null),T=Object.keys(I);_._rowCount=v._rowCount,_._columns=T,_._schema=I;for(let w of T)if(v[w])_[w]=v[w];else if(A[w])_[w]=A[w];else throw Error(`Cannot find column '${w}'.`);return _}S.pickColumns=t;function r(I,v){let A=Object.keys(v);return{_rowCount:v[A[0]].rowCount,_columns:A,_schema:I,...v}}S.ofColumns=r;function n(I,v,A){let _=Object.create(null),T=Object.keys(I);_._rowCount=A,_._columns=T,_._schema=I;for(let w of T)w in v?_[w]=v[w]:_[w]=H.Undefined(A,I[w]);return _}S.ofPartialColumns=n;function o(I,v){let A=Object.create(null),_=Object.keys(I);A._rowCount=v,A._columns=_,A._schema=I;for(let T of _)A[T]=H.Undefined(v,I[T]);return A}S.ofUndefinedColumns=o;function i(I,v){let A=Object.create(null),_=v.length,T=Object.keys(I);A._rowCount=_,A._columns=T,A._schema=I;for(let w of T)A[w]=H.ofLambda({rowCount:_,schema:I[w],value:D=>v[D][w],valueKind:D=>typeof v[D][w]>"u"?H.ValueKinds.NotPresent:H.ValueKinds.Present});return A}S.ofRows=i;function a(I,v){let A=Object.create(null),_=Object.keys(I);A._rowCount=0,A._columns=_,A._schema=I;for(let T of _)typeof v[T]<"u"?(A[T]=H.ofArray({array:v[T],schema:I[T]}),A._rowCount=v[T]?.length):A[T]=H.Undefined(A._rowCount,I[T]);return A}S.ofArrays=a;function s(I,v,A){let _=Object.create(null),T=Object.keys(v);_._rowCount=A.length,_._columns=T,_._schema=v;for(let w of T)_[w]=H.view(I[w],A);return _}S.view=s;function l(I,v,A){let _=[];for(let T=0,w=I._rowCount;T<w;++T)A(T)&&_.push(T);return s(I,v,_)}S.pick=l;function u(I,v,A,_){if(A===0&&_===I._rowCount)return I;let T=Object.create(null),w=Object.keys(v);T._rowCount=_-A,T._columns=w,T._schema=v;for(let D of w)T[D]=H.window(I[D],A,_);return T}S.window=u;function c(I,v){let A=Object.create(null),_=Object.keys(v);A._rowCount=0;for(let D of I)A._rowCount+=D._rowCount;let T={};for(let D of _)T[D]=new Array(A._rowCount);A._columns=_,A._schema=v;let w=0;for(let D of I){for(let M of _)H.copyToArray(D[M],T[M],w);w+=D._rowCount}for(let D of _)A[D]=H.ofArray({array:T[D],schema:v[D]});return A}S.concat=c;function m(I,v,A){I[v]=H.asArrayColumn(I[v],A)}S.columnToArray=m;function d(I,v){let A=new Int32Array(I._rowCount);for(let w=0,D=A.length;w<D;w++)A[w]=w;Fs(A,(w,D,M)=>v(D,M));let _=!0;for(let w=0,D=A.length;w<D;w++)if(A[w]!==w){_=!1;break}if(_)return I;let T=Object.create(null);T._rowCount=I._rowCount,T._columns=I._columns,T._schema=I._schema;for(let w of I._columns)T[w]=H.view(I[w],A,!1);return T}S.sort=d;function p(I,v){if(I._rowCount!==v._rowCount||I._columns.length!==v._columns.length)return!1;for(let A of I._columns)if(!v[A])return!1;for(let A of I._columns)if(!H.areEqual(I[A],v[A]))return!1;return!0}S.areEqual=p;function h(I,v){let A=Object.create(null),{_columns:_}=I;for(let T=0;T<_.length;T++){let w=_[T];A[w]=I[w].value(v)}return A}S.getRow=h;function f(I,v){for(let A=0,_=I._rowCount;A<_;++A)if(v(A))return h(I,A)}S.pickRow=f;function y(I){let v=[],{_rowCount:A}=I;for(let _=0;_<A;_++)v[_]=h(I,_);return v}S.getRows=y;function g(I){let v={},{_columns:A}=I;for(let _=0;_<A.length;_++){let T=A[_];v[T]=I[T].toArray()}return v}S.toArrays=g;function x(I){let v=Hn.create(),{_columns:A,_rowCount:_}=I,T=1;Hn.write(v,"|");for(let w=0;w<A.length;w++)Hn.write(v,A[w]),Hn.write(v,"|"),T+=A[w].length+1;Hn.newline(v),Hn.write(v,new Array(T+1).join("-")),Hn.newline(v);for(let w=0;w<_;w++){Hn.write(v,"|");for(let D=0;D<A.length;D++){let M=I[A[D]];M.valueKind(w)===H.ValueKinds.Present?(Hn.write(v,M.value(w)),Hn.write(v,"|")):Hn.write(v,".|")}Hn.newline(v)}return Hn.getString(v)}S.formatToString=x})(Cr||={});var yw;(r=>{function e(n,o,i){let a=Object.keys(i),s=Object.create(null),l=[];s._name=n,s._tableNames=l,s._schema=o;for(let u of a)Cr.is(i[u])&&(s[u]=i[u],l[l.length]=u);return s}r.ofTables=e;function t(n){let o={};for(let i of n._tableNames)o[i]=Cr.getRows(n[i]);return o}r.getTablesAsRows=t})(yw||={});function z1(e,t){for(let r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r]}function H1(e){if(Array.from)return Array.from(e);let t=[];for(;;){let{done:r,value:n}=e.next();if(r)break;t[t.length]=n}return t}function BP(e,t,r){let n=t-e+1,o=r?new r(n):new Int32Array(n);for(let i=0;i<n;i++)o[i]=i+e;return o}function Iee(e,t){let r=new(ZMe(e))(t.length);for(let n=0,o=t.length;n<o;n++)r[n]=e[t[n]];return r}function ZMe(e){let t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}var ia;(f=>{f.Zero=0;let{_int32:t,_float64:r,_int32_1:n,_float64_1:o}=function(){let y=new ArrayBuffer(8),g=new ArrayBuffer(8);return{_int32:new Int32Array(y),_float64:new Float64Array(y),_int32_1:new Int32Array(g),_float64_1:new Float64Array(g)}}();function i(y){return typeof y=="number"}f.is=i;function a(y,g){return t[0]=y,t[1]=g,r[0]}f.create=a;function s(y){return r[0]=y,t[1]-t[0]}f.diff=s;function l(y){return r[0]=y,t[0]}f.fst=l;function u(y){return r[0]=y,t[1]}f.snd=u;function c(y,g){return r[0]=y,o[0]=g,t[0]===n[0]&&t[1]===n[1]}f.areEqual=c;function m(y,g){r[0]=y,o[0]=g;let x=t[0]-n[0];return x!==0?x:t[1]-n[1]}f.compare=m;function d(y,g,x){r[0]=y[g],o[0]=y[x];let S=t[0]-n[0];return S!==0?S:t[1]-n[1]}f.compareInArray=d;function p(y){return r[0]=y,Du(t[0],t[1])}f.hashCode=p;function h(y){return r[0]=y,`(${t[0]}, ${t[1]})`}f.toString=h})(ia||={});var KU=ia.Zero;function JU(e,t){return t<e?ia.create(e,e):ia.create(e,t+1)}function xw(e,t){return t<=e?ia.create(e,e):ia.create(e,t)}function Aee(e){return e<0?ia.create(0,0):ia.create(0,e)}var Tee=ia.is,qp=ia.fst,Kf=ia.snd,kP=ia.fst;function LP(e){return ia.snd(e)-1}var Mb=ia.diff,Pee=ia.hashCode,_ee=ia.toString;function Ree(e,t){return ia.fst(e)<=t&&t<ia.snd(e)}function Dee(e,t){let r=qp(e);return t>=r&&t<Kf(e)?t-r:-1}function wee(e,t){return ia.fst(e)+t}var Eee=ia.areEqual;function $U(e,t){let r=Mb(e),n=Mb(t);return r===0&&n===0?!0:r>0&&n>0&&LP(e)>=kP(t)&&kP(e)<=LP(t)}function Mee(e,t){return Mb(e)?Mb(t)?qp(e)<=qp(t)&&Kf(e)>=Kf(t):!0:Mb(t)===0}function bw(e,t){let r=qp(e);if(t<=r)return 0;let n=Kf(e);return t>=n?n-r:t-r}function Bee(e,t,r){let n=qp(r),o=qp(e);if(t<=n+o)return n;let i=Kf(r);return t>=i+o?i:t-o}function eN(e,t,r){return xw(bw(e,t),bw(e,r+1))}function kee(e,t){return $U(e,t)?xw(Math.max(qp(e),qp(t)),Math.min(Kf(e),Kf(t))):KU}function Lee(e,t){return Mb(eN(e,kP(t),LP(t)))}function Fee(e,t){return ia.create(qp(e)+t,Kf(e)+t)}var xe;(w=>(w.Empty=KU,w.ofSingleton=D=>JU(D,D),w.ofRange=JU,w.ofBounds=xw,w.ofLength=Aee,w.is=Tee,w.has=Ree,w.indexOf=Dee,w.getAt=wee,w.start=qp,w.end=Kf,w.min=kP,w.max=LP,w.size=Mb,w.hashCode=Pee,w.toString=_ee,w.areEqual=Eee,w.areIntersecting=$U,w.isSubInterval=Mee,w.findPredecessorIndex=bw,w.findPredecessorIndexInInterval=Bee,w.findRange=eN,w.intersectionSize=Lee,w.intersect=kee,w.offset=Fee))(xe||={});var j1=[];function Vee(e){return[e]}function Oee(e){return e}function Gee(e){return Fs(e),e}function tN(e,t){if(t<e)return[];let r=new Int32Array(t-e+1);for(let n=e;n<=t;n++)r[n-e]=n;return r}function Uee(e){return e&&(Array.isArray(e)||!!e.buffer)}function rN(e){return e[e.length-1]-e[0]+1===e.length}function Cw(e){return e[0]}function Sw(e){return e[e.length-1]+1}function Nee(e){return e[0]}function zee(e){return e[e.length-1]}function nN(e){return e.length}function Hee(e){let t=e.length;return t?t>2?bee(t,e[0],e[t-1],e[t>>1]):yee(t,e[0],e[t-1]):0}function jee(e){let t=e.length;return t>5?`[${e[0]}, ${e[1]}, ..., ${e[t-1]}], length ${t}`:`[${e.join(", ")}]`}function oN(e,t){let r=e.length;return r===0?-1:e[0]<=t&&t<=e[r-1]?qee(e,t,0,r):-1}function Wee(e,t,r){return iN(e,t,xe.start(r),xe.end(r))}function iN(e,t,r,n){return e.length===0||n<=r?-1:e[r]<=t&&t<=e[n-1]?qee(e,t,r,n):-1}function Xee(e,t){return oN(e,t)>=0}function aN(e,t){if(e===t)return!0;let r=e.length;if(r!==t.length||e[0]!==t[0]||e[r-1]!==t[r-1])return!1;if(rN(e))return!0;r--;for(let n=1;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Bb(e,t){return Yee(e,t,0,e.length)}function Qee(e,t,r){return Yee(e,t,xe.start(r),xe.end(r))}function Zee(e,t,r){return xe.ofBounds(Bb(e,t),Bb(e,r+1))}function qee(e,t,r,n){let o=r,i=n-1;for(;o<=i;){if(o+11>i){for(let l=o;l<=i;l++)if(t===e[l])return l;return-1}let a=o+i>>1,s=e[a];if(t<s)i=a-1;else if(t>s)o=a+1;else return a}return-1}function Yee(e,t,r,n){if(r===n||e[r]>=t)return r;if(e[n-1]<t)return n;let o=r,i=n;for(;i-o>4;){let a=o+i>>1;e[a]>=t?i=a:o=a+1}for(let a=o;a<i;a++)if(e[a]>=t)return a;return i}function Kee(e,t){if(e===t)return!0;let{startI:r,startJ:n,endI:o,endJ:i}=e0(e,t);for(;r<o&&n<i;){let a=e[r],s=t[n];if(a<s)r++;else if(a>s)n++;else return!0}return!1}function Jee(e,t){if(e===t)return!0;let r=t.length,{startI:n,startJ:o,endI:i,endJ:a}=e0(e,t);if(a-o<r||i-n<r)return!1;let s=0;for(;n<i&&o<a;){let l=e[n],u=t[o];l<u?n++:l>u?o++:(n++,o++,s++)}return s===r}function sN(e,t){if(e===t)return e;let r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;if(e[0]>t[0])return sN(t,e);let{startI:o,startJ:i,endI:a,endJ:s}=e0(e,t),l=lN(e,t,o,i,a,s);if(l===r&&l===n||l===n)return e;if(l===r)return t;let u=new Int32Array(r+n-l),c=0,m=0,d=0;for(c=0;c<o;c++)u[d++]=e[c];for(;m<s&&e[o]>t[m];)u[d++]=t[m++];for(;c<a&&m<s;){let p=e[c],h=t[m];p<h?(u[d++]=p,c++):p>h?(u[d++]=h,m++):(u[d++]=p,c++,m++)}for(;c<a;c++)u[d++]=e[c];for(;m<s;m++)u[d++]=t[m];for(;c<r;c++)u[d++]=e[c];for(;m<n;m++)u[d++]=t[m];return u}function $ee(e,t){if(e===t)return nN(e);let{startI:r,startJ:n,endI:o,endJ:i}=e0(e,t);return lN(e,t,r,n,o,i)}function lN(e,t,r,n,o,i){let a=r,s=n,l=0;for(;a<o&&s<i;){let u=e[a],c=t[s];u<c?a++:u>c?s++:(a++,s++,l++)}return l}function ete(e,t){if(e===t)return e;let{startI:r,startJ:n,endI:o,endJ:i}=e0(e,t),a=lN(e,t,r,n,o,i),s=e.length,l=t.length;if(!a)return j1;if(a===s&&a===l||a===l)return t;if(a===s)return e;let u=new Int32Array(a),c=0,m=r,d=n;for(;m<o&&d<i;){let p=e[m],h=t[d];p<h?m++:(p>h||(u[c++]=p,m++),d++)}return u}function tte(e,t){if(e===t)return j1;let r=e.length,{startI:n,startJ:o,endI:i,endJ:a}=e0(e,t),s=n,l=o,u=0;for(;s<i&&l<a;){let d=e[s],p=t[l];d<p?s++:d>p?l++:(s++,l++,u++)}if(!u)return e;if(u>=r)return j1;let c=new Int32Array(r-u),m=0;for(let d=0;d<n;d++)c[m++]=e[d];for(s=n,l=o;s<i&&l<a;){let d=e[s],p=t[l];d<p?(c[m++]=d,s++):(d>p||s++,l++)}for(;s<r;s++)c[m++]=e[s];return c}function rte(e){if(e.length<2)return e;let t=1;for(let o=0,i=e.length-1;o<i;o++)e[o]!==e[o+1]&&t++;if(t===e.length)return e;let r=new Int32Array(t),n=0;for(let o=0,i=e.length-1;o<i;o++)e[o]!==e[o+1]&&(r[n++]=e[o]);return r[n]=e[e.length-1],r}function nte(e,t){if(aN(e,t))return BP(0,e.length-1);let{startI:r,startJ:n,endI:o,endJ:i}=e0(e,t),a=r,s=n,l=0;for(;a<o&&s<i;){let d=e[a],p=t[s];d<p?a++:d>p?s++:(a++,s++,l++)}let u=e.length;if(!l)return j1;if(l===u)return BP(0,e.length-1);let c=new Int32Array(l),m=0;for(a=r,s=n;a<o&&s<i;){let d=e[a],p=t[s];d<p?a++:(d>p||(c[m++]=a,a++),s++)}return c}var Wg={startI:0,startJ:0,endI:0,endJ:0};function e0(e,t){let r=e.length,n=t.length,o=r/n;return r>=128||n>=128||o<=.34||o>=2.99?(Wg.startI=Bb(e,Cw(t)),Wg.startJ=Bb(t,Cw(e)),Wg.endI=Bb(e,Sw(t)),Wg.endJ=Bb(t,Sw(e))):(Wg.startI=0,Wg.startJ=0,Wg.endI=r,Wg.endJ=n),Wg}var Be;(B=>(B.Empty=j1,B.ofUnsortedArray=Gee,B.ofSingleton=Vee,B.ofSortedArray=Oee,B.ofRange=tN,B.ofBounds=(L,V)=>tN(L,V-1),B.is=Uee,B.isRange=rN,B.has=Xee,B.indexOf=oN,B.indexOfInInterval=Wee,B.indexOfInRange=iN,B.start=Cw,B.end=Sw,B.min=Nee,B.max=zee,B.size=nN,B.hashCode=Hee,B.toString=jee,B.areEqual=aN,B.areIntersecting=Kee,B.isSubset=Jee,B.union=sN,B.intersect=ete,B.subtract=tte,B.findPredecessorIndex=Bb,B.findPredecessorIndexInInterval=Qee,B.findRange=Zee,B.intersectionSize=$ee,B.deduplicate=rte,B.indicesOf=nte))(Be||={});var Yp=xe.Empty,ute=xe.ofSingleton,cte=xe.ofRange,mte=xe.ofBounds;function Ld(e){return e.length?Be.isRange(e)?xe.ofRange(e[0],e[e.length-1]):e:Yp}function Xg(e){return xe.is(e)?xe.size(e):Be.size(e)}function dte(e,t){return xe.is(e)?xe.has(e,t):Be.has(e,t)}function pte(e,t){return xe.is(e)?xe.indexOf(e,t):Be.indexOf(e,t)}function vw(e,t){return xe.is(e)?xe.getAt(e,t):e[t]}function t0(e){return xe.is(e)?xe.min(e):Be.min(e)}function r0(e){return xe.is(e)?xe.max(e):Be.max(e)}function fte(e){return xe.is(e)?xe.start(e):Be.start(e)}function hte(e){return xe.is(e)?xe.end(e):Be.end(e)}function gte(e){return Xg(e)===0}function yte(e){return xe.is(e)?xe.hashCode(e):Be.hashCode(e)}function bte(e){return xe.is(e)?xe.toString(e):Be.toString(e)}function xte(e,t){return xe.is(e)?xe.is(t)?xe.areEqual(e,t):ote(e,t):xe.is(t)?ote(t,e):Be.areEqual(e,t)}function Cte(e,t){return xe.is(e)?xe.is(t)?xe.areIntersecting(e,t):ite(t,e):xe.is(t)?ite(e,t):Be.areIntersecting(e,t)}function Ste(e,t){return xe.is(e)?xe.is(t)?xe.isSubInterval(e,t):$Me(e,t):xe.is(t)?JMe(e,t):Be.isSubset(e,t)}function vte(e,t){return xe.is(e)?xe.findPredecessorIndex(e,t):Be.findPredecessorIndex(e,t)}function Ite(e,t,r){return xe.is(e)?xe.findPredecessorIndexInInterval(e,t,r):Be.findPredecessorIndexInInterval(e,t,r)}function Ate(e,t,r){return xe.is(e)?xe.findRange(e,t,r):Be.findRange(e,t,r)}function Tte(e,t){return xe.is(e)?xe.is(t)?xe.intersectionSize(e,t):ste(t,e):xe.is(t)?ste(e,t):Be.intersectionSize(e,t)}function Pte(e,t){return xe.is(e)?xe.is(t)?rBe(e,t):ate(t,e):xe.is(t)?ate(e,t):Ld(Be.union(e,t))}function _te(e,t){return xe.is(e)?xe.is(t)?xe.intersect(e,t):lte(t,e):xe.is(t)?lte(e,t):Ld(Be.intersect(e,t))}function Rte(e,t){return xe.is(e)?xe.is(t)?nBe(e,t):iBe(e,t):xe.is(t)?oBe(e,t):Ld(Be.subtract(e,t))}function ote(e,t){return xe.size(e)===Be.size(t)&&xe.start(e)===Be.start(t)&&xe.end(e)===Be.end(t)}function ite(e,t){return e.length!==0&&xe.size(Be.findRange(e,xe.min(t),xe.max(t)))!==0}function JMe(e,t){let r=xe.min(t),n=xe.max(t);if(n-r+1===0)return!0;let o=Be.min(e),i=Be.max(e);if(r<o||n>i)return!1;let a=Be.findRange(e,r,n);return xe.size(a)===xe.size(t)}function $Me(e,t){let r=xe.min(e),n=xe.max(e);if(n-r+1===0)return!1;let o=Be.min(t),i=Be.max(t);return o>=r&&i<=n}function eBe(e,t){let r=Xg(e),n=Xg(t);return r===0&&n===0?!0:r>0&&n>0&&r0(e)>=t0(t)&&t0(e)<=r0(t)}function tBe(e,t){return Xg(e)?Xg(t)?t0(e)<=t0(t)&&r0(e)>=r0(t):!0:Xg(t)===0}function rBe(e,t){if(xe.areEqual(e,t))return e;let r=xe.size(e),n=xe.size(t);if(!n)return e;if(!r)return t;let o=xe.min(e),i=xe.min(t);if(eBe(e,t))return xe.ofRange(Math.min(o,i),Math.max(xe.max(e),xe.max(t)));let a,s,l,u;o<i?(a=r,s=o,l=n,u=i):(a=n,s=i,l=r,u=o);let c=new Int32Array(r+n);for(let m=0;m<a;m++)c[m]=m+s;for(let m=0;m<l;m++)c[m+a]=m+u;return Ld(c)}function ate(e,t){let r=xe.size(t);if(!r)return e;if(tBe(t,e))return t;let n=xe.min(t),o=xe.max(t),i=Be.findRange(e,n,o),a=xe.start(i),s=xe.end(i),l=new Int32Array(a+(e.length-s)+r),u=0;for(let c=0;c<a;c++)l[u++]=e[c];for(let c=n;c<=o;c++)l[u++]=c;for(let c=s,m=e.length;c<m;c++)l[u++]=e[c];return Ld(l)}function ste(e,t){if(!xe.size(t))return 0;let r=Be.findRange(e,xe.min(t),xe.max(t));return xe.end(r)-xe.start(r)}function lte(e,t){if(!xe.size(t))return Yp;let r=Be.findRange(e,xe.min(t),xe.max(t)),n=xe.start(r),o=xe.end(r),i=o-n;if(!i)return Yp;if(i===e.length)return e;let a=new Int32Array(i),s=0;for(let l=n;l<o;l++)a[s++]=e[l];return Ld(a)}function nBe(e,t){if(xe.areEqual(e,t))return Yp;if(!xe.areIntersecting(e,t))return e;let r=xe.min(e),n=xe.max(e),o=xe.min(t),i=xe.max(t);if(n<r||i<o)return e;if(xe.isSubInterval(t,e))return Yp;if(xe.isSubInterval(e,t)){let a=o-r,s=n-i;if(a<=0)return xe.ofRange(i+1,i+s);if(s<=0)return xe.ofRange(r,r+a-1);let l=new Int32Array(a+s),u=0;for(let c=0;c<a;c++)l[u++]=r+c;for(let c=1;c<=s;c++)l[u++]=i+c;return Ld(l)}return r<o?xe.ofRange(r,o-1):xe.ofRange(i+1,n)}function oBe(e,t){let r=xe.min(t),n=xe.max(t);if(n<r)return e;let o=Be.findRange(e,r,n),i=xe.start(o),a=xe.end(o),s=e.length-(a-i);if(s<=0)return Yp;if(s===e.length)return e;let l=new Int32Array(s),u=0;for(let c=0;c<i;c++)l[u++]=e[c];for(let c=a,m=e.length;c<m;c++)l[u++]=e[c];return Ld(l)}function iBe(e,t){let r=xe.min(e),n=xe.max(e);if(n<r)return e;let o=n-r+1,i=Be.findRange(t,r,n),a=xe.start(i),s=xe.end(i),l=s-a;if(l===0)return e;let u=o-l;if(u<=0)return Yp;let c=new Int32Array(u),m=t.length-1,d=t[Math.min(a,m)],p=t[Math.min(s,m)],h=0;for(let f=r;f<d;f++)c[h++]=f;for(let f=d;f<=p;f++)Be.indexOfInInterval(t,f,i)<0&&(c[h++]=f);for(let f=p+1;f<=n;f++)c[h++]=f;return Ld(c)}function Dte(e,t,r){if(xe.is(e)){let n=xe.min(e);for(let o=n,i=xe.max(e);o<=i;o++)t(o,o-n,r)}else for(let n=0,o=e.length;n<o;n++)t(e[n],n,r);return r}function wte(e,t,r,n){if(xe.is(e)){let o=0;for(let i=xe.min(e),a=xe.max(e);i<=a;i++){let s=t(i),l=i+1;for(;l<a&&t(l)===s;)l++;i=l-1,r(s,o,n),o++}}else{let o=0;for(let i=0,a=e.length;i<a;i++){let s=t(e[i]),l=i+1;for(;l<a&&t(e[l])===s;)l++;i=l-1,r(s,o,n),o++}}return n}function Ete(e,t,r){if(t===r)return e;let n=Xg(e),o=t.length,i=r.length;if(n===0||o===0||i===0)return Yp;let a=Be.findPredecessorIndex(r,t[t0(e)]),s=Be.findPredecessorIndex(r,t[r0(e)]+1),l=0,u=0,c=0,m=a;for(;c<n&&m<s;){let p=t[vw(e,c)],h=r[m];p<h?c++:(p>h||(l++,c++),m++)}if(l===0)return Yp;if(l===o&&l===i)return e;let d=new Int32Array(l);for(u=0,c=0,m=a;c<n&&m<s;){let p=t[vw(e,c)],h=r[m];p<h?c++:(p>h||(d[u++]=m,c++),m++)}return Ld(d)}var Se;(L=>{L.Empty=Yp,L.ofSingleton=ute,L.ofRange=cte,L.ofBounds=mte,L.ofSortedArray=Ld,L.has=dte,L.indexOf=pte,L.getAt=vw,L.isEmpty=gte,L.min=t0,L.max=r0,L.start=fte,L.end=hte,L.size=Xg,L.hashCode=yte,L.areEqual=xte,L.areIntersecting=Cte,L.isSubset=Ste,L.union=Pte,L.intersect=_te,L.indexedIntersect=Ete,L.subtract=Rte,L.findPredecessorIndex=vte,L.findPredecessorIndexInInterval=Ite,L.findRange=Ate,L.intersectionSize=Tte;function D(V,U,Q){return Dte(V,U,Q)}L.forEach=D;function M(V,U,Q,O){return wte(V,U,Q,O)}L.forEachSegment=M;function E(V){return xe.is(V)}L.isInterval=E;function R(V){return!xe.is(V)}L.isSortedArray=R;function k(V){let U=[];return L.forEach(V,Q=>U.push(Q)),U}L.toArray=k;function B(V){return bte(V)}L.toString=B})(Se||={});function cN(e){let t=Be.ofSortedArray(e),r=Be.max(t),n=new Int32Array(r);for(let o=0,i=e.length-1;o<i;o++)for(let a=e[o],s=e[o+1];a<s;a++)n[a]=o;return{offsets:t,index:n,count:e.length-1}}function Mte(e,t){let r=xe.start(t),n=new Int32Array(e.length+1);for(let o=0,i=e.length;o<i;o++)n[o]=e[o]-r;return n[e.length]=xe.end(t)-r,cN(n)}function Bte({count:e}){return e}function kte({index:e},t){return e[t]}function Lte({offsets:e},t,r){let n=Se.max(e),o=r>=n?-1:Se.findPredecessorIndex(e,r-1);return Se.findRange(t,Se.getAt(e,o),Se.getAt(e,o+1)-1)}var uN=class{constructor(t,r,n,o){this.segments=t;this.segmentMap=r;this.set=n;this.segmentMin=0;this.segmentMax=0;this.setRange=xe.Empty;this.value={index:0,start:0,end:0};this.hasNext=!1;this.setRange=o,this.updateSegmentRange()}move(){for(;this.hasNext;)if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&xe.size(this.setRange)>0;break}else this.updateSegmentRange();return this.value}updateValue(){let t=this.segments[this.segmentMin+1],r=Se.findPredecessorIndexInInterval(this.set,t,this.setRange);return this.value.start=xe.start(this.setRange),this.value.end=r,this.setRange=xe.ofBounds(r,xe.end(this.setRange)),r>this.value.start}updateSegmentRange(){let t=xe.min(this.setRange),r=xe.max(this.setRange);if(r<t){this.hasNext=!1;return}this.segmentMin=this.segmentMap[Se.getAt(this.set,t)],this.segmentMax=this.segmentMap[Se.getAt(this.set,r)],this.hasNext=this.segmentMax>=this.segmentMin}setSegment(t){this.setRange=xe.ofBounds(t.start,t.end),this.updateSegmentRange()}};function Fte(e,t,r){let n=typeof r<"u"?xe.ofBounds(r.start,r.end):xe.ofBounds(0,Se.size(t));return new uN(e.offsets,e.index,t,n)}var Xt;(a=>(a.create=cN,a.ofOffsets=Mte,a.count=Bte,a.getSegment=kte,a.projectValue=Lte,a.transientSegments=Fte))(Xt||={});function dN(e){return new mN(e)}var mN=class{remove(t){let{prev:r,next:n}=this,o=r[t],i=n[t];o>=0&&(n[o]=i,r[t]=-1),i>=0&&(r[i]=o,n[t]=-1),t===this.head&&(o<0?this.head=i:this.head=o)}has(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t}constructor(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(let r=0;r<t;r++)this.next[r]=r+1,this.prev[r]=r-1;this.prev[0]=-1,this.next[t-1]=-1}};var xl;(a=>{a.Empty=new Map;function t(s){return H1(s.keys())}a.keyArray=t;function r(){return new Map}a.Mutable=r;function n(s){return s}a.asImmutable=n;function o(s){let l=r(),u=s.keys();for(;;){let{done:c,value:m}=u.next();if(c)break;l.set(m,s.get(m))}return l}a.copy=o;function i(s,l){let u=l.keys();for(;;){let{done:c,value:m}=u.next();if(c)break;s.set(m,l.get(m))}return s}a.addFrom=i})(xl||={});var pN=class{constructor(t){this.xs=[];this.index=-1;this.length=0;this.hasNext=!1;this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}move(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue}},Iw=class{constructor(t,r){this.max=r;this.value=0;this.hasNext=!1;this.value=t-1,this.hasNext=r>=t}move(){return++this.value,this.hasNext=this.value<this.max,this.value}},fN=class{constructor(t){this.value=t;this.hasNext=!0}move(){return this.hasNext=!1,this.value}},hN=class{constructor(t,r){this.base=t;this.f=r;this.hasNext=!1;this.hasNext=t.hasNext}move(){let t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t}},gN=class{constructor(t,r){this.base=t;this.p=r;this.hasNext=this.findNext()}move(){let t=this.next;return this.hasNext=this.findNext(),t}findNext(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1}},n0;(s=>{s.Empty=new Iw(0,-1);function t(l){return new pN(l)}s.Array=t;function r(l){return new fN(l)}s.Value=r;function n(l,u){return new Iw(l,u)}s.Range=n;function o(l,u){return new hN(l,u)}s.map=o;function i(l,u){return new gN(l,u)}s.filter=i;function a(l,u,c){for(;l.hasNext;)if(u(l.move(),c))return c;return c}s.forEach=a})(n0||={});var uBe={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""},Ba;(s=>{function e(l){return r(l,"continuous")}s.create=e;function t(l){return r(l,"discrete")}s.createDiscrete=t;function r(l,u){let{domain:c,reverse:m,listOrName:d}={...uBe,...l},p=typeof d=="string"?Ma(d).list:d,h=m?p.slice().reverse():p,f=0,y=0,g=0;function x(_,T){y=_,g=T,f=g-y||1}x(c[0],c[1]);let S=Wi(l.minLabel,y.toString()),I=Wi(l.maxLabel,g.toString()),v;if(h.every(_=>Array.isArray(_))){let _=[...h];_.sort((M,E)=>M[1]-E[1]);let T=_.map(M=>M[0]),w=Be.ofSortedArray(_.map(M=>M[1])),D=T.length-1;switch(u){case"continuous":v=M=>n(M,T,w,y,D,f);break;case"discrete":v=M=>i(M,T,w,y,D,f);break}}else switch(u){case"continuous":v=_=>o(_,h,y,g,f);break;case"discrete":v=_=>a(_,h,y,g,f);break}return{color:v,colorToArray:(_,T,w)=>{Fe.toArray(v(_),T,w)},normalizedColorToArray:(_,T,w)=>{Fe.toArrayNormalized(v(_),T,w)},setDomain:x,get legend(){return fee(S,I,h)}}}function n(l,u,c,m,d,p){let h=Br((l-m)/p,0,1),f=Be.findPredecessorIndex(c,h);if(f===0)return u[m];if(f>d)return u[d];let y=c[f-1],g=c[f],x=Br((h-y)/(g-y),0,1);return Fe.interpolate(u[f-1],u[f],x)}function o(l,u,c,m,d){let p=Math.min(u.length-1,Math.max(0,(l-c)/d*u.length-1)),h=Math.floor(p),f=u[h],y=u[Math.ceil(p)];return Fe.interpolate(f,y,p-h)}function i(l,u,c,m,d,p){if(u.length===0)return Fe.fromRgb(0,0,0);let h=Br((l-m)/p,0,1),f=Be.findPredecessorIndex(c,h);return f===0?u[m]:f>d?u[d]:u[f]}function a(l,u,c,m,d){if(u.length===0)return Fe.fromRgb(0,0,0);let p=d/u.length;if(l<=c)return u[0];if(l>=m)return u[u.length-1];let h=Math.min(u.length-1,Math.floor((l-c)/p));return u[h]}})(Ba||={});var it=Rt(nr());function yn(e){return e.svg?(0,it.jsx)("span",{className:`msp-icon msp-material-icon${e.inline?" msp-icon-inline":""}`,title:e.title,style:e.style,children:(0,it.jsx)(e.svg,{})}):null}var Tw=(0,it.jsx)("circle",{r:"6px",id:"circle-left",cy:"12px",cx:"8px",strokeWidth:"1px"}),Pw=(0,it.jsx)("circle",{r:"6px",id:"circle-right",cy:"12px",cx:"16px",strokeWidth:"1px"}),gBe=(0,it.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,it.jsxs)("defs",{children:[Tw,Pw]}),(0,it.jsxs)("g",{children:[(0,it.jsx)("use",{href:"#circle-left",className:"msp-shape-filled"}),(0,it.jsx)("use",{href:"#circle-right",className:"msp-shape-filled"}),(0,it.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"})]})]});function FP(){return gBe}var yBe=(0,it.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,it.jsxs)("defs",{children:[Tw,Pw,(0,it.jsxs)("mask",{id:"mask-left",children:[(0,it.jsx)("use",{href:"#circle-left",fill:"white",stroke:"white"}),(0,it.jsx)("use",{href:"#circle-right",fill:"black",strokeWidth:"0px",stroke:"white"})]})]}),(0,it.jsxs)("g",{children:[(0,it.jsx)("use",{href:"#circle-left",className:"msp-shape-filled",mask:"url(#mask-left)"}),(0,it.jsx)("use",{href:"#circle-right",className:"msp-shape-empty"})]})]});function VP(){return yBe}var bBe=(0,it.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,it.jsxs)("defs",{children:[Tw,Pw,(0,it.jsx)("clipPath",{id:"clip-left",children:(0,it.jsx)("use",{href:"#circle-right"})})]}),(0,it.jsxs)("g",{children:[(0,it.jsx)("use",{href:"#circle-left",className:"msp-shape-filled",clipPath:"url(#clip-left)"}),(0,it.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"}),(0,it.jsx)("use",{href:"#circle-right",className:"msp-shape-empty"})]})]});function OP(){return bBe}var xBe=(0,it.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,it.jsxs)("defs",{children:[Tw,Pw]}),(0,it.jsxs)("g",{children:[(0,it.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"}),(0,it.jsx)("use",{href:"#circle-right",className:"msp-shape-filled"})]})]});function i0(){return xBe}var CBe=(0,it.jsx)("svg",{width:"17px",height:"17px",viewBox:"0 0 299.463 299.463",strokeWidth:"6px",children:(0,it.jsx)("g",{children:(0,it.jsx)("path",{d:"M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z"})})});function Ute(){return CBe}var SBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,it.jsx)("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"})});function GP(){return SBe}var vBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"})});function IBe(){return vBe}var ABe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{fill:"currentColor",d:"M7.5,5.6L5,7L6.4,4.5L5,2L7.5,3.4L10,2L8.6,4.5L10,7L7.5,5.6M19.5,15.4L22,14L20.6,16.5L22,19L19.5,17.6L17,19L18.4,16.5L17,14L19.5,15.4M22,2L20.6,4.5L22,7L19.5,5.6L17,7L18.4,4.5L17,2L19.5,3.4L22,2M13.34,12.78L15.78,10.34L13.66,8.22L11.22,10.66L13.34,12.78M14.37,7.29L16.71,9.63C17.1,10 17.1,10.65 16.71,11.04L5.04,22.71C4.65,23.1 4,23.1 3.63,22.71L1.29,20.37C0.9,20 0.9,19.35 1.29,18.96L12.96,7.29C13.35,6.9 14,6.9 14.37,7.29Z"})});function Nte(){return ABe}var TBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,it.jsx)("path",{d:"M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z"})});function zte(){return TBe}var PBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z"})});function yN(){return PBe}var _Be=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})});function Kp(){return _Be}var RBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"})});function kb(){return RBe}var DBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M7 10l5 5 5-5z"})});function wu(){return DBe}var wBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M10 17l5-5-5-5v10z"})});function Eu(){return wBe}var EBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"})});function Lb(){return EBe}var MBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"})});function Hte(){return MBe}var BBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"})});function bN(){return BBe}var kBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z"})});function Qg(){return kBe}var LBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"})});function _w(){return LBe}var FBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z"})});function jte(){return FBe}var VBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"})});function Wte(){return VBe}var OBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z"})});function Xte(){return OBe}var GBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z"})});function Qte(){return GBe}var UBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"})});function UP(){return UBe}var NBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"})});function Rw(){return NBe}var zBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"})});function Zte(){return zBe}var HBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})});function Lm(){return HBe}var jBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})});function xN(){return jBe}var WBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})});function dc(){return WBe}var XBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"})});function qte(){return XBe}var QBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})});function Yte(){return QBe}var ZBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z"})});function Kte(){return ZBe}var qBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"})});function Jte(){return qBe}var YBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"})});function $te(){return YBe}var KBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"})});function ere(){return KBe}var JBe=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"})});function Vs(){return JBe}var $Be=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})});function CN(){return $Be}var eke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,it.jsx)("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"})});function tke(){return eke}var rke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})});function tre(){return rke}var nke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})});function NP(){return nke}var oke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"})});function Mu(){return oke}var ike=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"})});function zP(){return ike}var ake=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"})});function ske(){return ake}var lke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})});function Fd(){return lke}var uke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})});function SN(){return uke}var cke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})});function vN(){return cke}var mke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"})});function rre(){return mke}var dke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M8 5v14l11-7z"})});function Dw(){return dke}var pke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})});function HP(){return pke}var fke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M19 13H5v-2h14v2z"})});function jP(){return fke}var hke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"})});function WP(){return hke}var gke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,it.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"})});function ww(){return gke}var yke=(0,it.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,it.jsx)("circle",{cx:"7",cy:"14",r:"3"}),(0,it.jsx)("circle",{cx:"11",cy:"6",r:"3"}),(0,it.jsx)("circle",{cx:"16.6",cy:"17.6",r:"3"})]});function bke(){return yke}var xke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})});function nre(){return xke}var Cke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M6 6h12v12H6z"})});function IN(){return Cke}var Ske=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z"})});function ore(){return Ske}var vke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"})});function ire(){return vke}var Ike=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})});function pc(){return Ike}var Ake=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"})});function Fm(){return Ake}var Tke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"})});function Jc(){return Tke}var Pke=(0,it.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,it.jsx)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"})});function Ew(){return Pke}var are=IBe,sre=bke,AN=ske,lre=tke;var io=Rt(nr()),Cl=class extends Zg.Component{constructor(){super(...arguments);this.state={isExpanded:!!this.props.initialExpanded};this.headerClicked=()=>{this.props.onHeaderClick?this.props.onHeaderClick():this.setState({isExpanded:!this.state.isExpanded})}}render(){let r=this.props.hideOffset?"msp-control-group-children":"msp-control-group-children msp-control-offset";return this.props.childrenClassName&&(r+=" "+this.props.childrenClassName),(0,io.jsxs)("div",{className:"msp-control-group-wrapper",style:{position:"relative",marginTop:this.props.noTopMargin?0:void 0},children:[(0,io.jsx)("div",{className:"msp-control-group-header",style:{marginLeft:this.props.headerLeftMargin},title:this.props.title,children:(0,io.jsxs)(sr,{onClick:this.headerClicked,children:[!this.props.hideExpander&&(0,io.jsx)(yn,{svg:this.state.isExpanded?Eu:wu}),this.props.topRightIcon&&(0,io.jsx)(yn,{svg:this.props.topRightIcon,style:{position:"absolute",right:"2px",top:0}}),(0,io.jsx)("b",{children:this.props.header})]})}),this.state.isExpanded&&(0,io.jsx)("div",{className:r,style:{display:this.state.isExpanded?"block":"none",maxHeight:this.props.maxHeight,overflow:"hidden",overflowY:"auto"},children:this.props.children})]})}};function ure(e){return e}var fc=class extends Zg.PureComponent{constructor(){super(...arguments);this.input=Zg.createRef();this.delayHandle=void 0;this.pendingValue=void 0;this.state={originalValue:"",value:""};this.onBlur=()=>{this.setState({value:""+this.state.originalValue}),this.props.onBlur&&this.props.onBlur()};this.raiseOnChange=()=>{this.pendingValue!==void 0&&(this.props.onChange(this.pendingValue),this.pendingValue=void 0)};this.onChange=r=>{let n=r.target.value;if(this.props.isValid&&!this.props.isValid(n)||this.props.numeric&&Number.isNaN(+n)){this.clearTimeout(),this.setState({value:n});return}if(this.props.numeric)this.setState({value:n},()=>this.triggerChanged(n,+n));else{let i=(this.props.toValue||ure)(n),a=(this.props.fromValue||ure)(i);this.setState({value:a},()=>this.triggerChanged(a,i))}};this.onKeyUp=r=>{(r.charCode===27||r.keyCode===27||r.key==="Escape")&&this.props.blurOnEscape&&this.input.current&&this.input.current.blur()};this.onKeyPress=r=>{(r.keyCode===13||r.charCode===13||r.key==="Enter")&&(this.isPending&&(this.clearTimeout(),this.raiseOnChange()),this.props.blurOnEnter&&this.input.current&&this.input.current.blur(),this.props.onEnter&&this.props.onEnter()),r.stopPropagation()}}get isPending(){return typeof this.delayHandle<"u"}clearTimeout(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)}triggerChanged(r,n){this.clearTimeout(),r!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=n,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(n))}static getDerivedStateFromProps(r,n){let o=r.fromValue?r.fromValue(r.value):r.value;return o===n.originalValue?null:{originalValue:o,value:o}}render(){return(0,io.jsx)("input",{type:"text",className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled})}},Mw=class extends Zg.Component{constructor(){super(...arguments);this.state={isExpanded:!1};this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){let{label:r,pivot:n,controls:o}=this.props;return(0,io.jsxs)(io.Fragment,{children:[(0,io.jsx)(Sl,{label:(0,io.jsxs)(io.Fragment,{children:[r,(0,io.jsx)("button",{className:"msp-btn-link msp-btn-icon msp-control-group-expander",onClick:this.toggleExpanded,title:`${this.state.isExpanded?"Less":"More"} options`,style:{background:"transparent",textAlign:"left",padding:"0"},children:(0,io.jsx)(yn,{svg:this.state.isExpanded?jP:Kp,style:{display:"inline-block"}})})]}),control:n,children:this.props.colorStripe&&(0,io.jsx)("div",{className:"msp-expandable-group-color-stripe",style:{backgroundColor:Fe.toStyle(this.props.colorStripe)}})}),this.state.isExpanded&&(0,io.jsx)("div",{className:"msp-control-offset",children:o})]})}};function Jp(e){return(0,io.jsxs)("div",{className:`msp-section-header${e.accent?" msp-transform-header-brand-"+e.accent:""}`,children:[e.icon&&(0,io.jsx)(yn,{svg:e.icon}),e.title," ",(0,io.jsx)("small",{children:e.desc})]})}function sr(e){let t="msp-btn";e.inline||(t+=" msp-btn-block"),e.noOverflow&&(t+=" msp-no-overflow"),e.flex&&(t+=" msp-flex-item"),(e.commit==="on"||e.commit)&&(t+=" msp-btn-commit msp-btn-commit-on"),e.commit==="off"&&(t+=" msp-btn-commit msp-btn-commit-off"),e.children||(t+=" msp-btn-childless"),e.className&&(t+=" "+e.className);let r;return e.flex&&(typeof e.flex=="number"?r={flex:`0 0 ${e.flex}px`,padding:0,maxWidth:`${e.flex}px`}:typeof e.flex=="string"&&(r={flex:`0 0 ${e.flex}`,padding:0,maxWidth:e.flex})),e.style&&(r?Object.assign(r,e.style):r=e.style),(0,io.jsxs)("button",{onClick:e.onClick,title:e.title,disabled:e.disabled,style:r,className:t,"data-id":e["data-id"],"data-color":e["data-color"],onContextMenu:e.onContextMenu,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,children:[e.icon&&(0,io.jsx)(yn,{svg:e.icon}),e.children]})}function or(e){let t=`msp-btn msp-btn-icon${e.small?"-small":""}${e.className?" "+e.className:""}`;typeof e.toggleState<"u"&&(t+=` msp-btn-link-toggle-${e.toggleState?"on":"off"}`),e.transparent&&(t+=" msp-transparent-bg");let r;return e.flex&&(typeof e.flex=="boolean"?r={flex:"0 0 32px",padding:0}:typeof e.flex=="number"?r={flex:`0 0 ${e.flex}px`,padding:0,maxWidth:`${e.flex}px`}:r={flex:`0 0 ${e.flex}`,padding:0,maxWidth:e.flex}),e.style&&(r?Object.assign(r,e.style):r=e.style),(0,io.jsxs)("button",{className:t,onClick:e.onClick,title:e.title,disabled:e.disabled,"data-id":e["data-id"],style:r,children:[e.svg&&(0,io.jsx)(yn,{svg:e.svg}),e.extraContent]})}var di=class extends Zg.PureComponent{constructor(){super(...arguments);this.onClick=r=>{r.currentTarget.blur(),this.props.toggle()}}render(){let r=this.props,n=r.label,o=r.isSelected?`${r.className||""} msp-control-current`:r.className;return(0,io.jsx)(sr,{icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:r.disabled,style:r.style,className:o,children:n&&this.props.isSelected?(0,io.jsx)("b",{children:n}):n})}},Ja=class extends Zg.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!!this.props.initiallyExpanded};this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){return(0,io.jsxs)(io.Fragment,{children:[(0,io.jsx)("div",{className:"msp-control-group-header",style:{marginTop:this.props.marginTop!==void 0?this.props.marginTop:"1px",marginLeft:this.props.headerLeftMargin},children:(0,io.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,style:this.props.headerStyle,children:[(0,io.jsx)(yn,{svg:this.state.isExpanded?wu:Eu}),this.props.header]})}),this.state.isExpanded&&(this.props.noOffset?this.props.children:(0,io.jsx)("div",{className:this.props.accent?"msp-accent-offset":"msp-control-offset",children:this.props.children}))]})}};function Sl(e){let t="msp-control-row";return e.className&&(t+=" "+e.className),(0,io.jsxs)("div",{className:t,children:[(0,io.jsx)("span",{className:"msp-control-row-label",title:e.title,children:e.label}),(0,io.jsx)("div",{className:"msp-control-row-ctrl",children:e.control}),e.children]})}var a0=Rt(nr()),vl=W1.createContext(void 0),Ir=class extends W1.Component{constructor(r,n){super(r);this.subs=void 0;this.plugin=n,this.init&&this.init()}static{this.contextType=vl}subscribe(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))}componentWillUnmount(){if(this.subs){for(let r of this.subs)r.unsubscribe();this.subs=void 0}}},ii=class extends W1.PureComponent{constructor(r,n){super(r,n);this.subs=void 0;this.plugin=n,this.init&&this.init()}static{this.contextType=vl}subscribe(r,n){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(r.subscribe(n))}componentWillUnmount(){if(this.subs){for(let r of this.subs)r.unsubscribe();this.subs=void 0}}},hc=class extends Ir{toggleCollapsed(){this.setState({isCollapsed:!this.state.isCollapsed})}componentDidUpdate(t){this.props.initiallyCollapsed!==void 0&&t.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})}render(){if(this.state.isHidden)return null;let t=this.state.header.toLowerCase().replace(/\s/g,""),r=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper";return(0,a0.jsxs)("div",{className:r,children:[(0,a0.jsx)("div",{id:t,className:"msp-transform-header",children:(0,a0.jsxs)(sr,{icon:this.state.brand?void 0:this.state.isCollapsed?Eu:wu,noOverflow:!0,onClick:()=>this.toggleCollapsed(),className:this.state.brand?`msp-transform-header-brand msp-transform-header-brand-${this.state.brand.accent}`:void 0,title:`Click to ${this.state.isCollapsed?"expand":"collapse"}`,children:[(0,a0.jsx)(yn,{svg:this.state.brand?.svg,inline:!0}),this.state.header,(0,a0.jsx)("small",{style:{margin:"0 6px"},children:this.state.isCollapsed?"":this.state.description})]})}),!this.state.isCollapsed&&this.renderControls()]})}constructor(t,r){super(t,r);let n=this.defaultState();t.initiallyCollapsed!==void 0&&(n.isCollapsed=t.initiallyCollapsed),t.header!==void 0&&(n.header=t.header),this.state=n}};var C0=Rt(Pi());function cre(e,t){let r=t||{};return(e[e.length-1]===""?[...e,""]:e).join((r.padRight?" ":"")+","+(r.padLeft===!1?"":" ")).trim()}var _ke=/[ \t\n\f\r]/g;function TN(e){return typeof e=="object"?e.type==="text"?mre(e.value):!1:mre(e)}function mre(e){return e.replace(_ke,"")===""}var qg=class{constructor(t,r,n){this.property=t,this.normal=r,n&&(this.space=n)}};qg.prototype.property={};qg.prototype.normal={};qg.prototype.space=null;function PN(e,t){let r={},n={},o=-1;for(;++o<e.length;)Object.assign(r,e[o].property),Object.assign(n,e[o].normal);return new qg(r,n,t)}function XP(e){return e.toLowerCase()}var Bu=class{constructor(t,r){this.property=t,this.attribute=r}};Bu.prototype.space=null;Bu.prototype.boolean=!1;Bu.prototype.booleanish=!1;Bu.prototype.overloadedBoolean=!1;Bu.prototype.number=!1;Bu.prototype.commaSeparated=!1;Bu.prototype.spaceSeparated=!1;Bu.prototype.commaOrSpaceSeparated=!1;Bu.prototype.mustUseProperty=!1;Bu.prototype.defined=!1;var QP={};Bi(QP,{boolean:()=>Ln,booleanish:()=>$a,commaOrSpaceSeparated:()=>$c,commaSeparated:()=>Fb,number:()=>Zt,overloadedBoolean:()=>_N,spaceSeparated:()=>xi});var Rke=0,Ln=s0(),$a=s0(),_N=s0(),Zt=s0(),xi=s0(),Fb=s0(),$c=s0();function s0(){return 2**++Rke}var RN=Object.keys(QP),l0=class extends Bu{constructor(t,r,n,o){let i=-1;if(super(t,r),dre(this,"space",o),typeof n=="number")for(;++i<RN.length;){let a=RN[i];dre(this,RN[i],(n&QP[a])===QP[a])}}};l0.prototype.defined=!0;function dre(e,t,r){r&&(e[t]=r)}var Dke={}.hasOwnProperty;function Vd(e){let t={},r={},n;for(n in e.properties)if(Dke.call(e.properties,n)){let o=e.properties[n],i=new l0(n,e.transform(e.attributes||{},n),o,e.space);e.mustUseProperty&&e.mustUseProperty.includes(n)&&(i.mustUseProperty=!0),t[n]=i,r[XP(n)]=n,r[XP(i.attribute)]=n}return new qg(t,r,e.space)}var DN=Vd({space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()},properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}});var wN=Vd({space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()},properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function Bw(e,t){return t in e?e[t]:t}function kw(e,t){return Bw(e,t.toLowerCase())}var EN=Vd({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:kw,properties:{xmlns:null,xmlnsXLink:null}});var MN=Vd({transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()},properties:{ariaActiveDescendant:null,ariaAtomic:$a,ariaAutoComplete:null,ariaBusy:$a,ariaChecked:$a,ariaColCount:Zt,ariaColIndex:Zt,ariaColSpan:Zt,ariaControls:xi,ariaCurrent:null,ariaDescribedBy:xi,ariaDetails:null,ariaDisabled:$a,ariaDropEffect:xi,ariaErrorMessage:null,ariaExpanded:$a,ariaFlowTo:xi,ariaGrabbed:$a,ariaHasPopup:null,ariaHidden:$a,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:xi,ariaLevel:Zt,ariaLive:null,ariaModal:$a,ariaMultiLine:$a,ariaMultiSelectable:$a,ariaOrientation:null,ariaOwns:xi,ariaPlaceholder:null,ariaPosInSet:Zt,ariaPressed:$a,ariaReadOnly:$a,ariaRelevant:null,ariaRequired:$a,ariaRoleDescription:xi,ariaRowCount:Zt,ariaRowIndex:Zt,ariaRowSpan:Zt,ariaSelected:$a,ariaSetSize:Zt,ariaSort:null,ariaValueMax:Zt,ariaValueMin:Zt,ariaValueNow:Zt,ariaValueText:null,role:null}});var pre=Vd({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:kw,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Fb,acceptCharset:xi,accessKey:xi,action:null,allow:null,allowFullScreen:Ln,allowPaymentRequest:Ln,allowUserMedia:Ln,alt:null,as:null,async:Ln,autoCapitalize:null,autoComplete:xi,autoFocus:Ln,autoPlay:Ln,blocking:xi,capture:Ln,charSet:null,checked:Ln,cite:null,className:xi,cols:Zt,colSpan:null,content:null,contentEditable:$a,controls:Ln,controlsList:xi,coords:Zt|Fb,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Ln,defer:Ln,dir:null,dirName:null,disabled:Ln,download:_N,draggable:$a,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Ln,formTarget:null,headers:xi,height:Zt,hidden:Ln,high:Zt,href:null,hrefLang:null,htmlFor:xi,httpEquiv:xi,id:null,imageSizes:null,imageSrcSet:null,inert:Ln,inputMode:null,integrity:null,is:null,isMap:Ln,itemId:null,itemProp:xi,itemRef:xi,itemScope:Ln,itemType:xi,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Ln,low:Zt,manifest:null,max:null,maxLength:Zt,media:null,method:null,min:null,minLength:Zt,multiple:Ln,muted:Ln,name:null,nonce:null,noModule:Ln,noValidate:Ln,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Ln,optimum:Zt,pattern:null,ping:xi,placeholder:null,playsInline:Ln,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Ln,referrerPolicy:null,rel:xi,required:Ln,reversed:Ln,rows:Zt,rowSpan:Zt,sandbox:xi,scope:null,scoped:Ln,seamless:Ln,selected:Ln,shadowRootDelegatesFocus:Ln,shadowRootMode:null,shape:null,size:Zt,sizes:null,slot:null,span:Zt,spellCheck:$a,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Zt,step:null,style:null,tabIndex:Zt,target:null,title:null,translate:null,type:null,typeMustMatch:Ln,useMap:null,value:$a,width:Zt,wrap:null,align:null,aLink:null,archive:xi,axis:null,background:null,bgColor:null,border:Zt,borderColor:null,bottomMargin:Zt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Ln,declare:Ln,event:null,face:null,frame:null,frameBorder:null,hSpace:Zt,leftMargin:Zt,link:null,longDesc:null,lowSrc:null,marginHeight:Zt,marginWidth:Zt,noResize:Ln,noHref:Ln,noShade:Ln,noWrap:Ln,object:null,profile:null,prompt:null,rev:null,rightMargin:Zt,rules:null,scheme:null,scrolling:$a,standby:null,summary:null,text:null,topMargin:Zt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Zt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Ln,disableRemotePlayback:Ln,prefix:null,property:null,results:Zt,security:null,unselectable:null}});var fre=Vd({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:Bw,properties:{about:$c,accentHeight:Zt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Zt,amplitude:Zt,arabicForm:null,ascent:Zt,attributeName:null,attributeType:null,azimuth:Zt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Zt,by:null,calcMode:null,capHeight:Zt,className:xi,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Zt,diffuseConstant:Zt,direction:null,display:null,dur:null,divisor:Zt,dominantBaseline:null,download:Ln,dx:null,dy:null,edgeMode:null,editable:null,elevation:Zt,enableBackground:null,end:null,event:null,exponent:Zt,externalResourcesRequired:null,fill:null,fillOpacity:Zt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Fb,g2:Fb,glyphName:Fb,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Zt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Zt,horizOriginX:Zt,horizOriginY:Zt,id:null,ideographic:Zt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Zt,k:Zt,k1:Zt,k2:Zt,k3:Zt,k4:Zt,kernelMatrix:$c,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Zt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Zt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Zt,overlineThickness:Zt,paintOrder:null,panose1:null,path:null,pathLength:Zt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:xi,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Zt,pointsAtY:Zt,pointsAtZ:Zt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:$c,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:$c,rev:$c,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:$c,requiredFeatures:$c,requiredFonts:$c,requiredFormats:$c,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Zt,specularExponent:Zt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Zt,strikethroughThickness:Zt,string:null,stroke:null,strokeDashArray:$c,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Zt,strokeOpacity:Zt,strokeWidth:null,style:null,surfaceScale:Zt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:$c,tabIndex:Zt,tableValues:null,target:null,targetX:Zt,targetY:Zt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:$c,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Zt,underlineThickness:Zt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Zt,values:null,vAlphabetic:Zt,vMathematical:Zt,vectorEffect:null,vHanging:Zt,vIdeographic:Zt,version:null,vertAdvY:Zt,vertOriginX:Zt,vertOriginY:Zt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Zt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}});var wke=/^data[-\w.:]+$/i,hre=/-[a-z]/g,Eke=/[A-Z]/g;function BN(e,t){let r=XP(t),n=t,o=Bu;if(r in e.normal)return e.property[e.normal[r]];if(r.length>4&&r.slice(0,4)==="data"&&wke.test(t)){if(t.charAt(4)==="-"){let i=t.slice(5).replace(hre,Bke);n="data"+i.charAt(0).toUpperCase()+i.slice(1)}else{let i=t.slice(4);if(!hre.test(i)){let a=i.replace(Eke,Mke);a.charAt(0)!=="-"&&(a="-"+a),t="data"+a}}o=l0}return new o(n,t)}function Mke(e){return"-"+e.toLowerCase()}function Bke(e){return e.charAt(1).toUpperCase()}var kN={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"};var gre=PN([wN,DN,EN,MN,pre],"html"),LN=PN([wN,DN,EN,MN,fre],"svg");function yre(e){return e.join(" ").trim()}var Pre=Rt(Tre(),1),_re=Pre.default;var Lw=Rre("end"),X1=Rre("start");function Rre(e){return t;function t(r){let n=r&&r.position&&r.position[e]||{};if(typeof n.line=="number"&&n.line>0&&typeof n.column=="number"&&n.column>0)return{line:n.line,column:n.column,offset:typeof n.offset=="number"&&n.offset>-1?n.offset:void 0}}}function VN(e){let t=X1(e),r=Lw(e);if(t&&r)return{start:t,end:r}}function Vb(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?Dre(e.position):"start"in e||"end"in e?Dre(e):"line"in e||"column"in e?ON(e):""}function ON(e){return wre(e&&e.line)+":"+wre(e&&e.column)}function Dre(e){return ON(e&&e.start)+"-"+ON(e&&e.end)}function wre(e){return e&&typeof e=="number"?e:1}var Os=class extends Error{constructor(t,r,n){super(),typeof r=="string"&&(n=r,r=void 0);let o="",i={},a=!1;if(r&&("line"in r&&"column"in r?i={place:r}:"start"in r&&"end"in r?i={place:r}:"type"in r?i={ancestors:[r],place:r.position}:i={...r}),typeof t=="string"?o=t:!i.cause&&t&&(a=!0,o=t.message,i.cause=t),!i.ruleId&&!i.source&&typeof n=="string"){let l=n.indexOf(":");l===-1?i.ruleId=n:(i.source=n.slice(0,l),i.ruleId=n.slice(l+1))}if(!i.place&&i.ancestors&&i.ancestors){let l=i.ancestors[i.ancestors.length-1];l&&(i.place=l.position)}let s=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=s?s.column:void 0,this.fatal=void 0,this.file,this.message=o,this.line=s?s.line:void 0,this.name=Vb(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=a&&i.cause&&typeof i.cause.stack=="string"?i.cause.stack:"",this.actual,this.expected,this.note,this.url}};Os.prototype.file="";Os.prototype.name="";Os.prototype.reason="";Os.prototype.message="";Os.prototype.stack="";Os.prototype.column=void 0;Os.prototype.line=void 0;Os.prototype.ancestors=void 0;Os.prototype.cause=void 0;Os.prototype.fatal=void 0;Os.prototype.place=void 0;Os.prototype.ruleId=void 0;Os.prototype.source=void 0;var GN={}.hasOwnProperty,Wke=new Map,Xke=/[A-Z]/g,Qke=/-([a-z])/g,Zke=new Set(["table","tbody","thead","tfoot","tr"]),qke=new Set(["td","th"]);function UN(e,t){if(!t||t.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");let r=t.filePath||void 0,n;if(t.development){if(typeof t.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");n=Kke(r,t.jsxDEV)}else{if(typeof t.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof t.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");n=Yke(r,t.jsx,t.jsxs)}let o={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:n,elementAttributeNameCase:t.elementAttributeNameCase||"react",filePath:r,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:t.passKeys!==!1,passNode:t.passNode||!1,schema:t.space==="svg"?LN:gre,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:t.tableCellAlignToStyle!==!1},i=Ere(o,e,void 0);return i&&typeof i!="string"?i:o.create(e,o.Fragment,{children:i||void 0},void 0)}function Ere(e,t,r){if(t.type==="element"||t.type==="root"){let n=e.schema,o=n;t.type==="element"&&t.tagName.toLowerCase()==="svg"&&n.space==="html"&&(o=LN,e.schema=o),e.ancestors.push(t);let i=Jke(e,t),a=$ke(e,e.ancestors),s=e.Fragment;if(e.ancestors.pop(),t.type==="element")if(i&&Zke.has(t.tagName)&&(i=i.filter(function(l){return typeof l=="string"?!TN(l):!0})),GN.call(e.components,t.tagName)){let l=t.tagName;s=e.components[l],typeof s!="string"&&s!==e.Fragment&&e.passNode&&(a.node=t)}else s=t.tagName;if(i.length>0){let l=i.length>1?i:i[0];l&&(a.children=l)}return e.schema=n,e.create(t,s,a,r)}if(t.type==="text")return t.value}function Yke(e,t,r){return n;function n(o,i,a,s){let u=Array.isArray(a.children)?r:t;return s?u(i,a,s):u(i,a)}}function Kke(e,t){return r;function r(n,o,i,a){let s=Array.isArray(i.children),l=X1(n);return t(o,i,a,s,{columnNumber:l?l.column-1:void 0,fileName:e,lineNumber:l?l.line:void 0},void 0)}}function Jke(e,t){let r=[],n=-1,o=e.passKeys?new Map:Wke;for(;++n<t.children.length;){let i=t.children[n],a;if(e.passKeys&&i.type==="element"){let l=o.get(i.tagName)||0;a=i.tagName+"-"+l,o.set(i.tagName,l+1)}let s=Ere(e,i,a);s!==void 0&&r.push(s)}return r}function $ke(e,t){let r=t[t.length-1],n={},o;if("properties"in r&&r.properties){let i;for(o in r.properties)if(o!=="children"&&GN.call(r.properties,o)){let a=eLe(e,t,o,r.properties[o]);if(a){let[s,l]=a;e.tableCellAlignToStyle&&s==="align"&&typeof l=="string"&&qke.has(r.tagName)?i=l:n[s]=l}}if(i){let a=n.style||(n.style={});a[e.stylePropertyNameCase==="css"?"text-align":"textAlign"]=i}}return n}function eLe(e,t,r,n){let o=BN(e.schema,r);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=o.commaSeparated?cre(n):yre(n)),o.property==="style"){let i=typeof n=="object"?n:tLe(e,t,String(n));return e.stylePropertyNameCase==="css"&&(i=rLe(i)),["style",i]}return[e.elementAttributeNameCase==="react"&&o.space?kN[o.property]||o.property:o.attribute,n]}}function tLe(e,t,r){let n={};try{_re(r,o)}catch(i){if(!e.ignoreInvalidStyle){let a=i,s=new Os("Cannot parse `style` attribute",{ancestors:t,cause:a,source:"hast-util-to-jsx-runtime",ruleId:"style"});throw s.file=e.filePath||void 0,s.url="https://github.com/syntax-tree/hast-util-to-jsx-runtime#cannot-parse-style-attribute",s}}return n;function o(i,a){let s=i;s.slice(0,2)!=="--"&&(s.slice(0,4)==="-ms-"&&(s="ms-"+s.slice(4)),s=s.replace(Qke,oLe)),n[s]=a}}function rLe(e){let t={},r;for(r in e)GN.call(e,r)&&(t[nLe(r)]=e[r]);return t}function nLe(e){let t=e.replace(Xke,iLe);return t.slice(0,3)==="ms-"&&(t="-"+t),t}function oLe(e,t){return t.toUpperCase()}function iLe(e){return"-"+e.toLowerCase()}var ZP={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]};var K1=Rt(nr(),1),Jne=Rt(Pi(),1);var aLe={};function c0(e,t){let r=t||aLe,n=typeof r.includeImageAlt=="boolean"?r.includeImageAlt:!0,o=typeof r.includeHtml=="boolean"?r.includeHtml:!0;return Bre(e,n,o)}function Bre(e,t,r){if(sLe(e)){if("value"in e)return e.type==="html"&&!r?"":e.value;if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return Mre(e.children,t,r)}return Array.isArray(e)?Mre(e,t,r):""}function Mre(e,t,r){let n=[],o=-1;for(;++o<e.length;)n[o]=Bre(e[o],t,r);return n.join("")}function sLe(e){return!!(e&&typeof e=="object")}var kre=document.createElement("i");function Q1(e){let t="&"+e+";";kre.innerHTML=t;let r=kre.textContent;return r.charCodeAt(r.length-1)===59&&e!=="semi"||r===t?!1:r}function Cs(e,t,r,n){let o=e.length,i=0,a;if(t<0?t=-t>o?0:o+t:t=t>o?o:t,r=r>0?r:0,n.length<1e4)a=Array.from(n),a.unshift(t,r),e.splice(...a);else for(r&&e.splice(t,r);i<n.length;)a=n.slice(i,i+1e4),a.unshift(t,0),e.splice(...a),i+=1e4,t+=1e4}function gc(e,t){return e.length>0?(Cs(e,e.length,0,t),e):t}var Lre={}.hasOwnProperty;function Fw(e){let t={},r=-1;for(;++r<e.length;)lLe(t,e[r]);return t}function lLe(e,t){let r;for(r in t){let o=(Lre.call(e,r)?e[r]:void 0)||(e[r]={}),i=t[r],a;if(i)for(a in i){Lre.call(o,a)||(o[a]=[]);let s=i[a];uLe(o[a],Array.isArray(s)?s:s?[s]:[])}}}function uLe(e,t){let r=-1,n=[];for(;++r<t.length;)(t[r].add==="after"?e:n).push(t[r]);Cs(e,0,0,n)}function Vw(e,t){let r=Number.parseInt(e,t);return r<9||r===11||r>13&&r<32||r>126&&r<160||r>55295&&r<57344||r>64975&&r<65008||(r&65535)===65535||(r&65535)===65534||r>1114111?"\uFFFD":String.fromCodePoint(r)}function ku(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}var cLe=Ob(/\p{P}/u),sl=Ob(/[A-Za-z]/),es=Ob(/[\dA-Za-z]/),Fre=Ob(/[#-'*+\--9=?A-Z^-~]/);function m0(e){return e!==null&&(e<32||e===127)}var qP=Ob(/\d/),Vre=Ob(/[\dA-Fa-f]/),NN=Ob(/[!-/:-@[-`{-~]/);function hr(e){return e!==null&&e<-2}function ao(e){return e!==null&&(e<0||e===32)}function sn(e){return e===-2||e===-1||e===32}function d0(e){return NN(e)||cLe(e)}var Jf=Ob(/\s/);function Ob(e){return t;function t(r){return r!==null&&r>-1&&e.test(String.fromCharCode(r))}}function Od(e){let t=[],r=-1,n=0,o=0;for(;++r<e.length;){let i=e.charCodeAt(r),a="";if(i===37&&es(e.charCodeAt(r+1))&&es(e.charCodeAt(r+2)))o=2;else if(i<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(i))||(a=String.fromCharCode(i));else if(i>55295&&i<57344){let s=e.charCodeAt(r+1);i<56320&&s>56319&&s<57344?(a=String.fromCharCode(i,s),o=1):a="\uFFFD"}else a=String.fromCharCode(i);a&&(t.push(e.slice(n,r),encodeURIComponent(a)),n=r+o+1,a=""),o&&(r+=o,o=0)}return t.join("")+e.slice(n)}function tn(e,t,r,n){let o=n?n-1:Number.POSITIVE_INFINITY,i=0;return a;function a(l){return sn(l)?(e.enter(r),s(l)):t(l)}function s(l){return sn(l)&&i++<o?(e.consume(l),s):(e.exit(r),t(l))}}var Ore={tokenize:mLe};function mLe(e){let t=e.attempt(this.parser.constructs.contentInitial,n,o),r;return t;function n(s){if(s===null){e.consume(s);return}return e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),tn(e,t,"linePrefix")}function o(s){return e.enter("paragraph"),i(s)}function i(s){let l=e.enter("chunkText",{contentType:"text",previous:r});return r&&(r.next=l),r=l,a(s)}function a(s){if(s===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(s);return}return hr(s)?(e.consume(s),e.exit("chunkText"),i):(e.consume(s),a)}}var Ure={tokenize:dLe},Gre={tokenize:pLe};function dLe(e){let t=this,r=[],n=0,o,i,a;return s;function s(S){if(n<r.length){let I=r[n];return t.containerState=I[1],e.attempt(I[0].continuation,l,u)(S)}return u(S)}function l(S){if(n++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,o&&x();let I=t.events.length,v=I,A;for(;v--;)if(t.events[v][0]==="exit"&&t.events[v][1].type==="chunkFlow"){A=t.events[v][1].end;break}g(n);let _=I;for(;_<t.events.length;)t.events[_][1].end=Object.assign({},A),_++;return Cs(t.events,v+1,0,t.events.slice(I)),t.events.length=_,u(S)}return s(S)}function u(S){if(n===r.length){if(!o)return d(S);if(o.currentConstruct&&o.currentConstruct.concrete)return h(S);t.interrupt=!!(o.currentConstruct&&!o._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(Gre,c,m)(S)}function c(S){return o&&x(),g(n),d(S)}function m(S){return t.parser.lazy[t.now().line]=n!==r.length,a=t.now().offset,h(S)}function d(S){return t.containerState={},e.attempt(Gre,p,h)(S)}function p(S){return n++,r.push([t.currentConstruct,t.containerState]),d(S)}function h(S){if(S===null){o&&x(),g(0),e.consume(S);return}return o=o||t.parser.flow(t.now()),e.enter("chunkFlow",{contentType:"flow",previous:i,_tokenizer:o}),f(S)}function f(S){if(S===null){y(e.exit("chunkFlow"),!0),g(0),e.consume(S);return}return hr(S)?(e.consume(S),y(e.exit("chunkFlow")),n=0,t.interrupt=void 0,s):(e.consume(S),f)}function y(S,I){let v=t.sliceStream(S);if(I&&v.push(null),S.previous=i,i&&(i.next=S),i=S,o.defineSkip(S.start),o.write(v),t.parser.lazy[S.start.line]){let A=o.events.length;for(;A--;)if(o.events[A][1].start.offset<a&&(!o.events[A][1].end||o.events[A][1].end.offset>a))return;let _=t.events.length,T=_,w,D;for(;T--;)if(t.events[T][0]==="exit"&&t.events[T][1].type==="chunkFlow"){if(w){D=t.events[T][1].end;break}w=!0}for(g(n),A=_;A<t.events.length;)t.events[A][1].end=Object.assign({},D),A++;Cs(t.events,T+1,0,t.events.slice(_)),t.events.length=A}}function g(S){let I=r.length;for(;I-- >S;){let v=r[I];t.containerState=v[1],v[0].exit.call(t,e)}r.length=S}function x(){o.write([null]),i=void 0,o=void 0,t.containerState._closeFlow=void 0}}function pLe(e,t,r){return tn(e,e.attempt(this.parser.constructs.document,t,r),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Yg(e){if(e===null||ao(e)||Jf(e))return 1;if(d0(e))return 2}function Gb(e,t,r){let n=[],o=-1;for(;++o<e.length;){let i=e[o].resolveAll;i&&!n.includes(i)&&(t=i(t,r),n.push(i))}return t}var YP={name:"attention",tokenize:hLe,resolveAll:fLe};function fLe(e,t){let r=-1,n,o,i,a,s,l,u,c;for(;++r<e.length;)if(e[r][0]==="enter"&&e[r][1].type==="attentionSequence"&&e[r][1]._close){for(n=r;n--;)if(e[n][0]==="exit"&&e[n][1].type==="attentionSequence"&&e[n][1]._open&&t.sliceSerialize(e[n][1]).charCodeAt(0)===t.sliceSerialize(e[r][1]).charCodeAt(0)){if((e[n][1]._close||e[r][1]._open)&&(e[r][1].end.offset-e[r][1].start.offset)%3&&!((e[n][1].end.offset-e[n][1].start.offset+e[r][1].end.offset-e[r][1].start.offset)%3))continue;l=e[n][1].end.offset-e[n][1].start.offset>1&&e[r][1].end.offset-e[r][1].start.offset>1?2:1;let m=Object.assign({},e[n][1].end),d=Object.assign({},e[r][1].start);Nre(m,-l),Nre(d,l),a={type:l>1?"strongSequence":"emphasisSequence",start:m,end:Object.assign({},e[n][1].end)},s={type:l>1?"strongSequence":"emphasisSequence",start:Object.assign({},e[r][1].start),end:d},i={type:l>1?"strongText":"emphasisText",start:Object.assign({},e[n][1].end),end:Object.assign({},e[r][1].start)},o={type:l>1?"strong":"emphasis",start:Object.assign({},a.start),end:Object.assign({},s.end)},e[n][1].end=Object.assign({},a.start),e[r][1].start=Object.assign({},s.end),u=[],e[n][1].end.offset-e[n][1].start.offset&&(u=gc(u,[["enter",e[n][1],t],["exit",e[n][1],t]])),u=gc(u,[["enter",o,t],["enter",a,t],["exit",a,t],["enter",i,t]]),u=gc(u,Gb(t.parser.constructs.insideSpan.null,e.slice(n+1,r),t)),u=gc(u,[["exit",i,t],["enter",s,t],["exit",s,t],["exit",o,t]]),e[r][1].end.offset-e[r][1].start.offset?(c=2,u=gc(u,[["enter",e[r][1],t],["exit",e[r][1],t]])):c=0,Cs(e,n-1,r-n+3,u),r=n+u.length-c-2;break}}for(r=-1;++r<e.length;)e[r][1].type==="attentionSequence"&&(e[r][1].type="data");return e}function hLe(e,t){let r=this.parser.constructs.attentionMarkers.null,n=this.previous,o=Yg(n),i;return a;function a(l){return i=l,e.enter("attentionSequence"),s(l)}function s(l){if(l===i)return e.consume(l),s;let u=e.exit("attentionSequence"),c=Yg(l),m=!c||c===2&&o||r.includes(l),d=!o||o===2&&c||r.includes(n);return u._open=!!(i===42?m:m&&(o||!d)),u._close=!!(i===42?d:d&&(c||!m)),t(l)}}function Nre(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}var zN={name:"autolink",tokenize:gLe};function gLe(e,t,r){let n=0;return o;function o(p){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),i}function i(p){return sl(p)?(e.consume(p),a):u(p)}function a(p){return p===43||p===45||p===46||es(p)?(n=1,s(p)):u(p)}function s(p){return p===58?(e.consume(p),n=0,l):(p===43||p===45||p===46||es(p))&&n++<32?(e.consume(p),s):(n=0,u(p))}function l(p){return p===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.exit("autolink"),t):p===null||p===32||p===60||m0(p)?r(p):(e.consume(p),l)}function u(p){return p===64?(e.consume(p),c):Fre(p)?(e.consume(p),u):r(p)}function c(p){return es(p)?m(p):r(p)}function m(p){return p===46?(e.consume(p),n=0,c):p===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.exit("autolink"),t):d(p)}function d(p){if((p===45||es(p))&&n++<63){let h=p===45?d:m;return e.consume(p),h}return r(p)}}var $f={tokenize:yLe,partial:!0};function yLe(e,t,r){return n;function n(i){return sn(i)?tn(e,o,"linePrefix")(i):o(i)}function o(i){return i===null||hr(i)?t(i):r(i)}}var Ow={name:"blockQuote",tokenize:bLe,continuation:{tokenize:xLe},exit:CLe};function bLe(e,t,r){let n=this;return o;function o(a){if(a===62){let s=n.containerState;return s.open||(e.enter("blockQuote",{_container:!0}),s.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(a),e.exit("blockQuoteMarker"),i}return r(a)}function i(a){return sn(a)?(e.enter("blockQuotePrefixWhitespace"),e.consume(a),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(a))}}function xLe(e,t,r){let n=this;return o;function o(a){return sn(a)?tn(e,i,"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a):i(a)}function i(a){return e.attempt(Ow,t,r)(a)}}function CLe(e){e.exit("blockQuote")}var Gw={name:"characterEscape",tokenize:SLe};function SLe(e,t,r){return n;function n(i){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(i),e.exit("escapeMarker"),o}function o(i){return NN(i)?(e.enter("characterEscapeValue"),e.consume(i),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):r(i)}}var Uw={name:"characterReference",tokenize:vLe};function vLe(e,t,r){let n=this,o=0,i,a;return s;function s(m){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(m),e.exit("characterReferenceMarker"),l}function l(m){return m===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(m),e.exit("characterReferenceMarkerNumeric"),u):(e.enter("characterReferenceValue"),i=31,a=es,c(m))}function u(m){return m===88||m===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(m),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),i=6,a=Vre,c):(e.enter("characterReferenceValue"),i=7,a=qP,c(m))}function c(m){if(m===59&&o){let d=e.exit("characterReferenceValue");return a===es&&!Q1(n.sliceSerialize(d))?r(m):(e.enter("characterReferenceMarker"),e.consume(m),e.exit("characterReferenceMarker"),e.exit("characterReference"),t)}return a(m)&&o++<i?(e.consume(m),c):r(m)}}var zre={tokenize:ALe,partial:!0},Nw={name:"codeFenced",tokenize:ILe,concrete:!0};function ILe(e,t,r){let n=this,o={tokenize:v,partial:!0},i=0,a=0,s;return l;function l(A){return u(A)}function u(A){let _=n.events[n.events.length-1];return i=_&&_[1].type==="linePrefix"?_[2].sliceSerialize(_[1],!0).length:0,s=A,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),c(A)}function c(A){return A===s?(a++,e.consume(A),c):a<3?r(A):(e.exit("codeFencedFenceSequence"),sn(A)?tn(e,m,"whitespace")(A):m(A))}function m(A){return A===null||hr(A)?(e.exit("codeFencedFence"),n.interrupt?t(A):e.check(zre,f,I)(A)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),d(A))}function d(A){return A===null||hr(A)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),m(A)):sn(A)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),tn(e,p,"whitespace")(A)):A===96&&A===s?r(A):(e.consume(A),d)}function p(A){return A===null||hr(A)?m(A):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),h(A))}function h(A){return A===null||hr(A)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),m(A)):A===96&&A===s?r(A):(e.consume(A),h)}function f(A){return e.attempt(o,I,y)(A)}function y(A){return e.enter("lineEnding"),e.consume(A),e.exit("lineEnding"),g}function g(A){return i>0&&sn(A)?tn(e,x,"linePrefix",i+1)(A):x(A)}function x(A){return A===null||hr(A)?e.check(zre,f,I)(A):(e.enter("codeFlowValue"),S(A))}function S(A){return A===null||hr(A)?(e.exit("codeFlowValue"),x(A)):(e.consume(A),S)}function I(A){return e.exit("codeFenced"),t(A)}function v(A,_,T){let w=0;return D;function D(B){return A.enter("lineEnding"),A.consume(B),A.exit("lineEnding"),M}function M(B){return A.enter("codeFencedFence"),sn(B)?tn(A,E,"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(B):E(B)}function E(B){return B===s?(A.enter("codeFencedFenceSequence"),R(B)):T(B)}function R(B){return B===s?(w++,A.consume(B),R):w>=a?(A.exit("codeFencedFenceSequence"),sn(B)?tn(A,k,"whitespace")(B):k(B)):T(B)}function k(B){return B===null||hr(B)?(A.exit("codeFencedFence"),_(B)):T(B)}}}function ALe(e,t,r){let n=this;return o;function o(a){return a===null?r(a):(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),i)}function i(a){return n.parser.lazy[n.now().line]?r(a):t(a)}}var KP={name:"codeIndented",tokenize:PLe},TLe={tokenize:_Le,partial:!0};function PLe(e,t,r){let n=this;return o;function o(u){return e.enter("codeIndented"),tn(e,i,"linePrefix",5)(u)}function i(u){let c=n.events[n.events.length-1];return c&&c[1].type==="linePrefix"&&c[2].sliceSerialize(c[1],!0).length>=4?a(u):r(u)}function a(u){return u===null?l(u):hr(u)?e.attempt(TLe,a,l)(u):(e.enter("codeFlowValue"),s(u))}function s(u){return u===null||hr(u)?(e.exit("codeFlowValue"),a(u)):(e.consume(u),s)}function l(u){return e.exit("codeIndented"),t(u)}}function _Le(e,t,r){let n=this;return o;function o(a){return n.parser.lazy[n.now().line]?r(a):hr(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),o):tn(e,i,"linePrefix",5)(a)}function i(a){let s=n.events[n.events.length-1];return s&&s[1].type==="linePrefix"&&s[2].sliceSerialize(s[1],!0).length>=4?t(a):hr(a)?o(a):r(a)}}var HN={name:"codeText",tokenize:wLe,resolve:RLe,previous:DLe};function RLe(e){let t=e.length-4,r=3,n,o;if((e[r][1].type==="lineEnding"||e[r][1].type==="space")&&(e[t][1].type==="lineEnding"||e[t][1].type==="space")){for(n=r;++n<t;)if(e[n][1].type==="codeTextData"){e[r][1].type="codeTextPadding",e[t][1].type="codeTextPadding",r+=2,t-=2;break}}for(n=r-1,t++;++n<=t;)o===void 0?n!==t&&e[n][1].type!=="lineEnding"&&(o=n):(n===t||e[n][1].type==="lineEnding")&&(e[o][1].type="codeTextData",n!==o+2&&(e[o][1].end=e[n-1][1].end,e.splice(o+2,n-o-2),t-=n-o-2,n=o+2),o=void 0);return e}function DLe(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function wLe(e,t,r){let n=this,o=0,i,a;return s;function s(d){return e.enter("codeText"),e.enter("codeTextSequence"),l(d)}function l(d){return d===96?(e.consume(d),o++,l):(e.exit("codeTextSequence"),u(d))}function u(d){return d===null?r(d):d===32?(e.enter("space"),e.consume(d),e.exit("space"),u):d===96?(a=e.enter("codeTextSequence"),i=0,m(d)):hr(d)?(e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),u):(e.enter("codeTextData"),c(d))}function c(d){return d===null||d===32||d===96||hr(d)?(e.exit("codeTextData"),u(d)):(e.consume(d),c)}function m(d){return d===96?(e.consume(d),i++,m):i===o?(e.exit("codeTextSequence"),e.exit("codeText"),t(d)):(a.type="codeTextData",c(d))}}function zw(e){let t={},r=-1,n,o,i,a,s,l,u;for(;++r<e.length;){for(;r in t;)r=t[r];if(n=e[r],r&&n[1].type==="chunkFlow"&&e[r-1][1].type==="listItemPrefix"&&(l=n[1]._tokenizer.events,i=0,i<l.length&&l[i][1].type==="lineEndingBlank"&&(i+=2),i<l.length&&l[i][1].type==="content"))for(;++i<l.length&&l[i][1].type!=="content";)l[i][1].type==="chunkText"&&(l[i][1]._isInFirstContentOfListItem=!0,i++);if(n[0]==="enter")n[1].contentType&&(Object.assign(t,ELe(e,r)),r=t[r],u=!0);else if(n[1]._container){for(i=r,o=void 0;i--&&(a=e[i],a[1].type==="lineEnding"||a[1].type==="lineEndingBlank");)a[0]==="enter"&&(o&&(e[o][1].type="lineEndingBlank"),a[1].type="lineEnding",o=i);o&&(n[1].end=Object.assign({},e[o][1].start),s=e.slice(o,r),s.unshift(n),Cs(e,o,r-o+1,s))}}return!u}function ELe(e,t){let r=e[t][1],n=e[t][2],o=t-1,i=[],a=r._tokenizer||n.parser[r.contentType](r.start),s=a.events,l=[],u={},c,m,d=-1,p=r,h=0,f=0,y=[f];for(;p;){for(;e[++o][1]!==p;);i.push(o),p._tokenizer||(c=n.sliceStream(p),p.next||c.push(null),m&&a.defineSkip(p.start),p._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=!0),a.write(c),p._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=void 0)),m=p,p=p.next}for(p=r;++d<s.length;)s[d][0]==="exit"&&s[d-1][0]==="enter"&&s[d][1].type===s[d-1][1].type&&s[d][1].start.line!==s[d][1].end.line&&(f=d+1,y.push(f),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(a.events=[],p?(p._tokenizer=void 0,p.previous=void 0):y.pop(),d=y.length;d--;){let g=s.slice(y[d],y[d+1]),x=i.pop();l.unshift([x,x+g.length-1]),Cs(e,x,2,g)}for(d=-1;++d<l.length;)u[h+l[d][0]]=h+l[d][1],h+=l[d][1]-l[d][0]-1;return u}var jN={tokenize:kLe,resolve:BLe},MLe={tokenize:LLe,partial:!0};function BLe(e){return zw(e),e}function kLe(e,t){let r;return n;function n(s){return e.enter("content"),r=e.enter("chunkContent",{contentType:"content"}),o(s)}function o(s){return s===null?i(s):hr(s)?e.check(MLe,a,i)(s):(e.consume(s),o)}function i(s){return e.exit("chunkContent"),e.exit("content"),t(s)}function a(s){return e.consume(s),e.exit("chunkContent"),r.next=e.enter("chunkContent",{contentType:"content",previous:r}),r=r.next,o}}function LLe(e,t,r){let n=this;return o;function o(a){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),tn(e,i,"linePrefix")}function i(a){if(a===null||hr(a))return r(a);let s=n.events[n.events.length-1];return!n.parser.constructs.disable.null.includes("codeIndented")&&s&&s[1].type==="linePrefix"&&s[2].sliceSerialize(s[1],!0).length>=4?t(a):e.interrupt(n.parser.constructs.flow,r,t)(a)}}function Hw(e,t,r,n,o,i,a,s,l){let u=l||Number.POSITIVE_INFINITY,c=0;return m;function m(g){return g===60?(e.enter(n),e.enter(o),e.enter(i),e.consume(g),e.exit(i),d):g===null||g===32||g===41||m0(g)?r(g):(e.enter(n),e.enter(a),e.enter(s),e.enter("chunkString",{contentType:"string"}),f(g))}function d(g){return g===62?(e.enter(i),e.consume(g),e.exit(i),e.exit(o),e.exit(n),t):(e.enter(s),e.enter("chunkString",{contentType:"string"}),p(g))}function p(g){return g===62?(e.exit("chunkString"),e.exit(s),d(g)):g===null||g===60||hr(g)?r(g):(e.consume(g),g===92?h:p)}function h(g){return g===60||g===62||g===92?(e.consume(g),p):p(g)}function f(g){return!c&&(g===null||g===41||ao(g))?(e.exit("chunkString"),e.exit(s),e.exit(a),e.exit(n),t(g)):c<u&&g===40?(e.consume(g),c++,f):g===41?(e.consume(g),c--,f):g===null||g===32||g===40||m0(g)?r(g):(e.consume(g),g===92?y:f)}function y(g){return g===40||g===41||g===92?(e.consume(g),f):f(g)}}function jw(e,t,r,n,o,i){let a=this,s=0,l;return u;function u(p){return e.enter(n),e.enter(o),e.consume(p),e.exit(o),e.enter(i),c}function c(p){return s>999||p===null||p===91||p===93&&!l||p===94&&!s&&"_hiddenFootnoteSupport"in a.parser.constructs?r(p):p===93?(e.exit(i),e.enter(o),e.consume(p),e.exit(o),e.exit(n),t):hr(p)?(e.enter("lineEnding"),e.consume(p),e.exit("lineEnding"),c):(e.enter("chunkString",{contentType:"string"}),m(p))}function m(p){return p===null||p===91||p===93||hr(p)||s++>999?(e.exit("chunkString"),c(p)):(e.consume(p),l||(l=!sn(p)),p===92?d:m)}function d(p){return p===91||p===92||p===93?(e.consume(p),s++,m):m(p)}}function Ww(e,t,r,n,o,i){let a;return s;function s(d){return d===34||d===39||d===40?(e.enter(n),e.enter(o),e.consume(d),e.exit(o),a=d===40?41:d,l):r(d)}function l(d){return d===a?(e.enter(o),e.consume(d),e.exit(o),e.exit(n),t):(e.enter(i),u(d))}function u(d){return d===a?(e.exit(i),l(a)):d===null?r(d):hr(d)?(e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),tn(e,u,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),c(d))}function c(d){return d===a||d===null||hr(d)?(e.exit("chunkString"),u(d)):(e.consume(d),d===92?m:c)}function m(d){return d===a||d===92?(e.consume(d),c):c(d)}}function p0(e,t){let r;return n;function n(o){return hr(o)?(e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),r=!0,n):sn(o)?tn(e,n,r?"linePrefix":"lineSuffix")(o):t(o)}}var WN={name:"definition",tokenize:VLe},FLe={tokenize:OLe,partial:!0};function VLe(e,t,r){let n=this,o;return i;function i(p){return e.enter("definition"),a(p)}function a(p){return jw.call(n,e,s,r,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function s(p){return o=ku(n.sliceSerialize(n.events[n.events.length-1][1]).slice(1,-1)),p===58?(e.enter("definitionMarker"),e.consume(p),e.exit("definitionMarker"),l):r(p)}function l(p){return ao(p)?p0(e,u)(p):u(p)}function u(p){return Hw(e,c,r,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function c(p){return e.attempt(FLe,m,m)(p)}function m(p){return sn(p)?tn(e,d,"whitespace")(p):d(p)}function d(p){return p===null||hr(p)?(e.exit("definition"),n.parser.defined.push(o),t(p)):r(p)}}function OLe(e,t,r){return n;function n(s){return ao(s)?p0(e,o)(s):r(s)}function o(s){return Ww(e,i,r,"definitionTitle","definitionTitleMarker","definitionTitleString")(s)}function i(s){return sn(s)?tn(e,a,"whitespace")(s):a(s)}function a(s){return s===null||hr(s)?t(s):r(s)}}var XN={name:"hardBreakEscape",tokenize:GLe};function GLe(e,t,r){return n;function n(i){return e.enter("hardBreakEscape"),e.consume(i),o}function o(i){return hr(i)?(e.exit("hardBreakEscape"),t(i)):r(i)}}var QN={name:"headingAtx",tokenize:NLe,resolve:ULe};function ULe(e,t){let r=e.length-2,n=3,o,i;return e[n][1].type==="whitespace"&&(n+=2),r-2>n&&e[r][1].type==="whitespace"&&(r-=2),e[r][1].type==="atxHeadingSequence"&&(n===r-1||r-4>n&&e[r-2][1].type==="whitespace")&&(r-=n+1===r?2:4),r>n&&(o={type:"atxHeadingText",start:e[n][1].start,end:e[r][1].end},i={type:"chunkText",start:e[n][1].start,end:e[r][1].end,contentType:"text"},Cs(e,n,r-n+1,[["enter",o,t],["enter",i,t],["exit",i,t],["exit",o,t]])),e}function NLe(e,t,r){let n=0;return o;function o(c){return e.enter("atxHeading"),i(c)}function i(c){return e.enter("atxHeadingSequence"),a(c)}function a(c){return c===35&&n++<6?(e.consume(c),a):c===null||ao(c)?(e.exit("atxHeadingSequence"),s(c)):r(c)}function s(c){return c===35?(e.enter("atxHeadingSequence"),l(c)):c===null||hr(c)?(e.exit("atxHeading"),t(c)):sn(c)?tn(e,s,"whitespace")(c):(e.enter("atxHeadingText"),u(c))}function l(c){return c===35?(e.consume(c),l):(e.exit("atxHeadingSequence"),s(c))}function u(c){return c===null||c===35||ao(c)?(e.exit("atxHeadingText"),s(c)):(e.consume(c),u)}}var Hre=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],ZN=["pre","script","style","textarea"];var qN={name:"htmlFlow",tokenize:WLe,resolveTo:jLe,concrete:!0},zLe={tokenize:QLe,partial:!0},HLe={tokenize:XLe,partial:!0};function jLe(e){let t=e.length;for(;t--&&!(e[t][0]==="enter"&&e[t][1].type==="htmlFlow"););return t>1&&e[t-2][1].type==="linePrefix"&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e}function WLe(e,t,r){let n=this,o,i,a,s,l;return u;function u(F){return c(F)}function c(F){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(F),m}function m(F){return F===33?(e.consume(F),d):F===47?(e.consume(F),i=!0,f):F===63?(e.consume(F),o=3,n.interrupt?t:O):sl(F)?(e.consume(F),a=String.fromCharCode(F),y):r(F)}function d(F){return F===45?(e.consume(F),o=2,p):F===91?(e.consume(F),o=5,s=0,h):sl(F)?(e.consume(F),o=4,n.interrupt?t:O):r(F)}function p(F){return F===45?(e.consume(F),n.interrupt?t:O):r(F)}function h(F){let Y="CDATA[";return F===Y.charCodeAt(s++)?(e.consume(F),s===Y.length?n.interrupt?t:E:h):r(F)}function f(F){return sl(F)?(e.consume(F),a=String.fromCharCode(F),y):r(F)}function y(F){if(F===null||F===47||F===62||ao(F)){let Y=F===47,$=a.toLowerCase();return!Y&&!i&&ZN.includes($)?(o=1,n.interrupt?t(F):E(F)):Hre.includes(a.toLowerCase())?(o=6,Y?(e.consume(F),g):n.interrupt?t(F):E(F)):(o=7,n.interrupt&&!n.parser.lazy[n.now().line]?r(F):i?x(F):S(F))}return F===45||es(F)?(e.consume(F),a+=String.fromCharCode(F),y):r(F)}function g(F){return F===62?(e.consume(F),n.interrupt?t:E):r(F)}function x(F){return sn(F)?(e.consume(F),x):D(F)}function S(F){return F===47?(e.consume(F),D):F===58||F===95||sl(F)?(e.consume(F),I):sn(F)?(e.consume(F),S):D(F)}function I(F){return F===45||F===46||F===58||F===95||es(F)?(e.consume(F),I):v(F)}function v(F){return F===61?(e.consume(F),A):sn(F)?(e.consume(F),v):S(F)}function A(F){return F===null||F===60||F===61||F===62||F===96?r(F):F===34||F===39?(e.consume(F),l=F,_):sn(F)?(e.consume(F),A):T(F)}function _(F){return F===l?(e.consume(F),l=null,w):F===null||hr(F)?r(F):(e.consume(F),_)}function T(F){return F===null||F===34||F===39||F===47||F===60||F===61||F===62||F===96||ao(F)?v(F):(e.consume(F),T)}function w(F){return F===47||F===62||sn(F)?S(F):r(F)}function D(F){return F===62?(e.consume(F),M):r(F)}function M(F){return F===null||hr(F)?E(F):sn(F)?(e.consume(F),M):r(F)}function E(F){return F===45&&o===2?(e.consume(F),L):F===60&&o===1?(e.consume(F),V):F===62&&o===4?(e.consume(F),q):F===63&&o===3?(e.consume(F),O):F===93&&o===5?(e.consume(F),Q):hr(F)&&(o===6||o===7)?(e.exit("htmlFlowData"),e.check(zLe,X,R)(F)):F===null||hr(F)?(e.exit("htmlFlowData"),R(F)):(e.consume(F),E)}function R(F){return e.check(HLe,k,X)(F)}function k(F){return e.enter("lineEnding"),e.consume(F),e.exit("lineEnding"),B}function B(F){return F===null||hr(F)?R(F):(e.enter("htmlFlowData"),E(F))}function L(F){return F===45?(e.consume(F),O):E(F)}function V(F){return F===47?(e.consume(F),a="",U):E(F)}function U(F){if(F===62){let Y=a.toLowerCase();return ZN.includes(Y)?(e.consume(F),q):E(F)}return sl(F)&&a.length<8?(e.consume(F),a+=String.fromCharCode(F),U):E(F)}function Q(F){return F===93?(e.consume(F),O):E(F)}function O(F){return F===62?(e.consume(F),q):F===45&&o===2?(e.consume(F),O):E(F)}function q(F){return F===null||hr(F)?(e.exit("htmlFlowData"),X(F)):(e.consume(F),q)}function X(F){return e.exit("htmlFlow"),t(F)}}function XLe(e,t,r){let n=this;return o;function o(a){return hr(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),i):r(a)}function i(a){return n.parser.lazy[n.now().line]?r(a):t(a)}}function QLe(e,t,r){return n;function n(o){return e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),e.attempt($f,t,r)}}var YN={name:"htmlText",tokenize:ZLe};function ZLe(e,t,r){let n=this,o,i,a;return s;function s(O){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(O),l}function l(O){return O===33?(e.consume(O),u):O===47?(e.consume(O),v):O===63?(e.consume(O),S):sl(O)?(e.consume(O),T):r(O)}function u(O){return O===45?(e.consume(O),c):O===91?(e.consume(O),i=0,h):sl(O)?(e.consume(O),x):r(O)}function c(O){return O===45?(e.consume(O),p):r(O)}function m(O){return O===null?r(O):O===45?(e.consume(O),d):hr(O)?(a=m,V(O)):(e.consume(O),m)}function d(O){return O===45?(e.consume(O),p):m(O)}function p(O){return O===62?L(O):O===45?d(O):m(O)}function h(O){let q="CDATA[";return O===q.charCodeAt(i++)?(e.consume(O),i===q.length?f:h):r(O)}function f(O){return O===null?r(O):O===93?(e.consume(O),y):hr(O)?(a=f,V(O)):(e.consume(O),f)}function y(O){return O===93?(e.consume(O),g):f(O)}function g(O){return O===62?L(O):O===93?(e.consume(O),g):f(O)}function x(O){return O===null||O===62?L(O):hr(O)?(a=x,V(O)):(e.consume(O),x)}function S(O){return O===null?r(O):O===63?(e.consume(O),I):hr(O)?(a=S,V(O)):(e.consume(O),S)}function I(O){return O===62?L(O):S(O)}function v(O){return sl(O)?(e.consume(O),A):r(O)}function A(O){return O===45||es(O)?(e.consume(O),A):_(O)}function _(O){return hr(O)?(a=_,V(O)):sn(O)?(e.consume(O),_):L(O)}function T(O){return O===45||es(O)?(e.consume(O),T):O===47||O===62||ao(O)?w(O):r(O)}function w(O){return O===47?(e.consume(O),L):O===58||O===95||sl(O)?(e.consume(O),D):hr(O)?(a=w,V(O)):sn(O)?(e.consume(O),w):L(O)}function D(O){return O===45||O===46||O===58||O===95||es(O)?(e.consume(O),D):M(O)}function M(O){return O===61?(e.consume(O),E):hr(O)?(a=M,V(O)):sn(O)?(e.consume(O),M):w(O)}function E(O){return O===null||O===60||O===61||O===62||O===96?r(O):O===34||O===39?(e.consume(O),o=O,R):hr(O)?(a=E,V(O)):sn(O)?(e.consume(O),E):(e.consume(O),k)}function R(O){return O===o?(e.consume(O),o=void 0,B):O===null?r(O):hr(O)?(a=R,V(O)):(e.consume(O),R)}function k(O){return O===null||O===34||O===39||O===60||O===61||O===96?r(O):O===47||O===62||ao(O)?w(O):(e.consume(O),k)}function B(O){return O===47||O===62||ao(O)?w(O):r(O)}function L(O){return O===62?(e.consume(O),e.exit("htmlTextData"),e.exit("htmlText"),t):r(O)}function V(O){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(O),e.exit("lineEnding"),U}function U(O){return sn(O)?tn(e,Q,"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(O):Q(O)}function Q(O){return e.enter("htmlTextData"),a(O)}}var f0={name:"labelEnd",tokenize:eFe,resolveTo:$Le,resolveAll:JLe},qLe={tokenize:tFe},YLe={tokenize:rFe},KLe={tokenize:nFe};function JLe(e){let t=-1;for(;++t<e.length;){let r=e[t][1];(r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd")&&(e.splice(t+1,r.type==="labelImage"?4:2),r.type="data",t++)}return e}function $Le(e,t){let r=e.length,n=0,o,i,a,s;for(;r--;)if(o=e[r][1],i){if(o.type==="link"||o.type==="labelLink"&&o._inactive)break;e[r][0]==="enter"&&o.type==="labelLink"&&(o._inactive=!0)}else if(a){if(e[r][0]==="enter"&&(o.type==="labelImage"||o.type==="labelLink")&&!o._balanced&&(i=r,o.type!=="labelLink")){n=2;break}}else o.type==="labelEnd"&&(a=r);let l={type:e[i][1].type==="labelLink"?"link":"image",start:Object.assign({},e[i][1].start),end:Object.assign({},e[e.length-1][1].end)},u={type:"label",start:Object.assign({},e[i][1].start),end:Object.assign({},e[a][1].end)},c={type:"labelText",start:Object.assign({},e[i+n+2][1].end),end:Object.assign({},e[a-2][1].start)};return s=[["enter",l,t],["enter",u,t]],s=gc(s,e.slice(i+1,i+n+3)),s=gc(s,[["enter",c,t]]),s=gc(s,Gb(t.parser.constructs.insideSpan.null,e.slice(i+n+4,a-3),t)),s=gc(s,[["exit",c,t],e[a-2],e[a-1],["exit",u,t]]),s=gc(s,e.slice(a+1)),s=gc(s,[["exit",l,t]]),Cs(e,i,e.length,s),e}function eFe(e,t,r){let n=this,o=n.events.length,i,a;for(;o--;)if((n.events[o][1].type==="labelImage"||n.events[o][1].type==="labelLink")&&!n.events[o][1]._balanced){i=n.events[o][1];break}return s;function s(d){return i?i._inactive?m(d):(a=n.parser.defined.includes(ku(n.sliceSerialize({start:i.end,end:n.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(d),e.exit("labelMarker"),e.exit("labelEnd"),l):r(d)}function l(d){return d===40?e.attempt(qLe,c,a?c:m)(d):d===91?e.attempt(YLe,c,a?u:m)(d):a?c(d):m(d)}function u(d){return e.attempt(KLe,c,m)(d)}function c(d){return t(d)}function m(d){return i._balanced=!0,r(d)}}function tFe(e,t,r){return n;function n(m){return e.enter("resource"),e.enter("resourceMarker"),e.consume(m),e.exit("resourceMarker"),o}function o(m){return ao(m)?p0(e,i)(m):i(m)}function i(m){return m===41?c(m):Hw(e,a,s,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(m)}function a(m){return ao(m)?p0(e,l)(m):c(m)}function s(m){return r(m)}function l(m){return m===34||m===39||m===40?Ww(e,u,r,"resourceTitle","resourceTitleMarker","resourceTitleString")(m):c(m)}function u(m){return ao(m)?p0(e,c)(m):c(m)}function c(m){return m===41?(e.enter("resourceMarker"),e.consume(m),e.exit("resourceMarker"),e.exit("resource"),t):r(m)}}function rFe(e,t,r){let n=this;return o;function o(s){return jw.call(n,e,i,a,"reference","referenceMarker","referenceString")(s)}function i(s){return n.parser.defined.includes(ku(n.sliceSerialize(n.events[n.events.length-1][1]).slice(1,-1)))?t(s):r(s)}function a(s){return r(s)}}function nFe(e,t,r){return n;function n(i){return e.enter("reference"),e.enter("referenceMarker"),e.consume(i),e.exit("referenceMarker"),o}function o(i){return i===93?(e.enter("referenceMarker"),e.consume(i),e.exit("referenceMarker"),e.exit("reference"),t):r(i)}}var KN={name:"labelStartImage",tokenize:oFe,resolveAll:f0.resolveAll};function oFe(e,t,r){let n=this;return o;function o(s){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(s),e.exit("labelImageMarker"),i}function i(s){return s===91?(e.enter("labelMarker"),e.consume(s),e.exit("labelMarker"),e.exit("labelImage"),a):r(s)}function a(s){return s===94&&"_hiddenFootnoteSupport"in n.parser.constructs?r(s):t(s)}}var JN={name:"labelStartLink",tokenize:iFe,resolveAll:f0.resolveAll};function iFe(e,t,r){let n=this;return o;function o(a){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(a),e.exit("labelMarker"),e.exit("labelLink"),i}function i(a){return a===94&&"_hiddenFootnoteSupport"in n.parser.constructs?r(a):t(a)}}var JP={name:"lineEnding",tokenize:aFe};function aFe(e,t){return r;function r(n){return e.enter("lineEnding"),e.consume(n),e.exit("lineEnding"),tn(e,t,"linePrefix")}}var h0={name:"thematicBreak",tokenize:sFe};function sFe(e,t,r){let n=0,o;return i;function i(u){return e.enter("thematicBreak"),a(u)}function a(u){return o=u,s(u)}function s(u){return u===o?(e.enter("thematicBreakSequence"),l(u)):n>=3&&(u===null||hr(u))?(e.exit("thematicBreak"),t(u)):r(u)}function l(u){return u===o?(e.consume(u),n++,l):(e.exit("thematicBreakSequence"),sn(u)?tn(e,s,"whitespace")(u):s(u))}}var Lu={name:"list",tokenize:cFe,continuation:{tokenize:mFe},exit:pFe},lFe={tokenize:fFe,partial:!0},uFe={tokenize:dFe,partial:!0};function cFe(e,t,r){let n=this,o=n.events[n.events.length-1],i=o&&o[1].type==="linePrefix"?o[2].sliceSerialize(o[1],!0).length:0,a=0;return s;function s(p){let h=n.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(h==="listUnordered"?!n.containerState.marker||p===n.containerState.marker:qP(p)){if(n.containerState.type||(n.containerState.type=h,e.enter(h,{_container:!0})),h==="listUnordered")return e.enter("listItemPrefix"),p===42||p===45?e.check(h0,r,u)(p):u(p);if(!n.interrupt||p===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),l(p)}return r(p)}function l(p){return qP(p)&&++a<10?(e.consume(p),l):(!n.interrupt||a<2)&&(n.containerState.marker?p===n.containerState.marker:p===41||p===46)?(e.exit("listItemValue"),u(p)):r(p)}function u(p){return e.enter("listItemMarker"),e.consume(p),e.exit("listItemMarker"),n.containerState.marker=n.containerState.marker||p,e.check($f,n.interrupt?r:c,e.attempt(lFe,d,m))}function c(p){return n.containerState.initialBlankLine=!0,i++,d(p)}function m(p){return sn(p)?(e.enter("listItemPrefixWhitespace"),e.consume(p),e.exit("listItemPrefixWhitespace"),d):r(p)}function d(p){return n.containerState.size=i+n.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(p)}}function mFe(e,t,r){let n=this;return n.containerState._closeFlow=void 0,e.check($f,o,i);function o(s){return n.containerState.furtherBlankLines=n.containerState.furtherBlankLines||n.containerState.initialBlankLine,tn(e,t,"listItemIndent",n.containerState.size+1)(s)}function i(s){return n.containerState.furtherBlankLines||!sn(s)?(n.containerState.furtherBlankLines=void 0,n.containerState.initialBlankLine=void 0,a(s)):(n.containerState.furtherBlankLines=void 0,n.containerState.initialBlankLine=void 0,e.attempt(uFe,t,a)(s))}function a(s){return n.containerState._closeFlow=!0,n.interrupt=void 0,tn(e,e.attempt(Lu,t,r),"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s)}}function dFe(e,t,r){let n=this;return tn(e,o,"listItemIndent",n.containerState.size+1);function o(i){let a=n.events[n.events.length-1];return a&&a[1].type==="listItemIndent"&&a[2].sliceSerialize(a[1],!0).length===n.containerState.size?t(i):r(i)}}function pFe(e){e.exit(this.containerState.type)}function fFe(e,t,r){let n=this;return tn(e,o,"listItemPrefixWhitespace",n.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function o(i){let a=n.events[n.events.length-1];return!sn(i)&&a&&a[1].type==="listItemPrefixWhitespace"?t(i):r(i)}}var Xw={name:"setextUnderline",tokenize:gFe,resolveTo:hFe};function hFe(e,t){let r=e.length,n,o,i;for(;r--;)if(e[r][0]==="enter"){if(e[r][1].type==="content"){n=r;break}e[r][1].type==="paragraph"&&(o=r)}else e[r][1].type==="content"&&e.splice(r,1),!i&&e[r][1].type==="definition"&&(i=r);let a={type:"setextHeading",start:Object.assign({},e[o][1].start),end:Object.assign({},e[e.length-1][1].end)};return e[o][1].type="setextHeadingText",i?(e.splice(o,0,["enter",a,t]),e.splice(i+1,0,["exit",e[n][1],t]),e[n][1].end=Object.assign({},e[i][1].end)):e[n][1]=a,e.push(["exit",a,t]),e}function gFe(e,t,r){let n=this,o;return i;function i(u){let c=n.events.length,m;for(;c--;)if(n.events[c][1].type!=="lineEnding"&&n.events[c][1].type!=="linePrefix"&&n.events[c][1].type!=="content"){m=n.events[c][1].type==="paragraph";break}return!n.parser.lazy[n.now().line]&&(n.interrupt||m)?(e.enter("setextHeadingLine"),o=u,a(u)):r(u)}function a(u){return e.enter("setextHeadingLineSequence"),s(u)}function s(u){return u===o?(e.consume(u),s):(e.exit("setextHeadingLineSequence"),sn(u)?tn(e,l,"lineSuffix")(u):l(u))}function l(u){return u===null||hr(u)?(e.exit("setextHeadingLine"),t(u)):r(u)}}var jre={tokenize:yFe};function yFe(e){let t=this,r=e.attempt($f,n,e.attempt(this.parser.constructs.flowInitial,o,tn(e,e.attempt(this.parser.constructs.flow,o,e.attempt(jN,o)),"linePrefix")));return r;function n(i){if(i===null){e.consume(i);return}return e.enter("lineEndingBlank"),e.consume(i),e.exit("lineEndingBlank"),t.currentConstruct=void 0,r}function o(i){if(i===null){e.consume(i);return}return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),t.currentConstruct=void 0,r}}var Wre={resolveAll:qre()},Xre=Zre("string"),Qre=Zre("text");function Zre(e){return{tokenize:t,resolveAll:qre(e==="text"?bFe:void 0)};function t(r){let n=this,o=this.parser.constructs[e],i=r.attempt(o,a,s);return a;function a(c){return u(c)?i(c):s(c)}function s(c){if(c===null){r.consume(c);return}return r.enter("data"),r.consume(c),l}function l(c){return u(c)?(r.exit("data"),i(c)):(r.consume(c),l)}function u(c){if(c===null)return!0;let m=o[c],d=-1;if(m)for(;++d<m.length;){let p=m[d];if(!p.previous||p.previous.call(n,n.previous))return!0}return!1}}}function qre(e){return t;function t(r,n){let o=-1,i;for(;++o<=r.length;)i===void 0?r[o]&&r[o][1].type==="data"&&(i=o,o++):(!r[o]||r[o][1].type!=="data")&&(o!==i+2&&(r[i][1].end=r[o-1][1].end,r.splice(i+2,o-i-2),o=i+2),i=void 0);return e?e(r,n):r}}function bFe(e,t){let r=0;for(;++r<=e.length;)if((r===e.length||e[r][1].type==="lineEnding")&&e[r-1][1].type==="data"){let n=e[r-1][1],o=t.sliceStream(n),i=o.length,a=-1,s=0,l;for(;i--;){let u=o[i];if(typeof u=="string"){for(a=u.length;u.charCodeAt(a-1)===32;)s++,a--;if(a)break;a=-1}else if(u===-2)l=!0,s++;else if(u!==-1){i++;break}}if(s){let u={type:r===e.length||l||s<2?"lineSuffix":"hardBreakTrailing",start:{line:n.end.line,column:n.end.column-s,offset:n.end.offset-s,_index:n.start._index+i,_bufferIndex:i?a:n.start._bufferIndex+a},end:Object.assign({},n.end)};n.end=Object.assign({},u.start),n.start.offset===n.end.offset?Object.assign(n,u):(e.splice(r,0,["enter",u,t],["exit",u,t]),r+=2)}r++}return e}function Yre(e,t,r){let n=Object.assign(r?Object.assign({},r):{line:1,column:1,offset:0},{_index:0,_bufferIndex:-1}),o={},i=[],a=[],s=[],l=!0,u={consume:I,enter:v,exit:A,attempt:w(_),check:w(T),interrupt:w(T,{interrupt:!0})},c={previous:null,code:null,containerState:{},events:[],parser:e,sliceStream:f,sliceSerialize:h,now:y,defineSkip:g,write:p},m=t.tokenize.call(c,u),d;return t.resolveAll&&i.push(t),c;function p(R){return a=gc(a,R),x(),a[a.length-1]!==null?[]:(D(t,0),c.events=Gb(i,c.events,c),c.events)}function h(R,k){return CFe(f(R),k)}function f(R){return xFe(a,R)}function y(){let{line:R,column:k,offset:B,_index:L,_bufferIndex:V}=n;return{line:R,column:k,offset:B,_index:L,_bufferIndex:V}}function g(R){o[R.line]=R.column,E()}function x(){let R;for(;n._index<a.length;){let k=a[n._index];if(typeof k=="string")for(R=n._index,n._bufferIndex<0&&(n._bufferIndex=0);n._index===R&&n._bufferIndex<k.length;)S(k.charCodeAt(n._bufferIndex));else S(k)}}function S(R){l=void 0,d=R,m=m(R)}function I(R){hr(R)?(n.line++,n.column=1,n.offset+=R===-3?2:1,E()):R!==-1&&(n.column++,n.offset++),n._bufferIndex<0?n._index++:(n._bufferIndex++,n._bufferIndex===a[n._index].length&&(n._bufferIndex=-1,n._index++)),c.previous=R,l=!0}function v(R,k){let B=k||{};return B.type=R,B.start=y(),c.events.push(["enter",B,c]),s.push(B),B}function A(R){let k=s.pop();return k.end=y(),c.events.push(["exit",k,c]),k}function _(R,k){D(R,k.from)}function T(R,k){k.restore()}function w(R,k){return B;function B(L,V,U){let Q,O,q,X;return Array.isArray(L)?Y(L):"tokenize"in L?Y([L]):F(L);function F(oe){return W;function W(N){let j=N!==null&&oe[N],ue=N!==null&&oe.null,be=[...Array.isArray(j)?j:j?[j]:[],...Array.isArray(ue)?ue:ue?[ue]:[]];return Y(be)(N)}}function Y(oe){return Q=oe,O=0,oe.length===0?U:$(oe[O])}function $(oe){return W;function W(N){return X=M(),q=oe,oe.partial||(c.currentConstruct=oe),oe.name&&c.parser.constructs.disable.null.includes(oe.name)?ie(N):oe.tokenize.call(k?Object.assign(Object.create(c),k):c,u,ce,ie)(N)}}function ce(oe){return l=!0,R(q,X),V}function ie(oe){return l=!0,X.restore(),++O<Q.length?$(Q[O]):U}}}function D(R,k){R.resolveAll&&!i.includes(R)&&i.push(R),R.resolve&&Cs(c.events,k,c.events.length-k,R.resolve(c.events.slice(k),c)),R.resolveTo&&(c.events=R.resolveTo(c.events,c))}function M(){let R=y(),k=c.previous,B=c.currentConstruct,L=c.events.length,V=Array.from(s);return{restore:U,from:L};function U(){n=R,c.previous=k,c.currentConstruct=B,c.events.length=L,s=V,E()}}function E(){n.line in o&&n.column<2&&(n.column=o[n.line],n.offset+=o[n.line]-1)}}function xFe(e,t){let r=t.start._index,n=t.start._bufferIndex,o=t.end._index,i=t.end._bufferIndex,a;if(r===o)a=[e[r].slice(n,i)];else{if(a=e.slice(r,o),n>-1){let s=a[0];typeof s=="string"?a[0]=s.slice(n):a.shift()}i>0&&a.push(e[o].slice(0,i))}return a}function CFe(e,t){let r=-1,n=[],o;for(;++r<e.length;){let i=e[r],a;if(typeof i=="string")a=i;else switch(i){case-5:{a="\r";break}case-4:{a=`
`;break}case-3:{a=`\r
`;break}case-2:{a=t?" ":"	";break}case-1:{if(!t&&o)continue;a=" ";break}default:a=String.fromCharCode(i)}o=i===-2,n.push(a)}return n.join("")}var $N={};Bi($N,{attentionMarkers:()=>RFe,contentInitial:()=>vFe,disable:()=>DFe,document:()=>SFe,flow:()=>AFe,flowInitial:()=>IFe,insideSpan:()=>_Fe,string:()=>TFe,text:()=>PFe});var SFe={42:Lu,43:Lu,45:Lu,48:Lu,49:Lu,50:Lu,51:Lu,52:Lu,53:Lu,54:Lu,55:Lu,56:Lu,57:Lu,62:Ow},vFe={91:WN},IFe={[-2]:KP,[-1]:KP,32:KP},AFe={35:QN,42:h0,45:[Xw,h0],60:qN,61:Xw,95:h0,96:Nw,126:Nw},TFe={38:Uw,92:Gw},PFe={[-5]:JP,[-4]:JP,[-3]:JP,33:KN,38:Uw,42:YP,60:[zN,YN],91:JN,92:[XN,Gw],93:f0,95:YP,96:HN},_Fe={null:[YP,Wre]},RFe={null:[42,95]},DFe={null:[]};function e5(e){let r=Fw([$N,...(e||{}).extensions||[]]),n={defined:[],lazy:{},constructs:r,content:o(Ore),document:o(Ure),flow:o(jre),string:o(Xre),text:o(Qre)};return n;function o(i){return a;function a(s){return Yre(n,i,s)}}}function t5(e){for(;!zw(e););return e}var Kre=/[\0\t\n\r]/g;function r5(){let e=1,t="",r=!0,n;return o;function o(i,a,s){let l=[],u,c,m,d,p;for(i=t+(typeof i=="string"?i.toString():new TextDecoder(a||void 0).decode(i)),m=0,t="",r&&(i.charCodeAt(0)===65279&&m++,r=void 0);m<i.length;){if(Kre.lastIndex=m,u=Kre.exec(i),d=u&&u.index!==void 0?u.index:i.length,p=i.charCodeAt(d),!u){t=i.slice(m);break}if(p===10&&m===d&&n)l.push(-3),n=void 0;else switch(n&&(l.push(-5),n=void 0),m<d&&(l.push(i.slice(m,d)),e+=d-m),p){case 0:{l.push(65533),e++;break}case 9:{for(c=Math.ceil(e/4)*4,l.push(-2);e++<c;)l.push(-1);break}case 10:{l.push(-4),e=1;break}default:n=!0,e=1}m=d+1}return s&&(n&&l.push(-5),t&&l.push(t),l.push(null)),l}}var wFe=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Jre(e){return e.replace(wFe,EFe)}function EFe(e,t,r){if(t)return t;if(r.charCodeAt(0)===35){let o=r.charCodeAt(1),i=o===120||o===88;return Vw(r.slice(i?2:1),i?16:10)}return Q1(r)||e}var ene={}.hasOwnProperty;function n5(e,t,r){return typeof t!="string"&&(r=t,t=void 0),MFe(r)(t5(e5(r).document().write(r5()(e,t,!0))))}function MFe(e){let t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(J),autolinkProtocol:w,autolinkEmail:w,atxHeading:i(ee),blockQuote:i(W),characterEscape:w,characterReference:w,codeFenced:i(N),codeFencedFenceInfo:a,codeFencedFenceMeta:a,codeIndented:i(N,a),codeText:i(j,a),codeTextData:w,data:w,codeFlowValue:w,definition:i(ue),definitionDestinationString:a,definitionLabelString:a,definitionTitleString:a,emphasis:i(be),hardBreakEscape:i(le),hardBreakTrailing:i(le),htmlFlow:i(Ae,a),htmlFlowData:w,htmlText:i(Ae,a),htmlTextData:w,image:i(Ce),label:a,link:i(J),listItem:i(ae),listItemValue:d,listOrdered:i(z,m),listUnordered:i(z),paragraph:i(ge),reference:F,referenceString:a,resourceDestinationString:a,resourceTitleString:a,setextHeading:i(ee),strong:i(ve),thematicBreak:i(ze)},exit:{atxHeading:l(),atxHeadingSequence:v,autolink:l(),autolinkEmail:oe,autolinkProtocol:ie,blockQuote:l(),characterEscapeValue:D,characterReferenceMarkerHexadecimal:$,characterReferenceMarkerNumeric:$,characterReferenceValue:ce,codeFenced:l(y),codeFencedFence:f,codeFencedFenceInfo:p,codeFencedFenceMeta:h,codeFlowValue:D,codeIndented:l(g),codeText:l(B),codeTextData:D,data:D,definition:l(),definitionDestinationString:I,definitionLabelString:x,definitionTitleString:S,emphasis:l(),hardBreakEscape:l(E),hardBreakTrailing:l(E),htmlFlow:l(R),htmlFlowData:D,htmlText:l(k),htmlTextData:D,image:l(V),label:Q,labelText:U,lineEnding:M,link:l(L),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:Y,resourceDestinationString:O,resourceTitleString:q,resource:X,setextHeading:l(T),setextHeadingLineSequence:_,setextHeadingText:A,strong:l(),thematicBreak:l()}};tne(t,(e||{}).mdastExtensions||[]);let r={};return n;function n(Re){let Ke={type:"root",children:[]},tt={stack:[Ke],tokenStack:[],config:t,enter:s,exit:u,buffer:a,resume:c,data:r},bt=[],Pt=-1;for(;++Pt<Re.length;)if(Re[Pt][1].type==="listOrdered"||Re[Pt][1].type==="listUnordered")if(Re[Pt][0]==="enter")bt.push(Pt);else{let fr=bt.pop();Pt=o(Re,fr,Pt)}for(Pt=-1;++Pt<Re.length;){let fr=t[Re[Pt][0]];ene.call(fr,Re[Pt][1].type)&&fr[Re[Pt][1].type].call(Object.assign({sliceSerialize:Re[Pt][2].sliceSerialize},tt),Re[Pt][1])}if(tt.tokenStack.length>0){let fr=tt.tokenStack[tt.tokenStack.length-1];(fr[1]||$re).call(tt,void 0,fr[0])}for(Ke.position={start:Ub(Re.length>0?Re[0][1].start:{line:1,column:1,offset:0}),end:Ub(Re.length>0?Re[Re.length-2][1].end:{line:1,column:1,offset:0})},Pt=-1;++Pt<t.transforms.length;)Ke=t.transforms[Pt](Ke)||Ke;return Ke}function o(Re,Ke,tt){let bt=Ke-1,Pt=-1,fr=!1,gt,Sr,zr,Nn;for(;++bt<=tt;){let xn=Re[bt];switch(xn[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{xn[0]==="enter"?Pt++:Pt--,Nn=void 0;break}case"lineEndingBlank":{xn[0]==="enter"&&(gt&&!Nn&&!Pt&&!zr&&(zr=bt),Nn=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Nn=void 0}if(!Pt&&xn[0]==="enter"&&xn[1].type==="listItemPrefix"||Pt===-1&&xn[0]==="exit"&&(xn[1].type==="listUnordered"||xn[1].type==="listOrdered")){if(gt){let In=bt;for(Sr=void 0;In--;){let zn=Re[In];if(zn[1].type==="lineEnding"||zn[1].type==="lineEndingBlank"){if(zn[0]==="exit")continue;Sr&&(Re[Sr][1].type="lineEndingBlank",fr=!0),zn[1].type="lineEnding",Sr=In}else if(!(zn[1].type==="linePrefix"||zn[1].type==="blockQuotePrefix"||zn[1].type==="blockQuotePrefixWhitespace"||zn[1].type==="blockQuoteMarker"||zn[1].type==="listItemIndent"))break}zr&&(!Sr||zr<Sr)&&(gt._spread=!0),gt.end=Object.assign({},Sr?Re[Sr][1].start:xn[1].end),Re.splice(Sr||bt,0,["exit",gt,xn[2]]),bt++,tt++}if(xn[1].type==="listItemPrefix"){let In={type:"listItem",_spread:!1,start:Object.assign({},xn[1].start),end:void 0};gt=In,Re.splice(bt,0,["enter",In,xn[2]]),bt++,tt++,zr=void 0,Nn=!0}}}return Re[Ke][1]._spread=fr,tt}function i(Re,Ke){return tt;function tt(bt){s.call(this,Re(bt),bt),Ke&&Ke.call(this,bt)}}function a(){this.stack.push({type:"fragment",children:[]})}function s(Re,Ke,tt){this.stack[this.stack.length-1].children.push(Re),this.stack.push(Re),this.tokenStack.push([Ke,tt]),Re.position={start:Ub(Ke.start),end:void 0}}function l(Re){return Ke;function Ke(tt){Re&&Re.call(this,tt),u.call(this,tt)}}function u(Re,Ke){let tt=this.stack.pop(),bt=this.tokenStack.pop();if(bt)bt[0].type!==Re.type&&(Ke?Ke.call(this,Re,bt[0]):(bt[1]||$re).call(this,Re,bt[0]));else throw new Error("Cannot close `"+Re.type+"` ("+Vb({start:Re.start,end:Re.end})+"): it\u2019s not open");tt.position.end=Ub(Re.end)}function c(){return c0(this.stack.pop())}function m(){this.data.expectingFirstListItemValue=!0}function d(Re){if(this.data.expectingFirstListItemValue){let Ke=this.stack[this.stack.length-2];Ke.start=Number.parseInt(this.sliceSerialize(Re),10),this.data.expectingFirstListItemValue=void 0}}function p(){let Re=this.resume(),Ke=this.stack[this.stack.length-1];Ke.lang=Re}function h(){let Re=this.resume(),Ke=this.stack[this.stack.length-1];Ke.meta=Re}function f(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function y(){let Re=this.resume(),Ke=this.stack[this.stack.length-1];Ke.value=Re.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function g(){let Re=this.resume(),Ke=this.stack[this.stack.length-1];Ke.value=Re.replace(/(\r?\n|\r)$/g,"")}function x(Re){let Ke=this.resume(),tt=this.stack[this.stack.length-1];tt.label=Ke,tt.identifier=ku(this.sliceSerialize(Re)).toLowerCase()}function S(){let Re=this.resume(),Ke=this.stack[this.stack.length-1];Ke.title=Re}function I(){let Re=this.resume(),Ke=this.stack[this.stack.length-1];Ke.url=Re}function v(Re){let Ke=this.stack[this.stack.length-1];if(!Ke.depth){let tt=this.sliceSerialize(Re).length;Ke.depth=tt}}function A(){this.data.setextHeadingSlurpLineEnding=!0}function _(Re){let Ke=this.stack[this.stack.length-1];Ke.depth=this.sliceSerialize(Re).codePointAt(0)===61?1:2}function T(){this.data.setextHeadingSlurpLineEnding=void 0}function w(Re){let tt=this.stack[this.stack.length-1].children,bt=tt[tt.length-1];(!bt||bt.type!=="text")&&(bt=Oe(),bt.position={start:Ub(Re.start),end:void 0},tt.push(bt)),this.stack.push(bt)}function D(Re){let Ke=this.stack.pop();Ke.value+=this.sliceSerialize(Re),Ke.position.end=Ub(Re.end)}function M(Re){let Ke=this.stack[this.stack.length-1];if(this.data.atHardBreak){let tt=Ke.children[Ke.children.length-1];tt.position.end=Ub(Re.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(Ke.type)&&(w.call(this,Re),D.call(this,Re))}function E(){this.data.atHardBreak=!0}function R(){let Re=this.resume(),Ke=this.stack[this.stack.length-1];Ke.value=Re}function k(){let Re=this.resume(),Ke=this.stack[this.stack.length-1];Ke.value=Re}function B(){let Re=this.resume(),Ke=this.stack[this.stack.length-1];Ke.value=Re}function L(){let Re=this.stack[this.stack.length-1];if(this.data.inReference){let Ke=this.data.referenceType||"shortcut";Re.type+="Reference",Re.referenceType=Ke,delete Re.url,delete Re.title}else delete Re.identifier,delete Re.label;this.data.referenceType=void 0}function V(){let Re=this.stack[this.stack.length-1];if(this.data.inReference){let Ke=this.data.referenceType||"shortcut";Re.type+="Reference",Re.referenceType=Ke,delete Re.url,delete Re.title}else delete Re.identifier,delete Re.label;this.data.referenceType=void 0}function U(Re){let Ke=this.sliceSerialize(Re),tt=this.stack[this.stack.length-2];tt.label=Jre(Ke),tt.identifier=ku(Ke).toLowerCase()}function Q(){let Re=this.stack[this.stack.length-1],Ke=this.resume(),tt=this.stack[this.stack.length-1];if(this.data.inReference=!0,tt.type==="link"){let bt=Re.children;tt.children=bt}else tt.alt=Ke}function O(){let Re=this.resume(),Ke=this.stack[this.stack.length-1];Ke.url=Re}function q(){let Re=this.resume(),Ke=this.stack[this.stack.length-1];Ke.title=Re}function X(){this.data.inReference=void 0}function F(){this.data.referenceType="collapsed"}function Y(Re){let Ke=this.resume(),tt=this.stack[this.stack.length-1];tt.label=Ke,tt.identifier=ku(this.sliceSerialize(Re)).toLowerCase(),this.data.referenceType="full"}function $(Re){this.data.characterReferenceType=Re.type}function ce(Re){let Ke=this.sliceSerialize(Re),tt=this.data.characterReferenceType,bt;tt?(bt=Vw(Ke,tt==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):bt=Q1(Ke);let Pt=this.stack.pop();Pt.value+=bt,Pt.position.end=Ub(Re.end)}function ie(Re){D.call(this,Re);let Ke=this.stack[this.stack.length-1];Ke.url=this.sliceSerialize(Re)}function oe(Re){D.call(this,Re);let Ke=this.stack[this.stack.length-1];Ke.url="mailto:"+this.sliceSerialize(Re)}function W(){return{type:"blockquote",children:[]}}function N(){return{type:"code",lang:null,meta:null,value:""}}function j(){return{type:"inlineCode",value:""}}function ue(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function be(){return{type:"emphasis",children:[]}}function ee(){return{type:"heading",depth:0,children:[]}}function le(){return{type:"break"}}function Ae(){return{type:"html",value:""}}function Ce(){return{type:"image",title:null,url:"",alt:null}}function J(){return{type:"link",title:null,url:"",children:[]}}function z(Re){return{type:"list",ordered:Re.type==="listOrdered",start:null,spread:Re._spread,children:[]}}function ae(Re){return{type:"listItem",spread:Re._spread,checked:null,children:[]}}function ge(){return{type:"paragraph",children:[]}}function ve(){return{type:"strong",children:[]}}function Oe(){return{type:"text",value:""}}function ze(){return{type:"thematicBreak"}}}function Ub(e){return{line:e.line,column:e.column,offset:e.offset}}function tne(e,t){let r=-1;for(;++r<t.length;){let n=t[r];Array.isArray(n)?tne(e,n):BFe(e,n)}}function BFe(e,t){let r;for(r in t)if(ene.call(t,r))switch(r){case"canContainEols":{let n=t[r];n&&e[r].push(...n);break}case"transforms":{let n=t[r];n&&e[r].push(...n);break}case"enter":case"exit":{let n=t[r];n&&Object.assign(e[r],n);break}}}function $re(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+Vb({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+Vb({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+Vb({start:t.start,end:t.end})+") is still open")}function Qw(e){let t=this;t.parser=r;function r(n){return n5(n,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}function rne(e,t){let r={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,r),e.applyData(t,r)}function nne(e,t){let r={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,r),[e.applyData(t,r),{type:"text",value:`
`}]}function one(e,t){let r=t.value?t.value+`
`:"",n={};t.lang&&(n.className=["language-"+t.lang]);let o={type:"element",tagName:"code",properties:n,children:[{type:"text",value:r}]};return t.meta&&(o.data={meta:t.meta}),e.patch(t,o),o=e.applyData(t,o),o={type:"element",tagName:"pre",properties:{},children:[o]},e.patch(t,o),o}function ine(e,t){let r={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function ane(e,t){let r={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function sne(e,t){let r=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",n=String(t.identifier).toUpperCase(),o=Od(n.toLowerCase()),i=e.footnoteOrder.indexOf(n),a,s=e.footnoteCounts.get(n);s===void 0?(s=0,e.footnoteOrder.push(n),a=e.footnoteOrder.length):a=i+1,s+=1,e.footnoteCounts.set(n,s);let l={type:"element",tagName:"a",properties:{href:"#"+r+"fn-"+o,id:r+"fnref-"+o+(s>1?"-"+s:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(a)}]};e.patch(t,l);let u={type:"element",tagName:"sup",properties:{},children:[l]};return e.patch(t,u),e.applyData(t,u)}function lne(e,t){let r={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function une(e,t){if(e.options.allowDangerousHtml){let r={type:"raw",value:t.value};return e.patch(t,r),e.applyData(t,r)}}function Zw(e,t){let r=t.referenceType,n="]";if(r==="collapsed"?n+="[]":r==="full"&&(n+="["+(t.label||t.identifier)+"]"),t.type==="imageReference")return[{type:"text",value:"!["+t.alt+n}];let o=e.all(t),i=o[0];i&&i.type==="text"?i.value="["+i.value:o.unshift({type:"text",value:"["});let a=o[o.length-1];return a&&a.type==="text"?a.value+=n:o.push({type:"text",value:n}),o}function cne(e,t){let r=String(t.identifier).toUpperCase(),n=e.definitionById.get(r);if(!n)return Zw(e,t);let o={src:Od(n.url||""),alt:t.alt};n.title!==null&&n.title!==void 0&&(o.title=n.title);let i={type:"element",tagName:"img",properties:o,children:[]};return e.patch(t,i),e.applyData(t,i)}function mne(e,t){let r={src:Od(t.url)};t.alt!==null&&t.alt!==void 0&&(r.alt=t.alt),t.title!==null&&t.title!==void 0&&(r.title=t.title);let n={type:"element",tagName:"img",properties:r,children:[]};return e.patch(t,n),e.applyData(t,n)}function dne(e,t){let r={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,r);let n={type:"element",tagName:"code",properties:{},children:[r]};return e.patch(t,n),e.applyData(t,n)}function pne(e,t){let r=String(t.identifier).toUpperCase(),n=e.definitionById.get(r);if(!n)return Zw(e,t);let o={href:Od(n.url||"")};n.title!==null&&n.title!==void 0&&(o.title=n.title);let i={type:"element",tagName:"a",properties:o,children:e.all(t)};return e.patch(t,i),e.applyData(t,i)}function fne(e,t){let r={href:Od(t.url)};t.title!==null&&t.title!==void 0&&(r.title=t.title);let n={type:"element",tagName:"a",properties:r,children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function hne(e,t,r){let n=e.all(t),o=r?kFe(r):gne(t),i={},a=[];if(typeof t.checked=="boolean"){let c=n[0],m;c&&c.type==="element"&&c.tagName==="p"?m=c:(m={type:"element",tagName:"p",properties:{},children:[]},n.unshift(m)),m.children.length>0&&m.children.unshift({type:"text",value:" "}),m.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),i.className=["task-list-item"]}let s=-1;for(;++s<n.length;){let c=n[s];(o||s!==0||c.type!=="element"||c.tagName!=="p")&&a.push({type:"text",value:`
`}),c.type==="element"&&c.tagName==="p"&&!o?a.push(...c.children):a.push(c)}let l=n[n.length-1];l&&(o||l.type!=="element"||l.tagName!=="p")&&a.push({type:"text",value:`
`});let u={type:"element",tagName:"li",properties:i,children:a};return e.patch(t,u),e.applyData(t,u)}function kFe(e){let t=!1;if(e.type==="list"){t=e.spread||!1;let r=e.children,n=-1;for(;!t&&++n<r.length;)t=gne(r[n])}return t}function gne(e){let t=e.spread;return t??e.children.length>1}function yne(e,t){let r={},n=e.all(t),o=-1;for(typeof t.start=="number"&&t.start!==1&&(r.start=t.start);++o<n.length;){let a=n[o];if(a.type==="element"&&a.tagName==="li"&&a.properties&&Array.isArray(a.properties.className)&&a.properties.className.includes("task-list-item")){r.className=["contains-task-list"];break}}let i={type:"element",tagName:t.ordered?"ol":"ul",properties:r,children:e.wrap(n,!0)};return e.patch(t,i),e.applyData(t,i)}function bne(e,t){let r={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function xne(e,t){let r={type:"root",children:e.wrap(e.all(t))};return e.patch(t,r),e.applyData(t,r)}function Cne(e,t){let r={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function Sne(e,t){let r=e.all(t),n=r.shift(),o=[];if(n){let a={type:"element",tagName:"thead",properties:{},children:e.wrap([n],!0)};e.patch(t.children[0],a),o.push(a)}if(r.length>0){let a={type:"element",tagName:"tbody",properties:{},children:e.wrap(r,!0)},s=X1(t.children[1]),l=Lw(t.children[t.children.length-1]);s&&l&&(a.position={start:s,end:l}),o.push(a)}let i={type:"element",tagName:"table",properties:{},children:e.wrap(o,!0)};return e.patch(t,i),e.applyData(t,i)}function vne(e,t,r){let n=r?r.children:void 0,i=(n?n.indexOf(t):1)===0?"th":"td",a=r&&r.type==="table"?r.align:void 0,s=a?a.length:t.children.length,l=-1,u=[];for(;++l<s;){let m=t.children[l],d={},p=a?a[l]:void 0;p&&(d.align=p);let h={type:"element",tagName:i,properties:d,children:[]};m&&(h.children=e.all(m),e.patch(m,h),h=e.applyData(m,h)),u.push(h)}let c={type:"element",tagName:"tr",properties:{},children:e.wrap(u,!0)};return e.patch(t,c),e.applyData(t,c)}function Ine(e,t){let r={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function Tne(e){let t=String(e),r=/\r?\n|\r/g,n=r.exec(t),o=0,i=[];for(;n;)i.push(Ane(t.slice(o,n.index),o>0,!0),n[0]),o=n.index+n[0].length,n=r.exec(t);return i.push(Ane(t.slice(o),o>0,!1)),i.join("")}function Ane(e,t,r){let n=0,o=e.length;if(t){let i=e.codePointAt(n);for(;i===9||i===32;)n++,i=e.codePointAt(n)}if(r){let i=e.codePointAt(o-1);for(;i===9||i===32;)o--,i=e.codePointAt(o-1)}return o>n?e.slice(n,o):""}function Pne(e,t){let r={type:"text",value:Tne(String(t.value))};return e.patch(t,r),e.applyData(t,r)}function _ne(e,t){let r={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,r),e.applyData(t,r)}var Rne={blockquote:rne,break:nne,code:one,delete:ine,emphasis:ane,footnoteReference:sne,heading:lne,html:une,imageReference:cne,image:mne,inlineCode:dne,linkReference:pne,link:fne,listItem:hne,list:yne,paragraph:bne,root:xne,strong:Cne,table:Sne,tableCell:Ine,tableRow:vne,text:Pne,thematicBreak:_ne,toml:qw,yaml:qw,definition:qw,footnoteDefinition:qw};function qw(){}var Dne=typeof self=="object"?self:globalThis,LFe=(e,t)=>{let r=(o,i)=>(e.set(i,o),o),n=o=>{if(e.has(o))return e.get(o);let[i,a]=t[o];switch(i){case 0:case-1:return r(a,o);case 1:{let s=r([],o);for(let l of a)s.push(n(l));return s}case 2:{let s=r({},o);for(let[l,u]of a)s[n(l)]=n(u);return s}case 3:return r(new Date(a),o);case 4:{let{source:s,flags:l}=a;return r(new RegExp(s,l),o)}case 5:{let s=r(new Map,o);for(let[l,u]of a)s.set(n(l),n(u));return s}case 6:{let s=r(new Set,o);for(let l of a)s.add(n(l));return s}case 7:{let{name:s,message:l}=a;return r(new Dne[s](l),o)}case 8:return r(BigInt(a),o);case"BigInt":return r(Object(BigInt(a)),o)}return r(new Dne[i](a),o)};return n},s5=e=>LFe(new Map,e)(0);var Z1="",{toString:FFe}={},{keys:VFe}=Object,r2=e=>{let t=typeof e;if(t!=="object"||!e)return[0,t];let r=FFe.call(e).slice(8,-1);switch(r){case"Array":return[1,Z1];case"Object":return[2,Z1];case"Date":return[3,Z1];case"RegExp":return[4,Z1];case"Map":return[5,Z1];case"Set":return[6,Z1]}return r.includes("Array")?[1,r]:r.includes("Error")?[7,r]:[2,r]},eE=([e,t])=>e===0&&(t==="function"||t==="symbol"),OFe=(e,t,r,n)=>{let o=(a,s)=>{let l=n.push(a)-1;return r.set(s,l),l},i=a=>{if(r.has(a))return r.get(a);let[s,l]=r2(a);switch(s){case 0:{let c=a;switch(l){case"bigint":s=8,c=a.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+l);c=null;break;case"undefined":return o([-1],a)}return o([s,c],a)}case 1:{if(l)return o([l,[...a]],a);let c=[],m=o([s,c],a);for(let d of a)c.push(i(d));return m}case 2:{if(l)switch(l){case"BigInt":return o([l,a.toString()],a);case"Boolean":case"Number":case"String":return o([l,a.valueOf()],a)}if(t&&"toJSON"in a)return i(a.toJSON());let c=[],m=o([s,c],a);for(let d of VFe(a))(e||!eE(r2(a[d])))&&c.push([i(d),i(a[d])]);return m}case 3:return o([s,a.toISOString()],a);case 4:{let{source:c,flags:m}=a;return o([s,{source:c,flags:m}],a)}case 5:{let c=[],m=o([s,c],a);for(let[d,p]of a)(e||!(eE(r2(d))||eE(r2(p))))&&c.push([i(d),i(p)]);return m}case 6:{let c=[],m=o([s,c],a);for(let d of a)(e||!eE(r2(d)))&&c.push(i(d));return m}}let{message:u}=a;return o([s,{name:l,message:u}],a)};return i},l5=(e,{json:t,lossy:r}={})=>{let n=[];return OFe(!(t||r),!!t,new Map,n)(e),n};var q1=typeof structuredClone=="function"?(e,t)=>t&&("json"in t||"lossy"in t)?s5(l5(e,t)):structuredClone(e):(e,t)=>s5(l5(e,t));function GFe(e,t){let r=[{type:"text",value:"\u21A9"}];return t>1&&r.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),r}function UFe(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}function wne(e){let t=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",r=e.options.footnoteBackContent||GFe,n=e.options.footnoteBackLabel||UFe,o=e.options.footnoteLabel||"Footnotes",i=e.options.footnoteLabelTagName||"h2",a=e.options.footnoteLabelProperties||{className:["sr-only"]},s=[],l=-1;for(;++l<e.footnoteOrder.length;){let u=e.footnoteById.get(e.footnoteOrder[l]);if(!u)continue;let c=e.all(u),m=String(u.identifier).toUpperCase(),d=Od(m.toLowerCase()),p=0,h=[],f=e.footnoteCounts.get(m);for(;f!==void 0&&++p<=f;){h.length>0&&h.push({type:"text",value:" "});let x=typeof r=="string"?r:r(l,p);typeof x=="string"&&(x={type:"text",value:x}),h.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+d+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof n=="string"?n:n(l,p),className:["data-footnote-backref"]},children:Array.isArray(x)?x:[x]})}let y=c[c.length-1];if(y&&y.type==="element"&&y.tagName==="p"){let x=y.children[y.children.length-1];x&&x.type==="text"?x.value+=" ":y.children.push({type:"text",value:" "}),y.children.push(...h)}else c.push(...h);let g={type:"element",tagName:"li",properties:{id:t+"fn-"+d},children:e.wrap(c,!0)};e.patch(u,g),s.push(g)}if(s.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:i,properties:{...q1(a),id:"footnote-label"},children:[{type:"text",value:o}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(s,!0)},{type:"text",value:`
`}]}}var Nb=function(e){if(e==null)return jFe;if(typeof e=="function")return tE(e);if(typeof e=="object")return Array.isArray(e)?NFe(e):zFe(e);if(typeof e=="string")return HFe(e);throw new Error("Expected function, string, or object as test")};function NFe(e){let t=[],r=-1;for(;++r<e.length;)t[r]=Nb(e[r]);return tE(n);function n(...o){let i=-1;for(;++i<t.length;)if(t[i].apply(this,o))return!0;return!1}}function zFe(e){let t=e;return tE(r);function r(n){let o=n,i;for(i in e)if(o[i]!==t[i])return!1;return!0}}function HFe(e){return tE(t);function t(r){return r&&r.type===e}}function tE(e){return t;function t(r,n,o){return!!(WFe(r)&&e.call(this,r,typeof n=="number"?n:void 0,o||void 0))}}function jFe(){return!0}function WFe(e){return e!==null&&typeof e=="object"&&"type"in e}var Ene=[],rE=!0,g0=!1,nE="skip";function n2(e,t,r,n){let o;typeof t=="function"&&typeof r!="function"?(n=r,r=t):o=t;let i=Nb(o),a=n?-1:1;s(e,void 0,[])();function s(l,u,c){let m=l&&typeof l=="object"?l:{};if(typeof m.type=="string"){let p=typeof m.tagName=="string"?m.tagName:typeof m.name=="string"?m.name:void 0;Object.defineProperty(d,"name",{value:"node ("+(l.type+(p?"<"+p+">":""))+")"})}return d;function d(){let p=Ene,h,f,y;if((!t||i(l,u,c[c.length-1]||void 0))&&(p=XFe(r(l,c)),p[0]===g0))return p;if("children"in l&&l.children){let g=l;if(g.children&&p[0]!==nE)for(f=(n?g.children.length:-1)+a,y=c.concat(g);f>-1&&f<g.children.length;){let x=g.children[f];if(h=s(x,f,y)(),h[0]===g0)return h;f=typeof h[1]=="number"?h[1]:f+a}}return p}}}function XFe(e){return Array.isArray(e)?e:typeof e=="number"?[rE,e]:e==null?Ene:[e]}function y0(e,t,r,n){let o,i,a;typeof t=="function"&&typeof r!="function"?(i=void 0,a=t,o=r):(i=t,a=r,o=n),n2(e,i,s,o);function s(l,u){let c=u[u.length-1],m=c?c.children.indexOf(l):void 0;return a(l,m,c)}}var u5={}.hasOwnProperty,QFe={};function Bne(e,t){let r=t||QFe,n=new Map,o=new Map,i=new Map,a={...Rne,...r.handlers},s={all:u,applyData:qFe,definitionById:n,footnoteById:o,footnoteCounts:i,footnoteOrder:[],handlers:a,one:l,options:r,patch:ZFe,wrap:KFe};return y0(e,function(c){if(c.type==="definition"||c.type==="footnoteDefinition"){let m=c.type==="definition"?n:o,d=String(c.identifier).toUpperCase();m.has(d)||m.set(d,c)}}),s;function l(c,m){let d=c.type,p=s.handlers[d];if(u5.call(s.handlers,d)&&p)return p(s,c,m);if(s.options.passThrough&&s.options.passThrough.includes(d)){if("children"in c){let{children:f,...y}=c,g=q1(y);return g.children=s.all(c),g}return q1(c)}return(s.options.unknownHandler||YFe)(s,c,m)}function u(c){let m=[];if("children"in c){let d=c.children,p=-1;for(;++p<d.length;){let h=s.one(d[p],c);if(h){if(p&&d[p-1].type==="break"&&(!Array.isArray(h)&&h.type==="text"&&(h.value=Mne(h.value)),!Array.isArray(h)&&h.type==="element")){let f=h.children[0];f&&f.type==="text"&&(f.value=Mne(f.value))}Array.isArray(h)?m.push(...h):m.push(h)}}}return m}}function ZFe(e,t){e.position&&(t.position=VN(e))}function qFe(e,t){let r=t;if(e&&e.data){let n=e.data.hName,o=e.data.hChildren,i=e.data.hProperties;if(typeof n=="string")if(r.type==="element")r.tagName=n;else{let a="children"in r?r.children:[r];r={type:"element",tagName:n,properties:{},children:a}}r.type==="element"&&i&&Object.assign(r.properties,q1(i)),"children"in r&&r.children&&o!==null&&o!==void 0&&(r.children=o)}return r}function YFe(e,t){let r=t.data||{},n="value"in t&&!(u5.call(r,"hProperties")||u5.call(r,"hChildren"))?{type:"text",value:t.value}:{type:"element",tagName:"div",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function KFe(e,t){let r=[],n=-1;for(t&&r.push({type:"text",value:`
`});++n<e.length;)n&&r.push({type:"text",value:`
`}),r.push(e[n]);return t&&e.length>0&&r.push({type:"text",value:`
`}),r}function Mne(e){let t=0,r=e.charCodeAt(t);for(;r===9||r===32;)t++,r=e.charCodeAt(t);return e.slice(t)}function oE(e,t){let r=Bne(e,t),n=r.one(e,void 0),o=wne(r),i=Array.isArray(n)?{type:"root",children:n}:n||{type:"root",children:[]};return o&&("children"in i,i.children.push({type:"text",value:`
`},o)),i}function iE(e,t){return e&&"run"in e?async function(r,n){let o=oE(r,t);await e.run(o,n)}:function(r){return oE(r,t||e)}}function c5(e){if(e)throw e}var lE=Rt(zne(),1);function o2(e){if(typeof e!="object"||e===null)return!1;let t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function Hne(){let e=[],t={run:r,use:n};return t;function r(...o){let i=-1,a=o.pop();if(typeof a!="function")throw new TypeError("Expected function as last argument, not "+a);s(null,...o);function s(l,...u){let c=e[++i],m=-1;if(l){a(l);return}for(;++m<o.length;)(u[m]===null||u[m]===void 0)&&(u[m]=o[m]);o=u,c?JFe(c,s)(...u):a(null,...u)}}function n(o){if(typeof o!="function")throw new TypeError("Expected `middelware` to be a function, not "+o);return e.push(o),t}}function JFe(e,t){let r;return n;function n(...a){let s=e.length>a.length,l;s&&a.push(o);try{l=e.apply(this,a)}catch(u){let c=u;if(s&&r)throw c;return o(c)}s||(l instanceof Promise?l.then(i,o):l instanceof Error?o(l):i(l))}function o(a,...s){r||(r=!0,t(a,...s))}function i(a){o(null,a)}}var $p={basename:$Fe,dirname:eVe,extname:tVe,join:rVe,sep:"/"};function $Fe(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');i2(e);let r=0,n=-1,o=e.length,i;if(t===void 0||t.length===0||t.length>e.length){for(;o--;)if(e.codePointAt(o)===47){if(i){r=o+1;break}}else n<0&&(i=!0,n=o+1);return n<0?"":e.slice(r,n)}if(t===e)return"";let a=-1,s=t.length-1;for(;o--;)if(e.codePointAt(o)===47){if(i){r=o+1;break}}else a<0&&(i=!0,a=o+1),s>-1&&(e.codePointAt(o)===t.codePointAt(s--)?s<0&&(n=o):(s=-1,n=a));return r===n?n=a:n<0&&(n=e.length),e.slice(r,n)}function eVe(e){if(i2(e),e.length===0)return".";let t=-1,r=e.length,n;for(;--r;)if(e.codePointAt(r)===47){if(n){t=r;break}}else n||(n=!0);return t<0?e.codePointAt(0)===47?"/":".":t===1&&e.codePointAt(0)===47?"//":e.slice(0,t)}function tVe(e){i2(e);let t=e.length,r=-1,n=0,o=-1,i=0,a;for(;t--;){let s=e.codePointAt(t);if(s===47){if(a){n=t+1;break}continue}r<0&&(a=!0,r=t+1),s===46?o<0?o=t:i!==1&&(i=1):o>-1&&(i=-1)}return o<0||r<0||i===0||i===1&&o===r-1&&o===n+1?"":e.slice(o,r)}function rVe(...e){let t=-1,r;for(;++t<e.length;)i2(e[t]),e[t]&&(r=r===void 0?e[t]:r+"/"+e[t]);return r===void 0?".":nVe(r)}function nVe(e){i2(e);let t=e.codePointAt(0)===47,r=oVe(e,!t);return r.length===0&&!t&&(r="."),r.length>0&&e.codePointAt(e.length-1)===47&&(r+="/"),t?"/"+r:r}function oVe(e,t){let r="",n=0,o=-1,i=0,a=-1,s,l;for(;++a<=e.length;){if(a<e.length)s=e.codePointAt(a);else{if(s===47)break;s=47}if(s===47){if(!(o===a-1||i===1))if(o!==a-1&&i===2){if(r.length<2||n!==2||r.codePointAt(r.length-1)!==46||r.codePointAt(r.length-2)!==46){if(r.length>2){if(l=r.lastIndexOf("/"),l!==r.length-1){l<0?(r="",n=0):(r=r.slice(0,l),n=r.length-1-r.lastIndexOf("/")),o=a,i=0;continue}}else if(r.length>0){r="",n=0,o=a,i=0;continue}}t&&(r=r.length>0?r+"/..":"..",n=2)}else r.length>0?r+="/"+e.slice(o+1,a):r=e.slice(o+1,a),n=a-o-1;o=a,i=0}else s===46&&i>-1?i++:i=-1}return r}function i2(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}var jne={cwd:iVe};function iVe(){return"/"}function Y1(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function Wne(e){if(typeof e=="string")e=new URL(e);else if(!Y1(e)){let t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if(e.protocol!=="file:"){let t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return aVe(e)}function aVe(e){if(e.hostname!==""){let n=new TypeError('File URL host must be "localhost" or empty on darwin');throw n.code="ERR_INVALID_FILE_URL_HOST",n}let t=e.pathname,r=-1;for(;++r<t.length;)if(t.codePointAt(r)===37&&t.codePointAt(r+1)===50){let n=t.codePointAt(r+2);if(n===70||n===102){let o=new TypeError("File URL path must not include encoded / characters");throw o.code="ERR_INVALID_FILE_URL_PATH",o}}return decodeURIComponent(t)}var m5=["history","path","basename","stem","extname","dirname"],b0=class{constructor(t){let r;t?Y1(t)?r={path:t}:typeof t=="string"||sVe(t)?r={value:t}:r=t:r={},this.cwd=jne.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let n=-1;for(;++n<m5.length;){let i=m5[n];i in r&&r[i]!==void 0&&r[i]!==null&&(this[i]=i==="history"?[...r[i]]:r[i])}let o;for(o in r)m5.includes(o)||(this[o]=r[o])}get basename(){return typeof this.path=="string"?$p.basename(this.path):void 0}set basename(t){p5(t,"basename"),d5(t,"basename"),this.path=$p.join(this.dirname||"",t)}get dirname(){return typeof this.path=="string"?$p.dirname(this.path):void 0}set dirname(t){Xne(this.basename,"dirname"),this.path=$p.join(t||"",this.basename)}get extname(){return typeof this.path=="string"?$p.extname(this.path):void 0}set extname(t){if(d5(t,"extname"),Xne(this.dirname,"extname"),t){if(t.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=$p.join(this.dirname,this.stem+(t||""))}get path(){return this.history[this.history.length-1]}set path(t){Y1(t)&&(t=Wne(t)),p5(t,"path"),this.path!==t&&this.history.push(t)}get stem(){return typeof this.path=="string"?$p.basename(this.path,this.extname):void 0}set stem(t){p5(t,"stem"),d5(t,"stem"),this.path=$p.join(this.dirname||"",t+(this.extname||""))}fail(t,r,n){let o=this.message(t,r,n);throw o.fatal=!0,o}info(t,r,n){let o=this.message(t,r,n);return o.fatal=void 0,o}message(t,r,n){let o=new Os(t,r,n);return this.path&&(o.name=this.path+":"+o.name,o.file=this.path),o.fatal=!1,this.messages.push(o),o}toString(t){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(t||void 0).decode(this.value)}};function d5(e,t){if(e&&e.includes($p.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+$p.sep+"`")}function p5(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function Xne(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}function sVe(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}var Qne=function(e){let n=this.constructor.prototype,o=n[e],i=function(){return o.apply(i,arguments)};Object.setPrototypeOf(i,n);let a=Object.getOwnPropertyNames(o);for(let s of a){let l=Object.getOwnPropertyDescriptor(o,s);l&&Object.defineProperty(i,s,l)}return i};var lVe={}.hasOwnProperty,y5=class e extends Qne{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=Hne()}copy(){let t=new e,r=-1;for(;++r<this.attachers.length;){let n=this.attachers[r];t.use(...n)}return t.data((0,lE.default)(!0,{},this.namespace)),t}data(t,r){return typeof t=="string"?arguments.length===2?(g5("data",this.frozen),this.namespace[t]=r,this):lVe.call(this.namespace,t)&&this.namespace[t]||void 0:t?(g5("data",this.frozen),this.namespace=t,this):this.namespace}freeze(){if(this.frozen)return this;let t=this;for(;++this.freezeIndex<this.attachers.length;){let[r,...n]=this.attachers[this.freezeIndex];if(n[0]===!1)continue;n[0]===!0&&(n[0]=void 0);let o=r.call(t,...n);typeof o=="function"&&this.transformers.use(o)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(t){this.freeze();let r=sE(t),n=this.parser||this.Parser;return f5("parse",n),n(String(r),r)}process(t,r){let n=this;return this.freeze(),f5("process",this.parser||this.Parser),h5("process",this.compiler||this.Compiler),r?o(void 0,r):new Promise(o);function o(i,a){let s=sE(t),l=n.parse(s);n.run(l,s,function(c,m,d){if(c||!m||!d)return u(c);let p=m,h=n.stringify(p,d);cVe(h)?d.value=h:d.result=h,u(c,d)});function u(c,m){c||!m?a(c):i?i(m):r(void 0,m)}}}processSync(t){let r=!1,n;return this.freeze(),f5("processSync",this.parser||this.Parser),h5("processSync",this.compiler||this.Compiler),this.process(t,o),qne("processSync","process",r),n;function o(i,a){r=!0,c5(i),n=a}}run(t,r,n){Zne(t),this.freeze();let o=this.transformers;return!n&&typeof r=="function"&&(n=r,r=void 0),n?i(void 0,n):new Promise(i);function i(a,s){let l=sE(r);o.run(t,l,u);function u(c,m,d){let p=m||t;c?s(c):a?a(p):n(void 0,p,d)}}}runSync(t,r){let n=!1,o;return this.run(t,r,i),qne("runSync","run",n),o;function i(a,s){c5(a),o=s,n=!0}}stringify(t,r){this.freeze();let n=sE(r),o=this.compiler||this.Compiler;return h5("stringify",o),Zne(t),o(t,n)}use(t,...r){let n=this.attachers,o=this.namespace;if(g5("use",this.frozen),t!=null)if(typeof t=="function")l(t,r);else if(typeof t=="object")Array.isArray(t)?s(t):a(t);else throw new TypeError("Expected usable value, not `"+t+"`");return this;function i(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){let[c,...m]=u;l(c,m)}else a(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function a(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");s(u.plugins),u.settings&&(o.settings=(0,lE.default)(!0,o.settings,u.settings))}function s(u){let c=-1;if(u!=null)if(Array.isArray(u))for(;++c<u.length;){let m=u[c];i(m)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,c){let m=-1,d=-1;for(;++m<n.length;)if(n[m][0]===u){d=m;break}if(d===-1)n.push([u,...c]);else if(c.length>0){let[p,...h]=c,f=n[d][1];o2(f)&&o2(p)&&(p=(0,lE.default)(!0,f,p)),n[d]=[u,p,...h]}}}},b5=new y5().freeze();function f5(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function h5(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function g5(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Zne(e){if(!o2(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function qne(e,t,r){if(!r)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function sE(e){return uVe(e)?e:new b0(e)}function uVe(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function cVe(e){return typeof e=="string"||mVe(e)}function mVe(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}var dVe="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Yne=[],Kne={allowDangerousHtml:!0},pVe=/^(https?|ircs?|mailto|xmpp)$/i,fVe=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function a2(e){let t=hVe(e),r=gVe(e);return yVe(t.runSync(t.parse(r),r),e)}function hVe(e){let t=e.rehypePlugins||Yne,r=e.remarkPlugins||Yne,n=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...Kne}:Kne;return b5().use(Qw).use(r).use(iE,n).use(t)}function gVe(e){let t=e.children||"",r=new b0;return typeof t=="string"?r.value=t:(""+t,void 0),r}function yVe(e,t){let r=t.allowedElements,n=t.allowElement,o=t.components,i=t.disallowedElements,a=t.skipHtml,s=t.unwrapDisallowed,l=t.urlTransform||$ne;for(let c of fVe)Object.hasOwn(t,c.from)&&(""+c.from+(c.to?"use `"+c.to+"` instead":"remove it")+dVe+c.id,void 0);return r&&i&&void 0,y0(e,u),UN(e,{Fragment:K1.Fragment,components:o,ignoreInvalidStyle:!0,jsx:K1.jsx,jsxs:K1.jsxs,passKeys:!0,passNode:!0});function u(c,m,d){if(c.type==="raw"&&d&&typeof m=="number")return a?d.children.splice(m,1):d.children[m]={type:"text",value:c.value},m;if(c.type==="element"){let p;for(p in ZP)if(Object.hasOwn(ZP,p)&&Object.hasOwn(c.properties,p)){let h=c.properties[p],f=ZP[p];(f===null||f.includes(c.tagName))&&(c.properties[p]=l(String(h||""),p,c))}}if(c.type==="element"){let p=r?!r.includes(c.tagName):i?i.includes(c.tagName):!1;if(!p&&n&&typeof m=="number"&&(p=!n(c,m,d)),p&&d&&typeof m=="number")return s&&c.children?d.children.splice(m,1,...c.children):d.children.splice(m,1),m}}}function $ne(e){let t=e.indexOf(":"),r=e.indexOf("?"),n=e.indexOf("#"),o=e.indexOf("/");return t===-1||o!==-1&&t>o||r!==-1&&t>r||n!==-1&&t>n||pVe.test(e.slice(0,t))?e:""}function x5(e,t){let r=String(e);if(typeof t!="string")throw new TypeError("Expected character");let n=0,o=r.indexOf(t);for(;o!==-1;)n++,o=r.indexOf(t,o+t.length);return n}function C5(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function S5(e,t,r){let o=Nb((r||{}).ignore||[]),i=bVe(t),a=-1;for(;++a<i.length;)n2(e,"text",s);function s(u,c){let m=-1,d;for(;++m<c.length;){let p=c[m],h=d?d.children:void 0;if(o(p,h?h.indexOf(p):void 0,d))return;d=p}if(d)return l(u,c)}function l(u,c){let m=c[c.length-1],d=i[a][0],p=i[a][1],h=0,y=m.children.indexOf(u),g=!1,x=[];d.lastIndex=0;let S=d.exec(u.value);for(;S;){let I=S.index,v={index:S.index,input:S.input,stack:[...c,u]},A=p(...S,v);if(typeof A=="string"&&(A=A.length>0?{type:"text",value:A}:void 0),A===!1?d.lastIndex=I+1:(h!==I&&x.push({type:"text",value:u.value.slice(h,I)}),Array.isArray(A)?x.push(...A):A&&x.push(A),h=I+S[0].length,g=!0),!d.global)break;S=d.exec(u.value)}return g?(h<u.value.length&&x.push({type:"text",value:u.value.slice(h)}),m.children.splice(y,1,...x)):x=[u],y+x.length}}function bVe(e){let t=[];if(!Array.isArray(e))throw new TypeError("Expected find and replace tuple or list of tuples");let r=!e[0]||Array.isArray(e[0])?e:[e],n=-1;for(;++n<r.length;){let o=r[n];t.push([xVe(o[0]),CVe(o[1])])}return t}function xVe(e){return typeof e=="string"?new RegExp(C5(e),"g"):e}function CVe(e){return typeof e=="function"?e:function(){return e}}var v5="phrasing",I5=["autolink","link","image","label"];function T5(){return{transforms:[PVe],enter:{literalAutolink:SVe,literalAutolinkEmail:A5,literalAutolinkHttp:A5,literalAutolinkWww:A5},exit:{literalAutolink:TVe,literalAutolinkEmail:AVe,literalAutolinkHttp:vVe,literalAutolinkWww:IVe}}}function P5(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:v5,notInConstruct:I5},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:v5,notInConstruct:I5},{character:":",before:"[ps]",after:"\\/",inConstruct:v5,notInConstruct:I5}]}}function SVe(e){this.enter({type:"link",title:null,url:"",children:[]},e)}function A5(e){this.config.enter.autolinkProtocol.call(this,e)}function vVe(e){this.config.exit.autolinkProtocol.call(this,e)}function IVe(e){this.config.exit.data.call(this,e);let t=this.stack[this.stack.length-1];t.type,t.url="http://"+this.sliceSerialize(e)}function AVe(e){this.config.exit.autolinkEmail.call(this,e)}function TVe(e){this.exit(e)}function PVe(e){S5(e,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,_Ve],[/(?<=^|\s|\p{P}|\p{S})([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/gu,RVe]],{ignore:["link","linkReference"]})}function _Ve(e,t,r,n,o){let i="";if(!eoe(o)||(/^w/i.test(t)&&(r=t+r,t="",i="http://"),!DVe(r)))return!1;let a=wVe(r+n);if(!a[0])return!1;let s={type:"link",title:null,url:i+t+a[0],children:[{type:"text",value:t+a[0]}]};return a[1]?[s,{type:"text",value:a[1]}]:s}function RVe(e,t,r,n){return!eoe(n,!0)||/[-\d_]$/.test(r)?!1:{type:"link",title:null,url:"mailto:"+t+"@"+r,children:[{type:"text",value:t+"@"+r}]}}function DVe(e){let t=e.split(".");return!(t.length<2||t[t.length-1]&&(/_/.test(t[t.length-1])||!/[a-zA-Z\d]/.test(t[t.length-1]))||t[t.length-2]&&(/_/.test(t[t.length-2])||!/[a-zA-Z\d]/.test(t[t.length-2])))}function wVe(e){let t=/[!"&'),.:;<>?\]}]+$/.exec(e);if(!t)return[e,void 0];e=e.slice(0,t.index);let r=t[0],n=r.indexOf(")"),o=x5(e,"("),i=x5(e,")");for(;n!==-1&&o>i;)e+=r.slice(0,n+1),r=r.slice(n+1),n=r.indexOf(")"),i++;return[e,r]}function eoe(e,t){let r=e.input.charCodeAt(e.index-1);return(e.index===0||Jf(r)||d0(r))&&(!t||r!==47)}toe.peek=GVe;function EVe(){this.buffer()}function MVe(e){this.enter({type:"footnoteReference",identifier:"",label:""},e)}function BVe(){this.buffer()}function kVe(e){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},e)}function LVe(e){let t=this.resume(),r=this.stack[this.stack.length-1];r.type,r.identifier=ku(this.sliceSerialize(e)).toLowerCase(),r.label=t}function FVe(e){this.exit(e)}function VVe(e){let t=this.resume(),r=this.stack[this.stack.length-1];r.type,r.identifier=ku(this.sliceSerialize(e)).toLowerCase(),r.label=t}function OVe(e){this.exit(e)}function GVe(){return"["}function toe(e,t,r,n){let o=r.createTracker(n),i=o.move("[^"),a=r.enter("footnoteReference"),s=r.enter("reference");return i+=o.move(r.safe(r.associationId(e),{after:"]",before:i})),s(),a(),i+=o.move("]"),i}function _5(){return{enter:{gfmFootnoteCallString:EVe,gfmFootnoteCall:MVe,gfmFootnoteDefinitionLabelString:BVe,gfmFootnoteDefinition:kVe},exit:{gfmFootnoteCallString:LVe,gfmFootnoteCall:FVe,gfmFootnoteDefinitionLabelString:VVe,gfmFootnoteDefinition:OVe}}}function R5(e){let t=!1;return e&&e.firstLineBlank&&(t=!0),{handlers:{footnoteDefinition:r,footnoteReference:toe},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function r(n,o,i,a){let s=i.createTracker(a),l=s.move("[^"),u=i.enter("footnoteDefinition"),c=i.enter("label");return l+=s.move(i.safe(i.associationId(n),{before:l,after:"]"})),c(),l+=s.move("]:"),n.children&&n.children.length>0&&(s.shift(4),l+=s.move((t?`
`:" ")+i.indentLines(i.containerFlow(n,s.current()),t?roe:UVe))),u(),l}}function UVe(e,t,r){return t===0?e:roe(e,t,r)}function roe(e,t,r){return(r?"":"    ")+e}var NVe=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];noe.peek=jVe;function D5(){return{canContainEols:["delete"],enter:{strikethrough:zVe},exit:{strikethrough:HVe}}}function w5(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:NVe}],handlers:{delete:noe}}}function zVe(e){this.enter({type:"delete",children:[]},e)}function HVe(e){this.exit(e)}function noe(e,t,r,n){let o=r.createTracker(n),i=r.enter("strikethrough"),a=o.move("~~");return a+=r.containerPhrasing(e,{...o.current(),before:a,after:"~"}),a+=o.move("~~"),i(),a}function jVe(){return"~"}function WVe(e){return e.length}function ioe(e,t){let r=t||{},n=(r.align||[]).concat(),o=r.stringLength||WVe,i=[],a=[],s=[],l=[],u=0,c=-1;for(;++c<e.length;){let f=[],y=[],g=-1;for(e[c].length>u&&(u=e[c].length);++g<e[c].length;){let x=XVe(e[c][g]);if(r.alignDelimiters!==!1){let S=o(x);y[g]=S,(l[g]===void 0||S>l[g])&&(l[g]=S)}f.push(x)}a[c]=f,s[c]=y}let m=-1;if(typeof n=="object"&&"length"in n)for(;++m<u;)i[m]=ooe(n[m]);else{let f=ooe(n);for(;++m<u;)i[m]=f}m=-1;let d=[],p=[];for(;++m<u;){let f=i[m],y="",g="";f===99?(y=":",g=":"):f===108?y=":":f===114&&(g=":");let x=r.alignDelimiters===!1?1:Math.max(1,l[m]-y.length-g.length),S=y+"-".repeat(x)+g;r.alignDelimiters!==!1&&(x=y.length+x+g.length,x>l[m]&&(l[m]=x),p[m]=x),d[m]=S}a.splice(1,0,d),s.splice(1,0,p),c=-1;let h=[];for(;++c<a.length;){let f=a[c],y=s[c];m=-1;let g=[];for(;++m<u;){let x=f[m]||"",S="",I="";if(r.alignDelimiters!==!1){let v=l[m]-(y[m]||0),A=i[m];A===114?S=" ".repeat(v):A===99?v%2?(S=" ".repeat(v/2+.5),I=" ".repeat(v/2-.5)):(S=" ".repeat(v/2),I=S):I=" ".repeat(v)}r.delimiterStart!==!1&&!m&&g.push("|"),r.padding!==!1&&!(r.alignDelimiters===!1&&x==="")&&(r.delimiterStart!==!1||m)&&g.push(" "),r.alignDelimiters!==!1&&g.push(S),g.push(x),r.alignDelimiters!==!1&&g.push(I),r.padding!==!1&&g.push(" "),(r.delimiterEnd!==!1||m!==u-1)&&g.push("|")}h.push(r.delimiterEnd===!1?g.join("").replace(/ +$/,""):g.join(""))}return h.join(`
`)}function XVe(e){return e==null?"":String(e)}function ooe(e){let t=typeof e=="string"?e.codePointAt(0):0;return t===67||t===99?99:t===76||t===108?108:t===82||t===114?114:0}function aoe(e,t,r,n){let o=r.enter("blockquote"),i=r.createTracker(n);i.move("> "),i.shift(2);let a=r.indentLines(r.containerFlow(e,i.current()),QVe);return o(),a}function QVe(e,t,r){return">"+(r?"":" ")+e}function loe(e,t){return soe(e,t.inConstruct,!0)&&!soe(e,t.notInConstruct,!1)}function soe(e,t,r){if(typeof t=="string"&&(t=[t]),!t||t.length===0)return r;let n=-1;for(;++n<t.length;)if(e.includes(t[n]))return!0;return!1}function E5(e,t,r,n){let o=-1;for(;++o<r.unsafe.length;)if(r.unsafe[o].character===`
`&&loe(r.stack,r.unsafe[o]))return/[ \t]/.test(n.before)?"":" ";return`\\
`}function uoe(e,t){let r=String(e),n=r.indexOf(t),o=n,i=0,a=0;if(typeof t!="string")throw new TypeError("Expected substring");for(;n!==-1;)n===o?++i>a&&(a=i):i=1,o=n+t.length,n=r.indexOf(t,o);return a}function coe(e,t){return!!(t.options.fences===!1&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}function moe(e){let t=e.options.fence||"`";if(t!=="`"&&t!=="~")throw new Error("Cannot serialize code with `"+t+"` for `options.fence`, expected `` ` `` or `~`");return t}function doe(e,t,r,n){let o=moe(r),i=e.value||"",a=o==="`"?"GraveAccent":"Tilde";if(coe(e,r)){let m=r.enter("codeIndented"),d=r.indentLines(i,ZVe);return m(),d}let s=r.createTracker(n),l=o.repeat(Math.max(uoe(i,o)+1,3)),u=r.enter("codeFenced"),c=s.move(l);if(e.lang){let m=r.enter(`codeFencedLang${a}`);c+=s.move(r.safe(e.lang,{before:c,after:" ",encode:["`"],...s.current()})),m()}if(e.lang&&e.meta){let m=r.enter(`codeFencedMeta${a}`);c+=s.move(" "),c+=s.move(r.safe(e.meta,{before:c,after:`
`,encode:["`"],...s.current()})),m()}return c+=s.move(`
`),i&&(c+=s.move(i+`
`)),c+=s.move(l),u(),c}function ZVe(e,t,r){return(r?"":"    ")+e}function J1(e){let t=e.options.quote||'"';if(t!=='"'&&t!=="'")throw new Error("Cannot serialize title with `"+t+"` for `options.quote`, expected `\"`, or `'`");return t}function poe(e,t,r,n){let o=J1(r),i=o==='"'?"Quote":"Apostrophe",a=r.enter("definition"),s=r.enter("label"),l=r.createTracker(n),u=l.move("[");return u+=l.move(r.safe(r.associationId(e),{before:u,after:"]",...l.current()})),u+=l.move("]: "),s(),!e.url||/[\0- \u007F]/.test(e.url)?(s=r.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(r.safe(e.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(s=r.enter("destinationRaw"),u+=l.move(r.safe(e.url,{before:u,after:e.title?" ":`
`,...l.current()}))),s(),e.title&&(s=r.enter(`title${i}`),u+=l.move(" "+o),u+=l.move(r.safe(e.title,{before:u,after:o,...l.current()})),u+=l.move(o),s()),a(),u}function foe(e){let t=e.options.emphasis||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize emphasis with `"+t+"` for `options.emphasis`, expected `*`, or `_`");return t}function zb(e){return"&#x"+e.toString(16).toUpperCase()+";"}function $1(e,t,r){let n=Yg(e),o=Yg(t);return n===void 0?o===void 0?r==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:o===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:n===1?o===void 0?{inside:!1,outside:!1}:o===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:o===void 0?{inside:!1,outside:!1}:o===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}M5.peek=qVe;function M5(e,t,r,n){let o=foe(r),i=r.enter("emphasis"),a=r.createTracker(n),s=a.move(o),l=a.move(r.containerPhrasing(e,{after:o,before:s,...a.current()})),u=l.charCodeAt(0),c=$1(n.before.charCodeAt(n.before.length-1),u,o);c.inside&&(l=zb(u)+l.slice(1));let m=l.charCodeAt(l.length-1),d=$1(n.after.charCodeAt(0),m,o);d.inside&&(l=l.slice(0,-1)+zb(m));let p=a.move(o);return i(),r.attentionEncodeSurroundingInfo={after:d.outside,before:c.outside},s+l+p}function qVe(e,t,r){return r.options.emphasis||"*"}function hoe(e,t){let r=!1;return y0(e,function(n){if("value"in n&&/\r?\n|\r/.test(n.value)||n.type==="break")return r=!0,g0}),!!((!e.depth||e.depth<3)&&c0(e)&&(t.options.setext||r))}function goe(e,t,r,n){let o=Math.max(Math.min(6,e.depth||1),1),i=r.createTracker(n);if(hoe(e,r)){let c=r.enter("headingSetext"),m=r.enter("phrasing"),d=r.containerPhrasing(e,{...i.current(),before:`
`,after:`
`});return m(),c(),d+`
`+(o===1?"=":"-").repeat(d.length-(Math.max(d.lastIndexOf("\r"),d.lastIndexOf(`
`))+1))}let a="#".repeat(o),s=r.enter("headingAtx"),l=r.enter("phrasing");i.move(a+" ");let u=r.containerPhrasing(e,{before:"# ",after:`
`,...i.current()});return/^[\t ]/.test(u)&&(u=zb(u.charCodeAt(0))+u.slice(1)),u=u?a+" "+u:a,r.options.closeAtx&&(u+=" "+a),l(),s(),u}B5.peek=YVe;function B5(e){return e.value||""}function YVe(){return"<"}k5.peek=KVe;function k5(e,t,r,n){let o=J1(r),i=o==='"'?"Quote":"Apostrophe",a=r.enter("image"),s=r.enter("label"),l=r.createTracker(n),u=l.move("![");return u+=l.move(r.safe(e.alt,{before:u,after:"]",...l.current()})),u+=l.move("]("),s(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(s=r.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(r.safe(e.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(s=r.enter("destinationRaw"),u+=l.move(r.safe(e.url,{before:u,after:e.title?" ":")",...l.current()}))),s(),e.title&&(s=r.enter(`title${i}`),u+=l.move(" "+o),u+=l.move(r.safe(e.title,{before:u,after:o,...l.current()})),u+=l.move(o),s()),u+=l.move(")"),a(),u}function KVe(){return"!"}L5.peek=JVe;function L5(e,t,r,n){let o=e.referenceType,i=r.enter("imageReference"),a=r.enter("label"),s=r.createTracker(n),l=s.move("!["),u=r.safe(e.alt,{before:l,after:"]",...s.current()});l+=s.move(u+"]["),a();let c=r.stack;r.stack=[],a=r.enter("reference");let m=r.safe(r.associationId(e),{before:l,after:"]",...s.current()});return a(),r.stack=c,i(),o==="full"||!u||u!==m?l+=s.move(m+"]"):o==="shortcut"?l=l.slice(0,-1):l+=s.move("]"),l}function JVe(){return"!"}F5.peek=$Ve;function F5(e,t,r){let n=e.value||"",o="`",i=-1;for(;new RegExp("(^|[^`])"+o+"([^`]|$)").test(n);)o+="`";for(/[^ \r\n]/.test(n)&&(/^[ \r\n]/.test(n)&&/[ \r\n]$/.test(n)||/^`|`$/.test(n))&&(n=" "+n+" ");++i<r.unsafe.length;){let a=r.unsafe[i],s=r.compilePattern(a),l;if(a.atBreak)for(;l=s.exec(n);){let u=l.index;n.charCodeAt(u)===10&&n.charCodeAt(u-1)===13&&u--,n=n.slice(0,u)+" "+n.slice(l.index+1)}}return o+n+o}function $Ve(){return"`"}function V5(e,t){let r=c0(e);return!!(!t.options.resourceLink&&e.url&&!e.title&&e.children&&e.children.length===1&&e.children[0].type==="text"&&(r===e.url||"mailto:"+r===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}O5.peek=eOe;function O5(e,t,r,n){let o=J1(r),i=o==='"'?"Quote":"Apostrophe",a=r.createTracker(n),s,l;if(V5(e,r)){let c=r.stack;r.stack=[],s=r.enter("autolink");let m=a.move("<");return m+=a.move(r.containerPhrasing(e,{before:m,after:">",...a.current()})),m+=a.move(">"),s(),r.stack=c,m}s=r.enter("link"),l=r.enter("label");let u=a.move("[");return u+=a.move(r.containerPhrasing(e,{before:u,after:"](",...a.current()})),u+=a.move("]("),l(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(l=r.enter("destinationLiteral"),u+=a.move("<"),u+=a.move(r.safe(e.url,{before:u,after:">",...a.current()})),u+=a.move(">")):(l=r.enter("destinationRaw"),u+=a.move(r.safe(e.url,{before:u,after:e.title?" ":")",...a.current()}))),l(),e.title&&(l=r.enter(`title${i}`),u+=a.move(" "+o),u+=a.move(r.safe(e.title,{before:u,after:o,...a.current()})),u+=a.move(o),l()),u+=a.move(")"),s(),u}function eOe(e,t,r){return V5(e,r)?"<":"["}G5.peek=tOe;function G5(e,t,r,n){let o=e.referenceType,i=r.enter("linkReference"),a=r.enter("label"),s=r.createTracker(n),l=s.move("["),u=r.containerPhrasing(e,{before:l,after:"]",...s.current()});l+=s.move(u+"]["),a();let c=r.stack;r.stack=[],a=r.enter("reference");let m=r.safe(r.associationId(e),{before:l,after:"]",...s.current()});return a(),r.stack=c,i(),o==="full"||!u||u!==m?l+=s.move(m+"]"):o==="shortcut"?l=l.slice(0,-1):l+=s.move("]"),l}function tOe(){return"["}function ev(e){let t=e.options.bullet||"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bullet`, expected `*`, `+`, or `-`");return t}function yoe(e){let t=ev(e),r=e.options.bulletOther;if(!r)return t==="*"?"-":"*";if(r!=="*"&&r!=="+"&&r!=="-")throw new Error("Cannot serialize items with `"+r+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(r===t)throw new Error("Expected `bullet` (`"+t+"`) and `bulletOther` (`"+r+"`) to be different");return r}function boe(e){let t=e.options.bulletOrdered||".";if(t!=="."&&t!==")")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOrdered`, expected `.` or `)`");return t}function uE(e){let t=e.options.rule||"*";if(t!=="*"&&t!=="-"&&t!=="_")throw new Error("Cannot serialize rules with `"+t+"` for `options.rule`, expected `*`, `-`, or `_`");return t}function xoe(e,t,r,n){let o=r.enter("list"),i=r.bulletCurrent,a=e.ordered?boe(r):ev(r),s=e.ordered?a==="."?")":".":yoe(r),l=t&&r.bulletLastUsed?a===r.bulletLastUsed:!1;if(!e.ordered){let c=e.children?e.children[0]:void 0;if((a==="*"||a==="-")&&c&&(!c.children||!c.children[0])&&r.stack[r.stack.length-1]==="list"&&r.stack[r.stack.length-2]==="listItem"&&r.stack[r.stack.length-3]==="list"&&r.stack[r.stack.length-4]==="listItem"&&r.indexStack[r.indexStack.length-1]===0&&r.indexStack[r.indexStack.length-2]===0&&r.indexStack[r.indexStack.length-3]===0&&(l=!0),uE(r)===a&&c){let m=-1;for(;++m<e.children.length;){let d=e.children[m];if(d&&d.type==="listItem"&&d.children&&d.children[0]&&d.children[0].type==="thematicBreak"){l=!0;break}}}}l&&(a=s),r.bulletCurrent=a;let u=r.containerFlow(e,n);return r.bulletLastUsed=a,r.bulletCurrent=i,o(),u}function Coe(e){let t=e.options.listItemIndent||"one";if(t!=="tab"&&t!=="one"&&t!=="mixed")throw new Error("Cannot serialize items with `"+t+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return t}function Soe(e,t,r,n){let o=Coe(r),i=r.bulletCurrent||ev(r);t&&t.type==="list"&&t.ordered&&(i=(typeof t.start=="number"&&t.start>-1?t.start:1)+(r.options.incrementListMarker===!1?0:t.children.indexOf(e))+i);let a=i.length+1;(o==="tab"||o==="mixed"&&(t&&t.type==="list"&&t.spread||e.spread))&&(a=Math.ceil(a/4)*4);let s=r.createTracker(n);s.move(i+" ".repeat(a-i.length)),s.shift(a);let l=r.enter("listItem"),u=r.indentLines(r.containerFlow(e,s.current()),c);return l(),u;function c(m,d,p){return d?(p?"":" ".repeat(a))+m:(p?i:i+" ".repeat(a-i.length))+m}}function voe(e,t,r,n){let o=r.enter("paragraph"),i=r.enter("phrasing"),a=r.containerPhrasing(e,n);return i(),o(),a}var U5=Nb(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function Ioe(e,t,r,n){return(e.children.some(function(a){return U5(a)})?r.containerPhrasing:r.containerFlow).call(r,e,n)}function Aoe(e){let t=e.options.strong||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize strong with `"+t+"` for `options.strong`, expected `*`, or `_`");return t}N5.peek=rOe;function N5(e,t,r,n){let o=Aoe(r),i=r.enter("strong"),a=r.createTracker(n),s=a.move(o+o),l=a.move(r.containerPhrasing(e,{after:o,before:s,...a.current()})),u=l.charCodeAt(0),c=$1(n.before.charCodeAt(n.before.length-1),u,o);c.inside&&(l=zb(u)+l.slice(1));let m=l.charCodeAt(l.length-1),d=$1(n.after.charCodeAt(0),m,o);d.inside&&(l=l.slice(0,-1)+zb(m));let p=a.move(o+o);return i(),r.attentionEncodeSurroundingInfo={after:d.outside,before:c.outside},s+l+p}function rOe(e,t,r){return r.options.strong||"*"}function Toe(e,t,r,n){return r.safe(e.value,n)}function Poe(e){let t=e.options.ruleRepetition||3;if(t<3)throw new Error("Cannot serialize rules with repetition `"+t+"` for `options.ruleRepetition`, expected `3` or more");return t}function _oe(e,t,r){let n=(uE(r)+(r.options.ruleSpaces?" ":"")).repeat(Poe(r));return r.options.ruleSpaces?n.slice(0,-1):n}var s2={blockquote:aoe,break:E5,code:doe,definition:poe,emphasis:M5,hardBreak:E5,heading:goe,html:B5,image:k5,imageReference:L5,inlineCode:F5,link:O5,linkReference:G5,list:xoe,listItem:Soe,paragraph:voe,root:Ioe,strong:N5,text:Toe,thematicBreak:_oe};function H5(){return{enter:{table:nOe,tableData:Roe,tableHeader:Roe,tableRow:iOe},exit:{codeText:aOe,table:oOe,tableData:z5,tableHeader:z5,tableRow:z5}}}function nOe(e){let t=e._align;this.enter({type:"table",align:t.map(function(r){return r==="none"?null:r}),children:[]},e),this.data.inTable=!0}function oOe(e){this.exit(e),this.data.inTable=void 0}function iOe(e){this.enter({type:"tableRow",children:[]},e)}function z5(e){this.exit(e)}function Roe(e){this.enter({type:"tableCell",children:[]},e)}function aOe(e){let t=this.resume();this.data.inTable&&(t=t.replace(/\\([\\|])/g,sOe));let r=this.stack[this.stack.length-1];r.type,r.value=t,this.exit(e)}function sOe(e,t){return t==="|"?t:e}function j5(e){let t=e||{},r=t.tableCellPadding,n=t.tablePipeAlign,o=t.stringLength,i=r?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:d,table:a,tableCell:l,tableRow:s}};function a(p,h,f,y){return u(c(p,f,y),p.align)}function s(p,h,f,y){let g=m(p,f,y),x=u([g]);return x.slice(0,x.indexOf(`
`))}function l(p,h,f,y){let g=f.enter("tableCell"),x=f.enter("phrasing"),S=f.containerPhrasing(p,{...y,before:i,after:i});return x(),g(),S}function u(p,h){return ioe(p,{align:h,alignDelimiters:n,padding:r,stringLength:o})}function c(p,h,f){let y=p.children,g=-1,x=[],S=h.enter("table");for(;++g<y.length;)x[g]=m(y[g],h,f);return S(),x}function m(p,h,f){let y=p.children,g=-1,x=[],S=h.enter("tableRow");for(;++g<y.length;)x[g]=l(y[g],p,h,f);return S(),x}function d(p,h,f){let y=s2.inlineCode(p,h,f);return f.stack.includes("tableCell")&&(y=y.replace(/\|/g,"\\$&")),y}}function W5(){return{exit:{taskListCheckValueChecked:Doe,taskListCheckValueUnchecked:Doe,paragraph:lOe}}}function X5(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:uOe}}}function Doe(e){let t=this.stack[this.stack.length-2];t.type,t.checked=e.type==="taskListCheckValueChecked"}function lOe(e){let t=this.stack[this.stack.length-2];if(t&&t.type==="listItem"&&typeof t.checked=="boolean"){let r=this.stack[this.stack.length-1];r.type;let n=r.children[0];if(n&&n.type==="text"){let o=t.children,i=-1,a;for(;++i<o.length;){let s=o[i];if(s.type==="paragraph"){a=s;break}}a===r&&(n.value=n.value.slice(1),n.value.length===0?r.children.shift():r.position&&n.position&&typeof n.position.start.offset=="number"&&(n.position.start.column++,n.position.start.offset++,r.position.start=Object.assign({},n.position.start)))}}this.exit(e)}function uOe(e,t,r,n){let o=e.children[0],i=typeof e.checked=="boolean"&&o&&o.type==="paragraph",a="["+(e.checked?"x":" ")+"] ",s=r.createTracker(n);i&&s.move(a);let l=s2.listItem(e,t,r,{...n,...s.current()});return i&&(l=l.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,u)),l;function u(c){return c+a}}function Q5(){return[T5(),_5(),D5(),H5(),W5()]}function Z5(e){return{extensions:[P5(),R5(e),w5(),j5(e),X5()]}}var cOe={tokenize:hOe,partial:!0},woe={tokenize:gOe,partial:!0},Eoe={tokenize:yOe,partial:!0},Moe={tokenize:bOe,partial:!0},mOe={tokenize:xOe,partial:!0},Boe={name:"wwwAutolink",tokenize:pOe,previous:Loe},koe={name:"protocolAutolink",tokenize:fOe,previous:Foe},Kg={name:"emailAutolink",tokenize:dOe,previous:Voe},eh={};function Y5(){return{text:eh}}var x0=48;for(;x0<123;)eh[x0]=Kg,x0++,x0===58?x0=65:x0===91&&(x0=97);eh[43]=Kg;eh[45]=Kg;eh[46]=Kg;eh[95]=Kg;eh[72]=[Kg,koe];eh[104]=[Kg,koe];eh[87]=[Kg,Boe];eh[119]=[Kg,Boe];function dOe(e,t,r){let n=this,o,i;return a;function a(m){return!q5(m)||!Voe.call(n,n.previous)||K5(n.events)?r(m):(e.enter("literalAutolink"),e.enter("literalAutolinkEmail"),s(m))}function s(m){return q5(m)?(e.consume(m),s):m===64?(e.consume(m),l):r(m)}function l(m){return m===46?e.check(mOe,c,u)(m):m===45||m===95||es(m)?(i=!0,e.consume(m),l):c(m)}function u(m){return e.consume(m),o=!0,l}function c(m){return i&&o&&sl(n.previous)?(e.exit("literalAutolinkEmail"),e.exit("literalAutolink"),t(m)):r(m)}}function pOe(e,t,r){let n=this;return o;function o(a){return a!==87&&a!==119||!Loe.call(n,n.previous)||K5(n.events)?r(a):(e.enter("literalAutolink"),e.enter("literalAutolinkWww"),e.check(cOe,e.attempt(woe,e.attempt(Eoe,i),r),r)(a))}function i(a){return e.exit("literalAutolinkWww"),e.exit("literalAutolink"),t(a)}}function fOe(e,t,r){let n=this,o="",i=!1;return a;function a(m){return(m===72||m===104)&&Foe.call(n,n.previous)&&!K5(n.events)?(e.enter("literalAutolink"),e.enter("literalAutolinkHttp"),o+=String.fromCodePoint(m),e.consume(m),s):r(m)}function s(m){if(sl(m)&&o.length<5)return o+=String.fromCodePoint(m),e.consume(m),s;if(m===58){let d=o.toLowerCase();if(d==="http"||d==="https")return e.consume(m),l}return r(m)}function l(m){return m===47?(e.consume(m),i?u:(i=!0,l)):r(m)}function u(m){return m===null||m0(m)||ao(m)||Jf(m)||d0(m)?r(m):e.attempt(woe,e.attempt(Eoe,c),r)(m)}function c(m){return e.exit("literalAutolinkHttp"),e.exit("literalAutolink"),t(m)}}function hOe(e,t,r){let n=0;return o;function o(a){return(a===87||a===119)&&n<3?(n++,e.consume(a),o):a===46&&n===3?(e.consume(a),i):r(a)}function i(a){return a===null?r(a):t(a)}}function gOe(e,t,r){let n,o,i;return a;function a(u){return u===46||u===95?e.check(Moe,l,s)(u):u===null||ao(u)||Jf(u)||u!==45&&d0(u)?l(u):(i=!0,e.consume(u),a)}function s(u){return u===95?n=!0:(o=n,n=void 0),e.consume(u),a}function l(u){return o||n||!i?r(u):t(u)}}function yOe(e,t){let r=0,n=0;return o;function o(a){return a===40?(r++,e.consume(a),o):a===41&&n<r?i(a):a===33||a===34||a===38||a===39||a===41||a===42||a===44||a===46||a===58||a===59||a===60||a===63||a===93||a===95||a===126?e.check(Moe,t,i)(a):a===null||ao(a)||Jf(a)?t(a):(e.consume(a),o)}function i(a){return a===41&&n++,e.consume(a),o}}function bOe(e,t,r){return n;function n(s){return s===33||s===34||s===39||s===41||s===42||s===44||s===46||s===58||s===59||s===63||s===95||s===126?(e.consume(s),n):s===38?(e.consume(s),i):s===93?(e.consume(s),o):s===60||s===null||ao(s)||Jf(s)?t(s):r(s)}function o(s){return s===null||s===40||s===91||ao(s)||Jf(s)?t(s):n(s)}function i(s){return sl(s)?a(s):r(s)}function a(s){return s===59?(e.consume(s),n):sl(s)?(e.consume(s),a):r(s)}}function xOe(e,t,r){return n;function n(i){return e.consume(i),o}function o(i){return es(i)?r(i):t(i)}}function Loe(e){return e===null||e===40||e===42||e===95||e===91||e===93||e===126||ao(e)}function Foe(e){return!sl(e)}function Voe(e){return!(e===47||q5(e))}function q5(e){return e===43||e===45||e===46||e===95||es(e)}function K5(e){let t=e.length,r=!1;for(;t--;){let n=e[t][1];if((n.type==="labelLink"||n.type==="labelImage")&&!n._balanced){r=!0;break}if(n._gfmAutolinkLiteralWalkedInto){r=!1;break}}return e.length>0&&!r&&(e[e.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),r}var COe={tokenize:_Oe,partial:!0};function J5(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:AOe,continuation:{tokenize:TOe},exit:POe}},text:{91:{name:"gfmFootnoteCall",tokenize:IOe},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:SOe,resolveTo:vOe}}}}function SOe(e,t,r){let n=this,o=n.events.length,i=n.parser.gfmFootnotes||(n.parser.gfmFootnotes=[]),a;for(;o--;){let l=n.events[o][1];if(l.type==="labelImage"){a=l;break}if(l.type==="gfmFootnoteCall"||l.type==="labelLink"||l.type==="label"||l.type==="image"||l.type==="link")break}return s;function s(l){if(!a||!a._balanced)return r(l);let u=ku(n.sliceSerialize({start:a.end,end:n.now()}));return u.codePointAt(0)!==94||!i.includes(u.slice(1))?r(l):(e.enter("gfmFootnoteCallLabelMarker"),e.consume(l),e.exit("gfmFootnoteCallLabelMarker"),t(l))}}function vOe(e,t){let r=e.length,n;for(;r--;)if(e[r][1].type==="labelImage"&&e[r][0]==="enter"){n=e[r][1];break}e[r+1][1].type="data",e[r+3][1].type="gfmFootnoteCallLabelMarker";let o={type:"gfmFootnoteCall",start:Object.assign({},e[r+3][1].start),end:Object.assign({},e[e.length-1][1].end)},i={type:"gfmFootnoteCallMarker",start:Object.assign({},e[r+3][1].end),end:Object.assign({},e[r+3][1].end)};i.end.column++,i.end.offset++,i.end._bufferIndex++;let a={type:"gfmFootnoteCallString",start:Object.assign({},i.end),end:Object.assign({},e[e.length-1][1].start)},s={type:"chunkString",contentType:"string",start:Object.assign({},a.start),end:Object.assign({},a.end)},l=[e[r+1],e[r+2],["enter",o,t],e[r+3],e[r+4],["enter",i,t],["exit",i,t],["enter",a,t],["enter",s,t],["exit",s,t],["exit",a,t],e[e.length-2],e[e.length-1],["exit",o,t]];return e.splice(r,e.length-r+1,...l),e}function IOe(e,t,r){let n=this,o=n.parser.gfmFootnotes||(n.parser.gfmFootnotes=[]),i=0,a;return s;function s(m){return e.enter("gfmFootnoteCall"),e.enter("gfmFootnoteCallLabelMarker"),e.consume(m),e.exit("gfmFootnoteCallLabelMarker"),l}function l(m){return m!==94?r(m):(e.enter("gfmFootnoteCallMarker"),e.consume(m),e.exit("gfmFootnoteCallMarker"),e.enter("gfmFootnoteCallString"),e.enter("chunkString").contentType="string",u)}function u(m){if(i>999||m===93&&!a||m===null||m===91||ao(m))return r(m);if(m===93){e.exit("chunkString");let d=e.exit("gfmFootnoteCallString");return o.includes(ku(n.sliceSerialize(d)))?(e.enter("gfmFootnoteCallLabelMarker"),e.consume(m),e.exit("gfmFootnoteCallLabelMarker"),e.exit("gfmFootnoteCall"),t):r(m)}return ao(m)||(a=!0),i++,e.consume(m),m===92?c:u}function c(m){return m===91||m===92||m===93?(e.consume(m),i++,u):u(m)}}function AOe(e,t,r){let n=this,o=n.parser.gfmFootnotes||(n.parser.gfmFootnotes=[]),i,a=0,s;return l;function l(h){return e.enter("gfmFootnoteDefinition")._container=!0,e.enter("gfmFootnoteDefinitionLabel"),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(h),e.exit("gfmFootnoteDefinitionLabelMarker"),u}function u(h){return h===94?(e.enter("gfmFootnoteDefinitionMarker"),e.consume(h),e.exit("gfmFootnoteDefinitionMarker"),e.enter("gfmFootnoteDefinitionLabelString"),e.enter("chunkString").contentType="string",c):r(h)}function c(h){if(a>999||h===93&&!s||h===null||h===91||ao(h))return r(h);if(h===93){e.exit("chunkString");let f=e.exit("gfmFootnoteDefinitionLabelString");return i=ku(n.sliceSerialize(f)),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(h),e.exit("gfmFootnoteDefinitionLabelMarker"),e.exit("gfmFootnoteDefinitionLabel"),d}return ao(h)||(s=!0),a++,e.consume(h),h===92?m:c}function m(h){return h===91||h===92||h===93?(e.consume(h),a++,c):c(h)}function d(h){return h===58?(e.enter("definitionMarker"),e.consume(h),e.exit("definitionMarker"),o.includes(i)||o.push(i),tn(e,p,"gfmFootnoteDefinitionWhitespace")):r(h)}function p(h){return t(h)}}function TOe(e,t,r){return e.check($f,t,e.attempt(COe,t,r))}function POe(e){e.exit("gfmFootnoteDefinition")}function _Oe(e,t,r){let n=this;return tn(e,o,"gfmFootnoteDefinitionIndent",5);function o(i){let a=n.events[n.events.length-1];return a&&a[1].type==="gfmFootnoteDefinitionIndent"&&a[2].sliceSerialize(a[1],!0).length===4?t(i):r(i)}}function $5(e){let r=(e||{}).singleTilde,n={name:"strikethrough",tokenize:i,resolveAll:o};return r==null&&(r=!0),{text:{126:n},insideSpan:{null:[n]},attentionMarkers:{null:[126]}};function o(a,s){let l=-1;for(;++l<a.length;)if(a[l][0]==="enter"&&a[l][1].type==="strikethroughSequenceTemporary"&&a[l][1]._close){let u=l;for(;u--;)if(a[u][0]==="exit"&&a[u][1].type==="strikethroughSequenceTemporary"&&a[u][1]._open&&a[l][1].end.offset-a[l][1].start.offset===a[u][1].end.offset-a[u][1].start.offset){a[l][1].type="strikethroughSequence",a[u][1].type="strikethroughSequence";let c={type:"strikethrough",start:Object.assign({},a[u][1].start),end:Object.assign({},a[l][1].end)},m={type:"strikethroughText",start:Object.assign({},a[u][1].end),end:Object.assign({},a[l][1].start)},d=[["enter",c,s],["enter",a[u][1],s],["exit",a[u][1],s],["enter",m,s]],p=s.parser.constructs.insideSpan.null;p&&Cs(d,d.length,0,Gb(p,a.slice(u+1,l),s)),Cs(d,d.length,0,[["exit",m,s],["enter",a[l][1],s],["exit",a[l][1],s],["exit",c,s]]),Cs(a,u-1,l-u+3,d),l=u+d.length-2;break}}for(l=-1;++l<a.length;)a[l][1].type==="strikethroughSequenceTemporary"&&(a[l][1].type="data");return a}function i(a,s,l){let u=this.previous,c=this.events,m=0;return d;function d(h){return u===126&&c[c.length-1][1].type!=="characterEscape"?l(h):(a.enter("strikethroughSequenceTemporary"),p(h))}function p(h){let f=Yg(u);if(h===126)return m>1?l(h):(a.consume(h),m++,p);if(m<2&&!r)return l(h);let y=a.exit("strikethroughSequenceTemporary"),g=Yg(h);return y._open=!g||g===2&&!!f,y._close=!f||f===2&&!!g,s(h)}}}var cE=class{constructor(){this.map=[]}add(t,r,n){ROe(this,t,r,n)}consume(t){if(this.map.sort(function(i,a){return i[0]-a[0]}),this.map.length===0)return;let r=this.map.length,n=[];for(;r>0;)r-=1,n.push(t.slice(this.map[r][0]+this.map[r][1]),this.map[r][2]),t.length=this.map[r][0];n.push(t.slice()),t.length=0;let o=n.pop();for(;o;){for(let i of o)t.push(i);o=n.pop()}this.map.length=0}};function ROe(e,t,r,n){let o=0;if(!(r===0&&n.length===0)){for(;o<e.map.length;){if(e.map[o][0]===t){e.map[o][1]+=r,e.map[o][2].push(...n);return}o+=1}e.map.push([t,r,n])}}function Ooe(e,t){let r=!1,n=[];for(;t<e.length;){let o=e[t];if(r){if(o[0]==="enter")o[1].type==="tableContent"&&n.push(e[t+1][1].type==="tableDelimiterMarker"?"left":"none");else if(o[1].type==="tableContent"){if(e[t-1][1].type==="tableDelimiterMarker"){let i=n.length-1;n[i]=n[i]==="left"?"center":"right"}}else if(o[1].type==="tableDelimiterRow")break}else o[0]==="enter"&&o[1].type==="tableDelimiterRow"&&(r=!0);t+=1}return n}function ez(){return{flow:{null:{name:"table",tokenize:DOe,resolveAll:wOe}}}}function DOe(e,t,r){let n=this,o=0,i=0,a;return s;function s(D){let M=n.events.length-1;for(;M>-1;){let k=n.events[M][1].type;if(k==="lineEnding"||k==="linePrefix")M--;else break}let E=M>-1?n.events[M][1].type:null,R=E==="tableHead"||E==="tableRow"?A:l;return R===A&&n.parser.lazy[n.now().line]?r(D):R(D)}function l(D){return e.enter("tableHead"),e.enter("tableRow"),u(D)}function u(D){return D===124||(a=!0,i+=1),c(D)}function c(D){return D===null?r(D):hr(D)?i>1?(i=0,n.interrupt=!0,e.exit("tableRow"),e.enter("lineEnding"),e.consume(D),e.exit("lineEnding"),p):r(D):sn(D)?tn(e,c,"whitespace")(D):(i+=1,a&&(a=!1,o+=1),D===124?(e.enter("tableCellDivider"),e.consume(D),e.exit("tableCellDivider"),a=!0,c):(e.enter("data"),m(D)))}function m(D){return D===null||D===124||ao(D)?(e.exit("data"),c(D)):(e.consume(D),D===92?d:m)}function d(D){return D===92||D===124?(e.consume(D),m):m(D)}function p(D){return n.interrupt=!1,n.parser.lazy[n.now().line]?r(D):(e.enter("tableDelimiterRow"),a=!1,sn(D)?tn(e,h,"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(D):h(D))}function h(D){return D===45||D===58?y(D):D===124?(a=!0,e.enter("tableCellDivider"),e.consume(D),e.exit("tableCellDivider"),f):v(D)}function f(D){return sn(D)?tn(e,y,"whitespace")(D):y(D)}function y(D){return D===58?(i+=1,a=!0,e.enter("tableDelimiterMarker"),e.consume(D),e.exit("tableDelimiterMarker"),g):D===45?(i+=1,g(D)):D===null||hr(D)?I(D):v(D)}function g(D){return D===45?(e.enter("tableDelimiterFiller"),x(D)):v(D)}function x(D){return D===45?(e.consume(D),x):D===58?(a=!0,e.exit("tableDelimiterFiller"),e.enter("tableDelimiterMarker"),e.consume(D),e.exit("tableDelimiterMarker"),S):(e.exit("tableDelimiterFiller"),S(D))}function S(D){return sn(D)?tn(e,I,"whitespace")(D):I(D)}function I(D){return D===124?h(D):D===null||hr(D)?!a||o!==i?v(D):(e.exit("tableDelimiterRow"),e.exit("tableHead"),t(D)):v(D)}function v(D){return r(D)}function A(D){return e.enter("tableRow"),_(D)}function _(D){return D===124?(e.enter("tableCellDivider"),e.consume(D),e.exit("tableCellDivider"),_):D===null||hr(D)?(e.exit("tableRow"),t(D)):sn(D)?tn(e,_,"whitespace")(D):(e.enter("data"),T(D))}function T(D){return D===null||D===124||ao(D)?(e.exit("data"),_(D)):(e.consume(D),D===92?w:T)}function w(D){return D===92||D===124?(e.consume(D),T):T(D)}}function wOe(e,t){let r=-1,n=!0,o=0,i=[0,0,0,0],a=[0,0,0,0],s=!1,l=0,u,c,m,d=new cE;for(;++r<e.length;){let p=e[r],h=p[1];p[0]==="enter"?h.type==="tableHead"?(s=!1,l!==0&&(Goe(d,t,l,u,c),c=void 0,l=0),u={type:"table",start:Object.assign({},h.start),end:Object.assign({},h.end)},d.add(r,0,[["enter",u,t]])):h.type==="tableRow"||h.type==="tableDelimiterRow"?(n=!0,m=void 0,i=[0,0,0,0],a=[0,r+1,0,0],s&&(s=!1,c={type:"tableBody",start:Object.assign({},h.start),end:Object.assign({},h.end)},d.add(r,0,[["enter",c,t]])),o=h.type==="tableDelimiterRow"?2:c?3:1):o&&(h.type==="data"||h.type==="tableDelimiterMarker"||h.type==="tableDelimiterFiller")?(n=!1,a[2]===0&&(i[1]!==0&&(a[0]=a[1],m=mE(d,t,i,o,void 0,m),i=[0,0,0,0]),a[2]=r)):h.type==="tableCellDivider"&&(n?n=!1:(i[1]!==0&&(a[0]=a[1],m=mE(d,t,i,o,void 0,m)),i=a,a=[i[1],r,0,0])):h.type==="tableHead"?(s=!0,l=r):h.type==="tableRow"||h.type==="tableDelimiterRow"?(l=r,i[1]!==0?(a[0]=a[1],m=mE(d,t,i,o,r,m)):a[1]!==0&&(m=mE(d,t,a,o,r,m)),o=0):o&&(h.type==="data"||h.type==="tableDelimiterMarker"||h.type==="tableDelimiterFiller")&&(a[3]=r)}for(l!==0&&Goe(d,t,l,u,c),d.consume(t.events),r=-1;++r<t.events.length;){let p=t.events[r];p[0]==="enter"&&p[1].type==="table"&&(p[1]._align=Ooe(t.events,r))}return e}function mE(e,t,r,n,o,i){let a=n===1?"tableHeader":n===2?"tableDelimiter":"tableData",s="tableContent";r[0]!==0&&(i.end=Object.assign({},tv(t.events,r[0])),e.add(r[0],0,[["exit",i,t]]));let l=tv(t.events,r[1]);if(i={type:a,start:Object.assign({},l),end:Object.assign({},l)},e.add(r[1],0,[["enter",i,t]]),r[2]!==0){let u=tv(t.events,r[2]),c=tv(t.events,r[3]),m={type:s,start:Object.assign({},u),end:Object.assign({},c)};if(e.add(r[2],0,[["enter",m,t]]),n!==2){let d=t.events[r[2]],p=t.events[r[3]];if(d[1].end=Object.assign({},p[1].end),d[1].type="chunkText",d[1].contentType="text",r[3]>r[2]+1){let h=r[2]+1,f=r[3]-r[2]-1;e.add(h,f,[])}}e.add(r[3]+1,0,[["exit",m,t]])}return o!==void 0&&(i.end=Object.assign({},tv(t.events,o)),e.add(o,0,[["exit",i,t]]),i=void 0),i}function Goe(e,t,r,n,o){let i=[],a=tv(t.events,r);o&&(o.end=Object.assign({},a),i.push(["exit",o,t])),n.end=Object.assign({},a),i.push(["exit",n,t]),e.add(r+1,0,i)}function tv(e,t){let r=e[t],n=r[0]==="enter"?"start":"end";return r[1][n]}var EOe={name:"tasklistCheck",tokenize:MOe};function tz(){return{text:{91:EOe}}}function MOe(e,t,r){let n=this;return o;function o(l){return n.previous!==null||!n._gfmTasklistFirstContentOfListItem?r(l):(e.enter("taskListCheck"),e.enter("taskListCheckMarker"),e.consume(l),e.exit("taskListCheckMarker"),i)}function i(l){return ao(l)?(e.enter("taskListCheckValueUnchecked"),e.consume(l),e.exit("taskListCheckValueUnchecked"),a):l===88||l===120?(e.enter("taskListCheckValueChecked"),e.consume(l),e.exit("taskListCheckValueChecked"),a):r(l)}function a(l){return l===93?(e.enter("taskListCheckMarker"),e.consume(l),e.exit("taskListCheckMarker"),e.exit("taskListCheck"),s):r(l)}function s(l){return hr(l)?t(l):sn(l)?e.check({tokenize:BOe},t,r)(l):r(l)}}function BOe(e,t,r){return tn(e,n,"whitespace");function n(o){return o===null?r(o):t(o)}}function Uoe(e){return Fw([Y5(),J5(),$5(e),ez(),tz()])}var kOe={};function dE(e){let t=this,r=e||kOe,n=t.data(),o=n.micromarkExtensions||(n.micromarkExtensions=[]),i=n.fromMarkdownExtensions||(n.fromMarkdownExtensions=[]),a=n.toMarkdownExtensions||(n.toMarkdownExtensions=[]);o.push(Uoe(r)),i.push(Q5()),a.push(Z5(r))}var Lt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},NEt=function(){let e=new Map;return Object.keys(Lt).forEach(t=>{e.set(Lt[t],t)}),e}();var LOe=/^#([0-9A-F]{3}){1,2}$/i,FOe=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i;function pE(e){if(e==null)return;let t;if(LOe.test(e)&&(e.length===4&&(e=`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`),t=Fe.fromHexStyle(e),t!==void 0&&!isNaN(t))||(t=Lt[e.toLowerCase()],t!==void 0))return t;let r=FOe.exec(e);if(r){let n=parseInt(r[1],10),o=parseInt(r[2],10),i=parseInt(r[3],10);if(n>=0&&n<=255&&o>=0&&o<=255&&i>=0&&i<=255)return Fe.fromRgb(n,o,i)}}function fE(e){let t=e.length,r=[];if(e.every(o=>Array.isArray(o))){let o=[...e];if(!o[0])return"linear-gradient(to right, #000 0%, #000 100%)";o.sort((i,a)=>i[1]-a[1]),r.push(`${Fe.toStyle(o[0][0])} ${(100*o[0][1]).toFixed(2)}%`);for(let i=0,a=o.length-1;i<a;++i){let[s,l]=o[i],[u,c]=o[i+1],m=l+(c-l)/2;r.push(`${Fe.toStyle(s)} ${(100*m).toFixed(2)}%`,`${Fe.toStyle(u)} ${(100*m).toFixed(2)}%`)}r.push(`${Fe.toStyle(o[o.length-1][0])} ${(100*o[o.length-1][1]).toFixed(2)}%`)}else{r.push(`${rv(e[0])} ${100*(1/t)}%`);for(let o=1,i=t-1;o<i;++o)r.push(`${rv(e[o])} ${100*(o/t)}%`,`${rv(e[o])} ${100*((o+1)/t)}%`);r.push(`${rv(e[t-1])} ${100*((t-1)/t)}%`)}return`linear-gradient(to right, ${r.join(", ")})`}function hE(e){if(e.length===0)return"linear-gradient(to right, #000 0%, #000 100%)";let t=e.every(n=>Array.isArray(n)),r;if(t){let n=[...e];n.sort((o,i)=>o[1]-i[1]),r=n.map(o=>rv(o,!0))}else r=e.map(n=>rv(n));return`linear-gradient(to right, ${r.join(", ")})`}function rv(e,t=!1){return Array.isArray(e)?t?`${Fe.toStyle(e[0])} ${(100*e[1]).toFixed(2)}%`:Fe.toStyle(e[0]):Fe.toStyle(e)}function Noe(e,t=/,/){let r=[],n=e.replace(/\s+/g,""),o=0,i=0;for(let a=0,s=n.length;a<s;++a){let l=n[a];if(l==="("){i++;continue}else if(l===")"){i>0&&i--;continue}if(i>0||!t.test(l))continue;let u=n.substring(o,a);o=a+1;let c=pE(u);c!==void 0&&r.push(c)}if(o<n.length){let a=n.substring(o),s=pE(a);console.log(a,s),s!==void 0&&r.push(s)}return r}var Vm=Rt(nr());function gE({children:e,components:t}){return(0,Vm.jsx)("div",{className:"msp-markdown",children:(0,Vm.jsx)(a2,{skipHtml:!0,components:{a:UOe,img:VOe,...t},remarkPlugins:[dE],children:e})})}function VOe({src:e,element:t,alt:r}){let n=(0,C0.useContext)(vl);if(!e)return t;rz(n);let o=n?.managers.markdownExtensions.parseArgs(e);if(o)return n?.managers.markdownExtensions.tryRender(o,GOe)??t;{let i=n?.managers.markdownExtensions.tryResolveUri(e);if(typeof i?.then=="function")return(0,Vm.jsx)(OOe,{alt:r,data:i});if(typeof i=="string"&&i)return(0,Vm.jsx)("img",{src:i,alt:r})}return(0,Vm.jsx)("img",{src:e,alt:r})}function OOe({alt:e,data:t}){let[r,n]=(0,C0.useState)(void 0);return(0,C0.useEffect)(()=>{let o=!0;return t.then(i=>{o&&n(i)}).catch(i=>{console.error("Failed to load static image",i),o&&n(void 0)}),()=>{o=!1}},[t]),r?(0,Vm.jsx)("img",{src:r,alt:e}):null}var GOe=[{name:"color-swatch",reactRenderFn:({args:e})=>{let t=e["color-swatch"];return t?(0,Vm.jsx)("span",{style:{display:"inline-block",width:"0.75em",height:"0.75em",backgroundColor:t,borderRadius:"25%"}}):null}},{name:"color-palette",reactRenderFn:({args:e})=>{let t=e["color-palette-name"],r=e["color-palette-colors"],n=e["color-palette-width"]??"150px",o=e["color-palette-height"]??"0.5em",i="color-palette-discrete"in e;if(!t&&!r)return null;let a=r?Noe(r):lr[t.toLowerCase()]?.list;return a?.length?(0,Vm.jsx)("span",{style:{display:"inline-block",minWidth:n,height:o,background:(i?fE:hE)(a),borderRadius:"2px"}}):(console.warn("Color palette could not be resolved.",e),null)}}];function UOe({href:e,children:t,element:r}){let n=(0,C0.useContext)(vl);if(!e)return r;rz(n);let o=n?.managers.markdownExtensions.parseArgs(e);return o?(0,Vm.jsx)("a",{href:"#",onClick:i=>{i.preventDefault(),n?.managers.markdownExtensions.tryExecute("click",o)},onMouseEnter:()=>n?.managers.markdownExtensions.tryExecute("mouse-enter",o),onMouseLeave:()=>n?.managers.markdownExtensions.tryExecute("mouse-leave",o),children:t}):e[0]==="#"?(rz(n),(0,Vm.jsx)("a",{href:"#",onClick:i=>{i.preventDefault(),n?.managers.snapshot.applyKey(e.substring(1))},children:t})):e?(0,Vm.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:[t,"\u2934"]}):t}function rz(e){e||console.warn("Markdown component requires a PluginReactContext to be set.")}var Fu=Rt(nr()),nz=class extends ic{constructor(r){super();this.options=r;this.root=void 0;this.state=new Pa({all:[]});this.context=a1(r?.context)}get viewer(){return this.context.state.viewers.value?.find(r=>this.options?.viewerName===r.name)}sync(){let r=this.viewer?.model.plugin?.managers.snapshot;this.state.next({entry:r?.current,index:r?.current?r?.getIndex(r.current):void 0,all:r?.state.entries.toArray()??[]})}async mount(r){this.root=r,(0,zoe.createRoot)(r).render((0,Fu.jsx)(NOe,{model:this}));let n,o;this.subscribe(this.context.state.viewers.pipe(BC(i=>i.find(a=>this.options?.viewerName===a.name)),VT((i,a)=>i?.model===a?.model)),i=>{n!==i&&(n=i?.model,o?.unsubscribe()),i&&(o=this.subscribe(i.model.plugin?.managers.snapshot.events.changed,()=>{this.sync()}),this.sync())}),this.sync()}};function NOe({model:e}){let t=vu(e.state),r=vu(e.context.state.isLoading),n={display:"flex",flexDirection:"column",height:"100%"},o="mvs-stories-markdown-explanation";return r?(0,Fu.jsx)("div",{style:n,className:o,children:(0,Fu.jsx)("i",{children:"Loading..."})}):t.all.length===0?(0,Fu.jsx)("div",{style:n,className:o,children:(0,Fu.jsx)("i",{children:"No snapshot loaded or no description available"})}):(0,Fu.jsxs)("div",{style:n,className:o,children:[(0,Fu.jsxs)("div",{style:{display:"flex",flexDirection:"row",width:"100%",gap:"8px"},children:[(0,Fu.jsxs)("span",{style:{lineHeight:"38px",minWidth:60,maxWidth:60,flexShrink:0},children:[typeof t.index=="number"?t.index+1:"-","/",t.all.length]}),(0,Fu.jsx)("button",{onClick:()=>e.viewer?.model.plugin?.managers.snapshot.applyNext(-1),style:{flexGrow:1,flexShrink:0},children:"Prev"}),(0,Fu.jsx)("button",{onClick:()=>e.viewer?.model.plugin?.managers.snapshot.applyNext(1),style:{flexGrow:1,flexShrink:0},children:"Next"})]}),(0,Fu.jsx)("div",{style:{flexGrow:1,overflow:"hidden",overflowY:"auto",position:"relative"},children:(0,Fu.jsx)("div",{style:{position:"absolute",inset:0},children:(0,Fu.jsx)(vl.Provider,{value:e.viewer?.model.plugin,children:(0,Fu.jsx)(gE,{children:t.entry?.description??"Description not available"})})})})]})}var oz=class extends HTMLElement{constructor(){super();this.model=void 0}async connectedCallback(){this.model=new nz({context:{name:this.getAttribute("context-name")??void 0},viewerName:this.getAttribute("viewer-name")??void 0}),await this.model.mount(this)}disconnectedCallback(){this.model?.dispose(),this.model=void 0}};window.customElements.define("mvs-stories-snapshot-markdown",oz);var An;(o=>{function e(){return i=>t(i)}o.factory=e;function t(i){return class{constructor(s,l){this.data=s;this.id=en.create22();this.type=i;this.label=l&&l.label||i.name,this.description=l&&l.description}static{this.type=i}static is(s){return!!s&&i===s.type}}}o.create=t;function r(i,a){if(!i.tags)return!1;for(let s of i.tags)if(s===a)return!0;return!1}o.hasTag=r,o.Null={id:en.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}})(An||={});var l2;(r=>{function e(n){let o=n;return!!o&&!!o.transform&&!!o.parent&&!!o.status}r.is=e;function t(n,o){let i=typeof o=="string"?o:r.is(o)?o.transform.ref:o.ref;return n.cells.get(i)}r.resolve=t})(l2||={});var nv=class{constructor(t,r){this.ref=t;this.state=r}get cell(){return this.state?.cells.get(this.ref)}get obj(){return this.state?.cells.get(this.ref)?.obj}get data(){return this.obj?.data}update(t,r){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return r||(r=this.state.build()),(r||this.state.build()).to(this).update(t),r}checkValid(){if(!this.state)throw new Error("Unassigned State.");let t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if(t.status==="ok")return!0;throw t.status==="error"?new Error(t.errorText):t.obj===An.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")}get isOk(){let t=this.cell;return t&&t.status==="ok"&&t.obj!==An.Null}},Yo;(n=>{function e(o){if(o)return typeof o=="string"?o:l2.is(o)?o.transform.ref:o.cell?.transform.ref}n.resolveRef=e;function t(o,i){if(i)return l2.is(i)?i:typeof i=="string"?o.cells.get(i):i.cell}n.resolve=t;function r(o,i){let a=t(o,i);if(!(!a||!a.obj||a.status!=="ok"))return a}n.resolveAndCheck=r})(Yo||={});var C2="delete",Fi=5,Um=1<<Fi,yc=Um-1,Ao={};function mz(){return{value:!1}}function Gd(e){e&&(e.value=!0)}function Cz(){}function ov(e){return e.size===void 0&&(e.size=e.__iterate(pie)),e.size}function Wb(e,t){if(typeof t!="number"){var r=t>>>0;if(""+r!==t||r===4294967295)return NaN;t=r}return t<0?ov(e)+t:t}function pie(){return!0}function PE(e,t,r){return(e===0&&!hie(e)||r!==void 0&&e<=-r)&&(t===void 0||r!==void 0&&t>=r)}function S2(e,t){return fie(e,t,0)}function _E(e,t){return fie(e,t,t)}function fie(e,t,r){return e===void 0?r:hie(e)?t===1/0?t:Math.max(0,t+e)|0:t===void 0||t===e?e:Math.min(t,e)|0}function hie(e){return e<0||e===0&&1/e===-1/0}var gie="@@__IMMUTABLE_ITERABLE__@@";function zm(e){return!!(e&&e[gie])}var vE="@@__IMMUTABLE_KEYED__@@";function da(e){return!!(e&&e[vE])}var IE="@@__IMMUTABLE_INDEXED__@@";function Ud(e){return!!(e&&e[IE])}function Sz(e){return da(e)||Ud(e)}var Vu=function(t){return zm(t)?t:em(t)},Nd=function(e){function t(r){return da(r)?r:Zb(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Vu),v0=function(e){function t(r){return Ud(r)?r:ef(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Vu),dv=function(e){function t(r){return zm(r)&&!Sz(r)?r:hv(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Vu);Vu.Keyed=Nd;Vu.Indexed=v0;Vu.Set=dv;var yie="@@__IMMUTABLE_SEQ__@@";function vz(e){return!!(e&&e[yie])}var bie="@@__IMMUTABLE_RECORD__@@";function I0(e){return!!(e&&e[bie])}function oh(e){return zm(e)||I0(e)}var Xb="@@__IMMUTABLE_ORDERED__@@";function nh(e){return!!(e&&e[Xb])}var pv=0,Hm=1,jm=2,dz=typeof Symbol=="function"&&Symbol.iterator,xie="@@iterator",RE=dz||xie,No=function(t){this.next=t};No.prototype.toString=function(){return"[Iterator]"};No.KEYS=pv;No.VALUES=Hm;No.ENTRIES=jm;No.prototype.inspect=No.prototype.toSource=function(){return this.toString()};No.prototype[RE]=function(){return this};function pa(e,t,r,n){var o=e===pv?t:e===Hm?r:[t,r];return n?n.value=o:n={value:o,done:!1},n}function bc(){return{value:void 0,done:!0}}function Cie(e){return Array.isArray(e)?!0:!!DE(e)}function Hoe(e){return e&&typeof e.next=="function"}function pz(e){var t=DE(e);return t&&t.call(e)}function DE(e){var t=e&&(dz&&e[dz]||e[xie]);if(typeof t=="function")return t}function zOe(e){var t=DE(e);return t&&t===e.entries}function HOe(e){var t=DE(e);return t&&t===e.keys}var fv=Object.prototype.hasOwnProperty;function Sie(e){return Array.isArray(e)||typeof e=="string"?!0:e&&typeof e=="object"&&Number.isInteger(e.length)&&e.length>=0&&(e.length===0?Object.keys(e).length===1:e.hasOwnProperty(e.length-1))}var em=function(e){function t(r){return r==null?Az():oh(r)?r.toSeq():WOe(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq {","}")},t.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},t.prototype.__iterate=function(n,o){var i=this._cache;if(i){for(var a=i.length,s=0;s!==a;){var l=i[o?a-++s:s++];if(n(l[1],l[0],this)===!1)break}return s}return this.__iterateUncached(n,o)},t.prototype.__iterator=function(n,o){var i=this._cache;if(i){var a=i.length,s=0;return new No(function(){if(s===a)return bc();var l=i[o?a-++s:s++];return pa(n,l[0],l[1])})}return this.__iteratorUncached(n,o)},t}(Vu),Zb=function(e){function t(r){return r==null?Az().toKeyedSeq():zm(r)?da(r)?r.toSeq():r.fromEntrySeq():I0(r)?r.toSeq():Tz(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toKeyedSeq=function(){return this},t}(em),ef=function(e){function t(r){return r==null?Az():zm(r)?da(r)?r.entrySeq():r.toIndexedSeq():I0(r)?r.toSeq().entrySeq():vie(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toIndexedSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq [","]")},t}(em),hv=function(e){function t(r){return(zm(r)&&!Sz(r)?r:ef(r)).toSetSeq()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toSetSeq=function(){return this},t}(em);em.isSeq=vz;em.Keyed=Zb;em.Set=hv;em.Indexed=ef;em.prototype[yie]=!0;var iv=function(e){function t(r){this._array=r,this.size=r.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,o){return this.has(n)?this._array[Wb(this,n)]:o},t.prototype.__iterate=function(n,o){for(var i=this._array,a=i.length,s=0;s!==a;){var l=o?a-++s:s++;if(n(i[l],l,this)===!1)break}return s},t.prototype.__iterator=function(n,o){var i=this._array,a=i.length,s=0;return new No(function(){if(s===a)return bc();var l=o?a-++s:s++;return pa(n,l,i[l])})},t}(ef),Iz=function(e){function t(r){var n=Object.keys(r).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(r):[]);this._object=r,this._keys=n,this.size=n.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,o){return o!==void 0&&!this.has(n)?o:this._object[n]},t.prototype.has=function(n){return fv.call(this._object,n)},t.prototype.__iterate=function(n,o){for(var i=this._object,a=this._keys,s=a.length,l=0;l!==s;){var u=a[o?s-++l:l++];if(n(i[u],u,this)===!1)break}return l},t.prototype.__iterator=function(n,o){var i=this._object,a=this._keys,s=a.length,l=0;return new No(function(){if(l===s)return bc();var u=a[o?s-++l:l++];return pa(n,u,i[u])})},t}(Zb);Iz.prototype[Xb]=!0;var jOe=function(e){function t(r){this._collection=r,this.size=r.length||r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__iterateUncached=function(n,o){if(o)return this.cacheResult().__iterate(n,o);var i=this._collection,a=pz(i),s=0;if(Hoe(a))for(var l;!(l=a.next()).done&&n(l.value,s++,this)!==!1;);return s},t.prototype.__iteratorUncached=function(n,o){if(o)return this.cacheResult().__iterator(n,o);var i=this._collection,a=pz(i);if(!Hoe(a))return new No(bc);var s=0;return new No(function(){var l=a.next();return l.done?l:pa(n,s++,l.value)})},t}(ef),joe;function Az(){return joe||(joe=new iv([]))}function Tz(e){var t=Pz(e);if(t)return t.fromEntrySeq();if(typeof e=="object")return new Iz(e);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+e)}function vie(e){var t=Pz(e);if(t)return t;throw new TypeError("Expected Array or collection object of values: "+e)}function WOe(e){var t=Pz(e);if(t)return zOe(e)?t.fromEntrySeq():HOe(e)?t.toSetSeq():t;if(typeof e=="object")return new Iz(e);throw new TypeError("Expected Array or collection object of values, or keyed object: "+e)}function Pz(e){return Sie(e)?new iv(e):Cie(e)?new jOe(e):void 0}var Iie="@@__IMMUTABLE_MAP__@@";function _z(e){return!!(e&&e[Iie])}function Aie(e){return _z(e)&&nh(e)}function Woe(e){return!!(e&&typeof e.equals=="function"&&typeof e.hashCode=="function")}function Nm(e,t){if(e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1;if(typeof e.valueOf=="function"&&typeof t.valueOf=="function"){if(e=e.valueOf(),t=t.valueOf(),e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1}return!!(Woe(e)&&Woe(t)&&e.equals(t))}var u2=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(t,r){t|=0,r|=0;var n=t&65535,o=r&65535;return n*o+((t>>>16)*o+n*(r>>>16)<<16>>>0)|0};function wE(e){return e>>>1&1073741824|e&3221225471}var XOe=Object.prototype.valueOf;function Om(e){if(e==null)return Xoe(e);if(typeof e.hashCode=="function")return wE(e.hashCode(e));var t=JOe(e);if(t==null)return Xoe(t);switch(typeof t){case"boolean":return t?1108378657:1108378656;case"number":return QOe(t);case"string":return t.length>$Oe?ZOe(t):fz(t);case"object":case"function":return YOe(t);case"symbol":return qOe(t);default:if(typeof t.toString=="function")return fz(t.toString());throw new Error("Value type "+typeof t+" cannot be hashed.")}}function Xoe(e){return e===null?1108378658:1108378659}function QOe(e){if(e!==e||e===1/0)return 0;var t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)e/=4294967295,t^=e;return wE(t)}function ZOe(e){var t=sz[e];return t===void 0&&(t=fz(e),az===eGe&&(az=0,sz={}),az++,sz[e]=t),t}function fz(e){for(var t=0,r=0;r<e.length;r++)t=31*t+e.charCodeAt(r)|0;return wE(t)}function qOe(e){var t=qoe[e];return t!==void 0||(t=Tie(),qoe[e]=t),t}function YOe(e){var t;if(hz&&(t=gz.get(e),t!==void 0)||(t=e[S0],t!==void 0)||!Zoe&&(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[S0],t!==void 0||(t=KOe(e),t!==void 0)))return t;if(t=Tie(),hz)gz.set(e,t);else{if(Qoe!==void 0&&Qoe(e)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(Zoe)Object.defineProperty(e,S0,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(e.propertyIsEnumerable!==void 0&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[S0]=t;else if(e.nodeType!==void 0)e[S0]=t;else throw new Error("Unable to set a non-enumerable property on object.")}return t}var Qoe=Object.isExtensible,Zoe=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function KOe(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}function JOe(e){return e.valueOf!==XOe&&typeof e.valueOf=="function"?e.valueOf(e):e}function Tie(){var e=++iz;return iz&1073741824&&(iz=0),e}var hz=typeof WeakMap=="function",gz;hz&&(gz=new WeakMap);var qoe=Object.create(null),iz=0,S0="__immutablehash__";typeof Symbol=="function"&&(S0=Symbol(S0));var $Oe=16,eGe=255,az=0,sz={},EE=function(e){function t(r,n){this._iter=r,this._useKeys=n,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,o){return this._iter.get(n,o)},t.prototype.has=function(n){return this._iter.has(n)},t.prototype.valueSeq=function(){return this._iter.valueSeq()},t.prototype.reverse=function(){var n=this,o=Rz(this,!0);return this._useKeys||(o.valueSeq=function(){return n._iter.toSeq().reverse()}),o},t.prototype.map=function(n,o){var i=this,a=wie(this,n,o);return this._useKeys||(a.valueSeq=function(){return i._iter.toSeq().map(n,o)}),a},t.prototype.__iterate=function(n,o){var i=this;return this._iter.__iterate(function(a,s){return n(a,s,i)},o)},t.prototype.__iterator=function(n,o){return this._iter.__iterator(n,o)},t}(Zb);EE.prototype[Xb]=!0;var Pie=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.includes=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,o){var i=this,a=0;return o&&ov(this),this._iter.__iterate(function(s){return n(s,o?i.size-++a:a++,i)},o)},t.prototype.__iterator=function(n,o){var i=this,a=this._iter.__iterator(Hm,o),s=0;return o&&ov(this),new No(function(){var l=a.next();return l.done?l:pa(n,o?i.size-++s:s++,l.value,l)})},t}(ef),_ie=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.has=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,o){var i=this;return this._iter.__iterate(function(a){return n(a,a,i)},o)},t.prototype.__iterator=function(n,o){var i=this._iter.__iterator(Hm,o);return new No(function(){var a=i.next();return a.done?a:pa(n,a.value,a.value,a)})},t}(hv),Rie=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.entrySeq=function(){return this._iter.toSeq()},t.prototype.__iterate=function(n,o){var i=this;return this._iter.__iterate(function(a){if(a){Koe(a);var s=zm(a);return n(s?a.get(1):a[1],s?a.get(0):a[0],i)}},o)},t.prototype.__iterator=function(n,o){var i=this._iter.__iterator(Hm,o);return new No(function(){for(;;){var a=i.next();if(a.done)return a;var s=a.value;if(s){Koe(s);var l=zm(s);return pa(n,l?s.get(0):s[0],l?s.get(1):s[1],a)}}})},t}(Zb);Pie.prototype.cacheResult=EE.prototype.cacheResult=_ie.prototype.cacheResult=Rie.prototype.cacheResult=Ez;function Die(e){var t=ih(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var r=e.reverse.apply(this);return r.flip=function(){return e.reverse()},r},t.has=function(r){return e.includes(r)},t.includes=function(r){return e.has(r)},t.cacheResult=Ez,t.__iterateUncached=function(r,n){var o=this;return e.__iterate(function(i,a){return r(a,i,o)!==!1},n)},t.__iteratorUncached=function(r,n){if(r===jm){var o=e.__iterator(r,n);return new No(function(){var i=o.next();if(!i.done){var a=i.value[0];i.value[0]=i.value[1],i.value[1]=a}return i})}return e.__iterator(r===Hm?pv:Hm,n)},t}function wie(e,t,r){var n=ih(e);return n.size=e.size,n.has=function(o){return e.has(o)},n.get=function(o,i){var a=e.get(o,Ao);return a===Ao?i:t.call(r,a,o,e)},n.__iterateUncached=function(o,i){var a=this;return e.__iterate(function(s,l,u){return o(t.call(r,s,l,u),l,a)!==!1},i)},n.__iteratorUncached=function(o,i){var a=e.__iterator(jm,i);return new No(function(){var s=a.next();if(s.done)return s;var l=s.value,u=l[0];return pa(o,u,t.call(r,l[1],u,e),s)})},n}function Rz(e,t){var r=this,n=ih(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var o=Die(e);return o.reverse=function(){return e.flip()},o}),n.get=function(o,i){return e.get(t?o:-1-o,i)},n.has=function(o){return e.has(t?o:-1-o)},n.includes=function(o){return e.includes(o)},n.cacheResult=Ez,n.__iterate=function(o,i){var a=this,s=0;return i&&ov(e),e.__iterate(function(l,u){return o(l,t?u:i?a.size-++s:s++,a)},!i)},n.__iterator=function(o,i){var a=0;i&&ov(e);var s=e.__iterator(jm,!i);return new No(function(){var l=s.next();if(l.done)return l;var u=l.value;return pa(o,t?u[0]:i?r.size-++a:a++,u[1],l)})},n}function Eie(e,t,r,n){var o=ih(e);return n&&(o.has=function(i){var a=e.get(i,Ao);return a!==Ao&&!!t.call(r,a,i,e)},o.get=function(i,a){var s=e.get(i,Ao);return s!==Ao&&t.call(r,s,i,e)?s:a}),o.__iterateUncached=function(i,a){var s=this,l=0;return e.__iterate(function(u,c,m){if(t.call(r,u,c,m))return l++,i(u,n?c:l-1,s)},a),l},o.__iteratorUncached=function(i,a){var s=e.__iterator(jm,a),l=0;return new No(function(){for(;;){var u=s.next();if(u.done)return u;var c=u.value,m=c[0],d=c[1];if(t.call(r,d,m,e))return pa(i,n?m:l++,d,u)}})},o}function tGe(e,t,r){var n=Xm().asMutable();return e.__iterate(function(o,i){n.update(t.call(r,o,i,e),0,function(a){return a+1})}),n.asImmutable()}function rGe(e,t,r){var n=da(e),o=(nh(e)?Us():Xm()).asMutable();e.__iterate(function(a,s){o.update(t.call(r,a,s,e),function(l){return l=l||[],l.push(n?[s,a]:a),l})});var i=wz(e);return o.map(function(a){return Li(e,i(a))}).asImmutable()}function nGe(e,t,r){var n=da(e),o=[[],[]];e.__iterate(function(a,s){o[t.call(r,a,s,e)?1:0].push(n?[s,a]:a)});var i=wz(e);return o.map(function(a){return Li(e,i(a))})}function Dz(e,t,r,n){var o=e.size;if(PE(t,r,o))return e;if(typeof o>"u"&&(t<0||r<0))return Dz(e.toSeq().cacheResult(),t,r,n);var i=S2(t,o),a=_E(r,o),s=a-i,l;s===s&&(l=s<0?0:s);var u=ih(e);return u.size=l===0?l:e.size&&l||void 0,!n&&vz(e)&&l>=0&&(u.get=function(c,m){return c=Wb(this,c),c>=0&&c<l?e.get(c+i,m):m}),u.__iterateUncached=function(c,m){var d=this;if(l===0)return 0;if(m)return this.cacheResult().__iterate(c,m);var p=0,h=!0,f=0;return e.__iterate(function(y,g){if(!(h&&(h=p++<i)))return f++,c(y,n?g:f-1,d)!==!1&&f!==l}),f},u.__iteratorUncached=function(c,m){if(l!==0&&m)return this.cacheResult().__iterator(c,m);if(l===0)return new No(bc);var d=e.__iterator(c,m),p=0,h=0;return new No(function(){for(;p++<i;)d.next();if(++h>l)return bc();var f=d.next();return n||c===Hm||f.done?f:c===pv?pa(c,h-1,void 0,f):pa(c,h-1,f.value[1],f)})},u}function oGe(e,t,r){var n=ih(e);return n.__iterateUncached=function(o,i){var a=this;if(i)return this.cacheResult().__iterate(o,i);var s=0;return e.__iterate(function(l,u,c){return t.call(r,l,u,c)&&++s&&o(l,u,a)}),s},n.__iteratorUncached=function(o,i){var a=this;if(i)return this.cacheResult().__iterator(o,i);var s=e.__iterator(jm,i),l=!0;return new No(function(){if(!l)return bc();var u=s.next();if(u.done)return u;var c=u.value,m=c[0],d=c[1];return t.call(r,d,m,a)?o===jm?u:pa(o,m,d,u):(l=!1,bc())})},n}function Mie(e,t,r,n){var o=ih(e);return o.__iterateUncached=function(i,a){var s=this;if(a)return this.cacheResult().__iterate(i,a);var l=!0,u=0;return e.__iterate(function(c,m,d){if(!(l&&(l=t.call(r,c,m,d))))return u++,i(c,n?m:u-1,s)}),u},o.__iteratorUncached=function(i,a){var s=this;if(a)return this.cacheResult().__iterator(i,a);var l=e.__iterator(jm,a),u=!0,c=0;return new No(function(){var m,d,p;do{if(m=l.next(),m.done)return n||i===Hm?m:i===pv?pa(i,c++,void 0,m):pa(i,c++,m.value[1],m);var h=m.value;d=h[0],p=h[1],u&&(u=t.call(r,p,d,s))}while(u);return i===jm?m:pa(i,d,p,m)})},o}var iGe=function(e){function t(r){this._wrappedIterables=r.flatMap(function(n){return n._wrappedIterables?n._wrappedIterables:[n]}),this.size=this._wrappedIterables.reduce(function(n,o){if(n!==void 0){var i=o.size;if(i!==void 0)return n+i}},0),this[vE]=this._wrappedIterables[0][vE],this[IE]=this._wrappedIterables[0][IE],this[Xb]=this._wrappedIterables[0][Xb]}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__iterateUncached=function(n,o){if(this._wrappedIterables.length!==0){if(o)return this.cacheResult().__iterate(n,o);for(var i=0,a=da(this),s=a?jm:Hm,l=this._wrappedIterables[i].__iterator(s,o),u=!0,c=0;u;){for(var m=l.next();m.done;){if(i++,i===this._wrappedIterables.length)return c;l=this._wrappedIterables[i].__iterator(s,o),m=l.next()}var d=a?n(m.value[1],m.value[0],this):n(m.value,c,this);u=d!==!1,c++}return c}},t.prototype.__iteratorUncached=function(n,o){var i=this;if(this._wrappedIterables.length===0)return new No(bc);if(o)return this.cacheResult().__iterator(n,o);var a=0,s=this._wrappedIterables[a].__iterator(n,o);return new No(function(){for(var l=s.next();l.done;){if(a++,a===i._wrappedIterables.length)return l;s=i._wrappedIterables[a].__iterator(n,o),l=s.next()}return l})},t}(em);function aGe(e,t){var r=da(e),n=[e].concat(t).map(function(i){return zm(i)?r&&(i=Nd(i)):i=r?Tz(i):vie(Array.isArray(i)?i:[i]),i}).filter(function(i){return i.size!==0});if(n.length===0)return e;if(n.length===1){var o=n[0];if(o===e||r&&da(o)||Ud(e)&&Ud(o))return o}return new iGe(n)}function Bie(e,t,r){var n=ih(e);return n.__iterateUncached=function(o,i){if(i)return this.cacheResult().__iterate(o,i);var a=0,s=!1;function l(u,c){u.__iterate(function(m,d){return(!t||c<t)&&zm(m)?l(m,c+1):(a++,o(m,r?d:a-1,n)===!1&&(s=!0)),!s},i)}return l(e,0),a},n.__iteratorUncached=function(o,i){if(i)return this.cacheResult().__iterator(o,i);var a=e.__iterator(o,i),s=[],l=0;return new No(function(){for(;a;){var u=a.next();if(u.done!==!1){a=s.pop();continue}var c=u.value;if(o===jm&&(c=c[1]),(!t||s.length<t)&&zm(c))s.push(a),a=c.__iterator(o,i);else return r?u:pa(o,l++,c,u)}return bc()})},n}function sGe(e,t,r){var n=wz(e);return e.toSeq().map(function(o,i){return n(t.call(r,o,i,e))}).flatten(!0)}function lGe(e,t){var r=ih(e);return r.size=e.size&&e.size*2-1,r.__iterateUncached=function(n,o){var i=this,a=0;return e.__iterate(function(s){return(!a||n(t,a++,i)!==!1)&&n(s,a++,i)!==!1},o),a},r.__iteratorUncached=function(n,o){var i=e.__iterator(Hm,o),a=0,s;return new No(function(){return(!s||a%2)&&(s=i.next(),s.done)?s:a%2?pa(n,a++,t):pa(n,a++,s.value,s)})},r}function av(e,t,r){t||(t=kie);var n=da(e),o=0,i=e.toSeq().map(function(a,s){return[s,a,o++,r?r(a,s,e):a]}).valueSeq().toArray();return i.sort(function(a,s){return t(a[3],s[3])||a[2]-s[2]}).forEach(n?function(a,s){i[s].length=2}:function(a,s){i[s]=a[1]}),n?Zb(i):Ud(e)?ef(i):hv(i)}function yE(e,t,r){if(t||(t=kie),r){var n=e.toSeq().map(function(o,i){return[o,r(o,i,e)]}).reduce(function(o,i){return Yoe(t,o[1],i[1])?i:o});return n&&n[0]}return e.reduce(function(o,i){return Yoe(t,o,i)?i:o})}function Yoe(e,t,r){var n=e(r,t);return n===0&&r!==t&&(r==null||r!==r)||n>0}function bE(e,t,r,n){var o=ih(e),i=new iv(r).map(function(a){return a.size});return o.size=n?i.max():i.min(),o.__iterate=function(a,s){for(var l=this.__iterator(Hm,s),u,c=0;!(u=l.next()).done&&a(u.value,c++,this)!==!1;);return c},o.__iteratorUncached=function(a,s){var l=r.map(function(m){return m=Vu(m),pz(s?m.reverse():m)}),u=0,c=!1;return new No(function(){var m;return c||(m=l.map(function(d){return d.next()}),c=n?m.every(function(d){return d.done}):m.some(function(d){return d.done})),c?bc():pa(a,u++,t.apply(null,m.map(function(d){return d.value})))})},o}function Li(e,t){return e===t?e:vz(e)?t:e.constructor(t)}function Koe(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function wz(e){return da(e)?Nd:Ud(e)?v0:dv}function ih(e){return Object.create((da(e)?Zb:Ud(e)?ef:hv).prototype)}function Ez(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):em.prototype.cacheResult.call(this)}function kie(e,t){return e===void 0&&t===void 0?0:e===void 0?1:t===void 0?-1:e>t?1:e<t?-1:0}function th(e,t){t=t||0;for(var r=Math.max(0,e.length-t),n=new Array(r),o=0;o<r;o++)n[o]=e[o+t];return n}function p2(e,t){if(!e)throw new Error(t)}function Gm(e){p2(e!==1/0,"Cannot perform this action with an infinite size.")}function Lie(e){if(Sie(e)&&typeof e!="string")return e;if(nh(e))return e.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+e)}var uGe=Object.prototype.toString;function cGe(e){if(!e||typeof e!="object"||uGe.call(e)!=="[object Object]")return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(var r=t,n=Object.getPrototypeOf(t);n!==null;)r=n,n=Object.getPrototypeOf(r);return r===t}function Qb(e){return typeof e=="object"&&(oh(e)||Array.isArray(e)||cGe(e))}function h2(e){try{return typeof e=="string"?JSON.stringify(e):String(e)}catch{return JSON.stringify(e)}}function mGe(e,t){return oh(e)?e.has(t):Qb(e)&&fv.call(e,t)}function Fie(e,t,r){return oh(e)?e.get(t,r):mGe(e,t)?typeof e.get=="function"?e.get(t):e[t]:r}function AE(e){if(Array.isArray(e))return th(e);var t={};for(var r in e)fv.call(e,r)&&(t[r]=e[r]);return t}function dGe(e,t){if(!Qb(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(oh(e)){if(!e.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+e);return e.remove(t)}if(!fv.call(e,t))return e;var r=AE(e);return Array.isArray(r)?r.splice(t,1):delete r[t],r}function pGe(e,t,r){if(!Qb(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(oh(e)){if(!e.set)throw new TypeError("Cannot update immutable value without .set() method: "+e);return e.set(t,r)}if(fv.call(e,t)&&r===e[t])return e;var n=AE(e);return n[t]=r,n}function gv(e,t,r,n){n||(n=r,r=void 0);var o=Vie(oh(e),e,Lie(t),0,r,n);return o===Ao?r:o}function Vie(e,t,r,n,o,i){var a=t===Ao;if(n===r.length){var s=a?o:t,l=i(s);return l===s?t:l}if(!a&&!Qb(t))throw new TypeError("Cannot update within non-data-structure value in path ["+Array.from(r).slice(0,n).map(h2)+"]: "+t);var u=r[n],c=a?Ao:Fie(t,u,Ao),m=Vie(c===Ao?e:oh(c),c,r,n+1,o,i);return m===c?t:m===Ao?dGe(t,u):pGe(a?e?rh():{}:t,u,m)}function fGe(e,t,r){return gv(e,t,Ao,function(){return r})}function Mz(e,t){return fGe(this,e,t)}function hGe(e,t){return gv(e,t,function(){return Ao})}function Bz(e){return hGe(this,e)}function Oie(e,t,r,n){return gv(e,[t],r,n)}function kz(e,t,r){return arguments.length===1?e(this):Oie(this,e,t,r)}function Lz(e,t,r){return gv(this,e,t,r)}function Gie(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return Nie(this,e)}function Uie(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if(typeof e!="function")throw new TypeError("Invalid merger function: "+e);return Nie(this,t,e)}function Nie(e,t,r){for(var n=[],o=0;o<t.length;o++){var i=Nd(t[o]);i.size!==0&&n.push(i)}return n.length===0?e:e.toSeq().size===0&&!e.__ownerID&&n.length===1?I0(e)?e:e.constructor(n[0]):e.withMutations(function(a){for(var s=r?function(u,c){Oie(a,c,Ao,function(m){return m===Ao?u:r(m,u,c)})}:function(u,c){a.set(c,u)},l=0;l<n.length;l++)n[l].forEach(s)})}function Fz(e,t,r){return Vz(e,t,gGe(r))}function Vz(e,t,r){if(!Qb(e))throw new TypeError("Cannot merge into non-data-structure value: "+e);if(oh(e))return typeof r=="function"&&e.mergeWith?e.mergeWith.apply(e,[r].concat(t)):e.merge?e.merge.apply(e,t):e.concat.apply(e,t);for(var n=Array.isArray(e),o=e,i=n?v0:Nd,a=n?function(l){o===e&&(o=AE(o)),o.push(l)}:function(l,u){var c=fv.call(o,u),m=c&&r?r(o[u],l,u):l;(!c||m!==o[u])&&(o===e&&(o=AE(o)),o[u]=m)},s=0;s<t.length;s++)i(t[s]).forEach(a);return o}function gGe(e){function t(r,n,o){return Qb(r)&&Qb(n)&&yGe(r,n)?Vz(r,[n],t):e?e(r,n,o):n}return t}function yGe(e,t){var r=em(e),n=em(t);return Ud(r)===Ud(n)&&da(r)===da(n)}function zie(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return Fz(this,e)}function Hie(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return Fz(this,t,e)}function Oz(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return gv(this,e,rh(),function(n){return Vz(n,t)})}function Gz(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return gv(this,e,rh(),function(n){return Fz(n,t)})}function v2(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}function I2(){return this.__ownerID?this:this.__ensureOwner(new Cz)}function A2(){return this.__ensureOwner()}function Uz(){return this.__altered}var Xm=function(e){function t(r){return r==null?rh():_z(r)&&!nh(r)?r:rh().withMutations(function(n){var o=e(r);Gm(o.size),o.forEach(function(i,a){return n.set(a,i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.__toString("Map {","}")},t.prototype.get=function(n,o){return this._root?this._root.get(0,void 0,n,o):o},t.prototype.set=function(n,o){return eie(this,n,o)},t.prototype.remove=function(n){return eie(this,n,Ao)},t.prototype.deleteAll=function(n){var o=Vu(n);return o.size===0?this:this.withMutations(function(i){o.forEach(function(a){return i.remove(a)})})},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):rh()},t.prototype.sort=function(n){return Us(av(this,n))},t.prototype.sortBy=function(n,o){return Us(av(this,o,n))},t.prototype.map=function(n,o){var i=this;return this.withMutations(function(a){a.forEach(function(s,l){a.set(l,n.call(o,s,l,i))})})},t.prototype.__iterator=function(n,o){return new bGe(this,n,o)},t.prototype.__iterate=function(n,o){var i=this,a=0;return this._root&&this._root.iterate(function(s){return a++,n(s[1],s[0],i)},o),a},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?Nz(this.size,this._root,n,this.__hash):this.size===0?rh():(this.__ownerID=n,this.__altered=!1,this)},t}(Nd);Xm.isMap=_z;var aa=Xm.prototype;aa[Iie]=!0;aa[C2]=aa.remove;aa.removeAll=aa.deleteAll;aa.setIn=Mz;aa.removeIn=aa.deleteIn=Bz;aa.update=kz;aa.updateIn=Lz;aa.merge=aa.concat=Gie;aa.mergeWith=Uie;aa.mergeDeep=zie;aa.mergeDeepWith=Hie;aa.mergeIn=Oz;aa.mergeDeepIn=Gz;aa.withMutations=v2;aa.wasAltered=Uz;aa.asImmutable=A2;aa["@@transducer/init"]=aa.asMutable=I2;aa["@@transducer/step"]=function(e,t){return e.set(t[0],t[1])};aa["@@transducer/result"]=function(e){return e.asImmutable()};var g2=function(t,r){this.ownerID=t,this.entries=r};g2.prototype.get=function(t,r,n,o){for(var i=this.entries,a=0,s=i.length;a<s;a++)if(Nm(n,i[a][0]))return i[a][1];return o};g2.prototype.update=function(t,r,n,o,i,a,s){for(var l=i===Ao,u=this.entries,c=0,m=u.length;c<m&&!Nm(o,u[c][0]);c++);var d=c<m;if(d?u[c][1]===i:l)return this;if(Gd(s),(l||!d)&&Gd(a),!(l&&u.length===1)){if(!d&&!l&&u.length>=AGe)return xGe(t,u,o,i);var p=t&&t===this.ownerID,h=p?u:th(u);return d?l?c===m-1?h.pop():h[c]=h.pop():h[c]=[o,i]:h.push([o,i]),p?(this.entries=h,this):new g2(t,h)}};var sv=function(t,r,n){this.ownerID=t,this.bitmap=r,this.nodes=n};sv.prototype.get=function(t,r,n,o){r===void 0&&(r=Om(n));var i=1<<((t===0?r:r>>>t)&yc),a=this.bitmap;return(a&i)===0?o:this.nodes[jie(a&i-1)].get(t+Fi,r,n,o)};sv.prototype.update=function(t,r,n,o,i,a,s){n===void 0&&(n=Om(o));var l=(r===0?n:n>>>r)&yc,u=1<<l,c=this.bitmap,m=(c&u)!==0;if(!m&&i===Ao)return this;var d=jie(c&u-1),p=this.nodes,h=m?p[d]:void 0,f=zz(h,t,r+Fi,n,o,i,a,s);if(f===h)return this;if(!m&&f&&p.length>=TGe)return SGe(t,p,c,l,f);if(m&&!f&&p.length===2&&tie(p[d^1]))return p[d^1];if(m&&f&&p.length===1&&tie(f))return f;var y=t&&t===this.ownerID,g=m?f?c:c^u:c|u,x=m?f?Wie(p,d,f,y):IGe(p,d,y):vGe(p,d,f,y);return y?(this.bitmap=g,this.nodes=x,this):new sv(t,g,x)};var y2=function(t,r,n){this.ownerID=t,this.count=r,this.nodes=n};y2.prototype.get=function(t,r,n,o){r===void 0&&(r=Om(n));var i=(t===0?r:r>>>t)&yc,a=this.nodes[i];return a?a.get(t+Fi,r,n,o):o};y2.prototype.update=function(t,r,n,o,i,a,s){n===void 0&&(n=Om(o));var l=(r===0?n:n>>>r)&yc,u=i===Ao,c=this.nodes,m=c[l];if(u&&!m)return this;var d=zz(m,t,r+Fi,n,o,i,a,s);if(d===m)return this;var p=this.count;if(!m)p++;else if(!d&&(p--,p<PGe))return CGe(t,c,p,l);var h=t&&t===this.ownerID,f=Wie(c,l,d,h);return h?(this.count=p,this.nodes=f,this):new y2(t,p,f)};var lv=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entries=n};lv.prototype.get=function(t,r,n,o){for(var i=this.entries,a=0,s=i.length;a<s;a++)if(Nm(n,i[a][0]))return i[a][1];return o};lv.prototype.update=function(t,r,n,o,i,a,s){n===void 0&&(n=Om(o));var l=i===Ao;if(n!==this.keyHash)return l?this:(Gd(s),Gd(a),Hz(this,t,r,n,[o,i]));for(var u=this.entries,c=0,m=u.length;c<m&&!Nm(o,u[c][0]);c++);var d=c<m;if(d?u[c][1]===i:l)return this;if(Gd(s),(l||!d)&&Gd(a),l&&m===2)return new Jg(t,this.keyHash,u[c^1]);var p=t&&t===this.ownerID,h=p?u:th(u);return d?l?c===m-1?h.pop():h[c]=h.pop():h[c]=[o,i]:h.push([o,i]),p?(this.entries=h,this):new lv(t,this.keyHash,h)};var Jg=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entry=n};Jg.prototype.get=function(t,r,n,o){return Nm(n,this.entry[0])?this.entry[1]:o};Jg.prototype.update=function(t,r,n,o,i,a,s){var l=i===Ao,u=Nm(o,this.entry[0]);if(u?i===this.entry[1]:l)return this;if(Gd(s),l){Gd(a);return}return u?t&&t===this.ownerID?(this.entry[1]=i,this):new Jg(t,this.keyHash,[o,i]):(Gd(a),Hz(this,t,r,Om(o),[o,i]))};g2.prototype.iterate=lv.prototype.iterate=function(e,t){for(var r=this.entries,n=0,o=r.length-1;n<=o;n++)if(e(r[t?o-n:n])===!1)return!1};sv.prototype.iterate=y2.prototype.iterate=function(e,t){for(var r=this.nodes,n=0,o=r.length-1;n<=o;n++){var i=r[t?o-n:n];if(i&&i.iterate(e,t)===!1)return!1}};Jg.prototype.iterate=function(e,t){return e(this.entry)};var bGe=function(e){function t(r,n,o){this._type=n,this._reverse=o,this._stack=r._root&&Joe(r._root)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){for(var n=this._type,o=this._stack;o;){var i=o.node,a=o.index++,s=void 0;if(i.entry){if(a===0)return lz(n,i.entry)}else if(i.entries){if(s=i.entries.length-1,a<=s)return lz(n,i.entries[this._reverse?s-a:a])}else if(s=i.nodes.length-1,a<=s){var l=i.nodes[this._reverse?s-a:a];if(l){if(l.entry)return lz(n,l.entry);o=this._stack=Joe(l,o)}continue}o=this._stack=this._stack.__prev}return bc()},t}(No);function lz(e,t){return pa(e,t[0],t[1])}function Joe(e,t){return{node:e,index:0,__prev:t}}function Nz(e,t,r,n){var o=Object.create(aa);return o.size=e,o._root=t,o.__ownerID=r,o.__hash=n,o.__altered=!1,o}var $oe;function rh(){return $oe||($oe=Nz(0))}function eie(e,t,r){var n,o;if(e._root){var i=mz(),a=mz();if(n=zz(e._root,e.__ownerID,0,void 0,t,r,i,a),!a.value)return e;o=e.size+(i.value?r===Ao?-1:1:0)}else{if(r===Ao)return e;o=1,n=new g2(e.__ownerID,[[t,r]])}return e.__ownerID?(e.size=o,e._root=n,e.__hash=void 0,e.__altered=!0,e):n?Nz(o,n):rh()}function zz(e,t,r,n,o,i,a,s){return e?e.update(t,r,n,o,i,a,s):i===Ao?e:(Gd(s),Gd(a),new Jg(t,n,[o,i]))}function tie(e){return e.constructor===Jg||e.constructor===lv}function Hz(e,t,r,n,o){if(e.keyHash===n)return new lv(t,n,[e.entry,o]);var i=(r===0?e.keyHash:e.keyHash>>>r)&yc,a=(r===0?n:n>>>r)&yc,s,l=i===a?[Hz(e,t,r+Fi,n,o)]:(s=new Jg(t,n,o),i<a?[e,s]:[s,e]);return new sv(t,1<<i|1<<a,l)}function xGe(e,t,r,n){e||(e=new Cz);for(var o=new Jg(e,Om(r),[r,n]),i=0;i<t.length;i++){var a=t[i];o=o.update(e,0,void 0,a[0],a[1])}return o}function CGe(e,t,r,n){for(var o=0,i=0,a=new Array(r),s=0,l=1,u=t.length;s<u;s++,l<<=1){var c=t[s];c!==void 0&&s!==n&&(o|=l,a[i++]=c)}return new sv(e,o,a)}function SGe(e,t,r,n,o){for(var i=0,a=new Array(Um),s=0;r!==0;s++,r>>>=1)a[s]=r&1?t[i++]:void 0;return a[n]=o,new y2(e,i+1,a)}function jie(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function Wie(e,t,r,n){var o=n?e:th(e);return o[t]=r,o}function vGe(e,t,r,n){var o=e.length+1;if(n&&t+1===o)return e[t]=r,e;for(var i=new Array(o),a=0,s=0;s<o;s++)s===t?(i[s]=r,a=-1):i[s]=e[s+a];return i}function IGe(e,t,r){var n=e.length-1;if(r&&t===n)return e.pop(),e;for(var o=new Array(n),i=0,a=0;a<n;a++)a===t&&(i=1),o[a]=e[a+i];return o}var AGe=Um/4,TGe=Um/2,PGe=Um/4,Xie="@@__IMMUTABLE_LIST__@@";function Qie(e){return!!(e&&e[Xie])}var ah=function(e){function t(r){var n=SE();if(r==null)return n;if(Qie(r))return r;var o=e(r),i=o.size;return i===0?n:(Gm(i),i>0&&i<Um?b2(0,i,Fi,null,new jb(o.toArray())):n.withMutations(function(a){a.setSize(i),o.forEach(function(s,l){return a.set(l,s)})}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("List [","]")},t.prototype.get=function(n,o){if(n=Wb(this,n),n>=0&&n<this.size){n+=this._origin;var i=Zie(this,n);return i&&i.array[n&yc]}return o},t.prototype.set=function(n,o){return _Ge(this,n,o)},t.prototype.remove=function(n){return this.has(n)?n===0?this.shift():n===this.size-1?this.pop():this.splice(n,1):this},t.prototype.insert=function(n,o){return this.splice(n,0,o)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=Fi,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):SE()},t.prototype.push=function(){var n=arguments,o=this.size;return this.withMutations(function(i){Hb(i,0,o+n.length);for(var a=0;a<n.length;a++)i.set(o+a,n[a])})},t.prototype.pop=function(){return Hb(this,0,-1)},t.prototype.unshift=function(){var n=arguments;return this.withMutations(function(o){Hb(o,-n.length);for(var i=0;i<n.length;i++)o.set(i,n[i])})},t.prototype.shift=function(){return Hb(this,1)},t.prototype.shuffle=function(n){return n===void 0&&(n=Math.random),this.withMutations(function(o){for(var i=o.size,a,s;i;)a=Math.floor(n()*i--),s=o.get(a),o.set(a,o.get(i)),o.set(i,s)})},t.prototype.concat=function(){for(var n=arguments,o=[],i=0;i<arguments.length;i++){var a=n[i],s=e(typeof a!="string"&&Cie(a)?a:[a]);s.size!==0&&o.push(s)}return o.length===0?this:this.size===0&&!this.__ownerID&&o.length===1?this.constructor(o[0]):this.withMutations(function(l){o.forEach(function(u){return u.forEach(function(c){return l.push(c)})})})},t.prototype.setSize=function(n){return Hb(this,0,n)},t.prototype.map=function(n,o){var i=this;return this.withMutations(function(a){for(var s=0;s<i.size;s++)a.set(s,n.call(o,a.get(s),s,i))})},t.prototype.slice=function(n,o){var i=this.size;return PE(n,o,i)?this:Hb(this,S2(n,i),_E(o,i))},t.prototype.__iterator=function(n,o){var i=o?this.size:0,a=rie(this,o);return new No(function(){var s=a();return s===f2?bc():pa(n,o?--i:i++,s)})},t.prototype.__iterate=function(n,o){for(var i=o?this.size:0,a=rie(this,o),s;(s=a())!==f2&&n(s,o?--i:i++,this)!==!1;);return i},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?b2(this._origin,this._capacity,this._level,this._root,this._tail,n,this.__hash):this.size===0?SE():(this.__ownerID=n,this.__altered=!1,this)},t}(v0);ah.isList=Qie;var Gs=ah.prototype;Gs[Xie]=!0;Gs[C2]=Gs.remove;Gs.merge=Gs.concat;Gs.setIn=Mz;Gs.deleteIn=Gs.removeIn=Bz;Gs.update=kz;Gs.updateIn=Lz;Gs.mergeIn=Oz;Gs.mergeDeepIn=Gz;Gs.withMutations=v2;Gs.wasAltered=Uz;Gs.asImmutable=A2;Gs["@@transducer/init"]=Gs.asMutable=I2;Gs["@@transducer/step"]=function(e,t){return e.push(t)};Gs["@@transducer/result"]=function(e){return e.asImmutable()};var jb=function(t,r){this.array=t,this.ownerID=r};jb.prototype.removeBefore=function(t,r,n){if((n&(1<<r+Fi)-1)===0||this.array.length===0)return this;var o=n>>>r&yc;if(o>=this.array.length)return new jb([],t);var i=o===0,a;if(r>0){var s=this.array[o];if(a=s&&s.removeBefore(t,r-Fi,n),a===s&&i)return this}if(i&&!a)return this;var l=uv(this,t);if(!i)for(var u=0;u<o;u++)l.array[u]=void 0;return a&&(l.array[o]=a),l};jb.prototype.removeAfter=function(t,r,n){if(n===(r?1<<r+Fi:Um)||this.array.length===0)return this;var o=n-1>>>r&yc;if(o>=this.array.length)return this;var i;if(r>0){var a=this.array[o];if(i=a&&a.removeAfter(t,r-Fi,n),i===a&&o===this.array.length-1)return this}var s=uv(this,t);return s.array.splice(o+1),i&&(s.array[o]=i),s};var f2={};function rie(e,t){var r=e._origin,n=e._capacity,o=x2(n),i=e._tail;return a(e._root,e._level,0);function a(u,c,m){return c===0?s(u,m):l(u,c,m)}function s(u,c){var m=c===o?i&&i.array:u&&u.array,d=c>r?0:r-c,p=n-c;return p>Um&&(p=Um),function(){if(d===p)return f2;var h=t?--p:d++;return m&&m[h]}}function l(u,c,m){var d,p=u&&u.array,h=m>r?0:r-m>>c,f=(n-m>>c)+1;return f>Um&&(f=Um),function(){for(;;){if(d){var y=d();if(y!==f2)return y;d=null}if(h===f)return f2;var g=t?--f:h++;d=a(p&&p[g],c-Fi,m+(g<<c))}}}}function b2(e,t,r,n,o,i,a){var s=Object.create(Gs);return s.size=t-e,s._origin=e,s._capacity=t,s._level=r,s._root=n,s._tail=o,s.__ownerID=i,s.__hash=a,s.__altered=!1,s}function SE(){return b2(0,0,Fi)}function _Ge(e,t,r){if(t=Wb(e,t),t!==t)return e;if(t>=e.size||t<0)return e.withMutations(function(a){t<0?Hb(a,t).set(0,r):Hb(a,0,t+1).set(t,r)});t+=e._origin;var n=e._tail,o=e._root,i=mz();return t>=x2(e._capacity)?n=yz(n,e.__ownerID,0,t,r,i):o=yz(o,e.__ownerID,e._level,t,r,i),i.value?e.__ownerID?(e._root=o,e._tail=n,e.__hash=void 0,e.__altered=!0,e):b2(e._origin,e._capacity,e._level,o,n):e}function yz(e,t,r,n,o,i){var a=n>>>r&yc,s=e&&a<e.array.length;if(!s&&o===void 0)return e;var l;if(r>0){var u=e&&e.array[a],c=yz(u,t,r-Fi,n,o,i);return c===u?e:(l=uv(e,t),l.array[a]=c,l)}return s&&e.array[a]===o?e:(i&&Gd(i),l=uv(e,t),o===void 0&&a===l.array.length-1?l.array.pop():l.array[a]=o,l)}function uv(e,t){return t&&e&&t===e.ownerID?e:new jb(e?e.array.slice():[],t)}function Zie(e,t){if(t>=x2(e._capacity))return e._tail;if(t<1<<e._level+Fi){for(var r=e._root,n=e._level;r&&n>0;)r=r.array[t>>>n&yc],n-=Fi;return r}}function Hb(e,t,r){t!==void 0&&(t|=0),r!==void 0&&(r|=0);var n=e.__ownerID||new Cz,o=e._origin,i=e._capacity,a=o+t,s=r===void 0?i:r<0?i+r:o+r;if(a===o&&s===i)return e;if(a>=s)return e.clear();for(var l=e._level,u=e._root,c=0;a+c<0;)u=new jb(u&&u.array.length?[void 0,u]:[],n),l+=Fi,c+=1<<l;c&&(a+=c,o+=c,s+=c,i+=c);for(var m=x2(i),d=x2(s);d>=1<<l+Fi;)u=new jb(u&&u.array.length?[u]:[],n),l+=Fi;var p=e._tail,h=d<m?Zie(e,s-1):d>m?new jb([],n):p;if(p&&d>m&&a<i&&p.array.length){u=uv(u,n);for(var f=u,y=l;y>Fi;y-=Fi){var g=m>>>y&yc;f=f.array[g]=uv(f.array[g],n)}f.array[m>>>Fi&yc]=p}if(s<i&&(h=h&&h.removeAfter(n,0,s)),a>=d)a-=d,s-=d,l=Fi,u=null,h=h&&h.removeBefore(n,0,a);else if(a>o||d<m){for(c=0;u;){var x=a>>>l&yc;if(x!==d>>>l&yc)break;x&&(c+=(1<<l)*x),l-=Fi,u=u.array[x]}u&&a>o&&(u=u.removeBefore(n,l,a-c)),u&&d<m&&(u=u.removeAfter(n,l,d-c)),c&&(a-=c,s-=c)}return e.__ownerID?(e.size=s-a,e._origin=a,e._capacity=s,e._level=l,e._root=u,e._tail=h,e.__hash=void 0,e.__altered=!0,e):b2(a,s,l,u,h)}function x2(e){return e<Um?0:e-1>>>Fi<<Fi}var Us=function(e){function t(r){return r==null?c2():Aie(r)?r:c2().withMutations(function(n){var o=Nd(r);Gm(o.size),o.forEach(function(i,a){return n.set(a,i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("OrderedMap {","}")},t.prototype.get=function(n,o){var i=this._map.get(n);return i!==void 0?this._list.get(i)[1]:o},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):c2()},t.prototype.set=function(n,o){return oie(this,n,o)},t.prototype.remove=function(n){return oie(this,n,Ao)},t.prototype.__iterate=function(n,o){var i=this;return this._list.__iterate(function(a){return a&&n(a[1],a[0],i)},o)},t.prototype.__iterator=function(n,o){return this._list.fromEntrySeq().__iterator(n,o)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var o=this._map.__ensureOwner(n),i=this._list.__ensureOwner(n);return n?jz(o,i,n,this.__hash):this.size===0?c2():(this.__ownerID=n,this.__altered=!1,this._map=o,this._list=i,this)},t}(Xm);Us.isOrderedMap=Aie;Us.prototype[Xb]=!0;Us.prototype[C2]=Us.prototype.remove;function jz(e,t,r,n){var o=Object.create(Us.prototype);return o.size=e?e.size:0,o._map=e,o._list=t,o.__ownerID=r,o.__hash=n,o.__altered=!1,o}var nie;function c2(){return nie||(nie=jz(rh(),SE()))}function oie(e,t,r){var n=e._map,o=e._list,i=n.get(t),a=i!==void 0,s,l;if(r===Ao){if(!a)return e;o.size>=Um&&o.size>=n.size*2?(l=o.filter(function(u,c){return u!==void 0&&i!==c}),s=l.toKeyedSeq().map(function(u){return u[0]}).flip().toMap(),e.__ownerID&&(s.__ownerID=l.__ownerID=e.__ownerID)):(s=n.remove(t),l=i===o.size-1?o.pop():o.set(i,void 0))}else if(a){if(r===o.get(i)[1])return e;s=n,l=o.set(i,[t,r])}else s=n.set(t,o.size),l=o.set(o.size,[t,r]);return e.__ownerID?(e.size=s.size,e._map=s,e._list=l,e.__hash=void 0,e.__altered=!0,e):jz(s,l)}var qie="@@__IMMUTABLE_STACK__@@";function bz(e){return!!(e&&e[qie])}var Wz=function(e){function t(r){return r==null?xE():bz(r)?r:xE().pushAll(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("Stack [","]")},t.prototype.get=function(n,o){var i=this._head;for(n=Wb(this,n);i&&n--;)i=i.next;return i?i.value:o},t.prototype.peek=function(){return this._head&&this._head.value},t.prototype.push=function(){var n=arguments;if(arguments.length===0)return this;for(var o=this.size+arguments.length,i=this._head,a=arguments.length-1;a>=0;a--)i={value:n[a],next:i};return this.__ownerID?(this.size=o,this._head=i,this.__hash=void 0,this.__altered=!0,this):m2(o,i)},t.prototype.pushAll=function(n){if(n=e(n),n.size===0)return this;if(this.size===0&&bz(n))return n;Gm(n.size);var o=this.size,i=this._head;return n.__iterate(function(a){o++,i={value:a,next:i}},!0),this.__ownerID?(this.size=o,this._head=i,this.__hash=void 0,this.__altered=!0,this):m2(o,i)},t.prototype.pop=function(){return this.slice(1)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):xE()},t.prototype.slice=function(n,o){if(PE(n,o,this.size))return this;var i=S2(n,this.size),a=_E(o,this.size);if(a!==this.size)return e.prototype.slice.call(this,n,o);for(var s=this.size-i,l=this._head;i--;)l=l.next;return this.__ownerID?(this.size=s,this._head=l,this.__hash=void 0,this.__altered=!0,this):m2(s,l)},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?m2(this.size,this._head,n,this.__hash):this.size===0?xE():(this.__ownerID=n,this.__altered=!1,this)},t.prototype.__iterate=function(n,o){var i=this;if(o)return new iv(this.toArray()).__iterate(function(l,u){return n(l,u,i)},o);for(var a=0,s=this._head;s&&n(s.value,a++,this)!==!1;)s=s.next;return a},t.prototype.__iterator=function(n,o){if(o)return new iv(this.toArray()).__iterator(n,o);var i=0,a=this._head;return new No(function(){if(a){var s=a.value;return a=a.next,pa(n,i++,s)}return bc()})},t}(v0);Wz.isStack=bz;var xc=Wz.prototype;xc[qie]=!0;xc.shift=xc.pop;xc.unshift=xc.push;xc.unshiftAll=xc.pushAll;xc.withMutations=v2;xc.wasAltered=Uz;xc.asImmutable=A2;xc["@@transducer/init"]=xc.asMutable=I2;xc["@@transducer/step"]=function(e,t){return e.unshift(t)};xc["@@transducer/result"]=function(e){return e.asImmutable()};function m2(e,t,r,n){var o=Object.create(xc);return o.size=e,o._head=t,o.__ownerID=r,o.__hash=n,o.__altered=!1,o}var iie;function xE(){return iie||(iie=m2(0))}var Yie="@@__IMMUTABLE_SET__@@";function Xz(e){return!!(e&&e[Yie])}function Kie(e){return Xz(e)&&nh(e)}function Jie(e,t){if(e===t)return!0;if(!zm(t)||e.size!==void 0&&t.size!==void 0&&e.size!==t.size||e.__hash!==void 0&&t.__hash!==void 0&&e.__hash!==t.__hash||da(e)!==da(t)||Ud(e)!==Ud(t)||nh(e)!==nh(t))return!1;if(e.size===0&&t.size===0)return!0;var r=!Sz(e);if(nh(e)){var n=e.entries();return t.every(function(l,u){var c=n.next().value;return c&&Nm(c[1],l)&&(r||Nm(c[0],u))})&&n.next().done}var o=!1;if(e.size===void 0)if(t.size===void 0)typeof e.cacheResult=="function"&&e.cacheResult();else{o=!0;var i=e;e=t,t=i}var a=!0,s=t.__iterate(function(l,u){if(r?!e.has(l):o?!Nm(l,e.get(u,Ao)):!Nm(e.get(u,Ao),l))return a=!1,!1});return a&&e.size===s}function A0(e,t){var r=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r),e}function TE(e){if(!e||typeof e!="object")return e;if(!zm(e)){if(!Qb(e))return e;e=em(e)}if(da(e)){var t={};return e.__iterate(function(n,o){t[o]=TE(n)}),t}var r=[];return e.__iterate(function(n){r.push(TE(n))}),r}var ME=function(e){function t(r){return r==null?d2():Xz(r)&&!nh(r)?r:d2().withMutations(function(n){var o=e(r);Gm(o.size),o.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(Nd(n).keySeq())},t.intersect=function(n){return n=Vu(n).toArray(),n.length?au.intersect.apply(t(n.pop()),n):d2()},t.union=function(n){return n=Vu(n).toArray(),n.length?au.union.apply(t(n.pop()),n):d2()},t.prototype.toString=function(){return this.__toString("Set {","}")},t.prototype.has=function(n){return this._map.has(n)},t.prototype.add=function(n){return CE(this,this._map.set(n,n))},t.prototype.remove=function(n){return CE(this,this._map.remove(n))},t.prototype.clear=function(){return CE(this,this._map.clear())},t.prototype.map=function(n,o){var i=this,a=!1,s=CE(this,this._map.mapEntries(function(l){var u=l[1],c=n.call(o,u,u,i);return c!==u&&(a=!0),[c,c]},o));return a?s:this},t.prototype.union=function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];return n=n.filter(function(i){return i.size!==0}),n.length===0?this:this.size===0&&!this.__ownerID&&n.length===1?this.constructor(n[0]):this.withMutations(function(i){for(var a=0;a<n.length;a++)typeof n[a]=="string"?i.add(n[a]):e(n[a]).forEach(function(s){return i.add(s)})})},t.prototype.intersect=function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];if(n.length===0)return this;n=n.map(function(a){return e(a)});var i=[];return this.forEach(function(a){n.every(function(s){return s.includes(a)})||i.push(a)}),this.withMutations(function(a){i.forEach(function(s){a.remove(s)})})},t.prototype.subtract=function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];if(n.length===0)return this;n=n.map(function(a){return e(a)});var i=[];return this.forEach(function(a){n.some(function(s){return s.includes(a)})&&i.push(a)}),this.withMutations(function(a){i.forEach(function(s){a.remove(s)})})},t.prototype.sort=function(n){return Wm(av(this,n))},t.prototype.sortBy=function(n,o){return Wm(av(this,o,n))},t.prototype.wasAltered=function(){return this._map.wasAltered()},t.prototype.__iterate=function(n,o){var i=this;return this._map.__iterate(function(a){return n(a,a,i)},o)},t.prototype.__iterator=function(n,o){return this._map.__iterator(n,o)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var o=this._map.__ensureOwner(n);return n?this.__make(o,n):this.size===0?this.__empty():(this.__ownerID=n,this._map=o,this)},t}(dv);ME.isSet=Xz;var au=ME.prototype;au[Yie]=!0;au[C2]=au.remove;au.merge=au.concat=au.union;au.withMutations=v2;au.asImmutable=A2;au["@@transducer/init"]=au.asMutable=I2;au["@@transducer/step"]=function(e,t){return e.add(t)};au["@@transducer/result"]=function(e){return e.asImmutable()};au.__empty=d2;au.__make=$ie;function CE(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:t.size===0?e.__empty():e.__make(t)}function $ie(e,t){var r=Object.create(au);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}var aie;function d2(){return aie||(aie=$ie(rh()))}var RGe=function(e){function t(r,n,o){if(o===void 0&&(o=1),!(this instanceof t))return new t(r,n,o);if(p2(o!==0,"Cannot step a Range by 0"),p2(r!==void 0,"You must define a start value when using Range"),p2(n!==void 0,"You must define an end value when using Range"),o=Math.abs(o),n<r&&(o=-o),this._start=r,this._end=n,this._step=o,this.size=Math.max(0,Math.ceil((n-r)/o-1)+1),this.size===0){if(uz)return uz;uz=this}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},t.prototype.get=function(n,o){return this.has(n)?this._start+Wb(this,n)*this._step:o},t.prototype.includes=function(n){var o=(n-this._start)/this._step;return o>=0&&o<this.size&&o===Math.floor(o)},t.prototype.slice=function(n,o){return PE(n,o,this.size)?this:(n=S2(n,this.size),o=_E(o,this.size),o<=n?new t(0,0):new t(this.get(n,this._end),this.get(o,this._end),this._step))},t.prototype.indexOf=function(n){var o=n-this._start;if(o%this._step===0){var i=o/this._step;if(i>=0&&i<this.size)return i}return-1},t.prototype.lastIndexOf=function(n){return this.indexOf(n)},t.prototype.__iterate=function(n,o){for(var i=this.size,a=this._step,s=o?this._start+(i-1)*a:this._start,l=0;l!==i&&n(s,o?i-++l:l++,this)!==!1;)s+=o?-a:a;return l},t.prototype.__iterator=function(n,o){var i=this.size,a=this._step,s=o?this._start+(i-1)*a:this._start,l=0;return new No(function(){if(l===i)return bc();var u=s;return s+=o?-a:a,pa(n,o?i-++l:l++,u)})},t.prototype.equals=function(n){return n instanceof t?this._start===n._start&&this._end===n._end&&this._step===n._step:Jie(this,n)},t}(ef),uz;function eae(e,t,r){for(var n=Lie(t),o=0;o!==n.length;)if(e=Fie(e,n[o++],Ao),e===Ao)return r;return e}function tae(e,t){return eae(this,e,t)}function DGe(e,t){return eae(e,t,Ao)!==Ao}function wGe(e){return DGe(this,e)}function rae(){Gm(this.size);var e={};return this.__iterate(function(t,r){e[r]=t}),e}Vu.Iterator=No;A0(Vu,{toArray:function(){Gm(this.size);var t=new Array(this.size||0),r=da(this),n=0;return this.__iterate(function(o,i){t[n++]=r?[i,o]:o}),t},toIndexedSeq:function(){return new Pie(this)},toJS:function(){return TE(this)},toKeyedSeq:function(){return new EE(this,!0)},toMap:function(){return Xm(this.toKeyedSeq())},toObject:rae,toOrderedMap:function(){return Us(this.toKeyedSeq())},toOrderedSet:function(){return Wm(da(this)?this.valueSeq():this)},toSet:function(){return ME(da(this)?this.valueSeq():this)},toSetSeq:function(){return new _ie(this)},toSeq:function(){return Ud(this)?this.toIndexedSeq():da(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Wz(da(this)?this.valueSeq():this)},toList:function(){return ah(da(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(t,r){return this.size===0?t+r:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+r},concat:function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return Li(this,aGe(this,t))},includes:function(t){return this.some(function(r){return Nm(r,t)})},entries:function(){return this.__iterator(jm)},every:function(t,r){Gm(this.size);var n=!0;return this.__iterate(function(o,i,a){if(!t.call(r,o,i,a))return n=!1,!1}),n},filter:function(t,r){return Li(this,Eie(this,t,r,!0))},partition:function(t,r){return nGe(this,t,r)},find:function(t,r,n){var o=this.findEntry(t,r);return o?o[1]:n},forEach:function(t,r){return Gm(this.size),this.__iterate(r?t.bind(r):t)},join:function(t){Gm(this.size),t=t!==void 0?""+t:",";var r="",n=!0;return this.__iterate(function(o){n?n=!1:r+=t,r+=o!=null?o.toString():""}),r},keys:function(){return this.__iterator(pv)},map:function(t,r){return Li(this,wie(this,t,r))},reduce:function(t,r,n){return sie(this,t,r,n,arguments.length<2,!1)},reduceRight:function(t,r,n){return sie(this,t,r,n,arguments.length<2,!0)},reverse:function(){return Li(this,Rz(this,!0))},slice:function(t,r){return Li(this,Dz(this,t,r,!0))},some:function(t,r){Gm(this.size);var n=!1;return this.__iterate(function(o,i,a){if(t.call(r,o,i,a))return n=!0,!1}),n},sort:function(t){return Li(this,av(this,t))},values:function(){return this.__iterator(Hm)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(t,r){return ov(t?this.toSeq().filter(t,r):this)},countBy:function(t,r){return tGe(this,t,r)},equals:function(t){return Jie(this,t)},entrySeq:function(){var t=this;if(t._cache)return new iv(t._cache);var r=t.toSeq().map(MGe).toIndexedSeq();return r.fromEntrySeq=function(){return t.toSeq()},r},filterNot:function(t,r){return this.filter(cz(t),r)},findEntry:function(t,r,n){var o=n;return this.__iterate(function(i,a,s){if(t.call(r,i,a,s))return o=[a,i],!1}),o},findKey:function(t,r){var n=this.findEntry(t,r);return n&&n[0]},findLast:function(t,r,n){return this.toKeyedSeq().reverse().find(t,r,n)},findLastEntry:function(t,r,n){return this.toKeyedSeq().reverse().findEntry(t,r,n)},findLastKey:function(t,r){return this.toKeyedSeq().reverse().findKey(t,r)},first:function(t){return this.find(pie,null,t)},flatMap:function(t,r){return Li(this,sGe(this,t,r))},flatten:function(t){return Li(this,Bie(this,t,!0))},fromEntrySeq:function(){return new Rie(this)},get:function(t,r){return this.find(function(n,o){return Nm(o,t)},void 0,r)},getIn:tae,groupBy:function(t,r){return rGe(this,t,r)},has:function(t){return this.get(t,Ao)!==Ao},hasIn:wGe,isSubset:function(t){return t=typeof t.includes=="function"?t:Vu(t),this.every(function(r){return t.includes(r)})},isSuperset:function(t){return t=typeof t.isSubset=="function"?t:Vu(t),t.isSubset(this)},keyOf:function(t){return this.findKey(function(r){return Nm(r,t)})},keySeq:function(){return this.toSeq().map(EGe).toIndexedSeq()},last:function(t){return this.toSeq().reverse().first(t)},lastKeyOf:function(t){return this.toKeyedSeq().reverse().keyOf(t)},max:function(t){return yE(this,t)},maxBy:function(t,r){return yE(this,r,t)},min:function(t){return yE(this,t?lie(t):cie)},minBy:function(t,r){return yE(this,r?lie(r):cie,t)},rest:function(){return this.slice(1)},skip:function(t){return t===0?this:this.slice(Math.max(0,t))},skipLast:function(t){return t===0?this:this.slice(0,-Math.max(0,t))},skipWhile:function(t,r){return Li(this,Mie(this,t,r,!0))},skipUntil:function(t,r){return this.skipWhile(cz(t),r)},sortBy:function(t,r){return Li(this,av(this,r,t))},take:function(t){return this.slice(0,Math.max(0,t))},takeLast:function(t){return this.slice(-Math.max(0,t))},takeWhile:function(t,r){return Li(this,oGe(this,t,r))},takeUntil:function(t,r){return this.takeWhile(cz(t),r)},update:function(t){return t(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=BGe(this))}});var Ou=Vu.prototype;Ou[gie]=!0;Ou[RE]=Ou.values;Ou.toJSON=Ou.toArray;Ou.__toStringMapper=h2;Ou.inspect=Ou.toSource=function(){return this.toString()};Ou.chain=Ou.flatMap;Ou.contains=Ou.includes;A0(Nd,{flip:function(){return Li(this,Die(this))},mapEntries:function(t,r){var n=this,o=0;return Li(this,this.toSeq().map(function(i,a){return t.call(r,[a,i],o++,n)}).fromEntrySeq())},mapKeys:function(t,r){var n=this;return Li(this,this.toSeq().flip().map(function(o,i){return t.call(r,o,i,n)}).flip())}});var T2=Nd.prototype;T2[vE]=!0;T2[RE]=Ou.entries;T2.toJSON=rae;T2.__toStringMapper=function(e,t){return h2(t)+": "+h2(e)};A0(v0,{toKeyedSeq:function(){return new EE(this,!1)},filter:function(t,r){return Li(this,Eie(this,t,r,!1))},findIndex:function(t,r){var n=this.findEntry(t,r);return n?n[0]:-1},indexOf:function(t){var r=this.keyOf(t);return r===void 0?-1:r},lastIndexOf:function(t){var r=this.lastKeyOf(t);return r===void 0?-1:r},reverse:function(){return Li(this,Rz(this,!1))},slice:function(t,r){return Li(this,Dz(this,t,r,!1))},splice:function(t,r){var n=arguments.length;if(r=Math.max(r||0,0),n===0||n===2&&!r)return this;t=S2(t,t<0?this.count():this.size);var o=this.slice(0,t);return Li(this,n===1?o:o.concat(th(arguments,2),this.slice(t+r)))},findLastIndex:function(t,r){var n=this.findLastEntry(t,r);return n?n[0]:-1},first:function(t){return this.get(0,t)},flatten:function(t){return Li(this,Bie(this,t,!1))},get:function(t,r){return t=Wb(this,t),t<0||this.size===1/0||this.size!==void 0&&t>this.size?r:this.find(function(n,o){return o===t},void 0,r)},has:function(t){return t=Wb(this,t),t>=0&&(this.size!==void 0?this.size===1/0||t<this.size:this.indexOf(t)!==-1)},interpose:function(t){return Li(this,lGe(this,t))},interleave:function(){var t=[this].concat(th(arguments)),r=bE(this.toSeq(),ef.of,t),n=r.flatten(!0);return r.size&&(n.size=r.size*t.length),Li(this,n)},keySeq:function(){return RGe(0,this.size)},last:function(t){return this.get(-1,t)},skipWhile:function(t,r){return Li(this,Mie(this,t,r,!1))},zip:function(){var t=[this].concat(th(arguments));return Li(this,bE(this,uie,t))},zipAll:function(){var t=[this].concat(th(arguments));return Li(this,bE(this,uie,t,!0))},zipWith:function(t){var r=th(arguments);return r[0]=this,Li(this,bE(this,t,r))}});var yv=v0.prototype;yv[IE]=!0;yv[Xb]=!0;A0(dv,{get:function(t,r){return this.has(t)?t:r},includes:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}});var cv=dv.prototype;cv.has=Ou.includes;cv.contains=cv.includes;cv.keys=cv.values;A0(Zb,T2);A0(ef,yv);A0(hv,cv);function sie(e,t,r,n,o,i){return Gm(e.size),e.__iterate(function(a,s,l){o?(o=!1,r=a):r=t.call(n,r,a,s,l)},i),r}function EGe(e,t){return t}function MGe(e,t){return[t,e]}function cz(e){return function(){return!e.apply(this,arguments)}}function lie(e){return function(){return-e.apply(this,arguments)}}function uie(){return th(arguments)}function cie(e,t){return e<t?1:e>t?-1:0}function BGe(e){if(e.size===1/0)return 0;var t=nh(e),r=da(e),n=t?1:0;return e.__iterate(r?t?function(o,i){n=31*n+mie(Om(o),Om(i))|0}:function(o,i){n=n+mie(Om(o),Om(i))|0}:t?function(o){n=31*n+Om(o)|0}:function(o){n=n+Om(o)|0}),kGe(e.size,n)}function kGe(e,t){return t=u2(t,3432918353),t=u2(t<<15|t>>>-15,461845907),t=u2(t<<13|t>>>-13,5),t=(t+3864292196|0)^e,t=u2(t^t>>>16,2246822507),t=u2(t^t>>>13,3266489909),t=wE(t^t>>>16),t}function mie(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}var Wm=function(e){function t(r){return r==null?xz():Kie(r)?r:xz().withMutations(function(n){var o=dv(r);Gm(o.size),o.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(Nd(n).keySeq())},t.prototype.toString=function(){return this.__toString("OrderedSet {","}")},t}(ME);Wm.isOrderedSet=Kie;var T0=Wm.prototype;T0[Xb]=!0;T0.zip=yv.zip;T0.zipWith=yv.zipWith;T0.zipAll=yv.zipAll;T0.__empty=xz;T0.__make=nae;function nae(e,t){var r=Object.create(T0);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}var die;function xz(){return die||(die=nae(c2()))}function LGe(e){if(I0(e))throw new Error("Can not call `Record` with an immutable Record as default values. Use a plain javascript object instead.");if(oh(e))throw new Error("Can not call `Record` with an immutable Collection as default values. Use a plain javascript object instead.");if(e===null||typeof e!="object")throw new Error("Can not call `Record` with a non-object as default values. Use a plain javascript object instead.")}var Il=function(t,r){var n;LGe(t);var o=function(s){var l=this;if(s instanceof o)return s;if(!(this instanceof o))return new o(s);if(!n){n=!0;var u=Object.keys(t),c=i._indices={};i._name=r,i._keys=u,i._defaultValues=t;for(var m=0;m<u.length;m++){var d=u[m];c[d]=m,i[d]?typeof console=="object"&&console.warn&&console.warn("Cannot define "+Zz(this)+' with property "'+d+'" since that property name is part of the Record API.'):FGe(i,d)}}return this.__ownerID=void 0,this._values=ah().withMutations(function(p){p.setSize(l._keys.length),Nd(s).forEach(function(h,f){p.set(l._indices[f],h===l._defaultValues[f]?void 0:h)})}),this},i=o.prototype=Object.create(Qi);return i.constructor=o,r&&(o.displayName=r),o};Il.prototype.toString=function(){for(var t=Zz(this)+" { ",r=this._keys,n,o=0,i=r.length;o!==i;o++)n=r[o],t+=(o?", ":"")+n+": "+h2(this.get(n));return t+" }"};Il.prototype.equals=function(t){return this===t||I0(t)&&mv(this).equals(mv(t))};Il.prototype.hashCode=function(){return mv(this).hashCode()};Il.prototype.has=function(t){return this._indices.hasOwnProperty(t)};Il.prototype.get=function(t,r){if(!this.has(t))return r;var n=this._indices[t],o=this._values.get(n);return o===void 0?this._defaultValues[t]:o};Il.prototype.set=function(t,r){if(this.has(t)){var n=this._values.set(this._indices[t],r===this._defaultValues[t]?void 0:r);if(n!==this._values&&!this.__ownerID)return Qz(this,n)}return this};Il.prototype.remove=function(t){return this.set(t)};Il.prototype.clear=function(){var t=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:Qz(this,t)};Il.prototype.wasAltered=function(){return this._values.wasAltered()};Il.prototype.toSeq=function(){return mv(this)};Il.prototype.toJS=function(){return TE(this)};Il.prototype.entries=function(){return this.__iterator(jm)};Il.prototype.__iterator=function(t,r){return mv(this).__iterator(t,r)};Il.prototype.__iterate=function(t,r){return mv(this).__iterate(t,r)};Il.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var r=this._values.__ensureOwner(t);return t?Qz(this,r,t):(this.__ownerID=t,this._values=r,this)};Il.isRecord=I0;Il.getDescriptiveName=Zz;var Qi=Il.prototype;Qi[bie]=!0;Qi[C2]=Qi.remove;Qi.deleteIn=Qi.removeIn=Bz;Qi.getIn=tae;Qi.hasIn=Ou.hasIn;Qi.merge=Gie;Qi.mergeWith=Uie;Qi.mergeIn=Oz;Qi.mergeDeep=zie;Qi.mergeDeepWith=Hie;Qi.mergeDeepIn=Gz;Qi.setIn=Mz;Qi.update=kz;Qi.updateIn=Lz;Qi.withMutations=v2;Qi.asMutable=I2;Qi.asImmutable=A2;Qi[RE]=Qi.entries;Qi.toJSON=Qi.toObject=Ou.toObject;Qi.inspect=Qi.toSource=function(){return this.toString()};function Qz(e,t,r){var n=Object.create(Object.getPrototypeOf(e));return n._values=t,n.__ownerID=r,n}function Zz(e){return e.constructor.displayName||e.constructor.name||"Record"}function mv(e){return Tz(e._keys.map(function(t){return[t,e.get(t)]}))}function FGe(e,t){try{Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(r){p2(this.__ownerID,"Cannot set on an immutable record."),this.set(t,r)}})}catch{}}var tm={is(e){return typeof e.charCodeAt=="function"},toString(e){try{return e.toString()}catch(t){throw new Error(`Failed to convert StringLike object into string. This might be because the length ${e.length} exceeds maximum allowed string length ${P0}. (${t})`)}}},P0=536870888,BE=28,kE=class e{constructor(t=BE){this._chunks=[];this._length=0;this._tmpArray=[];this.STRING_CHUNK_SIZE=2**t,this.STRING_CHUNK_SHIFT=t,this.STRING_CHUNK_MASK=2**t-1}get length(){return this._length}static fromString(t,r=BE){let n=new e(r);return n._append(t),n}static fromStrings(t,r=BE){let n=new e(r);for(let o of t)n._append(o);return n}static fromUtf8Data(t,r=0,n=t.length,o=BE){let i=2**o,a=[],s=r;for(;s<n;){let l=Math.min(s+i,n);if(l<n){for(;(t[l]&192)===128;)if(l--,l===s)throw new Error("Input is rubbish, no UTF-8 character start found in a chunk")}let u=sh(t,s,l-s);a.push(u),s=l}return e.fromStrings(a,o)}_append(t){let r=this.STRING_CHUNK_SIZE,n=this._chunks.length===0||this._chunks[this._chunks.length-1].length===r?"":this._chunks.pop(),o=r-n.length;for(this._chunks.push(n+t.substring(0,o));o<t.length;)this._chunks.push(t.substring(o,o+r)),o+=r;this._length+=t.length}_getChunkIndex(t){return t>>>this.STRING_CHUNK_SHIFT}_getIndexInChunk(t){return t&this.STRING_CHUNK_MASK}_isOutOfRange(t){return t<0||t>=this.length}at(t){return-this.length<=t&&t<0?this.at(t+this.length):this.charAt(t)||void 0}charAt(t){if(this._isOutOfRange(t))return"";let r=this._getChunkIndex(t),n=this._getIndexInChunk(t);return this._chunks[r][n]}charCodeAt(t){if(this._isOutOfRange(t))return NaN;let r=this._getChunkIndex(t),n=this._getIndexInChunk(t);return this._chunks[r].charCodeAt(n)}substring(t,r){let n=Math.min(Math.max(t??0,0),this.length),o=Math.min(Math.max(r??this.length,0),this.length);if(n>o)return this.substring(o,n);if(n===o)return"";if(o-n>P0)throw new Error(`Trying to create get a substring longer (${o-n}) than maximum allowed string length (${P0}).`);let i=this._getChunkIndex(n),a=this._getIndexInChunk(n),s=this._getChunkIndex(o),l=this._getIndexInChunk(o);if(i===s)return this._chunks[i].substring(a,l);{let u=this._getTmpArray();u.push(this._chunks[i].substring(a,this.STRING_CHUNK_SIZE));for(let c=i+1;c<s;c++)u.push(this._chunks[c]);return u.push(this._chunks[s].substring(0,l)),u.join("")}}_getTmpArray(){for(;this._tmpArray.length;)this._tmpArray.pop();return this._tmpArray}indexOf(t,r=0){if(t.length>this.STRING_CHUNK_SIZE)throw new Error("NotImplementedError: indexOf is only implemented for searchString shorter than STRING_CHUNK_SIZE");r<0&&(r=0);let n=this._getChunkIndex(r);for(let o=n;o<this._chunks.length;o++){let i=this._chunks[o],a=o===n?this._getIndexInChunk(r):0,s=i.indexOf(t,a);if(s>=0)return o*this.STRING_CHUNK_SIZE+s;if(o!==this._chunks.length-1){let l=Math.max(this.STRING_CHUNK_SIZE-t.length+1,a),c=(i.substring(l,void 0)+this._chunks[o+1].substring(0,t.length-1)).indexOf(t);if(c>=0)return o*this.STRING_CHUNK_SIZE+l+c}}return-1}includes(t,r=0){return this.indexOf(t,r)>=0}startsWith(t,r=0){if(t.length>this.STRING_CHUNK_SIZE)throw new Error("NotImplementedError: startsWith is only implemented for searchString shorter than STRING_CHUNK_SIZE");return this.substring(r,r+t.length)===t}toString(){try{return this._chunks.join("")}catch(t){throw new Error(`Failed to convert StringLike object into string. This might be because the length ${this.length} exceeds maximum allowed string length ${P0}. (${t})`)}}};function qb(e,t,r){for(let n=0,o=r.length;n<o;n++){let i=r.charCodeAt(n);if(i<128){e[t++]=i>>>0&127|0;continue}if(i<2048){e[t++]=i>>>6&31|192,e[t++]=i>>>0&63|128;continue}if(i<65536){e[t++]=i>>>12&15|224,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}if(i<1114112){e[t++]=i>>>18&7|240,e[t++]=i>>>12&63|128,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}throw new Error("bad codepoint "+i)}}var VGe=function(){let e=[];for(let t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function iae(e){throw new Error(e)}function OGe(e,t,r){let n=VGe,o,i=0,a=[],s=512;for(let l=t,u=t+r;l<u;l++){let c=e[l];(c&128)===0?a[i++]=n[c]:(c&224)===192?a[i++]=n[(c&15)<<6|e[++l]&63]:(c&240)===224?a[i++]=String.fromCharCode((c&15)<<12|(e[++l]&63)<<6|(e[++l]&63)<<0):(c&248)===240?a[i++]=String.fromCharCode((c&7)<<18|(e[++l]&63)<<12|(e[++l]&63)<<6|(e[++l]&63)<<0):iae("Invalid byte "+c.toString(16)),i===s&&(o=o||[],o[o.length]=a.join(""),i=0)}return o?(i>0&&(o[o.length]=a.slice(0,i).join("")),o.join("")):a.slice(0,i).join("")}var oae=typeof TextDecoder<"u"?new TextDecoder:void 0;function sh(e,t=0,r=e.length){if(oae){let n=t||r!==e.length?e.subarray(t,t+r):e;return oae.decode(n)}else return OGe(e,t,r)}function LE(e,t=0,r=e.length){if(r<=P0)return sh(e,t,r);let n=kE.fromUtf8Data(e,t,t+r);return n.length<=P0?n.toString():n}function bv(e){let t=0;for(let r=0,n=e.length;r<n;r++){let o=e.charCodeAt(r);if(o<128){t+=1;continue}if(o<2048){t+=2;continue}if(o<65536){t+=3;continue}if(o<1114112){t+=4;continue}iae("bad codepoint "+o)}return t}function GGe(){let e=function(){let f=typeof window<"u"&&window,y=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self;return f||typeof global<"u"&&global||y}(),t={},r=typeof document<"u"?document:void 0,n=1,o;function i(f,...y){typeof f!="function"&&(f=new Function(""+f));let g={callback:f,args:y};return t[n]=g,o(n),n++}function a(f){delete t[f]}function s(f){let y=f.callback,g=f.args;switch(g.length){case 0:y();break;case 1:y(g[0]);break;case 2:y(g[0],g[1]);break;case 3:y(g[0],g[1],g[2]);break;default:y.apply(void 0,g);break}}function l(f){let y=t[f];a(f),s(y)}function u(){o=function(f){process.nextTick(function(){l(f)})}}function c(){if(e&&e.postMessage&&!e.importScripts){let f=!0,y=e.onmessage;return e.onmessage=function(){f=!1},e.postMessage("","*"),e.onmessage=y,f}}function m(){let f="setImmediate$"+Math.random()+"$",y=function(g){g.source===e&&typeof g.data=="string"&&g.data.indexOf(f)===0&&l(+g.data.slice(f.length))};window.addEventListener?window.addEventListener("message",y,!1):window.attachEvent("onmessage",y),o=function(g){window.postMessage(f+g,"*")}}function d(){let f=new MessageChannel;f.port1.onmessage=function(y){let g=y.data;l(g)},o=function(y){f.port2.postMessage(y)}}function p(){let f=r.documentElement;o=function(y){let g=r.createElement("script");g.onreadystatechange=function(){l(y),g.onreadystatechange=null,f.removeChild(g),g=null},f.appendChild(g)}}function h(){o=function(f){setTimeout(l,0,f)}}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?u():c()?m():typeof MessageChannel<"u"?d():r&&"onreadystatechange"in r.createElement("script")?p():h(),{setImmediate:i,clearImmediate:a}}var qz=function(){return typeof setImmediate<"u"?typeof window<"u"?{setImmediate:(e,...t)=>window.setImmediate(e,...t),clearImmediate:e=>window.clearImmediate(e)}:{setImmediate,clearImmediate}:GGe()}();function UGe(e){qz.setImmediate(e)}var $g={setImmediate:qz.setImmediate,clearImmediate:qz.clearImmediate,immediatePromise(){return new Promise(UGe)},delay(e,t=void 0){return new Promise(r=>setTimeout(r,e,t))}};var Yb=function(){try{return!0}catch{return!1}}(),$t=function(){try{return!1}catch{return!1}}(),He=!1;var FE=[];function aae(e){FE.includes(e)||FE.push(e)}function sae(e){let t=FE.indexOf(e);t!==-1&&FE.splice(t,1)}var NGe=typeof performance<"u"&&!!performance.mark&&performance.measure,Yz=NGe&&He,P2;(i=>{function e(a){return`startTask${a.id}`}function t(a){return`endTask${a.id}`}function r(a){Yz&&performance.mark(e(a))}i.markStart=r;function n(a){Yz&&performance.mark(t(a))}i.markEnd=n;function o(a){Yz&&performance.measure(`\u2733\uFE0F ${a.name}`,e(a),t(a))}i.measure=o})(P2||={});function lae(e,t,r=250){let n=dae(e,t,r),o=new VE(n,n.root);return Kz(e,o)}function uae(e,t,r=250){let n=dae(e,t,r);return new VE(n,n.root)}function OE(e,t){return Kz(t,e)}function cae(e,t,r){return e.runChild(t,r)}function mae(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function dae(e,t,r){let n={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:r,lastNotified:Mn(),observer:t,abortToken:n,taskId:e.id,root:{progress:mae(e),children:[]},tryAbort:zGe(n)}}function zGe(e){return t=>{e.abortRequested=!0,e.reason=t||e.reason}}function pae(e){return{progress:{...e.progress},children:e.children.map(pae)}}function fae(e){return e.progress.canAbort&&e.children.every(fae)}function HGe(e){return{root:pae(e.root),canAbort:fae(e.root),requestAbort:e.tryAbort}}async function Kz(e,t){P2.markStart(e),t.node.progress.startedTime=Mn();try{let r=await e.f(t);return P2.markEnd(e),P2.measure(e),t.info.abortToken.abortRequested&&hae(t.info),r}catch(r){throw Pe.isAbort(r)&&(t.isAborted=!0,t.node.children.length>0&&await new Promise(n=>{t.onChildrenFinished=n}),e.onAbort&&e.onAbort()),r}}function hae(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,gae(e.root),yae(e,Mn())),Pe.Aborted(e.abortToken.reason)}function gae(e){let t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(let r of e.children)gae(r)}function yae(e,t){e.lastNotified=t;let r=HGe(e);e.observer(r)}var VE=class e{constructor(t,r){this.isSynchronous=!1;this.isExecuting=!0;this.lastUpdatedTime=0;this.onChildrenFinished=void 0;this.node=r,this.info=t}checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,hae(this.info))}get shouldUpdate(){return this.checkAborted(),Mn()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(t){if(this.checkAborted(),!t)return;let r=this.node.progress;typeof t=="string"?(r.message=t,r.isIndeterminate=!0):(typeof t.canAbort<"u"&&(r.canAbort=t.canAbort),typeof t.message<"u"&&(r.message=t.message),typeof t.current<"u"&&(r.current=t.current),typeof t.max<"u"&&(r.max=t.max),r.isIndeterminate=typeof r.current>"u"||typeof r.max>"u",typeof t.isIndeterminate<"u"&&(r.isIndeterminate=t.isIndeterminate))}update(t,r){if(this.lastUpdatedTime=Mn(),this.updateProgress(t),!r)return yae(this.info,this.lastUpdatedTime),this.checkAborted(),$g.immediatePromise()}async runChild(t,r){this.updateProgress(r);let n={progress:mae(t),children:[]},o=this.node.children;o.push(n);let i=new e(this.info,n);try{return await Kz(t,i)}catch(a){if(Pe.isAbort(a)&&this.isAborted)return;throw a}finally{let a=o.indexOf(n);if(a>=0){for(let s=a,l=o.length-1;s<l;s++)o[s]=o[s+1];o.pop()}o.length===0&&this.onChildrenFinished&&this.onChildrenFinished()}}};var Jz=class{constructor(){this.shouldUpdate=!1;this.isSynchronous=!0}update(t,r){}},xv=new Jz;var Pe;(c=>{class e{constructor(d,p,h){this.name=d;this.f=p;this.onAbort=h;this.id=u()}run(d,p=250){return d?lae(this,d,p):this.f(xv)}runAsChild(d,p){return d.isSynchronous?this.f(xv):cae(d,this,p)}runInContext(d){return d.isSynchronous?this.f(xv):OE(d,this)}}function t(m){let d=m;return!!m&&typeof d.id=="number"&&typeof d.name=="string"&&!!d.run}c.is=t;function r(m){return!!m&&!!m.isAborted}c.isAbort=r;function n(m){return{isAborted:!0,reason:m,toString(){return`Aborted${m?": "+m:""}`}}}c.Aborted=n;function o(m,d,p){return new e(m,d,p)}c.create=o;function i(m,d){return o(m,async p=>d)}c.constant=i;function a(){return o("",async m=>{})}c.empty=a;function s(m,d){return o(m,async p=>{throw new Error(d)})}c.fail=s;function l(m,d){return t(m)?d?m.runInContext(d):m.run():m}c.resolveInContext=l;let u=oi(0,1073741823)})(Pe||={});var bae;(t=>t.Synchronous=xv)(bae||={});var xae;(r=>{function e(n,o=""){let i=n.progress;if(!n.children.length)return i.isIndeterminate?`${o}${i.taskName}: ${i.message}`:`${o}${i.taskName}: [${i.current}/${i.max}] ${i.message}`;let a=o+"  |_ ",s=n.children.map(l=>e(l,a));return i.isIndeterminate?`${o}${i.taskName}: ${i.message}
${s.join(`
`)}`:`${o}${i.taskName}: [${i.current}/${i.max}] ${i.message}
${s.join(`
`)}`}function t(n){return e(n.root)}r.format=t})(xae||={});async function ts(e,t,r,n,o){let i=Math.max(t,0),a=0,s=0;if(e.isSynchronous)return n(Number.MAX_SAFE_INTEGER,r),r;let l=Mn(),u=0,c=0;for(;(u=n(i,r))>0;){a+=u;let m=Mn()-l;c+=m,s+=m,e.shouldUpdate&&(await o(e,r,a),i=Math.round(c*a/s)+1,l=Mn(),c=0)}return e.shouldUpdate&&await o(e,r,a),r}var tf=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,$z=jGe();function jGe(){if(typeof File>"u"||tf){class e{arrayBuffer(){return this.blob.arrayBuffer()}slice(r,n,o){return this.blob.slice(r,n,o)}stream(){return this.blob.stream()}text(){return this.blob.text()}bytes(){return this.blob.bytes()}constructor(r,n,o){this.blob=new Blob(r,o),this.size=this.blob.size,this.type=this.blob.type,this.name=n,this.lastModified=o?.lastModified??0,this.webkitRelativePath=""}}return e}else return File}function Cae(e){return e>>0}function lh(e,t){return e[t]|e[t+1]<<8}function Kb(e,t,r){e[t]=r&255,e[t+1]=r>>8&255}function Jb(e,t){return e[t+3]*(256*256*256)+(e[t+2]<<16|e[t+1]<<8|e[t])}function uh(e,t,r){e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255}function WGe(e,t,r){let n="";for(let o=0;o<r;o++)n+=String.fromCharCode(e[t+o]);return n}function XGe(e){return e.length<2?"0"+e:e}function Sae(e,t,r){let n="",o;for(let i=0;i<r;i++)n+="%"+XGe(e[t+i].toString(16));try{o=decodeURIComponent(n)}catch{return WGe(e,t,r)}return o}function vae(e,t,r){let n=r.length,o=0;for(let i=0;i<n;i++){let a=r.charCodeAt(i);if((a&4294967168)===0)e[t+o]=a,o++;else if((a&4294965248)===0)e[t+o]=192|a>>6,e[t+o+1]=128|a>>0&63,o+=2;else if((a&4294901760)===0)e[t+o]=224|a>>12,e[t+o+1]=128|a>>6&63,e[t+o+2]=128|a>>0&63,o+=3;else if((a&4294967295-(1<<21)+1)===0)e[t+o]=240|a>>18,e[t+o+1]=128|a>>12&63,e[t+o+2]=128|a>>6&63,e[t+o+3]=128|a>>0&63,o+=4;else throw new Error("e")}return o}function e9(e){let t=e.length,r=0;for(let n=0;n<t;n++){let o=e.charCodeAt(n);if((o&4294967168)===0)r++;else if((o&4294965248)===0)r+=2;else if((o&4294901760)===0)r+=3;else if((o&4294967295-(1<<21)+1)===0)r+=4;else throw new Error("e")}return r}var QGe=function(){let e=new Uint32Array(256);for(let t=0;t<256;t++){let r=t;for(let n=0;n<8;n++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e}();function ZGe(e,t,r,n){for(let o=0;o<n;o++)e=QGe[(e^t[r+o])&255]^e>>>8;return e}function t9(e,t,r){return ZGe(4294967295,e,t,r)^4294967295}var GE={deflate:void 0,"deflate-raw":void 0,gzip:void 0};function UE(e){if(GE[e]===void 0)try{new CompressionStream(e),GE[e]=!0}catch{GE[e]=!1}return!!GE[e]}var Et=function(){let e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}();(function(){for(let r=0;r<32768;r++){let n=r;n=(n&2863311530)>>>1|(n&1431655765)<<1,n=(n&3435973836)>>>2|(n&858993459)<<2,n=(n&4042322160)>>>4|(n&252645135)<<4,n=(n&4278255360)>>>8|(n&16711935)<<8,Et.rev15[r]=(n>>>16|n<<16)>>>17}function t(r,n,o){for(;n--!==0;)r.push(0,o)}for(let r=0;r<32;r++)Et.ldef[r]=Et.of0[r]<<3|Et.exb[r],Et.ddef[r]=Et.df0[r]<<4|Et.dxb[r];t(Et.fltree,144,8),t(Et.fltree,112,9),t(Et.fltree,24,7),t(Et.fltree,8,8),ch(Et.fltree,9),Cv(Et.fltree,9,Et.flmap),Sv(Et.fltree,9),t(Et.fdtree,32,5),ch(Et.fdtree,5),Cv(Et.fdtree,5,Et.fdmap),Sv(Et.fdtree,5),t(Et.itree,19,0),t(Et.ltree,286,0),t(Et.dtree,30,0),t(Et.ttree,320,0)})();function Cv(e,t,r){let n=e.length,o=Et.rev15;for(let i=0;i<n;i+=2)if(e[i+1]!==0){let a=i>>1,s=e[i+1],l=a<<4|s,u=t-s,c=e[i]<<u,m=c+(1<<u);for(;c!==m;){let d=o[c]>>>15-t;r[d]=l,c++}}}function ch(e,t){let r=e.length,n=Et.bl_count;for(let a=0;a<=t;a++)n[a]=0;for(let a=1;a<r;a+=2)n[e[a]]++;let o=Et.next_code,i=0;n[0]=0;for(let a=1;a<=t;a++)i=i+n[a-1]<<1,o[a]=i;for(let a=0;a<r;a+=2){let s=e[a+1];s!==0&&(e[a]=o[s],o[s]++)}}function Sv(e,t){let r=Et.rev15,n=15-t;for(let o=0;o<e.length;o+=2){let i=e[o]<<t-e[o+1];e[o]=r[i]>>>n}}function qGe(e,t){let r=t===void 0;return t===void 0&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:r,BFINAL:0,off:0,pos:0}}function YGe(e,t){let{data:r,noBuf:n}=e,{buf:o,BFINAL:i,off:a,pos:s}=e,l=0;for(;i===0&&l<t;){let u,c,m=0,d=0;i=n9(r,s,1),l+=1;let p=n9(r,s+1,2);if(s+=3,p===0){(s&7)!==0&&(s+=8-(s&7));let h=(s>>>3)+4,f=r[h-4]|r[h-3]<<8;n&&(o=r9(o,a+f)),o.set(new Uint8Array(r.buffer,r.byteOffset+h,f),a),s=h+f<<3,a+=f;continue}if(n&&(o=r9(o,a+(1<<17))),p===1)u=Et.flmap,c=Et.fdmap,m=511,d=31;else if(p===2){let h=$b(r,s,5)+257,f=$b(r,s+5,5)+1,y=$b(r,s+10,4)+4;s+=14;for(let I=0;I<38;I+=2)Et.itree[I]=0,Et.itree[I+1]=0;let g=1;for(let I=0;I<y;I++){let v=$b(r,s+I*3,3);Et.itree[(Et.ordr[I]<<1)+1]=v,v>g&&(g=v)}s+=3*y,ch(Et.itree,g),Cv(Et.itree,g,Et.imap),u=Et.lmap,c=Et.dmap,s=KGe(Et.imap,(1<<g)-1,h+f,r,s,Et.ttree);let x=Iae(Et.ttree,0,h,Et.ltree);m=(1<<x)-1;let S=Iae(Et.ttree,h,f,Et.dtree);d=(1<<S)-1,ch(Et.ltree,x),Cv(Et.ltree,x,u),ch(Et.dtree,S),Cv(Et.dtree,S,c)}else throw new Error(`unknown BTYPE ${p}`);for(;;){let h=u[o9(r,s)&m];s+=h&15;let f=h>>>4;if(!(f>>>8))o[a++]=f;else{if(f===256)break;{let y=a+f-254;if(f>264){let v=Et.ldef[f-257];y=a+(v>>>3)+$b(r,s,v&7),s+=v&7}let g=c[o9(r,s)&d];s+=g&15;let x=g>>>4,S=Et.ddef[x],I=(S>>>4)+n9(r,s,S&15);for(s+=S&15,n&&(o=r9(o,a+(1<<17)));a<y;)o[a]=o[a++-I],o[a]=o[a++-I],o[a]=o[a++-I],o[a]=o[a++-I];a=y}}}}e.buf=o,e.BFINAL=i,e.off=a,e.pos=s}async function Aae(e,t,r){if(t[0]===3&&t[1]===0)return r||new Uint8Array(0);if(UE("deflate-raw")){let o=new DecompressionStream("deflate-raw"),a=new Blob([t]).stream().pipeThrough(o),s=0,l=[],u=a.getReader(),c=async()=>{let{done:m,value:d}=await u.read();if(!m)return e.shouldUpdate&&await e.update({message:"Inflating blocks...",current:s,max:r?.length}),r?r.set(d,s):l.push(d),s+=d.length,c()};if(await c(),!r){r=new Uint8Array(s);for(let m=0,d=0;m<l.length;m++)r.set(l[m],d),d+=l[m].length}return r}let n=qGe(t,r);for(;n.BFINAL===0;)e.shouldUpdate&&await e.update({message:"Inflating blocks...",current:n.pos,max:t.length}),YGe(n,100);return n.buf.length===n.off?n.buf:n.buf.slice(0,n.off)}function r9(e,t){let r=e.length;if(t<=r)return e;let n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function KGe(e,t,r,n,o,i){let a=0;for(;a<r;){let s=e[o9(n,o)&t];o+=s&15;let l=s>>>4;if(l<=15)i[a]=l,a++;else{let u=0,c=0;l===16?(c=3+$b(n,o,2),o+=2,u=i[a-1]):l===17?(c=3+$b(n,o,3),o+=3):l===18&&(c=11+$b(n,o,7),o+=7);let m=a+c;for(;a<m;)i[a]=u,a++}}return o}function Iae(e,t,r,n){let o=0,i=0,a=n.length>>>1;for(;i<r;){let s=e[i+t];n[i<<1]=0,n[(i<<1)+1]=s,s>o&&(o=s),i++}for(;i<a;)n[i<<1]=0,n[(i<<1)+1]=0,i++;return o}function $b(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function n9(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function o9(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}function NE(e,t,r){let n=[],o=e.length,i=t.length;for(let h=0;h<i;h+=2)t[h]=0,t[h+1]=0;for(let h=0;h<o;h++)e[h]!==0&&n.push({lit:h,f:e[h],d:void 0});let a=n.length,s=n.slice(0);if(a===0)return 0;if(a===1){let h=n[0].lit,f=h===0?1:0;return t[(h<<1)+1]=1,t[(f<<1)+1]=1,1}n.sort(function(h,f){return h.f-f.f});let l=n[0],u=n[1],c=0,m=1,d=2;for(n[0]={lit:-1,f:l.f+u.f,l,r:u,d:0};m!==a-1;)c!==m&&(d===a||n[c].f<n[d].f)?l=n[c++]:l=n[d++],c!==m&&(d===a||n[c].f<n[d].f)?u=n[c++]:u=n[d++],n[m++]={lit:-1,f:l.f+u.f,l,r:u,d:void 0};let p=i9(n[m-1],0);p>r&&(JGe(s,r,p),p=r);for(let h=0;h<a;h++)t[(s[h].lit<<1)+1]=s[h].d;return p}function i9(e,t){return e.lit!==-1?(e.d=t,t):Math.max(i9(e.l,t+1),i9(e.r,t+1))}function JGe(e,t,r){let n=0,o=0,i=1<<r-t;for(e.sort(function(a,s){return s.d===a.d?a.f-s.f:s.d-a.d}),n=0;n<e.length&&e[n].d>t;n++){let a=e[n].d;e[n].d=t,o+=i-(1<<r-a)}for(o=o>>>r-t;o>0;){let a=e[n].d;a<t?(e[n].d++,o-=1<<t-a-1):n++}for(;n>=0;n--)e[n].d===t&&o<0&&(e[n].d--,o++);o!==0&&console.log("debt left")}function $Ge(e,t,r,n){let{lits:o,strt:i,prev:a}=Et;return{data:e,out:t,opt:t4e[n],i:0,pos:r<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:o,strt:i,prev:a}}function e4e(e,t){let{data:r,dlen:n,out:o,opt:i}=e,{i:a,pos:s,cvrd:l,li:u,lc:c,bs:m,ebits:d,c:p,nc:h}=e,{lits:f,strt:y,prev:g}=Et,x=Math.min(a+t,n);for(;a<x;a++){if(p=h,a+1<n-2){h=a9(r,a+1);let S=a+1&32767;g[S]=y[h],y[h]=S}if(l<=a){(u>14e3||c>26697)&&n-a>100&&(l<a&&(f[u]=a-l,u+=2,l=a),s=Dae(a===n-1||l===n?1:0,f,u,d,r,m,a-m,o,s),u=c=d=0,m=a);let S=0;if(a<n-2&&(S=r4e(r,a,g,p,Math.min(i[2],n-a),i[3])),S!==0){let I=S>>>16,v=S&65535,A=_ae(I,Et.of0);Et.lhst[257+A]++;let _=_ae(v,Et.df0);Et.dhst[_]++,d+=Et.exb[A]+Et.dxb[_],f[u]=I<<23|a-l,f[u+1]=v<<16|A<<8|_,u+=2,l=a+I}else Et.lhst[r[a]]++;c++}}e.i=a,e.pos=s,e.cvrd=l,e.li=u,e.lc=c,e.bs=m,e.ebits=d,e.c=p,e.nc=h}var t4e=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];async function Rae(e,t,r,n,o){if(UE("deflate-raw")){let h=new CompressionStream("deflate-raw"),g=new Blob([t]).stream().pipeThrough(h).getReader(),x=n,S=async()=>{let{done:I,value:v}=await g.read();if(!I)return e.shouldUpdate&&await e.update({message:"Deflating...",current:x,max:r.length}),r.set(v,x),x+=v.length,S()};return await S(),x}let i=$Ge(t,r,n,o),{dlen:a}=i;if(o===0){let{i:h,pos:f}=i;for(;h<a;){let y=Math.min(65535,a-h);_0(r,f,h+y===a?1:0),f=wae(t,h,y,r,f+8),h+=y}return f>>>3}for(a>2&&(i.nc=a9(t,0),i.strt[i.nc]=0);i.i<a;)e.shouldUpdate&&await e.update({message:"Deflating...",current:i.i,max:a}),e4e(i,1024*1024);let{li:s,cvrd:l,pos:u}=i,{i:c,lits:m,bs:d,ebits:p}=i;for((d!==c||t.length===0)&&(l<c&&(m[s]=c-l,s+=2,l=c),u=Dae(1,m,s,p,t,d,c-d,r,u));(u&7)!==0;)u++;return u>>>3}function r4e(e,t,r,n,o,i){let a=t&32767,s=r[a],l=a-s+32768&32767;if(s===a||n!==a9(e,t-l))return 0;let u=0,c=0,m=Math.min(32767,t);for(;l<=m&&--i!==0&&s!==a;){if(u===0||e[t+u]===e[t+u-l]){let d=n4e(e,t,l);if(d>u){if(u=d,c=l,u>=o)break;l+2<d&&(d=l+2);let p=0;for(let h=0;h<d-2;h++){let f=t-l+h+32768&32767,y=r[f],g=f-y+32768&32767;g>p&&(p=g,s=f)}}}a=s,s=r[a],l+=a-s+32768&32767}return u<<16|c}function n4e(e,t,r){if(e[t]!==e[t-r]||e[t+1]!==e[t+1-r]||e[t+2]!==e[t+2-r])return 0;let n=t,o=Math.min(e.length,t+258);for(t+=3;t<o&&e[t]===e[t-r];)t++;return t-n}function a9(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function Dae(e,t,r,n,o,i,a,s,l){Et.lhst[256]++;let[u,c,m,d,p,h,f,y]=o4e(),g=((l+3&7)===0?0:8-(l+3&7))+32+(a<<3),x=n+_2(Et.fltree,Et.lhst)+_2(Et.fdtree,Et.dhst),S=n+_2(Et.ltree,Et.lhst)+_2(Et.dtree,Et.dhst);S+=14+3*h+_2(Et.itree,Et.ihst)+(Et.ihst[16]*2+Et.ihst[17]*3+Et.ihst[18]*7);for(let v=0;v<286;v++)Et.lhst[v]=0;for(let v=0;v<30;v++)Et.dhst[v]=0;for(let v=0;v<19;v++)Et.ihst[v]=0;let I=g<x&&g<S?0:x<S?1:2;if(zE(s,l,e),zE(s,l+1,I),l+=3,I===0){for(;(l&7)!==0;)l++;l=wae(o,i,a,s,l)}else{let v,A;if(I===1)v=Et.fltree,A=Et.fdtree;else if(I===2){ch(Et.ltree,u),Sv(Et.ltree,u),ch(Et.dtree,c),Sv(Et.dtree,c),ch(Et.itree,m),Sv(Et.itree,m),v=Et.ltree,A=Et.dtree,_0(s,l,d-257),l+=5,_0(s,l,p-1),l+=5,_0(s,l,h-4),l+=4;for(let T=0;T<h;T++)_0(s,l+T*3,Et.itree[(Et.ordr[T]<<1)+1]);l+=3*h,l=Tae(f,Et.itree,s,l),l=Tae(y,Et.itree,s,l)}else Rr(I);let _=i;for(let T=0;T<r;T+=2){let w=t[T],D=w>>>23,M=_+(w&(1<<23)-1);for(;_<M;)l=R2(o[_++],v,s,l);if(D!==0){let E=t[T+1],R=E>>16,k=E>>8&255,B=E&255;l=R2(257+k,v,s,l),_0(s,l,D-Et.of0[k]),l+=Et.exb[k],l=R2(B,A,s,l),zE(s,l,R-Et.df0[B]),l+=Et.dxb[B],_+=D}}l=R2(256,v,s,l)}return l}function wae(e,t,r,n,o){let i=o>>>3;return n[i]=r,n[i+1]=r>>>8,n[i+2]=255-n[i],n[i+3]=255-n[i+1],i+=4,n.set(new Uint8Array(e.buffer,t,r),i),o+(r+4<<3)}function o4e(){let e=NE(Et.lhst,Et.ltree,15),t=NE(Et.dhst,Et.dtree,15),r=[],n=Pae(Et.ltree,r),o=[],i=Pae(Et.dtree,o);for(let l=0;l<r.length;l+=2)Et.ihst[r[l]]++;for(let l=0;l<o.length;l+=2)Et.ihst[o[l]]++;let a=NE(Et.ihst,Et.itree,7),s=19;for(;s>4&&Et.itree[(Et.ordr[s-1]<<1)+1]===0;)s--;return[e,t,a,n,i,s,r,o]}function _2(e,t){let r=0;for(let n=0;n<t.length;n++)r+=t[n]*e[(n<<1)+1];return r}function Tae(e,t,r,n){for(let o=0;o<e.length;o+=2){let i=e[o],a=e[o+1];n=R2(i,t,r,n);let s=i===16?2:i===17?3:7;i>15&&(_0(r,n,a),n+=s)}return n}function Pae(e,t){let r=e.length;for(;r!==2&&e[r-1]===0;)r-=2;for(let n=0;n<r;n+=2){let o=e[n+1],i=n+3<r?e[n+3]:-1,a=n+5<r?e[n+5]:-1,s=n===0?-1:e[n-1];if(o===0&&i===o&&a===o){let l=n+5;for(;l+2<r&&e[l+2]===o;)l+=2;let u=Math.min(l+1-n>>>1,138);u<11?t.push(17,u-3):t.push(18,u-11),n+=u*2-2}else if(o===s&&i===o&&a===o){let l=n+5;for(;l+2<r&&e[l+2]===o;)l+=2;let u=Math.min(l+1-n>>>1,6);t.push(16,u-3),n+=u*2-2}else t.push(o,0)}return r>>>1}function _ae(e,t){let r=0;return t[r|16]<=e&&(r|=16),t[r|8]<=e&&(r|=8),t[r|4]<=e&&(r|=4),t[r|2]<=e&&(r|=2),t[r|1]<=e&&(r|=1),r}function R2(e,t,r,n){return zE(r,n,t[e<<1]),n+t[(e<<1)+1]}function _0(e,t,r){r=r<<(t&7);let n=t>>>3;e[n]|=r,e[n+1]|=r>>>8}function zE(e,t,r){r=r<<(t&7);let n=t>>>3;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16}async function ex(e,t,r=!1){let n=Object.create(null),o=new Uint8Array(t);if(lh(o,0)!==19280)throw new Error('Invalid ZIP file. A valid ZIP file must start with two magic bytes \\x50\\x4b ("PK" in ASCII).');let i=o.length-4;for(;Jb(o,i)!==101010256;)i--;let a=i;a+=4,a+=4;let s=lh(o,a);a+=2,a+=2,a+=4;let l=Jb(o,a);a+=4,a=l;for(let u=0;u<s;u++){a+=4,a+=4,a+=4,a+=4,a+=4,a+=4,a+=4;let c=lh(o,a),m=lh(o,a+2),d=lh(o,a+4);a+=6,a+=8;let p=Jb(o,a);a+=4,a+=c+m+d,await i4e(e,o,p,n,r)}return n}async function i4e(e,t,r,n,o){r+=4,r+=2,r+=2;let i=lh(t,r);r+=2,r+=4,r+=4;let a=Jb(t,r);r+=4;let s=Jb(t,r);r+=4;let l=lh(t,r);r+=2;let u=lh(t,r);r+=2;let c=Sae(t,r,l);if(r+=l,r+=u,o){n[c]={size:s,csize:a};return}let m=new Uint8Array(t.buffer,r,a);if(i===0)n[c]=m;else if(i===8){let d=new Uint8Array(s);await Mae(e,m,d),n[c]=d}else throw new Error(`unknown compression method: ${i}`)}async function Mae(e,t,r){return Aae(e,t,r)}async function HE(e,t,r){let n=t[3],o=10;if(n&4){let c=lh(t,o);o+=c}if(n&8){let c=o;for(;t[c]!==0;)++c;o=c+1}if(n&16){let c=o;for(;t[c]!==0;)++c;o=c+1}n&1&&(o+=2);let i=Cae(Jb(t,t.length-8)),a=Jb(t,t.length-4);r===void 0&&(r=new Uint8Array(a));let s=new Uint8Array(t.buffer,t.byteOffset+o,t.length-o-8),l=await Mae(e,s,r),u=t9(l,0,l.length);return i!==u&&console.error("ungzip: checksums don't match"),l}async function a4e(e,t,r){r===void 0&&(r={level:6});let n=new Uint8Array(50+Math.floor(t.length*1.1)),o=await Rae(e,t,n,0,r.level);return new Uint8Array(n.buffer,0,o)}function Bae(e,t=!1){return Pe.create("Zip",r=>s4e(r,e,t))}async function s4e(e,t,r=!1){let n=0,o={};for(let m in t){let d=!l4e(m)&&!r,p=t[m],h=t9(p,0,p.length);o[m]={cpr:d,usize:p.length,crc:h,file:d?await a4e(e,p):p}}for(let m in o)n+=o[m].file.length+30+46+2*e9(m);n+=22;let i=new Uint8Array(n),a=0,s=[];for(let m in o){let d=o[m];s.push(a),a=Eae(i,a,m,d,0)}let l=0,u=a;for(let m in o){let d=o[m];s.push(a),a=Eae(i,a,m,d,1,s[l++])}let c=a-u;return uh(i,a,101010256),a+=4,a+=4,Kb(i,a,l),a+=2,Kb(i,a,l),a+=2,uh(i,a,c),a+=4,uh(i,a,u),a+=4,a+=2,i.buffer}function l4e(e){let t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!==-1}function Eae(e,t,r,n,o,i=0){let a=n.file;uh(e,t,o===0?67324752:33639248),t+=4,o===1&&(t+=2),Kb(e,t,20),t+=2,Kb(e,t,0),t+=2,Kb(e,t,n.cpr?8:0),t+=2,uh(e,t,0),t+=4,uh(e,t,n.crc),t+=4,uh(e,t,a.length),t+=4,uh(e,t,n.usize),t+=4,Kb(e,t,e9(r)),t+=2,Kb(e,t,0),t+=2,o===1&&(t+=2,t+=2,t+=6,uh(e,t,i),t+=4);let s=vae(e,t,r);return t+=s,o===0&&(e.set(a,t),t+=a.length),t}function mh(e,t){return d4e(e,t)}function w2(e){return typeof e=="string"?Lae(e,e,"string"):Lae(e.title,e.url,e.type||"string",e.body,e.headers)}function u4e(e){if(tf)throw new Error("`isDone` should not be used when running in Node.js");if(e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof XMLHttpRequest)return e.readyState===XMLHttpRequest.DONE;throw new Error("unknown data type")}function kae(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function Gae(e,t,r){if(tf)throw new Error("`readData` should not be used when running in Node.js");return new Promise((n,o)=>{if(u4e(r)){let{error:a}=r;a!=null?o(a??kae(r instanceof XMLHttpRequest)):n(r);return}let i=!1;r.onerror=a=>{if(i)return;let{error:s}=a.target;o(s??kae(r instanceof XMLHttpRequest))},r.onprogress=a=>{if(!(!e.shouldUpdate||i))try{a.lengthComputable?e.update({message:t,isIndeterminate:!1,current:a.loaded,max:a.total}):e.update({message:`${t} ${(a.loaded/1024/1024).toFixed(2)} MB`,isIndeterminate:!0})}catch(s){i=!0,o(s)}},r.onload=a=>{n(r)}})}function Uae(e){return/\.gz$/i.test(e)?1:/\.zip$/i.test(e)?2:0}var c4e=/^(__MACOSX|.DS_Store)/;async function m4e(e,t,r){switch(r){case 0:return t;case 1:return HE(e,t);case 2:let n=await ex(e,t.buffer),o=Object.keys(n).filter(i=>!c4e.test(i));if(o.length!==1)throw new Error("can only decompress zip files with a single entry");return n[o[0]]}}async function jE(e,t,r,n){if(t===null)throw new Error("no data given");let o=new Uint8Array(t);if(n!==0&&r!=="zip"&&(o=await m4e(e,o,n)),r==="binary")return o;if(r==="zip")return await ex(e,o.buffer);if(r==="string")return LE(o);if(r==="xml")return new DOMParser().parseFromString(sh(o),"application/xml");if(r==="json")return JSON.parse(sh(o));throw new Error(`could not get requested response data '${r}'`)}function d4e(e,t){if(tf)return p4e(e,t);let r;return Pe.create("Read File",async n=>{try{await n.update({message:"Opening file...",canAbort:!0}),r=new FileReader,r.readAsArrayBuffer(e);let i=(await Gae(n,"Reading...",r)).result;return await n.update({message:"Processing file...",canAbort:!1}),await jE(n,i,t,Uae(e.name))}finally{r=void 0}},()=>{r&&r.abort()})}function p4e(e,t){return Pe.create("Read File",async r=>{await r.update({message:"Opening file...",canAbort:!1});let n=await e.arrayBuffer();return await r.update({message:"Processing file...",canAbort:!1}),await jE(r,n,t,Uae(e.name))})}var D2=class e{static{this.pool=[]}static{this.poolSize=15}static get(){if(tf)throw new Error("`RequestPool.get` should not be used when running in Node.js");return this.pool.length?this.pool.pop():new XMLHttpRequest}static emptyFunc(){}static deposit(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))}};function f4e(e,t){if(e.status>=200&&e.status<400){let{response:r}=e;if(D2.deposit(e),(t==="binary"||t==="zip")&&r instanceof ArrayBuffer)return new Uint8Array(r);if(t==="string"&&typeof r=="string")return r;if(t==="xml"&&r instanceof XMLDocument)return r;if(t==="json"&&typeof r=="object")return r;throw new Error(`could not get requested response data '${t}'`)}else throw D2.deposit(e),new Error(`Download failed with status code ${e.status}`)}function h4e(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":return"arraybuffer";case"zip":return"arraybuffer"}}function Lae(e,t,r,n,o){if(tf)return t.startsWith("file://")?b4e(e,t,r,n,o):x4e(e,t,r,n,o);let i;return Pe.create(e||"Download",async a=>{if(i=D2.get(),i.open(n?"post":"get",t,!0),o)for(let[u,c]of o)i.setRequestHeader(u,c);i.responseType=h4e(r),i.send(n),await a.update({message:"Waiting for server...",canAbort:!0});let s=await Gae(a,"Downloading...",i);return i=void 0,await a.update({message:"Parsing response...",canAbort:!1}),f4e(s,r)},()=>{i&&(i.abort(),i=void 0)})}var Fae;function g4e(){if(!Fae)throw new Error("When running in Node.js and reading from files, call mol-util/data-source's setFSModule function first.");return Fae}function y4e(e){return new Promise((t,r)=>{g4e().readFile(e,(n,o)=>{n?r(n):t(o)})})}function b4e(e,t,r,n,o){if(!tf)throw new Error("This function should only be used when running in Node.js");if(!t.startsWith("file://"))throw new Error("This function is only for URLs with protocol file://");return Pe.create(e??"Download",async i=>{let a=t.substring(7);await i.update({message:"Loading file...",canAbort:!1});let s=await y4e(a);return await i.update({message:"Parsing response...",canAbort:!1}),await jE(i,s,r,0)})}function x4e(e,t,r,n,o){if(!tf)throw new Error("This function should only be used when running in Node.js");let i=new AbortController;return Pe.create(e??"Download",async a=>{await a.update({message:"Downloading...",canAbort:!0});let s=await fetch(t,{signal:i.signal});if(!(s.status>=200&&s.status<400))throw new Error(`Download failed with status code ${s.status}`);let l=await s.bytes();return await a.update({message:"Parsing response...",canAbort:!1}),await jE(a,l,r,0)},()=>{i.abort()})}async function Nae(e,t,r,n){let o=r.length,i=new Array(r.length);await e.update({message:"Downloading...",current:0,max:o});let a=[],s=[],l=0;for(let c=Math.min(o,n);l<c;l++){let m=r[l];a.push(Oae(l,m.id,t.resolve(Zr.getUrlAsset(t,m.url),m.isBinary?"binary":"string").runAsChild(e))),s.push(l)}let u=0;for(;a.length>0;){let c=await Promise.race(a),m=r[c.index],d=s.indexOf(c.index);if(u++,c.kind==="error"&&!m.canFail)throw new Error(`${m.url}: ${c.error}`);if(e.shouldUpdate&&await e.update({message:"Downloading...",current:u,max:o}),i[c.index]=c,a=a.filter(Vae,d),s=s.filter(Vae,d),l<o){let p=r[l],h=t.resolve(Zr.getUrlAsset(t,p.url),p.isBinary?"binary":"string").runAsChild(e);a.push(Oae(l,p.id,h)),s.push(l),l++}}return i}function Vae(e,t){return this!==t}async function Oae(e,t,r){try{return{kind:"ok",result:await r,index:e,id:t}}catch(n){return{kind:"error",error:n,index:e,id:t}}}var Zr;(s=>{function e(l,u){return{kind:"url",id:en.create22(),url:l,...u}}s.Url=e;function t(l){return{kind:"file",id:en.create22(),name:l.name,file:l}}s.File=t;function r(l){return l?.kind==="url"}s.isUrl=r;function n(l){return l?.kind==="file"}s.isFile=n;function o(l,u,c){return{data:l,dispose:()=>{c.release(u)}}}s.Wrapper=o;function i(l){return typeof l=="string"?l:l.url}s.getUrl=i;function a(l,u,c){return typeof u=="string"?l.tryFindUrl(u,c)||e(u,{body:c}):u}s.getUrlAsset=a})(Zr||={});var WE=class{constructor(){this._assets=new Map}get assets(){return H1(this._assets.values())}tryFindUrl(t,r){let n=this.assets.values();for(;;){let o=n.next();if(o.done)return;let i=o.value.asset;if(Zr.isUrl(i)&&i.url===t&&(i.body||"")===(r||""))return i}}set(t,r,n){this._assets.set(t.id,{asset:t,file:r,refCount:0,tag:n?.tag,isStatic:n?.isStatic})}get(t){return this._assets.get(t.id)}delete(t){return this._assets.delete(t.id)}has(t){return this._assets.has(t.id)}resolve(t,r,n=!0){return Zr.isUrl(t)?Pe.create(`Download ${t.title||t.url}`,async o=>{if(this._assets.has(t.id)){let s=this._assets.get(t.id);return s.refCount++,Zr.Wrapper(await mh(s.file,r).runInContext(o),t,this)}if(!n)return Zr.Wrapper(await w2({...t,type:r}).runInContext(o),t,this);let i=await w2({...t,type:"binary"}).runInContext(o),a=new $z([i],"raw-data");return this._assets.set(t.id,{asset:t,file:a,refCount:1}),Zr.Wrapper(await mh(a,r).runInContext(o),t,this)}):Pe.create(`Read ${t.name}`,async o=>{if(this._assets.has(t.id)){let i=this._assets.get(t.id);return i.refCount++,Zr.Wrapper(await mh(i.file,r).runInContext(o),t,this)}if(!(t.file instanceof $z))throw new Error(`Cannot resolve file asset '${t.name}' (${t.id})`);return n&&this._assets.set(t.id,{asset:t,file:t.file,refCount:1}),Zr.Wrapper(await mh(t.file,r).runInContext(o),t,this)})}release(t){let r=this._assets.get(t.id);r&&(r.refCount--,r.refCount<=0&&!r.isStatic&&this._assets.delete(t.id))}clearTag(t){let r=Array.from(this._assets.keys());for(let n of r){let o=this._assets.get(n);o&&o.tag===t&&this._assets.delete(n)}}clear(){this._assets.clear()}dispose(){this.clear()}};var C;(Ce=>{Ce.Essential={isEssential:!0};function t(J,z){return z&&(z.label&&(J.label=z.label),z.description&&(J.description=z.description),z.legend&&(J.legend=z.legend),z.fieldLabels&&(J.fieldLabels=z.fieldLabels),z.isHidden&&(J.isHidden=z.isHidden),z.shortLabel&&(J.shortLabel=z.shortLabel),z.twoColumns&&(J.twoColumns=z.twoColumns),z.isEssential&&(J.isEssential=z.isEssential),z.category&&(J.category=z.category),z.hideIf&&(J.hideIf=z.hideIf),z.help&&(J.help=z.help)),J}function r(J){let z={...J};return z.isOptional=!0,z}Ce.Optional=r;function n(J,z){return t({type:"value",defaultValue:J},z)}Ce.Value=n;function o(J,z,ae){return t({type:"select",defaultValue:le(J,z),options:z,cycle:ae?.cycle},ae)}Ce.Select=o;function i(J,z,ae){let ge=t({type:"multi-select",defaultValue:J,options:z},ae);return ae?.emptyValue&&(ge.emptyValue=ae.emptyValue),ge}Ce.MultiSelect=i;function a(J,z){return t({type:"boolean",defaultValue:J},z)}Ce.Boolean=a;function s(J="",z){return t({type:"text",defaultValue:J,multiline:z?.multiline,placeholder:z?.placeholder,disableInteractiveUpdates:z?.disableInteractiveUpdates},z)}Ce.Text=s;function l(J,z){let ae=t({type:"color",defaultValue:J},z);return z?.isExpanded&&(ae.isExpanded=z.isExpanded),ae}Ce.Color=l;function u(J,z){let ae;if(typeof J=="string"){let ge=Ma(J);ae={kind:ge.type!=="qualitative"?"interpolate":"set",colors:ge.list}}else ae=J;return t({type:"color-list",presetKind:z?.presetKind||"all",defaultValue:ae,offsets:!!z?.offsets},z)}Ce.ColorList=u;function c(J,z,ae){return t(f({type:"vec3",defaultValue:J},z),ae)}Ce.Vec3=c;function m(J,z){return t({type:"mat4",defaultValue:J},z)}Ce.Mat4=m;function d(J,z){let ae=typeof J=="string"?Zr.Url(J):Zr.Url(J.url,{body:J.body});return t({type:"url",defaultValue:ae},z)}Ce.Url=d;function p(J){let z=t({type:"file",defaultValue:null},J);return J?.accept&&(z.accept=J.accept),z}Ce.File=p;function h(J){let z=t({type:"file-list",defaultValue:null},J);return J?.accept&&(z.accept=J.accept),z}Ce.FileList=h;function f(J,z){return z&&(typeof z.min<"u"&&(J.min=z.min),typeof z.max<"u"&&(J.max=z.max),typeof z.step<"u"&&(J.step=z.step)),J}function y(J,z,ae){let ge=t(f({type:"number",defaultValue:J},z),ae);return ae?.immediateUpdate&&(ge.immediateUpdate=!0),ge}Ce.Numeric=y;function g(J,z,ae){return t(f({type:"interval",defaultValue:J},z),ae)}Ce.Interval=g;function x(J,z){let ae=t({type:"line-graph",defaultValue:J},z);return z?.getVolume&&(ae.getVolume=z.getVolume),ae}Ce.LineGraph=x;function S(J,z){let ae=t({type:"group",defaultValue:z?.customDefault||L(J),params:J},z);return z?.presets&&(ae.presets=z.presets),z?.isExpanded&&(ae.isExpanded=z.isExpanded),z?.isFlat&&(ae.isFlat=z.isFlat),z?.pivot&&(ae.pivot=z.pivot),ae}Ce.Group=S;function I(J){return S({},J)}Ce.EmptyGroup=I;function v(J,z,ae,ge){let ve=le(J,z);return t({type:"mapped",defaultValue:{name:ve,params:ae(ve).defaultValue},select:o(ve,z,ge),map:ae},ge)}Ce.Mapped=v;function A(J,z,ae){let ge=ae?.options?ae.options:Object.keys(z).map(Oe=>[Oe,z[Oe].label||ta(Oe)]),ve=le(J,ge);return t({type:"mapped",defaultValue:{name:ve,params:z[ve].defaultValue},select:o(ve,ge,ae),map:Oe=>z[Oe]},ae)}Ce.MappedStatic=A;function _(J,z,ae){return t({type:"object-list",element:J,getLabel:z,ctor:T,defaultValue:ae?.defaultValue||[]},ae)}Ce.ObjectList=_;function T(){return L(this.element)}function w(){throw new Error("getValue not set. Fix runtime.")}function D(J,z,ae){return t({type:"value-ref",defaultValue:{ref:ae?.defaultRef??"",getValue:w},getOptions:J,resolveRef:z},ae)}Ce.ValueRef=D;function M(J){return t({type:"data-ref",defaultValue:{ref:J?.defaultRef??"",getValue:w}},J)}Ce.DataRef=M;function E(J,z,ae){return t({type:"converted",defaultValue:z(ae.defaultValue),converted:ae,fromValue:J,toValue:z},ae)}Ce.Converted=E;function R(J,z,ae,ge,ve){let Oe=Object.keys(z).map(ze=>[ze,ze]);return t({type:"conditioned",select:o(ae(J),Oe,ve),defaultValue:J,conditionParams:z,conditionForValue:ae,conditionedValue:ge},ve)}Ce.Conditioned=R;function k(J,z){return t({type:"script",defaultValue:J},z)}Ce.Script=k;function B(J){return 0}Ce.For=B;function L(J){let z={};for(let ae of Object.keys(J))J[ae].isOptional||(z[ae]=J[ae].defaultValue);return z}Ce.getDefaultValues=L;function V(J,z,ae){return()=>J(z,ae)}function U(J,z,ae){if(z){if(J.type==="value-ref"){let ge=z;ge.ref?ge.getValue=V(J.resolveRef,ge.ref,ae):ge.getValue=()=>{throw new Error("Unset ref in ValueRef value.")}}else if(J.type==="data-ref"){let ge=z;ge.ref?ge.getValue=V(ae,ge.ref,ae):ge.getValue=()=>{throw new Error("Unset ref in ValueRef value.")}}else if(J.type==="group")q(J.params,z,ae);else if(J.type==="mapped"){let ge=z,ve=J.map(ge.name);U(ve,ge.params,ae)}else if(J.type==="object-list"){if(!O(J.element))return;for(let ge of z)q(J.element,ge,ae)}}}function Q(J){if(J.type==="value-ref"||J.type==="data-ref")return!0;if(J.type==="group"){if(O(J.params))return!0}else if(J.type==="mapped"){for(let[z]of J.select.options)if(Q(J.map(z)))return!0}else if(J.type==="object-list")return O(J.element);return!1}function O(J){for(let z of Object.keys(J))if(Q(J[z]))return!0;return!1}function q(J,z,ae){for(let ge of Object.keys(J))U(J[ge],z?.[ge],ae)}Ce.resolveRefs=q;function X(J,z){for(let ae of Object.keys(J))J[ae].isOptional||(J[ae].defaultValue=z[ae])}Ce.setDefaultValues=X;function F(J){return Ya(J)}Ce.clone=F;function Y(J,z){}Ce.validate=Y;function $(J,z,ae){if(z===ae)return!0;if(typeof z!="object"||typeof ae!="object")return!1;for(let ge of Object.keys(J))if(!ce(J[ge],z[ge],ae[ge]))return!1;return!0}Ce.areEqual=$;function ce(J,z,ae){if(z===ae)return!0;if(J.type==="group")return $(J.params,z,ae);if(J.type==="mapped"){let ge=z,ve=ae;if(ge.name!==ve.name)return!1;let Oe=J.map(ge.name);return ce(Oe,ge.params,ve.params)}else if(J.type==="multi-select"){let ge=z,ve=ae;if(ge.length!==ve.length)return!1;if(ge.length<10){for(let Oe=0,ze=ge.length;Oe<ze;Oe++)if(ge[Oe]!==ve[Oe]&&ve.indexOf(ge[Oe])<0)return!1}else{let Oe=new Set(ve);for(let ze=0,Re=ge.length;ze<Re;ze++)if(ge[ze]!==ve[ze]&&!Oe.has(ge[ze]))return!1}return!0}else{if(J.type==="interval")return z[0]===ae[0]&&z[1]===ae[1];if(J.type==="line-graph"){let ge=z,ve=ae;if(ge.length!==ve.length)return!1;for(let Oe=0,ze=ge.length;Oe<ze;Oe++)if(!Ie.areEqual(ge[Oe],ve[Oe]))return!1;return!0}else{if(J.type==="vec3")return b.equals(z,ae);if(J.type==="mat4")return Z.areEqual(z,ae,1e-6);if(J.type==="script"){let ge=z,ve=ae;return ge.language===ve.language&&ge.expression===ve.expression}else if(J.type==="object-list"){let ge=z,ve=ae,Oe=ge.length;if(Oe!==ve.length)return!1;for(let ze=0;ze<Oe;ze++)if(!$(J.element,ge[ze],ve[ze]))return!1;return!0}else if(typeof z=="object"&&typeof ae=="object")return Yf(z,ae)}}return!1}Ce.isParamEqual=ce;function ie(J,z,ae){if(z===void 0)return{...ae};if(ae===void 0)return{...z};let ge=Object.create(null);for(let ve of Object.keys(J))ge[ve]=oe(J[ve],z[ve],ae[ve]);return ge}Ce.merge=ie;function oe(J,z,ae){if(z===void 0)return typeof ae=="object"&&!Array.isArray(ae)?{...ae}:ae;if(ae===void 0)return typeof z=="object"&&!Array.isArray(z)?{...z}:z;if(J.type==="group")return ie(J.params,z,ae);if(J.type==="mapped"){let ge=z,ve=ae;if(ge.name!==ve.name)return{...ve};let Oe=J.map(ve.name);return{name:ve.name,params:oe(Oe,ge.params,ve.params)}}else return J.type==="value"?ae:typeof z=="object"&&typeof ae=="object"?Array.isArray(ae)?ae:{...z,...ae}:ae}Ce.mergeParam=oe;function W(J,z){for(let ae of J.options)if(ae[0]===z)return!0;return!1}function N(J,z,ae){if(z==null)return ae?J.defaultValue:void 0;if(J.type==="value")return z;if(J.type==="group"){let ge=Object.create(null);for(let ve of Object.keys(J.params)){let Oe=J.params[ve];z[ve]===void 0?ae&&(ge[ve]=Oe.defaultValue):ge[ve]=N(Oe,z[ve],ae)}return ge}else if(J.type==="mapped"){let ge=z;if(typeof ge.name!="string")return J.defaultValue;if(typeof ge.params>"u")return ae?J.defaultValue:void 0;if(!W(J.select,ge.name))return J.defaultValue;let ve=J.map(ge.name);return{name:ge.name,params:N(ve,ge.params,ae)}}else{if(J.type==="select")return W(J,z)?z:J.defaultValue;if(J.type==="multi-select"){if(!Array.isArray(z))return J.defaultValue;let ge=z.filter(function(ve){return W(this,ve)},J);return z.length>0&&ge.length===0?J.defaultValue:ge}else if(J.type==="object-list")return Array.isArray(z)?z.map(ge=>j(J.element,ge,ae?"all":"skip")):J.defaultValue}return z}function j(J,z,ae){if(typeof z!="object"||z===null)return ae?L(J):z;let ge=Object.create(null);for(let ve of Object.keys(J)){let Oe=J[ve];z[ve]===void 0?ae==="all"&&(ge[ve]=Oe.defaultValue):ge[ve]=N(Oe,z[ve],ae!=="skip")}return ge}Ce.normalizeParams=j;function ue(J,z){let ae=[];for(let ge of Object.keys(J))if(!z)typeof J[ge]=="string"?ae.push([ge,J[ge]]):ae.push([ge,z===null?ge:ta(ge)]);else{let ve=z(ge,J[ge]);ae.push(typeof ve=="string"?[ge,ve]:[ge,ve[0],ve[1]])}return ae}Ce.objectToOptions=ue;function be(J,z){let ae=[];for(let ge of J)z?ae.push([ge,z(ge)]):ae.push([ge,z===null?ge:ta(ge)]);return ae}Ce.arrayToOptions=be;function ee(J,z){for(let ae of J.options)if(ae[0]===z)return ae[1];return""}Ce.optionLabel=ee;function le(J,z){for(let ae of z)if(ae[0]===J)return J;return z.length>0?z[0][0]:void 0}function Ae(J,z){let ae={};for(let ge of Object.keys(z)){let ve=z[ge];!J[ge]||ve===null||ve===void 0||J[ge].defaultValue===ve||(ae[ge]={...J[ge],defaultValue:ve})}return{...J,...ae}}Ce.withDefaults=Ae})(C||={});var Ss;(o=>{function e(i){let a={create(s){return{action:a,params:s}},id:en.create22(),definition:i,createDefaultParams(s,l){return i.params?C.getDefaultValues(i.params(s,l)):{}}};return a}o.create=e;function t(i){let a=i.definition;return e({from:a.from,display:a.display,params:a.params,isApplicable:i.definition.isApplicable?(s,l,u)=>i.definition.isApplicable(s,u):void 0,run({cell:s,state:l,params:u}){let c=l.build().to(s.transform.ref).apply(i,u);return l.updateTree(c)}})}o.fromTransformer=t;let r;(s=>{function i(l){return u=>e({from:l.from instanceof Array?l.from:l.from?[l.from]:[],display:typeof l.display=="string"?{name:l.display}:l.display?l.display:{name:"Unnamed State Action"},params:typeof l.params=="object"?()=>l.params:l.params?l.params:void 0,isApplicable:l.isApplicable,...typeof u=="function"?{run:u}:u})}s.build=l=>i(l)})(r=o.Builder||={}),o.build=r.build})(Ss||={});var Je;(f=>{function e(y,g,x){return y.definition.params?y.definition.params(g,x):{}}f.getParamDefinition=e;function t(y){return!!y&&typeof y.toAction=="function"&&typeof y.apply=="function"}f.is=t;let r;(I=>(I[I.Unchanged=0]="Unchanged",I[I.Updated=1]="Updated",I[I.Recreate=2]="Recreate",I[I.Null=3]="Null"))(r=f.UpdateResult||={});let n=new Map,o=new Map;function i(y){for(let g of y.definition.from)o.has(g.type)?o.get(g.type).push(y):o.set(g.type,[y])}function a(){return Array.from(n.values())}f.getAll=a;function s(y){let g=n.get(y);if(!g)throw new Error(`A transformer with signature '${y}' is not registered.`);return g}f.get=s;function l(y){return o.get(y)||[]}f.fromType=l;function u(y,g){let{name:x}=g,S=`${y}.${x}`;n.has(S)&&console.warn(`A transform with id '${x}' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.`);let I={apply(v,A,_){return Ar.create(v,I,A,_)},toAction(){return Ss.fromTransformer(I)},namespace:y,id:S,definition:g,createDefaultParams(v,A){return g.params?C.getDefaultValues(g.params(v,A)):{}}};return n.set(S,I),i(I),I}f.create=u;function c(y){return g=>u(y,g)}f.factory=c;function m(y){return d.build(y)}f.builderFactory=m;let d;(x=>{function y(S,I){return v=>u(S,{name:I.name,from:I.from instanceof Array?I.from:[I.from],to:I.to instanceof Array?I.to:[I.to],display:typeof I.display=="string"?{name:I.display}:I.display?I.display:{name:Kc(I.name.replace(/[-]/g," "))},params:typeof I.params=="object"?()=>I.params:I.params?I.params:void 0,isDecorator:I.isDecorator,...v})}function g(S){return I=>y(S,I)}x.build=g})(d=f.Builder||={});function p(y){return d.build(y)}f.build=p,f.ROOT=u("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply(){throw new Error("should never be applied")},update(){return 0}})})(Je||={});var Ar;(y=>{y.RootRef="-=root=-";function t(g,x){return x?typeof x.isCollapsed<"u"&&g.isCollapsed!==x.isCollapsed||typeof x.isHidden<"u"&&g.isHidden!==x.isHidden||typeof x.isGhost<"u"&&g.isGhost!==x.isGhost||typeof x.isLocked<"u"&&g.isLocked!==x.isLocked:!1}y.isStateChange=t;function r(g,x){if(!x)return!1;let S=!1;for(let I of Object.keys(x)){let v=x[I],A=g[I];!!v!=!!A&&(S=!0,g[I]=v)}return S}y.assignState=r;function n(g,x){if(!x)return!1;let S=!1;for(let I of Object.keys(x)){let v=x[I],A=g[I];!!v!=!!A&&(S=!0,v!==void 0?g[I]=v:delete g[I])}for(let I of Object.keys(g)){let v=x[I],A=g[I];!!v!=!!A&&(S=!0,v!==void 0?g[I]=v:delete g[I])}return S}y.syncState=n;function o(g,x,S,I){let v=I&&I.ref?I.ref:en.create22(),A;return I&&I.tags&&(A=typeof I.tags=="string"?[I.tags]:I.tags,A.length===0?A=void 0:A.sort()),{parent:g,transformer:x,state:I?.state||{},tags:A,ref:v,dependsOn:I&&I.dependsOn,params:S,version:en.create22()}}y.create=o;function i(g,x){return{...g,params:x,version:en.create22()}}y.withParams=i;function a(g,x){return x?{...g,state:{...g.state,...x}}:g}y.withState=a;function s(g,x){let S;return x&&(S=typeof x=="string"?[x]:x,S.length===0?S=void 0:S.sort()),{...g,tags:S,version:en.create22()}}y.withTags=s;function l(g,x){let S;return x&&(S=typeof x=="string"?[x]:x,S.length===0?S=void 0:S.sort()),{...g,dependsOn:S,version:en.create22()}}y.withDependsOn=l;function u(g,x){return{...g,parent:x,version:en.create22()}}y.withParent=u;function c(g){return o(y.RootRef,Je.ROOT,{},{ref:y.RootRef,state:g})}y.createRoot=c;function m(g,x){return g.tags?g.tags.indexOf(x)>=0:!1}y.hasTag=m;function d(g,x){if(!g.tags)return typeof x!="string"&&x.length===0;if(typeof x=="string")return m(g,x);for(let S of x)if(g.tags.indexOf(S)<0)return!1;return!0}y.hasTags=d;function p(g){return g}function h(g){let x=g.transformer.definition.customSerialization?g.transformer.definition.customSerialization.toJSON:p,S;for(let I of Object.keys(g.state))g.state[I]&&(S||(S={}),S[I]=!0);return{parent:g.parent,transformer:g.transformer.id,params:g.params?x(g.params):void 0,state:S,tags:g.tags,ref:g.ref,dependsOn:g.dependsOn,version:g.version}}y.toJSON=h;function f(g){let x=Je.get(g.transformer),S=x.definition.customSerialization?x.definition.customSerialization.fromJSON:p;return{parent:g.parent,transformer:x,params:g.params?S(g.params):void 0,state:g.state||{},tags:g.tags,ref:g.ref,dependsOn:g.dependsOn,version:g.version}}y.fromJSON=f})(Ar||={});var M2=class{constructor(t){this.tree=t;this.transforms=this.tree.transforms;this.children=this.tree.children;this.dependencies=this.tree.dependencies;this.changedNodes=!1;this.changedChildren=!1;this.changedDependencies=!1;this._childMutations=void 0;this._dependencyMutations=void 0;this._stateUpdates=void 0}get childMutations(){return this._childMutations?this._childMutations:(this._childMutations=new Map,this._childMutations)}get dependencyMutations(){return this._dependencyMutations?this._dependencyMutations:(this._dependencyMutations=new Map,this._dependencyMutations)}changeNodes(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())}changeChildren(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())}changeDependencies(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())}get root(){return this.transforms.get(Ar.RootRef)}asTransient(){return this.asImmutable().asTransient()}addChild(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(r);else{let n=this.children.get(t).asMutable();n.add(r),this.children.set(t,n),this.childMutations.set(t,n)}}removeChild(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(r);else{let n=this.children.get(t).asMutable();n.remove(r),this.children.set(t,n),this.childMutations.set(t,n)}}clearRoot(){let t=Ar.RootRef;if(this.children.get(t).size===0)return;this.changeChildren();let r=Wm();this.children.set(t,r),this.childMutations.set(t,r)}mutateDependency(t,r,n){let o=this.dependencyMutations.get(t);if(!o){let i=this.dependencies.get(t);if(!i&&n==="remove")return;this.changeDependencies(),o=i?i.asMutable():Wm().asMutable(),this.dependencyMutations.set(t,o),this.dependencies.set(t,o)}n==="add"?o.add(r):o.remove(r)}changeParent(t,r){E2(this.transforms,t);let n=this.transforms.get(t);this.removeChild(n.parent,t),this.addChild(r,t),this.changeNodes(),this.transforms.set(t,Ar.withParent(n,r))}add(t){let r=t.ref;this.transforms.has(t.ref)&&this.transforms.get(t.ref).parent!==t.parent&&v4e(t.ref);let n=this.children.get(t.parent);if(n||I4e(t.parent),n.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,Wm())),this.changeNodes(),this.transforms.set(r,t),t.dependsOn)for(let o of t.dependsOn)this.mutateDependency(o,r,"add");return this}setParams(t,r){E2(this.transforms,t);let n=this.transforms.get(t);return eb(n.params,r)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,Ar.withParams(n,r)),!0)}setTags(t,r){E2(this.transforms,t);let n=this.transforms.get(t),o=Ar.withTags(n,r);return kC(n.tags,o.tags)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,o),!0)}setDependsOn(t,r){E2(this.transforms,t);let n=this.transforms.get(t),o=Ar.withDependsOn(n,r);return kC(n.dependsOn,o.dependsOn)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,o),!0)}assignState(t,r){E2(this.transforms,t);let n=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return Ar.assignState(n.state,r),n;{this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes();let o=Ar.withState(n,r);return this.transforms.set(t,o),o}}remove(t){let r=this.transforms.get(t);if(!r)return[];let n=zo.subtreePostOrder(this,r);if(t===Ar.RootRef){if(n.pop(),n.length===0)return n;this.clearRoot()}else{if(n.length===0)return n;this.removeChild(r.parent,r.ref)}this.changeNodes(),this.changeChildren();for(let i of n)this.transforms.delete(i.ref),this.children.delete(i.ref),this._childMutations&&this._childMutations.delete(i.ref);let o=[];for(let i of n){if(i.dependsOn)for(let a of i.dependsOn)this.transforms.has(a)&&this.mutateDependency(a,i.ref,"remove");if(this.dependencies.has(i.ref)){let a=this.dependencies.get(i.ref).toArray();this.changeDependencies(),this.dependencies.delete(i.ref),this._dependencyMutations&&this._dependencyMutations.delete(i.ref);for(let s of a)if(this.transforms.has(s))for(let l of this.remove(s))o[o.length]=l}}for(let i of o)n[n.length]=i;return n}asImmutable(){return!this.changedNodes&&!this.changedChildren&&!this._childMutations?this.tree:(this._childMutations&&this._childMutations.forEach(C4e,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(S4e,this.dependencies),zo.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies))}};function C4e(e,t){this.set(t,e.asImmutable())}function S4e(e,t){e.size===0?this.delete(t):this.set(t,e.asImmutable())}function v4e(e){throw new Error(`Transform '${e}' is already present in the tree.`)}function I4e(e){throw new Error(`Parent '${e}' must be present in the tree.`)}function E2(e,t){if(!e.has(t))throw new Error(`Node '${t}' is not present in the tree.`)}var zo;(x=>{class e{constructor(I,v,A){this.transforms=I;this.children=v;this.dependencies=A}get root(){return this.transforms.get(Ar.RootRef)}asTransient(){return new M2(this)}}function t(S){let I=S||Ar.createRoot();return r(Xm([[I.ref,I]]),Xm([[I.ref,Wm()]]),Xm())}x.createEmpty=t;function r(S,I,v){return new e(S,I,v)}x.create=r;function n(S){o(this,this.tree.transforms.get(S))}function o(S,I){let v=S.tree.children.get(I.ref);v&&v.size&&v.forEach(n,S),S.f(I,S.tree,S.state)}function i(S,I,v,A){let _={tree:S,state:v,f:A};return o(_,I),_.state}x.doPostOrder=i;function a(S){s(this,this.tree.transforms.get(S))}function s(S,I){let v=S.f(I,S.tree,S.state);if(typeof v=="boolean"&&!v)return;let A=S.tree.children.get(I.ref);A&&A.size&&A.forEach(a,S)}function l(S,I,v,A){let _={tree:S,state:v,f:A};return s(_,I),_.state}x.doPreOrder=l;function u(S,I,v){v.push(S)}function c(S,I){return i(S,I,[],u)}x.subtreePostOrder=c;function m(S,I,v){v.push(Ar.toJSON(S))}function d(S){let I=[];return l(S,S.root,I,m),{transforms:I}}x.toJSON=d;function p(S){let I=Xm().asMutable(),v=Xm().asMutable(),A=Xm().asMutable();for(let T of S.transforms){let w=Ar.fromJSON(T);I.set(w.ref,w),v.has(w.ref)||v.set(w.ref,Wm().asMutable()),w.ref!==w.parent&&v.get(w.parent).add(w.ref)}let _=new Set;for(let T of S.transforms){let w=T.ref;if(v.set(w,v.get(w).asImmutable()),!!T.dependsOn)for(let D of T.dependsOn)_.add(D),A.has(D)?A.get(D).add(w):A.set(D,Wm([w]).asMutable())}return _.forEach(T=>{A.set(T,A.get(T).asImmutable())}),r(I.asImmutable(),v.asImmutable(),A.asImmutable())}x.fromJSON=p;function h(S){console.log({tr:S.transforms.keySeq().toArray(),tr1:S.transforms.valueSeq().toArray().map(I=>I.ref),ch:S.children.keySeq().toArray()})}x.dump=h;function f(S,I,v){if(I===v)return!0;let _=S.children.get(I).values();for(;;){let T=_.next();if(T.done)return!1;if(f(S,T.value,v))return!0}}function y(S,I,v){return!S.transforms.has(I)||!S.transforms.has(v)?!1:f(S,I,v)}x.subtreeHasRef=y;function g(S,I){let v=S.children.get(I);if(v.size!==1)return I;let A=S.transforms.get(v.first());return A?.transformer.definition.isDecorator?g(S,A.ref):I}x.getDecoratorRoot=g})(zo||={});var er;(Y=>{function e($,ce){return t($)(ce)}Y.select=e;function t($){let ce=$||l.root,ie;return n(ce)?ie=ce.compile():r(ce)?ie=l.byValue(ce).compile():o(ce)?ie=ce:ie=l.byRef(ce).compile(),ie}Y.compile=t;function r($){return $.transform!==void 0&&$.status!==void 0}function n($){return $.compile!==void 0}function o($){return typeof $=="function"}let i={select($){return e(this,$||this.state)}};function a($,ce){i[$]=function(...ie){return ce.call(void 0,this,...ie)}}function s($){return Object.create(i,{compile:{writable:!1,configurable:!1,value:$}})}let l;(Ae=>{Ae.root=s(()=>Ce=>[Ce.cells.get(Ce.tree.root.ref)]);function ce(...Ce){return s(()=>J=>{let z=[];for(let ae of Ce){let ge=J.cells.get(ae);ge&&z.push(ge)}return z})}Ae.byRef=ce;function ie(...Ce){return s(()=>J=>Ce)}Ae.byValue=ie;function oe(Ce,J=Ar.RootRef){return s(()=>z=>{let ae={roots:[],cells:z.cells,type:Ce.type};return zo.doPreOrder(z.tree,z.tree.transforms.get(J),ae,ue),ae.roots})}Ae.rootsOfType=oe;function W(Ce,J=Ar.RootRef){return s(()=>z=>{let ae={ret:[],cells:z.cells,type:Ce.type};return zo.doPreOrder(z.tree,z.tree.transforms.get(J),ae,be),ae.ret})}Ae.ofType=W;function N(Ce,J=Ar.RootRef){return s(()=>z=>{let ae={ret:[],cells:z.cells,t:Ce};return zo.doPreOrder(z.tree,z.tree.transforms.get(J),ae,ee),ae.ret})}Ae.ofTransformer=N;function j(Ce,J=Ar.RootRef){return s(()=>z=>{let ae={ret:[],cells:z.cells,t:Ce};return zo.doPreOrder(z.tree,z.tree.transforms.get(J),ae,le),ae.ret})}Ae.ofTransformerWithError=j;function ue(Ce,J,z){let ae=z.cells.get(Ce.ref);return ae&&ae.obj&&ae.obj.type===z.type?(z.roots.push(ae),!1):!0}function be(Ce,J,z){let ae=z.cells.get(Ce.ref);return ae&&ae.obj&&ae.obj.type===z.type&&z.ret.push(ae),!0}function ee(Ce,J,z){let ae=z.cells.get(Ce.ref);return ae&&ae.obj&&ae.transform.transformer===z.t&&z.ret.push(ae),!0}function le(Ce,J,z){let ae=z.cells.get(Ce.ref);return ae&&ae.status==="error"&&ae.transform.transformer===z.t&&z.ret.push(ae),!0}})(l=Y.Generators||={}),a("flatMap",u);function u($,ce){let ie=t($);return s(()=>oe=>{let W=[];for(let N of ie(oe))for(let j of ce(N,oe))W.push(j);return W})}Y.flatMap=u,a("mapObject",c);function c($,ce){let ie=t($);return s(()=>oe=>{let W=[];for(let N of ie(oe)){let j=ce(N,oe);j&&W.push(j)}return W})}Y.mapObject=c,a("unique",m);function m($){let ce=t($);return s(()=>ie=>{let oe=new Set,W=[];for(let N of ce(ie))N&&(oe.has(N.transform.ref)||(oe.add(N.transform.ref),W.push(N)));return W})}Y.unique=m,a("first",d);function d($){let ce=t($);return s(()=>ie=>{let oe=ce(ie);return oe.length?[oe[0]]:[]})}Y.first=d,a("filter",p);function p($,ce){return u($,ie=>ce(ie)?[ie]:[])}Y.filter=p,a("withStatus",h);function h($,ce){return p($,ie=>ie.status===ce)}Y.withStatus=h,a("withTag",f);function f($,ce){return p($,ie=>!!ie.transform.tags&&ie.transform.tags.indexOf(ce)>=0)}Y.withTag=f,a("subtree",y);function y($){return u($,(ce,ie)=>{let oe=[];return zo.doPreOrder(ie.tree,ie.tree.transforms.get(ce.transform.ref),oe,(W,N,j)=>{j.push(W.ref)}),oe.map(W=>ie.cells.get(W))})}Y.subtree=y,a("children",g);function g($){return u($,(ce,ie)=>{let oe=[];return ie.tree.children.get(ce.transform.ref).forEach(W=>oe.push(ie.cells.get(W))),oe})}Y.children=g,a("ofType",x);function x($,ce){return p($,ie=>ie.obj?ie.obj.type===ce.type:!1)}Y.ofType=x,a("ancestor",S);function S($,ce){return m(c($,(ie,oe)=>M(oe.tree,oe.cells,ie.transform.ref,ce)))}Y.ancestor=S,a("ancestorOfType",I);function I($,ce){return m(c($,(ie,oe)=>k(oe.tree,oe.cells,ie.transform.ref,ce)))}Y.ancestorOfType=I,a("ancestorWithTransformer",v);function v($,ce){return m(c($,(ie,oe)=>R(oe.tree,oe.cells,ie.transform.ref,ce)))}Y.ancestorWithTransformer=v,a("withTransformer",A);function A($,ce){return p($,ie=>ie.transform.transformer===ce)}Y.withTransformer=A,a("root",_);function _($,ce){return m(c($,(ie,oe)=>E(oe.tree,oe.cells,ie.transform.ref,ce)))}Y.root=_,a("rootOfType",T);function T($,ce){return m(c($,(ie,oe)=>B(oe.tree,oe.cells,ie.transform.ref,ce)))}Y.rootOfType=T,a("parent",w);function w($){return m(c($,(ce,ie)=>ie.cells.get(ie.tree.transforms.get(ce.transform.ref).parent)))}Y.parent=w;function D($,ce,ie,oe,W){let N=$.transforms.get(ie),j;for(;;){N=$.transforms.get(N.parent);let ue=ce.get(N.ref);if(ue.obj&&oe(ue)&&(j=ue,W)||N.ref===Ar.RootRef)return j}}function M($,ce,ie,oe){return D($,ce,ie,oe,!0)}Y.findAncestor=M;function E($,ce,ie,oe){return D($,ce,ie,oe,!1)}Y.findRoot=E;function R($,ce,ie,oe){return M($,ce,ie,Array.isArray(oe)?W=>oe.indexOf(W.transform.transformer)>=0:W=>W.transform.transformer===oe)}Y.findAncestorWithTransformer=R;function k($,ce,ie,oe){return M($,ce,ie,L(oe))}Y.findAncestorOfType=k;function B($,ce,ie,oe){return E($,ce,ie,L(oe))}Y.findRootOfType=B;function L($){return Array.isArray($)?ce=>{for(let ie of $)if(ie.type===ce.obj.type)return!0}:ce=>ce.obj.type===$.type}function V($,ce,ie){return zo.doPreOrder($,$.transforms.get(ce),{refs:{},tags:ie},U).refs}Y.findUniqueTagsInSubtree=V;function U($,ce,ie){if($.tags){for(let oe of $.tags)if(ie.tags.has(oe)){ie.refs[oe]=$.ref;break}}return!0}function Q($,ce,ie){return zo.doPreOrder($,$.transforms.get(ce),{ref:void 0,tag:ie},O).ref}Y.findTagInSubtree=Q;function O($,ce,ie){return $.tags&&$.tags.indexOf(ie.tag)>=0?(ie.ref=$.ref,!1):!0}function q($,ce,ie){return zo.doPreOrder($,$.transforms.get(ce),{refs:[],tags:ie},X).refs}Y.findWithAllTags=q;function X($,ce,ie){if($.tags){let oe=ie.tags.size,W=0;for(let N of $.tags)if(ie.tags.has(N)&&(W++,W===oe)){ie.refs.push($);break}}else ie.tags.size===0&&ie.refs.push($)}function F($,ce,ie){if($.transforms.get(ce).transformer===ie)return $.cells.get(ce);let W=$.tree.children.get(ce);if(W.size!==1)return;let N=W.first();if(N&&$.transforms.get(N).transformer.definition.isDecorator)return F($,N,ie)}Y.tryFindDecorator=F})(er||={});var Qae=Symbol.for("immer-nothing"),zae=Symbol.for("immer-draftable"),Qm=Symbol.for("immer-state");function rf(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var vv=Object.getPrototypeOf;function Iv(e){return!!e&&!!e[Qm]}function D0(e){return e?Zae(e)||Array.isArray(e)||!!e[zae]||!!e.constructor?.[zae]||YE(e)||KE(e):!1}var A4e=Object.prototype.constructor.toString();function Zae(e){if(!e||typeof e!="object")return!1;let t=vv(e);if(t===null)return!0;let r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===A4e}function XE(e,t){qE(e)===0?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,n)=>t(n,r,e))}function qE(e){let t=e[Qm];return t?t.type_:Array.isArray(e)?1:YE(e)?2:KE(e)?3:0}function u9(e,t){return qE(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function qae(e,t,r){let n=qE(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function T4e(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function YE(e){return e instanceof Map}function KE(e){return e instanceof Set}function R0(e){return e.copy_||e.base_}function c9(e,t){if(YE(e))return new Map(e);if(KE(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);let r=Zae(e);if(t===!0||t==="class_only"&&!r){let n=Object.getOwnPropertyDescriptors(e);delete n[Qm];let o=Reflect.ownKeys(n);for(let i=0;i<o.length;i++){let a=o[i],s=n[a];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(n[a]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[a]})}return Object.create(vv(e),n)}else{let n=vv(e);if(n!==null&&r)return{...e};let o=Object.create(n);return Object.assign(o,e)}}function h9(e,t=!1){return JE(e)||Iv(e)||!D0(e)||(qE(e)>1&&(e.set=e.add=e.clear=e.delete=P4e),Object.freeze(e),t&&Object.entries(e).forEach(([r,n])=>h9(n,!0))),e}function P4e(){rf(2)}function JE(e){return Object.isFrozen(e)}var _4e={};function w0(e){let t=_4e[e];return t||rf(0,e),t}var B2;function Yae(){return B2}function R4e(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Hae(e,t){t&&(w0("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function m9(e){d9(e),e.drafts_.forEach(D4e),e.drafts_=null}function d9(e){e===B2&&(B2=e.parent_)}function jae(e){return B2=R4e(B2,e)}function D4e(e){let t=e[Qm];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function Wae(e,t){t.unfinalizedDrafts_=t.drafts_.length;let r=t.drafts_[0];return e!==void 0&&e!==r?(r[Qm].modified_&&(m9(t),rf(4)),D0(e)&&(e=QE(t,e),t.parent_||ZE(t,e)),t.patches_&&w0("Patches").generateReplacementPatches_(r[Qm].base_,e,t.patches_,t.inversePatches_)):e=QE(t,r,[]),m9(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Qae?e:void 0}function QE(e,t,r){if(JE(t))return t;let n=t[Qm];if(!n)return XE(t,(o,i)=>Xae(e,n,t,o,i,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return ZE(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;let o=n.copy_,i=o,a=!1;n.type_===3&&(i=new Set(o),o.clear(),a=!0),XE(i,(s,l)=>Xae(e,n,o,s,l,r,a)),ZE(e,o,!1),r&&e.patches_&&w0("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function Xae(e,t,r,n,o,i,a){if(Iv(o)){let s=i&&t&&t.type_!==3&&!u9(t.assigned_,n)?i.concat(n):void 0,l=QE(e,o,s);if(qae(r,n,l),Iv(l))e.canAutoFreeze_=!1;else return}else a&&r.add(o);if(D0(o)&&!JE(o)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;QE(e,o),(!t||!t.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,n)&&ZE(e,o)}}function ZE(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&h9(t,r)}function w4e(e,t){let r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:Yae(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},o=n,i=g9;r&&(o=[n],i=k2);let{revoke:a,proxy:s}=Proxy.revocable(o,i);return n.draft_=s,n.revoke_=a,s}var g9={get(e,t){if(t===Qm)return e;let r=R0(e);if(!u9(r,t))return E4e(e,r,t);let n=r[t];return e.finalized_||!D0(n)?n:n===s9(e.base_,t)?(l9(e),e.copy_[t]=f9(n,e)):n},has(e,t){return t in R0(e)},ownKeys(e){return Reflect.ownKeys(R0(e))},set(e,t,r){let n=Kae(R0(e),t);if(n?.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){let o=s9(R0(e),t),i=o?.[Qm];if(i&&i.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(T4e(r,o)&&(r!==void 0||u9(e.base_,t)))return!0;l9(e),p9(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return s9(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,l9(e),p9(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){let r=R0(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){rf(11)},getPrototypeOf(e){return vv(e.base_)},setPrototypeOf(){rf(12)}},k2={};XE(g9,(e,t)=>{k2[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});k2.deleteProperty=function(e,t){return k2.set.call(this,e,t,void 0)};k2.set=function(e,t,r){return g9.set.call(this,e[0],t,r,e[0])};function s9(e,t){let r=e[Qm];return(r?R0(r):e)[t]}function E4e(e,t,r){let n=Kae(t,r);return n?"value"in n?n.value:n.get?.call(e.draft_):void 0}function Kae(e,t){if(!(t in e))return;let r=vv(e);for(;r;){let n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=vv(r)}}function p9(e){e.modified_||(e.modified_=!0,e.parent_&&p9(e.parent_))}function l9(e){e.copy_||(e.copy_=c9(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var M4e=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){let i=r;r=t;let a=this;return function(l=i,...u){return a.produce(l,c=>r.call(this,c,...u))}}typeof r!="function"&&rf(6),n!==void 0&&typeof n!="function"&&rf(7);let o;if(D0(t)){let i=jae(this),a=f9(t,void 0),s=!0;try{o=r(a),s=!1}finally{s?m9(i):d9(i)}return Hae(i,n),Wae(o,i)}else if(!t||typeof t!="object"){if(o=r(t),o===void 0&&(o=t),o===Qae&&(o=void 0),this.autoFreeze_&&h9(o,!0),n){let i=[],a=[];w0("Patches").generateReplacementPatches_(t,o,i,a),n(i,a)}return o}else rf(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(a,...s)=>this.produceWithPatches(a,l=>t(l,...s));let n,o;return[this.produce(t,r,(a,s)=>{n=a,o=s}),n,o]},typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){D0(e)||rf(8),Iv(e)&&(e=B4e(e));let t=jae(this),r=f9(e,void 0);return r[Qm].isManual_=!0,d9(t),r}finishDraft(e,t){let r=e&&e[Qm];(!r||!r.isManual_)&&rf(9);let{scope_:n}=r;return Hae(n,t),Wae(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){let o=t[r];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}r>-1&&(t=t.slice(r+1));let n=w0("Patches").applyPatches_;return Iv(e)?n(e,t):this.produce(e,o=>n(o,t))}};function f9(e,t){let r=YE(e)?w0("MapSet").proxyMap_(e,t):KE(e)?w0("MapSet").proxySet_(e,t):w4e(e,t);return(t?t.scope_:Yae()).drafts_.push(r),r}function B4e(e){return Iv(e)||rf(10,e),Jae(e)}function Jae(e){if(!D0(e)||JE(e))return e;let t=e[Qm],r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=c9(e,t.scope_.immer_.useStrictShallowCopy_)}else r=c9(e,!0);return XE(r,(n,o)=>{qae(r,n,Jae(o))}),t&&(t.finalized_=!1),r}var Zm=new M4e,su=Zm.produce,dkt=Zm.produceWithPatches.bind(Zm),$ae=Zm.setAutoFreeze.bind(Zm),pkt=Zm.setUseStrictShallowCopy.bind(Zm),fkt=Zm.applyPatches.bind(Zm),hkt=Zm.createDraft.bind(Zm),gkt=Zm.finishDraft.bind(Zm);var E0;(i=>{function e(a){if(!a.state||a.state.tree===a.editInfo.sourceTree)return a.tree.asImmutable();let s=a.state.tree.asTransient();for(let l of a.actions)switch(l.kind){case"add":s.add(l.transform);break;case"update":s.setParams(l.ref,l.params);break;case"delete":s.remove(l.ref);break;case"insert":{let u=s.children.get(l.ref).toArray();s.add(l.transform);for(let c of u)s.changeParent(c,l.transform.ref);break}}return a.editInfo.sourceTree=a.tree,s.asImmutable()}function t(a){return!!a&&typeof a.getTree=="function"}i.is=t;function r(a){return!!a&&typeof a.getTree=="function"&&typeof a.ref=="string"}i.isTo=r;class n{get editInfo(){return this.state.editInfo}get currentTree(){return this.state.tree}to(s){let l=typeof s=="string"?s:l2.is(s)?s.transform.ref:s.ref;return new o(this.state,l,this)}toRoot(){return new o(this.state,this.state.tree.root.ref,this)}delete(s){let l=Yo.resolveRef(s);return!l||!this.state.tree.transforms.has(l)?this:(this.editInfo.count++,this.state.tree.remove(l),this.state.actions.push({kind:"delete",ref:l}),this)}getTree(){return e(this.state)}commit(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))}constructor(s,l){this.state={state:l,tree:s.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:s,count:0,lastUpdate:void 0}}}}i.Root=n;class o{constructor(s,l,u){this.state=s;this.root=u;if(this.ref=l,!this.state.tree.transforms.has(l))throw new Error(`Could not find node '${l}'.`)}get editInfo(){return this.state.editInfo}get selector(){return new nv(this.ref,this.state.state)}getApplyRoot(){return zo.getDecoratorRoot(this.state.tree,this.ref)}apply(s,l,u){if(s.definition.isDecorator)return this.insert(s,l,u);let c=this.getApplyRoot(),m=s.apply(c,l,u);return this.state.tree.add(m),this.editInfo.count++,this.editInfo.lastUpdate=m.ref,this.state.actions.push({kind:"add",transform:m}),new o(this.state,m.ref,this.root)}applyOrUpdate(s,l,u,c){if(this.state.tree.transforms.has(s)){let m=this.to(s);return u&&m.update(u),m}else return this.apply(l,u,{...c,ref:s})}applyOrUpdateTagged(s,l,u,c){if(l.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");let m=this.getApplyRoot(),d=this.state.tree.children.get(m).values();for(;;){let h=d.next();if(h.done)break;let f=this.state.tree.transforms.get(h.value);if(f&&Ar.hasTags(f,s)){let y=this.to(h.value);return y.updateTagged(u,$E(f.tags,s,c&&c.tags)),y}}let p=l.apply(m,u,{...c,tags:$E(s,c&&c.tags)});return this.state.tree.add(p),this.editInfo.count++,this.editInfo.lastUpdate=p.ref,this.state.actions.push({kind:"add",transform:p}),new o(this.state,p.ref,this.root)}group(s,l,u){return this.apply(s,l,u)}insert(s,l,u){let c=this.state.tree.children.get(this.ref).toArray(),m=s.apply(this.ref,l,u);this.state.tree.add(m);for(let d of c)this.state.tree.changeParent(d,m.ref);return this.editInfo.count++,this.editInfo.lastUpdate=m.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:m}),new o(this.state,m.ref,this.root)}updateTagged(s,l){(this.state.tree.setParams(this.ref,s)||this.state.tree.setTags(this.ref,l))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:s}))}update(s,l){let u;if(l){let c=this.state.tree.transforms.get(this.ref);u=su(c.params,l)}else u=typeof s=="function"?su(this.state.tree.transforms.get(this.ref).params,s):s;return this.state.tree.setParams(this.ref,u)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:u})),this.root}updateState(s){let l=this.state.tree.transforms.get(this.ref);Ar.isStateChange(l.state,s)&&(this.state.tree.assignState(this.ref,s),this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.find(u=>u.kind==="update"&&u.ref===this.ref)||this.state.actions.push({kind:"update",ref:this.ref,params:l.params}))}tag(s){let l=this.state.tree.transforms.get(this.ref);return this.updateTagged(l.params,$E(l.tags,s)),this}dependsOn(s){let l=this.state.tree.transforms.get(this.ref);this.state.tree.setDependsOn(this.ref,$E(l.dependsOn,s))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:l.params}))}to(s){return this.root.to(s)}toRoot(){return this.root.toRoot()}delete(s){return this.root.delete(s)}getTree(){return e(this.state)}commit(s){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,s))}}i.To=o})(E0||={});function $E(...e){let t,r=[];for(let n of e)if(n)if(t||(t=new Set),typeof n=="string"){if(t.has(n))continue;t.add(n),r.push(n)}else for(let o of n)t.has(o)||(t.add(o),r.push(o));return r}var eM=class{constructor(){this.ev=oc.create();this.actions=new Map;this.fromTypeIndex=new Map;this.events={added:this.ev(),removed:this.ev()}}add(t){let r=Je.is(t)?t.toAction():t;if(this.actions.has(r.id))return this;this.actions.set(r.id,r);for(let n of r.definition.from)this.fromTypeIndex.has(n.type)?this.fromTypeIndex.get(n.type).push(r):this.fromTypeIndex.set(n.type,[r]);return this.events.added.next(void 0),this}remove(t){let r=Je.is(t)?t.toAction().id:en.is(t)?t:t.id,n=this.actions.get(r);if(!n)return this;this.actions.delete(r);for(let o of n.definition.from){let i=this.fromTypeIndex.get(o.type);i&&(Pd(i,n),i.length===0&&this.fromTypeIndex.delete(o.type))}return this.events.removed.next(void 0),this}fromCell(t,r){let n=t.obj;if(!n)return[];let o=this.fromTypeIndex.get(n.type);if(!o)return[];let i=!1;for(let s of o)if(s.definition.isApplicable){i=!0;break}if(!i)return o;let a=[];for(let s of o)s.definition.isApplicable?s.definition.isApplicable(n,t.transform,r)&&a.push(s):a.push(s);return a}dispose(){this.ev.dispose()}};var nf;(o=>{function e(i){return{type:"message",timestamp:new Date,message:i}}o.message=e;function t(i){return{type:"error",timestamp:new Date,message:i}}o.error=t;function r(i){return{type:"warning",timestamp:new Date,message:i}}o.warning=r;function n(i){return{type:"info",timestamp:new Date,message:i}}o.info=n})(nf||={});var M0;(n=>{class e{constructor(i){this.cells=i;this._current=void 0}get current(){return this._current}set current(i){this._current=i}getAncestorOfType(i){if(!this._current)return;let a=this._current;for(;;){if(a=this.cells.get(a.transform.parent),!a.obj)return;if(a.obj.type===i.type)return a.obj;if(a.transform.ref===Ar.RootRef)return}}getRootOfType(i){if(!this._current)return;let a=this._current,s;for(;;){if(!a.obj)return;if(a.obj.type===i.type&&(s=a),a.transform.ref===Ar.RootRef)return s?s.obj:void 0;a=this.cells.get(a.transform.parent)}}}n.Impl=e;function t(o,i){let a=o.cells,s=a.get(i),l=[s];for(;s?.transform.transformer.definition.isDecorator;)s=a.get(s.transform.parent),l.push(s);return l}n.getDecoratorChain=t;function r(o,i,a){let s,l=o.cells.get(a);if(l)for(;;){if(!l.obj)return;if(l.obj.type===i.type&&(s=l),l.transform.ref===Ar.RootRef)return s?s.obj:void 0;l=o.cells.get(l.transform.parent)}}n.getRootOfType=r})(M0||={});var tM=class{constructor(){this.queue=[];this.signal=new En}get length(){return this.queue.length}enqueue(t){return this.queue.push(t),this.queue.length===1?!0:this.waitFor(t)}handled(t){_g(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})}remove(t){let r=_g(this.queue,t);return r&&this.signal.next({v:t,stillPresent:!1}),r}waitFor(t){return new Promise(r=>{let n=this.signal.subscribe(({v:o,stillPresent:i})=>{o===t&&(n.unsubscribe(),r(i))})})}};var y9=class{constructor(t,r){this.getHash=t;this.areEqual=r;this.size=0;this.byHash=new Map}add(t){let r=this.getHash(t);if(this.byHash.has(r)){let n=this.byHash.get(r);for(let o=0,i=n.length;o<i;o++)if(this.areEqual(t,n[o]))return!1;return n[n.length]=t,this.size++,!0}else return this.byHash.set(r,[t]),this.size++,!0}has(t){let r=this.getHash(t);if(!this.byHash.has(r))return!1;let n=this.byHash.get(r);for(let o=0,i=n.length;o<i;o++)if(this.areEqual(t,n[o]))return!0;return!1}};function Av(e,t){return new y9(e,t)}function L2(){return new b9}function ese(e){return{previous:null,next:null,inList:!0,value:e}}var b9=class{constructor(){this.count=0;this.first=null;this.last=null}addFirst(t){let r=ese(t);return r.inList=!0,this.first&&(this.first.previous=r),r.next=this.first,this.first=r,this.count++,this.last||(this.last=r),r}addLast(t){let r=ese(t);return this.last!==null&&(this.last.next=r),r.previous=this.last,this.last=r,this.first===null&&(this.first=r),r.inList=!0,this.count++,r}removeFirst(){let t=this.first;if(t)return this.remove(t),t.value}removeLast(){let t=this.last;if(t)return this.remove(t),t.value}remove(t){t.inList&&(t.inList=!1,t.previous!==null?t.previous.next=t.next:t.previous===null&&(this.first=t.next),t.next!==null?t.next.previous=t.previous:t.next===null&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)}find(t){let r=this.first;for(;r!==null;){if(r.value===t)return r;r=r.next}}};var Tn;(n=>{function e(){return{keys:new Set,array:[]}}n.create=e;function t({keys:o,array:i},a,s){return o.has(a)?!1:(o.add(a),i[i.length]=s,!0)}n.add=t;function r({keys:o},i){return o.has(i)}n.has=r})(Tn||={});var rm=class{constructor(t,r){this.errorFree=!0;this.ev=oc.create();this.globalContext=void 0;this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()};this.behaviors={currentObject:this.ev.behavior({state:this,ref:Ar.RootRef}),isUpdating:this.ev.behavior(!1)};this.actions=new eM;this.cells=new Map;this.spine=new M0.Impl(this.cells);this.tryGetCellData=t=>{let r=this.cells.get(t)?.obj?.data;if(r===void 0)throw new Error(`Cell '${t}' data undefined.`);return r};this.historyCapacity=5;this.history=[];this.undoingHistory=!1;this.inTransaction=!1;this.inTransactionError=!1;this._inUpdate=!1;this.reverted=!1;this.updateQueue=new tM;this._tree=zo.createEmpty(Ar.createRoot(r&&r.rootState)).asTransient();let o=this._tree.root;this.runTask=r.runTask,r?.historyCapacity!==void 0&&(this.historyCapacity=r.historyCapacity),this.cells.set(o.ref,{parent:this,transform:o,sourceRef:void 0,obj:t,status:"ok",state:{...o.state},errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:o.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=r&&r.globalContext}get tree(){return this._tree}get transforms(){return this._tree.transforms}get current(){return this.behaviors.currentObject.value.ref}get root(){return this.cells.get(this._tree.root.ref)}build(){return new E0.Root(this.tree,this)}addHistory(t,r){this.historyCapacity!==0&&(this.history.unshift([t,r||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))}clearHistory(){this.history.length!==0&&(this.history=[],this.events.historyUpdated.next({state:this}))}get latestUndoLabel(){return this.history.length>0?this.history[0][1]:void 0}get canUndo(){return this.history.length>0}undo(){return Pe.create("Undo",async t=>{let r=this.history.shift();if(r){this.events.historyUpdated.next({state:this}),this.undoingHistory=!0;try{await this.updateTree(r[0],{canUndo:!1}).runInContext(t)}finally{this.undoingHistory=!1}}})}getSnapshot(){return{tree:zo.toJSON(this._tree)}}setSnapshot(t){let r=zo.fromJSON(t.tree);return this.updateTree(r)}setCurrent(t){this.behaviors.currentObject.next({state:this,ref:t})}updateCellState(t,r){let n=this.cells.get(t);if(!n)return;let o=typeof r=="function"?r(n.state):r;Ar.assignState(n.state,o)&&(n.transform=this._tree.assignState(n.transform.ref,o),this.events.cell.stateUpdated.next({state:this,ref:t,cell:n}))}dispose(){this.ev.dispose(),this.actions.dispose()}select(t){return er.select(t,this)}selectQ(t){return typeof t=="string"?er.select(t,this):er.select(t(er.Generators),this)}applyAction(t,r,n=Ar.RootRef){return Pe.create("Apply Action",o=>{let i=this.cells.get(n);if(!i)throw new Error(`'${n}' does not exist.`);if(i.status!=="ok")throw new Error(`Action cannot be applied to a cell with status '${i.status}'`);return S9(t.definition.run({ref:n,cell:i,a:i.obj,params:r,state:this},this.globalContext),o)})}transaction(t,r){return Pe.create("State Transaction",async n=>{let o=this.inTransaction,i=this._tree.asImmutable(),a=!1;try{o||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,await t(n),this.inTransactionError&&(a=!0,await this.updateTree(i).runInContext(n))}catch(s){if(a||(a=!0,await this.updateTree(i).runInContext(n),this.events.log.next(nf.error("Error during state transaction, reverting"))),o)throw this.inTransactionError=!0,s;if(r?.rethrowErrors)throw s;console.error(s)}finally{o||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),a||(r?.canUndo?this.addHistory(i,typeof r.canUndo=="string"?r.canUndo:void 0):this.clearHistory()))}})}get inUpdate(){return this._inUpdate}updateTree(t,r){let n={tree:t,options:r};return Pe.create("Update Tree",async o=>{if(!await this.updateQueue.enqueue(n))return;this._inUpdate=!0;let a=r?.canUndo?this._tree.asImmutable():void 0,s=!1;this.inTransaction||this.behaviors.isUpdating.next(!0);try{if(E0.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}this.reverted=!1;let l=r&&(r.revertIfAborted||r.revertOnError)?await this._revertibleTreeUpdate(o,n,r):await this._updateTree(o,n);return s=this.reverted,l.ctx.hadError&&(this.inTransactionError=!0),l.cell?new nv(l.cell.transform.ref,this):void 0}finally{this._inUpdate=!1,this.updateQueue.handled(n),this.inTransaction||(this.behaviors.isUpdating.next(!1),r?.canUndo?s||this.addHistory(a,typeof r.canUndo=="string"?r.canUndo:void 0):this.undoingHistory||this.clearHistory())}},()=>{this.updateQueue.remove(n)})}async _revertibleTreeUpdate(t,r,n){let o=this.tree,i=await this._updateTree(t,r);return(i.ctx.hadError||i.ctx.wasAborted)&&n.revertOnError||i.ctx.wasAborted&&n.revertIfAborted?(this.reverted=!0,await this._updateTree(t,{tree:o,options:r.options})):i}async _updateTree(t,r){let n=!1,o=this.updateTreeAndCreateCtx(r.tree,t,r.options);try{if(n=await F4e(o),E0.isTo(r.tree)){let i=this.select(r.tree.ref)[0];return{ctx:o,cell:i}}return{ctx:o}}finally{this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction})}}updateTreeAndCreateCtx(t,r,n){let o=(E0.is(t)?t.getTree():t).asTransient(),i=this._tree;this._tree=o;let a=this.cells,s={parent:this,editInfo:E0.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:r,oldTree:i,tree:o,cells:this.cells,spine:this.spine,results:[],options:{...L4e,...n},changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:l=>a.get(l).obj?.data};return this.errorFree=!0,s}};(r=>{function e(n,o){return new r(n,o)}r.create=e;let t;(o=>{function n(i,a){return!!a&&i.ref===a.transform.ref&&i.state===a.parent}o.isCell=n})(t=r.ObjectEvent||={})})(rm||={});var L4e={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};async function F4e(e){let t=!!(e.editInfo&&e.editInfo.count===1&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree),r,n=[],o;if(t)r=[],o=[e.editInfo.lastUpdate];else{r=U4e(e);let s=e.parent.current,l=!1;for(let u of r)if(u===s){l=!0;break}if(l){let u=tse(e.oldTree,s,r,e.cells);e.parent.setCurrent(u)}for(let u=r.length-1;u>=0;u--){let c=e.cells.get(r[u]);c&&rM(c.transform,c.obj,c?.transform.params,c.cache,e.parent.globalContext)}for(let u of r){let c=e.cells.get(u);c&&(c.parent=void 0,W4e(c));let m=c&&c.obj;e.cells.delete(u),n.push(m)}o=V4e(e.cells,e.tree)}let i=Z4e(e,o);for(let s of i.added)e.parent.events.cell.created.next({state:e.parent,ref:s.transform.ref,cell:s});for(let s=0;s<r.length;s++){let l=r[s],u=e.oldTree.transforms.get(l).parent;e.parent.events.object.removed.next({state:e.parent,ref:l,obj:n[s]}),e.parent.events.cell.removed.next({state:e.parent,ref:l,parent:u})}if(n.length&&(n=[]),i.dependent)for(let s of i.dependent)o.push(s.transform.ref);j4e(e,o);for(let s of o)await ose(e,s);e.editInfo||z4e(e);let a=e.newCurrent;for(let s of e.results)s.action==="created"?(e.parent.events.object.created.next({state:e.parent,ref:s.ref,obj:s.obj}),e.newCurrent||!e.tree.transforms.get(s.ref).state.isGhost&&s.obj!==An.Null&&(a=s.ref)):s.action==="updated"?e.parent.events.object.updated.next({state:e.parent,ref:s.ref,action:"in-place",obj:s.obj,oldData:s.oldData}):s.action==="replaced"&&e.parent.events.object.updated.next({state:e.parent,ref:s.ref,action:"recreate",obj:s.obj,oldObj:s.oldObj});if(a)e.options.doNotUpdateCurrent||e.parent.setCurrent(a);else{let s=e.parent.current,l=e.cells.get(s);l&&(l.obj===An.Null||l.status==="error"&&l.errorText===q4e)&&(a=tse(e.oldTree,s,[],e.cells),e.parent.setCurrent(a))}return r.length>0||o.length>0||e.changed}function V4e(e,t){let r={roots:[],cells:e};return zo.doPreOrder(t,t.root,r,O4e),r.roots}function O4e(e,t,r){let n=r.cells.get(e.ref);return!n||n.transform.version!==e.version?(r.roots.push(e.ref),!1):!(n.status==="error"||n&&n.obj===An.Null)}function G4e(e,t,r){!r.newTree.transforms.has(e.ref)&&r.cells.has(e.ref)&&r.deletes.push(e.ref)}function U4e(e){let t={newTree:e.tree,cells:e.cells,deletes:[]};return zo.doPostOrder(e.oldTree,e.oldTree.root,t,G4e),t.deletes}function N4e(e,t,r){let n=r.cells.get(e.ref);!n||!Ar.syncState(n.state,e.state)||r.parent.events.cell.stateUpdated.next({state:r.parent,ref:e.ref,cell:n})}function z4e(e){zo.doPreOrder(e.tree,e.tree.root,e,N4e)}function nM(e,t,r,n){let o=e.cells.get(t),i=o.status!==r;o.status=r,o.errorText=n,i&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:o})}function H4e(e,t,r){r.cells.get(e.ref).transform=e,nM(r,e.ref,"pending")}function j4e(e,t){for(let r of t)zo.doPreOrder(e.tree,e.tree.transforms.get(r),e,H4e)}function W4e(e){for(let t of e.dependencies.dependsOn)Pd(t.dependencies.dependentBy,e)}function X4e(e,t,{ctx:r,added:n,visited:o}){if(o.add(e.ref),r.cells.has(e.ref))return;let i={parent:r.parent,transform:e,sourceRef:void 0,status:"pending",state:{...e.state},errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};r.cells.set(e.ref,i),n.push(i)}function Q4e(e,t){if(e.transform.dependsOn)for(let r of e.transform.dependsOn){if(!t.tree.transforms.get(r))throw new Error("Cannot depend on a non-existent transform.");let o=t.cells.get(r);qo(e.dependencies.dependsOn,o),qo(o.dependencies.dependentBy,e)}}function Z4e(e,t){let r={ctx:e,visited:new Set,added:[]};for(let o of t)zo.doPreOrder(e.tree,e.tree.transforms.get(o),r,X4e);for(let o of r.added)Q4e(o,e);let n;return r.visited.forEach(o=>{let i=e.cells.get(o);for(let a of i.dependencies.dependentBy)r.visited.has(a.transform.ref)||(n||(n=Tn.create()),Tn.add(n,a.transform.ref,a))}),{added:r.added,dependent:n?n.array:void 0}}function tse(e,t,r,n){let o=new Set(r);return nse(e,t,o,n)}function nse(e,t,r,n){if(t===Ar.RootRef)return t;let o=e.transforms.get(t),i=e.children.get(o.parent).values(),a,s=!1;for(;;){let l=i.next();if(l.done)break;if(r.has(l.value))continue;let u=n.get(l.value);if(!u||u.status==="error"||u.obj===An.Null)continue;let c=e.transforms.get(l.value);if(!c.state.isGhost){if(l.value===t){s=!0,r.has(t)||(a=t);continue}if(s)return c.ref;a=c.ref}}return a||nse(e,o.parent,r,n)}function C9(e,t,r,n){n||(e.hadError=!0,e.parent.errorFree=!1);let o=e.cells.get(t);if(r){e.wasAborted=e.wasAborted||Pe.isAbort(r);let a=""+r;nM(e,t,"error",a),n||e.parent.events.log.next({type:"error",timestamp:new Date,message:a})}else o.params=void 0;if(o.obj){let a=o.obj;o.obj=void 0,o.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:a})}let i=e.tree.children.get(t).values();for(;;){let a=i.next();if(a.done)return;C9(e,a.value,void 0,n)}}var q4e="Parent is null";async function ose(e,t){nM(e,t,"processing");let r=!1;try{let o=Mn(),i=await K4e(e,t),a=Mn()-o;i.action!=="none"&&(e.changed=!0),nM(e,t,"ok"),e.results.push(i),i.action==="created"?(r=i.obj===An.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(nf.info(`Created ${i.obj.label} in ${U1(a)}.`))):i.action==="updated"?(r=i.obj===An.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(nf.info(`Updated ${i.obj.label} in ${U1(a)}.`))):i.action==="replaced"&&(r=i.obj===An.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(nf.info(`Updated ${i.obj.label} in ${U1(a)}.`)))}catch(o){e.changed=!0,e.hadError||(e.newCurrent=t),C9(e,t,o,!1),console.error(o);return}let n=e.tree.children.get(t).values();for(;;){let o=n.next();if(o.done)return;r?C9(e,o.value,void 0,!0):await ose(e,o.value)}}function Y4e(e,t,r,n){let o=t.transformer.definition.params,i=o?o(r,e.parent.globalContext):{};if(n.paramsNormalizedVersion!==t.version)t.params=C.normalizeParams(i,t.params,"all"),n.paramsNormalizedVersion=t.version;else{let a=C.getDefaultValues(i);t.params=t.params?yY(t.params,a):a}return C.resolveRefs(i,t.params,e.getCellData),{definition:i,values:t.params}}async function K4e(e,t){let{oldTree:r,tree:n}=e,o=e.cells.get(t),i=o.transform;if(o.transform.ref===Ar.RootRef)return{action:"none"};let a=e.cells.get(o.transform.parent);if(a?.obj===An.Null)if(o.sourceRef=a.transform.ref,r.transforms.has(t)&&o.params){let m=o.params.values,d=o.cache;return rM(i,o.obj,m,d,e.parent.globalContext),o.params=void 0,o.obj=An.Null,{ref:t,action:"updated",obj:o.obj}}else return o.params=void 0,{ref:t,action:"created",obj:An.Null};let l=i.transformer.definition.from.length===0?a:er.findAncestorOfType(n,e.cells,t,i.transformer.definition.from);if(!l)throw new Error(`No suitable parent found for '${t}'`);e.spine.current=o;let u=l.obj;o.sourceRef=l.transform.ref;let c=Y4e(e,i,u,o);if(!r.transforms.has(t)||!o.params){o.params=c;let m=await rse(e,o,i.transformer,u,c.values);return x9(m,i),o.obj=m,{ref:t,action:"created",obj:m}}else{let m=o.params.values,d=o.cache,p=o.obj?.data,h=c.values;switch(o.params=c,o.obj&&o.obj!==An.Null?await J4e(e,o,i.transformer,u,o.obj,m,h):Je.UpdateResult.Recreate){case Je.UpdateResult.Recreate:{let y=o.obj;rM(i,y,m,d,e.parent.globalContext);let g=await rse(e,o,i.transformer,u,h);return x9(g,i),o.obj=g,{ref:t,action:"replaced",oldObj:y,obj:g}}case Je.UpdateResult.Updated:return x9(o.obj,i),{ref:t,action:"updated",oldData:p,obj:o.obj};case Je.UpdateResult.Null:return rM(i,o.obj,m,d,e.parent.globalContext),o.obj=An.Null,{ref:t,action:"updated",obj:o.obj};default:return{action:"none"}}}}function rM(e,t,r,n,o){e.transformer.definition.dispose?.({b:t!==An.Null?t:void 0,params:r,cache:n},o)}function x9(e,t){!e||e===An.Null||(e.tags=t.tags)}function S9(e,t){return typeof e.runInContext=="function"?e.runInContext(t):e}function ise(e){if(e.dependencies.dependsOn.length===0)return;let t=Object.create(null);for(let r of e.dependencies.dependsOn){if(!r.obj)throw new Error("Unresolved dependency.");t[r.transform.ref]=r.obj}return t}function rse(e,t,r,n,o){return t.cache||(t.cache=Object.create(null)),S9(r.definition.apply({a:n,params:o,cache:t.cache,spine:e.spine,dependencies:ise(t)},e.parent.globalContext),e.taskCtx)}async function J4e(e,t,r,n,o,i,a){return r.definition.update?(t.cache||(t.cache=Object.create(null)),S9(r.definition.update({a:n,oldParams:i,b:o,newParams:a,cache:t.cache,spine:e.spine,dependencies:ise(t)},e.parent.globalContext),e.taskCtx)):Je.UpdateResult.Recreate}var re;(d=>{d.Create=An.factory();function t(p){return!!p&&p.type.typeClass==="Representation3D"}d.isRepresentation3D=t;function r(p){return!!p&&p.type.typeClass==="Behavior"}d.isBehavior=r;function n(p){return(0,d.Create)({...p,typeClass:"Representation3D"})}d.CreateRepresentation3D=n;function o(p){return(0,d.Create)({...p,typeClass:"Behavior"})}d.CreateBehavior=o;class i extends(0,d.Create)({name:"Root",typeClass:"Root"}){}d.Root=i;class a extends(0,d.Create)({name:"Group",typeClass:"Group"}){}d.Group=a;let s;(y=>{class p extends(0,d.Create)({name:"String Data",typeClass:"Data"}){}y.String=p;class h extends(0,d.Create)({name:"Binary Data",typeClass:"Data"}){}y.Binary=h;class f extends(0,d.Create)({name:"Data Blob",typeClass:"Data"}){}y.Blob=f})(s=d.Data||={});let l;(T=>{class p extends(0,d.Create)({name:"JSON Data",typeClass:"Data"}){}T.Json=p;class h extends(0,d.Create)({name:"CIF File",typeClass:"Data"}){}T.Cif=h;class f extends(0,d.Create)({name:"Cube File",typeClass:"Data"}){}T.Cube=f;class y extends(0,d.Create)({name:"PSF File",typeClass:"Data"}){}T.Psf=y;class g extends(0,d.Create)({name:"PRMTOP File",typeClass:"Data"}){}T.Prmtop=g;class x extends(0,d.Create)({name:"TOP File",typeClass:"Data"}){}T.Top=x;class S extends(0,d.Create)({name:"PLY File",typeClass:"Data"}){}T.Ply=S;class I extends(0,d.Create)({name:"CCP4/MRC/MAP File",typeClass:"Data"}){}T.Ccp4=I;class v extends(0,d.Create)({name:"DSN6/BRIX File",typeClass:"Data"}){}T.Dsn6=v;class A extends(0,d.Create)({name:"DX File",typeClass:"Data"}){}T.Dx=A;class _ extends(0,d.Create)({name:"Format Blob",typeClass:"Data"}){}T.Blob=_})(l=d.Format||={});let u;(x=>{class p extends(0,d.Create)({name:"Coordinates",typeClass:"Object"}){}x.Coordinates=p;class h extends(0,d.Create)({name:"Topology",typeClass:"Object"}){}x.Topology=h;class f extends(0,d.Create)({name:"Model",typeClass:"Object"}){}x.Model=f;class y extends(0,d.Create)({name:"Trajectory",typeClass:"Object"}){}x.Trajectory=y;class g extends(0,d.Create)({name:"Structure",typeClass:"Object"}){}x.Structure=g,(A=>{class S extends n({name:"Structure 3D"}){}A.Representation3D=S;class I extends(0,d.Create)({name:"Structure 3D State",typeClass:"Object"}){}A.Representation3DState=I;class v extends(0,d.Create)({name:"Selections",typeClass:"Object"}){}A.Selections=v})(g=x.Structure||={})})(u=d.Molecule||={});let c;(y=>{class p extends(0,d.Create)({name:"Volume",typeClass:"Object"}){}y.Data=p;class h extends(0,d.Create)({name:"Lazy Volume",typeClass:"Object"}){}y.Lazy=h;class f extends n({name:"Volume 3D"}){}y.Representation3D=f})(c=d.Volume||={});let m;(f=>{class p extends(0,d.Create)({name:"Shape Provider",typeClass:"Object"}){}f.Provider=p;class h extends n({name:"Shape 3D"}){}f.Representation3D=h})(m=d.Shape||={})})(re||={});var Bt;(r=>(r.CreateBuiltIn=Je.factory("ms-plugin"),r.BuiltIn=Je.builderFactory("ms-plugin")))(Bt||={});var qr;(m=>{class e extends re.Create({name:"Root",typeClass:"Root"}){}m.Root=e;class t extends re.Create({name:"Category",typeClass:"Object"}){}m.Category=t;class r extends re.CreateBehavior({name:"Behavior"}){}m.Behavior=r,m.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},m.CreateCategory=Bt.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:e,to:t,params:{label:C.Text("",{isHidden:!0})}})({apply({params:d}){return new t({},{label:d.label})}});let i=new Map;function a(d){return i.get(d.id)}m.getCategoryId=a;function s(d){let p=Bt.CreateBuiltIn({name:d.name,display:d.display,from:[e],to:[r],params:d.params,apply({params:h},f){let y=d.label?d.label(h):{label:d.display.name,description:d.display.description};return new r(new d.ctor(f,h),y)},update({b:h,newParams:f}){return Pe.create("Update Behavior",async()=>h.data.update?await h.data.update(f)?Je.UpdateResult.Updated:Je.UpdateResult.Unchanged:Je.UpdateResult.Unchanged)},canAutoUpdate:d.canAutoUpdate});return i.set(p.id,d.category),p}m.create=s;function l(d,p){return class{constructor(h){this.ctx=h;this.sub=void 0}register(){this.sub=d.subscribe(this.ctx,h=>p(h,this.ctx))}dispose(){this.sub&&this.sub.unsubscribe(),this.sub=void 0}}}m.simpleCommandHandler=l;class u{constructor(p,h){this.ctx=p;this.params=h;this.subs=[]}subscribeCommand(p,h){this.subs.push(p.subscribe(this.ctx,h))}subscribeObservable(p,h){this.subs.push(p.subscribe(h))}track(p){this.subs.push(p)}dispose(){for(let p of this.subs)p.unsubscribe();this.subs=[]}update(p){return Yf(p,this.params)?!1:(this.params=p,!0)}}m.Handler=u;class c{constructor(p,h){this.plugin=p;this.params=h;this.subs=[]}subscribeCommand(p,h){this.subs.push(p.subscribe(this.plugin,h))}subscribeObservable(p,h){let f=p.subscribe(h);return this.subs.push(f),{unsubscribe:()=>{let y=this.subs.indexOf(f);y>=0&&(this.subs.splice(y,1),f.unsubscribe())}}}dispose(){for(let p of this.subs)p.unsubscribe();this.subs=[]}}m.WithSubscribers=c})(qr||={});async function ase(e){let t=e.name.toLowerCase()||"file",r=["jpg","jpeg","png","gif","webp"].some(s=>t.endsWith(`.${s}`)),n="application/octet-stream";if(r){let s=t.split(".").pop()?.toLowerCase();switch(s){case"jpg":n="image/jpeg";break;default:n=`image/${s}`;break}}let o=await e.arrayBuffer(),i=new FileReader;return i.readAsDataURL(new Blob([o],{type:n})),await new Promise((s,l)=>{i.onload=()=>s(i.result),i.onerror=()=>l(i.error)})}function rs(e,t){return{value:e,unit:t}}var qm;(s=>{function e(l,u,c){let m=!!l[0].cell,d=!!l[0].velocities,p=!!l[0].forces;return{id:en.create22(),frames:l,hasCell:m,hasVelocities:d,hasForces:p,deltaTime:u,timeOffset:c}}s.create=e;function t(l,u,c){let{x:m,y:d,z:p}=l;return l.xyzOrdering.frozen?c?l.xyzOrdering.isIdentity?(m=i(m,c),d=i(d,c),p=i(p,c)):ki(l.xyzOrdering.index,c)||(m=o(m,l.xyzOrdering.index,c),d=o(d,l.xyzOrdering.index,c),p=o(p,l.xyzOrdering.index,c)):l.xyzOrdering.isIdentity||(m=a(m,l.xyzOrdering.index),d=a(d,l.xyzOrdering.index),p=a(p,l.xyzOrdering.index)):c&&(l.xyzOrdering.isIdentity?(l.xyzOrdering.isIdentity=!1,l.xyzOrdering.index=c,n(m,c),n(d,c),n(p,c)):ki(l.xyzOrdering.index,c)||(m=o(m,l.xyzOrdering.index,c),d=o(d,l.xyzOrdering.index,c),p=o(p,l.xyzOrdering.index,c))),l.xyzOrdering.frozen=!0,{id:en.create22(),atomId:u.atomId,occupancy:u.occupancy??H.ofConst(1,l.elementCount,H.Schema.int),B_iso_or_equiv:u.B_iso_or_equiv??H.ofConst(0,l.elementCount,H.Schema.float),xyzDefined:!0,x:m,y:d,z:p}}s.getAtomicConformation=t;let r=[.123];function n(l,u){let c=r;for(let m=0,d=l.length;m<d;m++)c[m]=l[u[m]];for(let m=0,d=l.length;m<d;m++)l[m]=c[m]}function o(l,u,c){let m=new Float32Array(l.length);for(let d=0,p=l.length;d<p;d++)m[d]=l[u[c[d]]];return m}function i(l,u){let c=new Float32Array(l.length);for(let m=0,d=l.length;m<d;m++)c[m]=l[u[m]];return c}function a(l,u){let c=new Float32Array(l.length);for(let m=0,d=l.length;m<d;m++)c[u[m]]=l[m];return c}})(qm||={});var B0;(t=>{function e(r,n,o,i){return{id:en.create22(),label:r,basic:n,sourceData:i,bonds:o}}t.create=e})(B0||={});function Al(e){return e}(t=>{function e(r){return r.__key||(r.__key=en.create22()),r.__key}t.getUUID=e})(Al||={});var ka=class{constructor(){this._list=[];this._set=new Set;this._refs=new Map;this._assets=new Map}get all(){return this._list}add(t){this._set.has(t)||(this._list.push(t),this._set.add(t))}reference(t,r){let n=this._refs.get(t)||0;n+=r?1:-1,this._refs.set(t,Math.max(n,0))}hasReference(t){return(this._refs.get(t)||0)>0}has(t){return this._set.has(t)}assets(t,r){let n=this._assets.get(t);if(n)for(let o of n)o.dispose();r?this._assets.set(t,r):this._assets.delete(t)}dispose(){this._assets.forEach(t=>{for(let r of t)r.dispose()})}};function sse(e,t){let r=[],n=[],o=[];e.x.length&&(r.push(...Su(e.x)),n.push(...Su(e.y)),o.push(...Su(e.z))),t&&(t.spheres.x.length&&(r.push(...Su(t.spheres.x)),n.push(...Su(t.spheres.y)),o.push(...Su(t.spheres.z))),t.gaussians.x.length&&(r.push(...Su(t.gaussians.x)),n.push(...Su(t.gaussians.y)),o.push(...Su(t.gaussians.z))));let[i,a]=Su(r),[s,l]=Su(n),[u,c]=Su(o),m=i+(a-i)/2,d=s+(l-s)/2,p=u+(c-u)/2;return b.create(m,d,p)}function lse(e){let t=new Set,r=new Set;return e.properties.structAsymMap.forEach(({auth_id:n},o)=>{t.add(n),r.add(o)}),{auth:t.size,label:r.size}}var ns;(c=>{function e(m,d){if(m===d)return!0;if(m.vertexCount!==d.vertexCount||m.edgeCount!==d.edgeCount)return!1;let{a:p,b:h,offset:f}=m,{a:y,b:g,offset:x}=d;for(let S=0,I=m.a.length;S<I;S++)if(p[S]!==y[S])return!1;for(let S=0,I=m.b.length;S<I;S++)if(h[S]!==g[S])return!1;for(let S=0,I=m.offset.length;S<I;S++)if(f[S]!==x[S])return!1;for(let S of Object.keys(m.edgeProps)){let I=m.edgeProps[S],v=d.edgeProps[S];if(!v)return!1;for(let A=0,_=I.length;A<_;A++)if(I[A]!==v[A])return!1}return!0}c.areEqual=e;class t{constructor(d,p,h,f,y,g){this.offset=d;this.a=p;this.b=h;this.edgeCount=f;this.props=g;this.vertexCount=d.length-1,this.edgeProps=y||{}}getEdgeIndex(d,p){let h,f;d<p?(h=d,f=p):(h=p,f=d);for(let y=this.offset[h],g=this.offset[h+1];y<g;y++)if(this.b[y]===f)return y;return-1}getDirectedEdgeIndex(d,p){for(let h=this.offset[d],f=this.offset[d+1];h<f;h++)if(this.b[h]===p)return h;return-1}getVertexEdgeCount(d){return this.offset[d+1]-this.offset[d]}}function r(m,d,p,h,f,y){return new t(m,d,p,h,f,y)}c.create=r;class n{constructor(d,p,h){this.vertexCount=d;this.xs=p;this.ys=h;this.current=0;this.curA=0;this.curB=0;this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);let f=new Int32Array(this.vertexCount);for(let g=0,x=this.xs.length;g<x;g++)f[this.xs[g]]++;for(let g=0,x=this.ys.length;g<x;g++)f[this.ys[g]]++;let y=0;for(let g=0;g<this.vertexCount;g++)this.offsets[g]=y,y+=f[g];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}createGraph(d,p){return r(this.offsets,this.a,this.b,this.edgeCount,d,p)}addNextEdge(){let d=this.xs[this.current],p=this.ys[this.current],h=this.offsets[d]+this.bucketFill[d];this.a[h]=d,this.b[h]=p,this.bucketFill[d]++;let f=this.offsets[p]+this.bucketFill[p];this.a[f]=p,this.b[f]=d,this.bucketFill[p]++,this.current++,this.curA=h,this.curB=f}addAllEdges(){for(let d=0;d<this.edgeCount;d++)this.addNextEdge()}assignProperty(d,p){d[this.curA]=p,d[this.curB]=p}assignDirectedProperty(d,p,h,f){d[this.curA]=p,d[this.curB]=f,h[this.curB]=p,h[this.curA]=f}}c.EdgeBuilder=n;class o{constructor(d,p,h){this.vertexCount=d;this.xs=p;this.ys=h;this.current=0;this.curA=0;this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);let f=new Int32Array(this.vertexCount);for(let g=0,x=this.xs.length;g<x;g++)f[this.xs[g]]++;let y=0;for(let g=0;g<this.vertexCount;g++)this.offsets[g]=y,y+=f[g];this.offsets[this.vertexCount]=y,this.slotCount=y,this.a=new Int32Array(y),this.b=new Int32Array(y)}createGraph(d,p){return r(this.offsets,this.a,this.b,this.edgeCount,d,p)}addNextEdge(){let d=this.xs[this.current],p=this.ys[this.current],h=this.offsets[d]+this.bucketFill[d];this.a[h]=d,this.b[h]=p,this.bucketFill[d]++,this.current++,this.curA=h}addAllEdges(){for(let d=0;d<this.edgeCount;d++)this.addNextEdge()}assignProperty(d,p){d[this.curA]=p}}c.DirectedEdgeBuilder=o;class i{constructor(d){this.vertexCount=d;this.xs=[];this.ys=[];this.included=new Set}addEdge(d,p){let h=d,f=p;d>p&&(h=p,f=d);let y=Xi(h,f);return this.included.has(y)?!1:(this.included.add(y),this.xs[this.xs.length]=h,this.ys[this.ys.length]=f,!0)}getGraph(){return a(this.vertexCount,this.xs,this.ys)}getEdgeBuiler(){return new n(this.vertexCount,this.xs,this.ys)}}c.UniqueEdgeBuilder=i;function a(m,d,p){let h=new c.EdgeBuilder(m,d,p);return h.addAllEdges(),h.createGraph({})}c.fromVertexPairs=a;function s(m,d,p){let{b:h,offset:f,vertexCount:y,edgeProps:g}=m,x=new Int32Array(y);for(let M=0,E=d.length;M<E;M++)x[d[M]]=M+1;let S=0;for(let M=0;M<y;M++)if(x[M]!==0)for(let E=f[M],R=f[M+1];E<R;E++)h[E]>M&&x[h[E]]!==0&&S++;let I=new Int32Array(d.length+1),v=new Int32Array(2*S),A=new Int32Array(2*S),_=new Int32Array(2*S),T=0,w=0;for(let M=0;M<y;M++){if(x[M]===0)continue;let E=x[M]-1;for(let R=f[M],k=f[M+1];R<k;R++){let B=x[h[R]];B!==0&&(A[T]=E,_[T]=B-1,v[T]=R,T++)}I[++w]=T}let D={};for(let M of Object.keys(g))D[M]=Iee(g[M],v);return r(I,A,_,S,D,p)}c.induceByVertices=s;function l(m){let d=m.vertexCount;if(d===0)return{componentCount:0,componentIndex:new Int32Array(0)};if(m.edgeCount===0){let S=new Int32Array(d);for(let I=0,v=d;I<v;I++)S[I]=I;return{componentCount:d,componentIndex:S}}let p=new Int32Array(d);for(let S=0,I=d;S<I;S++)p[S]=-1;let h=0;p[0]=h;let{offset:f,b:y}=m,g=[0],x=dN(d);for(x.remove(0);g.length>0;){let S=g.pop(),I=p[S];for(let v=f[S],A=f[S+1];v<A;v++){let _=y[v];x.has(_)&&(x.remove(_),g.push(_),p[_]=I)}g.length===0&&x.head>=0&&(g.push(x.head),p[x.head]=++h,x.remove(x.head))}return{componentCount:d,componentIndex:p}}c.connectedComponents=l;function u(m,d,p,h){if(Be.areIntersecting(d,p))return!0;if(h<1)return!1;let f=new Set;for(let y=0,g=d.length;y<g;++y)f.add(d[y]);return use(m,d,p,h,f)}c.areVertexSetsConnected=u})(ns||={});function use(e,t,r,n,o){let{b:i,offset:a}=e,s=[];for(let l=0,u=t.length;l<u;++l){let c=t[l];for(let m=a[c],d=a[c+1];m<d;++m){let p=i[m];if(!o.has(p)){if(Be.has(r,p))return!0;o.add(p),s[s.length]=p}}}return n>1?use(e,s,r,n-1,o):!1}var v9=class{constructor(){this.map=new Map;this.applicable=new Map}add(t,r,n){this.map.set(t,r),n&&this.applicable.set(t,n)}remove(t){this.map.delete(t),this.applicable.delete(t)}get(t){return this.map.get(t)}isApplicable(t){if(!this.map.has(t.sourceData.kind))return!1;let r=this.applicable.get(t.sourceData.kind);return r?r(t):!0}};var ll;(t=>{function e(r,n){let{name:o}=r,i=new v9;return{descriptor:r,formatRegistry:i,isApplicable(a){return i.isApplicable(a)},get(a){let s=n?.asDynamic?a._dynamicPropertyData:a._staticPropertyData;if(s[o])return s[o];if(a.customProperties.has(r))return;let l=i.get(a.sourceData.kind);if(l)return s[o]=l(a),a.customProperties.add(r),s[o]},set(a,s){n?.asDynamic?a._dynamicPropertyData[o]=s:a._staticPropertyData[o]=s},delete(a){n?.asDynamic?delete a._dynamicPropertyData[o]:delete a._staticPropertyData[o]}}}t.create=e})(ll||={});var I9=new Set(["145","147","149","289","291","293","445","475","491","510","604","045","05L","07E","07Y","08U","09X","0AT","0BD","0H0","0HX","0LP","0MK","0NZ","0TS","0UB","0V4","0WK","0XY","0YT","10M","12E","14T","15L","16F","16G","16O","17T","18D","18O","18T","1AR","1BW","1CF","1FT","1GL","1GN","1JB","1LL","1NA","1S3","1S4","1SD","1X4","20S","20X","22O","22S","23V","24S","25E","26M","26O","26Q","26R","26V","26W","26Y","27C","2DG","2DR","2F8","2FG","2FL","2FP","2GL","2GS","2H5","2HA","2M4","2M5","2M8","2OS","2SI","2WP","2WS","32O","34V","38J","3BU","3CM","3DO","3DY","3FM","3GR","3HD","3J3","3J4","3LJ","3LR","3MF","3MG","3MK","3R3","3S6","3SA","3YW","40J","42D","44S","46D","46M","46Z","48Z","49A","49S","49T","49V","4AM","4CQ","4GC","4GL","4GP","4JA","4N2","4NN","4QY","4R1","4RS","4SG","4U0","4U1","4U2","4UZ","4V5","50A","51N","56N","57S","5DI","5GF","5GO","5II","5KQ","5KS","5KT","5KV","5L2","5L3","5LS","5LT","5MM","5N6","5QP","5RP","5SA","5SP","5TH","5TJ","5TK","5TM","61J","62I","64K","66O","6BG","6C2","6DM","6GB","6GP","6GR","6K3","6KH","6KL","6KS","6KU","6KW","6LA","6LS","6LW","6MJ","6MN","6PG","6PY","6PZ","6S2","6SA","6UD","6Y6","6YR","6ZC","73E","79J","7CV","7D1","7GP","7JZ","7K2","7K3","7NU","7SA","83Y","89Y","8B7","8B9","8EX","8GA","8GG","8GP","8I4","8LM","8LR","8OQ","8PK","8S0","8YV","95Z","96O","98U","9AM","9C1","9CD","9GP","9KJ","9MR","9OK","9PG","9QG","9QZ","9RN","9S7","9SG","9SJ","9SM","9SP","9T1","9T7","9VP","9WJ","9WN","9WZ","9YW","A0K","A1AIO","A1EKO","A1H03","A1H0P","A1H0Z","A1H10","A1H1B","A1H1F","A1H1V","A1IH4","A1JAQ","A1L1P","A1Q","A2G","A5C","A6P","AAL","AAO","ABC","ABD","ABE","ABF","ABL","AC1","ACG","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AGR","AH2","AH8","AHG","AHM","AHR","AIG","ALL","ALX","AMG","AMN","AMU","AMV","ANA","AOG","AOS","AQA","ARA","ARB","ARE","ARI","ARW","ASC","ASG","ASO","AXP","AXR","AY9","AZC","B0D","B16","B1H","B1N","B2G","B4G","B6D","B7G","B8D","B9D","BBK","BBV","BCD","BCW","BDF","BDG","BDP","BDR","BDZ","BEM","BFN","BFP","BG6","BG8","BGC","BGL","BGN","BGP","BGS","BHG","BM3","BM7","BMA","BMX","BND","BNG","BNX","BO1","BOG","BQY","BRI","BS7","BTG","BTU","BW3","BWG","BXF","BXP","BXX","BXY","BZD","C3B","C3G","C3X","C4B","C4W","C4X","C5X","CAP","CBF","CBI","CBK","CDR","CE5","CE6","CE8","CEG","CEX","CEY","CEZ","CGF","CJB","CKB","CKP","CNP","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D0N","D1M","D5E","D6G","DAF","DAG","DAN","DDA","DDB","DDL","DEG","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGO","DGS","DGU","DIG","DJB","DJE","DK4","DKX","DKZ","DL6","DLD","DLF","DLG","DMU","DNO","DO8","DOM","DP5","DPC","DQQ","DQR","DR2","DR3","DR4","DR5","DRI","DSR","DT6","DVC","DYM","E3M","E4P","E5G","EAG","EBG","EBQ","ED6","EEN","EEQ","EGA","EJT","EMP","EMZ","EPG","EQP","EQV","ERE","ERI","ETT","EUS","F1P","F1X","F55","F58","F6P","F8X","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FFX","FIF","FIX","FK9","FKD","FMF","FMO","FNG","FNY","FRU","FSA","FSI","FSM","FSR","FSW","FU4","FUB","FUC","FUD","FUF","FUL","FUY","FVQ","FX1","FYJ","G0S","G16","G1P","G20","G28","G2F","G3F","G3I","G4D","G4S","G6D","G6P","G6S","G7P","G8Z","GAA","GAC","GAD","GAF","GAL","GAT","GBH","GC1","GC4","GC9","GCB","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GDA","GDL","GE1","GE3","GFP","GIV","GL0","GL1","GL2","GL4","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GM0","GMB","GMH","GMT","GMZ","GN1","GN4","GNS","GNX","GP0","GP1","GP4","GPH","GPK","GPM","GPO","GPQ","GPU","GPV","GPW","GQ1","GRF","GRX","GS1","GS4","GS9","GSA","GSD","GTE","GTH","GTK","GTM","GTR","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUL","GUP","GUZ","GXL","GXV","GYE","GYG","GYP","GYU","GYV","GZL","H1M","H1S","H2P","H3S","H53","H6Q","H6Z","HBZ","HD4","HDL","HLA","HMS","HNV","HNW","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","HTG","HTM","HVC","I57","IAB","IDC","IDF","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IEM","IN1","IPT","ISD","ISL","ISX","IVG","IXD","J5B","JFZ","JHM","JLT","JRV","JS2","JSV","JV4","JVA","JVS","JZR","K5B","K99","KBA","KBG","KD5","KDA","KDB","KDD","KDE","KDF","KDM","KDN","KDO","KDR","KFN","KG1","KGM","KHP","KME","KO1","KO2","KOT","KQC","KTU","L1L","L6N","L6S","L6T","LAG","LAH","LAI","LAK","LAO","LAT","LB2","LBS","LBT","LCN","LDY","LEC","LER","LFC","LFR","LGC","LGU","LKA","LKS","LM2","LMO","LMT","LMU","LNV","LOG","LOX","LPK","LRH","LSM","LTG","LTM","LVO","LVZ","LXB","LXC","LXZ","LZ0","M1F","M1P","M2F","M3M","M3N","M55","M6D","M6P","M7B","M7P","M8C","MA1","MA2","MA3","MA8","MAB","MAF","MAG","MAL","MAN","MAT","MAV","MAW","MBE","MBF","MBG","MCU","MDA","MDP","MFA","MFB","MFU","MG5","MGA","MGC","MGL","MGS","MJJ","MLB","MLR","MMA","MMN","MN0","MNA","MQG","MQT","MRH","MRP","MSX","MTT","MUB","MUG","MUR","MVP","MXY","MXZ","MYG","N1L","N3U","N9S","NA1","NAA","NAG","NBG","NBX","NBY","NDG","NED","NFG","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGK","NGL","NGR","NGS","NGY","NGZ","NHF","NLC","NM6","NM9","NNG","NOJ","NPF","NSQ","NT1","NTF","NTO","NTP","NXD","NYT","O1G","OAK","OEL","OI7","OPM","ORP","OSU","OTG","OTN","OTU","OX2","P53","P6P","P8E","PA1","PA5","PAV","PDX","PH5","PKM","PNA","PNG","PNJ","PNW","PPC","PRP","PSG","PSJ","PSV","PTQ","PUF","PZU","QDK","QIF","QKH","QPS","QV4","R1P","R1X","R2B","R2G","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RHC","RI2","RIB","RIP","RM4","RNS","RNT","ROB","ROR","RP3","RP5","RP6","RPA","RR7","RRJ","RRY","RST","RTG","RTV","RUB","RUG","RUU","RV7","RVG","RVM","RWI","RY7","RZM","S6P","S7P","S81","SA0","SCG","SCR","SDD","SDY","SEJ","SF6","SF9","SFJ","SFU","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHD","SHG","SI3","SIA","SID","SIO","SIZ","SLB","SLM","SLT","SMD","SN5","SNG","SOE","SOG","SOL","SOR","SR1","SSG","SSH","STW","STZ","SUC","SUP","SUS","SWE","SZZ","T68","T6D","T6P","T6T","TA6","TAG","TCB","TCG","TDG","TEU","TF0","TFU","TGA","TGK","TGR","TGY","TH1","TM5","TM6","TM9","TMR","TMX","TNX","TOA","TOC","TQY","TRE","TRV","TS8","TT7","TTV","TTZ","TU4","TUG","TUJ","TUP","TUR","TVD","TVG","TVM","TVS","TVV","TVY","TW7","TWA","TWD","TWG","TWJ","TWY","TXB","TY6","TYV","U1Y","U2A","U2D","U63","U8V","U97","U9A","U9D","U9G","U9J","U9M","UAP","UBH","UBO","UCD","UDC","UEA","V3M","V3P","V71","VDF","VG1","VJ1","VJ4","VKN","VTB","W9T","WIA","WKO","WKT","WOO","WT8","WUN","WZ1","WZ2","WZ4","X0X","X1P","X1X","X2F","X2Y","X34","X4S","X5S","X6N","X6X","X6Y","X6Z","XBP","XDP","XDX","XGP","XIL","XIQ","XKJ","XLF","XLS","XMM","XS2","XUL","XXM","XXR","XXX","XY6","XY9","XYB","XYF","XYL","XYP","XYS","XYT","XYZ","YDR","YIO","YJM","YKR","YO5","YX0","YX1","YYB","YYD","YYH","YYJ","YYK","YYM","YYQ","YYR","YZ0","YZT","Z0F","Z15","Z16","Z2D","Z2T","Z3K","Z3L","Z3Q","Z3U","Z4K","Z4R","Z4S","Z4U","Z4V","Z4W","Z4Y","Z57","Z5J","Z5L","Z61","Z6G","Z6H","Z6J","Z6W","Z8H","Z8T","Z9D","Z9E","Z9H","Z9K","Z9L","Z9M","Z9N","Z9W","ZB0","ZB1","ZB2","ZB3","ZCD","ZCZ","ZD0","ZDC","ZDM","ZDO","ZEE","ZEL","ZGE","ZMR","UMQ","SQD"]);var tr={Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817};var $4e={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11};function cse(e,t){return e===10?t===4?12:t===5?13:t===6?14:t===7?15:10:$4e[e]}var oM={abbr:"Unk",name:"Unknown",color:tr.Secondary,type:10},Tv=[{abbr:"Glc",name:"Glucose",color:tr.Blue,type:0},{abbr:"Man",name:"Mannose",color:tr.Green,type:0},{abbr:"Gal",name:"Galactose",color:tr.Yellow,type:0},{abbr:"Gul",name:"Gulose",color:tr.Orange,type:0},{abbr:"Alt",name:"Altrose",color:tr.Pink,type:0},{abbr:"All",name:"Allose",color:tr.Purple,type:0},{abbr:"Tal",name:"Talose",color:tr.LightBlue,type:0},{abbr:"Ido",name:"Idose",color:tr.Brown,type:0},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:tr.Blue,type:1},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:tr.Green,type:1},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:tr.Yellow,type:1},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:tr.Orange,type:1},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:tr.Pink,type:1},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:tr.Purple,type:1},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:tr.LightBlue,type:1},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:tr.Brown,type:1},{abbr:"GlcN",name:"Glucosamine",color:tr.Blue,type:2},{abbr:"ManN",name:"Mannosamine",color:tr.Green,type:2},{abbr:"GalN",name:"Galactosamine",color:tr.Yellow,type:2},{abbr:"GulN",name:"Gulosamine",color:tr.Orange,type:2},{abbr:"AltN",name:"Altrosamine",color:tr.Pink,type:2},{abbr:"AllN",name:"Allosamine",color:tr.Purple,type:2},{abbr:"TalN",name:"Talosamine",color:tr.LightBlue,type:2},{abbr:"IdoN",name:"Idosamine",color:tr.Brown,type:2},{abbr:"GlcA",name:"Glucuronic Acid",color:tr.Blue,type:3},{abbr:"ManA",name:"Mannuronic Acid",color:tr.Green,type:3},{abbr:"GalA",name:"Galacturonic Acid",color:tr.Yellow,type:3},{abbr:"GulA",name:"Guluronic Acid",color:tr.Orange,type:3},{abbr:"AltA",name:"Altruronic Acid",color:tr.Pink,type:3},{abbr:"AllA",name:"Alluronic Acid",color:tr.Purple,type:3},{abbr:"TalA",name:"Taluronic Acid",color:tr.LightBlue,type:3},{abbr:"IdoA",name:"Iduronic Acid",color:tr.Brown,type:3},{abbr:"Qui",name:"Quinovose",color:tr.Blue,type:4},{abbr:"Rha",name:"Rhamnose",color:tr.Green,type:4},{abbr:"6dGul",name:"6-Deoxy Gulose",color:tr.Orange,type:4},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:tr.Pink,type:4},{abbr:"6dTal",name:"6-Deoxy Talose",color:tr.LightBlue,type:4},{abbr:"Fuc",name:"Fucose",color:tr.Red,type:4},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:tr.Blue,type:5},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:tr.Green,type:5},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:tr.Pink,type:5},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:tr.LightBlue,type:5},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:tr.Red,type:5},{abbr:"Oli",name:"Olivose",color:tr.Blue,type:6},{abbr:"Tyv",name:"Tyvelose",color:tr.Green,type:6},{abbr:"Abe",name:"Abequose",color:tr.Orange,type:6},{abbr:"Par",name:"Paratose",color:tr.Pink,type:6},{abbr:"Dig",name:"Digitoxose",color:tr.Purple,type:6},{abbr:"Col",name:"Colitose",color:tr.LightBlue,type:6},{abbr:"Ara",name:"Arabinose",color:tr.Green,type:7},{abbr:"Lyx",name:"Lyxose",color:tr.Yellow,type:7},{abbr:"Xyl",name:"Xylose",color:tr.Orange,type:7},{abbr:"Rib",name:"Ribose",color:tr.Pink,type:7},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:tr.Green,type:8},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:tr.Purple,type:8},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:tr.LightBlue,type:8},{abbr:"Neu",name:"Neuraminic Acid",color:tr.Brown,type:8},{abbr:"Sia",name:"Sialic acid",color:tr.Red,type:8},{abbr:"Pse",name:"Pseudaminic Acid",color:tr.Green,type:9},{abbr:"Leg",name:"Legionaminic Acid",color:tr.Yellow,type:9},{abbr:"Aci",name:"Acinetaminic Acid",color:tr.Pink,type:9},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:tr.LightBlue,type:9},{abbr:"Bac",name:"Bacillosamine",color:tr.Blue,type:10},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:tr.Green,type:10},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:tr.Yellow,type:10},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:tr.Orange,type:10},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:tr.Pink,type:10},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:tr.Purple,type:10},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:tr.LightBlue,type:10},{abbr:"Mur",name:"Muramic Acid",color:tr.Brown,type:10},{abbr:"Api",name:"Apicose",color:tr.Green,type:11},{abbr:"Fru",name:"Fructose",color:tr.Green,type:11},{abbr:"Tag",name:"Tagatose",color:tr.Yellow,type:11},{abbr:"Sor",name:"Sorbose",color:tr.Orange,type:11},{abbr:"Psi",name:"Psicose",color:tr.Pink,type:11}],mse=function(){let e=new Map;for(let t=0,r=Tv.length;t<r;++t){let n=Tv[t];e.set(n.abbr,n)}return e}(),dse=[["Glc-family",tr.Blue],["Man-family",tr.Green],["Gal-family",tr.Yellow],["Gul-family",tr.Orange],["Alt-family",tr.Pink],["All-family",tr.Purple],["Tal-family",tr.LightBlue],["Ido-family",tr.Brown],["Fuc-family",tr.Red],["Generic/Unknown/Secondary",tr.Secondary]],pse={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},fse={Glc:["AGLC","BGLC"],GlcNAc:["AGLCNA","BGLCNA","BGLCN0"],GlcA:["AGLCA","BGLCA","BGLCA0"],Man:["AMAN","BMAN"],Rha:["ARHM","BRHM"],Ara:["AARB","BARB"],Gal:["AGAL","BGAL"],GalNAc:["AGALNA","BGALNA"],Gul:["AGUL","BGUL"],Alt:["AALT","BALT"],All:["AALL","BALL"],Tal:["ATAL","BTAL"],Ido:["AIDO","BIDO"],IdoA:["AIDOA","BIDOA"],Fuc:["AFUC","BFUC"],Lyx:["ALYF","BLYF"],Xyl:["AXYL","BXYL","AXYF","BXYF"],Rib:["ARIB","BRIB"],Fru:["AFRU","BFRU"],Neu5Ac:["ANE5AC","BNE5AC"]},eUe={Glc:["0GA","0GB","1GA","1GB","2GA","2GB","3GA","3GB","4GA","4GB","6GA","6GB","ZGA","ZGB","YGA","YGB","XGA","XGB","WGA","WGB","VGA","VGB","UGA","UGB","TGA","TGB","SGA","SGB","RGA","RGB","QGA","QGB","PGA","PGB","0gA","0gB","1gA","1gB","2gA","2gB","3gA","3gB","4gA","4gB","6gA","6gB","ZgA","ZgB","YgA","YgB","XgA","XgB","WgA","WgB","VgA","VgB","UgA","UgB","TgA","TgB","SgA","SgB","RgA","RgB","QgA","QgB","PgA","PgB"],GlcNAc:["0YA","0YB","1YA","1YB","3YA","3YB","4YA","4YB","6YA","6YB","WYA","WYB","VYA","VYB","UYA","UYB","QYA","QYB","0yA","0yB","1yA","1yB","3yA","3yB","4yA","4yB","6yA","6yB","WyA","WyB","VyA","VyB","UyA","UyB","QyA","QyB","0YS","0Ys","3YS","3Ys","4YS","4Ys","6YS","6Ys","QYS","QYs","UYS","UYs","VYS","VYs","WYS","WYs","0yS","0ys","3yS","3ys","4yS","4ys"],GlcA:["0ZA","0ZB","1ZA","1ZB","2ZA","2ZB","3ZA","3ZB","4ZA","4ZB","ZZA","ZZB","YZA","YZB","WZA","WZB","TZA","TZB","0zA","0zB","1zA","1zB","2zA","2zB","3zA","3zB","4zA","4zB","ZzA","ZzB","YzA","YzB","WzA","WzB","TzA","TzB","0ZBP"],GlcN:["0YN","3YN","4YN","6YN","WYN","VYN","UYN","QYN","3Yn","4Yn","WYn","0Yn","0YP","3YP","4YP","6YP","WYP","VYP","UYP","QYP","0Yp","3Yp","4Yp","WYp"],Man:["0MA","0MB","1MA","1MB","2MA","2MB","3MA","3MB","4MA","4MB","6MA","6MB","ZMA","ZMB","YMA","YMB","XMA","XMB","WMA","WMB","VMA","VMB","UMA","UMB","TMA","TMB","SMA","SMB","RMA","RMB","QMA","QMB","PMA","PMB","0mA","0mB","1mA","1mB","2mA","2mB","3mA","3mB","4mA","4mB","6mA","6mB","ZmA","ZmB","YmA","YmB","XmA","XmB","WmA","WmB","VmA","VmB","UmA","UmB","TmA","TmB","SmA","SmB","RmA","RmB","QmA","QmB","PmA","PmB"],ManNAc:["0WA","0WB","1WA","1WB","3WA","3WB","4WA","4WB","6WA","6WB","WWA","WWB","VWA","VWB","UWA","UWB","QWA","QWB","0wA","0wB","1wA","1wB","3wA","3wB","4wA","4wB","6wA","6wB","WwA","WwB","VwA","VwB","UwA","UwB","QwA","QwB"],Ara:["0AA","0AB","1AA","1AB","2AA","2AB","3AA","3AB","4AA","4AB","ZAA","ZAB","YAA","YAB","WAA","WAB","TAA","TAB","0AD","0AU","1AD","1AU","2AD","2AU","3AD","3AU","5AD","5AU","ZAD","ZAU","0aA","0aB","1aA","1aB","2aA","2aB","3aA","3aB","4aA","4aB","ZaA","ZaB","YaA","YaB","WaA","WaB","TaA","TaB","0aD","0aU","1aD","1aU","2aD","2aU","3aD","3aU","5aD","5aU","ZaD","ZaU"],Gal:["0LA","0LB","1LA","1LB","2LA","2LB","3LA","3LB","4LA","4LB","6LA","6LB","ZLA","ZLB","YLA","YLB","XLA","XLB","WLA","WLB","VLA","VLB","ULA","ULB","TLA","TLB","SLA","SLB","RLA","RLB","QLA","QLB","PLA","PLB","0lA","0lB","1lA","1lB","2lA","2lB","3lA","3lB","4lA","4lB","6lA","6lB","ZlA","ZlB","YlA","YlB","XlA","XlB","WlA","WlB","VlA","VlB","UlA","UlB","TlA","TlB","SlA","SlB","RlA","RlB","QlA","QlB","PlA","PlB"],GalNAc:["0VA","0VB","1VA","1VB","3VA","3VB","4VA","4VB","6VA","6VB","WVA","WVB","VVA","VVB","UVA","UVB","QVA","QVB","0vA","0vB","1vA","1vB","3vA","3vB","4vA","4vB","6vA","6vB","WvA","WvB","VvA","VvB","UvA","UvB","QvA","QvB"],GalA:["0OA","0OB","1OA","1OB","2OA","2OB","3OA","3OB","4OA","4OB","ZOA","ZOB","YOA","YOB","WOA","WOB","TOA","TOB","0oA","0oB","1oA","1oB","2oA","2oB","3oA","3oB","4oA","4oB","ZoA","ZoB","YoA","YoB","WoA","WoB","ToA","ToB"],Gul:["0KA","0KB","1KA","1KB","2KA","2KB","3KA","3KB","4KA","4KB","6KA","6KB","ZKA","ZKB","YKA","YKB","XKA","XKB","WKA","WKB","VKA","VKB","UKA","UKB","TKA","TKB","SKA","SKB","RKA","RKB","QKA","QKB","PKA","PKB","0kA","0kB","1kA","1kB","2kA","2kB","3kA","3kB","4kA","4kB","6kA","6kB","ZkA","ZkB","YkA","YkB","XkA","XkB","WkA","WkB","VkA","VkB","UkA","UkB","TkA","TkB","SkA","SkB","RkA","RkB","QkA","QkB","PkA","PkB"],Alt:["0EA","0EB","1EA","1EB","2EA","2EB","3EA","3EB","4EA","4EB","6EA","6EB","ZEA","ZEB","YEA","YEB","XEA","XEB","WEA","WEB","VEA","VEB","UEA","UEB","TEA","TEB","SEA","SEB","REA","REB","QEA","QEB","PEA","PEB","0eA","0eB","1eA","1eB","2eA","2eB","3eA","3eB","4eA","4eB","6eA","6eB","ZeA","ZeB","YeA","YeB","XeA","XeB","WeA","WeB","VeA","VeB","UeA","UeB","TeA","TeB","SeA","SeB","ReA","ReB","QeA","QeB","PeA","PeB"],All:["0NA","0NB","1NA","1NB","2NA","2NB","3NA","3NB","4NA","4NB","6NA","6NB","ZNA","ZNB","YNA","YNB","XNA","XNB","WNA","WNB","VNA","VNB","UNA","UNB","TNA","TNB","SNA","SNB","RNA","RNB","QNA","QNB","PNA","PNB","0nA","0nB","1nA","1nB","2nA","2nB","3nA","3nB","4nA","4nB","6nA","6nB","ZnA","ZnB","YnA","YnB","XnA","XnB","WnA","WnB","VnA","VnB","UnA","UnB","TnA","TnB","SnA","SnB","RnA","RnB","QnA","QnB","PnA","PnB"],Tal:["0TA","0TB","1TA","1TB","2TA","2TB","3TA","3TB","4TA","4TB","6TA","6TB","ZTA","ZTB","YTA","YTB","XTA","XTB","WTA","WTB","VTA","VTB","UTA","UTB","TTA","TTB","STA","STB","RTA","RTB","QTA","QTB","PTA","PTB","0tA","0tB","1tA","1tB","2tA","2tB","3tA","3tB","4tA","4tB","6tA","6tB","ZtA","ZtB","YtA","YtB","XtA","XtB","WtA","WtB","VtA","VtB","UtA","UtB","TtA","TtB","StA","StB","RtA","RtB","QtA","QtB","PtA","PtB"],Ido:["0IA","0IB","1IA","1IB","2IA","2IB","3IA","3IB","4IA","4IB","6IA","6IB","ZIA","ZIB","YIA","YIB","XIA","XIB","WIA","WIB","VIA","VIB","UIA","UIB","TIA","TIB","SIA","SIB","RIA","RIB","QIA","QIB","PIA","PIB","0iA","0iB","1iA","1iB","2iA","2iB","3iA","3iB","4iA","4iB","6iA","6iB","ZiA","ZiB","YiA","YiB","XiA","XiB","WiA","WiB","ViA","ViB","UiA","UiB","TiA","TiB","SiA","SiB","RiA","RiB","QiA","QiB","PiA","PiB"],IdoA:["0UA","0UB","1UA","1UB","2UA","2UB","3UA","3UB","4UA","4UB","ZUA","ZUB","YUA","YUB","WUA","WUB","TUA","TUB","0uA","0uB","1uA","1uB","2uA","2uB","3uA","3uB","4uA","4uB","ZuA","ZuB","YuA","YuB","WuA","WuB","TuA","TuB","YuAP"],Fuc:["0FA","0FB","1FA","1FB","2FA","2FB","3FA","3FB","4FA","4FB","ZFA","ZFB","YFA","YFB","WFA","WFB","TFA","TFB","0fA","0fB","1fA","1fB","2fA","2fB","3fA","3fB","4fA","4fB","ZfA","ZfB","YfA","YfB","WfA","WfB","TfA","TfB"],Rha:["0HA","0HB","1HA","1HB","2HA","2HB","3HA","3HB","4HA","4HB","ZHA","ZHB","YHA","YHB","WHA","WHB","THA","THB","0hA","0hB","1hA","1hB","2hA","2hB","3hA","3hB","4hA","4hB","ZhA","ZhB","YhA","YhB","WhA","WhB","ThA","ThB"],Qui:["0QA","0QB","1QA","1QB","2QA","2QB","3QA","3QB","4QA","4QB","ZQA","ZQB","YQA","YQB","WQA","WQB","TQA","TQB","0qA","0qB","1qA","1qB","2qA","2qB","3qA","3qB","4qA","4qB","ZqA","ZqB","YqA","YqB","WqA","WqB","TqA","TqB"],Lyx:["0DA","0DB","1DA","1DB","2DA","2DB","3DA","3DB","4DA","4DB","ZDA","ZDB","YDA","YDB","WDA","WDB","TDA","TDB","0DD","0DU","1DD","1DU","2DD","2DU","3DD","3DU","5DD","5DU","ZDD","ZDU","0dA","0dB","1dA","1dB","2dA","2dB","3dA","3dB","4dA","4dB","ZdA","ZdB","YdA","YdB","WdA","WdB","TdA","TdB","0dD","0dU","1dD","1dU","2dD","2dU","3dD","3dU","5dD","5dU","ZdD","ZdU"],Xyl:["0XA","0XB","1XA","1XB","2XA","2XB","3XA","3XB","4XA","4XB","ZXA","ZXB","YXA","YXB","WXA","WXB","TXA","TXB","0XD","0XU","1XD","1XU","2XD","2XU","3XD","3XU","5XD","5XU","ZXD","ZXU","0xA","0xB","1xA","1xB","2xA","2xB","3xA","3xB","4xA","4xB","ZxA","ZxB","YxA","YxB","WxA","WxB","TxA","TxB","0xD","0xU","1xD","1xU","2xD","2xU","3xD","3xU","5xD","5xU","ZxD","ZxU"],Rib:["0RA","0RB","1RA","1RB","2RA","2RB","3RA","3RB","4RA","4RB","ZRA","ZRB","YRA","YRB","WRA","WRB","TRA","TRB","0RD","0RU","1RD","1RU","2RD","2RU","3RD","3RU","5RD","5RU","ZRD","ZRU","0rA","0rB","1rA","1rB","2rA","2rB","3rA","3rB","4rA","4rB","ZrA","ZrB","YrA","YrB","WrA","WrB","TrA","TrB","0rD","0rU","1rD","1rU","2rD","2rU","3rD","3rU","5rD","5rU","ZrD","ZrU"],Fru:["0CA","0CB","1CA","1CB","2CA","2CB","3CA","3CB","4CA","4CB","5CA","5CB","WCA","WCB","0CD","0CU","1CD","1CU","2CD","2CU","3CD","3CU","4CD","4CU","6CD","6CU","WCD","WCU","VCD","VCU","UCD","UCU","QCD","QCU","0cA","0cB","1cA","1cB","2cA","2cB","3cA","3cB","4cA","4cB","5cA","5cB","WcA","WcB","0cD","0cU","1cD","1cU","2cD","2cU","3cD","3cU","4cD","4cU","6cD","6cU","WcD","WcU","VcD","VcU","UcD","UcU","QcD","QcU"],Tag:["0JA","0JB","1JA","1JB","2JA","2JB","3JA","3JB","4JA","4JB","5JA","5JB","WJA","WJB","0JD","0JU","1JD","1JU","2JD","2JU","3JD","3JU","4JD","4JU","6JD","6JU","WJD","WJU","VJD","VJU","UJD","UJU","QJD","QJU","0jA","0jB","1jA","1jB","2jA","2jB","3jA","3jB","4jA","4jB","5jA","5jB","WjA","WjB","0jD","0jU","1jD","1jU","2jD","2jU","3jD","3jU","4jD","4jU","6jD","6jU","WjD","WjU","VjD","VjU","UjD","UjU","QjD","QjU"],Sor:["0BA","0BB","1BA","1BB","2BA","2BB","3BA","3BB","4BA","4BB","5BA","5BB","WBA","WBB","0BD","0BU","1BD","1BU","2BD","2BU","3BD","3BU","4BD","4BU","6BD","6BU","WBD","WBU","VBD","VBU","UBD","UBU","QBD","QBU","0bA","0bB","1bA","1bB","2bA","2bB","3bA","3bB","4bA","4bB","5bA","5bB","WbA","WbB","0bD","0bU","1bD","1bU","2bD","2bU","3bD","3bU","4bD","4bU","6bD","6bU","WbD","WbU","VbD","VbU","UbD","UbU","QbD","QbU"],Psi:["0PA","0PB","1PA","1PB","2PA","2PB","3PA","3PB","4PA","4PB","5PA","5PB","WPA","WPB","0PD","0PU","1PD","1PU","2PD","2PU","3PD","3PU","4PD","4PU","6PD","6PU","WPD","WPU","VPD","VPU","UPD","UPU","QPD","QPU","0pA","0pB","1pA","1pB","2pA","2pB","3pA","3pB","4pA","4pB","5pA","5pB","WpA","WpB","0pD","0pU","1pD","1pU","2pD","2pU","3pD","3pU","4pD","4pU","6pD","6pU","WpD","WpU","VpD","VpU","UpD","UpU","QpD","QpU"],Neu5Ac:["0SA","0SB","4SA","4SB","7SA","7SB","8SA","8SB","9SA","9SB","ASA","ASB","BSA","BSB","CSA","CSB","DSA","DSB","ESA","ESB","FSA","FSB","GSA","GSB","HSA","HSB","ISA","ISB","JSA","JSB","KSA","KSB","0sA","0sB","4sA","4sB","7sA","7sB","8sA","8sB","9sA","9sB","AsA","AsB","BsA","BsB","CsA","CsB","DsA","DsB","EsA","EsB","FsA","FsB","GsA","GsB","HsA","HsB","IsA","IsB","JsA","JsB","KsA","KsB"],Neu5Gc:["0GL","4GL","7GL","8GL","9GL","CGL","DGL","EGL","FGL","GGL","HGL","IGL","JGL","KGL","0gL","4gL","7gL","8gL","9gL","AgL","BgL","CgL","DgL","EgL","FgL","GgL","HgL","IgL","JgL","KgL"],Tyv:["0TV","0Tv","1TV","1Tv","2TV","2Tv","4TV","4Tv","YTV","YTv","0tV","0tv","1tV","1tv","2tV","2tv","4tV","4tv","YtV","Ytv"],Abe:["0AE","2AE","4AE","YGa","0AF","2AF","4AF","YAF"],Bac:["0BC","3BC","0bC","3bC"],Kdn:["0KN","4KN","5KN","7KN","8KN","9KN","AKN","BKN","CKN","DKN","EKN","FKN","GKN","HKN","IKN","JKN","KKN","LKN","MKN","NKN","OKN","PKN","QKN","RKN","SKN","TKN","UKN","VKN","WKN","XKN","YKN","0Kn","4Kn","5Kn","7Kn","8Kn","9Kn","AKn","BKn","CKn","DKn","EKn","FKn","GKn","HKn","IKn","JKn","KKn","LKn","MKn","NKn","OKn","PKn","QKn","RKn","SKn","TKn","UKn","VKn","WKn","XKn","YKn"],Kdo:["0KO","4KO","5KO","7KO","8KO","AKO","BKO","CKO","DKO","EKO","FKO","GKO","HKO","IKO","JKO","KKO","0Ko","4Ko","5Ko","7Ko","8Ko","AKo","BKo","CKo","DKo","EKo","FKo","GKo","HKo","IKo","JKo","KKo"]},hse=function(){let e=new Map;for(let t=0,r=Tv.length;t<r;++t){let n=Tv[t],o=pse[n.abbr];if(o)for(let a=0,s=o.length;a<s;++a)e.set(o[a],n);let i=fse[n.abbr];if(i)for(let a=0,s=i.length;a<s;++a)e.set(i[a],n)}return I9.forEach(t=>{e.has(t)||e.set(t,oM)}),e}(),tUe=function(){let e=new Map;for(let t=0,r=Tv.length;t<r;++t){let n=Tv[t],o=pse[n.abbr];if(o)for(let s=0,l=o.length;s<l;++s)e.set(o[s],n);let i=fse[n.abbr];if(i)for(let s=0,l=i.length;s<l;++s)e.set(i[s],n);let a=eUe[n.abbr];if(a)for(let s=0,l=a.length;s<l;++s)e.has(a[s])||e.set(a[s],n)}return I9.forEach(t=>{e.has(t)||e.set(t,oM)}),e}();function gse(e){zd=e==="default"?hse:tUe}var zd=hse;var no;(d=>{function e(p){return Array.from(p.values())}d.toArray=e;function t(p,h){if(p===h)return!0;if(p.size<h.size)return!1;for(let f of h)if(!p.has(f))return!1;return!0}d.isSuperset=t;function r(p,...h){for(let f=0;f<h.length;f++)for(let y of h[f])p.add(y);return p}d.add=r;function n(p,h){let f=new Set(p);if(p===h)return f;for(let y of h)f.add(y);return f}d.union=n;function o(...p){if(p.length===0)return new Set;let h=new Set(p[0]);for(let f=1,y=p.length;f<y;f++)for(let g of p[f])h.add(g);return h}d.unionMany=o;function i(p){if(p.length===0)return new Set;let h=new Set(p[0]);for(let f=1;f<p.length;f++)for(let y of p[f])h.add(y);return h}d.unionManyArrays=i;function a(p,h){if(p===h)return new Set(p);let f=new Set;for(let y of h)p.has(y)&&f.add(y);return f}d.intersection=a;function s(p,h){if(p===h)return p.size>0;p.size<h.size&&([p,h]=[h,p]);for(let f of h)if(p.has(f))return!0;return!1}d.areIntersecting=s;function l(p,h){if(p===h)return p.size;p.size<h.size&&([p,h]=[h,p]);let f=0;for(let y of h)p.has(y)&&(f+=1);return f}d.intersectionSize=l;function u(p,h){if(p===h)return new Set;let f=new Set(p);for(let y of h)f.delete(y);return f}d.difference=u;function c(p,h){if(p===h)return 0;let f=p.size;for(let y of p)h.has(y)&&(f-=1);return f}d.differenceSize=c;function m(p,h){if(p===h)return!0;if(p.size!==h.size)return!1;for(let f of h)if(!p.has(f))return!1;return!0}d.areEqual=m})(no||={});var A9=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DMPC","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE"]);var T9=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","ND","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","NT3","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RHF","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","ZTM","NCO","OHX"]);var rUe=function(){let e=Object.create(null),t=[];for(let r=65;r<=90;r++)t[t.length]=String.fromCharCode(r);for(let r=97;r<=122;r++)t[t.length]=String.fromCharCode(r);for(let r=48;r<=57;r++)t[t.length]=String.fromCharCode(r);for(let r of t){e[r]=r.toUpperCase();for(let n of t){e[r+n]=(r+n).toUpperCase();for(let o of t)e[r+n+o]=(r+n+o).toUpperCase()}}return e}();function of(e){return rUe[e]||e.toUpperCase()}var yse=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(e=>[e[0],of(e[1])]));function bse(e){return yse.has(e)?yse.get(e):of("H")}var xse={0:{trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},1:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","CA1","BB","BAS"])},2:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},3:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},4:{trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},5:{trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},6:{trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])}},Ym=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),Pv=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),Cse=new Set(["d-peptide linking","d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","d-gamma-peptide, c-delta linking","d-beta-peptide, c-gamma linking"]),Sse=new Set(["l-peptide linking","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus","l-gamma-peptide, c-delta linking","l-beta-peptide, c-gamma linking"]),nUe=new Set(["d-gamma-peptide, c-delta linking","l-gamma-peptide, c-delta linking"]),oUe=new Set(["d-beta-peptide, c-gamma linking","l-beta-peptide, c-gamma linking"]),iUe=new Set(["d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus"]),vse=new Set(["peptide linking","peptide-like"]),aUe=no.unionMany(Cse,Sse,vse),Ise=new Set(["dna linking","l-dna linking","dna oh 5 prime terminus","dna oh 3 prime terminus"]),Ase=new Set(["rna linking","l-rna linking","rna oh 5 prime terminus","rna oh 3 prime terminus"]),Tse=no.unionMany(new Set(["d-saccharide, beta linking","l-saccharide, beta linking","d-saccharide, alpha linking","l-saccharide, alpha linking","l-saccharide","d-saccharide","saccharide"]),new Set(["d-saccharide 1,4 and 1,4 linking","l-saccharide 1,4 and 1,4 linking","d-saccharide 1,4 and 1,6 linking","l-saccharide 1,4 and 1,6 linking"])),sUe=new Set(["non-polymer","other"]),lUe=new Set(["ion"]),uUe=new Set(["lipid"]),_v=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),iM=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HYP","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),Pse=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),k0=no.unionMany(iM,Pse),_se=new Set(["NME","ACE","NH2","FOR","FMT"]),Rv=new Set(["A","C","T","G","I","U","N"]),Dv=new Set(["DA","DC","DT","DG","DI","DU","DN"]),P9=new Set(["APN","CPN","TPN","GPN"]),cUe=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),mUe=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),L0=no.unionMany(Rv,Dv,P9),Rse=e=>cUe.has(e.toUpperCase()),Dse=e=>mUe.has(e.toUpperCase()),ey=no.unionMany(k0,L0);function Tl(e,t){return t=t.toUpperCase(),P9.has(t)?8:aUe.has(e)?5:Ase.has(e)?6:Ise.has(e)?7:Tse.has(e)?9:_v.has(t)?2:T9.has(t)?3:A9.has(t)?4:sUe.has(e)?zd.has(t)?9:k0.has(t)?5:Rv.has(t)?6:Dv.has(t)?7:1:0}function wse(e,t){return t===5?nUe.has(e)?2:oUe.has(e)?3:iUe.has(e)?0:1:t===6?4:t===7?5:t===8?6:0}function _9(e){return e=e.toUpperCase(),k0.has(e)?"peptide linking":Rv.has(e)?"rna linking":Dv.has(e)?"dna linking":zd.has(e)?"saccharide":"other"}function Ese(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:ey.has(e)?"y":"n",pdbx_synonyms:[],type:_9(e)}}function Mse(e){return e=e.toUpperCase(),_v.has(e)?"water":ey.has(e)?"polymer":zd.has(e)?"branched":"non-polymer"}function Bse(e,t){return e=e.toUpperCase(),Sse.has(t)?"polypeptide(L)":Cse.has(t)?"polypeptide(D)":Ase.has(t)?"polyribonucleotide":Ise.has(t)?"polydeoxyribonucleotide":Tse.has(t)||zd.has(e)?"oligosaccharide":P9.has(e)?"peptide nucleic acid":iM.has(e)?"polypeptide(L)":Pse.has(e)?"polypeptide(D)":Rv.has(e)?"polyribonucleotide":Dv.has(e)?"polydeoxyribonucleotide":lUe.has(t)||T9.has(e)?"ion":uUe.has(t)||A9.has(e)?"lipid":vse.has(t)?"peptide-like":"other"}function tx(e){return Zi(e)||R9(e)}function Zi(e){return e===7||e===6||e===8}function R9(e){return e===5}var Kt;(s=>{s.is=na.has,s.create=na.create;let r;(F=>(F[F.None=0]="None",F[F.DoubleHelix=1]="DoubleHelix",F[F.Helix=2]="Helix",F[F.Beta=4]="Beta",F[F.Bend=8]="Bend",F[F.Turn=16]="Turn",F[F.LeftHanded=32]="LeftHanded",F[F.RightHanded=64]="RightHanded",F[F.ClassicTurn=128]="ClassicTurn",F[F.InverseTurn=256]="InverseTurn",F[F.HelixOther=512]="HelixOther",F[F.Helix27=1024]="Helix27",F[F.Helix3Ten=2048]="Helix3Ten",F[F.HelixAlpha=4096]="HelixAlpha",F[F.HelixGamma=8192]="HelixGamma",F[F.HelixOmega=16384]="HelixOmega",F[F.HelixPi=32768]="HelixPi",F[F.HelixPolyproline=65536]="HelixPolyproline",F[F.DoubleHelixOther=131072]="DoubleHelixOther",F[F.DoubleHelixZ=262144]="DoubleHelixZ",F[F.DoubleHelixA=524288]="DoubleHelixA",F[F.DoubleHelixB=1048576]="DoubleHelixB",F[F.BetaOther=2097152]="BetaOther",F[F.BetaStrand=4194304]="BetaStrand",F[F.BetaSheet=8388608]="BetaSheet",F[F.BetaBarell=16777216]="BetaBarell",F[F.TurnOther=33554432]="TurnOther",F[F.Turn1=67108864]="Turn1",F[F.Turn2=134217728]="Turn2",F[F.Turn3=268435456]="Turn3",F[F.NA=536870912]="NA"))(r=s.Flag||={}),s.SecondaryStructureMmcif={helx_lh_27_p:1058,helx_lh_3t_p:2082,helx_lh_al_p:4130,helx_lh_a_n:524321,helx_lh_b_n:1048609,helx_lh_ga_p:8226,helx_lh_n:33,helx_lh_om_p:16418,helx_lh_ot_n:131105,helx_lh_ot_p:546,helx_lh_p:34,helx_lh_pi_p:32802,helx_lh_pp_p:65570,helx_lh_z_n:262177,helx_n:1,helx_ot_n:1,helx_ot_p:2,helx_p:2,helx_rh_27_p:1090,helx_rh_3t_p:2114,helx_rh_al_p:4162,helx_rh_a_n:524353,helx_rh_b_n:1048641,helx_rh_ga_p:8258,helx_rh_n:65,helx_rh_om_p:16450,helx_rh_ot_n:131137,helx_rh_ot_p:578,helx_rh_p:66,helx_rh_pi_p:32834,helx_rh_pp_p:65602,helx_rh_z_n:262209,strn:4194308,turn_ot_p:33554448,turn_p:16,turn_ty1p_p:67109136,turn_ty1_p:67109008,turn_ty2p_p:134218e3,turn_ty2_p:134217872,turn_ty3p_p:268435728,turn_ty3_p:268435600,bend:8,other:0},s.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},s.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},s.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8}})(Kt||={});var ht;(u=>{u.is=na.has;let t;(g=>(g[g.None=0]="None",g[g.Covalent=1]="Covalent",g[g.MetallicCoordination=2]="MetallicCoordination",g[g.HydrogenBond=4]="HydrogenBond",g[g.Disulfide=8]="Disulfide",g[g.Aromatic=16]="Aromatic",g[g.Computed=32]="Computed"))(t=u.Flag||={});function r(c){return na.create(c)}u.create=r;function n(c){return(c&1)!==0}u.isCovalent=n;function o(c){return c===Math.pow(2,6)-1}u.isAll=o,u.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32};function a(c){return c in u.Names}u.isName=a;function s(c){switch(c){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}u.fromName=s;function l(c){let m=0;for(let d=0,p=c.length;d<p;++d)m|=s(c[d]);return m}u.fromNames=l})(ht||={});var aM={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]};function pUe(e,t,r,n){let o=new ns.EdgeBuilder(n,e,t),i=new Int32Array(o.slotCount),a=new Array(o.slotCount),s=new Array(o.slotCount),l=new Int8Array(o.slotCount),u=new Array(o.slotCount),c=new Array(o.slotCount);for(let m=0,d=o.edgeCount;m<d;m++)o.addNextEdge(),o.assignProperty(i,r.key?r.key[m]:-1),o.assignDirectedProperty(a,r.operatorA?r.operatorA[m]:-1,s,r.operatorB?r.operatorB[m]:-1),o.assignProperty(l,r.order?r.order[m]:1),o.assignProperty(u,r.distance?r.distance[m]:-1),o.assignProperty(c,r.flag?r.flag[m]:ht.Flag.Covalent);return o.createGraph({key:i,operatorA:a,operatorB:s,order:l,distance:u,flag:c})}var Do;(i=>{i.Descriptor={name:"index_pair_bonds"},i.Provider=ll.create(i.Descriptor,{asDynamic:!0}),i.DefaultProps={maxDistance:-1,cacheable:!0};function n(a,s={}){let l={...i.DefaultProps,...s},{pairs:u,count:c}=a,m=u.indexA.toArray(),d=u.indexB.toArray(),p=u.key&&u.key.toArray(),h=u.operatorA&&u.operatorA.toArray(),f=u.operatorB&&u.operatorB.toArray(),y=u.order&&u.order.toArray(),g=u.distance&&u.distance.toArray(),x=u.flag&&u.flag.toArray(),S=!1;if(h&&f){S=!0;for(let A=0,_=h.length;A<_;++A)if(h[A]===-1||f[A]===-1){S=!1;break}}let I=pUe(m,d,{key:p,operatorA:h,operatorB:f,order:y,distance:g,flag:x},c),v=new Map;if(S){let{operatorA:A,operatorB:_}=I.edgeProps;for(let T=0,w=A.length;T<w;++T)if(A[T]===_[T]){let D=A[T];v.has(D)?v.get(D).push(T):v.set(D,[T])}}return{bonds:I,maxDistance:l.maxDistance,cacheable:l.cacheable,hasOperators:S,bySameOperator:v}}i.fromData=n;function o(a,s,l,u,c){let m,d,p,h;s<l?(m=s,d=l,p=u,h=c):(m=l,d=s,p=c,h=u);for(let f=a.offset[m],y=a.offset[m+1];f<y;f++)if(a.b[f]===d&&a.edgeProps.operatorA[f]===p&&a.edgeProps.operatorB[f]===h)return f;return-1}i.getEdgeIndexForOperators=o})(Do||={});function Gt(e){return function(t){return sM(e,t)}}function sM(e,t){let{data:r,indices:n,count:o}=e,{valueType:i}=t,a=i==="str"?s=>r.substring(n[2*s],n[2*s+1]):i==="int"?s=>kd(r,n[2*s],n[2*s+1])||0:s=>mc(r,n[2*s],n[2*s+1])||0;return{schema:t,__array:void 0,isDefined:!0,rowCount:o,value:a,valueKind:s=>H.ValueKinds.Present,toArray:s=>bi.createAndFillArray(o,a,s),areValuesEqual:D9(e)}}function D9(e){let{data:t,indices:r}=e;return function(n,o){let i=r[2*n],a=r[2*o],s=r[2*n+1]-i;if(s!==r[2*o+1]-a)return!1;for(let l=0;l<s;l++)if(t.charCodeAt(l+i)!==t.charCodeAt(l+a))return!1;return!0}}function kse(e){let{count:t,indices:r}=e;for(let n=0;n<t;++n)if(r[2*n]!==r[2*n+1])return!1;return!0}function F0(e,t){return{name:t,blocks:e}}function V0(e,t,r,n=[]){return{categoryNames:e,header:r,categories:t,saveFrames:n,getField(o){let[i,a]=o.split(".");return t[i].getField(a||"")}}}function Lse(e,t,r){return{categoryNames:e,header:r,categories:t}}function qi(e,t,r,n){return{rowCount:t,name:e,fieldNames:[...r],getField(o){return n[o]}}}(n=>{function e(o){return{rowCount:0,name:o,fieldNames:[],getField(i){}}}n.empty=e;function t(o,i){let a=Object.keys(i);return{rowCount:a.length>0?i[a[0]].rowCount:0,name:o,fieldNames:a,getField(s){return i[s]}}}n.ofFields=t;function r(o,i){let a={};for(let s of i._columns)a[s]=It.ofColumn(i[s]);return t(o,a)}n.ofTable=r})(qi||={});var It;(a=>{function e(s){return t([s])}a.ofString=e;function t(s){let l=s.length,u=p=>{let h=s[p];return!h||h==="."||h==="?"?"":h},c=p=>{let h=s[p];return kd(h,0,h.length)||0},m=p=>{let h=s[p];return mc(h,0,h.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:l,str:u,int:c,float:m,valueKind:p=>{let h=s[p],f=h.length;if(f>1)return H.ValueKinds.Present;if(f===0)return H.ValueKinds.NotPresent;let y=h.charCodeAt(0);return y===46?H.ValueKinds.NotPresent:y===63?H.ValueKinds.Unknown:H.ValueKinds.Present},areValuesEqual:(p,h)=>s[p]===s[h],toStringArray:p=>p?bi.createAndFillArray(l,u,p):s,toIntArray:p=>bi.createAndFillArray(l,c,p),toFloatArray:p=>bi.createAndFillArray(l,m,p)}}a.ofStrings=t;function r(s){let l=s.length,u=p=>""+s[p],c=p=>s[p],m=p=>H.ValueKinds.Present,d=p=>!p||p.array&&s instanceof p.array?s:bi.createAndFillArray(l,c,p);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:l,str:u,int:c,float:c,valueKind:m,areValuesEqual:(p,h)=>s[p]===s[h],toStringArray:p=>bi.createAndFillArray(l,u,p),toIntArray:d,toFloatArray:d}}a.ofNumbers=r;function n(s){let{data:l,indices:u,count:c}=s,m=f=>{let y=l.substring(u[2*f],u[2*f+1]);return y==="."||y==="?"?"":y},d=f=>kd(l,u[2*f],u[2*f+1])||0,p=f=>mc(l,u[2*f],u[2*f+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:c,str:m,int:d,float:p,valueKind:f=>{let y=u[2*f],g=u[2*f+1]-y;if(g>1)return H.ValueKinds.Present;if(g===0)return H.ValueKinds.NotPresent;let x=l.charCodeAt(y);return x===46?H.ValueKinds.NotPresent:x===63?H.ValueKinds.Unknown:H.ValueKinds.Present},areValuesEqual:D9(s),toStringArray:f=>bi.createAndFillArray(c,m,f),toIntArray:f=>bi.createAndFillArray(c,d,f),toFloatArray:f=>bi.createAndFillArray(c,p,f)}}a.ofTokens=n;function o(s){let{rowCount:l,valueKind:u,areValuesEqual:c,isDefined:m}=s,d,p,h;switch(s.schema.valueType){case"float":case"int":d=y=>""+s.value(y),p=s.value,h=s.value;break;case"str":d=s.value,p=y=>{let g=s.value(y);return kd(g,0,g.length)||0},h=y=>{let g=s.value(y);return mc(g,0,g.length)||0};break;case"list":let{separator:f}=s.schema;d=y=>s.value(y).join(f),p=y=>NaN,h=y=>NaN;break;default:throw new Error(`unsupported valueType '${s.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:m,rowCount:l,str:d,int:p,float:h,valueKind:u,areValuesEqual:c,toStringArray:f=>bi.createAndFillArray(l,d,f),toIntArray:f=>bi.createAndFillArray(l,p,f),toFloatArray:f=>bi.createAndFillArray(l,h,f)}}a.ofColumn=o;function i(s,l){return o(H.Undefined(s,l))}a.ofUndefined=i})(It||={});function Fse(e,t,r,n){let o=r?0:1;switch(t){case 1:return n==="brackets"?i=>`${e}[${i+o}]`:i=>`${e}_${i+o}`;case 2:return n==="brackets"?(i,a)=>`${e}[${i+o}][${a+o}]`:(i,a)=>`${e}_${i+o}${a+o}`;case 3:return n==="brackets"?(i,a,s)=>`${e}[${i+o}][${a+o}][${s+o}]`:(i,a,s)=>`${e}_${i+o}${a+o}${s+o}`;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}function Vse(e,t,r,n){let o=t.create();if(t.rank===1){let i=t.dimensions[0];for(let a=0;a<i;a++){let s=e.getField(n(a));t.set(o,a,s?s.float(r):0)}}else if(t.rank===2){let i=t.dimensions[0],a=t.dimensions[1];for(let s=0;s<i;s++)for(let l=0;l<a;l++){let u=e.getField(n(s,l));t.set(o,s,l,u?u.float(r):0)}}else if(t.rank===3){let i=t.dimensions[0],a=t.dimensions[1],s=t.dimensions[2];for(let l=0;l<i;l++)for(let u=0;u<a;u++)for(let c=0;c<s;c++){let m=e.getField(n(l,u,c));t.set(o,l,u,c,m?m.float(r):0)}}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return o}var F2;(n=>{function e(o){return o.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}n.canonical=e;function t(o,i){return e(o)===e(i)}n.equal=t;function r(o,i,a=!1){let s=`${o}${i?`.${i}`:""}`;return a?e(s):s}n.create=r})(F2||={});function Gse(e,t,r){let n={};for(let o of t.blocks)n[o.header]=nm(e,o,r);return n}function nm(e,t,r){return bUe(e,t,r)}function uM(e,t){return new lM(t,e,!0)}function fUe(e){switch(e.valueType){case"str":return(t,r,n)=>hUe(e,t,t.str,t.toStringArray);case"int":return(t,r,n)=>Ose(e,t,t.int,t.toIntArray);case"float":return(t,r,n)=>Ose(e,t,t.float,t.toFloatArray);case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function hUe(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:e.transform==="lowercase"?o=>r(o).toLowerCase():e.transform==="uppercase"?o=>r(o).toUpperCase():r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:e.transform==="lowercase"?o=>Array.from(n(o)).map(i=>i.toLowerCase()):e.transform==="uppercase"?o=>Array.from(n(o)).map(i=>i.toUpperCase()):n}}function Ose(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:n}}function gUe(e,t,r){let n=e.separator,o=e.itemParse,i=t.getField(r),a=i?l=>i.str(l).split(n).map(u=>o(u.trim())).filter(u=>!!u):l=>[],s=l=>bi.createAndFillArray(t.rowCount,a,l);return{schema:e,__array:void 0,isDefined:!!i,rowCount:t.rowCount,value:a,valueKind:i?i.valueKind:()=>H.ValueKinds.NotPresent,areValuesEqual:(l,u)=>ki(a(l),a(u)),toArray:s}}function yUe(e,t,r){let n=e.space,o=t.fieldNames.includes(`${r}[0]`)||t.fieldNames.includes(`${r}[0][0]`)||t.fieldNames.includes(`${r}[0][0][0]`),i=o?0:1,a=t.fieldNames.includes(`${r}_1`)||t.fieldNames.includes(`${r}_11`)||t.fieldNames.includes(`${r}_111`)?"underscore":"brackets",s=Fse(r,n.rank,o,a),l=t.getField(s(i,i,i))||H.Undefined(t.rowCount,e),u=m=>Vse(t,n,m,s),c=m=>bi.createAndFillArray(t.rowCount,u,m);return{schema:e,__array:void 0,isDefined:l.isDefined,rowCount:t.rowCount,value:u,valueKind:l.valueKind,areValuesEqual:(m,d)=>xr.areEqualExact(u(m),u(d)),toArray:c}}var lM=class{constructor(t,r,n){this._isDefined=n;let o=Object.keys(r);this._rowCount=t.rowCount,this._columns=o,this._schema=r;let i=Object.create(null);for(let a of o)Object.defineProperty(this,a,{get:function(){if(i[a])return i[a];let s=r[a];if(s.valueType==="list")i[a]=gUe(s,t,a);else if(s.valueType==="tensor")i[a]=yUe(s,t,a);else{let l=fUe(s),u=t.getField(a);i[a]=u?l(u,t,a):H.Undefined(t.rowCount,s)}return i[a]},enumerable:!0,configurable:!1})}};function bUe(e,t,r){let n=Object.create(null);for(let o of Object.keys(e))n[o]=SUe(o,e[o],t,r);return yw.ofTables(t.header,e,n)}function xUe(e){let t=Object.create(null);for(let r of Object.keys(e.categories))for(let n of e.categories[r].fieldNames){let o=F2.create(r,n,!0);t[o]=e.categories[r].getField(n)}return t}function CUe(e,t,r,n){let o=F2.create(t,e),i=F2.canonical(o);if(i in r)return r[i];if(n&&o in n)for(let a of n[o]){let s=F2.canonical(a);if(s in r)return r[s]}}function SUe(e,t,r,n){let o=r.categories[e];if(n){let i=xUe(r),a=Object.create(null),s=[],l=0;for(let u of Object.keys(t)){let c=CUe(u,e,i,n);c&&(a[u]=c,s.push(u),l=c.rowCount)}o={rowCount:l,name:e,fieldNames:[...s],getField(u){return a[u]}}}return new lM(o||qi.empty(e),t,!!o)}function Vi(){return Vi.empty()}(m=>{function e(d,p,h,f){return{origin:d,dirA:p,dirB:h,dirC:f}}m.create=e;function t(){return{origin:b(),dirA:b(),dirB:b(),dirC:b()}}m.empty=t;function r(d,p){return b.copy(d.origin,p.origin),b.copy(d.dirA,p.dirA),b.copy(d.dirB,p.dirB),b.copy(d.dirC,p.dirC),d}m.copy=r;function n(d){return r(t(),d)}m.clone=n;function o(d,p){return b.set(d,b.magnitude(p.dirA)*2,b.magnitude(p.dirB)*2,b.magnitude(p.dirC)*2)}m.size=o;let i=b();function a(d){return o(i,d),i[0]*i[1]*i[2]}m.volume=a;function s(d,p){return b.copy(d.origin,p.origin),b.normalize(d.dirA,p.dirA),b.normalize(d.dirB,p.dirB),b.normalize(d.dirC,p.dirC),d}m.normalize=s;let l=Ot();function u(d,p,h){b.transformMat4(d.origin,p.origin,h);let f=Ot.directionTransform(l,h);return b.transformMat3(d.dirA,p.dirA,f),b.transformMat3(d.dirB,p.dirB,f),b.transformMat3(d.dirC,p.dirC,f),d}m.transform=u;function c(d,p,h){return b.scale(d.dirA,p.dirA,h),b.scale(d.dirB,p.dirB,h),b.scale(d.dirC,p.dirC,h),d}m.scale=c})(Vi||={});var Dn;(m=>{function e(d,p,h=Float32Array){let f=d*p;return{data:new h(f),size:f,cols:d,rows:p}}m.create=e;function t(d,p,h){return d.data[d.rows*h+p]}m.get=t;function r(d,p,h,f){return d.data[d.rows*h+p]=f,d}m.set=r;function n(d,p,h,f){return d.data[d.rows*h+p]+=f,d}m.add=n;function o(d){return d.data.fill(0),d}m.makeZero=o;function i(d){return{data:d.data.slice(),size:d.size,cols:d.cols,rows:d.rows}}m.clone=i;function a(d,p,h){return{data:d,size:p*h,cols:p,rows:h}}m.fromArray=a;function s(d,p){if(d.cols!==p.rows||d.rows!==p.cols)throw new Error("transpose: matrix dimensions incompatible");if(d.data===p.data)throw new Error("transpose: matrices share memory");let h=p.rows,f=p.cols,y=p.data,g=d.data;for(let x=0,S=0,I=0;x<h;I+=1,S+=f,++x){let v=I;for(let A=0;A<f;v+=h,A++)g[v]=y[S+A]}return d}m.transpose=s;function l(d,p,h){let f=p.cols,y=p.rows,g=h.rows,x=p.data,S=h.data,I=d.data;for(let v=0,A=0,_=0;v<y;A+=f,v++)for(let T=0,w=0;w<g;_++,w++){let D=0,M=A;for(let E=0;E<f;M++,T++,E++)D+=x[M]*S[T];I[_]=D}return d}m.multiplyABt=l;function u(d){let p=d.rows,h=d.cols,f=d.data,y=new Array(h);for(let g=0;g<h;++g)y[g]=0;for(let g=0,x=0;g<p;++g)for(let S=0;S<h;++S,++x)y[S]+=f[x];for(let g=0;g<h;++g)y[g]/=p;return y}m.meanRows=u;function c(d,p){let h=d.rows,f=d.cols,y=d.data;for(let g=0,x=0;g<h;++g)for(let S=0;S<f;++S,++x)y[x]-=p[S];return d}m.subRows=c})(Dn||={});function E9(e,t,r,n){n=e[t],e[t]=e[r],e[r]=n}function vUe(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var IUe=1192092896e-16,AUe=1e-37;function TUe(e,t,r,n,o,i,a,s){let l=IUe*2,u=AUe,c=0,m=0,d=0,p=0,h=Math.max(i,30),f=0,y=0,g=0,x=0,S=0,I=0,v=0,A=0,_=0,T=0,w=0,D=0,M=0,E=0,R=0,k=0,B=0,L=4660,V=0,U=0,Q=0,O=new Float64Array(a<<3);for(;c<a;c++){for(d=0,w=0;d<i;d++)A=e[c*t+d],w+=A*A;if(O[c]=w,n){for(d=0;d<a;d++)n[c*o+d]=0;n[c*o+c]=1}}for(;p<h;p++){for(S=0,c=0;c<a-1;c++)for(m=c+1;m<a;m++){for(f=c*t|0,y=m*t|0,R=O[c],k=0,B=O[m],d=2,k+=e[f]*e[y],k+=e[f+1]*e[y+1];d<i;d++)k+=e[f+d]*e[y+d];if(!(Math.abs(k)<=l*Math.sqrt(R*B))){for(k*=2,D=R-B,M=vUe(k,D),D<0?(E=(M-D)*.5,v=Math.sqrt(E/M),I=k/(M*v*2)):(I=Math.sqrt((M+D)/(M*2)),v=k/(M*I*2)),R=0,B=0,d=2,_=I*e[f]+v*e[y],T=-v*e[f]+I*e[y],e[f]=_,e[y]=T,R+=_*_,B+=T*T,_=I*e[f+1]+v*e[y+1],T=-v*e[f+1]+I*e[y+1],e[f+1]=_,e[y+1]=T,R+=_*_,B+=T*T;d<i;d++)_=I*e[f+d]+v*e[y+d],T=-v*e[f+d]+I*e[y+d],e[f+d]=_,e[y+d]=T,R+=_*_,B+=T*T;if(O[c]=R,O[m]=B,S=1,n)for(g=c*o|0,x=m*o|0,d=2,_=I*n[g]+v*n[x],T=-v*n[g]+I*n[x],n[g]=_,n[x]=T,_=I*n[g+1]+v*n[x+1],T=-v*n[g+1]+I*n[x+1],n[g+1]=_,n[x+1]=T;d<a;d++)_=I*n[g+d]+v*n[x+d],T=-v*n[g+d]+I*n[x+d],n[g+d]=_,n[x+d]=T}}if(S===0)break}for(c=0;c<a;c++){for(d=0,w=0;d<i;d++)A=e[c*t+d],w+=A*A;O[c]=Math.sqrt(w)}for(c=0;c<a-1;c++){for(m=c,d=c+1;d<a;d++)O[m]<O[d]&&(m=d);if(c!==m&&(E9(O,c,m,w),n)){for(d=0;d<i;d++)E9(e,c*t+d,m*t+d,A);for(d=0;d<a;d++)E9(n,c*o+d,m*o+d,A)}}for(c=0;c<a;c++)r[c]=O[c];if(n)for(c=0;c<s;c++){for(w=c<a?O[c]:0;w<=u;){for(U=1/i,d=0;d<i;d++)L=L*214013+2531011,V=(L>>16&32767&256)!==0?U:-U,e[c*t+d]=V;for(p=0;p<2;p++)for(m=0;m<c;m++){for(w=0,d=0;d<i;d++)w+=e[c*t+d]*e[m*t+d];for(Q=0,d=0;d<i;d++)A=e[c*t+d]-w*e[m*t+d],e[c*t+d]=A,Q+=Math.abs(A);for(Q=Q?1/Q:0,d=0;d<i;d++)e[c*t+d]*=Q}for(w=0,d=0;d<i;d++)A=e[c*t+d],w+=A*A;w=Math.sqrt(w)}for(v=1/w,d=0;d<i;d++)e[c*t+d]*=v}}function Use(e,t,r,n){let o=0,i=0,a=e.rows,s=e.cols,l=a,u=s;l<u&&(o=1,i=l,l=u,u=i);let c=Dn.create(l,l),m=Dn.create(1,u),d=Dn.create(u,u);if(o===0)Dn.transpose(c,e);else{for(i=0;i<s*a;i++)c.data[i]=e.data[i];for(;i<u*l;i++)c.data[i]=0}if(TUe(c.data,l,m.data,d.data,u,l,u,l),t){for(i=0;i<u;i++)t.data[i]=m.data[i];for(;i<s;i++)t.data[i]=0}o===0?(r&&Dn.transpose(r,c),n&&Dn.transpose(n,d)):(r&&Dn.transpose(r,d),n&&Dn.transpose(n,c))}var lu;(i=>{function e(a){let s=t(a),l=o(a,s);return{momentsAxes:s,boxAxes:l}}i.ofPositions=e;function t(a){if(a.length===3)return Vi.create(b.fromArray(b(),a,0),b.create(1,0,0),b.create(0,1,0),b.create(0,0,1));let s=Dn.fromArray(a,3,a.length/3),l=s.rows,u=l/3,c=Dn.create(3,3),m=Dn.create(1,3),d=Dn.create(3,3),p=Dn.create(3,3),h=Dn.meanRows(s),f=Dn.subRows(Dn.clone(s),h),y=Dn.transpose(Dn.create(l,3),f);Dn.multiplyABt(c,y,y),Use(c,m,d,p);let g=b.create(h[0],h[1],h[2]),x=b.create(d.data[0],d.data[3],d.data[6]),S=b.create(d.data[1],d.data[4],d.data[7]),I=b.create(d.data[2],d.data[5],d.data[8]);return b.scale(x,x,Math.sqrt(m.data[0]/u)),b.scale(S,S,Math.sqrt(m.data[1]/u)),b.scale(I,I,Math.sqrt(m.data[2]/u)),Vi.create(g,x,S,I)}i.calculateMomentsAxes=t;function r(a){let s=Vi.clone(a);return b.magnitude(s.dirC)<1e-6&&b.cross(s.dirC,s.dirA,s.dirB),Vi.normalize(s,s)}i.calculateNormalizedAxes=r;let n=b();function o(a,s){if(a.length===3)return Vi.clone(s);let l=-1/0,u=-1/0,c=-1/0,m=-1/0,d=-1/0,p=-1/0,h=b(),f=b(),y=s.origin,g=r(s);for(let D=0,M=a.length;D<M;D+=3){b.projectPointOnVector(h,b.fromArray(h,a,D),g.dirA,y);let E=b.dot(g.dirA,b.normalize(f,b.sub(f,h,y))),R=b.distance(h,y);E>0?R>l&&(l=R):R>u&&(u=R),b.projectPointOnVector(h,b.fromArray(h,a,D),g.dirB,y);let k=b.dot(g.dirB,b.normalize(f,b.sub(f,h,y))),B=b.distance(h,y);k>0?B>c&&(c=B):B>m&&(m=B),b.projectPointOnVector(h,b.fromArray(h,a,D),g.dirC,y);let L=b.dot(g.dirC,b.normalize(f,b.sub(f,h,y))),V=b.distance(h,y);L>0?V>d&&(d=V):V>p&&(p=V)}let x=b.setMagnitude(b(),g.dirA,(l+u)/2),S=b.setMagnitude(b(),g.dirB,(c+m)/2),I=b.setMagnitude(b(),g.dirC,(d+p)/2),v=b.isFinite(x),A=b.isFinite(S),_=b.isFinite(I),T=b(),w=function(D,M,E){b.copy(n,y),v&&b.scaleAndAdd(n,n,g.dirA,D),A&&b.scaleAndAdd(n,n,g.dirB,M),_&&b.scaleAndAdd(n,n,g.dirC,E),b.add(T,T,n)};return w(l,c,d),w(l,c,-p),w(l,-m,-p),w(l,-m,d),w(-u,-m,-p),w(-u,-m,d),w(-u,c,d),w(-u,c,-p),b.scale(T,T,1/8),Vi.create(T,x,S,I)}i.calculateBoxAxes=o})(lu||={});function ye(){return ye.zero()}(M=>{function e(E){return E.extrema!==void 0}M.hasExtrema=e;function t(E,R){return{center:E,radius:R}}M.create=t;function r(){return{center:b(),radius:0}}M.zero=r;function n(E){let R=t(b.clone(E.center),E.radius);return e(E)&&(R.extrema=E.extrema.map(k=>b.clone(k))),R}M.clone=n;function o(E,R,k){return b.copy(E.center,R),E.radius=k,E}M.set=o;function i(E,R){return b.copy(E.center,R.center),E.radius=R.radius,e(R)&&a(E,R.extrema.map(k=>b.clone(k))),E}M.copy=i;function a(E,R){return E.extrema!==void 0?(E.extrema.length=0,E.extrema.push(...R)):E.extrema=R,E}M.setExtrema=a;function s(E){let{x:R,y:k,z:B,indices:L}=E,V=0,U=0,Q=0,O=0,q=Se.size(L);for(let X=0;X<q;X++){let F=Se.getAt(L,X);V+=R[F],U+=k[F],Q+=B[F]}q>0&&(V/=q,U/=q,Q/=q);for(let X=0;X<q;X++){let F=Se.getAt(L,X),Y=R[F]-V,$=k[F]-U,ce=B[F]-Q,ie=Y*Y+$*$+ce*ce;ie>O&&(O=ie)}return{center:b.create(V,U,Q),radius:Math.sqrt(O)}}M.computeBounding=s;function l(E,R,k){return b.transformMat4(E.center,R.center,k),E.radius=R.radius*Z.getMaxScaleOnAxis(k),e(R)&&a(E,R.extrema.map(B=>b.transformMat4(b(),B,k))),E}M.transform=l;function u(E,R,k){return b.add(E.center,R.center,k),e(R)&&a(E,R.extrema.map(B=>b.add(b(),B,k))),E}M.translate=u;function c(E,R,k){return b.toArray(E.center,R,k),R[k+3]=E.radius,R}M.toArray=c;function m(E,R,k){return b.fromArray(E.center,R,k),E.radius=R[k+3],E}M.fromArray=m;function d(E,R){return b.scale(E.center,b.add(E.center,R.max,R.min),.5),E.radius=b.distance(E.center,R.max),M.setExtrema(E,[b.create(R.min[0],R.min[1],R.min[2]),b.create(R.max[0],R.max[1],R.max[2]),b.create(R.max[0],R.min[1],R.min[2]),b.create(R.min[0],R.max[1],R.max[2]),b.create(R.min[0],R.min[1],R.max[2]),b.create(R.max[0],R.min[1],R.max[2]),b.create(R.max[0],R.max[1],R.min[2]),b.create(R.min[0],R.max[1],R.min[2])]),E}M.fromBox3D=d;function p(E,R){return b.copy(E.center,R.origin),E.radius=Math.max(b.magnitude(R.dirA),b.magnitude(R.dirB),b.magnitude(R.dirC)),E}M.fromAxes3D=p;let h=b();function f(E,R,k){let[B,L,V]=R,U=b.create(0,0,0);b.transformMat4(U,U,k);let Q=b.create(B,L,V);b.transformMat4(Q,Q,k);let O=b.create(B,0,0);b.transformMat4(O,O,k);let q=b.create(0,L,V);b.transformMat4(q,q,k);let X=b.create(0,0,V);b.transformMat4(X,X,k);let F=b.create(B,0,V);b.transformMat4(F,F,k);let Y=b.create(B,L,0);b.transformMat4(Y,Y,k);let $=b.create(0,L,0);b.transformMat4($,$,k),b.add(h,U,Q),b.scale(h,h,.5);let ce=Math.max(b.distance(U,Q),b.distance(O,q));return M.set(E,h,ce/2),M.setExtrema(E,[U,Q,O,q,X,F,Y,$]),E}M.fromDimensionsAndTransform=f;let y=b();function g(E,R,k){return b.distance(R.center,k)<R.radius?M.copy(E,R):(b.sub(y,R.center,k),b.sub(y,R.center,y),b.setMagnitude(y,y,R.radius),b.scale(E.center,b.add(y,y,k),.5),E.radius=b.distance(E.center,k),E)}M.addVec3=g;function x(E,R,k){return b.copy(E.center,R.center),E.radius=Math.max(R.radius,b.distance(R.center,k.center)+k.radius),e(R)&&e(k)&&a(E,[...R.extrema.map(B=>b.clone(B)),...k.extrema.map(B=>b.clone(B))]),E}M.expandBySphere=x;let S=b();function I(E,R,k){if(b.copy(E.center,R.center),E.radius=R.radius+k,R.radius<1e-12||(R.extrema?.length??0)<=1)return E.extrema=void 0,E;if(e(R)){let B=new Float32Array(R.extrema.length*3);for(let V=0;V<R.extrema.length;V++)b.toArray(R.extrema[V],B,V*3);let L=lu.calculateMomentsAxes(B);Vi.scale(L,Vi.normalize(L,L),k),a(E,R.extrema.map(V=>{b.normalize(S,b.sub(S,V,R.center));let U=b.clone(V),Q=b.dot(S,L.dirA)<0?-1:1;b.scaleAndAdd(U,U,L.dirA,Q);let O=b.dot(S,L.dirB)<0?-1:1;b.scaleAndAdd(U,U,L.dirB,O);let q=b.dot(S,L.dirC)<0?-1:1;return b.scaleAndAdd(U,U,L.dirC,q),b.distance(E.center,U)>E.radius&&(R.extrema.length>=14&&b.normalize(S,b.sub(S,U,R.center)),b.scaleAndAdd(U,E.center,S,E.radius)),U}))}return E}M.expand=I;function v(E,R){return E.radius===R.radius&&b.exactEquals(E.center,R.center)}M.exactEquals=v;function A(E,R){let k=E.radius,B=R.radius;return Math.abs(k-B)<=1e-6*Math.max(1,Math.abs(k),Math.abs(B))&&b.equals(E.center,R.center)}M.equals=A;function _(E,R){if(e(R)){for(let k of R.extrema)if(b.distance(E.center,k)>E.radius)return!1;return!0}else return b.distance(E.center,R.center)+R.radius<=E.radius}M.includes=_;function T(E,R){return b.distance(E.center,R.center)<=E.radius+R.radius}M.overlaps=T;function w(E,R){return b.distance(E.center,R.center)-E.radius+R.radius}M.distance=w;function D(E,R){let{center:k,radius:B}=E;return b.distance(R,k)-B}M.distanceToVec=D})(ye||={});function ut(){return ut.zero()}(k=>{function e(B,L){return{min:B,max:L}}k.create=e;function t(){return{min:b(),max:b()}}k.zero=t;function r(B,L){return b.copy(B.min,L.min),b.copy(B.max,L.max),B}k.copy=r;function n(B,L,V){return b.copy(B.min,L),b.copy(B.max,V),B}k.set=n;function o(B){return r(t(),B)}k.clone=o;let i=b();function a(B,L){return ye.hasExtrema(L)&&L.extrema.length>=14?l(B,L.extrema):(b.set(i,L.radius,L.radius,L.radius),b.sub(B.min,L.center,i),b.add(B.max,L.center,i),B)}k.fromSphere3D=a;function s(B,L){for(let V=0,U=L.length;V<U;V++)g(B,L[V]);return B}k.addVec3Array=s;function l(B,L){return y(B),s(B,L),B}k.fromVec3Array=l;function u(B,L){return ye.hasExtrema(L)&&L.extrema.length>=14?s(B,L.extrema):(g(B,b.subScalar(i,L.center,L.radius)),g(B,b.addScalar(i,L.center,L.radius)),B)}k.addSphere3D=u;function c(B,L){return g(B,L.min),g(B,L.max),B}k.addBox3D=c;function m(B,L){return b.clamp(i,L.center,B.min,B.max),b.squaredDistance(i,L.center)<=L.radius*L.radius}k.intersectsSphere3D=m;function d(B){let L=b.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),V=b.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),{x:U,y:Q,z:O,indices:q}=B;for(let X=0,F=Se.size(q);X<F;X++){let Y=Se.getAt(q,X);L[0]=Math.min(U[Y],L[0]),L[1]=Math.min(Q[Y],L[1]),L[2]=Math.min(O[Y],L[2]),V[0]=Math.max(U[Y],V[0]),V[1]=Math.max(Q[Y],V[1]),V[2]=Math.max(O[Y],V[2])}return{min:L,max:V}}k.computeBounding=d;function p(B,L){return b.sub(B,L.max,L.min)}k.size=p;let h=b();function f(B){return p(h,B),h[0]*h[1]*h[2]}k.volume=f;function y(B){return b.set(B.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b.set(B.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),B}k.setEmpty=y;function g(B,L){return b.min(B.min,B.min,L),b.max(B.max,B.max,L),B}k.add=g;function x(B,L,V){return b.sub(B.min,L.min,V),b.add(B.max,L.max,V),B}k.expand=x;function S(B,L,V){return b.subScalar(B.min,L.min,V),b.addScalar(B.max,L.max,V),B}k.expandUniformly=S;function I(B,L,V){return b.scale(B.min,L.min,V),b.scale(B.max,L.max,V),B}k.scale=I;let v=b();function A(B,L,V){let[U,Q,O]=L.min,[q,X,F]=L.max;return y(B),g(B,b.transformMat4(v,b.set(v,U,Q,O),V)),g(B,b.transformMat4(v,b.set(v,U,Q,F),V)),g(B,b.transformMat4(v,b.set(v,U,X,O),V)),g(B,b.transformMat4(v,b.set(v,U,X,F),V)),g(B,b.transformMat4(v,b.set(v,q,Q,O),V)),g(B,b.transformMat4(v,b.set(v,q,Q,F),V)),g(B,b.transformMat4(v,b.set(v,q,X,O),V)),g(B,b.transformMat4(v,b.set(v,q,X,F),V)),B}k.transform=A;function _(B,L){return!(L[0]<B.min[0]||L[0]>B.max[0]||L[1]<B.min[1]||L[1]>B.max[1]||L[2]<B.min[2]||L[2]>B.max[2])}k.containsVec3=_;function T(B,L){return!(B.max[0]<L.min[0]||B.min[0]>L.max[0]||B.max[1]<L.min[1]||B.min[1]>L.max[1]||B.max[2]<L.min[2]||B.min[2]>L.max[2])}k.overlaps=T;function w(B,L){let V=L.center,U=L.radius;return!(V[0]-U<B.min[0]||V[0]+U>B.max[0]||V[1]-U<B.min[1]||V[1]+U>B.max[1]||V[2]-U<B.min[2]||V[2]+U>B.max[2])}k.containsSphere3D=w;function D(B,L,V){let{origin:U,direction:Q}=V,[O,q,X]=L.min,[F,Y,$]=L.max,[ce,ie,oe]=U,W=1/Q[0],N=1/Q[1],j=1/Q[2],ue,be,ee,le,Ae,Ce;return W>=0?(ue=(O-ce)*W,be=(F-ce)*W):(ue=(F-ce)*W,be=(O-ce)*W),N>=0?(ee=(q-ie)*N,le=(Y-ie)*N):(ee=(Y-ie)*N,le=(q-ie)*N),j>=0?(Ae=(X-oe)*j,Ce=($-oe)*j):(Ae=($-oe)*j,Ce=(X-oe)*j),ee>ue&&(ue=ee),le<be&&(be=le),Ae>ue&&(ue=Ae),Ce<be&&(be=Ce),b.scale(B,Q,ue),b.set(B,B[0]+ce,B[1]+ie,B[2]+oe)}k.nearestIntersectionWithRay3D=D;function M(B,L){return b.center(B,L.max,L.min)}k.center=M;function E(B,L){return b.exactEquals(B.min,L.min)&&b.exactEquals(B.max,L.max)}k.exactEquals=E;function R(B,L){return b.equals(B.min,L.min)&&b.equals(B.max,L.max)}k.equals=R})(ut||={});function rx(e,t,r){let n=new Float32Array(e);for(let o=0;o<n.length;o++)n[o]=t+r*o;return n}var jn;(A=>{A.DefaultName="1_555",A.Default=n(A.DefaultName,Z.identity()),A.RotationTranslationEpsilon=.005;function n(_,T,w){let{assembly:D,ncsId:M,hkl:E,spgrOp:R,key:k}=w||{},B=E?b.clone(E):b();R=R??-1,k=k??-1,M=M||-1;let L=Z.isIdentity(T),V=s(w,L),U=w?.instanceId??_;return L?{name:_,instanceId:U,assembly:D,matrix:T,inverse:Z.identity(),isIdentity:!0,hkl:B,spgrOp:R,ncsId:M,suffix:V,key:k}:(Z.isRotationAndTranslation(T,A.RotationTranslationEpsilon)||console.warn(`Symmetry operator (${_}) should be a composition of rotation and translation.`),{name:_,instanceId:U,assembly:D,matrix:T,inverse:Z.invert(Z(),T),isIdentity:!1,hkl:B,spgrOp:R,key:k,ncsId:M,suffix:V})}A.create=n;function o(_){return!!_&&!!_.matrix&&!!_.inverse&&typeof _.name=="string"}function i(_,T,w,D){let M=E=>E>=0&&E<=9?`${E}`:`(${E})`;return`${_+1}_${M(T+5)}${M(w+5)}${M(D+5)}`}A.getSymmetryOperatorName=i;function a(_){return"ASM-"+_.join("-")}A.getAssemblyOperatorName=a;function s(_,T){if(!_)return"";if(_.assembly)return o(_)?_.suffix:T?"":`_${_.assembly.operId}`;if(typeof _.spgrOp<"u"&&typeof _.hkl<"u"&&_.spgrOp!==-1){let[w,D,M]=_.hkl;return`-${i(_.spgrOp,w,D,M)}`}return _.ncsId!==-1?`_${_.ncsId}`:""}let l=Z();function u(_,T){Z.setIdentity(l);for(let w=0;w<3;w++)for(let D=0;D<3;D++)Z.setValue(l,w,D,Ot.getValue(_,w,D));return Z.setTranslation(l,T),Z.isRotationAndTranslation(l,A.RotationTranslationEpsilon)}A.checkIfRotationAndTranslation=u;function c(_,T,w,D){let M=Z.identity();for(let E=0;E<3;E++)for(let R=0;R<3;R++)Z.setValue(M,E,R,Ot.getValue(T,E,R));return Z.setTranslation(M,w),n(_,M,{ncsId:D})}A.ofRotationAndOffset=c;let m=Tr.identity(),d=Tr(),p=Tr(),h=b();function f(_,T,w){let D=T.inverse;if(T.isIdentity)return Z.copy(_,D);let M=1-w;Z.getRotation(d,D),Tr.slerp(d,m,d,M);let E=Tr.getAxisAngle(h,d);return Z.fromRotation(_,E,h),Z.setValue(_,0,3,M*Z.getValue(D,0,3)),Z.setValue(_,1,3,M*Z.getValue(D,1,3)),Z.setValue(_,2,3,M*Z.getValue(D,2,3)),_}A.lerpFromIdentity=f;function y(_,T,w,D){if(Math.abs(D)<=1e-5)return Z.copy(_,T);if(Math.abs(D-1)<=1e-5)return Z.copy(_,w);Z.getRotation(d,T),Z.getRotation(p,w),Tr.slerp(p,d,p,D);let M=Tr.getAxisAngle(h,p);return Z.fromRotation(_,M,h),Z.setValue(_,0,3,$n(Z.getValue(T,0,3),Z.getValue(w,0,3),D)),Z.setValue(_,1,3,$n(Z.getValue(T,1,3),Z.getValue(w,1,3),D)),Z.setValue(_,2,3,$n(Z.getValue(T,2,3),Z.getValue(w,2,3),D)),_}A.slerp=y;function g(_,T){let w=Z.mul(Z(),T.matrix,_.matrix);return n(T.name,w,T)}A.compose=g;class x{constructor(T,w,D=cM){this.operator=T;this.coordinates=w;this.r=D;this._x=w.x,this._y=w.y,this._z=w.z,this._m=T.matrix}invariantPosition(T,w){return w[0]=this._x[T],w[1]=this._y[T],w[2]=this._z[T],w}position(T,w){return w[0]=this._x[T],w[1]=this._y[T],w[2]=this._z[T],b.transformMat4(w,w,this._m),w}x(T){let w=this._m,D=w[0],M=w[4],E=w[8],R=w[12],k=this._x[T],B=this._y[T],L=this._z[T],V=w[3]*k+w[7]*B+w[11]*L+w[15]||1;return(D*k+M*B+E*L+R)/V}y(T){let w=this._m,D=w[1],M=w[5],E=w[9],R=w[13],k=this._x[T],B=this._y[T],L=this._z[T],V=w[3]*k+w[7]*B+w[11]*L+w[15]||1;return(D*k+M*B+E*L+R)/V}z(T){let w=this._m,D=w[2],M=w[6],E=w[10],R=w[14],k=this._x[T],B=this._y[T],L=this._z[T],V=w[3]*k+w[7]*B+w[11]*L+w[15]||1;return(D*k+M*B+E*L+R)/V}}class S{constructor(T,w,D=cM){this.operator=T;this.coordinates=w;this.r=D;this._x=w.x,this._y=w.y,this._z=w.z,this._m=T.matrix}invariantPosition(T,w){return w[0]=this._x[T],w[1]=this._y[T],w[2]=this._z[T],w}position(T,w){return w[0]=this.x(T),w[1]=this.y(T),w[2]=this.z(T),w}x(T){let w=this._m;return w[0]*this._x[T]+w[4]*this._y[T]+w[8]*this._z[T]+w[12]}y(T){let w=this._m;return w[1]*this._x[T]+w[5]*this._y[T]+w[9]*this._z[T]+w[13]}z(T){let w=this._m;return w[2]*this._x[T]+w[6]*this._y[T]+w[10]*this._z[T]+w[14]}}class I{constructor(T,w,D=cM){this.operator=T;this.coordinates=w;this.r=D;this._x=w.x,this._y=w.y,this._z=w.z}invariantPosition(T,w){return w[0]=this._x[T],w[1]=this._y[T],w[2]=this._z[T],w}position(T,w){return w[0]=this._x[T],w[1]=this._y[T],w[2]=this._z[T],w}x(T){return this._x[T]}y(T){return this._y[T]}z(T){return this._z[T]}}function v(_,T,w=cM){return Z.isIdentity(_.matrix)?new I(_,T,w):PUe(_.matrix)?new S(_,T,w):new x(_,T,w)}A.createMapping=v})(jn||={});function cM(e){return 0}function PUe(e){return e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1}var mM=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,.3333333333333333],[0,0,1,.6666666666666666],[1,0,0,.6666666666666666],[0,1,0,.3333333333333333],[0,-1,0,.6666666666666666],[1,-1,0,.3333333333333333],[-1,1,0,.6666666666666666],[-1,0,0,.3333333333333333],[1,0,0,.3333333333333333],[0,1,0,.6666666666666666],[0,-1,0,.3333333333333333],[1,-1,0,.6666666666666666],[-1,1,0,.3333333333333333],[-1,0,0,.6666666666666666],[0,0,-1,.3333333333333333],[0,0,-1,.6666666666666666],[0,0,1,.8333333333333334],[0,0,1,.16666666666666666],[0,0,-1,.8333333333333334],[0,0,-1,.16666666666666666]],Nse=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],zse=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],V2={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function _Ue(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}let t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}function RUe(e){if(e<146)return e+1;if(e===146)return 1146;if(e<149)return e+1-1;if(e===149)return 1148;if(e<157)return e+1-2;if(e===157)return 1155;if(e<163)return e+1-3;if(e===163)return 1160;if(e<165)return e+1-4;if(e===165)return 1161;if(e<171)return e+1-5;if(e===171)return 1166;if(e<173)return e+1-6;if(e===173)return 1167;if(e<237)return e+1-7;if(e===237)return 1003;if(e===238)return 1004;if(e===239)return 1005;if(e===240)return 2005;if(e===241)return 3005;if(e===242)return 4005;if(e===243)return 5005;if(e===244)return 1006;if(e===245)return 1007;if(e===246)return 1008;if(e===247)return 1009;if(e===248)return 1010;if(e===249)return 1011;if(e===250)return 1012;if(e===251)return 1013;if(e===252)return 1014;if(e===253)return 2014;if(e===254)return 3014;if(e===255)return 1015;if(e===256)return 1017;if(e===257)return 2017;if(e===258)return 1018;if(e===259)return 2018;if(e===260)return 3018;if(e===261)return 1020;if(e===262)return 1021;if(e===263)return 1022;if(e===264)return 1023;if(e===265)return 1059;if(e===266)return 1094;if(e===267)return 1197;throw new Error(`unknown spacegroup index '${e}'`)}var M9=function(){let e=Object.create(null);for(let t of Object.keys(V2))e[V2[t]]=t;return e}(),Hse=function(){let e=Object.create(null);for(let t of Object.keys(V2)){let r=V2[t];e[r]=RUe(r)}return e}();function jse(e){let t=typeof e=="number"?_Ue(e):V2[e];return typeof t>"u"||typeof M9[t]>"u"?-1:t}var Yi;(n=>{n.Zero=r("P 1",b.create(1,1,1),b.create(Math.PI/2,Math.PI/2,Math.PI/2));function t(o){return o?o.index===0&&o.size[0]===1&&o.size[1]===1&&o.size[1]===1:!0}n.isZero=t;function r(o,i,a){let s=jse(o);if(s<0)return console.warn(`Unknown spacegroup '${o}', returning a 'P 1' with cellsize [1, 1, 1]`),n.Zero;let l=i[0]*i[1]*i[2],u=a[0],c=a[1],m=a[2],d=i[0],p=i[1],h=i[2],f=Math.cos(c),y=(Math.cos(u)-Math.cos(c)*Math.cos(m))/Math.sin(m),g=Math.sqrt(1-f*f-y*y),x=[d,0,0],S=[Math.cos(m)*p,Math.sin(m)*p,0],I=[f*h,y*h,g*h],v=Z.ofRows([[x[0],S[0],I[0],0],[0,S[1],I[1],0],[0,0,I[2],0],[0,0,0,1]]),A=Z.invert(Z.zero(),v);return{index:s,size:i,volume:l,anglesInRadians:a,toFractional:A,fromFractional:v}}n.create=r})(Yi||={});var Ns;(y=>{y.ZeroP1=t(Yi.Zero);function t(g){let x=zse[g.index].map(v=>m(Nse[v])),S=M9[g.index],I=Hse[g.index];return{name:S,num:I,cell:g,operators:x}}y.create=t;let r=b(),n=Z();function o(g,x,S,I,v,A){return b.set(r,S,I,v),Z.fromTranslation(n,r),Z.mul(A,Z.mul(A,Z.mul(A,g.cell.fromFractional,n),g.operators[x]),g.cell.toFractional)}y.setOperatorMatrix=o;function i(g,x,S,I,v){let A=o(g,x,S,I,v,Z.zero());return jn.create(jn.getSymmetryOperatorName(x,S,I,v),A,{hkl:b.create(S,I,v),spgrOp:x})}y.getSymmetryOperator=i;let a=b(),s=b(),l=b(),u=b();function c(g,x,S,I,v,A){let _=Z.zero();b.set(r,S,I,v),b.floor(a,A),Z.copy(_,g.operators[x]),b.floor(s,b.transformMat4(s,A,_)),Z.getTranslation(u,_),b.sub(u,u,s),b.add(u,u,a),b.add(u,u,r),Z.setTranslation(_,u),Z.mul(_,g.cell.fromFractional,_),Z.mul(_,_,g.cell.toFractional),b.sub(l,s,a);let T=S-l[0],w=I-l[1],D=v-l[2];return jn.create(jn.getSymmetryOperatorName(x,T,w,D),_,{hkl:b.create(T,w,D),spgrOp:x})}y.getSymmetryOperatorRef=c;function m(g){let x=mM[g[0]],S=mM[g[1]],I=mM[g[2]];return Z.ofRows([x,S,I,[0,0,0,1]])}function d(g){return[f(p(g[0],g[4],g[8]),h(g[12])),f(p(g[1],g[5],g[9]),h(g[13])),f(p(g[2],g[6],g[10]),h(g[14]))].join(",")}y.getOperatorXyz=d;function p(g,x,S){let I=[];if(g>0?I.push("+X"):g<0&&I.push("-X"),x>0?I.push("+Y"):x<0&&I.push("-Y"),S>0?I.push("+Z"):S<0&&I.push("-Z"),I.length===1)return I[0].charAt(0)==="+"?I[0].substr(1):I[0];if(I.length===2){let v=I[0].charAt(0),A=I[1].charAt(0);if(v==="+")return`${I[0].substr(1)}${I[1]}`;if(A==="+")return`${I[1].substr(1)}${I[0]}`}throw new Error(`unknown rotation '${I}', ${g} ${x} ${S}`)}function h(g){switch(g){case 1/2:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function f(g,x){return x===""?g:g.length>2?`${g}+${x}`:g.charAt(0)==="-"?`${x}${g}`:`${x}+${g}`}})(Ns||={});var Gu;(o=>{function e(i,a,s){i.squaredDistances[i.count]=s,i.indices[i.count++]=a}o.add=e;function t(i){i.count=0}o.reset=t;function r(){return{count:0,indices:[],squaredDistances:[]}}o.create=r;function n(i,a){for(let s=0;s<a.count;++s)i.indices[s]=a.indices[s],i.squaredDistances[s]=a.squaredDistances[s];return i.count=a.count,i}o.copy=n})(Gu||={});var k9=class{constructor(t,r){this.parent=null;this.child=null;this.degree=0;this.isMarked=!1;this.key=t,this.value=r,this.prev=this,this.next=this}},L9=class{constructor(t){if(this._index=-1,this._items=[],this._len=0,t){let r=t,n=0;do this._items[n++]=r,r=r.next;while(t!==r);this._len=n}}hasNext(){return this._index<this._len-1}next(){return this._items[++this._index]}reset(t){this._index=-1,this._len=0;let r=t,n=0;do this._items[n++]=r,r=r.next;while(t!==r);this._len=n}},B9=new L9,wv=class{constructor(t){this._minNode=null;this._nodeCount=0;this._compare=t||this._defaultCompare}clear(){this._minNode=null,this._nodeCount=0}decreaseKey(t,r){if(!t)throw new Error("Cannot decrease key of non-existent node");if(this._compare({key:r},{key:t.key})>0)throw new Error("New key is larger than old key");t.key=r;let n=t.parent;n&&this._compare(t,n)<0&&(this._cut(t,n,this._minNode),this._cascadingCut(n,this._minNode)),this._compare(t,this._minNode)<0&&(this._minNode=t)}delete(t){let r=t.parent;r&&(this._cut(t,r,this._minNode),this._cascadingCut(r,this._minNode)),this._minNode=t,this.extractMinimum()}extractMinimum(){let t=this._minNode;if(t){if(t.child){let n=t.child;do n.parent=null,n=n.next;while(n!==t.child)}let r=null;t.next!==t&&(r=t.next),this._removeNodeFromList(t),this._nodeCount--,this._minNode=this._mergeLists(r,t.child),this._minNode&&(this._minNode=this._consolidate(this._minNode))}return t}findMinimum(){return this._minNode}insert(t,r){let n=new k9(t,r);return this._minNode=this._mergeLists(this._minNode,n),this._nodeCount++,n}isEmpty(){return this._minNode===null}size(){return this._minNode===null?0:this._getNodeListSize(this._minNode)}union(t){this._minNode=this._mergeLists(this._minNode,t._minNode),this._nodeCount+=t._nodeCount}_defaultCompare(t,r){return t.key>r.key?1:t.key<r.key?-1:0}_cut(t,r,n){t.parent=null,r.degree--,t.next===t?r.child=null:r.child=t.next,this._removeNodeFromList(t);let o=this._mergeLists(n,t);return t.isMarked=!1,o}_cascadingCut(t,r){let n=t.parent;return n&&(t.isMarked?(r=this._cut(t,n,r),r=this._cascadingCut(n,r)):t.isMarked=!0),r}_consolidate(t){let r=[];for(B9.reset(t);B9.hasNext();){let o=B9.next(),i=r[o.degree];for(;i;){if(this._compare(o,i)>0){let a=o;o=i,i=a}this._linkHeaps(i,o),r[o.degree]=null,o.degree++,i=r[o.degree]}r[o.degree]=o}let n=null;for(let o=0;o<r.length;o++){let i=r[o];i&&(i.next=i,i.prev=i,n=this._mergeLists(n,i))}return n}_removeNodeFromList(t){let r=t.prev,n=t.next;r.next=n,n.prev=r,t.next=t,t.prev=t}_linkHeaps(t,r){this._removeNodeFromList(t),r.child=this._mergeLists(t,r.child),t.parent=r,t.isMarked=!1}_mergeLists(t,r){if(!t)return r||null;if(!r)return t;let n=t.next;return t.next=r.next,t.next.prev=t,r.next=n,r.next.prev=r,this._compare(t,r)<0?t:r}_getNodeListSize(t){let r=0,n=t;do r++,n.child&&(r+=this._getNodeListSize(n.child)),n=n.next;while(n!==t);return r}};function uu(e){let t,r;return(...n)=>{if(!t||t.length!==n.length)return t=n,r=e.apply(void 0,n),r;for(let o=0,i=n.length;o<i;o++)if(n[o]!==t[o])return t=n,r=e.apply(void 0,n),r;return r}}function af(e){let t=new Map;return r=>{if(t.has(r))return t.get(r);let n=e(r);return t.set(r,n),n}}function sf(){return sf.create(b.create(0,0,0),b.create(1,0,0))}(c=>{function e(m,d){return{origin:m,direction:d}}c.create=e;function t(m,d){return b.copy(m.origin,d.origin),b.copy(m.direction,d.direction),m}c.copy=t;function r(m){return t(c(),m)}c.clone=r;function n(m,d,p){return b.copy(m.origin,d.origin),b.normalize(m.direction,b.sub(m.direction,p,d.origin)),m}c.targetTo=n;function o(m,d,p){return b.transformMat4(m.origin,d.origin,p),b.transformDirection(m.direction,d.direction,p),m}c.transform=o;let i=b();function a(m,d){let{center:p,radius:h}=d,{origin:f,direction:y}=m,g=b.sub(i,f,p),x=b.dot(y,y),S=2*b.dot(g,y),I=b.dot(g,g)-h*h,v=S*S-4*x*I;if(v<0)return-1;let A=(-S-Math.sqrt(v))/(2*x);return A<0?-1:A}function s(m,d,p){let h=a(d,p);return h<0?!1:(b.scaleAndAdd(m,d.origin,d.direction,h),!0)}c.intersectSphere3D=s;function l(m,d){return a(m,d)>=0}c.isIntersectingSphere3D=l;function u(m,d){return b.distance(m.origin,d.center)<d.radius}c.isInsideSphere3D=u})(sf||={});function Cc(e,t,r){return new V9(e,t,r)}var V9=class{find(t,r,n,o,i){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=o,this.ctx.isCheck=!1;let a=i??this.result;return Xse(this.ctx,a),a}nearest(t,r,n,o=1,i,a){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.k=o,this.ctx.stopIf=i;let s=a??this.result;return OUe(this.ctx,s),s}check(t,r,n,o){return this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=o,this.ctx.isCheck=!0,Xse(this.ctx,this.result)}approxNearest(t,r,n,o,i){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=o,this.ctx.isCheck=!1;let a=i??this.result;return kUe(this.ctx,a),a}constructor(t,r,n){let o=wUe(t,r,n);this.ctx=EUe(o),this.boundary={box:o.boundingBox,sphere:o.boundingSphere},this.buckets={offset:o.bucketOffset,count:o.bucketCounts,array:o.bucketArray},this.result=Gu.create()}};function DUe(e){let{expandedBox:t,size:[r,n,o],data:{x:i,y:a,z:s,radius:l,indices:u},elementCount:c,delta:m}=e,d=r*n*o,{min:[p,h,f]}=t,y=0,g=0,x=new Uint32Array(d),S=new Int32Array(c);for(let T=0;T<c;T++){let w=Se.getAt(u,T),D=Math.floor((i[w]-p)/m[0]),M=Math.floor((a[w]-h)/m[1]),E=Math.floor((s[w]-f)/m[2]),R=(D*n+M)*o+E;(x[R]+=1)===1&&(g+=1),S[T]=R}if(l)for(let T=0;T<c;T++){let w=Se.getAt(u,T);l[w]>y&&(y=l[w])}let I=new Int32Array(g);for(let T=0,w=0;T<d;T++){let D=x[T];D>0&&(x[T]=w+1,I[w]=D,w+=1)}let v=new Uint32Array(g);for(let T=1;T<g;++T)v[T]+=v[T-1]+I[T-1];let A=new Int32Array(g),_=new Int32Array(c);for(let T=0;T<c;T++){let w=x[S[T]];if(w>0){let D=w-1;_[v[D]+A[D]]=T,A[D]+=1}}return{size:e.size,bucketArray:_,bucketCounts:I,bucketOffset:v,grid:x,delta:m,min:e.expandedBox.min,data:e.data,maxRadius:y,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}var Wse=2**24;function wUe(e,t,r){let n=ut.expand(ut(),t.box,b.create(.5,.5,.5)),{indices:o}=e,i=ut.size(b(),n),a,s,l=Se.size(o),u=typeof r=="number"?r:32,c=Array.isArray(r)&&r;if(c&&!b.isZero(c))s=[Math.ceil(i[0]/c[0]),Math.ceil(i[1]/c[1]),Math.ceil(i[2]/c[2])],a=c;else if(l>0){let h=Math.ceil(l/u),f=Math.pow(h/(i[0]*i[1]*i[2]),1/3);s=[Math.ceil(i[0]*f),Math.ceil(i[1]*f),Math.ceil(i[2]*f)],a=[i[0]/s[0],i[1]/s[1],i[2]/s[2]]}else a=i,s=[1,1,1];let m=s[0]*s[1]*s[2];if(m>Wse){let h=Math.cbrt(m/Wse);s=[Math.ceil(s[0]/h),Math.ceil(s[1]/h),Math.ceil(s[2]/h)],a=[i[0]/s[0],i[1]/s[1],i[2]/s[2]]}let d={x:e.x,y:e.y,z:e.z,indices:o,radius:e.radius},p={size:s,data:d,expandedBox:n,boundingBox:t.box,boundingSphere:t.sphere,elementCount:l,delta:a};return DUe(p)}function EUe(e){return{grid:e,x:.1,y:.1,z:.1,k:1,stopIf:void 0,radius:.1,isCheck:!1}}function Xse(e,t){let{min:r,size:[n,o,i],bucketOffset:a,bucketCounts:s,bucketArray:l,grid:u,data:{x:c,y:m,z:d,indices:p,radius:h},delta:f,maxRadius:y}=e.grid,{radius:g,isCheck:x,x:S,y:I,z:v}=e,A=g+y,_=A*A;Gu.reset(t);let T=Math.max(0,Math.floor((S-A-r[0])/f[0])),w=Math.max(0,Math.floor((I-A-r[1])/f[1])),D=Math.max(0,Math.floor((v-A-r[2])/f[2])),M=Math.min(n-1,Math.floor((S+A-r[0])/f[0])),E=Math.min(o-1,Math.floor((I+A-r[1])/f[1])),R=Math.min(i-1,Math.floor((v+A-r[2])/f[2]));if(T>M||w>E||D>R)return!1;for(let k=T;k<=M;k++)for(let B=w;B<=E;B++)for(let L=D;L<=R;L++){let V=u[(k*o+B)*i+L];if(V===0)continue;let U=V-1,Q=a[U],O=s[U],q=Q+O;for(let X=Q;X<q;X++){let F=Se.getAt(p,l[X]),Y=c[F]-S,$=m[F]-I,ce=d[F]-v,ie=Y*Y+$*$+ce*ce;if(ie<=_){if(y>0&&Math.sqrt(ie)-h[F]>g)continue;if(x)return!0;Gu.add(t,l[X],ie)}}}return t.count>0}function MUe(e){let t=[],r=e*2+1;for(let n=0;n<r;++n)for(let o=0;o<r;++o)for(let i=0;i<r;++i)t.push(b.create(n-e,o-e,i-e));return t.sort((n,o)=>b.squaredMagnitude(n)-b.squaredMagnitude(o)),t.flat()}var BUe=af(MUe);function kUe(e,t){let{min:r,size:[n,o,i],bucketOffset:a,bucketCounts:s,bucketArray:l,grid:u,data:{x:c,y:m,z:d,indices:p},delta:h}=e.grid,{radius:f,x:y,y:g,z:x}=e,S=f*f;Gu.reset(t);let I=Math.max(0,Math.floor((y-f-r[0])/h[0])),v=Math.max(0,Math.floor((g-f-r[1])/h[1])),A=Math.max(0,Math.floor((x-f-r[2])/h[2])),_=Math.min(n-1,Math.floor((y+f-r[0])/h[0])),T=Math.min(o-1,Math.floor((g+f-r[1])/h[1])),w=Math.min(i-1,Math.floor((x+f-r[2])/h[2]));if(I>_||v>T||A>w)return!1;let D=Math.floor((y-r[0])/h[0]),M=Math.floor((g-r[1])/h[1]),E=Math.floor((x-r[2])/h[2]),R=BUe(Math.max(_-I,T-v,w-A)+1);for(let k=0,B=R.length;k<B;k+=3){let L=D+R[k],V=M+R[k+1],U=E+R[k+2];if(L<I||L>_||V<v||V>T||U<A||U>w)continue;let Q=u[(L*o+V)*i+U];if(Q===0)continue;let O=Q-1,q=a[O],X=s[O],F=q+X,Y=Number.MAX_VALUE;for(let $=q;$<F;$++){let ce=Se.getAt(p,l[$]),ie=c[ce]-y,oe=m[ce]-g,W=d[ce]-x,N=ie*ie+oe*oe+W*W;N<=S&&N<Y&&(Gu.add(t,l[$],N),Y=N)}if(Y!==Number.MAX_VALUE)return!0}return t.count>0}var ty=sf(),O2=new Set,F9=new Set,LUe=[.1],FUe=[.1],VUe=[.1],Ev=new wv;function OUe(e,t){let{min:r,expandedBox:n,boundingSphere:{center:o},size:[i,a,s],bucketOffset:l,bucketCounts:u,bucketArray:c,grid:m,data:{x:d,y:p,z:h,indices:f,radius:y},delta:g,maxRadius:x}=e.grid,{x:S,y:I,z:v,k:A,stopIf:_}=e,T=Se.size(f);if(Gu.reset(t),T===0||A<=0)return!1;let w,D,M,E=!1,R=1,k=!0,B=0,L=LUe,V=FUe,U=0,Q=!0,O,q=!1,X=VUe,F=x*x;L.length=0,X.length=0,O2.clear(),Ev.clear(),b.set(ty.origin,S,I,v),ut.containsVec3(n,ty.origin)?(w=Math.floor((S-r[0])/g[0]),D=Math.floor((I-r[1])/g[1]),M=Math.floor((v-r[2])/g[2])):(sf.targetTo(ty,ty,o),ut.nearestIntersectionWithRay3D(ty.origin,n,ty),w=Math.max(0,Math.min(i-1,Math.floor((ty.origin[0]-r[0])/g[0]))),D=Math.max(0,Math.min(a-1,Math.floor((ty.origin[1]-r[1])/g[1]))),M=Math.max(0,Math.min(s-1,Math.floor((ty.origin[2]-r[2])/g[2]))));let Y=x!==0?Math.max(1,Math.min(i-1,Math.ceil(x/g[0]))):1,$=x!==0?Math.max(1,Math.min(a-1,Math.ceil(x/g[1]))):1,ce=x!==0?Math.max(1,Math.min(s-1,Math.ceil(x/g[2]))):1;for(L.push(w,D,M,(w*a+D)*s+M);t.count<T;){let ie=R*4;for(let oe=0;oe<ie;oe+=4)if(O=L[oe+3],!O2.has(O)){O2.add(O),q=O2.size>=m.length;let W=m[O];if(W!==0){let N=U,j=W-1,ue=l[j],be=u[j],ee=ue+be;for(let le=ue;le<ee;le++){let Ae=c[le],Ce=Se.getAt(f,Ae),J=d[Ce]-S,z=p[Ce]-I,ae=h[Ce]-v,ge=J*J+z*z+ae*ae;if(x!==0){let ve=y[Ce];ge-=ve*ve}Q&&ge>U&&(U=ge),Ev.insert(ge,Ae)}N<U&&(Q=!1)}}V.length=0,B=0,F9.clear();for(let oe=0;oe<ie;oe+=4){w=L[oe],D=L[oe+1],M=L[oe+2];for(let W=-Y;W<=Y;W++){let N=w+W;if(!(N<0||N>=i))for(let j=-$;j<=$;j++){let ue=D+j;if(!(ue<0||ue>=a))for(let be=-ce;be<=ce;be++){let ee=M+be;if(!(ee<0||ee>=s)&&(O=(N*a+ue)*s+ee,!F9.has(O)&&(F9.add(O),!O2.has(O)))){if(!k){let le=r[0]+N*g[0]-S,Ae=r[1]+ue*g[1]-I,Ce=r[2]+ee*g[2]-v;if(le*le+Ae*Ae+Ce*Ce-F>U){X.push(N,ue,ee,O);continue}}V.push(N,ue,ee,O),B++}}}}}if(k=!1,B===0){if(A===1){let oe=Ev.findMinimum();if(oe){let{key:W,value:N}=oe;return Gu.add(t,N,W),!0}}else for(;!Ev.isEmpty()&&(q||Ev.findMinimum().key<=U)&&t.count<A;){let oe=Ev.extractMinimum(),W=oe.key,N=oe.value;Gu.add(t,N,W),_&&!E&&(E=_(N,W))}if(t.count>=A||E||t.count>=T)return t.count>0;if(k=!0,Q=!0,X.length>0){for(let oe=0,W=X.length;oe<W;oe++)L.push(X[oe]);X.length=0,R=L.length}}else{let oe=L;L=V,V=oe,R=B}}return t.count>0}var K={};Bi(K,{Bundle:()=>zv,Location:()=>xo,Loci:()=>Wd,Schema:()=>X2,Stats:()=>zue,atomicProperty:()=>CHe,chainIndex:()=>IHe,coarseProperty:()=>SHe,entityIndex:()=>AHe,property:()=>xHe,residueIndex:()=>vHe});var xo;(d=>{function e(p,h,f){return{kind:"element-location",structure:p,unit:h,element:f||0}}d.create=e;function t(p){return e(p.structure,p.unit,p.element)}d.clone=t;function r(p,h,f,y){return h&&(p.structure=h),f&&(p.unit=f),y!==void 0&&(p.element=y),p}d.set=r;function n(p,h){return p.unit=h.unit,p.element=h.element,p}d.copy=n;function o(p){return!!p&&p.kind==="element-location"}d.is=o;function i(p,h){return p.unit===h.unit&&p.element===h.element}d.areEqual=i;let a=b(),s=b();function l(p,h){return p.unit.conformation.position(p.element,a),h.unit.conformation.position(h.element,s),b.distance(a,s)}d.distance=l;function u(p,h){return h.unit.conformation.position(h.element,p)}d.position=u;function c(p){return p.unit.model.atomicHierarchy.residueAtomSegments.index[p.element]}d.residueIndex=c;function m(p){return p.unit.model.atomicHierarchy.chainAtomSegments.index[p.element]}d.chainIndex=m})(xo||={});var we;(m=>{function e(d,p,h){return{kind:"variable",name:d,type:p,isConstraint:h}}m.Variable=e;function t(d,p,h){return{kind:"value",namespace:d,name:p,parent:h}}m.Value=t;function r(d,p,h,f){return{kind:"container",namespace:d,name:p,child:h,alias:f}}m.Container=r;function n(d){return{kind:"union",types:d}}m.Union=n;function o(d,p,h,f){let y=Object.create(null);for(let g of f)y[g]=!0;return{kind:"oneof",namespace:d,name:p,type:h,values:y}}m.OneOf=o,m.Any={kind:"any"},m.AnyValue={kind:"any-value"},m.Num=t("","Number"),m.Str=t("","String"),m.Bool=o("","Bool",m.Str,["true","false"]);function c({values:d}){return Object.keys(d).sort()}m.oneOfValues=c})(we||={});var La;(s=>{function e(l){return{name:l}}s.Symbol=e;function t(l,u){return u?{head:l,args:u}:{head:l}}s.Apply=t;function r(l){return!!l&&Array.isArray(l)}s.isArgumentsArray=r;function n(l){return!!l&&!Array.isArray(l)}s.isArgumentsMap=n;function o(l){return!i(l)&&!a(l)}s.isLiteral=o;function i(l){return!!l&&!!l.head&&typeof l=="object"}s.isApply=i;function a(l){return!!l&&typeof l.name=="string"}s.isSymbol=a})(La||={});function St(e,t){let{description:r=void 0,isOptional:n=!1,isRest:o=!1,defaultValue:i=void 0}=t||{};return{type:e,isOptional:n,isRest:o,defaultValue:i,description:r}}var ar;(n=>{n.None=t({});function t(o){return{kind:"dictionary",map:o,"@type":0}}n.Dictionary=t;function r(o,i){let{nonEmpty:a=!1}=i||{};return{kind:"list",type:o,nonEmpty:a,"@type":0}}n.List=r})(ar||={});function O0(e,t,r,n){let o=function(i){return La.Apply(La.Symbol(o.id),i)};return o.info={namespace:"",name:e,description:n},o.id="",o.args=t,o.type=r,o}function O9(e,t,r,n){let o=function(i){return La.Apply(La.Symbol(o.id),i)};return o.info={namespace:e,name:t,description:n},o.id=`${e}.${t}`,o.args=ar.None,o.type=r,o}function G2(e){let t=e;return typeof t=="function"&&!!t.info&&!!t.args&&typeof t.info.namespace=="string"&&!!t.type}function pr(e,t,r){return O0("",e,t,r)}function dM(e){Zse("","",e)}function pM(e){let t=[];return qse(e,t),t}function Qse(e){let t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,(r,n,o,i)=>`${n}-${o.toLocaleLowerCase()}${i}`).replace(t,(r,n,o,i)=>`${n}-${o.toLocaleLowerCase()}${i}`)}function Zse(e,t,r){if(G2(r)){r.info.namespace=e,r.info.name=r.info.name||Qse(t),r.id=`${r.info.namespace}.${r.info.name}`;return}let n=`${r["@namespace"]||Qse(t)}`,o=e?`${e}.${n}`:n;for(let i of Object.keys(r))typeof r[i]!="object"&&!G2(r[i])||Zse(o,i,r[i])}function qse(e,t){if(G2(e)){t.push(e);return}for(let r of Object.keys(e))typeof e[r]!="object"&&!G2(e[r])||qse(e[r],t)}var Bn;(u=>(u.AnyVar=we.Variable("a",we.Any),u.AnyValueVar=we.Variable("a",we.Any),u.ConstrainedVar=we.Variable("a",we.Any,!0),u.Regex=we.Value("Core","Regex"),u.Set=c=>we.Container("Core","Set",c||u.AnyValueVar),u.List=c=>we.Container("Core","List",c||u.AnyVar),u.Fn=(c,m)=>we.Container("Core","Fn",c||u.AnyVar,m),u.Flags=(c,m)=>we.Container("Core","Flags",c,m),u.BitFlags=(0,u.Flags)(we.Num,"BitFlags")))(Bn||={});function vs(e,t){return pr(ar.Dictionary({0:St(e)}),e,t)}function nx(e,t){return pr(ar.List(e,{nonEmpty:!0}),e,t)}function Hd(e,t,r){return pr(ar.Dictionary({0:St(e),1:St(e)}),t,r)}var XVt=ar.Dictionary({0:St(we.Num),1:St(we.Num)}),GUe={"@header":"Types",bool:pr(ar.Dictionary({0:St(we.AnyValue)}),we.Bool,"Convert a value to boolean."),num:pr(ar.Dictionary({0:St(we.AnyValue)}),we.Num,"Convert a value to number."),str:pr(ar.Dictionary({0:St(we.AnyValue)}),we.Str,"Convert a value to string."),regex:pr(ar.Dictionary({0:St(we.Str,{description:"Expression"}),1:St(we.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),Bn.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:pr(ar.List(Bn.AnyVar),Bn.List()),set:pr(ar.List(Bn.AnyValueVar),Bn.Set()),bitflags:pr(ar.Dictionary({0:St(we.Num)}),Bn.BitFlags,"Interpret a number as bitflags."),compositeKey:pr(ar.List(we.AnyValue),we.AnyValue)},UUe={"@header":"Logic",not:vs(we.Bool),and:nx(we.Bool),or:nx(we.Bool)},NUe={"@header":"Control",eval:pr(ar.Dictionary({0:St(Bn.Fn(Bn.AnyVar))}),Bn.AnyVar,"Evaluate a function."),fn:pr(ar.Dictionary({0:St(Bn.AnyVar)}),Bn.Fn(Bn.AnyVar),'Wrap an expression to a "lazy" function.'),if:pr(ar.Dictionary({0:St(we.Bool,{description:"Condition"}),1:St(we.Variable("a",we.Any),{description:"If true"}),2:St(we.Variable("b",we.Any),{description:"If false"})}),we.Union([we.Variable("a",we.Any),we.Variable("b",we.Any)])),assoc:pr(ar.Dictionary({0:St(we.Str,{description:"Name"}),1:St(we.Variable("a",we.Any),{description:"Value to assign"})}),we.Variable("a",we.Any))},zUe={"@header":"Relational",eq:Hd(we.Variable("a",we.AnyValue,!0),we.Bool),neq:Hd(we.Variable("a",we.AnyValue,!0),we.Bool),lt:Hd(we.Num,we.Bool),lte:Hd(we.Num,we.Bool),gr:Hd(we.Num,we.Bool),gre:Hd(we.Num,we.Bool),inRange:pr(ar.Dictionary({0:St(we.Num,{description:"Value to test"}),1:St(we.Num,{description:"Minimum value"}),2:St(we.Num,{description:"Maximum value"})}),we.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},HUe={"@header":"Math",add:nx(we.Num),sub:nx(we.Num),mult:nx(we.Num),div:Hd(we.Num,we.Num),pow:Hd(we.Num,we.Num),mod:Hd(we.Num,we.Num),min:nx(we.Num),max:nx(we.Num),cantorPairing:Hd(we.Num,we.Num),sortedCantorPairing:Hd(we.Num,we.Num),invertCantorPairing:pr(ar.Dictionary({0:St(we.Num)}),Bn.List(we.Num)),floor:vs(we.Num),ceil:vs(we.Num),roundInt:vs(we.Num),trunc:vs(we.Num),abs:vs(we.Num),sign:vs(we.Num),sqrt:vs(we.Num),cbrt:vs(we.Num),sin:vs(we.Num),cos:vs(we.Num),tan:vs(we.Num),asin:vs(we.Num),acos:vs(we.Num),atan:vs(we.Num),sinh:vs(we.Num),cosh:vs(we.Num),tanh:vs(we.Num),exp:vs(we.Num),log:vs(we.Num),log10:vs(we.Num),atan2:Hd(we.Num,we.Num)},jUe={"@header":"Strings",concat:nx(we.Str),match:pr(ar.Dictionary({0:St(Bn.Regex),1:St(we.Str)}),we.Bool)},WUe={"@header":"Lists",getAt:pr(ar.Dictionary({0:St(Bn.List()),1:St(we.Num)}),Bn.AnyVar),equal:pr(ar.Dictionary({0:St(Bn.List()),1:St(Bn.List())}),we.Bool)},XUe={"@header":"Sets",has:pr(ar.Dictionary({0:St(Bn.Set(Bn.ConstrainedVar)),1:St(Bn.ConstrainedVar)}),we.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:pr(ar.Dictionary({0:St(Bn.Set(Bn.ConstrainedVar)),1:St(Bn.Set(Bn.ConstrainedVar))}),we.Bool,"Check if the the 1st argument is a subset of the 2nd.")},QUe={"@header":"Flags",hasAny:pr(ar.Dictionary({0:St(Bn.Flags(Bn.ConstrainedVar)),1:St(Bn.Flags(Bn.ConstrainedVar))}),we.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:pr(ar.Dictionary({0:St(Bn.Flags(Bn.ConstrainedVar)),1:St(Bn.Flags(Bn.ConstrainedVar))}),we.Bool,"Check if the the 1st argument has all 2nd one's flags.")},fM={"@header":"Language Primitives",type:GUe,logic:UUe,ctrl:NUe,rel:zUe,math:HUe,str:jUe,list:WUe,set:XUe,flags:QUe};dM(fM);var ZUe=pM(fM),QVt=function(){let e=Object.create(null);for(let t of ZUe)e[t.id]=t;return e}();var Nt;(f=>(f.ElementSymbol=we.Value("Structure","ElementSymbol"),f.AtomName=we.Value("Structure","AtomName"),f.BondFlag=we.OneOf("Structure","BondFlag",we.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),f.BondFlags=Bn.Flags(f.BondFlag,"BondFlags"),f.SecondaryStructureFlag=we.OneOf("Structure","SecondaryStructureFlag",we.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),f.SecondaryStructureFlags=Bn.Flags(f.SecondaryStructureFlag,"SecondaryStructureFlag"),f.RingFingerprint=we.Value("Structure","RingFingerprint"),f.EntityType=we.OneOf("Structure","EntityType",we.Str,["polymer","non-polymer","water","branched"]),f.EntitySubtype=we.OneOf("Structure","EntitySubtype",we.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),f.ObjectPrimitive=we.OneOf("Structure","ObjectPrimitive",we.Str,["atomistic","sphere","gaussian","other"]),f.ResidueId=we.Value("Structure","ResidueId"),f.ElementSet=we.Value("Structure","ElementSet"),f.ElementSelection=we.Value("Structure","ElementSelection"),f.ElementReference=we.Value("Structure","ElementReference"),f.ElementSelectionQuery=Bn.Fn(f.ElementSelection,"ElementSelectionQuery")))(Nt||={});var YUe={"@header":"Types",elementSymbol:pr(ar.Dictionary({0:St(we.Str)}),Nt.ElementSymbol,"Create element symbol representation from a string value."),atomName:pr(ar.Dictionary({0:St(we.AnyValue)}),Nt.AtomName,"Convert a value to an atom name."),entityType:pr(ar.Dictionary({0:St(Nt.EntityType)}),Nt.EntityType,`Create normalized representation of entity type: ${we.oneOfValues(Nt.EntityType).join(", ")}.`),bondFlags:pr(ar.List(Nt.BondFlag),Nt.BondFlags,`Create bond flags representation from a list of strings. Allowed flags: ${we.oneOfValues(Nt.BondFlag).join(", ")}.`),ringFingerprint:pr(ar.List(Nt.ElementSymbol,{nonEmpty:!0}),Nt.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:pr(ar.List(Nt.SecondaryStructureFlag),Nt.SecondaryStructureFlags,`Create secondary structure flags representation from a list of strings. Allowed flags: ${we.oneOfValues(Nt.SecondaryStructureFlag).join(", ")}.`),authResidueId:pr(ar.Dictionary({0:St(we.Str,{description:"auth_asym_id"}),1:St(we.Num,{description:"auth_seq_id"}),2:St(we.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Nt.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:pr(ar.Dictionary({0:St(we.Str,{description:"label_entity_id"}),1:St(we.Str,{description:"label_asym_id"}),2:St(we.Num,{description:"label_seq_id"}),3:St(we.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Nt.ResidueId,`Residue identifier based on mmCIF's "label_" annotation.`)},KUe={"@header":"Iteration Slots",element:pr(ar.None,Nt.ElementReference,"A reference to the current element."),elementSetReduce:pr(ar.None,we.Variable("a",we.AnyValue,!0),"Current value of the element set reducer.")},JUe={"@header":"Generators",all:pr(ar.None,Nt.ElementSelectionQuery,"The entire structure."),atomGroups:pr(ar.Dictionary({"entity-test":St(we.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":St(we.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":St(we.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":St(we.Bool,{isOptional:!0,defaultValue:!0}),"group-by":St(we.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),Nt.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:pr(ar.Dictionary({0:St(we.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),Nt.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:pr(ar.Dictionary({fingerprint:St(Nt.RingFingerprint,{isOptional:!0}),"only-aromatic":St(we.Bool,{isOptional:!0,defaultValue:!1})}),Nt.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),query:St(Nt.ElementSelectionQuery),"in-complement":St(we.Bool,{isOptional:!0,defaultValue:!1})}),Nt.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:pr(ar.None,Nt.ElementSelectionQuery,"Nada.")},$Ue={"@header":"Selection Modifications",queryEach:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),query:St(Nt.ElementSelectionQuery)}),Nt.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),by:St(Nt.ElementSelectionQuery)}),Nt.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),by:St(Nt.ElementSelectionQuery)}),Nt.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),by:St(Nt.ElementSelectionQuery)}),Nt.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery)}),Nt.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),"min-distance":St(we.Num,{isOptional:!0,defaultValue:0}),"max-distance":St(we.Num),"min-size":St(we.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":St(we.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),Nt.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),radius:St(we.Num),"atom-radius":St(we.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":St(we.Bool,{isOptional:!0})}),Nt.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),radius:St(we.Num),"include-water":St(we.Bool,{isOptional:!0,defaultValue:!0})}),Nt.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),"bond-test":St(we.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":St(we.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":St(we.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":St(we.Bool,{isOptional:!0})}),Nt.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery)}),Nt.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),property:St(we.AnyValue)}),Nt.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},eNe={"@header":"Selection Filters",pick:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),test:St(we.Bool)}),Nt.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery)}),Nt.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),source:St(Nt.ElementSelectionQuery),property:St(we.Any)}),Nt.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),by:St(Nt.ElementSelectionQuery)}),Nt.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),target:St(Nt.ElementSelectionQuery),"min-radius":St(we.Num,{isOptional:!0,defaultValue:0}),"max-radius":St(we.Num),"atom-radius":St(we.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:St(we.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),Nt.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery),target:St(Nt.ElementSelectionQuery),"bond-test":St(we.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:St(we.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:St(we.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),Nt.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},tNe={"@header":"Selection Combinators",intersect:pr(ar.List(Nt.ElementSelectionQuery),Nt.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:pr(ar.List(Nt.ElementSelectionQuery),Nt.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:pr(ar.Dictionary({matrix:St(Bn.List(Bn.List(we.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:St(Bn.List(Nt.ElementSelectionQuery),{description:"A list of held selections."})}),Nt.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},rNe={"@header":"Atom Sets",atomCount:pr(ar.None,we.Num),countQuery:pr(ar.Dictionary({0:St(Nt.ElementSelectionQuery)}),we.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:pr(ar.Dictionary({initial:St(we.Variable("a",we.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:St(we.Variable("a",we.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),we.Variable("a",we.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:pr(ar.Dictionary({0:St(Bn.ConstrainedVar)}),Bn.Set(Bn.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},nNe={"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:Pn(Nt.ElementSymbol),vdw:Pn(we.Num,"Van der Waals radius"),mass:Pn(we.Num,"Atomic weight"),atomicNumber:Pn(we.Num,"Atomic number"),x:Pn(we.Num,"Cartesian X coordinate"),y:Pn(we.Num,"Cartesian Y coordinate"),z:Pn(we.Num,"Cartesian Z coordinate"),atomKey:Pn(we.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:pr(ar.Dictionary({0:St(Nt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:St(Nt.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),we.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:Pn(we.Num,"Index of the atom/element in the input file."),operatorName:Pn(we.Str,"Name of the symmetry operator applied to this element."),instanceId:Pn(we.Str,"Canonical name of the symmetry operator applied to this element."),operatorKey:Pn(we.Num,"Key of the symmetry operator applied to this element."),modelIndex:Pn(we.Num,"Index of the model in the input file."),modelLabel:Pn(we.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:Pn(we.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:Pn(Nt.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:Pn(Nt.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:Pn(we.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:Pn(we.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:Pn(we.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:Pn(we.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:Pn(we.Num,"_atom_site.id"),label_atom_id:Pn(Nt.AtomName),label_alt_id:Pn(we.Str),label_comp_id:Pn(we.Str),label_asym_id:Pn(we.Str),label_entity_id:Pn(we.Str),label_seq_id:Pn(we.Num),auth_atom_id:Pn(Nt.AtomName),auth_comp_id:Pn(we.Str),auth_asym_id:Pn(we.Str),auth_seq_id:Pn(we.Num),pdbx_PDB_ins_code:Pn(we.Str),pdbx_formal_charge:Pn(we.Num),occupancy:Pn(we.Num),B_iso_or_equiv:Pn(we.Num),entityType:Pn(Nt.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:Pn(Nt.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:Pn(we.Str,"The PRD ID of the entity."),entityDescription:Pn(Bn.List(we.Str)),objectPrimitive:Pn(Nt.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:Pn(we.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:Pn(Nt.SecondaryStructureFlags),isModified:Pn(we.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:Pn(we.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:Pn(we.Bool,"True if this is a non-standard residue."),chemCompType:Pn(we.Str,"Type of the chemical component as defined in mmCIF.")},ihm:{hasSeqId:pr(ar.Dictionary({0:St(we.Num)}),we.Bool,"Checks if the current element represents a given sequence id"),overlapsSeqIdRange:pr(ar.Dictionary({beg:St(we.Num),end:St(we.Num)}),we.Bool,"Checks if the current element overlaps with the specified residue range")}},oNe={"@header":"Bond Properties",flags:Mv(Nt.BondFlags),order:Mv(we.Num),key:Mv(we.Num),length:Mv(we.Num),atomA:Mv(Nt.ElementReference),atomB:Mv(Nt.ElementReference)};function Pn(e,t){return pr(ar.Dictionary({0:St(Nt.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function Mv(e,t){return pr(ar.None,e,t)}var Yse={"@header":"Structure Queries",type:YUe,slot:KUe,generator:JUe,modifier:$Ue,filter:eNe,combinator:tNe,atomSet:rNe,atomProperty:nNe,bondProperty:oNe};var aNe={"@header":"Generators",bundleElement:pr(ar.Dictionary({groupedUnits:St(we.Any),set:St(we.Any),ranges:St(we.Any)}),we.Any),bundle:pr(ar.Dictionary({elements:St(we.Any)}),Nt.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:pr(ar.None,Nt.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")},Kse={"@header":"Internal Queries",generator:aNe};var Te={core:fM,structureQuery:Yse,internal:Kse};dM(Te);var sNe=pM(Te),iOt=function(){let e=Object.create(null);for(let t of sNe)e[t.id]=t;return e}();var ne;(I=>{I.core=Te.core,I.struct=Te.structureQuery,I.internal=Te.internal;function n(v){return I.struct.type.atomName([v])}I.atomName=n;function o(v){return I.struct.type.elementSymbol([v])}I.es=o;function i(...v){return I.core.type.list(v)}I.list=i;function a(...v){return I.core.type.set(v)}I.set=a;function s(v,A){return I.core.type.regex([v,A])}I.re=s;function l(v){return I.core.ctrl.fn([v])}I.fn=l;function u(v){return I.core.ctrl.eval([v])}I.evaluate=u;let c=I.struct.atomProperty.core,m=I.struct.atomProperty.macromolecular,d=I.struct.atomProperty.topology;function p(v){return c[v]()}I.acp=p;function h(v){return d[v]()}I.atp=h;function f(v){return m[v]()}I.ammp=f;let y=I.struct.atomSet.propertySet;function g(v){return y([p(v)])}I.acpSet=g;function x(v){return y([h(v)])}I.atpSet=x;function S(v){return y([f(v)])}I.ammpSet=S})(ne||={});var lNe=b.add,uNe=b.squaredDistance,cNe=b.distance;var cu=class{constructor(){this.count=0;this.center=b();this.radiusSq=0}reset(){b.set(this.center,0,0,0),this.radiusSq=0,this.count=0}includeStep(t){lNe(this.center,this.center,t),this.count++}finishedIncludeStep(){this.count!==0&&b.scale(this.center,this.center,1/this.count)}radiusStep(t){let r=uNe(t,this.center);r>this.radiusSq&&(this.radiusSq=r)}radiusSphereStep(t,r){let n=cNe(t,this.center)+r,o=n*n;o>this.radiusSq&&(this.radiusSq=o)}getSphere(t){return t||(t=ye()),b.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t}getCount(){return this.count}};(a=>{let e=new a,t=b(),r=b();function n({x:s,y:l,z:u},c){e.reset();let m=s.length;for(let d=0;d<m;d++)b.set(t,s[d],l[d],u[d]),e.includeStep(t);e.finishedIncludeStep();for(let d=0;d<m;d++)b.set(t,s[d],l[d],u[d]),e.radiusStep(t);return b.copy(c.center,e.center),c.radius=Math.sqrt(e.radiusSq),c}a.fromArrays=n;function o(s,l,u){e.reset();for(let c=0;c<s;c++)l(c,t),e.includeStep(t);e.finishedIncludeStep();for(let c=0;c<s;c++)l(c,t),e.radiusStep(t);return b.copy(u.center,e.center),u.radius=Math.sqrt(e.radiusSq),u}a.fromProvider=o;function i(s,l,u){e.reset();for(let c=0;c<s;c++)l(c,t,r),e.includeStep(t),e.includeStep(r);e.finishedIncludeStep();for(let c=0;c<s;c++)l(c,t,r),e.radiusStep(t),e.radiusStep(r);return b.copy(u.center,e.center),u.radius=Math.sqrt(e.radiusSq),u}a.fromPairProvider=i})(cu||={});var Km=class e{constructor(t){this.map=t;let r=0,n=[],o=new Map,i=new Map;this.map.forEach(a=>{a.forEach(s=>{r+=s.edgeCount,s.connectedIndices.forEach(l=>{s.getEdges(l).forEach(u=>{let{unitA:c,unitB:m}=s,d=e.getEdgeIndexKey(c,m),p=e.getEdgeIndexKey(l,u.indexB),h=o.get(d);h===void 0?o.set(d,new Map([[p,n.length]])):h.set(p,n.length);let f=e.getVertexKey(l,c),y=i.get(f);y===void 0?i.set(f,[n.length]):y.push(n.length),n.push({...u,indexA:l,unitA:c,unitB:m})})})})}),this.edgeCount=r,this.edges=n,this.edgeKeyIndex=o,this.vertexKeyIndex=i}getConnectedUnits(t){return this.map.has(t)?this.map.get(t):Jse}getEdgeIndex(t,r,n,o){let i=this.edgeKeyIndex.get(e.getEdgeUnitKey(r,o));if(i===void 0)return-1;let a=i.get(e.getEdgeIndexKey(t,n));return a!==void 0?a:-1}hasEdge(t,r,n,o){return this.getEdgeIndex(t,r,n,o)!==-1}getEdge(t,r,n,o){let i=this.getEdgeIndex(t,r,n,o);return i!==-1?this.edges[i]:void 0}getEdgeIndices(t,r){return this.vertexKeyIndex.get(e.getVertexKey(t,r))||[]}};(a=>{class e{constructor(l,u,c,m,d){this.unitA=l;this.unitB=u;this.edgeCount=c;this.connectedIndices=m;this.edgeMap=d}hasEdges(l){return this.edgeMap.has(l)}getEdges(l){return this.edgeMap.has(l)?this.edgeMap.get(l):Jse}get areUnitsOrdered(){return this.unitA<this.unitB}}a.UnitPairEdges=e;function t(s,l){return Xi(s,l)}a.getEdgeUnitKey=t;function r(s,l){return Xi(s,l)}a.getEdgeIndexKey=r;function n(s,l){return Xi(s,l)}a.getVertexKey=n;function o(s,l,u){s.has(l)?s.get(l).push(u):s.set(l,[u])}class i{constructor(){this.map=new Map}startUnitPair(l,u){this.uA=l,this.uB=u,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=Tn.create(),this.linkedB=Tn.create(),this.linkCount=0}finishUnitPair(){this.linkCount!==0&&(o(this.map,this.uA,new e(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),o(this.map,this.uB,new e(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))}add(l,u,c){o(this.mapAB,l,{indexB:u,props:c}),o(this.mapBA,u,{indexB:l,props:c}),Tn.add(this.linkedA,l,l),Tn.add(this.linkedB,u,u),this.linkCount+=1}getMap(){return this.map}}a.Builder=i})(Km||={});var Jse=[];var U2;(t=>t.Empty=ns.create([],[],[],0,{flags:[],order:[],key:[]}))(U2||={});var dh=class extends Km{getBondFromLocation(t){return me.isAtomic(t.aUnit)&&me.isAtomic(t.bUnit)?this.getEdge(t.aIndex,t.aUnit.id,t.bIndex,t.bUnit.id):void 0}getBondIndexFromLocation(t){return me.isAtomic(t.aUnit)&&me.isAtomic(t.bUnit)?this.getEdgeIndex(t.aIndex,t.aUnit.id,t.bIndex,t.bUnit.id):-1}};(t=>{class e extends Km.UnitPairEdges{}t.UnitPairBonds=e})(dh||={});var mNe=4,hM={forceCompute:!1,noCompute:!1,maxRadius:mNe},G9={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},dNe={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},pNe={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},$se=2.001,ox=function(){let e=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],t=new Set;for(let r of e)t.add(G9[r]);return t}();function fNe(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}function om(e){let t=G9[e];return t===void 0?-1:t}function hNe(e,t){if(e<0||t<0)return-1;let r=pNe[fNe(e,t)];return r===void 0?-1:r}function ph(e){if(e<0)return $se;let t=dNe[e];return t===void 0?$se:t}function Bv(e,t,r,n){let o=hNe(e,t);return o>0?o:t<0?r:(r+n)/1.95}var gNe=G9.H;function jd(e){return e===gNe}var yNe=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function ele(e,t,r){return[t,r]=t<r?[t,r]:[r,t],k0.has(e)&&t==="C"&&r==="O"||L0.has(e)&&t==="OP1"&&r==="P"?2:yNe.get(`${e}|${t}|${r}`)||1}var bNe=new Map([["LYS|NZ|RET|C15",2]]);function gM(e,t,r,n){return e>r&&([e,r]=[r,e],[t,n]=[n,t]),bNe.get(`${e}|${t}|${r}|${n}`)||1}var ry=H.Schema,se=ry.str,Ee=ry.int,$r=ry.float,U9=ry.coord,Wt=ry.Aliased,ix=ry.Matrix,yM=ry.Vector,go=ry.lstr,G0=ry.List,an={atom_site:{auth_asym_id:se,auth_atom_id:se,auth_comp_id:se,auth_seq_id:Ee,B_iso_or_equiv:$r,Cartn_x:U9,Cartn_y:U9,Cartn_z:U9,group_PDB:Wt(se),id:Ee,label_alt_id:se,label_asym_id:se,label_atom_id:se,label_comp_id:se,label_entity_id:se,label_seq_id:Ee,occupancy:$r,type_symbol:se,pdbx_PDB_ins_code:se,pdbx_PDB_model_num:Ee,pdbx_formal_charge:Ee,pdbx_label_index:Ee,pdbx_sifts_xref_db_name:se,pdbx_sifts_xref_db_acc:se,pdbx_sifts_xref_db_num:se,pdbx_sifts_xref_db_res:se,ihm_model_id:Ee},atom_site_anisotrop:{id:Ee,type_symbol:se,U:ix(3,3),U_esd:ix(3,3),pdbx_auth_seq_id:Ee,pdbx_auth_asym_id:se,pdbx_auth_atom_id:se,pdbx_auth_comp_id:se,pdbx_label_seq_id:Ee,pdbx_label_alt_id:se,pdbx_label_asym_id:se,pdbx_label_atom_id:se,pdbx_label_comp_id:se,pdbx_PDB_ins_code:se},atom_sites:{entry_id:se,fract_transf_matrix:ix(3,3),fract_transf_vector:yM(3)},audit_author:{name:se,pdbx_ordinal:Ee,identifier_ORCID:se},audit_conform:{dict_location:se,dict_name:se,dict_version:se},cell:{angle_alpha:$r,angle_beta:$r,angle_gamma:$r,entry_id:se,length_a:$r,length_b:$r,length_c:$r,Z_PDB:Ee,pdbx_unique_axis:se},chem_comp:{formula:se,formula_weight:$r,id:se,mon_nstd_flag:Wt(go),name:se,type:Wt(go),pdbx_synonyms:G0(";",e=>e)},chem_comp_bond:{atom_id_1:se,atom_id_2:se,comp_id:se,value_order:Wt(go),pdbx_ordinal:Ee,pdbx_stereo_config:Wt(go),pdbx_aromatic_flag:Wt(go)},citation:{book_publisher:se,country:se,id:se,journal_abbrev:se,journal_id_ASTM:se,journal_id_CSD:se,journal_id_ISSN:se,journal_volume:se,page_first:se,page_last:se,title:se,year:Ee,pdbx_database_id_DOI:se,pdbx_database_id_PubMed:Ee},citation_author:{citation_id:se,name:se,ordinal:Ee},database_2:{database_id:Wt(go),database_code:se},entity:{details:se,formula_weight:$r,id:se,src_method:Wt(go),type:Wt(go),pdbx_description:G0(",",e=>e),pdbx_number_of_molecules:Ee,pdbx_parent_entity_id:se,pdbx_mutation:se,pdbx_fragment:se,pdbx_ec:G0(",",e=>e)},entity_poly:{entity_id:se,nstd_linkage:Wt(go),nstd_monomer:Wt(go),type:Wt(se),pdbx_strand_id:G0(",",e=>e),pdbx_seq_one_letter_code:se,pdbx_seq_one_letter_code_can:se,pdbx_target_identifier:se},entity_poly_seq:{entity_id:se,hetero:Wt(go),mon_id:se,num:Ee},entry:{id:se},exptl:{entry_id:se,method:Wt(se)},software:{classification:se,date:se,description:se,name:se,type:Wt(go),version:se,pdbx_ordinal:Ee},struct:{entry_id:se,title:se,pdbx_structure_determination_methodology:Wt(se),pdbx_descriptor:se},struct_asym:{details:se,entity_id:se,id:se,pdbx_modified:se,pdbx_blank_PDB_chainid_flag:Wt(se)},struct_conf:{beg_label_asym_id:se,beg_label_comp_id:se,beg_label_seq_id:Ee,beg_auth_asym_id:se,beg_auth_comp_id:se,beg_auth_seq_id:Ee,conf_type_id:Wt(go),details:se,end_label_asym_id:se,end_label_comp_id:se,end_label_seq_id:Ee,end_auth_asym_id:se,end_auth_comp_id:se,end_auth_seq_id:Ee,id:se,pdbx_beg_PDB_ins_code:se,pdbx_end_PDB_ins_code:se,pdbx_PDB_helix_class:se,pdbx_PDB_helix_length:Ee,pdbx_PDB_helix_id:se},struct_conn:{conn_type_id:Wt(go),details:se,id:se,ptnr1_label_asym_id:se,ptnr1_label_atom_id:se,ptnr1_label_comp_id:se,ptnr1_label_seq_id:Ee,ptnr1_auth_asym_id:se,ptnr1_auth_comp_id:se,ptnr1_auth_seq_id:Ee,ptnr1_symmetry:se,ptnr2_label_asym_id:se,ptnr2_label_atom_id:se,ptnr2_label_comp_id:se,ptnr2_label_seq_id:Ee,ptnr2_auth_asym_id:se,ptnr2_auth_comp_id:se,ptnr2_auth_seq_id:Ee,ptnr2_symmetry:se,pdbx_ptnr1_PDB_ins_code:se,pdbx_ptnr1_label_alt_id:se,pdbx_ptnr1_standard_comp_id:se,pdbx_ptnr2_PDB_ins_code:se,pdbx_ptnr2_label_alt_id:se,pdbx_ptnr3_PDB_ins_code:se,pdbx_ptnr3_label_alt_id:se,pdbx_ptnr3_label_asym_id:se,pdbx_ptnr3_label_atom_id:se,pdbx_ptnr3_label_comp_id:se,pdbx_ptnr3_label_seq_id:Ee,pdbx_PDB_id:se,pdbx_dist_value:$r,pdbx_value_order:Wt(go)},struct_conn_type:{criteria:se,id:Wt(go),reference:se},struct_keywords:{entry_id:se,text:G0(",",e=>e),pdbx_keywords:se},struct_mon_prot_cis:{label_alt_id:se,label_asym_id:se,label_comp_id:se,label_seq_id:Ee,auth_asym_id:se,auth_comp_id:se,auth_seq_id:Ee,pdbx_auth_asym_id_2:se,pdbx_auth_comp_id_2:se,pdbx_auth_seq_id_2:Ee,pdbx_label_asym_id_2:se,pdbx_label_comp_id_2:se,pdbx_label_seq_id_2:Ee,pdbx_PDB_ins_code:se,pdbx_PDB_ins_code_2:se,pdbx_PDB_model_num:Ee,pdbx_omega_angle:se,pdbx_id:se,pdbx_auth_ins_code:se,pdbx_auth_ins_code_2:se},struct_ncs_oper:{code:Wt(se),details:se,id:Ee,matrix:ix(3,3),vector:yM(3)},struct_sheet_range:{beg_label_asym_id:se,beg_label_comp_id:se,beg_label_seq_id:Ee,end_label_asym_id:se,end_label_comp_id:se,end_label_seq_id:Ee,beg_auth_asym_id:se,beg_auth_comp_id:se,beg_auth_seq_id:Ee,end_auth_asym_id:se,end_auth_comp_id:se,end_auth_seq_id:Ee,id:se,sheet_id:se,pdbx_beg_PDB_ins_code:se,pdbx_end_PDB_ins_code:se},struct_site:{details:se,id:se,pdbx_num_residues:Ee,pdbx_evidence_code:se,pdbx_auth_asym_id:se,pdbx_auth_comp_id:se,pdbx_auth_seq_id:Ee,pdbx_auth_ins_code:se},struct_site_gen:{details:se,id:se,label_alt_id:se,label_asym_id:se,label_atom_id:se,label_comp_id:se,label_seq_id:Ee,auth_asym_id:se,auth_atom_id:se,auth_comp_id:se,auth_seq_id:Ee,site_id:se,symmetry:se,pdbx_auth_ins_code:se,pdbx_num_res:Ee},struct_site_keywords:{site_id:se,text:se},symmetry:{entry_id:se,cell_setting:Wt(go),Int_Tables_number:Ee,space_group_name_Hall:se,"space_group_name_H-M":se},pdbx_database_status:{status_code:Wt(se),status_code_sf:Wt(se),status_code_mr:Wt(se),entry_id:se,recvd_initial_deposition_date:se,SG_entry:Wt(go),deposit_site:Wt(se),process_site:Wt(se),status_code_cs:Wt(se),methods_development_category:Wt(se),pdb_format_compatible:Wt(go)},pdbx_nonpoly_scheme:{asym_id:se,entity_id:se,mon_id:se,pdb_strand_id:se,ndb_seq_num:se,pdb_seq_num:se,auth_seq_num:se,pdb_mon_id:se,auth_mon_id:se,pdb_ins_code:se},pdbx_database_related:{db_name:Wt(se),details:se,db_id:se,content_type:Wt(se)},pdbx_entity_nonpoly:{entity_id:se,comp_id:se,name:se},pdbx_chem_comp_synonyms:{name:se,comp_id:se,provenance:Wt(se)},pdbx_chem_comp_identifier:{comp_id:se,identifier:se,type:Wt(se),program:se,program_version:se},pdbx_unobs_or_zero_occ_residues:{id:Ee,polymer_flag:Wt(go),occupancy_flag:Wt(Ee),PDB_model_num:Ee,auth_asym_id:se,auth_comp_id:se,auth_seq_id:Ee,PDB_ins_code:se,label_asym_id:se,label_comp_id:se,label_seq_id:Ee},pdbx_struct_mod_residue:{id:Ee,auth_asym_id:se,auth_comp_id:se,auth_seq_id:Ee,PDB_ins_code:se,label_asym_id:se,label_comp_id:se,label_seq_id:Ee,parent_comp_id:se,details:se},pdbx_struct_oper_list:{id:se,type:Wt(se),name:se,symmetry_operation:se,matrix:ix(3,3),vector:yM(3)},pdbx_struct_assembly:{method_details:se,oligomeric_details:se,oligomeric_count:Ee,details:se,id:se},pdbx_struct_assembly_gen:{asym_id_list:G0(",",e=>e),assembly_id:se,oper_expression:se},pdbx_reference_entity_list:{prd_id:se,ref_entity_id:se,type:Wt(go),details:se,component_id:Ee},pdbx_reference_entity_link:{link_id:Ee,prd_id:se,details:se,ref_entity_id_1:se,ref_entity_id_2:se,entity_seq_num_1:Ee,entity_seq_num_2:Ee,comp_id_1:se,comp_id_2:se,atom_id_1:se,atom_id_2:se,value_order:Wt(go),component_1:Ee,component_2:Ee,link_class:Wt(se)},pdbx_reference_entity_poly_link:{link_id:Ee,prd_id:se,ref_entity_id:se,component_id:Ee,entity_seq_num_1:Ee,entity_seq_num_2:Ee,comp_id_1:se,comp_id_2:se,atom_id_1:se,atom_id_2:se,value_order:Wt(go)},pdbx_molecule:{prd_id:se,instance_id:Ee,asym_id:se},pdbx_molecule_features:{prd_id:se,class:Wt(go),type:Wt(go),name:se,details:se},entity_src_nat:{entity_id:se,pdbx_organism_scientific:se,pdbx_plasmid_name:se,pdbx_src_id:Ee,pdbx_beg_seq_num:Ee,pdbx_end_seq_num:Ee},entity_src_gen:{entity_id:se,pdbx_gene_src_gene:G0(",",e=>e),pdbx_gene_src_scientific_name:se,plasmid_name:se,pdbx_src_id:Ee,pdbx_beg_seq_num:Ee,pdbx_end_seq_num:Ee},pdbx_entity_src_syn:{organism_scientific:se,entity_id:se,pdbx_src_id:Ee,pdbx_beg_seq_num:Ee,pdbx_end_seq_num:Ee},pdbx_entity_branch_descriptor:{entity_id:se,descriptor:se,type:Wt(go),program:se,program_version:se,ordinal:Ee},pdbx_entity_instance_feature:{details:se,feature_type:Wt(se),auth_asym_id:se,asym_id:se,auth_seq_num:se,seq_num:Ee,comp_id:se,auth_comp_id:se,ordinal:Ee},pdbx_entity_branch_list:{entity_id:se,hetero:Wt(go),comp_id:se,num:Ee},pdbx_entity_branch_link:{link_id:Ee,details:se,entity_id:se,entity_branch_list_num_1:Ee,entity_branch_list_num_2:Ee,comp_id_1:se,comp_id_2:se,atom_id_1:se,leaving_atom_id_1:se,atom_stereo_config_1:Wt(go),atom_id_2:se,leaving_atom_id_2:se,atom_stereo_config_2:Wt(go),value_order:Wt(go)},pdbx_entity_branch:{entity_id:se,type:Wt(se)},pdbx_branch_scheme:{entity_id:se,hetero:Wt(go),asym_id:se,mon_id:se,num:Ee,pdb_asym_id:se,pdb_seq_num:se,pdb_mon_id:se,auth_asym_id:se,auth_seq_num:se,auth_mon_id:se},pdbx_chem_comp_related:{comp_id:se,related_comp_id:se,relationship_type:Wt(se),details:se},ihm_starting_model_details:{starting_model_id:se,entity_id:se,entity_description:se,asym_id:se,entity_poly_segment_id:Ee,starting_model_source:Wt(se),starting_model_auth_asym_id:se,starting_model_sequence_offset:Ee,dataset_list_id:Ee},ihm_starting_comparative_models:{id:Ee,starting_model_id:se,starting_model_auth_asym_id:se,starting_model_seq_id_begin:Ee,starting_model_seq_id_end:Ee,template_auth_asym_id:se,template_seq_id_begin:Ee,template_seq_id_end:Ee,template_sequence_identity:$r,template_sequence_identity_denominator:Wt(Ee),template_dataset_list_id:Ee,alignment_file_id:Ee},ihm_starting_model_seq_dif:{id:Ee,entity_id:se,asym_id:se,seq_id:Ee,comp_id:se,starting_model_id:se,db_asym_id:se,db_seq_id:Ee,db_comp_id:se,details:se},ihm_model_representation:{id:Ee,name:se,details:se},ihm_model_representation_details:{id:Ee,representation_id:Ee,entity_poly_segment_id:Ee,entity_id:se,entity_description:se,entity_asym_id:se,model_object_primitive:Wt(se),starting_model_id:se,model_mode:Wt(se),model_granularity:Wt(se),model_object_count:Ee},ihm_struct_assembly_details:{id:Ee,assembly_id:Ee,parent_assembly_id:Ee,entity_description:se,entity_id:se,asym_id:se,entity_poly_segment_id:Ee},ihm_struct_assembly:{id:Ee,name:se,description:se},ihm_modeling_protocol:{id:Ee,num_steps:Ee,protocol_name:se},ihm_modeling_protocol_details:{id:Ee,protocol_id:Ee,step_id:Ee,struct_assembly_id:Ee,dataset_group_id:Ee,struct_assembly_description:se,step_name:se,step_method:se,num_models_begin:Ee,num_models_end:Ee,multi_scale_flag:Wt(go),multi_state_flag:Wt(go),ordered_flag:Wt(go),script_file_id:Ee,software_id:Ee},ihm_multi_state_modeling:{state_id:Ee,state_group_id:Ee,population_fraction:$r,population_fraction_sd:$r,state_type:se,state_name:se,experiment_type:Wt(se),details:se},ihm_modeling_post_process:{id:Ee,protocol_id:Ee,analysis_id:Ee,step_id:Ee,type:Wt(se),feature:Wt(se),num_models_begin:Ee,num_models_end:Ee},ihm_ensemble_info:{ensemble_id:Ee,ensemble_name:se,post_process_id:Ee,model_group_id:Ee,ensemble_clustering_method:Wt(se),ensemble_clustering_feature:Wt(se),num_ensemble_models:Ee,num_ensemble_models_deposited:Ee,ensemble_precision_value:$r,ensemble_file_id:Ee},ihm_model_list:{model_id:Ee,model_name:se,assembly_id:Ee,protocol_id:Ee,representation_id:Ee},ihm_model_group:{id:Ee,name:se,details:se},ihm_model_group_link:{model_id:Ee,group_id:Ee},ihm_model_representative:{id:Ee,model_group_id:Ee,model_id:Ee,selection_criteria:Wt(se)},ihm_dataset_list:{id:Ee,data_type:Wt(se),database_hosted:Wt(go)},ihm_dataset_group:{id:Ee,name:se,application:Wt(se),details:se},ihm_dataset_group_link:{dataset_list_id:Ee,group_id:Ee},ihm_related_datasets:{dataset_list_id_derived:Ee,dataset_list_id_primary:Ee},ihm_dataset_related_db_reference:{id:Ee,dataset_list_id:Ee,db_name:Wt(se),accession_code:se,version:se,details:se},ihm_external_reference_info:{reference_id:Ee,reference_provider:se,reference_type:Wt(se),reference:se,refers_to:Wt(se),associated_url:se},ihm_external_files:{id:Ee,reference_id:Ee,file_path:se,content_type:Wt(se),file_size_bytes:$r,details:se},ihm_dataset_external_reference:{id:Ee,dataset_list_id:Ee,file_id:Ee},ihm_localization_density_files:{id:Ee,file_id:Ee,ensemble_id:Ee,entity_id:se,entity_poly_segment_id:Ee,asym_id:se},ihm_predicted_contact_restraint:{id:Ee,group_id:Ee,entity_id_1:se,entity_id_2:se,asym_id_1:se,asym_id_2:se,comp_id_1:se,comp_id_2:se,seq_id_1:Ee,seq_id_2:Ee,rep_atom_1:Wt(se),rep_atom_2:Wt(se),distance_lower_limit:$r,distance_upper_limit:$r,probability:$r,restraint_type:Wt(se),model_granularity:Wt(se),dataset_list_id:Ee,software_id:Ee},ihm_cross_link_list:{id:Ee,group_id:Ee,entity_description_1:se,entity_description_2:se,entity_id_1:se,entity_id_2:se,comp_id_1:se,comp_id_2:se,seq_id_1:Ee,seq_id_2:Ee,linker_type:Wt(se),dataset_list_id:Ee},ihm_cross_link_restraint:{id:Ee,group_id:Ee,entity_id_1:se,entity_id_2:se,asym_id_1:se,asym_id_2:se,comp_id_1:se,comp_id_2:se,seq_id_1:Ee,seq_id_2:Ee,atom_id_1:se,atom_id_2:se,restraint_type:Wt(se),conditional_crosslink_flag:Wt(se),model_granularity:Wt(se),distance_threshold:$r,psi:$r,sigma_1:$r,sigma_2:$r},ihm_cross_link_result_parameters:{id:Ee,restraint_id:Ee,model_id:Ee,psi:$r,sigma_1:$r,sigma_2:$r},ihm_2dem_class_average_restraint:{id:Ee,dataset_list_id:Ee,number_raw_micrographs:Ee,pixel_size_width:$r,pixel_size_height:$r,image_resolution:$r,image_segment_flag:Wt(go),number_of_projections:Ee,struct_assembly_id:Ee,details:se},ihm_2dem_class_average_fitting:{id:Ee,restraint_id:Ee,model_id:Ee,cross_correlation_coefficient:$r,rot_matrix:ix(3,3),tr_vector:yM(3)},ihm_3dem_restraint:{id:Ee,dataset_list_id:Ee,model_id:Ee,struct_assembly_id:Ee,fitting_method:se,number_of_gaussians:Ee,cross_correlation_coefficient:$r},ihm_sas_restraint:{id:Ee,dataset_list_id:Ee,model_id:Ee,struct_assembly_id:Ee,profile_segment_flag:Wt(go),fitting_atom_type:se,fitting_method:se,fitting_state:Wt(se),radius_of_gyration:$r,chi_value:$r,details:se},ihm_starting_model_coord:{ordinal_id:Ee,starting_model_id:se,group_PDB:Wt(se),id:Ee,type_symbol:se,entity_id:se,atom_id:se,comp_id:se,seq_id:Ee,asym_id:se,Cartn_x:$r,Cartn_y:$r,Cartn_z:$r,B_iso_or_equiv:$r},ihm_sphere_obj_site:{id:Ee,entity_id:se,seq_id_begin:Ee,seq_id_end:Ee,asym_id:se,Cartn_x:$r,Cartn_y:$r,Cartn_z:$r,object_radius:$r,rmsf:$r,model_id:Ee},ihm_gaussian_obj_site:{id:Ee,entity_id:se,seq_id_begin:Ee,seq_id_end:Ee,asym_id:se,mean_Cartn_x:$r,mean_Cartn_y:$r,mean_Cartn_z:$r,weight:$r,covariance_matrix:ix(3,3),model_id:Ee},ihm_gaussian_obj_ensemble:{id:Ee,entity_id:se,seq_id_begin:Ee,seq_id_end:Ee,asym_id:se,mean_Cartn_x:$r,mean_Cartn_y:$r,mean_Cartn_z:$r,weight:$r,covariance_matrix:ix(3,3),ensemble_id:Ee},ihm_feature_list:{feature_id:Ee,feature_type:Wt(se),entity_type:Wt(se)},ihm_poly_residue_feature:{ordinal_id:Ee,feature_id:Ee,entity_id:se,asym_id:se,comp_id_begin:se,comp_id_end:se,seq_id_begin:Ee,seq_id_end:Ee},ihm_derived_distance_restraint:{id:Ee,group_id:Ee,feature_id_1:Ee,feature_id_2:Ee,group_conditionality:Wt(se),random_exclusion_fraction:$r,distance_upper_limit:$r,restraint_type:Wt(se),dataset_list_id:Ee},ma_model_list:{ordinal_id:Ee,model_id:Ee,model_group_id:Ee,model_name:se,model_group_name:se,model_type:Wt(se),data_id:Ee},ma_target_entity:{entity_id:se,data_id:Ee,origin:Wt(se)},ma_target_entity_instance:{asym_id:se,entity_id:se,details:se},ma_target_ref_db_details:{target_entity_id:se,db_name:Wt(se),db_code:se,db_accession:se,seq_db_isoform:se,seq_db_align_begin:se,seq_db_align_end:se,ncbi_taxonomy_id:se,organism_scientific:se},ma_data:{id:Ee,content_type:Wt(se),content_type_other_details:se,name:se},ma_software_group:{ordinal_id:Ee,group_id:Ee,software_id:Ee},ma_qa_metric:{id:Ee,name:se,type:Wt(se),mode:Wt(se),software_group_id:Ee},ma_qa_metric_global:{ordinal_id:Ee,model_id:Ee,metric_id:Ee,metric_value:$r},ma_qa_metric_local:{ordinal_id:Ee,model_id:Ee,label_asym_id:se,label_seq_id:Ee,label_comp_id:se,metric_id:Ee,metric_value:$r},ma_qa_metric_local_pairwise:{ordinal_id:Ee,model_id:Ee,label_asym_id_1:se,label_seq_id_1:Ee,label_comp_id_1:se,label_asym_id_2:se,label_seq_id_2:Ee,label_comp_id_2:se,metric_id:Ee,metric_value:$r}};var tle="0.3.0",Wn;(o=>{let e;(m=>(m[m.Int8=1]="Int8",m[m.Int16=2]="Int16",m[m.Int32=3]="Int32",m[m.Uint8=4]="Uint8",m[m.Uint16=5]="Uint16",m[m.Uint32=6]="Uint32"))(e=o.IntDataType||={});let t;(s=>(s[s.Float32=32]="Float32",s[s.Float64=33]="Float64"))(t=o.FloatDataType||={});function r(i){let a;return i instanceof Int8Array?a=1:i instanceof Int16Array?a=2:i instanceof Int32Array?a=3:i instanceof Uint8Array?a=4:i instanceof Uint16Array?a=5:i instanceof Uint32Array?a=6:i instanceof Float32Array?a=32:i instanceof Float64Array?a=33:a=3,a}o.getDataType=r;function n(i){if(i instanceof Int8Array||i instanceof Int16Array||i instanceof Int32Array)return!0;for(let a=0,s=i.length;a<s;a++)if(a<0)return!1;return!0}o.isSignedIntegerDataType=n})(Wn||={});var rle=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function nle(e,t){let r=new ArrayBuffer(e.length),n=new Uint8Array(r);for(let o=0,i=e.length;o<i;o+=t)for(let a=0;a<t;a++)n[o+t-a-1]=e[o+a];return r}var N9=28672;function ole(e){if(e.length>N9){let t=[];for(let r=0;r<e.length;r+=N9)t.push(String.fromCharCode.apply(null,e.subarray(r,r+N9)));return t.join("")}else return String.fromCharCode.apply(null,e)}function kv(e){let t=e.data;for(let r=e.encoding.length-1;r>=0;r--)t=xNe(t,e.encoding[r]);return t}function xNe(e,t){switch(t.kind){case"ByteArray":switch(t.type){case Wn.IntDataType.Uint8:return e;case Wn.IntDataType.Int8:return CNe(e);case Wn.IntDataType.Int16:return SNe(e);case Wn.IntDataType.Uint16:return vNe(e);case Wn.IntDataType.Int32:return INe(e);case Wn.IntDataType.Uint32:return ANe(e);case Wn.FloatDataType.Float32:return TNe(e);case Wn.FloatDataType.Float64:return PNe(e);default:Rr(t.type)}case"FixedPoint":return _Ne(e,t);case"IntervalQuantization":return RNe(e,t);case"RunLength":return DNe(e,t);case"Delta":return wNe(e,t);case"IntegerPacking":return BNe(e,t);case"StringArray":return kNe(e,t)}}function ile(e,t){switch(e){case Wn.IntDataType.Int8:return new Int8Array(t);case Wn.IntDataType.Int16:return new Int16Array(t);case Wn.IntDataType.Int32:return new Int32Array(t);case Wn.IntDataType.Uint8:return new Uint8Array(t);case Wn.IntDataType.Uint16:return new Uint16Array(t);case Wn.IntDataType.Uint32:return new Uint32Array(t);default:return new Int32Array(t)}}function ale(e,t){switch(e){case Wn.FloatDataType.Float32:return new Float32Array(t);case Wn.FloatDataType.Float64:return new Float64Array(t);default:return new Float64Array(t)}}function CNe(e){return new Int8Array(e.buffer,e.byteOffset)}function Lv(e,t,r){return rle?new r(e.buffer):new r(nle(e,t))}function SNe(e){return Lv(e,2,Int16Array)}function vNe(e){return Lv(e,2,Uint16Array)}function INe(e){return Lv(e,4,Int32Array)}function ANe(e){return Lv(e,4,Uint32Array)}function TNe(e){return Lv(e,4,Float32Array)}function PNe(e){return Lv(e,8,Float64Array)}function _Ne(e,t){let r=e.length,n=ale(t.srcType,r),o=1/t.factor;for(let i=0;i<r;i++)n[i]=o*e[i];return n}function RNe(e,t){let r=e.length,n=ale(t.srcType,r),o=(t.max-t.min)/(t.numSteps-1),i=t.min;for(let a=0;a<r;a++)n[a]=i+o*e[a];return n}function DNe(e,t){let r=ile(t.srcType,t.srcSize),n=0;for(let o=0,i=e.length;o<i;o+=2){let a=e[o],s=e[o+1];for(let l=0;l<s;++l)r[n++]=a}return r}function wNe(e,t){let r=e.length,n=ile(t.srcType,r);if(!r)return e;n[0]=e[0]+(t.origin|0);for(let o=1;o<r;++o)n[o]=e[o]+n[o-1];return n}function ENe(e,t){let r=t.byteCount===1?127:32767,n=-r-1,o=e.length,i=new Int32Array(t.srcSize),a=0,s=0;for(;a<o;){let l=0,u=e[a];for(;u===r||u===n;)l+=u,a++,u=e[a];l+=u,i[s]=l,a++,s++}return i}function MNe(e,t){let r=t.byteCount===1?255:65535,n=e.length,o=new Int32Array(t.srcSize),i=0,a=0;for(;i<n;){let s=0,l=e[i];for(;l===r;)s+=l,i++,l=e[i];s+=l,o[a]=s,i++,a++}return o}function BNe(e,t){return e.length===t.srcSize?e:t.isUnsigned?MNe(e,t):ENe(e,t)}function kNe(e,t){let r=kv({encoding:t.offsetEncoding,data:t.offsets}),n=kv({encoding:t.dataEncoding,data:e}),o=t.stringData,i=new Array(r.length);i[0]="";for(let l=1,u=r.length;l<u;l++)i[l]=o.substring(r[l-1],r[l]);let a=0,s=new Array(n.length);for(let l=0,u=n.length;l<u;l++)s[a++]=i[n[l]+1];return s}function LNe(e,t,r){let n=1,o;for(o=0;o<t;o++){let i=n*e;if(Math.abs(Math.round(i)-i)<=r)return o;n*=10}return-1}function sle(e,t){return Math.abs(e)<t?0:Math.floor(Math.log10(Math.abs(e)))+1}function lle(e,t,r){let n=1,o=0;for(let i=0,a=e.length;i<a;i++){if(n>=0){let l=LNe(e[i],t,r);l<0?n=-1:l>n&&(n=l)}let s=Math.abs(e[i]);if(s>r){let l=Math.floor(Math.log10(Math.abs(s)))+1;l>o&&(o=l)}}return{mantissaDigits:n,integerDigits:o}}function ule(e){e=e.trim();let t=parseInt(e,10);return isNaN(t)?!1:t.toString()===e}function U0(e){if(!isFinite(e))return 0;let t=1,r=0;for(;Math.round(e*t)/t!==e;)t*=10,++r;return r}function N2(e,t){return parseFloat(e.toPrecision(t))}function z2(e){return bM.classify(e)}function cle(e){return mle.classify(e)}var bM;(d=>{function e(p,h){return p>=0?Math.ceil((p+1)/h):Math.ceil((p+1)/(-h-1))}function t(p){let h=!1;for(let f=0,y=p.length;f<y;f++)if(p[f]<0){h=!0;break}return h?{signed:h,limit8:127,limit16:32767}:{signed:h,limit8:255,limit16:65535}}function r(){return{pack8:0,pack16:0,count:0}}function n({limit8:p,limit16:h},f,y){f.pack8+=e(y,p),f.pack16+=e(y,h),f.count+=1}function o(p,h){p.pack8+=e(h,127),p.pack16+=e(h,32767),p.count+=1}function i(p){return p.count*4<p.pack16*2?{length:p.count*4,elem:4}:p.pack16*2<p.pack8?{length:p.pack16*2,elem:2}:{length:p.pack8,elem:1}}function a(p,h){let f=r();for(let y=0,g=p.length;y<g;y++)n(h,f,p[y]);return{...i(f),kind:"pack"}}function s(p,h){let f=r(),y=p[0];for(let g=1,x=p.length;g<x;g++)o(f,p[g]-y),y=p[g];return{...i(f),kind:"delta"}}function l(p,h){let f=r(),y=1;for(let g=1,x=p.length;g<x;g++)p[g-1]!==p[g]?(n(h,f,p[g-1]),n(h,f,y),y=1):y++;return n(h,f,p[p.length-1]),n(h,f,y),{...i(f),kind:"rle"}}function u(p,h){let f=r(),y=1,g=0,x=0;for(let S=1,I=p.length;S<I;S++){let v=p[S]-g;x!==v?(o(f,x),o(f,y),y=1):y++,x=v,g=p[S]}return o(f,x),o(f,y),{...i(f),kind:"delta-rle"}}function c(p){let h=t(p),f=[a(p,h),l(p,h),s(p,h),u(p,h)];return f.sort((y,g)=>y.length-g.length),f}d.getSize=c;function m(p){if(p.length<2)return fn.by(fn.byteArray);let f=c(p)[0];switch(f.kind){case"pack":return fn.by(fn.integerPacking);case"rle":return fn.by(fn.runLength).and(fn.integerPacking);case"delta":return fn.by(fn.delta).and(fn.integerPacking);case"delta-rle":return fn.by(fn.delta).and(fn.runLength).and(fn.integerPacking);default:Rr(f)}}d.classify=m})(bM||={});var mle;(n=>{function t(o){let{mantissaDigits:a,integerDigits:s}=lle(o,4,1e-6);if(a<0||a+s>10)return fn.by(fn.byteArray);if(a===0)return bM.classify(o);let l=r(a),u=new Int32Array(o.length);for(let p=0,h=o.length;p<h;p++)u[p]=Math.round(l*o[p]);let m=bM.getSize(u)[0],d=fn.by(fn.fixedPoint(l));switch(m.kind){case"pack":return d.and(fn.integerPacking);case"rle":return d.and(fn.runLength).and(fn.integerPacking);case"delta":return d.and(fn.delta).and(fn.integerPacking);case"delta-rle":return d.and(fn.delta).and(fn.runLength).and(fn.integerPacking);default:Rr(m)}}n.classify=t;function r(o){let i=1;for(let a=0;a<o;a++)i*=10;return i}})(mle||={});var xM=class e{constructor(t){this.providers=t}and(t){return new e(this.providers.concat([t]))}encode(t){let r=[];for(let n of this.providers){let o=n(t);if(!o.encodings.length)throw new Error("Encodings must be non-empty.");t=o.data;for(let i of o.encodings)r.push(i)}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:r,data:t}}},fh;(n=>{function e(o){return new xM([o])}n.by=e;function t(o){let i=e(r(o[0]));for(let a=1;a<o.length&&o[a-1].kind!=="IntegerPacking";a++)i=i.and(r(o[a]));return i}n.fromEncoding=t;function r(o){switch(o.kind){case"ByteArray":return fn.byteArray;case"FixedPoint":return fn.fixedPoint(o.factor);case"IntervalQuantization":return fn.intervalQuantizaiton(o.min,o.max,o.numSteps);case"RunLength":return fn.runLength;case"Delta":return fn.delta;case"IntegerPacking":return fn.integerPacking;case"StringArray":return fn.stringArray}}})(fh||={});var fn;(S=>{function e(I){return new xM([I])}S.by=e;function t(I){return{encodings:[{kind:"ByteArray",type:Wn.IntDataType.Uint8}],data:I}}function r(I){return{encodings:[{kind:"ByteArray",type:Wn.IntDataType.Int8}],data:new Uint8Array(I.buffer,I.byteOffset)}}let n={[Wn.IntDataType.Int16]:function(I,v,A){I.setInt16(2*v,A,!0)},[Wn.IntDataType.Uint16]:function(I,v,A){I.setUint16(2*v,A,!0)},[Wn.IntDataType.Int32]:function(I,v,A){I.setInt32(4*v,A,!0)},[Wn.IntDataType.Uint32]:function(I,v,A){I.setUint32(4*v,A,!0)},[Wn.FloatDataType.Float32]:function(I,v,A){I.setFloat32(4*v,A,!0)},[Wn.FloatDataType.Float64]:function(I,v,A){I.setFloat64(8*v,A,!0)}},o={[Wn.IntDataType.Int16]:2,[Wn.IntDataType.Uint16]:2,[Wn.IntDataType.Int32]:4,[Wn.IntDataType.Uint32]:4,[Wn.FloatDataType.Float32]:4,[Wn.FloatDataType.Float64]:8};function i(I){let v=Wn.getDataType(I);if(v===Wn.IntDataType.Int8)return r(I);if(v===Wn.IntDataType.Uint8)return t(I);let A=new Uint8Array(I.length*o[v]),_=n[v],T=new DataView(A.buffer);for(let w=0,D=I.length;w<D;w++)_(T,w,I[w]);return{encodings:[{kind:"ByteArray",type:v}],data:A}}S.byteArray=i;function a(I,v){let A=Wn.getDataType(I),_=new Int32Array(I.length);for(let T=0,w=I.length;T<w;T++)_[T]=Math.round(I[T]*v);return{encodings:[{kind:"FixedPoint",factor:v,srcType:A}],data:_}}function s(I){return v=>a(v,I)}S.fixedPoint=s;function l(I,v,A,_,T){let w=Wn.getDataType(I);if(!I.length)return{encodings:[{kind:"IntervalQuantization",min:v,max:A,numSteps:_,srcType:w}],data:new Int32Array(0)};if(A<v){let E=v;v=A,A=E}let D=(A-v)/(_-1),M=new T(I.length);for(let E=0,R=I.length;E<R;E++){let k=I[E];k<=v?M[E]=0:k>=A?M[E]=_-1:M[E]=Math.round((k-v)/D)|0}return{encodings:[{kind:"IntervalQuantization",min:v,max:A,numSteps:_,srcType:w}],data:M}}function u(I,v,A,_=Int32Array){return T=>l(T,I,v,A,_)}S.intervalQuantizaiton=u;function c(I){let v=Wn.getDataType(I);if(v===void 0&&(I=new Int32Array(I),v=Wn.IntDataType.Int32),!I.length)return{encodings:[{kind:"RunLength",srcType:v,srcSize:0}],data:new Int32Array(0)};let A=2;for(let D=1,M=I.length;D<M;D++)I[D-1]!==I[D]&&(A+=2);let _=new Int32Array(A),T=0,w=1;for(let D=1,M=I.length;D<M;D++)I[D-1]!==I[D]?(_[T]=I[D-1],_[T+1]=w,w=1,T+=2):++w;return _[T]=I[I.length-1],_[T+1]=w,{encodings:[{kind:"RunLength",srcType:v,srcSize:I.length}],data:_}}S.runLength=c;function m(I){if(!Wn.isSignedIntegerDataType(I))throw new Error("Only signed integer types can be encoded using delta encoding.");let v=Wn.getDataType(I);if(v===void 0&&(I=new Int32Array(I),v=Wn.IntDataType.Int32),!I.length)return{encodings:[{kind:"Delta",origin:0,srcType:v}],data:new I.constructor(0)};let A=new I.constructor(I.length),_=I[0];A[0]=I[0];for(let T=1,w=I.length;T<w;T++)A[T]=I[T]-I[T-1];return A[0]=0,{encodings:[{kind:"Delta",origin:_,srcType:v}],data:A}}S.delta=m;function d(I){for(let v=0,A=I.length;v<A;v++)if(I[v]<0)return!0;return!1}function p(I,v){let A=0;for(let _=0,T=I.length;_<T;_++)A+=I[_]/v|0;return A+=I.length,A}function h(I,v){let A=-v-1,_=0;for(let T=0,w=I.length;T<w;T++){let D=I[T];D>=0?_+=D/v|0:_+=D/A|0}return _+=I.length,_}function f(I){let v=d(I),A=v?h(I,127):p(I,255),_=v?h(I,32767):p(I,65535);return I.length*4<_*2?{isSigned:v,size:I.length,bytesPerElement:4}:_*2<A?{isSigned:v,size:_,bytesPerElement:2}:{isSigned:v,size:A,bytesPerElement:1}}function y(I,v){let A=v.isSigned?v.bytesPerElement===1?127:32767:v.bytesPerElement===1?255:65535,_=-A-1,T=I.length,w=v.isSigned?v.bytesPerElement===1?new Int8Array(v.size):new Int16Array(v.size):v.bytesPerElement===1?new Uint8Array(v.size):new Uint16Array(v.size),D=0;for(let E=0;E<T;E++){let R=I[E];if(R>=0)for(;R>=A;)w[D]=A,++D,R-=A;else for(;R<=_;)w[D]=_,++D,R-=_;w[D]=R,++D}let M=i(w);return{encodings:[{kind:"IntegerPacking",byteCount:v.bytesPerElement,isUnsigned:!v.isSigned,srcSize:T},M.encodings[0]],data:M.data}}function g(I){let v=f(I);return v.bytesPerElement===4?i(I):y(I,v)}S.integerPacking=g;function x(I){let v=Object.create(null),A=[],_=new Int32Array(I.length),T=Qe.create(Int32Array,1,Math.min(1024,I.length<32?I.length+1:Math.round(I.length/8)+1));Qe.add(T,0);let w=0,D=0;for(let L of I){if(L==null){_[D++]=-1;continue}let V=v[L];V===void 0&&(w+=L.length,V=A.length,A[V]=L,v[L]=V,Qe.add(T,w)),_[D++]=V}let M=Qe.compact(T),R=z2(M).encode(M),B=z2(_).encode(_);return{encodings:[{kind:"StringArray",dataEncoding:B.encoding,stringData:A.join(""),offsetEncoding:R.encoding,offsets:R.data}],data:B.data}}S.stringArray=x})(fn||={});var Uu;(s=>{let e;(m=>(m[m.Str=0]="Str",m[m.Int=1]="Int",m[m.Float=2]="Float"))(e=s.Type||={});function t(l,u,c){return{name:l,type:0,value:u,valueKind:c&&c.valueKind,defaultFormat:c&&c.encoder?{encoder:c.encoder}:void 0,shouldInclude:c&&c.shouldInclude}}s.str=t;function r(l,u,c){return{name:l,type:1,value:u,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray}:void 0,shouldInclude:c&&c.shouldInclude}}s.int=r;function n(l,u,c){return{name:l,type:2,value:u,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray,digitCount:typeof c.digitCount<"u"?c.digitCount:void 0}:void 0,shouldInclude:c&&c.shouldInclude}}s.float=n;function o(l){return r(l,(u,c,m)=>m+1,{typedArray:Int32Array,encoder:fn.by(fn.delta).and(fn.runLength).and(fn.integerPacking)})}s.index=o;class i{constructor(){this.fields=[]}index(u){return this.fields.push(s.index(u)),this}str(u,c,m){return this.fields.push(s.str(u,c,m)),this}int(u,c,m){return this.fields.push(s.int(u,c,m)),this}vec(u,c,m){for(let d=0;d<c.length;d++)this.fields.push(s.int(`${u}[${d+1}]`,c[d],m));return this}float(u,c,m){return this.fields.push(s.float(u,c,m)),this}many(u){for(let c=0;c<u.length;c++)this.fields.push(u[c]);return this}add(u){return this.fields.push(u),this}getFields(){return this.fields}}s.Builder=i;function a(){return new i}s.build=a})(Uu||={});var Sc;(i=>{i.Empty={fields:[],source:[]};function t(a){let s=[],l=[],u=[],c=[];for(let d of a.split(/[\r\n]+/)){if(d=d.trim(),d.length===0)continue;let p=/^!/.test(d);p&&(d=d.substr(1));let h=d.split(/\./),f=h[1],y=p?f?c:l:f?u:s;y[y.length]=d,f&&!s.includes(h[0])&&(s[s.length]=h[0])}let m=u.map(d=>d.split(".")[0]);return{includeCategory(d){return l.includes(d)?!1:s.length<=0||s.indexOf(d)!==-1},includeField(d,p){let h=d+"."+p;return c.includes(h)?!1:!m.includes(d)||u.includes(h)}}}i.filterOf=t,i.DefaultFilter={includeCategory(a){return!0},includeField(a,s){return!0}},i.DefaultFormatter={getFormat(a,s){}};function o(a,s){return s?{fields:dle(a._schema),source:[{data:a,rowCount:s.length,keys:()=>n0.Array(s)}]}:{fields:dle(a._schema),source:[{data:a,rowCount:a._rowCount}]}}i.ofTable=o})(Sc||={});var j9;(r=>{function e(n,o,i){n.startDataBlock(o);for(let a of i._tableNames)n.writeCategory({name:a,instance:()=>Sc.ofTable(i[a])})}r.writeDatabase=e;function t(n,o){for(let i of Object.keys(o))e(n,i,o[i])}r.writeDatabaseCollection=t})(j9||={});function z9(e){return(t,r)=>r[e].value(t)}function FNe(e){return(t,r)=>r[e].value(t).join(r[e].schema.separator)}function H9(e,...t){return(r,n)=>n[e].schema.space.get(n[e].value(r),...t)}function H2(e){return(t,r)=>r[e].valueKind(t)}function VNe(e,t){let r=[],n=2,o=H2(e);if(t.rank===1){let i=t.dimensions[0];for(let a=0;a<i;a++){let s=`${e}[${a+1}]`;r.push({name:s,type:n,value:H9(e,a),valueKind:o})}}else if(t.rank===2){let i=t.dimensions[0],a=t.dimensions[1];for(let s=0;s<i;s++)for(let l=0;l<a;l++){let u=`${e}[${s+1}][${l+1}]`;r.push({name:u,type:n,value:H9(e,s,l),valueKind:o})}}else if(t.rank===3){let i=t.dimensions[0],a=t.dimensions[1],s=t.dimensions[2];for(let l=0;l<i;l++)for(let u=0;u<a;u++)for(let c=0;c<s;c++){let m=`${e}[${l+1}][${u+1}][${c+1}]`;r.push({name:m,type:n,value:H9(e,l,u,c),valueKind:o})}}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return r}function dle(e){let t=[];for(let r of Object.keys(e)){let n=e[r];n.valueType==="int"?t.push({name:r,type:1,value:z9(r),valueKind:H2(r)}):n.valueType==="float"?t.push({name:r,type:2,value:z9(r),valueKind:H2(r)}):n.valueType==="str"?t.push({name:r,type:0,value:z9(r),valueKind:H2(r)}):n.valueType==="list"?t.push({name:r,type:0,value:FNe(r),valueKind:H2(r)}):n.valueType==="tensor"?t.push(...VNe(r,n.space)):Rr(n.valueType)}return t}function ple(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount<"u"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function j2(e){return e.fields.some(t=>!!t.shouldInclude)?e.fields.filter(t=>!t.shouldInclude||e.source.some(r=>t.shouldInclude(r.data))):e.fields}function CM(e,t){let r=e.instance(t),n=r.source.filter(a=>a.rowCount>0);if(!n.length)return{instance:r,rowCount:0,source:[]};let o=n.reduce((a,s)=>a+s.rowCount,0),i=n.map(a=>({data:a.data,keys:()=>a.keys?a.keys():n0.Range(0,a.rowCount-1),rowCount:a.rowCount}));return{instance:r,rowCount:o,source:i}}var vM=class{constructor(){this.builder=Hn.create();this.encoded=!1;this.dataBlockCreated=!1;this.filter=Sc.DefaultFilter;this.formatter=Sc.DefaultFormatter;this.isBinary=!1;this.binaryEncodingProvider=void 0}setFilter(t){this.filter=t||Sc.DefaultFilter}isCategoryIncluded(t){return this.filter.includeCategory(t)}setFormatter(t){this.formatter=t||Sc.DefaultFormatter}startDataBlock(t){this.dataBlockCreated=!0,Hn.write(this.builder,`data_${(t||"").replace(/[ \n\t]/g,"").toUpperCase()}
#
`)}writeCategory(t,r,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(!n?.ignoreFilter&&!this.filter.includeCategory(t.name))return;let{instance:o,rowCount:i,source:a}=CM(t,r);i&&(i===1?GNe(t,o,a,this.builder,this.filter,this.formatter):UNe(t,o,a,this.builder,this.filter,this.formatter))}encode(){this.encoded=!0}writeTo(t){let r=Hn.getChunks(this.builder);for(let n=0,o=r.length;n<o;n++)t.writeString(r[n])}getSize(){return Hn.getSize(this.builder)}getData(){return Hn.getString(this.builder)}};function hle(e,t,r,n,o,i){let a=n.valueKind,s=a?a(r,t):H.ValueKinds.Present;if(s!==H.ValueKinds.Present)s===H.ValueKinds.NotPresent?jNe(e):WNe(e);else{let l=n.value(r,t,i),u=n.type;if(u===Uu.Type.Str)return NNe(l)?(SM(e,l),!0):XNe(e,l);u===Uu.Type.Int?zNe(e,l):HNe(e,l,o)}return!1}function gle(e,t,r){let n=[];for(let o of t){let i=r.getFormat(e,o.name);i&&typeof i.digitCount<"u"?n[n.length]=o.type===Uu.Type.Float?Math.pow(10,Math.max(0,Math.min(i.digitCount,15))):0:n[n.length]=o.type===Uu.Type.Float?Math.pow(10,ple(o)):0}return n}function GNe(e,t,r,n,o,i){let a=j2(t),s=r[0],l=s.data,u=a.reduce((p,h)=>o.includeField(e.name,h.name)?Math.max(p,h.name.length):0,0);if(u===0)return;u+=e.name.length+6;let m=s.keys().move(),d=gle(e.name,t.fields,i);for(let p=0;p<a.length;p++){let h=a[p];if(!o.includeField(e.name,h.name))continue;Hn.writePadRight(n,`_${e.name}.${h.name}`,u),hle(n,l,m,h,d[p],0)||Hn.newline(n)}Hn.write(n,`#
`)}function UNe(e,t,r,n,o,i){let a=j2(t),s=o===Sc.DefaultFilter?a:a.filter(m=>o.includeField(e.name,m.name)),l=s.length;if(l===0)return;let u=gle(e.name,s,i);fle(n,"loop_");for(let m=0;m<l;m++)fle(n,`_${e.name}.${s[m].name}`);let c=0;for(let m=0;m<r.length;m++){let d=r[m],p=d.data;if(d.rowCount===0)continue;let h=d.keys();for(;h.hasNext;){let f=h.move(),y=!1;for(let g=0;g<l;g++)y=hle(n,p,f,s[g],u[g],c);y||Hn.newline(n),c++}}Hn.write(n,`#
`)}function NNe(e){return typeof e=="string"&&e.indexOf(`
`)>=0}function fle(e,t){Hn.write(e,t),Hn.newline(e)}function zNe(e,t){Hn.writeInteger(e,t),Hn.whitespace1(e)}function HNe(e,t,r){Hn.writeFloat(e,t,r),Hn.whitespace1(e)}function jNe(e){Hn.writeSafe(e,". ")}function WNe(e){Hn.writeSafe(e,"? ")}function XNe(e,t){if(!t)return Hn.writeSafe(e,". "),!1;let r=t.charCodeAt(0),n=!1,o=0,i=!1,a=!1;for(let s=0,l=t.length-1;s<=l;s++)switch(t.charCodeAt(s)){case 9:n=!0;break;case 10:return SM(e,t),!0;case 32:n=!0;break;case 34:if(s&&s===l)break;if(i)return SM(e,t),!0;a=!0,n=!0,o=0;break;case 39:if(s&&s===l)break;if(a)return SM(e,t),!0;i=!0,n=!0,o=1;break}return!n&&(r===35||r===36||r===59||r===91||r===93||r===95)&&(n=!0),n?(Hn.writeSafe(e,o?'"':"'"),Hn.writeSafe(e,t),Hn.writeSafe(e,o?'" ':"' ")):(Hn.writeSafe(e,t),Hn.writeSafe(e," ")),!1}function SM(e,t){Hn.writeSafe(e,`
;`+t),Hn.writeSafe(e,`
;
`)}function yle(e){let t=new ArrayBuffer(IM(e)),r=new DataView(t),n=new Uint8Array(t);return AM(e,r,n,0),n}function IM(e){let t=typeof e;if(t==="string"){let r=bv(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){let r=e.byteLength;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(t==="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(t==="boolean"||e===null||e===void 0)return 1;if(t==="object"){let r,n=0;if(Array.isArray(e)){r=e.length;for(let o=0;o<r;o++)n+=IM(e[o])}else{let o=Object.keys(e);r=o.length;for(let i=0;i<r;i++){let a=o[i];n+=IM(a)+IM(e[a])}}if(r<16)return 1+n;if(r<65536)return 3+n;if(r<4294967296)return 5+n;throw new Error("Array or object too long 0x"+r.toString(16))}throw new Error("Unknown type "+t)}function AM(e,t,r,n){let o=typeof e;if(o==="string"){let i=bv(e);if(i<32)return t.setUint8(n,i|160),qb(r,n+1,e),1+i;if(i<256)return t.setUint8(n,217),t.setUint8(n+1,i),qb(r,n+2,e),2+i;if(i<65536)return t.setUint8(n,218),t.setUint16(n+1,i),qb(r,n+3,e),3+i;if(i<4294967296)return t.setUint8(n,219),t.setUint32(n+1,i),qb(r,n+5,e),5+i}if(e instanceof Uint8Array){let i=e.byteLength,a=new Uint8Array(t.buffer);if(i<256)return t.setUint8(n,196),t.setUint8(n+1,i),a.set(e,n+2),2+i;if(i<65536)return t.setUint8(n,197),t.setUint16(n+1,i),a.set(e,n+3),3+i;if(i<4294967296)return t.setUint8(n,198),t.setUint32(n+1,i),a.set(e,n+5),5+i}if(o==="number"){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(e==null)return t.setUint8(n,192),1;if(o==="boolean")return t.setUint8(n,e?195:194),1;if(o==="object"){let i,a=0,s=Array.isArray(e),l;if(s?i=e.length:(l=Object.keys(e),i=l.length),i<16?(t.setUint8(n,i|(s?144:128)),a=1):i<65536?(t.setUint8(n,s?220:222),t.setUint16(n+1,i),a=3):i<4294967296&&(t.setUint8(n,s?221:223),t.setUint32(n+1,i),a=5),s)for(let u=0;u<i;u++)a+=AM(e[u],t,r,n+a);else for(let u=0,c=l.length;u<c;u++){let m=l[u];a+=AM(m,t,r,n+a),a+=AM(e[m],t,r,n+a)}return a}throw new Error("Unknown type "+o)}var TM=class{constructor(t,r,n){this.autoClassify=n;this.dataBlocks=[];this.filter=Sc.DefaultFilter;this.formatter=Sc.DefaultFormatter;this.isBinary=!0;this.binaryEncodingProvider=void 0;this.binaryEncodingProvider=r,this.data={encoder:t,version:tle,dataBlocks:this.dataBlocks}}setFilter(t){this.filter=t||Sc.DefaultFilter}isCategoryIncluded(t){return this.filter.includeCategory(t)}setFormatter(t){this.formatter=t||Sc.DefaultFormatter}startDataBlock(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})}writeCategory(t,r,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(!n?.ignoreFilter&&!this.filter.includeCategory(t.name))return;let{instance:o,rowCount:i,source:a}=CM(t,r);if(!i)return;let s={name:"_"+t.name,columns:[],rowCount:i},l=j2(o);for(let u of l){if(!this.filter.includeField(t.name,u.name))continue;let c=this.formatter.getFormat(t.name,u.name);s.columns.push(KNe(t.name,u,a,i,c,this.binaryEncodingProvider,this.autoClassify))}s.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(s)}encode(){this.encodedData||(this.encodedData=yle(this.data),this.data=null,this.dataBlocks=null)}writeTo(t){t.writeBinary(this.encodedData)}getData(){return this.encode(),this.encodedData}getSize(){return this.encodedData.length}};function QNe(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:e.type===Uu.Type.Str?Array:e.type===Uu.Type.Int?Int32Array:Float64Array}function ZNe(e){return e===Uu.Type.Str?fh.by(fn.stringArray):fh.by(fn.byteArray)}function qNe(e,t,r,n){return r&&r.encoder?r.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:n?n.get(e,t.name):void 0}function YNe(e,t){return e===Uu.Type.Str?fh.by(fn.stringArray):e===Uu.Type.Int?z2(t):cle(t)}function KNe(e,t,r,n,o,i,a){let{array:s,allPresent:l,mask:u}=JNe(t,QNe(t,o),n,r),c;t.type===Uu.Type.Str?c=fh.by(fn.stringArray):c=qNe(e,t,o,i),c||(a?c=YNe(t.type,s):c=ZNe(t.type));let m=c.encode(s),d;if(!l){let p=fh.by(fn.runLength).and(fn.byteArray).encode(u);p.data.length<u.length?d=p:d=fh.by(fn.byteArray).encode(u)}return{name:t.name,data:m,mask:d}}function JNe(e,t,r,n){let o=e.type===Uu.Type.Str,i=new t(r),a=new Uint8Array(r),s=e.valueKind,l=e.value,u=!0,c=0;for(let m=0;m<n.length;m++){let d=n[m].data,p=n[m].keys();for(;p.hasNext;){let h=p.move(),f=s?s(h,d):H.ValueKinds.Present;if(f!==H.ValueKinds.Present)a[c]=f,o&&(i[c]=""),u=!1;else{let y=l(h,d,c);typeof y=="string"&&!y?(a[c]=H.ValueKinds.NotPresent,u=!1):a[c]=H.ValueKinds.Present,i[c]=y}c++}}return{array:i,allPresent:u,mask:a}}var Oi;(d=>{d.Encoder=j9,d.Category=Sc,d.Field=Uu,d.Encoding=fn;function o(p){let{binary:h=!1,encoderName:f="mol*"}=p||{};return h?new TM(f,p?p.binaryEncodingPovider:void 0,p?!!p.binaryAutoClassifyEncoding:!1):new vM}d.createEncoder=o;function i(){return d.Field.build()}d.fields=i;let a=d.Encoding;d.Encodings={deltaRLE:a.by(a.delta).and(a.runLength).and(a.integerPacking),fixedPoint2:a.by(a.fixedPoint(100)).and(a.delta).and(a.integerPacking),fixedPoint3:a.by(a.fixedPoint(1e3)).and(a.delta).and(a.integerPacking)};function l(p,h){return{fields:p,source:[h]}}d.categoryInstance=l;function u(p){return{get(h,f){let y=p.categories[h];if(!y)return;let g=y.getField(f);return g&&g.binaryEncoding?fh.fromEncoding(g.binaryEncoding):void 0}}}d.createEncodingProviderFromCifFrame=u;function c(p){return{get(h,f){for(let y=0;y<p.length;y++){let g=p[y];if(g.categoryName===h&&g.columnName===f)return m(g)}}}}d.createEncodingProviderFromJsonConfig=c;function m(p){let h=p.precision;if(h!==void 0){let f=Math.pow(10,h),y=a.by(a.fixedPoint(f));switch(p.encoding){case"pack":return y.and(a.integerPacking);case"rle":return y.and(a.runLength).and(a.integerPacking);case"delta":return y.and(a.delta).and(a.integerPacking);case"delta-rle":return y.and(a.delta).and(a.runLength).and(a.integerPacking)}}else switch(p.encoding){case"pack":return a.by(a.integerPacking);case"rle":return a.by(a.runLength).and(a.integerPacking);case"delta":return a.by(a.delta).and(a.integerPacking);case"delta-rle":return a.by(a.delta).and(a.runLength).and(a.integerPacking)}throw new Error("cannot be reached")}})(Oi||={});var ax;(i=>{i.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance(a){let s=i.Provider.get(a.firstModel);if(!s)return Oi.Category.Empty;let l=s.data;if(!l)return Oi.Category.Empty;let u=a.structures[0].uniqueResidueNames,{comp_id:c,_rowCount:m}=l,d=[];for(let p=0;p<m;p++)u.has(c.value(p))&&(d[d.length]=p);return Oi.Category.ofTable(l,d)}}]}},i.Provider=ll.create(i.Descriptor);function r(a,s){return Cr.pick(s,an.chem_comp_bond,l=>a.properties.chemicalComponentMap.has(s.comp_id.value(l)))}i.chemCompBondFromTable=r;function n(a){let s=new Map;function l(g){if(s.has(g))return s.get(g);let x=new o(g);return s.set(g,x),x}let{comp_id:u,atom_id_1:c,atom_id_2:m,value_order:d,pdbx_aromatic_flag:p,_rowCount:h,pdbx_ordinal:f}=a,y=l(u.value(0));for(let g=0;g<h;g++){let x=u.value(g),S=c.value(g),I=m.value(g),v=d.value(g),A=p.value(g)==="y",_=f.value(g);y.id!==x&&(y=l(x));let T=ht.Flag.Covalent,w=1;switch(A&&(T|=ht.Flag.Aromatic),v.toLowerCase()){case"delo":T|=ht.Flag.Aromatic;break;case"doub":w=2;break;case"trip":w=3;break;case"quad":w=4;break}y.add(S,I,w,T,_)}return s}i.getEntriesFromChemCompBond=n;class o{constructor(s){this.id=s;this.map=new Map}add(s,l,u,c,m,d=!0){let p=this.map.get(s);if(p!==void 0)p.get(l)===void 0&&p.set(l,{order:u,flags:c,key:m});else{let h=new Map;h.set(l,{order:u,flags:c,key:m}),this.map.set(s,h)}d&&this.add(l,s,u,c,m,!1)}}i.Entry=o})(ax||={});var vc;(a=>{a.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance(s){let l=a.Provider.get(s.firstModel);if(!l||l.entries.length===0)return Oi.Category.Empty;let u=s.structures[0],c=[];for(let m of l.entries)n(u,m.partnerA.atomIndex)&&n(u,m.partnerB.atomIndex)&&(c[c.length]=m.rowIndex);return Oi.Category.ofTable(l.data,c)}}]}},a.Provider=ll.create(a.Descriptor);function r(s){let l=a.Provider.get(s);return!!l&&l.entries.length/s.atomicConformation.atomId.rowCount>.95}a.isExhaustive=r;function n({units:s},l){for(let u=0,c=s.length;u<c;u++)if(Be.indexOf(s[u].elements,l)>=0)return!0;return!1}function o(s){let l=new Map;for(let u of s){let{partnerA:{atomIndex:c},partnerB:{atomIndex:m}}=u;l.has(c)?l.get(c).push(u):l.set(c,[u]),l.has(m)?l.get(m).push(u):l.set(m,[u])}return l}a.getAtomIndexFromEntries=o;function i(s,l){let{conn_type_id:u,pdbx_dist_value:c,pdbx_value_order:m}=s,d={label_asym_id:s.ptnr1_label_asym_id,label_seq_id:s.ptnr1_label_seq_id,auth_seq_id:s.ptnr1_auth_seq_id,label_atom_id:s.ptnr1_label_atom_id,label_alt_id:s.pdbx_ptnr1_label_alt_id,ins_code:s.pdbx_ptnr1_PDB_ins_code,symmetry:s.ptnr1_symmetry},p={label_asym_id:s.ptnr2_label_asym_id,label_seq_id:s.ptnr2_label_seq_id,auth_seq_id:s.ptnr2_auth_seq_id,label_atom_id:s.ptnr2_label_atom_id,label_alt_id:s.pdbx_ptnr2_label_alt_id,ins_code:s.pdbx_ptnr2_PDB_ins_code,symmetry:s.ptnr2_symmetry},h=Array.from(l.entities.data.id.toArray()),f=(g,x)=>{if(x.label_asym_id.valueKind(g)!==H.ValueKinds.Present)return;let S=x.label_asym_id.value(g),I=x.label_atom_id.value(g);if(!I)return;let v=x.auth_seq_id.valueKind(g)===H.ValueKind.Present?x.auth_seq_id.value(g):x.label_seq_id.value(g),A=x.ins_code.value(g),_=x.label_alt_id.value(g);for(let T of h){let w=l.atomicHierarchy.index.findResidue(T,S,v,A);if(w<0)continue;let D=l.atomicHierarchy.index.findAtomOnResidue(w,I,_);if(!(D<0))return{residueIndex:w,atomIndex:D,symmetry:x.symmetry.value(g)}}},y=[];for(let g=0;g<s._rowCount;g++){let x=f(g,d),S=f(g,p);if(x===void 0||S===void 0)continue;let I=u.value(g),v=m.value(g)||"",A=ht.Flag.None,_=1;switch(v){case"sing":_=1;break;case"doub":_=2;break;case"trip":_=3;break;case"quad":_=4;break;default:_=gM(s.ptnr1_label_comp_id.value(g),s.ptnr1_label_atom_id.value(g),s.ptnr2_label_comp_id.value(g),s.ptnr2_label_atom_id.value(g))}switch(I){case"covale":A=ht.Flag.Covalent;break;case"disulf":A=ht.Flag.Covalent|ht.Flag.Disulfide;break;case"hydrog":A=ht.Flag.HydrogenBond;break;case"metalc":A=ht.Flag.MetallicCoordination;break}y.push({rowIndex:g,flags:A,order:_,distance:c.value(g),partnerA:x,partnerB:S})}return y}a.getEntriesFromStructConn=i})(vc||={});var $Ne=b.distance,e5e=6,t5e=5.5,r5e=3.9;function W9(e,t,r,n,o,i,a){let s=new ns.EdgeBuilder(i,e,t),l=new Uint16Array(s.slotCount),u=new Int8Array(s.slotCount),c=new Uint32Array(s.slotCount);for(let m=0,d=s.edgeCount;m<d;m++)s.addNextEdge(),s.assignProperty(l,n[m]),s.assignProperty(u,r[m]),s.assignProperty(c,o[m]);return s.createGraph({flags:l,order:u,key:c},a)}var ble=b(),xle=b();function n5e(e,t,r){return e.conformation.position(t,ble),e.conformation.position(r,xle),$Ne(ble,xle)}var o5e=new Set;function i5e(e){let t=Do.Provider.get(e.model),{elements:r}=e,{type_symbol:n}=e.model.atomicHierarchy.atoms,o=e.elements.length,{maxDistance:i}=t,{offset:a,b:s,edgeProps:{order:l,distance:u,flag:c,key:m,operatorA:d,operatorB:p}}=t.bonds,{atomSourceIndex:h}=e.model.atomicHierarchy,{invertedIndex:f}=Ft.getInvertedAtomSourceIndex(e.model),y=[],g=[],x=[],S=[],I=[],v=e.conformation.operator.key;for(let A=0;A<o;A++){let _=r[A],T=om(n.value(_)),w=jd(T),D=h.value(_);for(let M=a[D],E=a[D+1];M<E;++M){let R=f[s[M]];if(_>=R)continue;let k=Be.indexOf(e.elements,R);if(k<0)continue;let B=d[M],L=p[M];if(B>=0&&B!==v||L>=0&&L!==v)continue;let V=om(n.value(R)),U=u[M],Q=n5e(e,_,R),O=!1;if(U>=0)O=eo(Q,U,.3);else if(i>=0)O=Q<i;else{let q=Bv(T,V,ph(T),ph(V));O=Q<q,w&&jd(V)&&(O=!1)}O&&(y[y.length]=A,g[g.length]=k,S[S.length]=l[M],x[x.length]=c[M],I[I.length]=m[M])}}return W9(y,g,S,x,I,o,{canRemap:!1,cacheable:t.cacheable})}function a5e(e,t){let r=Ft.isCoarseGrained(e.model),n=r?e5e:t.maxRadius,{x:o,y:i,z:a}=e.model.atomicConformation,s=e.elements.length,{elements:l,residueIndex:u,chainIndex:c}=e,{type_symbol:m,label_atom_id:d,label_alt_id:p,label_comp_id:h}=e.model.atomicHierarchy.atoms,{label_seq_id:f}=e.model.atomicHierarchy.residues,{traceElementIndex:y}=e.model.atomicHierarchy.derived.residue,{index:g}=e.model.atomicHierarchy,{byEntityKey:x}=e.model.sequence,S=e.lookup3d,I=vc.Provider.get(e.model),v=ax.Provider.get(e.model),A=vc.isExhaustive(e.model),_=[],T=[],w=[],D=[],M=[],E=-1,R,k=!0,B=!0,L=!0,V=o5e,U=!!I?.residueCantorPairs.size;for(let Q=0;Q<s;Q++){let O=l[Q],q=m.value(O);k&&q!=="H"&&q!=="O"&&(k=!1);let X=t.forceCompute?void 0:I&&I.byAtomIndex.get(O),F=!1;if(X)for(let Ce of X){let{partnerA:J,partnerB:z}=Ce;if(J.symmetry!==z.symmetry)continue;let ae=J.atomIndex===O?z:J,ge=Be.indexOf(e.elements,ae.atomIndex);ge<0||l[ge]<O||(_[_.length]=Q,T[T.length]=ge,w[w.length]=Ce.flags,D[D.length]=Ce.order,M[M.length]=Ce.rowIndex,F||V.clear(),F=!0,V.add(ge))}if(A)continue;let Y=u[O],$=f.value(Y),ce=h.value(O);if(!t.forceCompute&&Y!==E)if(v&&v.entries.has(ce)){let Ce=x[g.getEntityFromChain(c[O])];Ce&&Ce.sequence.microHet.has($)?R=void 0:R=v.entries.get(ce).map}else R=void 0;E=Y;let ie=om(q),oe=d.value(O),W=R?R.get(oe):void 0,{indices:N,count:j,squaredDistances:ue}=S.find(o[O],i[O],a[O],n),be=jd(ie),ee=ph(ie),le=p.value(O),Ae=ox.has(ie);for(let Ce=0;Ce<j;Ce++){let J=N[Ce];if(F&&V.has(J))continue;let z=l[J];if(z<=O)continue;let ae=p.value(z);if(le&&ae&&le!==ae)continue;if(U){let tt=cc(u[O],u[z]);if(I.residueCantorPairs.has(tt))continue}let ge=om(m.value(z)),ve=jd(ge);if(be&&ve)continue;let Oe=(Ae||ox.has(ge))&&!(be||ve),ze=u[z];if(Y===ze&&W){let tt=W.get(d.value(z));if(tt){_[_.length]=Q,T[T.length]=J,D[D.length]=tt.order;let bt=tt.flags;Oe&&(bt|ht.Flag.Covalent&&(bt^=ht.Flag.Covalent),bt|=ht.Flag.MetallicCoordination),w[w.length]=bt,M[M.length]=tt.key}continue}let Re=Math.sqrt(ue[Ce]);if(Re===0)continue;let Ke=!1;if(r)Y===ze?Ke=Re<=t5e:Ke=Re<=r5e&&y[Y]===O&&y[ze]===z;else{let tt=Bv(ie,ge,ee,ph(ge));Ke=Re<=tt}if(Ke){_[_.length]=Q,T[T.length]=J,D[D.length]=ele(ce,oe,d.value(z)),w[w.length]=(Oe?ht.Flag.MetallicCoordination:ht.Flag.Covalent)|ht.Flag.Computed,M[M.length]=-1;let tt=f.value(ze);$===tt&&(B=!1),Math.abs($-tt)>1&&(L=!1)}}}return W9(_,T,D,w,M,s,{canRemap:k||B&&L})}function s5e(e){return e.conformation.operator.key===-1?!1:!!Do.Provider.get(e.model)?.hasOperators}function l5e(e){let t=Do.Provider.get(e.model),r=t.bySameOperator.get(e.conformation.operator.key);if(!r)return U2.Empty;let{a:n,b:o,edgeProps:{key:i,flag:a,order:s}}=t.bonds,{invertedIndex:l}=Ft.getInvertedAtomSourceIndex(e.model),{elements:u}=e,c=[],m=[],d=[],p=[],h=[];for(let f=0,y=r.length;f<y;++f){let g=r[f];if(n[g]>=o[g])continue;let x=l[n[g]],S=Be.indexOf(u,x);if(S<0)continue;let I=l[o[g]],v=Be.indexOf(u,I);v<0||(c[c.length]=S,m[m.length]=v,d[d.length]=a[g],p[p.length]=s[g],h[h.length]=i[g])}return W9(c,m,p,d,h,u.length,{canRemap:!1,cacheable:t.cacheable})}function Cle(e,t){let r={...hM,...t};return r.noCompute?U2.Empty:e.elements.length<=1?U2.Empty:!r.forceCompute&&Do.Provider.get(e.model)?s5e(e)?l5e(e):i5e(e):a5e(e,r)}var u5e=b.distance,c5e=b.set,m5e=b.squaredDistance,d5e=b.transformMat4,Sle=b(),vle=b();function Ile(e,t,r,n){return e.conformation.position(t,Sle),r.conformation.position(n,vle),u5e(Sle,vle)}var p5e=Z(),N0=b();function f5e(e,t,r,n){let{maxRadius:o}=r,{elements:i,residueIndex:a}=e,{x:s,y:l,z:u}=e.model.atomicConformation,{elements:c,residueIndex:m}=t,d=e.elements.length,{type_symbol:p,label_alt_id:h,label_atom_id:f,label_comp_id:y}=e.model.atomicHierarchy.atoms,{type_symbol:g,label_alt_id:x,label_atom_id:S,label_comp_id:I}=t.model.atomicHierarchy.atoms,{auth_seq_id:v}=e.model.atomicHierarchy.residues,{auth_seq_id:A}=t.model.atomicHierarchy.residues,{occupancy:_}=e.model.atomicConformation,{occupancy:T}=t.model.atomicConformation,w=_.isDefined&&T.isDefined,D=e.model===t.model&&vc.Provider.get(e.model),M=!r.forceCompute&&e.model===t.model&&Do.Provider.get(e.model),{atomSourceIndex:E}=e.model.atomicHierarchy,{invertedIndex:R}=M?Ft.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0},k=e.model===t.model&&vc.isExhaustive(e.model),B=Z.mul(p5e,t.conformation.operator.inverse,e.conformation.operator.matrix),L=!Z.isIdentity(B),{center:V,radius:U}=t.boundary.sphere,Q=(U+o)*(U+o);n.startUnitPair(e.id,t.id);let O=e.conformation.operator.key,q=t.conformation.operator.key;for(let X=0;X<d;X++){let F=i[X];if(c5e(N0,s[F],l[F],u[F]),L&&d5e(N0,N0,B),m5e(N0,V)>Q)continue;if(!r.forceCompute&&M){let{maxDistance:Ce}=M,{offset:J,b:z,edgeProps:{order:ae,distance:ge,flag:ve,key:Oe,operatorA:ze,operatorB:Re}}=M.bonds,Ke=E.value(F),tt=om(p.value(F));for(let bt=J[Ke],Pt=J[Ke+1];bt<Pt;++bt){let fr=R[z[bt]],gt=Be.indexOf(t.elements,fr);if(gt<0)continue;let Sr=ze[bt],zr=Re[bt];if(Sr>=0&&zr>=0&&(Sr===zr||Sr!==O||zr!==q))continue;let Nn=om(p.value(fr)),xn=ge[bt],In=Ile(e,F,t,fr),zn=!1;if(xn>=0)zn=eo(In,xn,.3);else if(Ce>=0)zn=In<Ce;else{let hi=Bv(tt,Nn,ph(tt),ph(Nn));zn=In<hi,jd(tt)&&jd(Nn)&&(zn=!1)}zn&&n.add(X,gt,{order:ae[bt],flag:ve[bt],key:Oe[bt]})}continue}let Y=r.forceCompute?void 0:D&&D.byAtomIndex.get(F);if(Y&&Y.length){let Ce=!1;for(let J of Y){let{partnerA:z,partnerB:ae}=J,ge=z.atomIndex===F?ae:z,ve=Be.indexOf(t.elements,ge.atomIndex);ve<0||Ile(e,F,t,ge.atomIndex)>o||(n.add(X,ve,{order:J.order,flag:J.flags,key:J.rowIndex}),Ce=!0)}if(Ce)continue}if(k)continue;let $=_.value(F),{lookup3d:ce}=t,{indices:ie,count:oe,squaredDistances:W}=ce.find(N0[0],N0[1],N0[2],o);if(oe===0)continue;let N=om(p.value(F)),j=jd(N),ue=ph(N),be=h.value(F),ee=ox.has(N),le=f.value(F),Ae=y.value(a[F]);for(let Ce=0;Ce<oe;Ce++){let J=ie[Ce],z=c[J],ae=x.value(z);if(be&&ae&&be!==ae||w&&T.value(z)<1&&$<1&&v.value(a[F])===A.value(m[z]))continue;if(D&&e.model===t.model){let Ke=cc(a[F],m[z]);if(D.residueCantorPairs.has(Ke))continue}let ge=om(g.value(z)),ve=jd(ge);if(j&&ve)continue;let Oe=(ee||ox.has(ge))&&!(j||ve),ze=Math.sqrt(W[Ce]);if(ze===0)continue;let Re=Bv(N,ge,ue,ph(ge));if(ze<=Re){let Ke=S.value(z),tt=I.value(m[z]);n.add(X,J,{order:gM(Ae,tt,le,Ke),flag:(Oe?ht.Flag.MetallicCoordination:ht.Flag.Covalent)|ht.Flag.Computed,key:-1})}}}n.finishUnitPair()}function h5e(e){for(let t of e.models)if(!Do.Provider.get(t)?.hasOperators)return!1;for(let t of e.units)if(t.conformation.operator.key===-1)return!1;return!0}function g5e(e,t){let r=new Map;for(let n of e.units){let{key:o}=n.conformation.operator;r.has(o)?r.get(o).add(n):r.set(o,new Set([n]))}for(let n of e.models){let o=Do.Provider.get(n),{a:i,b:a}=o.bonds,{order:s,flag:l,key:u,operatorA:c,operatorB:m}=o.bonds.edgeProps,{invertedIndex:d}=Ft.getInvertedAtomSourceIndex(n),p=new Map;for(let y of e.units)if(y.model===n)for(let g=0,x=y.elements.length;g<x;++g){let S=y.elements[g];p.has(S)?p.get(S).add(y):p.set(S,new Set([y]))}let h=new Map;for(let y=0,g=c.length;y<g;++y){let x,S;if(c[y]===m[y]?(x=p.get(d[i[y]]),S=p.get(d[a[y]])):(x=r.get(c[y]),S=r.get(m[y])),!(!x||!S)){for(let I of x)if(c[y]===I.conformation.operator.key)for(let v of S){if(m[y]!==v.conformation.operator.key||I===v||!me.isAtomic(I)||!me.isAtomic(v)||I.id>v.id)continue;let A=Xi(I.id,v.id);h.has(A)?h.get(A).add(y):h.set(A,new Set([y]))}}}let f=[-1,-1];h.forEach((y,g)=>{let[x,S]=N1(f,g),I=e.unitMap.get(x),v=e.unitMap.get(S);t.startUnitPair(x,S),y.forEach(A=>{let _=d[i[A]],T=Be.indexOf(I.elements,_);if(T<0)return;let w=d[a[A]],D=Be.indexOf(v.elements,w);D<0||t.add(T,D,{order:s[A],flag:l[A],key:u[A]})}),t.finishUnitPair()})}}var y5e={...hM,ignoreWater:!0,ignoreIon:!0};function b5e(e,t){let r=new Km.Builder,n=e.models.some(i=>Do.Provider.get(i)),o=e.models.some(i=>vc.isExhaustive(i));return t.noCompute||e.isCoarseGrained&&!n&&!o?new dh(r.getMap()):!t.forceCompute&&h5e(e)?(g5e(e,r),new dh(r.getMap())):(De.eachUnitPair(e,(i,a)=>{f5e(i,a,t,r)},{maxRadius:t.maxRadius,validUnit:i=>t.validUnit(i),validUnitPair:(i,a)=>t.validUnitPair(e,i,a)}),new dh(r.getMap()))}function Ale(e,t){let r={...y5e,...t};return b5e(e,{...r,validUnit:t&&t.validUnit||(n=>me.isAtomic(n)),validUnitPair:t&&t.validUnitPair||((n,o,i)=>{if(!De.validUnitPair(n,o,i))return!1;let s=o.model.atomicHierarchy.derived.residue.moleculeType,l=i.model.atomicHierarchy.derived.residue.moleculeType,u=(!me.isAtomic(o)||s[o.residueIndex[o.elements[0]]]!==2)&&(!me.isAtomic(i)||l[i.residueIndex[i.elements[0]]]!==2),c=!me.isAtomic(o)||s[o.residueIndex[o.elements[0]]]!==3,m=!me.isAtomic(i)||l[i.residueIndex[i.elements[0]]]!==3,d=c&&m;return(u||!r.ignoreWater)&&(d||!r.ignoreIon)?!0:x5e(o,i)})})}function x5e(e,t){if(e.model!==t.model||!me.isAtomic(e)||!me.isAtomic(t))return!1;let r=vc.Provider.get(e.model);if(!r)return!1;let n=e.elements.length<t.elements.length?e:t,o=e.elements.length>=t.elements.length?e:t,{elements:i}=n,{elements:a}=o,{indexOf:s}=Be;for(let l=0,u=i.length;l<u;l++){let c=i[l],m=r.byAtomIndex.get(c);if(m?.length)for(let d of m){let p=d.partnerA.atomIndex===c?d.partnerB.atomIndex:d.partnerA.atomIndex;if(s(a,p)>=0)return!0}}return!1}var Ct;(f=>{function e(y,g,x,S,I,v){return{kind:"bond-location",aStructure:y,aUnit:g,aIndex:x,bStructure:S,bUnit:I,bIndex:v}}f.Location=e;function t(y){return!!y&&y.kind==="bond-location"}f.isLocation=t;function r(y,g){return y.aStructure.label===g.aStructure.label&&y.bStructure.label===g.bStructure.label&&y.aIndex===g.aIndex&&y.bIndex===g.bIndex&&y.aUnit.id===g.aUnit.id&&y.bUnit.id===g.bUnit.id}f.areLocationsEqual=r;function n(y,g){return{kind:"bond-loci",structure:y,bonds:g}}f.Loci=n;function o(y){return!!y&&y.kind==="bond-loci"}f.isLoci=o;function i(y,g){if(y.structure!==g.structure||y.bonds.length!==g.bonds.length)return!1;for(let x=0,S=y.bonds.length;x<S;++x)if(!r(y.bonds[x],g.bonds[x]))return!1;return!0}f.areLociEqual=i;function a(y){return y.bonds.length===0}f.isLociEmpty=a;function s(y,g){if(g===y.structure)return y;let x=[];return y.bonds.forEach(S=>{let I=g.unitMap.get(S.aUnit.id);if(!I)return;let v=g.unitMap.get(S.bUnit.id);if(!v)return;let A=S.aUnit.elements[S.aIndex],_=Be.indexOf(I.elements,A);if(_===-1)return;let T=S.bUnit.elements[S.bIndex],w=Be.indexOf(v.elements,T);w!==-1&&x.push(e(y.structure,I,_,y.structure,v,w))}),n(g,x)}f.remapLoci=s;function l(y){let g=[],x=new Map;for(let S of y.bonds){let{aIndex:I,aUnit:v,bIndex:A,bUnit:_}=S;v===_?x.has(v.id)?x.get(v.id).push(I,A):x.set(v.id,[I,A]):(x.has(v.id)?x.get(v.id).push(I):x.set(v.id,[I]),x.has(_.id)?x.get(_.id).push(A):x.set(_.id,[A]))}return x.forEach((S,I)=>{g.push({unit:y.structure.unitMap.get(I),indices:Be.deduplicate(Be.ofUnsortedArray(S))})}),K.Loci(y.structure,g)}f.toStructureElementLoci=l;function u(y){let{aUnit:g,aIndex:x}=y.bonds[0];return K.Loci(y.structure,[{unit:g,indices:Se.ofSingleton(x)}])}f.toFirstStructureElementLoci=u;function c(y,g){if(g.aUnit===g.bUnit){let x=g.aUnit.bonds,S=x.getEdgeIndex(g.aIndex,g.bIndex);return S<0?ht.create(ht.Flag.None):ht.create(x.edgeProps.flags[S])}else{let x=y.interUnitBonds.getBondFromLocation(g);return x?ht.create(x.props.flag):ht.create(ht.Flag.None)}}f.getType=c;function m(y,g){if(g.aUnit===g.bUnit){let x=g.aUnit.bonds,S=x.getEdgeIndex(g.aIndex,g.bIndex);return S<0?0:x.edgeProps.order[S]}else{let x=y.interUnitBonds.getBondFromLocation(g);return x?x.props.order:0}}f.getOrder=m;function d(y){let g=0;for(let x of y.unitSymmetryGroups){let S=x.units[0];me.isAtomic(S)&&(g+=S.bonds.edgeCount*x.units.length)}return g}f.getIntraUnitBondCount=d;class p{constructor(){this.current={};this.hasNext=!1}move(){return this.advance(),this.current}setElement(g,x,S){this.structure=g,this.unit=x,this.index=S,this.interBondIndices=g.interUnitBonds.getEdgeIndices(S,x.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=x.bonds.offset[S+1],this.intraBondIndex=x.bonds.offset[S],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}advance(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else if(this.interBondIndex<this.interBondCount){let g=this.structure.interUnitBonds.edges[this.interBondIndices[this.interBondIndex]];this.current.otherUnit=this.structure.unitMap.get(g.unitA!==this.unit.id?g.unitA:g.unitB),this.current.otherIndex=g.indexA!==this.index?g.indexA:g.indexB,this.current.type=g.props.flag,this.current.order=g.props.order,this.interBondIndex+=1}else{this.hasNext=!1;return}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}}f.ElementBondIterator=p;function h(y,g){return cu.fromPairProvider(y.bonds.length,(x,S,I)=>{let{aUnit:v,aIndex:A,bUnit:_,bIndex:T}=y.bonds[x];v.conformation.position(v.elements[A],S),_.conformation.position(_.elements[T],I)},g)}f.getBoundingSphere=h})(Ct||={});function Ele(e){let t=S5e(e),r=C5e(e,t),n=Xt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);for(;n.hasNext;){let o=n.move();v5e(r,o.start,o.end)}return r.rings}function C5e(e,t){return{startVertex:0,endVertex:0,count:0,isRingAtom:new Int32Array(t),marked:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),depth:new Int32Array(t),left:new Int32Array(5),right:new Int32Array(5),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}function Tle(e){e.count=e.endVertex-e.startVertex;let{isRingAtom:t,pred:r,color:n,depth:o,marked:i}=e;for(let a=0;a<e.count;a++)t[a]=0,r[a]=-1,i[a]=-1,n[a]=0,o[a]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function Ple(e){let{depth:t}=e;for(let r=0;r<e.count;r++)t[r]=e.count+1}function S5e(e){let t=Xt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),r=0;for(;t.hasNext;){let n=t.move();r=Math.max(r,n.end-n.start)}return r}function _le(e,t){let r=e.bonds.offset,n=e.startVertex+t,o=r[n],a=r[n+1]-o;return!(a<=1||e.isRingAtom[t]&&a===2)}function v5e(e,t,r){if(e.startVertex=t,e.endVertex=r,e.endVertex-e.startVertex<3)return;e.currentRings=[];let{elements:n}=e.unit,o=[];for(let a=e.startVertex;a<e.endVertex;a++){let s=e.altLoc.value(n[a]);qo(o,s)}Pd(o,"");let i=1;if(o.length===0){Tle(e);for(let a=0;a<e.count;a++)_le(e,a)&&(Ple(e),i=Rle(e,a,i))}else for(let a=0;a<o.length;a++){Tle(e),e.hasAltLoc=!0,e.currentAltLoc=o[a];for(let s=0;s<e.count;s++){if(!_le(e,s))continue;let l=e.altLoc.value(n[e.startVertex+s]);l&&l!==e.currentAltLoc||(Ple(e),i=Rle(e,s,i))}}for(let a=0,s=e.currentRings.length;a<s;a++)e.rings.push(e.currentRings[a])}function I5e(e,t,r,n){if(r<t)return!1;let{pred:o,color:i,left:a,right:s}=e,l=++e.currentColor,u=t;for(let g=0;g<5&&(i[u]=l,u=o[u],!(u<0));g++);let c=0,m=0,d=!1,p=0;u=r;for(let g=0;g<5;g++){if(i[u]===l){p=u,d=!0;break}if(s[m++]=u,u=o[u],u<0)break}if(!d)return!1;u=t;for(let g=0;g<5&&(a[c++]=u,!(p===u||(u=o[u],u<0)));g++);let h=c+m;if(h<3)return!1;let f=new Int32Array(h),y=0;for(let g=0;g<c;g++)f[y++]=e.startVertex+a[g],n[a[g]]=1;for(let g=m-1;g>=0;g--)f[y++]=e.startVertex+s[g],n[s[g]]=1;Fs(f);for(let g=0,x=e.currentRings.length;g<x;g++){let S=e.currentRings[g];if(f.length===S.length){if(Be.areEqual(f,S))return!1}else if(f.length>S.length&&Be.isSubset(f,S))return!1}return e.currentRings.push(Be.ofSortedArray(f)),!0}function Rle(e,t,r){let{bonds:n,startVertex:o,endVertex:i,isRingAtom:a,marked:s,queue:l,pred:u,depth:c}=e,{elements:m}=e.unit,{b:d,edgeProps:{flags:p},offset:h}=n;s[t]=r,c[t]=0,l[0]=t;let f=0,y=1;for(;f<y;){let g=l[f++],x=c[g],S=o+g,I=h[S],v=h[S+1];for(let A=I;A<v;A++){let _=d[A];if(_<o||_>=i||!ht.isCovalent(p[A]))continue;if(e.hasAltLoc){let D=e.altLoc.value(m[_]);if(D&&e.currentAltLoc!==D)continue}let T=_-o;if(s[T]===r){if(u[T]!==g&&u[g]!==T&&I5e(e,g,T,a))return r+1;continue}let w=Math.min(c[T],x+1);w>5||(c[T]=w,s[T]=r,l[y++]=T,u[T]=g)}}return r+1}function Mle(e){let t=e.length,r=new Array(t);for(let a=0;a<t;a++)r[a]=e[t-a-1];let n=Dle(e),o=Dle(r),i=!1;for(let a=0;a<t;a++){let s=e[(a+n)%t],l=r[(a+o)%t];if(s!==l){i=s<l;break}}return i?wle(e,n):wle(r,o)}function Dle(e){let t=e.length,r=new Int32Array(t*2);for(let a=0;a<r.length;a++)r[a]=-1;let n="",o="",i=0;for(let a=1;a<r.length;a++){let s=r[a-i-1];for(;s!==-1&&(n=e[a%t],o=e[(i+s+1)%t],n!==o);)n<o&&(i=a-s-1),s=r[s];s===-1?(n=e[a%t],o=e[(i+s+1)%t],n!==o?(n<o&&(i=a),r[a-i]=-1):r[a-i]=s+1):r[a-i]=s+1}return i}function wle(e,t){let r=e.length,n=[],o;for(o=0;o<r-1;o++)n.push(e[(o+t)%r]),n.push("-");return n.push(e[(o+t)%r]),n.join("")}function Ble(e,t){let r=new Map,n=new Map;for(let l=0,u=e.length;l<u;l++){let c=e[l];for(let m=0,d=c.length;m<d;m++){let p=c[m];r.has(p)?r.get(p).push(l):r.set(p,[l])}}for(let l=0,u=t.length;l<u;l++){let c=t[l],m=e[c];for(let d=0,p=m.length;d<p;d++){let h=m[d];n.has(h)?n.get(h).push(c):n.set(h,[c])}}let o=new ns.UniqueEdgeBuilder(e.length);for(let l=0,u=e.length;l<u;l++){let c=e[l];for(let m=0,d=c.length;m<d;m++){let p=c[m],h=r.get(p);if(h.length!==1)for(let f=0,y=h.length;f<y;f++){let g=h[f];l>=g||o.addEdge(l,g)}}}let i=ns.connectedComponents(o.getGraph()),a=i.componentIndex,s=[];for(let l=0;l<i.componentCount;l++)s[l]=[];for(let l=0,u=e.length;l<u;l++)s[a[l]].push(l);return{elementRingIndices:r,elementAromaticRingIndices:n,ringComponentIndex:a,ringComponents:s}}var W2={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},A5e={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},T5e={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},P5e=1.7,_5e=10.81,R5e=0;function hh(e){let t=W2[e];return t===void 0?P5e:A5e[t]}function kle(e){let t=W2[e];return t===void 0?_5e:T5e[t]}function sx(e){let t=W2[e];return t===void 0?R5e:t}var Lle={H:"Hydrogen",HE:"Helium",LI:"Lithium",BE:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",NE:"Neon",NA:"Sodium",MG:"Magnesium",AL:"Aluminum",SI:"Silicon",P:"Phosphorus",S:"Sulfur",CL:"Chlorine",AR:"Argon",K:"Potassium",CA:"Calcium",SC:"Scandium",TI:"Titanium",V:"Vanadium",CR:"Chromium",MN:"Manganese",FE:"Iron",CO:"Cobalt",NI:"Nickel",CU:"Copper",ZN:"Zinc",GA:"Gallium",GE:"Germanium",AS:"Arsenic",SE:"Selenium",BR:"Bromine",KR:"Krypton",RB:"Rubidium",SR:"Strontium",Y:"Yttrium",ZR:"Zirconium",NB:"Niobium",MO:"Molybdenum",TC:"Technetium",RU:"Ruthenium",RH:"Rhodium",PD:"Palladium",AG:"Silver",CD:"Cadmium",IN:"Indium",SN:"Tin",SB:"Antimony",TE:"Tellurium",I:"Iodine",XE:"Xenon",CS:"Cesium",BA:"Barium",LA:"Lanthanum",CE:"Cerium",PR:"Praseodymium",ND:"Neodymium",PM:"Promethium",SM:"Samarium",EU:"Europium",GD:"Gadolinium",TB:"Terbium",DY:"Dysprosium",HO:"Holmium",ER:"Erbium",TM:"Thulium",YB:"Ytterbium",LU:"Lutetium",HF:"Hafnium",TA:"Tantalum",W:"Wolfram",RE:"Rhenium",OS:"Osmium",IR:"Iridium",PT:"Platinum",AU:"Gold",HG:"Mercury",TL:"Thallium",PB:"Lead",BI:"Bismuth",PO:"Polonium",AT:"Astatine",RN:"Radon",FR:"Francium",RA:"Radium",AC:"Actinium",TH:"Thorium",PA:"Protactinium",U:"Uranium",NP:"Neptunium",PU:"Plutonium",AM:"Americium",CM:"Curium",BK:"Berkelium",CF:"Californium",ES:"Einsteinium",FM:"Fermium",MD:"Mendelevium",NO:"Nobelium",LR:"Lawrencium",RF:"Rutherfordium",DB:"Dubnium",SG:"Seaborgium",BH:"Bohrium",HS:"Hassium",MT:"Meitnerium",DS:"Darmstadtium",RG:"Roentgenium",CN:"Copernicium",NH:"Nihonium",FL:"Flerovium",MC:"Moscovium",LV:"Livermorium",TS:"Tennessine",OG:"Oganesson"},D5e=new Set(["LI","NA","K","RB","CS","FR"]);function w5e(e){return D5e.has(e)}var E5e=new Set(["BE","MG","CA","SR","BA","RA"]);function M5e(e){return E5e.has(e)}var B5e=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]);function k5e(e){return B5e.has(e)}var L5e=new Set(["F","CL","BR","I","AT"]);function X9(e){return L5e.has(e)}function Q9(e){let t=sx(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function F5e(e){let t=sx(e);return t>=57&&t<=71}function V5e(e){let t=sx(e);return t>=89&&t<=103}function Fle(e){return w5e(e)||M5e(e)||F5e(e)||V5e(e)||Q9(e)||k5e(e)}function O5e(e,t){let r=e.coarseElements.entityKey[t],n=e.model.sequence.byEntityKey[r].sequence,o=e.coarseElements.seq_id_begin.value(t);return n.compId.value(o-1)}function Fv(e,t){switch(e.kind){case me.Kind.Atomic:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case me.Kind.Spheres:case me.Kind.Gaussians:let r=O5e(e,t),n=e.model.properties.chemicalComponentMap.get(r);if(n)return Tl(n.type,r)}return 0}var G5e=new Set;function gh(e,t){let r=xse[e];if(r!==void 0){let n=r[t];if(n!==void 0)return n}return G5e}var Vle=b.zero();function PM(e,t){let r=e.conformation,n=new Float32Array(t.length*3),{elements:o}=e;for(let i=0,a=t.length;i<a;++i)r.position(o[t[i]],Vle),b.toArray(Vle,n,i*3);return n}var lx=class{constructor(t,r){this.unit=r;this.all=t}get index(){return this._index?this._index:(this._index=Ble(this.all,this.aromaticRings),this._index)}get byFingerprint(){return this._byFingerprint?this._byFingerprint:(this._byFingerprint=U5e(this.unit,this.all),this._byFingerprint)}get elementRingIndices(){return this.index.elementRingIndices}get elementAromaticRingIndices(){return this.index.elementAromaticRingIndices}get ringComponentIndex(){return this.index.ringComponentIndex}get ringComponents(){return this.index.ringComponents}get aromaticRings(){return this._aromaticRings?this._aromaticRings:(this._aromaticRings=H5e(this.unit,this.all),this._aromaticRings)}},Jm;(a=>{function e(s,l){let{elements:u}=s,{type_symbol:c}=s.model.atomicHierarchy.atoms,m=[];for(let d=0,p=l.length;d<p;d++)m[m.length]=c.value(u[l[d]]);return t(m)}a.fingerprint=e;function t(s){return Mle(s)}a.elementFingerprint=t;let r=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]),n=.05;function o(s,l){let{elements:u,bonds:{b:c,offset:m,edgeProps:{flags:d}}}=s,{type_symbol:p,label_comp_id:h}=s.model.atomicHierarchy.atoms;if(h.value(s.elements[l[0]])==="PRO")return!1;let f=0,y=!1;for(let x=0,S=l.length;x<S;++x){let I=l[x];!y&&r.has(p.value(u[I]))&&(y=!0);for(let v=m[I],A=m[I+1];v<A;++v)ht.is(ht.Flag.Aromatic,d[v])&&Be.has(l,c[v])&&(f+=1)}if(f===2*l.length)return!0;if(!y||l.length<5||f>0)return!1;let g=lu.calculateMomentsAxes(PM(s,l));return b.magnitude(g.dirC)<n}a.isAromatic=o;function i(s,l){let{label_alt_id:u}=s.model.atomicHierarchy.atoms,{elements:c}=s;for(let m=0,d=l.length;m<d;++m){let p=c[l[m]],h=u.value(p);if(h)return h}return""}a.getAltId=i})(Jm||={});(r=>{function e(n){if(me.Traits.is(n.traits,me.Trait.Water)||me.Traits.is(n.traits,me.Trait.CoarseGrained))return new r([],n);let o=Ele(n);return new r(o,n)}r.create=e;function t(n,o){let i=new Map;for(let a=0,s=o.length;a<s;a++){let l=o[a];z5e(n,l,i)}return i}r.byFingerprintAndResidue=t})(lx||={});function U5e(e,t){let r=new Map,n=0;for(let o=0,i=t.length;o<i;o++){let a=t[o],s=Jm.fingerprint(e,a);r.has(s)?r.get(s).push(n):r.set(s,[n]),n++}return r}function N5e(e,t){let{elements:r}=e,n=e.model.atomicHierarchy.residueAtomSegments.index,o=n[r[t[0]]];for(let i=1,a=t.length;i<a;i++)if(o!==n[r[t[i]]])return-1;return o}function z5e(e,t,r){let n=e.byFingerprint.get(t);if(n)for(let o=0,i=n.length;o<i;o++){let a=n[o],s=N5e(e.unit,e.all[a]);s>=0&&(r.has(s)?r.get(s).push(a):r.set(s,[a]))}}function H5e(e,t){let r=[];for(let n=0,o=t.length;n<o;++n)Jm.isAromatic(e,t[n])&&r.push(n);return r}var kn;(S=>{function e(I){return Be.ofSortedArray(I)}S.ofSortedRanges=e;function t(I){return I[0]}S.start=t;function r(I){return I[I.length-1]+1}S.end=r;function n(I){return I[0]}S.min=n;function o(I){return I[I.length-1]}S.max=o;function i(I){let v=0;for(let A=0,_=I.length;A<_;A+=2)v+=I[A+1]-I[A]+1;return v}S.size=i;function a(I){return I.length/2}S.count=a;function s(I,v){return I[v*2]}S.startAt=s;function l(I,v){return I[v*2+1]+1}S.endAt=l;function u(I,v){return I[v*2]}S.minAt=u;function c(I,v){return I[v*2+1]}S.maxAt=c;function m(I,v){if(I.length!==v.length)return!1;for(let A=0,_=I.length;A<_;++A)if(I[A]!==v[A])return!1;return!0}S.areEqual=m;function d(I,v){let A=0;for(let _=0,T=I.length;_<T;_+=2)for(let w=I[_],D=I[_+1];w<=D;++w)v(w,A),++A}S.forEach=d;function p(I,v){return f(I,v)!==-1}S.has=p;function h(I,v,A){return y(I,v,A)!==-1}S.hasFrom=h;function f(I,v){return y(I,v,0)}S.firstIntersectionIndex=f;function y(I,v,A){if(u(I,A)>Se.max(v)||o(I)<Se.min(v))return-1;for(let _=A,T=a(I);_<T;++_){let w=xe.ofRange(u(I,_),c(I,_));if(Se.areIntersecting(w,v))return _}return-1}S.firstIntersectionIndexFrom=y;function g(I,v){return new x(I,v)}S.transientSegments=g;class x{constructor(v,A){this.ranges=v;this.set=A;this.value={index:0,start:0,end:0};this.curIndex=0;this.hasNext=!1;this.curIndex=f(v,A),this.hasNext=this.curIndex!==-1}updateValue(){this.value.index=this.curIndex,this.value.start=Se.findPredecessorIndex(this.set,s(this.ranges,this.curIndex)),this.value.end=Se.findPredecessorIndex(this.set,l(this.ranges,this.curIndex))}move(){return this.hasNext&&(this.updateValue(),this.curIndex=y(this.ranges,this.set,this.curIndex+1),this.hasNext=this.curIndex!==-1),this.value}}S.Iterator=x})(kn||={});function Ole(e){let t=[],{elements:r,model:n}=e,{residueAtomSegments:o}=e.model.atomicHierarchy,{traceElementIndex:i}=n.atomicHierarchy.derived.residue,a=kn.transientSegments(e.model.atomicRanges.polymerRanges,r),s=Xt.transientSegments(o,r);for(;a.hasNext;){let l=a.move();for(s.setSegment(l);s.hasNext;){let u=s.move(),{start:c,end:m,index:d}=u;if(Se.areIntersecting(xe.ofRange(r[c],r[m-1]),r)){let p=i[d];t.push(p===-1?o.offsets[d]:p)}}}return Be.ofSortedArray(t)}function Gle(e){let t=[],{elements:r,model:n}=e,{spheres:o,gaussians:i}=n.coarseHierarchy,a=me.isSpheres(e)?o.polymerRanges:i.polymerRanges,s=kn.transientSegments(a,r);for(;s.hasNext;){let{start:l,end:u}=s.move();for(let c=l;c<u;++c)t.push(r[c])}return Be.ofSortedArray(t)}function Ule(e){let t=[],{elements:r,model:n,residueIndex:o}=e,{residueAtomSegments:i}=e.model.atomicHierarchy,{traceElementIndex:a}=n.atomicHierarchy.derived.residue,s=kn.transientSegments(e.model.atomicRanges.gapRanges,e.elements);for(;s.hasNext;){let l=s.move(),u=o[r[l.start]],c=o[r[l.end-1]],m=a[u],d=a[c];t.push(m===-1?i.offsets[u]:m),t.push(d===-1?i.offsets[c]:d)}return Be.ofSortedArray(t)}function Nle(e){let t=[],{elements:r,model:n}=e,{spheres:o,gaussians:i}=n.coarseHierarchy,a=me.isSpheres(e)?o.gapRanges:i.gapRanges,s=kn.transientSegments(a,r);for(;s.hasNext;){let{start:l,end:u}=s.move();t.push(r[l],r[u-1])}return Be.ofSortedArray(t)}function zle(e){let t=[],{elements:r,model:n}=e,{chainAtomSegments:o,residueAtomSegments:i}=n.atomicHierarchy,{moleculeType:a,traceElementIndex:s}=n.atomicHierarchy.derived.residue,l=Xt.transientSegments(o,r),u=Xt.transientSegments(i,r);for(;l.hasNext;)for(u.setSegment(l.move());u.hasNext;){let{index:c}=u.move();if(Zi(a[c])){let m=s[c];t.push(m===-1?i.offsets[c]:m)}}return Be.ofSortedArray(t)}function Hle(e){let t=[],{elements:r,model:n}=e,{chainAtomSegments:o,residueAtomSegments:i}=n.atomicHierarchy,{moleculeType:a,traceElementIndex:s}=n.atomicHierarchy.derived.residue,l=Xt.transientSegments(o,r),u=Xt.transientSegments(i,r);for(;l.hasNext;)for(u.setSegment(l.move());u.hasNext;){let{index:c}=u.move();if(R9(a[c])){let m=s[c];t.push(m===-1?i.offsets[c]:m)}}return Be.ofSortedArray(t)}var jle=b();function j5e(e){let{elements:t,conformation:r}=e,n=new Float32Array(t.length*3);for(let o=0,i=t.length;o<i;o++)r.invariantPosition(t[o],jle),b.toArray(jle,n,o*3);return n}function Z9(e){let t=j5e(e);return lu.ofPositions(t)}var Wle=b.dot,Xle=b.copy,W5e=b.scaleAndSub,X5e=b.scaleAndAdd,Ci=class{constructor(t){this.minDist=[];this.maxDist=[];this.extrema=[];this.centroidHelper=new cu;this.dir=Q5e(t),this.dirLength=this.dir.length,this.reset()}computeExtrema(t,r){let n=Wle(this.dir[t],r);n<this.minDist[t]&&(this.minDist[t]=n,Xle(this.extrema[t*2],r)),n>this.maxDist[t]&&(this.maxDist[t]=n,Xle(this.extrema[t*2+1],r))}computeSphereExtrema(t,r,n){let o=this.dir[t],i=Wle(o,r);i-n<this.minDist[t]&&(this.minDist[t]=i-n,W5e(this.extrema[t*2],r,o,n)),i+n>this.maxDist[t]&&(this.maxDist[t]=i+n,X5e(this.extrema[t*2+1],r,o,n))}includeSphere(t){if(ye.hasExtrema(t)&&t.extrema.length>1)for(let r of t.extrema)this.includePosition(r);else this.includePositionRadius(t.center,t.radius)}includePosition(t){for(let r=0;r<this.dirLength;++r)this.computeExtrema(r,t)}includePositionRadius(t,r){for(let n=0;n<this.dirLength;++n)this.computeSphereExtrema(n,t,r)}finishedIncludeStep(){for(let t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()}radiusSphere(t){if(ye.hasExtrema(t)&&t.extrema.length>1)for(let r of t.extrema)this.radiusPosition(r);else this.radiusPositionRadius(t.center,t.radius)}radiusPosition(t){this.centroidHelper.radiusStep(t)}radiusPositionRadius(t,r){this.centroidHelper.radiusSphereStep(t,r)}getSphere(t){return ye.setExtrema(this.centroidHelper.getSphere(t),this.extrema.slice())}getBox(t){return ut.fromVec3Array(t||ut(),this.extrema)}reset(){for(let t=0;t<this.dirLength;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[t*2]=b(),this.extrema[t*2+1]=b();this.centroidHelper.reset()}};function Q5e(e){let t;switch(e){case"6":t=[..._M];break;case"14":t=[..._M,...q9];break;case"26":t=[..._M,...q9,...Qle];break;case"98":t=[..._M,...q9,...Qle,...Z5e,...q5e,...Y5e];break}return t.map(r=>{let n=b.create(r[0],r[1],r[2]);return b.normalize(n,n)})}var _M=[[1,0,0],[0,1,0],[0,0,1]],q9=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],Qle=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],Z5e=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],q5e=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],Y5e=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]];var Zle=b.set,K5e=new Ci("14"),J5e=new Ci("98");function $5e(e){return e>1e4?K5e:J5e}function DM(e){let t=ut.computeBounding(e);return{box:t,sphere:ye.fromBox3D(ye(),t)}}var RM=b();function lf(e){let{x:t,y:r,z:n,radius:o,indices:i}=e,a=Se.size(i);if(a>25e4)return DM(e);let s=$5e(a);s.reset();for(let u=0;u<a;u++){let c=Se.getAt(i,u);Zle(RM,t[c],r[c],n[c]),s.includePositionRadius(RM,o&&o[c]||0)}s.finishedIncludeStep();for(let u=0;u<a;u++){let c=Se.getAt(i,u);Zle(RM,t[c],r[c],n[c]),s.radiusPositionRadius(RM,o&&o[c]||0)}let l=s.getSphere();if(!o&&ye.hasExtrema(l)&&a<=l.extrema.length){let u=[];for(let c=0;c<a;c++){let m=Se.getAt(i,c);u.push(b.create(t[m],r[m],n[m]))}ye.setExtrema(l,u)}return{box:s.getBox(),sphere:l}}var wM=class e{constructor(){this.data=new Map}get(t){let r=Be.hashCode(t);if(this.data.has(r)){for(let[n,o]of this.data.get(r))if(Be.areEqual(t,n))return o}}set(t,r){let n=Be.hashCode(t);if(this.data.has(n)){let o=this.data.get(n);for(let i of o)if(Be.areEqual(t,i[0])){i[1]=r;return}o.push([t,r])}else this.data.set(n,[[t,r]])}static get(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache}};var Vv=class{constructor(t,r,n){this.operatorsProvider=n;this.id=t,this.details=r}get operatorGroups(){return this._operators?this._operators:(this._operators=this.operatorsProvider(),this._operators)}};(t=>{function e(r,n,o){return new t(r,n,o)}t.create=e})(Vv||={});var ux;(n=>{n.Default={assemblies:[],spacegroup:Ns.ZeroP1,isNonStandardCrystalFrame:!1};function t(o,i){let a=i.toLocaleLowerCase(),s=wo.Provider.get(o);return s?z1(s.assemblies,l=>l.id.toLowerCase()===a):void 0}n.findAssembly=t;function r(o){let{cell:i,name:a,num:s}=o.spacegroup,{size:l,anglesInRadians:u}=i,c=l[0].toFixed(2),m=l[1].toFixed(2),d=l[2].toFixed(2),p=Ea(u[0]).toFixed(2),h=Ea(u[1]).toFixed(2),f=Ea(u[2]).toFixed(2),y=[];return y.push(`Unit Cell <b>${a}</b> #${s}`),y.push(`${c}\xD7${m}\xD7${d} \u212B`),y.push(`\u03B1=${p}\xB0 \u03B2=${h}\xB0 \u03B3=${f}\xB0`),y.join(" | ")}n.getUnitcellLabel=r})(ux||={});function qle(e,t,r){if(!e._rowCount)return[];let n=rze(r),o=[];for(let i=0;i<e._rowCount;i++)o[o.length]=eze(e,t,i,n);return o}function eze(e,t,r,n){let o=e.id.value(r),i=e.details.value(r),a=[],{assembly_id:s,oper_expression:l,asym_id_list:u}=t;for(let c=0,m=t._rowCount;c<m;c++)s.value(c)===o&&(a[a.length]={assemblyId:o,expression:l.value(c),asymIds:u.value(c)});return Vv.create(o,i,tze(a,n))}function tze(e,t){return()=>{let r=[],n=0;for(let o=0;o<e.length;o++){let i=e[o],a=ize(i.expression),s=nze(a),l=oze(t,s,n,i.assemblyId),u=Fn.generators.atoms({chainTest:Fn.pred.and(Fn.pred.eq(c=>qe.unit.operator_name(c.element),jn.DefaultName),Fn.pred.inSet(c=>qe.chain.label_asym_id(c.element),i.asymIds))});r[r.length]={selector:u,operators:l,asymIds:i.asymIds},n+=l.length}return r}}function rze(e){let{id:t,matrix:r,vector:n,_schema:o}=e,i=new Map,a=b();for(let s=0,l=e._rowCount;s<l;s++){let u=xr.toMat4(Z(),o.matrix.space,r.value(s));xr.toVec3(a,o.vector.space,n.value(s)),Z.setTranslation(u,a),Z.setValue(u,3,3,1),i.set(t.value(s),u)}return i}function nze(e){let t=[],r=[];for(let n=0;n<e.length;n++)r[n]="";return Yle(e,t,e.length-1,r),t}function Yle(e,t,r,n){if(r<0){t[t.length]=n.slice(0);return}let o=e[r],i=o.length;for(let a=0;a<i;a++)n[r]=o[a],Yle(e,t,r-1,n)}function oze(e,t,r,n){let o=[],i=r;for(let a of t){let s=Z.identity();for(let c=0;c<a.length;c++)Z.mul(s,s,e.get(a[c]));i++;let l=`ASM_${i}`,u=jn.getAssemblyOperatorName(a);o[o.length]=jn.create(l,s,{instanceId:u,assembly:{id:n,operId:i,operList:a}})}return o}function ize(e){let t=/\(?([^\(\)]+)\)?]*/g,r=[],n=[],o;for(;o=t.exec(e);)r[r.length]=o[1];return r.forEach(i=>{let a=[];i.split(",").forEach(s=>{let l=s.indexOf("-");if(l>0){let u=parseInt(s.substring(0,l)),c=parseInt(s.substr(l+1));for(let m=u;m<=c;m++)a[a.length]=m.toString()}else a[a.length]=s.trim()}),n[n.length]=a}),n}var wo;(o=>{o.Descriptor={name:"model_symmetry"},o.Provider=ll.create(o.Descriptor);function r(i){let a=qle(i.pdbx_struct_assembly,i.pdbx_struct_assembly_gen,i.pdbx_struct_oper_list),s=lze(i.symmetry,i.cell),l=aze(i.atom_sites,s);return{assemblies:a,spacegroup:s,isNonStandardCrystalFrame:l,ncsOperators:uze(i.struct_ncs_oper)}}o.fromData=r;function n(i,a){let s=Yi.create("P 1",i,a),l=Ns.create(s);return{assemblies:[],spacegroup:l,isNonStandardCrystalFrame:!1}}o.fromCell=n})(wo||={});function aze(e,t){return e._rowCount===0,!1}function sze(e){let t=e.Int_Tables_number.value(0),r=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?r:t:r}function lze(e,t){if(e._rowCount===0||t._rowCount===0)return Ns.ZeroP1;let r=t.length_a.value(0),n=t.length_b.value(0),o=t.length_c.value(0);if(r===0||n===0||o===0)return Ns.ZeroP1;let i=t.angle_alpha.value(0),a=t.angle_beta.value(0),s=t.angle_gamma.value(0);if(i===0||a===0||s===0)return Ns.ZeroP1;let l=sze(e),u=Yi.create(l,b.create(r,n,o),b.scale(b(),b.create(i,a,s),Math.PI/180));return Ns.create(u)}function uze(e){if(e._rowCount===0)return;let{id:t,matrix:r,vector:n}=e,o=an.struct_ncs_oper.matrix.space,i=an.struct_ncs_oper.vector.space,a=[];for(let s=0;s<e._rowCount;s++){let l=xr.toMat3(Ot(),o,r.value(s)),u=xr.toVec3(b(),i,n.value(s));if(!jn.checkIfRotationAndTranslation(l,u)||e.code.value(s)==="given"&&!Ot.isIdentity(l)&&!b.isZero(u))continue;let c=t.value(s);a[a.length]=jn.ofRotationAndOffset(`ncs_${c}`,l,u,c)}return a}var cze={delocalizedTriplets:{getThirdElement:()=>{},getTripletIndices:()=>{},triplets:[]}};function Kle(e){return me.Traits.is(e.traits,me.Trait.Water)||me.Traits.is(e.traits,me.Trait.CoarseGrained)?cze:{delocalizedTriplets:mze(e)}}function mze(e){let t=e.bonds,{b:r,edgeProps:n,offset:o}=t,{order:i,flags:a}=n,{elementAromaticRingIndices:s}=e.rings,l=[],u=new Map,c=new Map,m=(d,p,h)=>{let f=l.length;l.push(Be.ofUnsortedArray([d,p,h])),u.set(cc(d,p),h),c.has(d)?c.get(d).push(f):c.set(d,[f])};for(let d=0;d<e.elements.length;d++){if(s.has(d)||o[d+1]-o[d]+1<2)continue;let h=[];for(let f=o[d],y=o[d+1];f<y;f++){let g=a[f];ht.is(g,ht.Flag.Aromatic)&&h.push(r[f])}if(h.length>=2){m(d,h[0],h[1]);for(let f=1,y=h.length;f<y;f++)m(d,h[f],h[0])}}return{getThirdElement:(d,p)=>u.get(cc(d,p)),getTripletIndices:d=>c.get(d),triplets:l}}var me;(U=>{let e;(X=>(X[X.Atomic=0]="Atomic",X[X.Spheres=1]="Spheres",X[X.Gaussians=2]="Gaussians"))(e=U.Kind||={});let t;(X=>(X[X.Atomic=0]="Atomic",X[X.Spheres=1]="Spheres",X[X.Gaussians=2]="Gaussians"))(t=U.Kinds||={});function r(Q){return Q.kind===0}U.isAtomic=r;function n(Q){return Q.kind===1||Q.kind===2}U.isCoarse=n;function o(Q){return Q.kind===1}U.isSpheres=o;function i(Q){return Q.kind===2}U.isGaussians=i;function a(Q,O,q,X,F,Y,$,ce,ie){switch(F){case 0:return new g(Q,O,q,X,Y,ce,jn.createMapping($,Y.atomicConformation),ie??x());case 1:return T(Q,O,q,X,Y,1,ce,jn.createMapping($,Y.coarseConformation.spheres,f(Y)),ie??v());case 2:return T(Q,O,q,X,Y,2,ce,jn.createMapping($,Y.coarseConformation.gaussians,y(Y)),ie??v())}}U.create=a;function s(Q){let O=xl.Mutable();for(let q=0,X=Q.length;q<X;q++)O.set(Q[q].id,q);return O}function l(Q){let O=[];for(let q=0,X=Q.length;q<X;q++)O.push(Q[q].id);return Ro(O)}function u(Q){let O={};return{elements:Q[0].elements,units:Q,get unitIndexMap(){return O.unitIndexMap||(O.unitIndexMap=s(Q)),O.unitIndexMap},hashCode:m(Q[0]),transformHash:l(Q)}}U.SymmetryGroup=u,(q=>{function Q(X,F){return X.hashCode!==F.hashCode?!1:Be.areEqual(X.elements,F.elements)}q.areInvariantElementsEqual=Q;function O(X){let F=xl.Mutable();for(let Y=0,$=X.length;Y<$;++Y){let ce=X[Y];for(let ie=0,oe=ce.units.length;ie<oe;++ie)F.set(ce.units[ie].id,Y)}return F}q.getUnitSymmetryGroupsIndexMap=O})(u=U.SymmetryGroup||={});function c(Q){return U.isAtomic(Q)?Q.model.atomicConformation.id:Q.model.coarseConformation.id}U.conformationId=c;function m(Q){return Du(Q.invariantId,Be.hashCode(Q.elements))}U.hashUnit=m;let d;($=>($[$.None=0]="None",$[$.MultiChain=1]="MultiChain",$[$.Partitioned=2]="Partitioned",$[$.FastBoundary=4]="FastBoundary",$[$.Water=8]="Water",$[$.CoarseGrained=16]="CoarseGrained"))(d=U.Trait||={});let p;(q=>(q.is=na.has,q.create=na.create))(p=U.Traits||={});function h(){return{}}function f(Q){let O=Q.coarseConformation.spheres.radius;return q=>O[q]}function y(Q){return O=>0}class g{constructor(O,q,X,F,Y,$,ce,ie){this.kind=0;this.objectPrimitive="atomistic";this._transientCache=void 0;this.id=O,this.invariantId=q,this.chainGroupId=X,this.traits=F,this.model=Y,this.elements=$,this.conformation=ce,this.residueIndex=Y.atomicHierarchy.residueAtomSegments.index,this.chainIndex=Y.atomicHierarchy.chainAtomSegments.index,this.props=ie}get transientCache(){return this._transientCache===void 0&&(this._transientCache=new Map),this._transientCache}getChild(O){return O.length===this.elements.length?this:new g(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,O,this.conformation,x())}getCopy(O,q,X,F){let Y=new g(O,q,X,this.traits,this.model,this.elements,this.conformation,this.props);return F?.propagateTransientCache&&(Y._transientCache=this._transientCache),Y}applyOperator(O,q,X=!1){let F=X?q:jn.compose(this.conformation.operator,q);return new g(O,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,jn.createMapping(F,this.model.atomicConformation,this.conformation.r),this.props)}remapModel(O,q,X){X||(X={...this.props,bonds:q&&!this.props.bonds?.props?.canRemap?void 0:E(this,this.props.bonds,O,q)},U.isSameConformation(this,O)||(X.boundary=void 0,X.lookup3d=void 0,X.principalAxes=void 0));let F=this.conformation.operator,Y=wo.Provider.get(O);if(F.spgrOp!==-1&&Y&&Y!==wo.Provider.get(this.model)){let[ce,ie,oe]=F.hkl,{toFractional:W}=Y.spacegroup.cell,N=b.transformMat4(b(),Ft.getCenter(O),W);F=Ns.getSymmetryOperatorRef(Y.spacegroup,F.spgrOp,ce,ie,oe,N)}let $=this.model.atomicConformation!==O.atomicConformation||F!==this.conformation.operator?jn.createMapping(F,O.atomicConformation):this.conformation;return new g(this.id,this.invariantId,this.chainGroupId,this.traits,O,this.elements,$,X)}get boundary(){if(this.props.boundary)return this.props.boundary;let{x:O,y:q,z:X}=this.model.atomicConformation;return this.props.boundary=p.is(this.traits,4)?DM({x:O,y:q,z:X,indices:this.elements}):lf({x:O,y:q,z:X,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d;let{x:O,y:q,z:X}=this.model.atomicConformation;return this.props.lookup3d=Cc({x:O,y:q,z:X,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=Z9(this),this.props.principalAxes)}get bonds(){if(this.props.bonds)return this.props.bonds;let O=wM.get(this.model),q=O.get(this.elements);return q||(q=Cle(this),q.props?.cacheable&&O.set(this.elements,q)),this.props.bonds=q,this.props.bonds}get rings(){return this.props.rings?this.props.rings:(this.props.rings=lx.create(this),this.props.rings)}get resonance(){return this.props.resonance?this.props.resonance:(this.props.resonance=Kle(this),this.props.resonance)}get polymerElements(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=Ole(this),this.props.polymerElements)}get gapElements(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=Ule(this),this.props.gapElements)}get nucleotideElements(){return this.props.nucleotideElements?this.props.nucleotideElements:(this.props.nucleotideElements=zle(this),this.props.nucleotideElements)}get proteinElements(){return this.props.proteinElements?this.props.proteinElements:(this.props.proteinElements=Hle(this),this.props.proteinElements)}get residueCount(){if(this.props.residueCount!==void 0)return this.props.residueCount;let O=0,q=Xt.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);for(;q.hasNext;)q.move(),O+=1;return this.props.residueCount=O,this.props.residueCount}getResidueIndex(O){return this.residueIndex[this.elements[O]]}}U.Atomic=g;function x(){return h()}class S{constructor(O,q,X,F,Y,$,ce,ie,oe){this._transientCache=void 0;this.kind=$,this.objectPrimitive=$===1?"sphere":"gaussian",this.id=O,this.invariantId=q,this.chainGroupId=X,this.traits=F,this.model=Y,this.elements=ce,this.conformation=ie,this.coarseElements=$===1?Y.coarseHierarchy.spheres:Y.coarseHierarchy.gaussians,this.coarseConformation=$===1?Y.coarseConformation.spheres:Y.coarseConformation.gaussians,this.props=oe}get transientCache(){return this._transientCache===void 0&&(this._transientCache=new Map),this._transientCache}getChild(O){return O.length===this.elements.length?this:T(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,O,this.conformation,v())}getCopy(O,q,X,F){let Y=T(O,q,X,this.traits,this.model,this.kind,this.elements,this.conformation,this.props);return F?.propagateTransientCache&&(Y._transientCache=this._transientCache),Y}applyOperator(O,q,X=!1){let F=X?q:jn.compose(this.conformation.operator,q);return T(O,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,jn.createMapping(F,this.getCoarseConformation(),this.conformation.r),this.props)}remapModel(O,q,X){let F=this.getCoarseConformation(),Y=I(this.kind,O);X||(X={...this.props},U.isSameConformation(this,O)||(X.boundary=void 0,X.lookup3d=void 0,X.principalAxes=void 0));let $=F!==Y?jn.createMapping(this.conformation.operator,Y,this.kind===1?f(O):y(O)):this.conformation;return new S(this.id,this.invariantId,this.chainGroupId,this.traits,O,this.kind,this.elements,$,X)}get boundary(){if(this.props.boundary)return this.props.boundary;let{x:O,y:q,z:X}=this.getCoarseConformation();return this.props.boundary=p.is(this.traits,4)?DM({x:O,y:q,z:X,indices:this.elements}):lf({x:O,y:q,z:X,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d;let{x:O,y:q,z:X}=this.getCoarseConformation();return this.props.lookup3d=Cc({x:O,y:q,z:X,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=Z9(this),this.props.principalAxes)}get polymerElements(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=Gle(this),this.props.polymerElements)}get gapElements(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=Nle(this),this.props.gapElements)}getCoarseConformation(){return I(this.kind,this.model)}}function I(Q,O){return Q===1?O.coarseConformation.spheres:O.coarseConformation.gaussians}function v(){return h()}class A extends S{}U.Spheres=A;class _ extends S{}U.Gaussians=_;function T(Q,O,q,X,F,Y,$,ce,ie){return new S(Q,O,q,X,F,Y,$,ce,ie)}function w(Q,O){return Q.chainGroupId===O.chainGroupId&&Q.conformation.operator.name===O.conformation.operator.name}U.areSameChainOperatorGroup=w;function D(Q,O){return Z.areEqual(Q.conformation.operator.matrix,O.conformation.operator.matrix,1e-6)}U.areOperatorsEqual=D;function M(Q,O){return Q===O?!0:Be.areEqual(Q.elements,O.elements)?R(Q,O.model):!1}U.areConformationsEqual=M;function E(Q,O,q,X){if(!O)return;if(Q.model.atomicConformation.id===q.atomicConformation.id)return O;let F=Do.Provider.get(Q.model);if(F){let Y=Do.Provider.get(q);return!Y||F===Y?O:void 0}return O.props?.canRemap||!X||R(Q,q)?O:void 0}function R(Q,O){let q=Ft.CoordinatesHistory.get(Ft.getRoot(O));if(q)return q.areEqual(Q.elements,Q.kind,O);let X=Q.elements,{x:F,y:Y,z:$}=Q.conformation.coordinates,{x:ce,y:ie,z:oe}=k(Q.kind,O);for(let W=0,N=X.length;W<N;W++){let j=X[W];if(F[j]!==ce[j]||Y[j]!==ie[j]||$[j]!==oe[j])return!1}return!0}U.isSameConformation=R;function k(Q,O){return Q===0?O.atomicConformation:Q===1?O.coarseConformation.spheres:O.coarseConformation.gaussians}U.getModelConformationOfKind=k;function B(Q){return k(Q.kind,Q.model)}U.getConformation=B;function L(Q,O){return Q===0?O.atomicHierarchy:Q===1?O.coarseHierarchy.spheres:O.coarseHierarchy.gaussians}U.getModelHierarchyOfKind=L;function V(Q){return L(Q.kind,Q.model)}U.getHierarchy=V})(me||={});var Ov;(n=>{function e(o,i,a,s){o.indices[o.count]=a,o.units[o.count]=i,o.squaredDistances[o.count]=s,o.count++}n.add=e;function t(){return{count:0,indices:[],units:[],squaredDistances:[]}}n.create=t;function r(o,i){for(let a=0;a<i.count;++a)o.indices[a]=i.indices[a],o.units[a]=i.units[a],o.squaredDistances[a]=i.squaredDistances[a];return o.count=i.count,o}n.copy=r})(Ov||={});function Gv(){return{result:Ov.create(),closeUnitsResult:Gu.create(),unitGroupResult:Gu.create()}}var EM=class{constructor(t){this.structure=t;this.pivot=b();this.heap=new wv;this.findContext=Gv();let{units:r,boundary:n}=t,o=r.length,i=new Float32Array(o),a=new Float32Array(o),s=new Float32Array(o),l=new Float32Array(o),u=b();for(let m=0;m<o;m++){let d=r[m],p=d.boundary.sphere;b.transformMat4(u,p.center,d.conformation.operator.matrix),i[m]=u[0],a[m]=u[1],s[m]=u[2],l[m]=p.radius}let c={x:i,y:a,z:s,radius:l,indices:Se.ofBounds(0,o)};this.unitLookup=Cc(c,n)}findUnitIndices(t,r,n,o){return this.unitLookup.find(t,r,n,o)}find(t,r,n,o,i){return this._find(t,r,n,o,i??this.findContext)}_find(t,r,n,o,i){Gu.reset(i.result);let{units:a}=this.structure,s=this.unitLookup.find(t,r,n,o,i.closeUnitsResult);if(s.count===0)return i.result;for(let l=0,u=s.count;l<u;l++){let c=a[s.indices[l]];b.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);let d=c.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],o,i.unitGroupResult);for(let p=0,h=d.count;p<h;p++)Ov.add(i.result,c,d.indices[p],d.squaredDistances[p])}return i.result}nearest(t,r,n,o=1,i){return this._nearest(t,r,n,o,i??this.findContext)}_nearest(t,r,n,o,i){let a=i.result,s=this.heap;Gu.reset(a),s.clear();let{units:l}=this.structure,u=0,c=this.unitLookup.nearest(t,r,n,l.length,p=>(u+=l[p].elements.length)>=o,i.closeUnitsResult);if(c.count===0)return a;let m=0,d=-Number.MAX_VALUE;for(let p=0,h=c.count;p<h;p++){let f=c.squaredDistances[p];if(m>=o&&d<f)break;b.set(this.pivot,t,r,n);let y=l[c.indices[p]];y.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,y.conformation.operator.inverse);let x=y.lookup3d.nearest(this.pivot[0],this.pivot[1],this.pivot[2],o,void 0,i.unitGroupResult);if(x.count!==0){m+=x.count,d=Math.max(d,x.squaredDistances[x.count-1]);for(let S=0,I=x.count;S<I;S++)s.insert(x.squaredDistances[S],{index:x.indices[S],unit:y})}}if(o===1){let p=s.findMinimum();if(p){let{key:h}=p,{unit:f,index:y}=p.value;Ov.add(a,f,y,h)}}else for(;!s.isEmpty()&&a.count<o;){let p=s.extractMinimum(),{key:h}=p,{unit:f,index:y}=p.value;Ov.add(a,f,y,h)}return a}findIntoBuilder(t,r,n,o,i){let{units:a}=this.structure,s=this.unitLookup.find(t,r,n,o);if(s.count!==0)for(let l=0,u=s.count;l<u;l++){let c=a[s.indices[l]];b.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);let d=c.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],o);if(d.count===0)continue;let p=c.elements;i.beginUnit(c.id);for(let h=0,f=d.count;h<f;h++)i.addElement(p[d.indices[h]]);i.commitUnit()}}findIntoBuilderIf(t,r,n,o,i,a){let{units:s}=this.structure,l=this.unitLookup.find(t,r,n,o);if(l.count===0)return;let u=K.Location.create(this.structure);for(let c=0,m=l.count;c<m;c++){let d=s[l.indices[c]];b.set(this.pivot,t,r,n),d.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,d.conformation.operator.inverse);let h=d.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],o);if(h.count===0)continue;let f=d.elements;u.unit=d,i.beginUnit(d.id);for(let y=0,g=h.count;y<g;y++)u.element=f[h.indices[y]],a(u)&&i.addElement(u.element);i.commitUnit()}}findIntoBuilderWithRadius(t,r,n,o,i,a,s,l){let{units:u}=this.structure,c=this.unitLookup.find(t,r,n,a);if(c.count===0)return;let m=K.Location.create(this.structure),d=o+i+a;for(let p=0,h=c.count;p<h;p++){let f=u[c.indices[p]];b.set(this.pivot,t,r,n),f.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);let g=f.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],d);if(g.count===0)continue;let x=f.elements;m.unit=f,l.beginUnit(f.id);for(let S=0,I=g.count;S<I;S++){m.element=x[g.indices[S]];let v=s(m);Math.sqrt(g.squaredDistances[S])-o-v>a||l.addElement(x[g.indices[S]])}l.commitUnit()}}check(t,r,n,o){let{units:i}=this.structure,a=this.unitLookup.find(t,r,n,o);if(a.count===0)return!1;for(let s=0,l=a.count;s<l;s++){let u=i[a.indices[s]];if(b.set(this.pivot,t,r,n),u.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,u.conformation.operator.inverse),u.lookup3d.check(this.pivot[0],this.pivot[1],this.pivot[2],o))return!0}return!1}approxNearest(t,r,n,o,i){return this._approxNearest(t,r,n,o,i??this.findContext)}_approxNearest(t,r,n,o,i){Gu.reset(i.result);let{units:a}=this.structure,s=this.unitLookup.find(t,r,n,o,i.closeUnitsResult);if(s.count===0)return i.result;let l=Number.MAX_VALUE;for(let u=0,c=s.count;u<c;u++){let m=a[s.indices[u]];b.set(this.pivot,t,r,n),m.conformation.operator.isIdentity||b.transformMat4(this.pivot,this.pivot,m.conformation.operator.inverse);let p=m.lookup3d.approxNearest(this.pivot[0],this.pivot[1],this.pivot[2],o,i.unitGroupResult);for(let h=0,f=p.count;h<f;h++)p.squaredDistances[h]<l&&(Ov.add(i.result,m,p.indices[h],p.squaredDistances[h]),l=p.squaredDistances[h])}return i.result}get boundary(){return this.structure.boundary}};function oy(e,t){if(t.length===0)return De.Empty;if(t.length===1)return t[0];let r=new Map,n=new Set;for(let{units:i}of t)for(let a=0,s=i.length;a<s;a++){let l=i[a];if(r.has(l.id)){if(n.has(l.id))continue;let u=Be.union(r.get(l.id),l.elements);r.set(l.id,u),u.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}else r.set(l.id,l.elements),l.elements.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}let o=e.subsetBuilder(!0);return r.forEach(dze,o),o.getStructure()}function dze(e,t){this.setUnit(t,e)}function Jle(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;let r=e.units,n=t.unitMap;for(let o=0,i=r.length;o<i;o++){let a=r[o];if(!n.has(a.id))return!1;let s=n.get(a.id);if(!Be.areEqual(a.elements,s.elements))return!1}return!0}function Uv(e,t){if(e===t)return!0;let r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);let o=r.units,i=n.unitMap;for(let a=0,s=o.length;a<s;a++){let l=o[a];if(!i.has(l.id))continue;let u=i.get(l.id);if(Be.areIntersecting(l.elements,u.elements))return!0}return!1}function MM(e,t){if(e===t)return e;if(!Uv(e,t))return De.Empty;let r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);let o=r.units,i=n.unitMap,a=[];for(let s=0,l=o.length;s<l;s++){let u=o[s];if(!i.has(u.id))continue;let c=i.get(u.id);if(Be.areIntersecting(u.elements,c.elements)){let m=Be.intersect(u.elements,c.elements);a[a.length]=u.getChild(m)}}return De.create(a,{parent:e.parent||t.parent})}function Nv(e,t){if(e===t)return De.Empty;if(!Uv(e,t))return e;let r=e.units,n=t.unitMap,o=[];for(let i=0,a=r.length;i<a;i++){let s=r[i];if(!n.has(s.id)){o[o.length]=s;continue}let l=n.get(s.id),u=Be.subtract(s.elements,l.elements);u.length>0&&(o[o.length]=s.getChild(u))}return De.create(o,{parent:e.parent||t.parent})}var at;(y=>{function e(g,x){return{kind:"singletons",source:g,structure:x}}y.Singletons=e;function t(g,x){return{kind:"sequence",source:g,structures:x}}y.Sequence=t;function r(g){return e(g,De.Empty)}y.Empty=r;function n(g){return g.kind==="singletons"}y.isSingleton=n;function o(g){return n(g)?g.structure.units.length===0:g.structures.length===0}y.isEmpty=o;function i(g){return n(g)?g.structure.elementCount:g.structures.length}y.structureCount=i;function a(g){return o(g)?De.Empty:n(g)?g.structure:oy(g.source,g.structures)}y.unionStructure=a;function s(g){let x=[],{unitMap:S}=g.source;for(let I of a(g).units)I===S.get(I.id)?x[x.length]={unit:I,indices:Se.ofBounds(0,I.elements.length)}:x[x.length]={unit:I,indices:Se.ofSortedArray(Be.indicesOf(S.get(I.id).elements,I.elements))};return K.Loci(g.source,x)}y.toLociWithCurrentUnits=s;function l(g){let x=[],{unitMap:S}=g.source;for(let I of a(g).units){let v=S.get(I.id);v===I?x[x.length]={unit:v,indices:Se.ofBounds(0,v.elements.length)}:x[x.length]={unit:v,indices:Se.ofSortedArray(Be.indicesOf(v.elements,I.elements))}}return K.Loci(g.source,x)}y.toLociWithSourceUnits=l;function u(g,x,S){return x.length===0?r(g):S?e(g,oy(g,x)):t(g,x)}class c{constructor(x){this.source=x;this.structures=[];this.allSingletons=!0}add(x){let S=x.elementCount;S!==0&&(this.structures[this.structures.length]=x,S!==1&&(this.allSingletons=!1))}getSelection(){return u(this.source,this.structures,this.allSingletons)}}class m{constructor(x){this.structure=x;this.structures=[];this.allSingletons=!0;this.uniqueSets=Av(De.hashCode,De.areUnitIdsAndIndicesEqual)}add(x){let S=x.elementCount;S===0||!this.uniqueSets.add(x)||(this.structures[this.structures.length]=x,S!==1&&(this.allSingletons=!1))}getSelection(){return u(this.structure,this.structures,this.allSingletons)}}function d(g){return new c(g)}y.LinearBuilder=d;function p(g){return new m(g)}y.UniqueBuilder=p;function h(g,x){let S=0;if(y.isSingleton(g))for(let I of g.structure.units){let{elements:v}=I;for(let A=0,_=v.length;A<_;A++){let T=De.create([I.getChild(Be.ofSingleton(v[A]))],{parent:g.source});x(T,S++)}}else for(let I of g.structures)x(I,S++)}y.forEach=h;function f(g,x){return n(g)?e(x,g.structure):t(x,g.structures)}y.withInputStructure=f})(at||={});var J9={};Bi(J9,{atomicHet:()=>xze,atomicSequence:()=>yze,bundleElementImpl:()=>Y9,bundleGenerator:()=>K9,defaultBondTest:()=>BM,spheres:()=>Cze,water:()=>bze});function pze(e){return!!e.items}function fze(e){let{and:t}=ne.core.logic,{eq:r,gre:n,lte:o}=ne.core.rel,{macromolecular:i,ihm:a,core:s}=ne.struct.atomProperty,l={};ul(e.label_entity_id)&&(l["entity-test"]=r([i.label_entity_id(),e.label_entity_id]));let u=[];ul(e.operator_name)&&u.push(r([s.operatorName(),e.operator_name])),ul(e.instance_id)&&u.push(r([s.instanceId(),e.instance_id])),ul(e.label_asym_id)&&u.push(r([i.label_asym_id(),e.label_asym_id])),ul(e.auth_asym_id)&&u.push(r([i.auth_asym_id(),e.auth_asym_id])),u.length===1?l["chain-test"]=u[0]:u.length>1&&(l["chain-test"]=t(u));let c=[];ul(e.label_seq_id)&&c.push(a.hasSeqId({0:e.label_seq_id})),ul(e.auth_seq_id)&&c.push(r([i.auth_seq_id(),e.auth_seq_id])),ul(e.pdbx_PDB_ins_code)&&c.push(r([i.pdbx_PDB_ins_code(),e.pdbx_PDB_ins_code])),(ul(e.beg_label_seq_id)||ul(e.end_label_seq_id))&&c.push(a.overlapsSeqIdRange({beg:e.beg_label_seq_id,end:e.end_label_seq_id})),ul(e.beg_auth_seq_id)&&c.push(n([i.auth_seq_id(),e.beg_auth_seq_id])),ul(e.end_auth_seq_id)&&c.push(o([i.auth_seq_id(),e.end_auth_seq_id])),c.length===1?l["residue-test"]=c[0]:c.length>1&&(l["residue-test"]=t(c));let m=[];return ul(e.label_comp_id)&&m.push(r([i.label_comp_id(),e.label_comp_id])),ul(e.auth_comp_id)&&m.push(r([i.auth_comp_id(),e.auth_comp_id])),ul(e.atom_id)&&m.push(r([i.id(),e.atom_id])),ul(e.atom_index)&&m.push(r([ne.struct.atomProperty.core.sourceIndex(),e.atom_index])),ul(e.label_atom_id)&&m.push(r([i.label_atom_id(),e.label_atom_id])),ul(e.auth_atom_id)&&m.push(r([i.auth_atom_id(),e.auth_atom_id])),ul(e.type_symbol)&&m.push(r([ne.struct.atomProperty.core.elementSymbol(),e.type_symbol.toUpperCase()])),m.length===1?l["atom-test"]=m[0]:m.length>1&&(l["atom-test"]=t(m)),ne.struct.generator.atomGroups(l)}function $le(e){let t=[];return eue(e,r=>t.push(fze(r))),t.length===1?t[0]:hze(t)}function hze(e){return ne.struct.combinator.merge(e.map(t=>ne.struct.modifier.union([t])))}function ul(e){return e!=null}function eue(e,t){if(pze(e))if(Array.isArray(e.items))if(e.prefix)for(let r of e.items)t(Object.assign({},e.prefix,r));else for(let r of e.items)t(r);else{let r={...e.prefix},n=Object.keys(e.items),o=e.items[n[0]].length;for(let i=0;i<o;i++){for(let a of n)r[a]=e.items[a][i];t(r)}}else t(e)}function tue(e,t,r){let n=$le(t);return Wd.fromExpression(e,n,r)}function gze(e,t,r){let n=tue(e,t,r);return zv.fromLoci(n)}var X2={forEachItem:eue,toExpression:$le,toLoci:tue,toBundle:gze};var zv;(p=>{p.Empty={hash:-1,elements:[]};function t(h,f){return a(at.toLociWithSourceUnits(at.Singletons(h,f)))}p.fromSubStructure=t;function r(h){return a(at.toLociWithSourceUnits(h))}p.fromSelection=r;function n(h,f,y){return a(Wd.fromExpression(h,f,y))}p.fromExpression=n;function o(h,f,y){return a(Wd.fromQuery(h,f,y))}p.fromQuery=o;function i(h,f,y){return X2.toBundle(h,f,y)}p.fromSchema=i;function a(h){let f=[];for(let x of h.elements){let{unit:S,indices:I}=x;if(Se.size(I)===0)continue;let v=[],A=[];if(Se.isInterval(I))Se.size(I)===1?A.push(xe.min(I)):v.push(xe.min(I),xe.max(I));else{let _=0,T=I.length;for(;_<T;){let w=_;for(_++;_<T&&I[_-1]+1===I[_];)_++;let D=_;if(D-w>2)v.push(I[w],I[D-1]);else for(let M=w;M<D;M++)A[A.length]=I[M]}}f.push({unit:S,set:Be.ofSortedArray(A),ranges:kn.ofSortedRanges(v)})}let y=new Map;for(let x=0,S=f.length;x<S;++x){let I=f[x],v=Du(Ro(I.ranges),Ro(I.set));if(y.has(v)){let{groupedUnits:A}=y.get(v);A.has(I.unit.invariantId)?A.get(I.unit.invariantId).push(I.unit.id):A.set(I.unit.invariantId,[I.unit.id])}else{let A=new Map;A.set(I.unit.invariantId,[I.unit.id]),y.set(v,{groupedUnits:A,set:I.set,ranges:I.ranges})}}let g=[];return y.forEach(x=>{let S=[];x.groupedUnits.forEach(I=>S.push(Be.ofUnsortedArray(I))),S.sort((I,v)=>I[0]-v[0]),g.push({groupedUnits:S,set:x.set,ranges:x.ranges})}),{hash:h.structure.hashCode,elements:g}}p.fromLoci=a;function s(h,f){let y=[];for(let g=0,x=h.length;g<x;++g){let S=h[g];f.unitMap.has(S)&&y.push(f.unitMap.get(S))}return y}function l(h,f){h.hash!==-1&&h.hash!==f.hashCode&&new Error("Bundle not compatible with given structure");let y=[];for(let g of h.elements)for(let x of g.groupedUnits){let S=s(x,f);if(S.length===0)continue;let I;if(g.ranges.length===0)I=g.set;else if(g.set.length===0)if(g.ranges.length===2)I=xe.ofRange(g.ranges[0],g.ranges[1]);else{let v=new Int32Array(kn.size(g.ranges));kn.forEach(g.ranges,(A,_)=>v[_]=A),I=Be.ofSortedArray(v)}else{let v=kn.size(g.ranges),A=new Int32Array(g.set.length+v);kn.forEach(g.ranges,(_,T)=>A[T]=_),A.set(g.set,v),I=Be.ofUnsortedArray(A)}for(let v of S)y.push({unit:v,indices:I})}return Wd(f,y)}p.toLoci=l;function u(h,f){h.hash!==-1&&h.hash!==f.hashCode&&new Error("Bundle not compatible with given structure");let y=[];for(let g of h.elements)for(let x of g.groupedUnits){let S=s(x,f);if(S.length===0)continue;let I=S[0].elements,v=kn.size(g.ranges),A=g.set.length,_=new Int32Array(A+v),T;if(v===0){for(let w=0,D=A;w<D;++w)_[w]=I[g.set[w]];T=Be.ofSortedArray(_)}else if(A===0)kn.forEach(g.ranges,(w,D)=>_[D]=I[w]),T=Be.ofSortedArray(_);else if(Be.min(g.set)>kn.max(g.ranges)){kn.forEach(g.ranges,(w,D)=>_[D]=I[w]);for(let w=0,D=A;w<D;++w)_[w+v]=I[g.set[w]];T=Be.ofSortedArray(_)}else if(kn.min(g.ranges)>Be.max(g.set)){for(let w=0,D=A;w<D;++w)_[w]=I[g.set[w]];kn.forEach(g.ranges,(w,D)=>_[D+A]=I[w]),T=Be.ofSortedArray(_)}else{kn.forEach(g.ranges,(w,D)=>_[D]=I[w]);for(let w=0,D=A;w<D;++w)_[w+v]=I[g.set[w]];T=Be.ofUnsortedArray(_)}for(let w of S)y.push(w.getChild(T))}return De.create(y,{parent:f})}p.toStructure=u;function c(h){return ne.internal.generator.bundleElement({groupedUnits:ne.core.type.list(h.groupedUnits.map(f=>ne.core.type.list(f))),ranges:ne.core.type.list(h.ranges),set:ne.core.type.list(h.set)})}function m(h){return ne.internal.generator.bundle({elements:ne.core.type.list(h.elements.map(c))})}p.toExpression=m;function d(h,f){if(h.elements.length!==f.elements.length)return!1;for(let y=0,g=h.elements.length;y<g;++y){let x=h.elements[y],S=f.elements[y];if(x.groupedUnits.length!==S.groupedUnits.length)return!1;for(let I=0,v=S.groupedUnits.length;I<v;++I)if(!Be.areEqual(x.groupedUnits[I],S.groupedUnits[I]))return!1;if(!Be.areEqual(x.set,S.set)||!kn.areEqual(x.ranges,S.ranges))return!1}return!0}p.areEqual=d})(zv||={});function BM(e){return ht.isCovalent(e.atomicBond.type)}function yze(){return function(t){let{inputStructure:r}=t,n=K.Location.create(r),o=[];for(let i of r.units){if(i.kind!==me.Kind.Atomic)continue;n.unit=i;let a=i.elements;if(n.element=a[0],qe.entity.type(n)!=="polymer")continue;let s=Xt.transientSegments(i.model.atomicHierarchy.residueAtomSegments,a),l=0;for(;s.hasNext;)l++,s.move();l<8||o.push(i)}return at.Singletons(r,De.create(o,{parent:r}))}}function bze(){return function(t){let{inputStructure:r}=t,n=K.Location.create(r),o=[];for(let i of r.units){if(i.kind!==me.Kind.Atomic)continue;n.unit=i;let a=i.elements;n.element=a[0],qe.entity.type(n)==="water"&&o.push(i)}return at.Singletons(r,De.create(o,{parent:r}))}}function xze(){return function(t){let{inputStructure:r}=t,n=K.Location.create(r),o=[];for(let i of r.units){if(i.kind!==me.Kind.Atomic)continue;n.unit=i;let a=i.elements;if(n.element=a[0],qe.entity.type(n)!=="water"){if(qe.entity.type(n)==="polymer"){let s=Xt.transientSegments(i.model.atomicHierarchy.residueAtomSegments,a),l=0;for(;s.hasNext;)l++,s.move();if(l>=8)continue}o.push(i)}}return at.Singletons(r,De.create(o,{parent:r}))}}function Cze(){return function(t){let{inputStructure:r}=t,n=[];for(let o of r.units)o.kind===me.Kind.Spheres&&n.push(o);return at.Singletons(r,De.create(n,{parent:r}))}}function Y9(e,t,r){return{groupedUnits:e,ranges:t,set:r}}function K9(e){return function(r){let n={hash:r.inputStructure.hashCode,elements:e};return at.Sequence(r.inputStructure,[zv.toStructure(n,r.inputStructure)])}}var ai=class{constructor(t,r){this.currentElementStack=[];this.currentAtomicBondStack=[];this.currentStructureStack=[];this.inputStructureStack=[];this.timeCreated=Mn();this.element=K.Location.create(void 0);this.currentStructure=void 0;this.atomicBond=new kM;this.currentSelection=void 0;this.inputStructure=t,this.timeoutMs=r&&r.timeoutMs||0,this.currentSelection=r&&r.currentSelection}pushCurrentElement(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=K.Location.create(void 0),this.element}popCurrentElement(){this.element=this.currentElementStack.pop()}pushCurrentBond(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new kM,this.atomicBond}popCurrentBond(){this.currentAtomicBondStack.length>0?this.atomicBond=this.currentAtomicBondStack.pop():this.atomicBond=void 0}pushCurrentStructure(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)}popCurrentStructure(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0}pushInputStructure(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t}popInputStructure(){if(this.inputStructureStack.length===0)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()}throwIfTimedOut(){if(this.timeoutMs!==0&&Mn()-this.timeCreated>this.timeoutMs)throw new Error(`The query took too long to execute (> ${this.timeoutMs/1e3}s).`)}tryGetCurrentSelection(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection}},kM=class{constructor(){this.a=K.Location.create(void 0);this.aIndex=0;this.b=K.Location.create(void 0);this.bIndex=0;this.type=ht.Flag.None;this.order=0;this.key=-1;this.testFn=BM}setStructure(t){this.a.structure=t,this.b.structure=t}setTestFn(t){this.testFn=t||BM}test(t,r){return this.testFn(t)?!0:r?(this.swap(),this.testFn(t)):!1}swap(){let t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;let r=this.a.unit;this.a.unit=this.b.unit,this.b.unit=r;let n=this.a.element;this.a.element=this.b.element,this.b.element=n}get length(){return K.Location.distance(this.a,this.b)}};var LM;(r=>{function e(n,o,i){return n(new ai(o,i))}r.run=e;function t(n,o,i){let a=n(new ai(o,i));return at.toLociWithSourceUnits(a)}r.loci=t})(LM||={});var tH={};Bi(tH,{all:()=>rue,atoms:()=>eH,bondedAtomicPairs:()=>Dze,chains:()=>vze,none:()=>VM,querySelection:()=>Rze,residues:()=>Sze,rings:()=>_ze});var Hv=class{constructor(t){this.source=t;this.set=Av(De.hashCode,De.areUnitIdsAndIndicesEqual);this.structures=[];this.allSingletons=!0}add(t){t.elementCount&&(t.elementCount!==1&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))}getSelection(){return this.allSingletons?at.Singletons(this.source,oy(this.source,this.structures)):at.Sequence(this.source,this.structures)}},FM=class{constructor(t){this.source=t;this.builders=[];this.builderMap=new Map}add(t,r,n){let o=this.builderMap.get(t);o||(o=this.source.subsetBuilder(!0),this.builders[this.builders.length]=o,this.builderMap.set(t,o)),o.addToUnit(r,n)}allSingletons(){for(let t=0,r=this.builders.length;t<r;t++)if(this.builders[t].elementCount>1)return!1;return!0}singletonSelection(){let t=this.source.subsetBuilder(!0),r=K.Location.create(this.source);for(let n=0,o=this.builders.length;n<o;n++)this.builders[n].setSingletonLocation(r),t.addToUnit(r.unit.id,r.element);return at.Singletons(this.source,t.getStructure())}fullSelection(){let t=new Array(this.builders.length);for(let r=0,n=this.builders.length;r<n;r++)t[r]=this.builders[r].getStructure();return at.Sequence(this.source,t)}getSelection(){return this.builders.length===0?at.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()}};var VM=e=>at.Sequence(e.inputStructure,[]),rue=e=>at.Singletons(e.inputStructure,e.inputStructure);function Sze(e){return eH({...e,groupBy:t=>qe.residue.key(t.element)})}function vze(e){return eH({...e,groupBy:t=>qe.chain.key(t.element)})}function cx(e){return!0}function Ize(e){return 0}function eH(e){if(!e||!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return rue;if(e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return Aze(e.atomTest);let t={unitTest:e.unitTest||cx,entityTest:e.entityTest||cx,chainTest:e.chainTest||cx,residueTest:e.residueTest||cx,atomTest:e.atomTest||cx,groupBy:e.groupBy||Ize};return e.groupBy?Pze(t):Tze(t)}function Aze(e){return function(r){let{inputStructure:n}=r,{units:o}=n,i=r.pushCurrentElement(),a=n.subsetBuilder(!0);i.structure=n;for(let s of o){i.unit=s;let l=s.elements;a.beginUnit(s.id);for(let u=0,c=l.length;u<c;u++)i.element=l[u],e(r)&&a.addElement(i.element);a.commitUnit(),r.throwIfTimedOut()}return r.popCurrentElement(),at.Singletons(n,a.getStructure())}}function Tze({unitTest:e,entityTest:t,chainTest:r,residueTest:n,atomTest:o}){return function(a){let{inputStructure:s}=a,{units:l}=s,u=a.pushCurrentElement(),c=s.subsetBuilder(!0),m=n===cx&&o===cx,d=o===cx;u.structure=s;for(let p of l){if(u.unit=p,!e(a))continue;let{elements:h,model:f}=p;if(c.beginUnit(p.id),p.kind===me.Kind.Atomic){let y=Xt.transientSegments(p.model.atomicHierarchy.chainAtomSegments,h),g=Xt.transientSegments(p.model.atomicHierarchy.residueAtomSegments,h);for(;y.hasNext;){let x=y.move();if(u.element=h[x.start],!(!t(a)||!r(a))){if(m){c.addElementRange(h,x.start,x.end);continue}for(g.setSegment(x);g.hasNext;){let S=g.move();if(u.element=h[S.start],!!n(a)){if(d){c.addElementRange(h,S.start,S.end);continue}for(let I=S.start,v=S.end;I<v;I++)u.element=h[I],o(a)&&c.addElement(u.element)}}}}}else{let{chainElementSegments:y}=p.kind===me.Kind.Spheres?f.coarseHierarchy.spheres:f.coarseHierarchy.gaussians,g=Xt.transientSegments(y,h);for(;g.hasNext;){let x=g.move();if(u.element=h[x.start],!(!t(a)||!r(a))){if(m){c.addElementRange(h,x.start,x.end);continue}for(let S=x.start,I=x.end;S<I;S++)u.element=h[S],n(a)&&c.addElement(u.element)}}}c.commitUnit(),a.throwIfTimedOut()}return a.popCurrentElement(),at.Singletons(s,c.getStructure())}}function Pze({unitTest:e,entityTest:t,chainTest:r,residueTest:n,atomTest:o,groupBy:i}){return function(s){let{inputStructure:l}=s,{units:u}=l,c=s.pushCurrentElement(),m=new FM(l);c.structure=l;for(let d of u){if(c.unit=d,!e(s))continue;let{elements:p,model:h}=d;if(d.kind===me.Kind.Atomic){let f=Xt.transientSegments(h.atomicHierarchy.chainAtomSegments,p),y=Xt.transientSegments(h.atomicHierarchy.residueAtomSegments,p);for(;f.hasNext;){let g=f.move();if(c.element=p[g.start],!(!t(s)||!r(s)))for(y.setSegment(g);y.hasNext;){let x=y.move();if(c.element=p[x.start],!!n(s))for(let S=x.start,I=x.end;S<I;S++)c.element=p[S],o(s)&&m.add(i(s),d.id,c.element)}}}else{let{chainElementSegments:f}=d.kind===me.Kind.Spheres?h.coarseHierarchy.spheres:h.coarseHierarchy.gaussians,y=Xt.transientSegments(f,p);for(;y.hasNext;){let g=y.move();if(c.element=p[g.start],!(!t(s)||!r(s)))for(let x=g.start,S=g.end;x<S;x++)c.element=p[x],n(s)&&m.add(i(s),d.id,c.element)}}s.throwIfTimedOut()}return s.popCurrentElement(),m.getSelection()}}function $9(e,t,r){let n=new Int32Array(t.length);for(let o=0,i=t.length;o<i;o++)n[o]=e.elements[t[o]];return De.create([e.getChild(Be.ofSortedArray(n))],{parent:r})}function _ze(e,t){return function(n){let{units:o}=n.inputStructure,i=at.LinearBuilder(n.inputStructure);if(!e||e.length===0){for(let a of o)if(me.isAtomic(a))if(t)for(let s of a.rings.aromaticRings)i.add($9(a,a.rings.all[s],n.inputStructure));else for(let s of a.rings.all)i.add($9(a,s,n.inputStructure))}else{let a=Tn.create();for(let s=0;s<e.length;s++)Tn.add(a,e[s],e[s]);for(let s of o){if(!me.isAtomic(s))continue;let l=s.rings;for(let u of a.array)if(l.byFingerprint.has(u))for(let c of l.byFingerprint.get(u))t&&!l.aromaticRings.includes(c)||i.add($9(s,l.all[c],n.inputStructure))}}return i.getSelection()}}function Rze(e,t,r=!1){return function(o){let i=e(o);if(at.structureCount(i)===0)return i;let a=r?Nv(o.inputStructure,at.unionStructure(i)):at.unionStructure(i);if(a.elementCount===0)return at.Empty(o.inputStructure);o.throwIfTimedOut(),o.pushInputStructure(a);let s=t(o);return o.popInputStructure(),at.withInputStructure(s,o.inputStructure)}}function Dze(e){return function(r){let n=r.inputStructure,o=n.interUnitBonds,i=at.UniqueBuilder(r.inputStructure);r.pushCurrentBond();let a=r.atomicBond;a.setTestFn(e),a.setStructure(n);for(let s of n.units){if(s.kind!==me.Kind.Atomic)continue;let{offset:l,b:u,edgeProps:{flags:c,order:m,key:d}}=s.bonds;a.a.unit=s,a.b.unit=s;for(let p=0,h=s.elements.length;p<h;p++){a.aIndex=p,a.a.element=s.elements[p];for(let f=l[p],y=l[p+1];f<y;f++)if(a.bIndex=u[f],a.b.element=s.elements[u[f]],a.type=c[f],a.order=m[f],a.key=d[f],a.test(r,!1)){let g=n.subsetBuilder(!1);g.beginUnit(s.id),g.addElement(a.a.element),g.addElement(a.b.element),g.commitUnit(),i.add(g.getStructure())}}}for(let s of o.edges)if(a.a.unit=n.unitMap.get(s.unitA),a.a.element=a.a.unit.elements[s.indexA],a.aIndex=s.indexA,a.b.unit=n.unitMap.get(s.unitB),a.b.element=a.b.unit.elements[s.indexB],a.bIndex=s.indexB,a.order=s.props.order,a.type=s.props.flag,a.key=s.props.key,a.test(r,!1)){let l=n.subsetBuilder(!1);l.addToUnit(a.a.unit.id,a.a.element),l.addToUnit(a.b.unit.id,a.b.element),i.add(l.getStructure())}return r.popCurrentBond(),i.getSelection()}}var uH={};Bi(uH,{exceptBy:()=>x9e,expandProperty:()=>S9e,includeConnected:()=>v9e,includeSurroundings:()=>g9e,intersectBy:()=>b9e,querySelection:()=>y9e,surroundingLigands:()=>A9e,union:()=>C9e,wholeResidues:()=>p9e});var z0=class{constructor(t){this.parent=t;this.ids=[];this.unitMap=xl.Mutable();this.parentId=-1;this.currentUnit=Tn.create();this.elementCount=0}addToUnit(t,r){let n=this.unitMap.get(t);if(n)Tn.add(n,r,r)&&this.elementCount++;else{let o=Tn.create();Tn.add(o,r,r),this.unitMap.set(t,o),this.ids[this.ids.length]=t,this.elementCount++}}has(t,r){let n=this.unitMap.get(t);return n?Tn.has(n,r):!1}beginUnit(t){this.parentId=t,this.unitMap.has(t)?this.currentUnit=this.unitMap.get(t):this.currentUnit=this.currentUnit.array.length>0?Tn.create():this.currentUnit}addElement(t){Tn.add(this.currentUnit,t,t)&&this.elementCount++}commitUnit(){this.currentUnit.array.length===0||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}getStructure(){if(this.isEmpty)return De.Empty;let t=[];Fs(this.ids);let r=im.UnitEquivalenceBuilder();for(let n=0,o=this.ids.length;n<o;n++){let i=this.ids[n],a=this.parent.unitMap.get(i),s=this.unitMap.get(i).array,l=s.length;if(s.length===a.elements.length){t[t.length]=a,r.add(a.id,a);continue}l>1&&Fs(s);let u=a.getChild(Be.ofSortedArray(s)),c=r.add(u.id,u);u!==c&&(u=c.applyOperator(u.id,u.conformation.operator,!0)),t[t.length]=u}return De.create(t,{parent:this.parent})}get isEmpty(){return this.elementCount===0}};var nue={type_symbol:H.Schema.Aliased(an.atom_site.type_symbol),label_atom_id:an.atom_site.label_atom_id,auth_atom_id:an.atom_site.auth_atom_id,label_alt_id:an.atom_site.label_alt_id,label_comp_id:an.atom_site.label_comp_id,auth_comp_id:an.atom_site.auth_comp_id,pdbx_formal_charge:an.atom_site.pdbx_formal_charge},oue={group_PDB:an.atom_site.group_PDB,label_seq_id:an.atom_site.label_seq_id,auth_seq_id:an.atom_site.auth_seq_id,pdbx_PDB_ins_code:an.atom_site.pdbx_PDB_ins_code},iue={label_asym_id:an.atom_site.label_asym_id,auth_asym_id:an.atom_site.auth_asym_id,label_entity_id:an.atom_site.label_entity_id},rH;(t=>{function e(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}t.EmptyResidueKey=e})(rH||={});var H0;(a=>{function e(s,l){return s.residueAtomSegments.index[s.chainAtomSegments.offsets[l]]}a.chainStartResidueIndex=e;function t(s,l){return s.residueAtomSegments.index[s.chainAtomSegments.offsets[l+1]-1]+1}a.chainEndResidueIndexExcl=t;function r(s,l){return t(s,l)-e(s,l)}a.chainResidueCount=r;function n(s,l){return s.residueAtomSegments.offsets[l]}a.residueFirstAtomIndex=n;function o(s,l){return s.chainAtomSegments.index[l]}a.atomChainIndex=o;function i(s,l){return s.chainAtomSegments.index[s.residueAtomSegments.offsets[l]]}a.residueChainIndex=i})(H0||={});function jv(e,t,r,n){return{type:e,key:t,elements:r,getIndex:n}}var dt;(n=>{n.is=na.has,n.create=na.create;let r;(x=>(x[x._=0]="_",x[x.H=1]="H",x[x.B=2]="B",x[x.E=4]="E",x[x.G=8]="G",x[x.I=16]="I",x[x.S=32]="S",x[x.T=64]="T",x[x.T3=128]="T3",x[x.T4=256]="T4",x[x.T5=512]="T5",x[x.T3S=1024]="T3S",x[x.T4S=2048]="T4S",x[x.T5S=4096]="T5S"))(r=n.Flag||={})})(dt||={});var j0=class{constructor(t,r,n){this.partner1=Math.min(t,r),this.partner2=Math.max(t,r),this.type=n}};function aue(e){let{unit:t,flags:r,proteinInfo:n}=e,o=t.conformation,{traceElementIndex:i}=t.model.atomicHierarchy.derived.residue,{residueIndices:a,nIndices:s}=n,l=a.length,u=(g,x)=>g===-1?b.setNaN(x):o.position(g,x),c=b(),m=b(),d=b(),p=b(),h=b(),f=b(),y=b();e:for(let g=2;g<l-2;g++){for(let w=0;w<4;w++){let D=g+w-2;if(u(i[D],p),u(s[D+1],h),b.squaredDistance(p,h)>6.25)continue e}let x=a[g-2],S=a[g],I=a[g+2],v=i[x],A=i[S],_=i[I];u(v,c),u(A,m),u(_,d),b.sub(f,c,m),b.sub(y,m,d);let T=Ea(b.angle(f,y));T&&T>70&&(r[g]|=dt.Flag.S)}}var wze=9,OM=-27.888,Eze=-.5,sue=-9.9;function Mze(e,t,r,n){let o=b.distance(e,n),i=b.distance(t,n),a=b.distance(t,r),s=b.distance(e,r),l=OM/o-OM/i,u=OM/a-OM/s,c=l+u;return c<sue?sue:c}function lue(e,t,r){let{residueIndices:n,cIndices:o,hIndices:i,nIndices:a,oIndices:s}=t,{index:l}=e.model.atomicHierarchy,u=e.conformation,{traceElementIndex:c}=e.model.atomicHierarchy.derived.residue,m=n.length,d=[],p=[],h=[],f=b(),y=b(),g=b(),x=b(),S=b(),I=b(),v=b();for(let A=0,_=n.length;A<_;++A){let T=A,w=n[A],D=s[T],M=o[T],E=c[w];if(D===-1||M===-1||l.findAtomOnResidue(w,"OXT")!==-1)continue;u.invariantPosition(D,f),u.invariantPosition(M,y),u.invariantPosition(E,g);let{indices:R,count:k}=r.find(g[0],g[1],g[2],wze);for(let B=0;B<k;++B){let L=R[B];if(L===T||L-1===T||L+1===T)continue;let V=a[L];if(V===-1)continue;u.invariantPosition(V,x);let U=i[L];if(U===-1){if(L===0)continue;let O=L-1,q=s[O],X=o[O];if(q===-1||X===-1)continue;u.invariantPosition(q,v),u.invariantPosition(X,I),b.sub(S,I,v);let F=b.distance(v,I);b.scaleAndAdd(S,x,S,1/F)}else u.invariantPosition(U,S);let Q=Mze(f,y,x,S);Q>Eze||(d[d.length]=T,p[p.length]=L,h[h.length]=Q)}}return Bze(m,d,p,h)}function Bze(e,t,r,n){let o=new ns.DirectedEdgeBuilder(e,t,r),i=new Float32Array(o.slotCount);for(let a=0,s=o.edgeCount;a<s;a++)o.addNextEdge(),o.assignProperty(i,n[a]);return o.createGraph({energies:n})}function uue(e){let{proteinInfo:t,hbonds:r,flags:n}=e,o=[dt.Flag.T3S,dt.Flag.T4S,dt.Flag.T5S,dt.Flag.T3,dt.Flag.T4,dt.Flag.T5];for(let i=0;i<3;i++)for(let a=0,s=t.residueIndices.length-1;a<s;++a)if(r.getDirectedEdgeIndex(a,a+i+3)!==-1)if(n[a]|=o[i+3]|o[i],e.params.oldDefinition)for(let l=1;l<i+3;++l)n[a+l]|=o[i+3]|dt.Flag.T;else for(let l=0;l<=i+3;++l)n[a+l]|=o[i+3]|dt.Flag.T}function cue(e){let{proteinInfo:t,flags:r}=e,n=t.residueIndices.length,o=[dt.Flag.T3S,dt.Flag.T4S,dt.Flag.T5S,dt.Flag.T3,dt.Flag.T4,dt.Flag.T5],i=[0,0,0,dt.Flag.G,dt.Flag.H,dt.Flag.I],a=e.params.oldOrdering?[4,3,5]:[3,4,5];for(let s=0;s<a.length;s++){let l=a[s];for(let u=1,c=n-l;u<c;u++){let m=dt.create(r[u]),d=dt.create(r[u-1]),p=dt.create(r[u+1]);if(e.params.oldOrdering){if(l===3&&(dt.is(m,dt.Flag.H)||dt.is(p,dt.Flag.H))||l===5&&(dt.is(m,dt.Flag.H)||dt.is(m,dt.Flag.G)||dt.is(p,dt.Flag.H)||dt.is(p,dt.Flag.G)))continue}else if(l===4&&(dt.is(m,dt.Flag.G)||dt.is(p,dt.Flag.G))||l===5&&(dt.is(m,dt.Flag.H)||dt.is(m,dt.Flag.G)||dt.is(p,dt.Flag.H)||dt.is(p,dt.Flag.G)))continue;if(dt.is(m,o[l])&&dt.is(m,o[l-3])&&dt.is(d,o[l])&&dt.is(d,o[l-3]))if(e.params.oldDefinition)for(let h=0;h<l;h++)r[u+h]|=i[l];else for(let h=-1;h<=l;h++)r[u+h]|=i[l]}}}function kze(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(t.type===0){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function Lze(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&t.nextLadder===0?e.type===0?mue(e,t):mue(t,e):!1}function mue(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function pue(e){let{bridges:t,ladders:r}=e;for(let n=0;n<t.length;n++){let o=t[n],i=!1;for(let a=0;a<r.length;a++){let s=r[a];kze(s,o)&&(i=!0,s.firstEnd++,o.type===0?s.secondEnd++:s.secondStart--)}i||(r[r.length]={previousLadder:0,nextLadder:0,firstStart:o.partner1,firstEnd:o.partner1,secondStart:o.partner2,secondEnd:o.partner2,type:o.type})}for(let n=0;n<r.length;n++){let o=r[n];for(let i=n;i<r.length;i++){let a=r[i];Lze(o,a)&&(o.nextLadder=i,a.previousLadder=n)}}}function fue(e){let{proteinInfo:t,hbonds:r,flags:n,bridges:o}=e,{offset:i,b:a}=r,s,l;for(let u=0,c=t.residueIndices.length;u<c;++u)for(let m=i[u],d=i[u+1];m<d;m++){let p=a[m];u>p||(s=u+1,l=p,s!==l&&r.getDirectedEdgeIndex(l,s+1)!==-1&&(n[s]|=dt.Flag.B,n[l]|=dt.Flag.B,o[o.length]=new j0(s,l,0)),s=u,l=p-1,s!==l&&r.getDirectedEdgeIndex(l-1,s)!==-1&&(n[s]|=dt.Flag.B,n[l]|=dt.Flag.B,o[o.length]=new j0(l,s,0)),s=u,l=p,s!==l&&r.getDirectedEdgeIndex(l,s)!==-1&&(n[s]|=dt.Flag.B,n[l]|=dt.Flag.B,o[o.length]=new j0(l,s,1)),s=u+1,l=p-1,s!==l&&r.getDirectedEdgeIndex(l-1,s+1)!==-1&&(n[s]|=dt.Flag.B,n[l]|=dt.Flag.B,o[o.length]=new j0(l,s,1)))}o.sort((u,c)=>u.partner1>c.partner1?1:u.partner1<c.partner1?-1:0)}function hue(e){return dt.is(e,dt.Flag.G)||dt.is(e,dt.Flag.H)||dt.is(e,dt.Flag.I)}function gue(e){let{ladders:t,flags:r}=e;for(let n=0;n<t.length;n++){let o=t[n];for(let a=o.firstStart;a<=o.firstEnd;a++){let s=o.firstStart-a,l=o.secondStart-s;o.firstStart!==o.firstEnd?(r[a]|=dt.Flag.E,r[l]|=dt.Flag.E):(!hue(r[a])&&dt.is(r[a],dt.Flag.E)&&(r[a]|=dt.Flag.B),!hue(r[l])&&dt.is(r[l],dt.Flag.E)&&(r[l]|=dt.Flag.B))}if(o.nextLadder===0)continue;let i=t[o.nextLadder];for(let a=o.firstStart;a<=i.firstEnd;a++)r[a]|=dt.Flag.E;if(o.type===0)for(let a=o.secondStart;a<=i.secondEnd;a++)r[a]|=dt.Flag.E;else for(let a=i.secondEnd;a<=o.secondStart;a++)r[a]|=dt.Flag.E}}function yue(e,t){let{cIndices:r,nIndices:n,residueIndices:o}=t,i=e.conformation,{index:a}=e.model.atomicHierarchy,{traceElementIndex:s}=e.model.atomicHierarchy.derived.residue,l=o.length,u=(v,A)=>v===-1?b.setNaN(A):i.position(v,A),c=b(),m=b(),d=b(),p=b(),h=b(),f=b(),y=b(),g=b(),x=b();if(l===0)return{phi:new Float32Array(0),psi:new Float32Array(0)};let S=new Float32Array(l-1),I=new Float32Array(l-1);u(-1,c),u(-1,m),u(-1,d),u(r[0],p),u(s[o[0]],h),u(n[0],f),u(r[1],y),u(s[o[1]],g),u(n[1],x);for(let v=0;v<l-1;++v)a.findAtomOnResidue(o[v],"OXT")===-1&&(S[v]=Ea(b.dihedralAngle(c,f,h,p)),I[v]=Ea(b.dihedralAngle(f,h,p,x)),c=p,m=h,d=f,p=y,h=g,f=x,u(r[v+1],y),u(s[o[v+1]],g),u(n[v+1],x));return{phi:S,psi:I}}function bue(e,t){let{x:r,y:n,z:o}=e.model.atomicConformation,{traceElementIndex:i}=e.model.atomicHierarchy.derived.residue,a=new Uint32Array(t.length);for(let l=0,u=t.length;l<u;++l)a[l]=i[t[l]];let s={x:r,y:n,z:o,indices:Be.ofSortedArray(a)};return Cc(s,lf(s))}function xue(e){let{index:t}=e.model.atomicHierarchy,{proteinElements:r,residueIndex:n}=e,o=r.length,i=new Uint32Array(o),a=new Int32Array(o),s=new Int32Array(o),l=new Int32Array(o),u=new Int32Array(o);for(let c=0;c<o;++c){let m=n[r[c]];i[c]=m,a[c]=t.findAtomOnResidue(m,"C"),s[c]=t.findAtomOnResidue(m,"H"),l[c]=t.findAtomOnResidue(m,"O"),u[c]=t.findAtomOnResidue(m,"N")}return{residueIndices:Be.ofSortedArray(i),cIndices:a,hIndices:s,oIndices:l,nIndices:u}}var nH={oldDefinition:C.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:C.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})},Cue=C.getDefaultValues(nH);async function oH(e,t){let r=xue(e),{residueIndices:n}=r,o=bue(e,n),i=lue(e,r,o),a=n.length,s=new Uint32Array(a),l=yue(e,r),u=[],c=[],m=t.oldDefinition?Oze:Uze,d=t.oldOrdering?Gze:Nze,p={params:t,getResidueFlag:m,getFlagName:d,unit:e,proteinInfo:r,flags:s,hbonds:i,torsionAngles:l,ladders:u,bridges:c};uue(p),cue(p),aue(p),fue(p),pue(p),gue(p);let h=zze(s,m),f=new Uint32Array(a),y=[],g=[],x=S=>Be.indexOf(n,S);for(let S=0,I=n.length;S<I;++S){let v=h[S];f[S]=v;let A=m(s[S]);(g.length===0||A!==g[g.length-1].flags)&&(g[g.length]=Fze(Vze(v),s[S],m)),y[S]=g.length-1}return jv(f,y,g,x)}function Fze(e,t,r){return e==="helix"?{kind:"helix",flags:r(t)}:e==="sheet"?{kind:"sheet",flags:r(t)}:e==="turn"||e==="bend"?{kind:"turn",flags:r(t)}:{kind:"none"}}function Vze(e){return e===Kt.SecondaryStructureDssp.H||e===Kt.SecondaryStructureDssp.G||e===Kt.SecondaryStructureDssp.I?"helix":e===Kt.SecondaryStructureDssp.B||e===Kt.SecondaryStructureDssp.E?"sheet":e===Kt.SecondaryStructureDssp.T?"turn":e===Kt.SecondaryStructureDssp.S?"bend":"none"}function Oze(e){return dt.is(e,dt.Flag.H)?Kt.SecondaryStructureDssp.H:dt.is(e,dt.Flag.E)?Kt.SecondaryStructureDssp.E:dt.is(e,dt.Flag.B)?Kt.SecondaryStructureDssp.B:dt.is(e,dt.Flag.G)?Kt.SecondaryStructureDssp.G:dt.is(e,dt.Flag.I)?Kt.SecondaryStructureDssp.I:dt.is(e,dt.Flag.T)?Kt.SecondaryStructureDssp.T:dt.is(e,dt.Flag.S)?Kt.SecondaryStructureDssp.S:Kt.Flag.None}function Gze(e){return dt.is(e,dt.Flag.H)?"H":dt.is(e,dt.Flag.E)?"E":dt.is(e,dt.Flag.B)?"B":dt.is(e,dt.Flag.G)?"G":dt.is(e,dt.Flag.I)?"I":dt.is(e,dt.Flag.T)?"T":dt.is(e,dt.Flag.S)?"S":"-"}function Uze(e){return dt.is(e,dt.Flag.I)?Kt.SecondaryStructureDssp.I:dt.is(e,dt.Flag.H)?Kt.SecondaryStructureDssp.H:dt.is(e,dt.Flag.E)?Kt.SecondaryStructureDssp.E:dt.is(e,dt.Flag.B)?Kt.SecondaryStructureDssp.B:dt.is(e,dt.Flag.G)?Kt.SecondaryStructureDssp.G:dt.is(e,dt.Flag.T)?Kt.SecondaryStructureDssp.T:dt.is(e,dt.Flag.S)?Kt.SecondaryStructureDssp.S:Kt.Flag.None}function Nze(e){return dt.is(e,dt.Flag.I)?"I":dt.is(e,dt.Flag.H)?"H":dt.is(e,dt.Flag.E)?"E":dt.is(e,dt.Flag.B)?"B":dt.is(e,dt.Flag.G)?"G":dt.is(e,dt.Flag.T)?"T":dt.is(e,dt.Flag.S)?"S":"-"}function zze(e,t){let r=new Uint32Array(e.length);for(let n=0,o=e.length;n<o;++n){let i=dt.create(e[n]);r[n]=t(i)}return r}var Pl;(r=>{function e(n){let o=n.descriptor.name,i=n.type==="root"?"inheritedPropertyData":"currentPropertyData",a=l=>(o in l[i]||(l[i][o]={props:{...C.getDefaultValues(n.getParams(l))},data:Ug.create(void 0)}),l[i][o]),s=(l,u,c)=>{let m=a(l);l[i][o]={props:u,data:Ug.withValue(m.data,c)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:l=>{let u=C.clone(n.getParams(l));return C.setDefaultValues(u,a(l).props),u},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:async(l,u,c={},m)=>{m&&u.customPropertyDescriptors.reference(n.descriptor,!0),n.type==="root"&&(u=u.root);let d=a(u.root).props,p=a(u),h=C.merge(n.defaultParams,d,c);if(p.data.value&&C.areEqual(n.defaultParams,p.props,h))return;let{value:f,assets:y}=await n.obtain(l,u,h);u.customPropertyDescriptors.add(n.descriptor),u.customPropertyDescriptors.assets(n.descriptor,y),s(u,h,f)},ref:(l,u)=>l.customPropertyDescriptors.reference(n.descriptor,u),get:l=>a(l).data,set:(l,u={},c)=>{n.type==="root"&&(l=l.root);let m=a(l),d=C.merge(n.defaultParams,m.props,u);C.areEqual(n.defaultParams,m.props,d)||(s(l,d,c),l.customPropertyDescriptors.assets(n.descriptor))},props:l=>a(l).props}}r.createProvider=e;function t(n,o,i){let a={value:C.Value(i,{isHidden:!0})};return e({label:ta(n),descriptor:{name:n},isHidden:!0,type:o,defaultParams:a,getParams:()=>({value:C.Value(i,{isHidden:!0})}),isApplicable:()=>!0,obtain:async(s,l,u)=>({...C.getDefaultValues(a),...u})})}r.createSimple=t})(Pl||={});var yh;(n=>{n.Descriptor={name:"model_secondary_structure"},n.Provider=ll.create(n.Descriptor);function r(o,i,a){let s=new Map,l=[{kind:"none"}],u=Hze(o,i);jze(o,u,s,l),Wze(i,u,s,o._rowCount,l);let c=a.residues._rowCount,m=p=>p,d={type:new Int32Array(c),key:new Int32Array(c),elements:l};return s.size>0&&Qze(a,u,s,d),jv(d.type,d.key,d.elements,m)}n.fromStruct=r})(yh||={});function Hze(e,t){if(e._rowCount>0){if(e.beg_label_seq_id.valueKind(0)!==H.ValueKinds.Present||e.end_label_seq_id.valueKind(0)!==H.ValueKinds.Present)return"auth"}else if(t&&(t.beg_label_seq_id.valueKind(0)!==H.ValueKinds.Present||t.end_label_seq_id.valueKind(0)!==H.ValueKinds.Present))return"auth";return"label"}function jze(e,t,r,n){if(!e._rowCount)return;let{beg_label_asym_id:o,beg_label_seq_id:i,beg_auth_seq_id:a,pdbx_beg_PDB_ins_code:s}=e,{end_label_seq_id:l,end_auth_seq_id:u,pdbx_end_PDB_ins_code:c}=e,{pdbx_PDB_helix_class:m,conf_type_id:d,details:p}=e,h=t==="label"?i:a,f=t==="label"?l:u;for(let y=0,g=e._rowCount;y<g;y++){let x=Kt.create(m.valueKind(y)===H.ValueKinds.Present?Kt.SecondaryStructurePdb[m.value(y)]:d.valueKind(y)===H.ValueKinds.Present?Kt.SecondaryStructureMmcif[d.value(y)]:Kt.Flag.NA),S={kind:"helix",flags:x,type_id:d.valueKind(y)===H.ValueKinds.Present?d.value(y):"helx_p",helix_class:m.value(y),details:p.valueKind(y)===H.ValueKinds.Present?p.value(y):void 0},I={startSeqId:h.value(y),startInsCode:s.value(y),endSeqId:f.value(y),endInsCode:c.value(y),type:x,key:n.length};n[n.length]=S;let v=o.value(y);if(r.has(v)){let A=r.get(v);A.has(I.startSeqId)?A.get(I.startSeqId).push(I):A.set(I.startSeqId,[I])}else r.set(v,new Map([[I.startSeqId,[I]]]))}}function Wze(e,t,r,n,o){if(!e._rowCount)return;let{beg_label_asym_id:i,beg_label_seq_id:a,beg_auth_seq_id:s,pdbx_beg_PDB_ins_code:l}=e,{end_label_seq_id:u,end_auth_seq_id:c,pdbx_end_PDB_ins_code:m}=e,{sheet_id:d}=e,p=t==="label"?a:s,h=t==="label"?u:c,f=new Map,y=n+1;for(let g=0,x=e._rowCount;g<x;g++){let S=d.value(g),I;f.has(S)?I=f.get(S):(I=y++,f.set(S,I));let v=Kt.create(Kt.Flag.Beta|Kt.Flag.BetaSheet),A={kind:"sheet",flags:v,sheet_id:S,symmetry:void 0},_={startSeqId:p.value(g),startInsCode:l.value(g),endSeqId:h.value(g),endInsCode:m.value(g),type:v,key:o.length};o[o.length]=A;let T=i.value(g);if(r.has(T)){let w=r.get(T);w.has(_.startSeqId)?w.get(_.startSeqId).push(_):w.set(_.startSeqId,[_])}else r.set(T,new Map([[_.startSeqId,[_]]]))}}function Xze(e,t,r,n,o,i){let{auth_seq_id:a,label_seq_id:s,pdbx_PDB_ins_code:l}=e.residues,{endSeqId:u,endInsCode:c,key:m,type:d}=r,p=t==="label"?s:a,h=n;for(;h<o;){let f=p.value(h);if(i.type[h]=d,i.key[h]=m,f>u||f===u&&l.value(h)===c)break;h++}}function Qze(e,t,r,n){let{count:o}=e.chainAtomSegments,{label_asym_id:i}=e.chains,{auth_seq_id:a,label_seq_id:s,pdbx_PDB_ins_code:l}=e.residues,u=t==="label"?s:a;for(let c=0;c<o;c++){let m=H0.chainStartResidueIndex(e,c),d=H0.chainEndResidueIndexExcl(e,c),p=i.value(c);if(r.has(p)){let h=r.get(p);for(let f=m;f<d;f++){let y=u.value(f);if(h.has(y)){let g=h.get(y);for(let x of g){let S=l.value(f);x.startInsCode===S&&Xze(e,t,x,f,d,n)}}}}}}var Zze=[5.45,5.18,6.37],qze=2.1,Yze=[6.1,10.4,13],Kze=1.42,Sue=b(),vue=b();function Iue(e,t,r,n,o){let i=e.conformation,{traceElementIndex:a}=e.model.atomicHierarchy.derived.residue;for(let s=Math.max(0,r-2);s<=r;++s)for(let l=2;l<5;++l){if(s+l>=t.length)return!1;let u=t[s],c=t[s+l],m=a[u],d=a[c];if(m===-1||d===-1)return!1;i.invariantPosition(m,Sue),i.invariantPosition(d,vue);let p=b.distance(Sue,vue);if(Math.abs(p-n[l-2])>=o)return!1}return!0}async function iH(e){let t=e.proteinElements.length,r=new Uint32Array(t),n=[],o=[],{proteinElements:i,residueIndex:a}=e,s=i.length,l=new Uint32Array(s);for(let m=0;m<s;++m){let d=a[i[m]];l[m]=d}let u=Be.ofSortedArray(l),c=m=>Be.indexOf(u,m);for(let m=0,d=u.length;m<d;++m){let p=Kt.Flag.None;Iue(e,u,m,Zze,qze)?p=Kt.Flag.Helix:Iue(e,u,m,Yze,Kze)&&(p=Kt.Flag.Beta),r[m]=p,(o.length===0||p!==e9e(o[o.length-1]))&&(o[o.length]=Jze($ze(p),p)),n[m]=o.length-1}return jv(r,n,o,c)}function Jze(e,t){return e==="helix"?{kind:"helix",flags:t}:e==="sheet"?{kind:"sheet",flags:t}:{kind:"none"}}function $ze(e){return e===Kt.Flag.Helix?"helix":e===Kt.Flag.Beta?"sheet":"none"}function e9e(e){return e.kind==="helix"||e.kind==="sheet"?e.flags:Kt.Flag.None}function Tue(e){return{type:C.MappedStatic("auto",{auto:C.EmptyGroup({label:"Automatic"}),model:C.EmptyGroup({label:"Model"}),dssp:C.Group(nH,{label:"DSSP",isFlat:!0}),"zhang-skolnick":C.EmptyGroup({label:"Zhang-Skolnick"})},{options:[["auto","Automatic"],["model","Model"],["dssp","DSSP"],["zhang-skolnick","Zhang-Skolnick"]]})}}var Aue=Tue(),zs=Pl.createProvider({label:"Secondary Structure",descriptor:{name:"molstar_computed_secondary_structure"},type:"root",defaultParams:Aue,getParams:Tue,isApplicable:e=>!0,obtain:async(e,t,r)=>{let n={...C.getDefaultValues(Aue),...r};switch(n.type.name){case"auto":return{value:await t9e(t)};case"dssp":return{value:await r9e(t,n.type.params)};case"model":return{value:await o9e(t)};case"zhang-skolnick":return{value:await n9e(t)}}}});async function t9e(e){let t=new Map;for(let r=0,n=e.unitSymmetryGroups.length;r<n;++r){let o=e.unitSymmetryGroups[r].units[0],i=o.model;if(Ft.isFromPdbArchive(i)&&Ft.isExperimental(i)&&!Ft.isCoarseGrained(i)||Ft.hasSecondaryStructure(i)){let a=yh.Provider.get(i);a&&t.set(o.invariantId,a)}else if(me.isAtomic(o)&&!Ft.isCoarseGrained(i)){let a=await oH(o,Cue);t.set(o.invariantId,a)}else if(me.isAtomic(o)){let a=await iH(o);t.set(o.invariantId,a)}}return t}async function r9e(e,t){let r=new Map;for(let n=0,o=e.unitSymmetryGroups.length;n<o;++n){let i=e.unitSymmetryGroups[n].units[0];if(me.isAtomic(i)&&!Ft.isCoarseGrained(i.model)){let a=await oH(i,t);r.set(i.invariantId,a)}}return r}async function n9e(e){let t=new Map;for(let r=0,n=e.unitSymmetryGroups.length;r<n;++r){let o=e.unitSymmetryGroups[r].units[0];if(me.isAtomic(o)){let i=await iH(o);t.set(o.invariantId,i)}}return t}async function o9e(e){let t=new Map;for(let r=0,n=e.unitSymmetryGroups.length;r<n;++r){let o=e.unitSymmetryGroups[r].units[0];if(me.isAtomic(o)){let i=yh.Provider.get(o.model);i&&t.set(o.invariantId,i)}}return t}var i9e={true:e=>!0,false:e=>!1,zero:e=>0};function fa(){throw new Error("Property only available for atomic models.")}function iy(e){throw e?new Error(`Property only available for coarse models (${e}).`):new Error("Property only available for coarse models.")}var Q2={key:e=>e.element,x:e=>e.unit.conformation.x(e.element),y:e=>e.unit.conformation.y(e.element),z:e=>e.unit.conformation.z(e.element),id:e=>me.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):fa(),occupancy:e=>me.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):fa(),B_iso_or_equiv:e=>me.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):fa(),sourceIndex:e=>me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element,type_symbol:e=>me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):fa(),label_atom_id:e=>me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):fa(),auth_atom_id:e=>me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):fa(),label_alt_id:e=>me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):fa(),label_comp_id:GM,auth_comp_id:e=>me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):fa(),pdbx_formal_charge:e=>me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):fa(),vdw_radius:e=>me.isAtomic(e.unit)?hh(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):fa()};function GM(e){return me.isAtomic(e.unit)||fa(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function aH(e){return me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):fa()}function a9e(e){me.isAtomic(e.unit)||fa();let t=e.unit.model.sequence.byEntityKey[Nu(e)];return t&&t.sequence.microHet.has(aH(e))}function Pue(e){me.isAtomic(e.unit)||fa();let t=e.unit.model.sequence.byEntityKey[Nu(e)];return t?t.sequence.microHet.get(aH(e))||[GM(e)]:[GM(e)]}var s9e={key:e=>me.isAtomic(e.unit)?e.unit.residueIndex[e.element]:fa(),group_PDB:e=>me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):fa(),label_seq_id:aH,auth_seq_id:e=>me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):fa(),pdbx_PDB_ins_code:e=>me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):fa(),isNonStandard:e=>me.isAtomic(e.unit)?Pue(e).some(t=>e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]==="n"):fa(),hasMicroheterogeneity:a9e,microheterogeneityCompIds:Pue,secondary_structure_type:e=>{me.isAtomic(e.unit)||fa();let t=zs.get(e.structure).value?.get(e.unit.invariantId);return t?t.type[t.getIndex(e.unit.residueIndex[e.element])]:Kt.Flag.NA},secondary_structure_key:e=>{me.isAtomic(e.unit)||fa();let t=zs.get(e.structure).value?.get(e.unit.invariantId);return t?t.key[t.getIndex(e.unit.residueIndex[e.element])]:-1},chem_comp_type:e=>me.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(GM(e)).type:fa()},l9e={key:e=>me.isAtomic(e.unit)?e.unit.chainIndex[e.element]:fa(),label_asym_id:e=>me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):e.unit.coarseElements.asym_id.value(e.element),auth_asym_id:e=>me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):fa(),label_entity_id:e=>me.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):e.unit.coarseElements.entity_id.value(e.element)},u9e={key:Q2.key,entityKey:e=>me.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:iy(),x:Q2.x,y:Q2.y,z:Q2.z,asym_id:e=>me.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):iy(),entity_id:e=>me.isCoarse(e.unit)?e.unit.coarseElements.entity_id.value(e.element):iy(),seq_id_begin:e=>me.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):iy(),seq_id_end:e=>me.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):iy(),sphere_radius:e=>me.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:iy("spheres"),sphere_rmsf:e=>me.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:iy("spheres"),gaussian_weight:e=>me.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:iy("gaussians"),gaussian_covariance_matrix:e=>me.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:iy("gaussians")};function Nu(e){switch(e.unit.kind){case me.Kind.Atomic:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case me.Kind.Spheres:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case me.Kind.Gaussians:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var c9e={key:Nu,id:e=>e.unit.model.entities.data.id.value(Nu(e)),type:e=>e.unit.model.entities.data.type.value(Nu(e)),src_method:e=>e.unit.model.entities.data.src_method.value(Nu(e)),pdbx_description:e=>e.unit.model.entities.data.pdbx_description.value(Nu(e)),formula_weight:e=>e.unit.model.entities.data.formula_weight.value(Nu(e)),pdbx_number_of_molecules:e=>e.unit.model.entities.data.pdbx_number_of_molecules.value(Nu(e)),details:e=>e.unit.model.entities.data.details.value(Nu(e)),pdbx_mutation:e=>e.unit.model.entities.data.pdbx_mutation.value(Nu(e)),pdbx_fragment:e=>e.unit.model.entities.data.pdbx_fragment.value(Nu(e)),pdbx_ec:e=>e.unit.model.entities.data.pdbx_ec.value(Nu(e)),pdbx_parent_entity_id:e=>e.unit.model.entities.data.pdbx_parent_entity_id.value(Nu(e)),subtype:e=>e.unit.model.entities.subtype.value(Nu(e)),prd_id:e=>e.unit.model.entities.prd_id?.value(Nu(e))??""},m9e=[],d9e={id:e=>e.unit.id,chainGroupId:e=>e.unit.chainGroupId,multiChain:e=>me.Traits.is(e.unit.traits,me.Trait.MultiChain),object_primitive:e=>e.unit.objectPrimitive,operator_name:e=>e.unit.conformation.operator.name,instance_id:e=>e.unit.conformation.operator.instanceId,operator_key:e=>e.unit.conformation.operator.key,model_index:e=>e.unit.model.modelNum,model_label:e=>e.unit.model.label,model_entry_id:e=>e.unit.model.entryId,hkl:e=>e.unit.conformation.operator.hkl,spgrOp:e=>e.unit.conformation.operator.spgrOp,model_num:e=>e.unit.model.modelNum,pdbx_struct_assembly_id:e=>e.unit.conformation.operator.assembly?.id||jn.DefaultName,pdbx_struct_oper_list_ids:e=>e.unit.conformation.operator.assembly?.operList||m9e,struct_ncs_oper_id:e=>e.unit.conformation.operator.ncsId},qe={constant:i9e,atom:Q2,residue:s9e,chain:l9e,entity:c9e,unit:d9e,coarse:u9e};var mx=class{constructor(t){this.index=new Map;this.checkOperator=!1;this._asym_id=qe.chain.label_asym_id;this._seq_id=qe.residue.label_seq_id;this._comp_id=qe.atom.label_comp_id;this._alt_id=qe.atom.label_alt_id;this._ins_code=qe.residue.pdbx_PDB_ins_code;this._op_name=qe.unit.operator_name;this.checkOperator=t?.checkOperator??!1}add(t){let r=this.index.get(t.label_asym_id);r||(r=new Map,this.index.set(t.label_asym_id,r));let n=r.get(t.label_seq_id);return n||(n=[],r.set(t.label_seq_id,n)),this._find(t,n)?!1:(n.push(t),!0)}hasLabelAsymId(t){return this.index.has(t)}has(t){let r=this._asym_id(t);if(!this.index.has(r))return;let n=this.index.get(r),o=this._seq_id(t);if(!n.has(o))return;let i=n.get(o),a=this._comp_id(t),s=this._alt_id(t),l=this._ins_code(t),u=this._op_name(t)??"1_555";for(let c of i)if(!(c.label_comp_id!==a||c.label_alt_id!==s||c.ins_code!==l)&&!(this.checkOperator&&(c.operator_name??"1_555")!==u))return c}static getLabel(t,r=!1){return`${t.label_asym_id} ${t.label_comp_id} ${t.label_seq_id}:${t.ins_code}:${t.label_alt_id}${r?" "+(t.operator_name??"1_555"):""}`}static getEntryFromLocation(t){return{label_asym_id:qe.chain.label_asym_id(t),label_comp_id:qe.atom.label_comp_id(t),label_seq_id:qe.residue.label_seq_id(t),label_alt_id:qe.atom.label_alt_id(t),ins_code:qe.residue.pdbx_PDB_ins_code(t),operator_name:qe.unit.operator_name(t)??"1_555"}}_find(t,r){for(let n of r)if(!(n.label_comp_id!==t.label_comp_id||n.label_alt_id!==t.label_alt_id||n.ins_code!==t.ins_code)&&!(this.checkOperator&&(n.operator_name??"1_555")!==(t.operator_name??"1_555")))return!0;return!1}};function Wv(e,t,r){let n=t.subsetBuilder(!0);for(let o of r.units){if(o.kind!==me.Kind.Atomic){n.setUnit(o.id,o.elements);continue}let{residueAtomSegments:i}=o.model.atomicHierarchy,a=t.unitMap.get(o.id).elements,s=o.elements;n.beginUnit(o.id);let l=Xt.transientSegments(i,s);for(;l.hasNext;){let u=l.move().index;for(let c=i.offsets[u],m=i.offsets[u+1];c<m;c++)Be.has(a,c)&&n.addElement(c)}n.commitUnit(),e.throwIfTimedOut()}return n.getStructure()}function p9e(e){return function(r){let n=e(r);if(at.isSingleton(n))return at.Singletons(r.inputStructure,Wv(r,r.inputStructure,n.structure));{let o=new Hv(r.inputStructure);for(let i of n.structures)o.add(Wv(r,r.inputStructure,i));return o.getSelection()}}}function sH(e,t,r,n){let o=new z0(t),i=t.lookup3d,a=n.radius;for(let s of r.units){let l=s.conformation,u=s.elements;for(let c=0,m=u.length;c<m;c++){let d=u[c];i.findIntoBuilder(l.x(d),l.y(d),l.z(d),a,o)}e.throwIfTimedOut()}return n.wholeResidues?Wv(e,t,o.getStructure()):o.getStructure()}function _ue(e,t,r,n){let o=new z0(t),i=t.lookup3d,{elementRadius:a,elementRadiusClosure:s,sourceMaxRadius:l,radius:u}=n;e.pushCurrentElement(),e.element.structure=r;for(let c of r.units){e.element.unit=c;let m=c.conformation,d=c.elements;for(let p=0,h=d.length;p<h;p++){let f=d[p];e.element.element=f;let y=a(e);i.findIntoBuilderWithRadius(m.x(f),m.y(f),m.z(f),y,l,u,s,o)}e.throwIfTimedOut()}return e.popCurrentElement(),n.wholeResidues?Wv(e,t,o.getStructure()):o.getStructure()}function f9e(e,t){return r=>(e.element.structure=r.structure,e.element.unit=r.unit,e.element.element=r.element,t(e))}function h9e(e,t){let r=0;e.element.structure=e.inputStructure;for(let n of e.inputStructure.units){e.element.unit=n;let o=n.elements;for(let i=0,a=o.length;i<a;i++){let s=o[i];e.element.element=s;let l=t(e);l>r&&(r=l)}}return e.throwIfTimedOut(),r}function g9e(e,t){return function(n){let o=e(n);if(t.elementRadius){let i={...t,elementRadius:t.elementRadius,elementRadiusClosure:f9e(n,t.elementRadius),sourceMaxRadius:h9e(n,t.elementRadius)};if(at.isSingleton(o)){let a=_ue(n,n.inputStructure,o.structure,i);return at.Singletons(n.inputStructure,a)}else{let a=new Hv(n.inputStructure);for(let s of o.structures)a.add(_ue(n,n.inputStructure,s,i));return a.getSelection()}}if(at.isSingleton(o)){let i=sH(n,n.inputStructure,o.structure,t);return at.Singletons(n.inputStructure,i)}else{let i=new Hv(n.inputStructure);for(let a of o.structures)i.add(sH(n,n.inputStructure,a,t));return i.getSelection()}}}function y9e(e,t){return function(n){let o=e(n);if(at.structureCount(o)===0)return o;let i=at.UniqueBuilder(n.inputStructure),a=s=>i.add(s);return at.forEach(o,(s,l)=>{n.pushInputStructure(s),at.forEach(t(n),a),n.popInputStructure(),l%10===0&&n.throwIfTimedOut()}),i.getSelection()}}function b9e(e,t){return function(n){let o=e(n);if(at.structureCount(o)===0)return o;let i=t(n);if(at.structureCount(i)===0)return at.Empty(n.inputStructure);let a=at.unionStructure(i),s=at.UniqueBuilder(n.inputStructure);return at.forEach(o,(l,u)=>{let c=MM(a,l);c.elementCount!==0&&s.add(c),u%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function x9e(e,t){return function(n){let o=e(n);if(at.structureCount(o)===0)return o;let i=t(n);if(at.structureCount(i)===0)return o;let a=at.unionStructure(i),s=at.UniqueBuilder(n.inputStructure);return at.forEach(o,(l,u)=>{let c=Nv(l,a);c.elementCount!==0&&s.add(c),u%50===0&&n.throwIfTimedOut()}),s.getSelection()}}function C9e(e){return function(r){let n=at.LinearBuilder(r.inputStructure);return n.add(at.unionStructure(e(r))),n.getSelection()}}function S9e(e,t){return function(n){let o=e(n),i=new Map,a=[];n.pushCurrentElement(),at.forEach(o,(l,u)=>{n.element.structure=l;for(let c of l.units){n.element.unit=c;let m=c.elements;for(let d=0,p=m.length;d<p;d++){n.element.element=m[d];let h=t(n),f;i.has(h)?f=i.get(h):(f=Tn.create(),i.set(h,f)),Tn.add(f,u,u)}}a[u]=n.inputStructure.subsetBuilder(!0),u%10===0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(let l of n.inputStructure.units){n.element.unit=l;let u=l.elements;for(let c=0,m=u.length;c<m;c++){n.element.element=u[c];let d=t(n);if(!i.has(d))continue;let p=i.get(d).array;for(let h=0,f=p.length;h<f;h++)a[p[h]].addToUnit(l.id,u[c])}}n.popCurrentElement();let s=at.UniqueBuilder(n.inputStructure);for(let l of a)s.add(l.getStructure());return s.getSelection()}}function v9e({query:e,layerCount:t,wholeResidues:r,bondTest:n,fixedPoint:o}){let i=Math.max(t,0);return function(s){let l=at.UniqueBuilder(s.inputStructure),u=e(s);return s.pushCurrentBond(),s.atomicBond.setTestFn(n),at.forEach(u,(c,m)=>{let d=c;if(o)for(;;){let p=d.elementCount;if(d=Rue(s,r,d),d.elementCount===p)break}else for(let p=0;p<i;p++)d=Rue(s,r,d);l.add(d),m%10===0&&s.throwIfTimedOut()}),s.popCurrentBond(),l.getSelection()}}function Rue(e,t,r){let n=I9e(e,r);return t?Wv(e,e.inputStructure,n):n}function I9e(e,t){let r=e.inputStructure,n=r.interUnitBonds,o=new z0(r),i=e.atomicBond;for(let a of t.units){if(a.kind!==me.Kind.Atomic){o.beginUnit(a.id);for(let p=0,h=a.elements.length;p<h;p++)o.addElement(a.elements[p]);o.commitUnit();continue}let s=r.unitMap.get(a.id),{offset:l,b:u,edgeProps:{flags:c,order:m,key:d}}=s.bonds;i.setStructure(r),i.a.unit=s,i.b.unit=s;for(let p=0,h=a.elements.length;p<h;p++){o.addToUnit(a.id,a.elements[p]);let f=Be.indexOf(s.elements,a.elements[p]);for(let y=l[f],g=l[f+1];y<g;y++){let x=u[y],S=s.elements[x];Be.has(a.elements,S)||o.has(a.id,S)||(i.aIndex=f,i.a.element=a.elements[p],i.bIndex=x,i.b.element=S,i.type=c[y],i.order=m[y],i.key=d[y],i.test(e,!0)&&o.addToUnit(a.id,S))}}for(let p of n.getConnectedUnits(s.id)){let h=t.unitMap.get(p.unitB),f=r.unitMap.get(p.unitB);for(let y of p.connectedIndices)if(Be.has(a.elements,s.elements[y]))for(let g of p.getEdges(y)){let x=f.elements[g.indexB];h&&Be.has(h.elements,x)||o.has(p.unitB,x)||(i.a.unit=s,i.aIndex=y,i.a.element=s.elements[y],i.b.unit=f,i.bIndex=g.indexB,i.b.element=x,i.type=g.props.flag,i.order=g.props.order,i.key=g.props.key,i.test(e,!0)&&o.addToUnit(p.unitB,x))}}}return o.getStructure()}function A9e({query:e,radius:t,includeWater:r}){let n=qe.entity.type;function o(i){return n(i)==="water"}return function(a){let s=at.unionStructure(e(a)),l=Wv(a,a.inputStructure,sH(a,a.inputStructure,s,{radius:t})),u=T9e(a.inputStructure),c=P9e(a.inputStructure),m=K.Location.create(l),d=new Map,p=new mx({checkOperator:!0});for(let y of l.units){if(y.kind!==me.Kind.Atomic)continue;m.unit=y;let{elements:g}=y,x=Xt.transientSegments(y.model.atomicHierarchy.chainAtomSegments,g),S=Xt.transientSegments(y.model.atomicHierarchy.residueAtomSegments,g);for(;x.hasNext;){let I=x.move();m.element=g[I.start];let v=qe.chain.label_asym_id(m),A=qe.unit.operator_name(m);if(u.has(v)){d.has(v)?qo(d.get(v),A):d.set(v,[A]);continue}let _=qe.entity.type(m);if(!(_==="water"||_==="polymer"))for(S.setSegment(I);S.hasNext;){let T=S.move();m.element=g[T.start],c.addComponent(mx.getEntryFromLocation(m),p)}}a.throwIfTimedOut()}let h=a.inputStructure.subsetBuilder(!0);for(let y of a.inputStructure.units){if(y.kind!==me.Kind.Atomic)continue;m.unit=y;let{elements:g}=y,x=Xt.transientSegments(y.model.atomicHierarchy.chainAtomSegments,g),S=Xt.transientSegments(y.model.atomicHierarchy.residueAtomSegments,g);for(h.beginUnit(y.id);x.hasNext;){let I=x.move();m.element=g[I.start];let v=qe.chain.label_asym_id(m),A=qe.unit.operator_name(m);if(d.has(v)&&d.get(v).indexOf(A)>=0){h.addElementRange(g,I.start,I.end);continue}if(p.hasLabelAsymId(v))for(S.setSegment(I);S.hasNext;){let _=S.move();m.element=g[_.start],p.has(m)&&h.addElementRange(g,_.start,_.end)}}h.commitUnit(),a.throwIfTimedOut()}let f=oy(a.inputStructure,[h.getStructure(),s]);if(r){let y=new z0(a.inputStructure),g=a.inputStructure.lookup3d;for(let x of f.units){let S=x.conformation,I=x.elements;for(let v=0,A=I.length;v<A;v++){let _=I[v];g.findIntoBuilderIf(S.x(_),S.y(_),S.z(_),t,y,o),y.addToUnit(x.id,_)}a.throwIfTimedOut()}return at.Sequence(a.inputStructure,[y.getStructure()])}else return at.Sequence(a.inputStructure,[f])}}function T9e(e){let t=e.models[0],r=new Set;if(t.sourceData?.kind!=="mmCIF")return r;let{_rowCount:n,asym_id:o}=t.sourceData.data.db.pdbx_molecule;for(let i=0;i<n;i++)r.add(o.value(i));return r}function P9e(e){let t=e.models[0],r=new lH;if(t.sourceData?.kind!=="mmCIF")return r;let n=t.sourceData.data.db.struct_conn,{conn_type_id:o}=n,{ptnr1_label_asym_id:i,ptnr1_label_comp_id:a,ptnr1_label_seq_id:s,ptnr1_symmetry:l,pdbx_ptnr1_label_alt_id:u,pdbx_ptnr1_PDB_ins_code:c}=n,{ptnr2_label_asym_id:m,ptnr2_label_comp_id:d,ptnr2_label_seq_id:p,ptnr2_symmetry:h,pdbx_ptnr2_label_alt_id:f,pdbx_ptnr2_PDB_ins_code:y}=n;for(let g=0;g<n._rowCount;g++){let x=o.value(g);if(x!=="covale"&&x!=="metalc")continue;let S={label_asym_id:i.value(g),label_comp_id:a.value(g),label_seq_id:s.value(g),label_alt_id:u.value(g),ins_code:c.value(g),operator_name:l.value(g)??"1_555"},I={label_asym_id:m.value(g),label_comp_id:d.value(g),label_seq_id:p.value(g),label_alt_id:f.value(g),ins_code:y.value(g),operator_name:h.value(g)??"1_555"};r.addEdge(S,I)}return r}var lH=class{constructor(){this.vertices=new Map;this.edges=new Map}addVertex(t,r){this.vertices.has(r)||(this.vertices.set(r,t),this.edges.set(r,[]))}addEdge(t,r){let n=mx.getLabel(t),o=mx.getLabel(r);this.addVertex(t,n),this.addVertex(r,o),qo(this.edges.get(n),o),qo(this.edges.get(o),n)}addComponent(t,r){let n=mx.getLabel(t);if(!this.vertices.has(n)){r.add(t);return}let o=new Set,i=new Set,a=[n];for(i.add(n),r.add(t);a.length>0;){let s=a.pop();o.add(s);let l=this.vertices.get(s);for(let u of this.edges.get(s)){if(o.has(u)||(a.push(u),i.has(u)))continue;i.add(u);let c=this.vertices.get(u);l.operator_name===c.operator_name?r.add({...c,operator_name:t.operator_name}):r.add(c)}}}};var dH={};Bi(dH,{areIntersectedBy:()=>E9e,first:()=>R9e,getCurrentStructureProperties:()=>Z2,isConnectedTo:()=>V9e,pick:()=>_9e,withSameAtomProperties:()=>w9e,within:()=>M9e});function Due(e,t,r,n,o,i){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?cH.check(e,t,r,n,o,i):cH.check(e,r,t,n,o,i)}function wue(e,t,r,n,o){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?mH.check(e,t,r,n,o):mH.check(e,r,t,n,o)}var cH;(a=>{let e;(c=>(c[c.BelowMin=0]="BelowMin",c[c.WithinMax=1]="WithinMax",c[c.Miss=2]="Miss"))(e||={});let t=b();function r(s,l,u,c,m,d,p){let{elements:h,conformation:f}=l,y=t;s.element.unit=l;let g=!1;for(let x=0,S=h.length;x<S;x++){let I=h[x];s.element.element=I;let v=Math.max(0,b.distance(u,f.position(I,y))-c-p(s));if(v<m)return 0;v<d&&(g=!0)}return g?1:2}function n(s,l,u,c,m,d,p){let{units:h}=l,f=!1;for(let y=0,g=h.length;y<g;y++){let x=r(s,h[y],u,c,m,d,p);if(x===0)return 0;x===1&&(f=!0)}return f?1:2}let o=b();function i(s,l,u,c,m,d){if(l.elementCount===0||u.elementCount===0)return 0;let{units:p}=l,h=!1;s.element.structure=l;for(let f=0,y=p.length;f<y;f++){let g=p[f],{elements:x,conformation:S}=g;s.element.unit=g;for(let I=0,v=x.length;I<v;I++){let A=x[I];s.element.element=A;let _=n(s,u,S.position(A,o),d(s),c,m,d);if(_===0)return!1;_===1&&(h=!0)}}return h}a.check=i})(cH||={});var mH;(i=>{let e=b();function t(a,s,l,u,c,m){let{elements:d,conformation:p}=s,h=e;a.element.unit=s;for(let f=0,y=d.length;f<y;f++){let g=d[f];if(a.element.element=g,Math.max(0,b.distance(l,p.position(g,h))-u-m(a))<=c)return!0}return!1}function r(a,s,l,u,c,m){let{units:d}=s;for(let p=0,h=d.length;p<h;p++)if(t(a,d[p],l,u,c,m))return!0;return!1}let n=b();function o(a,s,l,u,c){if(s.elementCount===0||l.elementCount===0)return 0;let{units:m}=s;a.element.structure=s;for(let d=0,p=m.length;d<p;d++){let h=m[d];a.element.unit=h;let{elements:f,conformation:y}=h;for(let g=0,x=f.length;g<x;g++){let S=f[g];if(a.element.element=S,r(a,l,y.position(S,n),c(a),u,c))return!0}}return!1}i.check=o})(mH||={});function _9e(e,t){return r=>{let n=e(r),o=at.LinearBuilder(r.inputStructure);return r.pushCurrentElement(),at.forEach(n,(i,a)=>{r.currentStructure=i,t(r)&&o.add(i),a%100&&r.throwIfTimedOut()}),r.popCurrentStructure(),o.getSelection()}}function R9e(e){return t=>{let r=e(t),n=at.LinearBuilder(t.inputStructure);if(r.kind==="singletons"){if(r.structure.elementCount>0){let o=r.structure.units[0],i=De.create([o.getChild(Be.ofSingleton(o.elements[0]))],{parent:t.inputStructure});n.add(i)}}else r.structures.length>0&&n.add(r.structures[0]);return n.getSelection()}}function Z2(e,t,r){let{units:n}=e.currentStructure,o=e.pushCurrentElement();o.structure=e.currentStructure;for(let i of n){o.unit=i;let a=i.elements,s=t;if(s){for(let l=0,u=a.length;l<u;l++)o.element=a[l],r.add(s(e));e.throwIfTimedOut()}}return e.popCurrentElement(),r}function D9e(e,t,r){let n=new Set,o=t(e);return e.pushCurrentElement(),at.forEach(o,(i,a)=>{e.currentStructure=i,Z2(e,r,n),a%10&&e.throwIfTimedOut()}),e.popCurrentElement(),n}function w9e(e,t,r){return n=>{let o=e(n),i=D9e(n,t,r),a=at.LinearBuilder(n.inputStructure);return n.pushCurrentStructure(),at.forEach(o,(s,l)=>{n.currentStructure=s;let u=Z2(n,r,new Set);no.isSuperset(i,u)&&a.add(s),l%10&&n.throwIfTimedOut()}),n.popCurrentStructure(),a.getSelection()}}function E9e(e,t){return r=>{let n=at.unionStructure(t(r)),o=at.LinearBuilder(r.inputStructure);return at.forEach(e(r),(i,a)=>{Uv(n,i)&&o.add(i),a%10&&r.throwIfTimedOut()}),o.getSelection()}}function M9e(e){return t=>{let r={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return r.minRadius===0&&typeof e.minRadius>"u"?B9e(r):r.minRadius===0?k9e(r):L9e(r)}}function B9e({queryCtx:e,selection:t,target:r,maxRadius:n,invert:o}){let i=at.unionStructure(r).lookup3d,a=at.LinearBuilder(e.inputStructure),s=b.zero();return at.forEach(t,(l,u)=>{let{units:c}=l,m=!1;for(let d=0,p=c.length;d<p;d++){let h=c[d],{elements:f,conformation:y}=h;for(let g=0,x=f.length;g<x;g++){let S=f[g];if(y.position(S,s),i.check(s[0],s[1],s[2],n+y.r(S))){m=!0;break}}if(m)break}o&&(m=!m),m&&a.add(l),u%10===0&&e.throwIfTimedOut()}),a.getSelection()}function k9e({queryCtx:e,selection:t,target:r,maxRadius:n,invert:o,elementRadius:i}){let a=at.unionStructure(r),s=at.LinearBuilder(e.inputStructure);return e.pushCurrentElement(),at.forEach(t,(l,u)=>{let c=wue(e,a,l,n,i);o&&(c=!c),c&&s.add(l),u%10===0&&e.throwIfTimedOut()}),e.popCurrentElement(),s.getSelection()}function L9e({queryCtx:e,selection:t,target:r,minRadius:n,maxRadius:o,invert:i,elementRadius:a}){let s=at.unionStructure(r),l=at.LinearBuilder(e.inputStructure);return e.pushCurrentElement(),at.forEach(t,(u,c)=>{let m=Due(e,s,u,n,o,a);i&&(m=!m),m&&l.add(u),c%10===0&&e.throwIfTimedOut()}),e.popCurrentElement(),l.getSelection()}function F9e(e,t){let{queryCtx:r,input:n,target:o,disjunct:i}=e,a=r.atomicBond,s=n.interUnitBonds;a.setStructure(n);for(let l of t.units){if(!me.isAtomic(l))continue;let u=n.unitMap.get(l.id),{offset:c,b:m,edgeProps:{flags:d,order:p,key:h}}=u.bonds,f=s.getConnectedUnits(l.id),y=f.length,g=l.elements,x=u.elements;for(let S=0,I=g.length;S<I;S++){let v=Be.indexOf(x,g[S]);a.a.unit=u,a.b.unit=u;for(let A=c[v],_=c[v+1];A<_;A++)if(a.b.element=u.elements[m[A]],!(i&&Be.has(l.elements,a.b.element))&&o.hasElement(a.b)&&(a.aIndex=v,a.a.element=g[S],a.bIndex=m[A],a.type=d[A],a.order=p[A],a.key=h[A],a.test(r,!0)))return!0;for(let A=0;A<y;A++){let _=f[A],T=n.unitMap.get(_.unitB),w=T.elements,D=_.getEdges(v);for(let M=0,E=D.length;M<E;M++){let R=D[M];if(a.b.unit=T,a.b.element=w[R.indexB],!!o.hasElement(a.b)&&!(i&&t.hasElement(a.b))&&(a.a.unit=u,a.aIndex=v,a.a.element=g[S],a.bIndex=R.indexB,a.type=R.props.flag,a.order=R.props.order,a.key=R.props.key,a.test(r,!0)))return!0}}}}return!1}function V9e({query:e,target:t,disjunct:r,invert:n,bondTest:o}){return i=>{let a=t(i);if(at.isEmpty(a))return a;let s=e(i);if(at.isEmpty(s))return s;let l={queryCtx:i,input:i.inputStructure,disjunct:r,target:at.unionStructure(a)},u=at.LinearBuilder(i.inputStructure);return i.pushCurrentBond(),i.atomicBond.setTestFn(o),at.forEach(s,(c,m)=>{(F9e(l,c)||n)&&u.add(c),m%5===0&&i.throwIfTimedOut()}),i.popCurrentBond(),u.getSelection()}}var pH={};Bi(pH,{intersect:()=>G9e,merge:()=>O9e});function O9e(e){return e.length===0?VM:e.length===1?e[0]:t=>{let r=at.UniqueBuilder(t.inputStructure);for(let n=0;n<e.length;n++)at.forEach(e[n](t),(o,i)=>{r.add(o),n%100&&t.throwIfTimedOut()});return r.getSelection()}}function G9e(e){return e.length===0?VM:e.length===1?e[0]:t=>{let r=[];for(let s=0;s<e.length;s++)r.push(e[s](t));let n=0,o=at.structureCount(r[0]);for(let s=1;s<r.length;s++){let l=at.structureCount(r[s]);l<o&&(n=s,o=l)}t.throwIfTimedOut();let i=Av(s=>s.hashCode,De.areUnitIdsAndIndicesEqual);at.forEach(r[n],s=>i.add(s));let a=at.UniqueBuilder(t.inputStructure);for(let s=0;s<r.length;s++)s!==n&&(at.forEach(r[s],l=>{i.has(l)&&a.add(l)}),t.throwIfTimedOut());return a.getSelection()}}var fH={};Bi(fH,{atomCount:()=>U9e,countQuery:()=>N9e,propertySet:()=>z9e});function U9e(e){return e.currentStructure.elementCount}function N9e(e){return t=>{let r=e(t);return at.structureCount(r)}}function z9e(e){return t=>Z2(t,e,new Set)}var hH;(m=>{function e(d){return!!d&&!!d.has}function t(d,p){return h=>d(h)===p}m.eq=t;function r(d,p){return h=>d(h)<p}m.lt=r;function n(d,p){return h=>d(h)<=p}m.lte=n;function o(d,p){return h=>d(h)>p}m.gt=o;function i(d,p){return h=>d(h)>=p}m.gte=i;function a(d){return!0}function s(d){return!1}function l(d,p){if(e(p))return h=>p.has(d(h));{if(p.length===0)return s;let h=new Set;for(let f=0;f<p.length;f++)h.add(p[f]);return f=>h.has(d(f))}}m.inSet=l;function u(...d){switch(d.length){case 0:return a;case 1:return d[0];case 2:{let p=d[0],h=d[1];return f=>p(f)&&h(f)}case 3:{let p=d[0],h=d[1],f=d[2];return y=>p(y)&&h(y)&&f(y)}case 4:{let p=d[0],h=d[1],f=d[2],y=d[3];return g=>p(g)&&h(g)&&f(g)&&y(g)}case 5:{let p=d[0],h=d[1],f=d[2],y=d[3],g=d[4];return x=>p(x)&&h(x)&&f(x)&&y(x)&&g(x)}case 6:{let p=d[0],h=d[1],f=d[2],y=d[3],g=d[4],x=d[5];return S=>p(S)&&h(S)&&f(S)&&y(S)&&g(S)&&x(S)}default:{let p=d.length;return h=>{for(let f=0;f<p;f++)if(!d[f])return!1;return!0}}}}m.and=u;function c(...d){switch(d.length){case 0:return s;case 1:return d[0];case 2:{let p=d[0],h=d[1];return f=>p(f)||h(f)}case 3:{let p=d[0],h=d[1],f=d[2];return y=>p(y)||h(y)||f(y)}case 4:{let p=d[0],h=d[1],f=d[2],y=d[3];return g=>p(g)||h(g)||f(g)||y(g)}case 5:{let p=d[0],h=d[1],f=d[2],y=d[3],g=d[4];return x=>p(x)||h(x)||f(x)||y(x)||g(x)}case 6:{let p=d[0],h=d[1],f=d[2],y=d[3],g=d[4],x=d[5];return S=>p(S)||h(S)||f(S)||y(S)||g(S)||x(S)}default:{let p=d.length;return h=>{for(let f=0;f<p;f++)if(d[f])return!0;return!1}}}}m.or=c})(hH||={});var Fn={generators:tH,filters:dH,modifiers:uH,combinators:pH,pred:hH,internal:J9,atomset:fH};var im;(u=>{function e(c,m){return Pe.create("Build Assembly",async d=>{let p=c.models;if(p.length!==1)throw new Error("Can only build assemblies from structures based on 1 model.");let h=ux.findAssembly(p[0],m);if(!h)throw new Error(`Assembly '${m}' is not defined.`);let f=jn.create(h.id,Z.identity(),{assembly:{id:h.id,operId:0,operList:[]}}),y=De.Builder({coordinateSystem:f,label:c.label,dynamicBonds:c.dynamicBonds}),g=new ai(c);for(let x of h.operatorGroups){let S=x.selector(g);if(at.structureCount(S)===0)continue;let{units:I}=at.unionStructure(S);for(let v of x.operators)for(let A of I)y.addWithOperator(A,v)}return y.getStructure()})}u.buildAssembly=e;function t(c,m,d){return Pe.create("Build Symmetry Assembly",async p=>{let h=c.models;if(h.length!==1)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");let f=b(),y=De.Builder({label:c.label,representativeModel:h[0],dynamicBonds:c.dynamicBonds}),g=new ai(c);for(let x of m){let I=H9e(x.asymIds)(g);if(at.structureCount(I)===0)continue;let{units:v}=at.unionStructure(I);for(let{index:A,shift:[_,T,w]}of x.operators){let D=Eue(d,A,_,T,w,f);for(let M of v)for(let E of D)y.addWithOperator(M,E)}}return y.getStructure()})}u.buildSymmetryAssembly=t;function r(c,m){return Pe.create("Find Symmetry Mates",d=>Q9e(d,c,m))}u.builderSymmetryMates=r;function n(c,m,d){return Pe.create("Build Symmetry",p=>X9e(p,c,m,d))}u.buildSymmetryRange=n;function o(c){return Pe.create("Build NCS",m=>W9e(m,c))}u.buildNcs=o;function i(c,m){return c.invariantId===m.invariantId&&c.model.id===m.model.id&&Be.areEqual(c.elements,m.elements)}u.areUnitsEquivalent=i;function a(){return gee(me.hashUnit,i)}u.UnitEquivalenceBuilder=a;function s(c){let m=a();for(let p of c.units)m.add(p.id,p);let d=[];for(let p of m.groups)d.push(me.SymmetryGroup(p.map(h=>c.unitMap.get(h))));return d}u.computeTransformGroups=s;function l(c,m){if(c.length!==m.length)return!1;for(let d=0,p=c.length;d<p;++d){let h=c[d].units,f=m[d].units;if(h.length!==f.length||c[d].hashCode!==m[d].hashCode)return!1;for(let y=0,g=h.length;y<g;y++)if(h[y].conformation!==f[y].conformation)return!1}return!0}u.areTransformGroupsEquivalent=l})(im||={});function H9e(e){return Fn.generators.atoms({chainTest:Fn.pred.and(Fn.pred.eq(t=>qe.unit.operator_name(t.element),jn.DefaultName),Fn.pred.inSet(t=>qe.chain.label_asym_id(t.element),e))})}function Eue(e,t,r,n,o,i){let{spacegroup:a,ncsOperators:s}=e,l=[],{toFractional:u}=a.cell,c=b.transformMat4(b(),i,u),m=Ns.getSymmetryOperatorRef(a,t,r,n,o,c);if(s&&s.length)for(let d=0,p=s.length;d<p;++d){let h=s[d],f=Z.mul(Z(),m.matrix,h.matrix),y=jn.create(`${m.name} ${h.name}`,f,{assembly:m.assembly,ncsId:h.ncsId,hkl:m.hkl,spgrOp:m.spgrOp});l.push(y)}else l.push(m);return l}function Mue(e,t,r,n){let{spacegroup:o,ncsOperators:i}=e,a=i&&i.length||0,s=[];!a&&t[0]<=0&&r[0]>=0&&t[1]<=0&&r[1]>=0&&t[2]<=0&&r[2]>=0&&(s[0]=Ns.getSymmetryOperator(o,0,0,0,0));for(let l=0;l<o.operators.length;l++)for(let u=t[0];u<=r[0];u++)for(let c=t[1];c<=r[1];c++)for(let m=t[2];m<=r[2];m++)!a&&l===0&&u===0&&c===0&&m===0||s.push(...Eue(e,l,u,c,m,n));return s}function j9e(e,t){return e._operators_333&&b.equals(t,e._operators_333.ref)||(e._operators_333={ref:b.clone(t),operators:Mue(e,b.create(-3,-3,-3),b.create(3,3,3),t)}),e._operators_333.operators}function Bue(e,t){let r=De.Builder({label:e.label,dynamicBonds:e.dynamicBonds}),{units:n}=e;for(let o of t)for(let i of n)r.addWithOperator(i,o);return r.getStructure()}async function W9e(e,t){let r=t.models;if(r.length!==1)throw new Error("Can only build NCS from structures based on 1 model.");let n=wo.Provider.get(r[0]);if(!n)return t;let o=n.ncsOperators;return!o||!o.length?t:Bue(t,o)}async function X9e(e,t,r,n){let o=t.models;if(o.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");let i=wo.Provider.get(o[0]);if(!i)return t;let{spacegroup:a}=i;if(Yi.isZero(a.cell))return t;let s=Ft.getCenter(o[0]),l=Mue(i,r,n,s);return Bue(t,l)}async function Q9e(e,t,r){let n=t.models;if(n.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");let o=wo.Provider.get(n[0]);if(!o)return t;let{spacegroup:i}=o;if(Yi.isZero(i.cell))return t;e.shouldUpdate&&await e.update("Initialing...");let a=Ft.getCenter(n[0]),s=j9e(o,a),l=t.lookup3d,u=new Set;function c(h,f){return`${h.invariantId}|${f.name}`}let m=De.Builder({label:t.label,dynamicBonds:t.dynamicBonds}),{units:d}=t,p=b.zero();for(let h of s){for(let f of d){let y=f.lookup3d.boundary.sphere;b.transformMat4(p,y.center,h.matrix);let g=l.findUnitIndices(p[0],p[1],p[2],y.radius+r);for(let x=0,S=g.count;x<S;x++){if(!d[g.indices[x]].lookup3d.check(p[0],p[1],p[2],y.radius+r))continue;let v=c(f,h);u.has(v)||(m.addWithOperator(f,h),u.add(v))}}e.shouldUpdate&&await e.update("Building symmetry...")}return m.getStructure()}var UM=class{constructor(t,r){this.parent=t;this.isSorted=r;this.ids=[];this.unitMap=xl.Mutable();this.parentId=-1;this.currentUnit=[];this.elementCount=0}addToUnit(t,r){let n=this.unitMap.get(t);n?n[n.length]=r:(this.unitMap.set(t,[r]),this.ids[this.ids.length]=t),this.elementCount++}beginUnit(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit}addElement(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++}addElementRange(t,r,n){for(let o=r;o<n;o++)this.currentUnit[this.currentUnit.length]=t[o],this.elementCount++}commitUnit(){this.currentUnit.length!==0&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}setUnit(t,r){this.ids[this.ids.length]=t,this.unitMap.set(t,r),this.elementCount+=r.length}_getStructure(t){if(this.isEmpty)return De.Empty;let r=[];Fs(this.ids);let n=im.UnitEquivalenceBuilder();for(let o=0,i=this.ids.length;o<i;o++){let a=this.ids[o],s=this.parent.unitMap.get(a),l=this.unitMap.get(a),u=!1;t&&(this.isSorted||Fs(l),l=Be.deduplicate(Be.ofSortedArray(this.currentUnit)),u=!0);let c=l.length;if(l.length===s.elements.length){r[r.length]=s,n.add(s.id,s);continue}!this.isSorted&&!u&&c>1&&Fs(l);let m=s.getChild(Be.ofSortedArray(l)),d=n.add(m.id,m);m!==d&&(m=d.applyOperator(m.id,m.conformation.operator,!0)),r[r.length]=m}return De.create(r,{parent:this.parent})}getStructure(){return this._getStructure(!1)}getStructureDeduplicate(){return this._getStructure(!0)}setSingletonLocation(t){let r=this.ids[0];t.unit=this.parent.unitMap.get(r),t.element=this.unitMap.get(r)[0]}get isEmpty(){return this.elementCount===0}};function kue(e,t){let r=1;for(;t--;)r*=e--;return r}function Z9e(e,t){return t>e?0:kue(e,t)/kue(t,t)}function q9e(e){let t=e&-e,r=e+t,o=((r&-r)/t>>1)-1;return r|o}var gH=class{constructor(t,r){this.array=t;this.hasNext=!1;this.index=(1<<r)-1,this.size=Z9e(t.length,r),this.maxIndex=1<<t.length,this.value=new Array(r),this.hasNext=r>0&&r<=t.length}move(){if(this.hasNext){let t=0,r=0,n=this.index;for(;n;n>>>=1,t++)n&1&&(this.value[r++]=this.array[t]);this.index=q9e(this.index),this.hasNext=this.index<this.maxIndex}return this.value}};function yH(e,t){let r=[],n=new gH(e,t);for(;n.hasNext;)r.push(n.move().slice());return r}var W0=[],Lue={links:W0,terminalLinks:W0,elements:W0,partialElements:W0,getElementIndices:()=>W0,getLinkIndices:()=>W0,getTerminalLinkIndices:()=>W0};var Hs=of("C"),q2=of("O"),Y9e=[Jm.elementFingerprint([Hs,Hs,Hs,q2]),Jm.elementFingerprint([Hs,Hs,Hs,Hs,q2]),Jm.elementFingerprint([Hs,Hs,Hs,Hs,Hs,q2]),Jm.elementFingerprint([Hs,Hs,Hs,Hs,Hs,Hs,q2])];function K9e(e,t){let r=-1,n=-1,o=-1,i=-1,{elements:a}=e,{type_symbol:s,label_atom_id:l}=e.model.atomicHierarchy.atoms,{b:u,offset:c}=e.bonds;for(let m=0,d=t.length;m<d;++m){let p=a[t[m]];if(s.value(p)!==Hs)continue;let h=0,f=0;for(let y=c[t[m]],g=c[t[m]+1];y<g;++y){let x=a[u[y]],S=s.value(x);S===q2?++h:S===Hs&&++f}if(h===2){r=p;break}else h===1&&f===1?n=p:l.value(p).startsWith("C1")?o=p:i=p}return r!==-1?r:n!==-1?n:o!==-1?o:i!==-1?i:a[t[0]]}function J9e(e,t){let{elements:r}=e,{label_alt_id:n}=e.model.atomicHierarchy.atoms;return n.value(r[t])}function $9e(e,t,r,n){let o=t.conformation;return b.normalize(e,b.sub(e,n,o.position(r,e))),e}function Fue(e,t){let{elements:r}=e,{label_atom_id:n}=e.model.atomicHierarchy.atoms;return n.value(r[t])}function eHe(e,t){if(!t||!t.length)return;let{unit:r,all:n}=e,o=new Set,i=yH(_a(new Array(t.length)),2);for(let a=0,s=i.length;a<s;++a){let l=i[a],u=n[t[l[0]]],c=n[t[l[1]]];Be.areIntersecting(u,c)&&Jm.getAltId(r,u)===Jm.getAltId(r,c)&&(o.add(t[l[0]]),o.add(t[l[1]]))}if(o.size){let a=[];for(let s=0,l=t.length;s<l;++s)o.has(t[s])||a.push(t[s]);return a}else return t}function tHe(e,t){return t.properties.saccharideComponentMap.get(e)}function Vue(e){if(e.models.reduce((d,p)=>d+p.properties.saccharideComponentMap.size,0)===0)return Lue;let t=[],r=[],n=[],o=[],i=new Map;function a(d,p,h){return`${d}|${p}|${h}`}function s(d,p){i.has(d)?i.get(d).push(p):i.set(d,[p])}function l(d,p){b.sub(n[d].geometry.direction,n[p].geometry.center,n[d].geometry.center),b.normalize(n[d].geometry.direction,n[d].geometry.direction)}let u=b();function c(d,p,h){let f=h.conformation,y=n[d].geometry;b.sub(y.direction,f.position(h.elements[p],u),y.center),b.normalize(y.direction,y.direction)}for(let d=0,p=e.units.length;d<p;++d){let h=e.units[d];if(!me.isAtomic(h))continue;let{model:f,rings:y}=h,{chainAtomSegments:g,residueAtomSegments:x,atoms:S}=f.atomicHierarchy,{label_comp_id:I}=S,v=Xt.transientSegments(g,h.elements),A=Xt.transientSegments(x,h.elements),_;for(;v.hasNext;)for(A.setSegment(v.move());A.hasNext;){let{index:T}=A.move(),w=tHe(I.value(x.offsets[T]),f);if(!w)continue;_||(_=lx.byFingerprintAndResidue(y,Y9e));let D=eHe(y,_.get(T));if(!D||!D.length){o.push({unit:h,residueIndex:T,component:w});continue}let M=[];for(let R=0,k=D.length;R<k;++R){let B=y.all[D[R]],L=K9e(h,B),V=lu.calculateMomentsAxes(PM(h,B)),U=lu.calculateNormalizedAxes(V),Q=b.copy(b(),U.origin),O=b.copy(b(),U.dirC),q=$9e(b(),h,L,Q);b.orthogonalize(q,O,q);let X=Jm.getAltId(h,B),F=n.length;M.push(F),s(a(T,h.id,X),F),X&&s(a(T,h.id,""),F),n.push({geometry:{center:Q,normal:O,direction:q},component:w,ringIndex:D[R],altId:X,unit:h,residueIndex:T})}let E=yH(_a(new Array(D.length)),2);for(let R=0,k=E.length;R<k;++R){let B=E[R],L=y.all[D[B[0]]],V=y.all[D[B[1]]];if(ns.areVertexSetsConnected(h.bonds,L,V,3)){let U=M[B[0]],Q=M[B[1]];n[U].altId===n[Q].altId&&(l(U,Q),l(Q,U),t.push({carbohydrateIndexA:U,carbohydrateIndexB:Q}),t.push({carbohydrateIndexA:Q,carbohydrateIndexB:U}))}}}}function m(d,p){return i.get(a(d.getResidueIndex(p),d.id,J9e(d,p)))||[]}for(let d=0,p=n.length;d<p;++d){let h=n[d],{unit:f}=h;for(let y=d+1;y<p;++y){let g=n[y];if(f!==g.unit||h.residueIndex===g.residueIndex)continue;let x=f.rings.all[h.ringIndex],S=f.rings.all[g.ringIndex];ns.areVertexSetsConnected(f.bonds,x,S,3)&&(l(d,y),l(y,d),t.push({carbohydrateIndexA:d,carbohydrateIndexB:y}),t.push({carbohydrateIndexA:y,carbohydrateIndexB:d}))}}for(let d=0,p=e.units.length;d<p;++d){let h=e.units[d];me.isAtomic(h)&&e.interUnitBonds.getConnectedUnits(h.id).forEach(f=>{f.connectedIndices.forEach(y=>{f.getEdges(y).forEach(({props:g,indexB:x})=>{if(!ht.isCovalent(g.flag))return;let S=e.unitMap.get(f.unitA),I=e.unitMap.get(f.unitB),v=m(S,y),A=m(I,x);if(v.length>0&&A.length>0){let _=v.length,T=A.length;for(let w=0,D=Math.max(_,T);w<D;++w){let M=v[Math.min(w,_-1)],E=A[Math.min(w,T-1)],R=Fue(S,y);(R.startsWith("O1")||R.startsWith("C1"))&&l(M,E),t.push({carbohydrateIndexA:M,carbohydrateIndexB:E})}}else if(A.length===0)for(let _ of v){let T=Fue(S,y);(T.startsWith("O1")||T.startsWith("C1"))&&c(_,x,I),r.push({carbohydrateIndex:_,elementIndex:x,elementUnit:I,fromCarbohydrate:!0})}else if(v.length===0)for(let _ of A)r.push({carbohydrateIndex:_,elementIndex:y,elementUnit:S,fromCarbohydrate:!1})})})})}return{links:t,terminalLinks:r,elements:n,partialElements:o,...rHe(n,t,r)}}function rHe(e,t,r){function n(m,d){return Xi(m.id,d)}function o(m,d,p){let h=[],f=m.get(n(d,p));if(f!==void 0)for(let y of f)qo(h,y);return h}let i=new Map;for(let m=0,d=e.length;m<d;++m){let{unit:p,ringIndex:h}=e[m],f=p.rings.all[h];for(let y=0,g=f.length;y<g;++y){let x=n(p,p.elements[f[y]]),S=i.get(x);S===void 0?i.set(x,[m]):S.push(m)}}function a(m,d){return o(i,m,d)}let s=new Map;for(let m=0,d=t.length;m<d;++m){let p=t[m],{unit:h,ringIndex:f}=e[p.carbohydrateIndexA],y=h.rings.all[f];for(let g=0,x=y.length;g<x;++g){let S=n(h,h.elements[y[g]]),I=s.get(S);I===void 0?s.set(S,[m]):I.push(m)}}function l(m,d){return o(s,m,d)}let u=new Map;for(let m=0,d=r.length;m<d;++m){let{fromCarbohydrate:p,carbohydrateIndex:h,elementUnit:f,elementIndex:y}=r[m];if(p){let{unit:g,ringIndex:x}=e[h],S=g.rings.all[x];for(let I=0,v=S.length;I<v;++I){let A=n(g,g.elements[S[I]]),_=u.get(A);_===void 0?u.set(A,[m]):_.push(m)}}else{let g=n(f,f.elements[y]),x=u.get(g);x===void 0?u.set(g,[m]):x.push(m)}}function c(m,d){return o(u,m,d)}return{getElementIndices:a,getLinkIndices:l,getTerminalLinkIndices:c}}var NM=ye(),nHe=new Ci("14"),oHe=new Ci("98");function iHe(e){return e>500?nHe:oHe}function Oue(e){let{units:t}=e,r=iHe(t.length);r.reset();for(let n=0,o=t.length;n<o;n++){let i=t[n],a=i.boundary,s=i.conformation.operator;s.isIdentity?r.includeSphere(a.sphere):(ye.transform(NM,a.sphere,s.matrix),r.includeSphere(NM))}r.finishedIncludeStep();for(let n=0,o=t.length;n<o;n++){let i=t[n],a=i.boundary,s=i.conformation.operator;s.isIdentity?r.radiusSphere(a.sphere):(ye.transform(NM,a.sphere,s.matrix),r.radiusSphere(NM))}return{box:r.getBox(),sphere:r.getSphere()}}function Gue(e){let{units:t,elementCount:r,unitIndexMap:n}=e,o=new Uint32Array(t.length),i=new Uint32Array(r),a=new Uint32Array(r);for(let s=0,l=0,u=t.length;s<u;++s){o[s]=l;let{elements:c}=t[s];for(let m=0,d=c.length;m<d;++m){let p=l+m;i[p]=s,a[p]=c[m]}l+=c.length}return{cumulativeUnitElementCount:o,unitIndices:i,elementIndices:a,getSerialIndex:(s,l)=>o[n.get(s.id)]+Se.indexOf(s.elements,l)}}function Uue(e){let t=0,r=[];for(let l of e.unitSymmetryGroups){r.push(t);let u=l.units[0];me.isAtomic(u)&&(t+=u.bonds.edgeCount*2*l.units.length)}let n=new Uint32Array(t),o=new Uint32Array(t),i=new Uint32Array(t),a=0,s=0;for(let l of e.unitSymmetryGroups){let u=l.units[0];if(me.isAtomic(u)){let c=u.bonds.edgeCount*2;for(let m=0,d=l.units.length;m<d;++m)for(let p=0,h=c;p<h;++p)n[a]=s,o[a]=p,i[a]=m,a+=1}s+=1}return{bondCount:t,unitIndex:n,unitEdgeIndex:o,unitGroupIndex:i,unitGroupOffset:r}}var De=class e{constructor(t,r,n,o,i){this.units=t;this.unitMap=r;this.unitIndexMap=n;this.state=o;this._child=i?.child,this._target=i?.target,this._proxy=void 0}subsetBuilder(t){return new UM(this,t)}get elementCount(){return this.state.elementCount}get bondCount(){return this.state.bondCount===-1&&(this.state.bondCount=this.interUnitBonds.edgeCount/2+Ct.getIntraUnitBondCount(this)),this.state.bondCount}get hasCustomProperties(){return!!this.state.customProps&&this.state.customProps.all.length>0}get customPropertyDescriptors(){return this.state.customProps||(this.state.customProps=new ka),this.state.customProps}get currentPropertyData(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData}get inheritedPropertyData(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData}get polymerResidueCount(){return this.state.polymerResidueCount===-1&&(this.state.polymerResidueCount=pHe(this)),this.state.polymerResidueCount}get polymerGapCount(){return this.state.polymerGapCount===-1&&(this.state.polymerGapCount=fHe(this)),this.state.polymerGapCount}get polymerUnitCount(){return this.state.polymerUnitCount===-1&&(this.state.polymerUnitCount=hHe(this)),this.state.polymerUnitCount}get uniqueElementCount(){return this.state.uniqueElementCount===-1&&(this.state.uniqueElementCount=dHe(this)),this.state.uniqueElementCount}get atomicResidueCount(){return this.state.atomicResidueCount===-1&&(this.state.atomicResidueCount=gHe(this)),this.state.atomicResidueCount}get isCoarseGrained(){return this.models.some(t=>Ft.isCoarseGrained(t))}get isEmpty(){return this.units.length===0}get hashCode(){return this.state.hashCode!==-1?this.state.hashCode:this.computeHash()}get transformHash(){return this.state.transformHash!==-1?this.state.transformHash:(this.state.transformHash=Ro(this.units.map(t=>t.id)),this.state.transformHash)}computeHash(){let t=23;for(let r=0,n=this.units.length;r<n;r++){let o=this.units[r];t=31*t+o.id|0,t=31*t+Be.hashCode(o.elements)|0}return t=31*t+this.elementCount|0,t=pw(t),t===-1&&(t=0),this.state.hashCode=t,t}elementLocations(){return new e.ElementLocationIterator(this)}get root(){return this.state.parent??this}get parent(){return this.state.parent}get coordinateSystem(){return this.state.coordinateSystem}get label(){return this.state.label}get boundary(){return this.state.boundary?this.state.boundary:(this.state.boundary=Oue(this),this.state.boundary)}get lookup3d(){return this.state.lookup3d?this.state.lookup3d:(this.state.lookup3d=new EM(this),this.state.lookup3d)}get interUnitBonds(){return this.state.interUnitBonds?this.state.interUnitBonds:(this.parent&&this.state.dynamicBonds===this.parent.state.dynamicBonds&&this.parent.state.interUnitBonds&&this.parent.state.interUnitBonds.edgeCount===0?this.state.interUnitBonds=new dh(new Map):this.state.interUnitBonds=Ale(this,{ignoreWater:!this.dynamicBonds,ignoreIon:!this.dynamicBonds,validUnit:this.state.interBondsValidUnit,validUnitPair:this.state.interBondsValidUnitPair}),this.state.interUnitBonds)}get dynamicBonds(){return this.state.dynamicBonds}get interBondsValidUnit(){return this.state.interBondsValidUnit}get interBondsValidUnitPair(){return this.state.interBondsValidUnitPair}get unitSymmetryGroups(){return this.state.unitSymmetryGroups?this.state.unitSymmetryGroups:(this.state.unitSymmetryGroups=im.computeTransformGroups(this),this.state.unitSymmetryGroups)}get unitSymmetryGroupsIndexMap(){return this.state.unitSymmetryGroupsIndexMap?this.state.unitSymmetryGroupsIndexMap:(this.state.unitSymmetryGroupsIndexMap=me.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups),this.state.unitSymmetryGroupsIndexMap)}get carbohydrates(){return this.state.carbohydrates?this.state.carbohydrates:(this.state.carbohydrates=Vue(this),this.state.carbohydrates)}get models(){return this.state.models?this.state.models:(this.state.models=sHe(this),this.state.models)}get uniqueResidueNames(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=lHe(this))}get uniqueElementSymbols(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=uHe(this))}get entityIndices(){return this.state.entityIndices||(this.state.entityIndices=cHe(this))}get uniqueAtomicResidueIndices(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=mHe(this))}get isAtomic(){for(let t of this.units)if(!me.isAtomic(t))return!1;return!0}get hasAtomic(){for(let t of this.units)if(me.isAtomic(t))return!0;return!1}get isCoarse(){for(let t of this.units)if(!me.isCoarse(t))return!1;return!0}get hasCoarse(){for(let t of this.units)if(me.isCoarse(t))return!0;return!1}get serialMapping(){return this.state.serialMapping||(this.state.serialMapping=Gue(this))}get intraUnitBondMapping(){return this.state.intraUnitBondMapping||(this.state.intraUnitBondMapping=Uue(this))}get model(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;let t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model}get masterModel(){return this.state.masterModel}get representativeModel(){return this.state.representativeModel}hasElement(t){return this.unitMap.has(t.unit.id)?Be.has(this.unitMap.get(t.unit.id).elements,t.element):!1}getModelIndex(t){return this.models.indexOf(t)}remapModel(t){let{dynamicBonds:r,interUnitBonds:n,parent:o}=this.state,i=[];for(let a of this.unitSymmetryGroups){let s=a.units[0].remapModel(t,r);i.push(s);for(let l=1,u=a.units.length;l<u;++l){let c=a.units[l];i.push(c.remapModel(t,r,s.props))}}return e.create(i,{parent:o?.remapModel(t),label:this.label,interUnitBonds:r?void 0:n,dynamicBonds:r,interBondsValidUnit:this.state.interBondsValidUnit,interBondsValidUnitPair:this.state.interBondsValidUnitPair,coordinateSystem:this.state.coordinateSystem,masterModel:this.state.masterModel,representativeModel:this.state.representativeModel})}asParent(){if(this._proxy)return this._proxy;if(this.parent){let t=this.parent.coordinateSystem.isIdentity?this.parent:e.transform(this.parent,this.parent.coordinateSystem.inverse),r=this.coordinateSystem.isIdentity?t:e.transform(t,this.coordinateSystem.matrix);this._proxy=new e(r.units,r.unitMap,r.unitIndexMap,{...r.state,dynamicBonds:this.dynamicBonds},{child:this,target:this.parent})}else this._proxy=this;return this._proxy}get child(){return this._child}get target(){return this._target??this}};function aHe(e,t,r){return e[t].id-e[r].id}function sHe(e){let{units:t}=e,r=Tn.create();for(let n of t)Tn.add(r,n.model.id,n.model);return r.array}function lHe(e){let{microheterogeneityCompIds:t}=qe.residue,r=new Set,n=K.Location.create(e);for(let o of e.unitSymmetryGroups){let i=o.units[0];if(!me.isAtomic(i))continue;let a=Xt.transientSegments(i.model.atomicHierarchy.residueAtomSegments,i.elements);for(n.unit=i;a.hasNext;){let s=a.move();n.element=i.elements[s.start];let l=t(n);for(let u of l)r.add(u)}}return r}function uHe(e){let t=qe.atom.type_symbol,r=new Set,n=K.Location.create(e);for(let o of e.unitSymmetryGroups){let i=o.units[0];if(me.isAtomic(i)){n.unit=i;for(let a=0,s=i.elements.length;a<s;++a)n.element=i.elements[a],r.add(t(n))}}return r}function cHe(e){let{units:t}=e,r=K.Location.create(e),n=Tn.create();for(let o of t){let i=o.kind===me.Kind.Atomic?qe.entity.key:qe.coarse.entityKey;r.unit=o;let a=o.elements,s=Xt.transientSegments(o.model.atomicHierarchy.chainAtomSegments,a);for(;s.hasNext;){let l=s.move();r.element=a[l.start];let u=i(r);Tn.add(n,u,u)}}return Fs(n.array),n.array}function mHe(e){let t=new Map,r=[],n=e.unitSymmetryGroups;for(let i of n){let a=i.units[0];if(!me.isAtomic(a))continue;let s;t.has(a.model.id)?s=t.get(a.model.id):(s=Tn.create(),r.push(a.model.id),t.set(a.model.id,s));let l=Xt.transientSegments(a.model.atomicHierarchy.residueAtomSegments,a.elements);for(;l.hasNext;){let u=l.move();Tn.add(s,u.index,u.index)}}let o=new Map;for(let i of r){let a=t.get(i).array;Fs(a),o.set(i,a)}return o}function dHe(e){let{unitSymmetryGroups:t}=e,r=0;for(let n=0,o=t.length;n<o;n++)r+=t[n].elements.length;return r}function pHe(e){let{units:t}=e,r=0;for(let n=0,o=t.length;n<o;n++)r+=t[n].polymerElements.length;return r}function fHe(e){let{units:t}=e,r=0;for(let n=0,o=t.length;n<o;n++)r+=t[n].gapElements.length/2;return r}function hHe(e){let{units:t}=e,r=0;for(let n=0,o=t.length;n<o;n++)t[n].polymerElements.length>0&&(r+=1);return r}function gHe(e){let{units:t}=e,r=0;for(let n=0,o=t.length;n<o;n++){let i=t[n];if(!me.isAtomic(i))continue;let{elements:a,residueIndex:s}=i,l=-1,u=-1;for(let c=0,m=a.length;c<m;++c)l=s[a[c]],l!==u&&(r+=1,u=l)}return r}(W=>{W.Empty=l([]);function t(N){return{kind:"structure-loci",structure:N}}W.Loci=t;function r(N){let j=[];for(let ue of N.units)j.push({unit:ue,indices:xe.ofBounds(0,ue.elements.length)});return K.Loci(N,j)}W.toStructureElementLoci=r;function n(N,j){return at.toLociWithSourceUnits(at.Singletons(N,j))}W.toSubStructureElementLoci=n;function o(N){return!!N&&N.kind==="structure-loci"}W.isLoci=o;function i(N,j){return N.structure===j.structure}W.areLociEqual=i;function a(N){return N.structure.isEmpty}W.isLociEmpty=a;function s(N,j){return j===N.structure?N:t(j)}W.remapLoci=s;function l(N,j={}){let ue=xl.Mutable(),be=xl.Mutable(),ee=0,le=!0,Ae=N.length>0?N[0].id:0;for(let J=0,z=N.length;J<z;J++){let ae=N[J];ue.set(ae.id,ae),ee+=ae.elements.length,ae.id<Ae&&(le=!1),Ae=ae.id}le||mw(N,0,N.length,aHe,zg);for(let J=0,z=N.length;J<z;J++)be.set(N[J].id,J);let Ce={hashCode:-1,transformHash:-1,elementCount:ee,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,dynamicBonds:!1,coordinateSystem:jn.Default,label:""};return j.parent&&(Ce.parent=j.parent.parent||j.parent),j.interUnitBonds&&(Ce.interUnitBonds=j.interUnitBonds),j.interBondsValidUnit?Ce.interBondsValidUnit=j.interBondsValidUnit:j.parent&&(Ce.interBondsValidUnit=j.parent.interBondsValidUnit),j.interBondsValidUnitPair?Ce.interBondsValidUnitPair=j.interBondsValidUnitPair:j.parent&&(Ce.interBondsValidUnitPair=j.parent.interBondsValidUnitPair),j.dynamicBonds?Ce.dynamicBonds=j.dynamicBonds:j.parent&&(Ce.dynamicBonds=j.parent.dynamicBonds),j.coordinateSystem?Ce.coordinateSystem=j.coordinateSystem:j.parent&&(Ce.coordinateSystem=j.parent.coordinateSystem),j.label?Ce.label=j.label:j.parent&&(Ce.label=j.parent.label),j.masterModel?Ce.masterModel=j.masterModel:j.parent&&(Ce.masterModel=j.parent.masterModel),j.representativeModel?Ce.representativeModel=j.representativeModel:j.parent&&(Ce.representativeModel=j.parent.representativeModel),new W(N,ue,be,Ce)}W.create=l;async function u(N,j){if(N.frameCount===0)return W.Empty;let ue=[],be,ee=0;for(let le=0,Ae=N.frameCount;le<Ae;++le){let Ce=await Pe.resolveInContext(N.getFrameAtIndex(le),j);be||(be=Ce);let J=c(Ce);for(let z=0,ae=J.units.length;z<ae;++z){let ge=J.units[z],ve=ge.invariantId+ee,Oe=ge.chainGroupId+ee,ze=me.create(ue.length,ve,Oe,ge.traits,ge.kind,ge.model,ge.conformation.operator,ge.elements);ue.push(ze)}ee=ue.length}return l(ue,{representativeModel:be,label:be.label})}W.ofTrajectory=u;function c(N,j={}){let ue=N.atomicHierarchy.chainAtomSegments,{index:be}=N.atomicHierarchy,{auth_asym_id:ee}=N.atomicHierarchy.chains,{atomicChainOperatorMappinng:le}=N,Ae=new f({label:N.label,...j});for(let J=0;J<ue.count;J++){let z=le.get(J)||jn.Default,ae=ue.offsets[J],ge=!1,ve=!1;if(m(N,J))for(ve=!0;J+1<ue.count&&m(N,J+1);){let Re=le.get(J),Ke=le.get(J+1);if(Re!==Ke)break;ge=!0,J++}else for(;J+1<ue.count&&ue.offsets[J+1]-ue.offsets[J]===1&&ue.offsets[J+2]-ue.offsets[J+1]===1;){let Re=be.getEntityFromChain(J),Ke=be.getEntityFromChain(J+1);if(Re!==Ke)break;let tt=ee.value(J),bt=ee.value(J+1);if(tt!==bt)break;let Pt=le.get(J),fr=le.get(J+1);if(Pt!==fr)break;ge=!0,J++}let Oe=Be.ofBounds(ae,ue.offsets[J+1]),ze=me.Trait.None;ge&&(ze|=me.Trait.MultiChain),ve&&(ze|=me.Trait.Water),Ft.isCoarseGrained(N)&&(ze|=me.Trait.CoarseGrained),Ae.addUnit(me.Kind.Atomic,N,z,Oe,ze)}let Ce=N.coarseHierarchy;return Ce.isDefined&&(Ce.spheres.count>0&&d(Ae,N,N.coarseHierarchy.spheres,me.Kind.Spheres),Ce.gaussians.count>0&&d(Ae,N,N.coarseHierarchy.gaussians,me.Kind.Gaussians)),Ae.getStructure()}W.ofModel=c;function m(N,j){let ue=N.atomicHierarchy.index.getEntityFromChain(j);return N.entities.data.type.value(ue)==="water"}function d(N,j,ue,be){let{chainElementSegments:ee}=ue;for(let le=0;le<ee.count;le++){let Ae=Be.ofBounds(ee.offsets[le],ee.offsets[le+1]);N.addUnit(be,j,jn.Default,Ae,me.Trait.None)}}function p(N,j){if(Z.isIdentity(j))return N;if(!Z.isRotationAndTranslation(j,jn.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");let ue=[];for(let le of N.units){let Ae=le.conformation.operator,Ce=jn.create(Ae.name,j,Ae);ue.push(le.applyOperator(le.id,Ce))}let be=N.coordinateSystem,ee=jn.compose(jn.create(be.name,j,be),be);return l(ue,{parent:N,coordinateSystem:ee})}W.transform=p;function h(N,j){for(let ee of j)if(!Z.isRotationAndTranslation(ee,jn.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");let ue=[],be=0;for(let ee of N.units){let le=ee.conformation.operator;for(let Ae of j){if(Z.isIdentity(Ae)){ue.push(ee);continue}let Ce=jn.create(le.name,Ae,le);ue.push(ee.applyOperator(be++,Ce))}}return l(ue,{parent:N})}W.instances=h;class f{constructor(j={}){this.props=j;this.units=[];this.invariantId=oi();this.chainGroupId=-1;this.inChainGroup=!1;this.p=b();this.singleElementUnits=new Map}beginChainGroup(){this.chainGroupId++,this.inChainGroup=!0}endChainGroup(){this.inChainGroup=!1}addUnit(j,ue,be,ee,le,Ae){Ae===void 0&&(Ae=this.invariantId());let Ce=this.inChainGroup?this.chainGroupId:++this.chainGroupId,J=me.create(this.units.length,Ae,Ce,le,j,ue,be,ee);return this.add(J)}copyUnit(j,ue){let be=ue?.invariantId;be===void 0&&(be=this.invariantId());let ee=this.inChainGroup?this.chainGroupId:++this.chainGroupId,le=j.getCopy(this.units.length,be,ee,ue);return this.add(le)}add(j){if(j.elements.length===1){j.conformation.position(j.elements[0],this.p);let ue=[j.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(ue))return this.singleElementUnits.get(ue);this.singleElementUnits.set(ue,j)}return this.units.push(j),j}addWithOperator(j,ue,be=!1){return this.add(j.applyOperator(this.units.length,ue,be))}getStructure(){return l(this.units,this.props)}get isEmpty(){return this.units.length===0}}W.StructureBuilder=f;function y(N={}){return new f(N)}W.Builder=y;function g(N){return N.hashCode}W.hashCode=g;function x(N){return KC(N.units.map(j=>me.conformationId(j)).join("|"))}W.conformationHash=x;function S(N,j){if(N===j)return!0;if(N.elementCount!==j.elementCount)return!1;let ue=N.units.length;if(ue!==j.units.length)return!1;for(let be=0;be<ue;be++)if(N.units[be].id!==j.units[be].id)return!1;return!0}W.areUnitIdsEqual=S;function I(N,j){if(N===j)return!0;if(!S(N,j))return!1;for(let ue=0,be=N.units.length;ue<be;ue++)if(!Be.areEqual(N.units[ue].elements,j.units[ue].elements))return!1;return!0}W.areUnitIdsAndIndicesEqual=I;function v(N,j){if(N.hashCode!==j.hashCode)return!1;let ue=N.models.length;if(ue!==j.models.length)return!1;for(let be=0;be<ue;be++)if(!Ft.areHierarchiesEqual(N.models[be],j.models[be]))return!1;return!0}W.areHierarchiesEqual=v;function A(N,j){return N===j||N.hashCode===j.hashCode&&im.areTransformGroupsEquivalent(N.unitSymmetryGroups,j.unitSymmetryGroups)}W.areEquivalent=A;function _(N,j){return A(N.root,j.root)}W.areRootsEquivalent=_;function T(N,j){return N.root===j.root}W.areRootsEqual=T;class w{constructor(j){this.structure=j;this.unitIndex=0;this.maxIdx=0;this.idx=-1;this.current=K.Location.create(j),this.hasNext=j.elementCount>0,this.hasNext&&(this.elements=j.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=j.units[0])}move(){return this.advance(),this.current.element=this.elements[this.idx],this.current}advance(){if(this.idx<this.maxIdx){this.idx++,this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length);return}if(this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length){this.hasNext=!1;return}this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,this.maxIdx===0&&(this.hasNext=this.unitIndex+1<this.structure.units.length)}}W.ElementLocationIterator=w;let D=b();function M(N,j,ue){let{elements:be,conformation:ee}=N,le=D,Ae=Number.MAX_VALUE;for(let Ce=0,J=be.length;Ce<J;Ce++){let z=be[Ce],ae=b.distance(j,ee.position(z,le))-ue-ee.r(z);ae<Ae&&(Ae=ae)}return Ae}function E(N,j,ue){let{units:be}=N,ee=Number.MAX_VALUE;for(let le=0,Ae=be.length;le<Ae;le++){let Ce=be[le],J=M(Ce,j,ue);J<ee&&(ee=J)}return ee}W.minDistanceToPoint=E;let R=b();function k(N,j){if(N.elementCount===0||j.elementCount===0)return 0;let{units:ue}=N,be=Number.MAX_VALUE;for(let ee=0,le=ue.length;ee<le;ee++){let Ae=ue[ee],{elements:Ce,conformation:J}=Ae;for(let z=0,ae=Ce.length;z<ae;z++){let ge=Ce[z],ve=E(j,J.position(ge,R),J.r(ge));ve<be&&(be=ve)}}return be}W.distance=k;function B(N){return N.elementCount===1?"1 element":`${N.elementCount} elements`}W.elementDescription=B;function L(N,j,ue){return N.masterModel?j.model===ue.model||j.model===N.masterModel||ue.model===N.masterModel:j.model===ue.model}W.validUnitPair=L;function V(N,j,ue){let{maxRadius:be,validUnit:ee,validUnitPair:le}=ue;if(!N.units.some(J=>ee(J)))return;let Ae=N.lookup3d,Ce=b();for(let J of N.units){if(!ee(J))continue;let z=J.boundary.sphere;b.transformMat4(Ce,z.center,J.conformation.operator.matrix);let ae=Ae.findUnitIndices(Ce[0],Ce[1],Ce[2],z.radius+be);for(let ge=0;ge<ae.count;ge++){let ve=N.units[ae.indices[ge]];J.id>=ve.id||!ee(ve)||!le(J,ve)||(ve.elements.length>=J.elements.length?j(J,ve):j(ve,J))}}}W.eachUnitPair=V;function U(N,{chain:j,residue:ue,atom:be}){let ee=K.Location.create(N);for(let le of N.units){if(le.kind!==me.Kind.Atomic)continue;ee.unit=le;let{elements:Ae}=le,Ce=Xt.transientSegments(le.model.atomicHierarchy.chainAtomSegments,Ae),J=Xt.transientSegments(le.model.atomicHierarchy.residueAtomSegments,Ae);for(;Ce.hasNext;){let z=Ce.move();if(j&&(ee.element=Ae[z.start],j(ee)),!(!ue&&!be))for(J.setSegment(z);J.hasNext;){let ae=J.move();if(ue&&(ee.element=Ae[ae.start],ue(ee)),!!be)for(let ge=ae.start,ve=ae.end;ge<ve;ge++)ee.element=Ae[ge],be(ee)}}}}W.eachAtomicHierarchyElement=U,W.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15};function O(N){return N.unitSymmetryGroups.filter(j=>j.units[0].polymerElements.length>0)}function q(N,j){let ue=O(N);return ue.length===1&&ue[0].units.length>2&&ue[0].units[0].polymerElements.length<j.fiberResidueCount}function X(N,j){let ue=O(N);return ue.length>=1&&ue[0].units.length>j.highSymmetryUnitCount}let F;(le=>(le[le.Small=0]="Small",le[le.Medium=1]="Medium",le[le.Large=2]="Large",le[le.Huge=3]="Huge",le[le.Gigantic=4]="Gigantic"))(F=W.Size||={});function Y(N,j={},ue=1){let be={...W.DefaultSizeThresholds,...j};return N.polymerResidueCount>=be.largeResidueCount*ue?X(N,be)?3:4:q(N,be)||N.polymerResidueCount<be.smallResidueCount*ue?0:N.polymerResidueCount<be.mediumResidueCount*ue?1:2}W.getSize=Y,W.Index=Pl.createSimple("index","root"),W.MaxIndex=Pl.createSimple("max_index","root");let ie="__PrincipalAxes__";function oe(N){if(N.currentPropertyData[ie])return N.currentPropertyData[ie];let j=K.Loci.getPrincipalAxes(W.toStructureElementLoci(N));return N.currentPropertyData[ie]=j,j}W.getPrincipalAxes=oe})(De||={});var bH=class{constructor(){this.map=new Map}removeSymbol(t){this.map.delete(t.symbol.id)}addSymbol(t){this.map.has(t.symbol.id)&&console.warn(`Symbol '${t.symbol.id}' already added. Call removeSymbol/removeCustomProps re-adding the symbol.`),this.map.set(t.symbol.id,t)}addCustomProp(t){if(t.symbols)for(let r of Object.keys(t.symbols))this.addSymbol(t.symbols[r])}removeCustomProp(t){if(t.symbols)for(let r of Object.keys(t.symbols))this.removeSymbol(t.symbols[r])}getRuntime(t){return this.map.get(t)}},Qv=new bH,xH=class{constructor(t){this.table=t;this.constQueryContext=new ai(De.Empty)}},yHe;(r=>{function e(n){return{kind:"const",value:n}}r.Const=e;function t(n){return{kind:"dynamic",runtime:n}}r.Dynamic=t})(yHe||={});var Xv;(r=>{function e(n){return{isConst:!0,fn:function(i){return n}}}r.Const=e;function t(n){return{isConst:!1,fn:n}}r.Dynamic=t})(Xv||={});var Y2;(t=>{function e(r,n,o,i){if(typeof r.length=="number")for(let a=0,s=r.length;a<s;a++)o(r[a](n),a,i);else{let a=0;for(let s of Object.keys(r))o(r[s](n),a++,i)}return i}t.forEachEval=e})(Y2||={});var X0;(r=>{function e(n,o){return new zM(n,o,!0)}r.Const=e;function t(n,o){return new zM(n,o,!1)}r.Dynamic=t})(X0||={});var zM=class{constructor(t,r,n){this.symbol=t;this.fn=r;this.isConst=n}compile(t,r){let n,o=!1;if(!r)n=void 0,o=!0;else if(La.isArgumentsArray(r)){n=[],o=!0;for(let i of r){let a=CH(t,i);o=o&&a.isConst,n.push(a.fn)}}else{n=Object.create(null),o=!0;for(let i of Object.keys(r)){let a=CH(t,r[i]);o=o&&a.isConst,n[i]=a.fn}}return this.isConst?this.isConst&&o?Xv.Const(this.fn(t.constQueryContext,n)):Xv.Dynamic(Nue(this.fn,n)):Xv.Dynamic(Nue(this.fn,n))}};function Nue(e,t){return function(n){return e(n,t)}}function CH(e,t){if(La.isLiteral(t))return Xv.Const(t);if(La.isSymbol(t)){let n=e.table.getRuntime(t.name);return n?n.compile(e):Xv.Const(t.name)}if(!La.isSymbol(t.head))throw new Error("Can only apply symbols.");let r=e.table.getRuntime(t.head.name);if(!r)throw new Error(`Symbol '${t.head.name}' is not implemented.`);return r.compile(e,t.args)}function Ic(e){let t=new xH(Qv);return CH(t,e).fn}var bHe=ia.diff;function Wd(e,t){return{kind:"element-loci",structure:e,elements:t}}(N=>{function e(j){return!!j&&j.kind==="element-loci"}N.is=e;function t(j,ue){if(j.structure!==ue.structure||j.elements.length!==ue.elements.length)return!1;for(let be=0,ee=j.elements.length;be<ee;++be){let le=j.elements[be],Ae=ue.elements[be];if(le.unit.id!==Ae.unit.id||!Se.areEqual(le.indices,Ae.indices))return!1}return!0}N.areEqual=t;function r(j){for(let ue of j.elements)if(Se.size(ue.indices)>0)return!1;return!0}N.isEmpty=r;function n(j){return o(j)===j.structure.elementCount}N.isWholeStructure=n;function o(j){let ue=0;for(let{indices:be}of j.elements)typeof be=="number"?ue+=bHe(be):ue+=be.length;return ue}N.size=o;function i(j){return N(j,j.units.map(ue=>({unit:ue,indices:Se.ofBounds(0,ue.elements.length)})))}N.all=i;function a(j){return N(j,[])}N.none=a;function s(j,ue,be){let ee;typeof ue=="function"?ee=ue(ne):ee=ue;let le=Ic(ee)(be??new ai(j));return at.toLociWithSourceUnits(le)}N.fromExpression=s;function l(j,ue,be){let ee=ue(be??new ai(j));return at.toLociWithSourceUnits(ee)}N.fromQuery=l;function u(j,ue,be){return X2.toLoci(j,ue,be)}N.fromSchema=u;function c(j,ue){if(r(j))return;let be=j.elements[0].unit,ee=be.elements[Se.getAt(j.elements[0].indices,0)];return ue?(ue.structure=j.structure,ue.unit=j.elements[0].unit,ue.element=ee,ue):xo.create(j.structure,be,ee)}N.getFirstLocation=c;function m(j){return r(j)?j:N(j.structure,[{unit:j.elements[0].unit,indices:Se.ofSingleton(Se.start(j.elements[0].indices))}])}N.firstElement=m;function d(j){return r(j)?j:_(m(j))}N.firstResidue=d;function p(j){return r(j)?j:E(m(j))}N.firstChain=p;function h(j){let ue=[];for(let be of j.elements){let{unit:ee,indices:le}=be,Ae=new Int32Array(Se.size(le));Se.forEach(le,(Ce,J)=>Ae[J]=ee.elements[Ce]),ue.push(ee.getChild(Be.ofSortedArray(Ae)))}return De.create(ue,{parent:j.structure.parent})}N.toStructure=h;function f(j,ue,be){if(N.isEmpty(j))return;let ee=be||xo.create(j.structure);ee.structure=j.structure;for(let le of j.elements){let{unit:Ae,indices:Ce}=le;ee.unit=Ae;let{elements:J}=le.unit;for(let z=0,ae=Se.size(Ce);z<ae;z++)ee.element=J[Se.getAt(Ce,z)],ue(ee)}}N.forEachLocation=f;function y(j,ue){if(ue===j.structure)return j;let be=[];return j.elements.forEach(ee=>{if(!ue.unitMap.has(ee.unit.id))return;let le=ue.unitMap.get(ee.unit.id),Ae=Se.indexedIntersect(ee.indices,ee.unit.elements,le.elements);Se.size(Ae)>0&&be.push({unit:le,indices:Ae})}),N(ue,be)}N.remap=y;function g(j,ue){if(j.elements.length>ue.elements.length)return g(ue,j);if(N.isEmpty(j))return ue;let be=new Map;for(let le of j.elements)be.set(le.unit.id,le.indices);let ee=[];for(let le of ue.elements)be.has(le.unit.id)?(ee[ee.length]={unit:le.unit,indices:Se.union(be.get(le.unit.id),le.indices)},be.delete(le.unit.id)):ee[ee.length]=le;return be.forEach((le,Ae)=>{ee[ee.length]={unit:j.structure.unitMap.get(Ae),indices:le}}),N(j.structure,ee)}N.union=g;function x(j,ue){let be=new Map;for(let le of ue.elements)be.set(le.unit.id,le.indices);let ee=[];for(let le of j.elements)if(be.has(le.unit.id)){let Ae=Se.subtract(le.indices,be.get(le.unit.id));if(Se.size(Ae)===0)continue;ee[ee.length]={unit:le.unit,indices:Ae}}else ee[ee.length]=le;return N(j.structure,ee)}N.subtract=x;function S(j,ue){let be=new Map;for(let le of j.elements)be.set(le.unit.id,le.indices);let ee=[];for(let le of ue.elements){if(!be.has(le.unit.id))continue;let Ae=Se.intersect(be.get(le.unit.id),le.indices);Se.size(Ae)!==0&&(ee[ee.length]={unit:le.unit,indices:Ae})}return N(j.structure,ee)}N.intersect=S;function I(j,ue){if(j.elements.length>ue.elements.length)return I(ue,j);if(N.isEmpty(j))return N.isEmpty(ue);let be=new Map;for(let ee of j.elements)be.set(ee.unit.id,ee.indices);for(let ee of ue.elements)if(be.has(ee.unit.id)&&Se.areIntersecting(be.get(ee.unit.id),ee.indices))return!0;return!1}N.areIntersecting=I;function v(j,ue){if(N.isEmpty(j))return N.isEmpty(ue);let be=new Map;for(let le of j.elements)be.set(le.unit.id,le.indices);let ee=!1;for(let le of ue.elements){if(!be.has(le.unit.id))return!1;if(Se.isSubset(be.get(le.unit.id),le.indices))ee=!0;else return!1}return ee}N.isSubset=v;function A(j){return j.length>3&&Be.isRange(j)?xe.ofRange(j[0],j[j.length-1]):Be.ofSortedArray(j)}function _(j,ue){let be=[],ee=new Set;for(let le of j.elements){if(w(le)){be[be.length]=le;continue}if(le.unit.kind===me.Kind.Atomic){let Ae=le.unit.elements,Ce=le.unit.model.atomicHierarchy,{label_alt_id:J}=le.unit.model.atomicHierarchy.atoms,{index:z,offsets:ae}=Ce.residueAtomSegments,ge=[],ve=le.indices,Oe=Se.size(ve),ze=0;for(;ze<Oe;){ee.clear();let Re=Ae[Se.getAt(ve,ze)],Ke=z[Re];for(ee.add(J.value(Re)),ze++;ze<Oe;){let bt=Ae[Se.getAt(ve,ze)];if(z[bt]!==Ke)break;ee.add(J.value(bt)),ze++}let tt=ee.has("");for(let bt=ae[Ke],Pt=ae[Ke+1];bt<Pt;bt++){let fr=Se.indexOf(Ae,bt);if(fr>=0){let gt=J.value(bt);(!ue||tt||!gt||ee.has(gt))&&(ge[ge.length]=fr)}}}be[be.length]={unit:le.unit,indices:A(ge)}}else be[be.length]=le}return N(j.structure,be)}N.extendToWholeResidues=_;function T(j){switch(j.kind){case me.Kind.Atomic:return j.model.atomicHierarchy.chainAtomSegments;case me.Kind.Spheres:return j.model.coarseHierarchy.spheres.chainElementSegments;case me.Kind.Gaussians:return j.model.coarseHierarchy.gaussians.chainElementSegments}}function w(j){return j.unit.elements.length===Se.size(j.indices)}function D(j,ue,be){let{index:ee}=T(j),le=j.elements,Ae=0;for(let J=0,z=le.length;J<z;J++){let ae=le[J],ge=ee[ae];ue.has(ge)&&Ae++}if(Ae===j.elements.length){be[be.length]={unit:j,indices:xe.ofBounds(0,Ae)};return}let Ce=new Int32Array(Ae);Ae=0;for(let J=0,z=le.length;J<z;J++){let ae=le[J],ge=ee[ae];ue.has(ge)&&(Ce[Ae++]=J)}Ce.length>0&&(be[be.length]={unit:j,indices:A(Ce)})}function M(j,ue,be,ee,le){let{index:Ae}=T(j.elements[0].unit),Ce=new Set;for(let J=ue;J<be;J++){let z=j.elements[J],ae=z.indices,ge=z.unit.elements;for(let ve=0,Oe=Se.size(ae);ve<Oe;ve++)Ce.add(Ae[ge[Se.getAt(ae,ve)]])}if(ee){let J=j.elements[0].unit;for(let z of j.structure.units)me.areSameChainOperatorGroup(z,J)&&D(z,Ce,le)}else for(let J=ue;J<be;J++)D(j.elements[J].unit,Ce,le)}function E(j){let ue=[];for(let be=0,ee=j.elements.length;be<ee;be++){let le=j.elements[be];if(me.Traits.is(le.unit.traits,me.Trait.Partitioned)){let Ae=be;for(;be<ee&&me.areSameChainOperatorGroup(j.elements[be].unit,le.unit);)be++;let Ce=be;be--,M(j,Ae,Ce,!0,ue)}else w(le)?ue[ue.length]=le:M(j,be,be+1,!1,ue)}return N(j.structure,ue)}N.extendToWholeChains=E;function R(j){return`${j.unit.model.id}|${qe.entity.id(j)}`}function k(j){let ue=[],be=xo.create(j.structure),ee=new Set,{units:le}=j.structure;for(let Ae=0,Ce=j.elements.length;Ae<Ce;Ae++){let J=j.elements[Ae];be.unit=J.unit,be.element=J.unit.elements[0],ee.add(R(be))}for(let Ae=0,Ce=le.length;Ae<Ce;++Ae){let J=le[Ae];if(be.unit=J,be.element=J.elements[0],ee.has(R(be))){let z=Se.ofBounds(0,J.elements.length);ue[ue.length]={unit:J,indices:z}}}return N(j.structure,ue)}N.extendToWholeEntities=k;function B(j){let ue=[],be=new Set,{units:ee}=j.structure;for(let le=0,Ae=j.elements.length;le<Ae;le++){let Ce=j.elements[le];be.add(Ce.unit.model.id)}for(let le=0,Ae=ee.length;le<Ae;++le){let Ce=ee[le];if(be.has(Ce.model.id)){let J=Se.ofBounds(0,Ce.elements.length);ue[ue.length]={unit:Ce,indices:J}}}return N(j.structure,ue)}N.extendToWholeModels=B;function L(j,ue){let be=[];for(let ee=0,le=Se.size(ue);ee<le;++ee)be.push(j[Se.getAt(ue,ee)]);return Be.ofSortedArray(be)}function V(j,ue){return Be.isRange(j)&&Be.areEqual(j,ue)?xe.ofLength(j.length):A(Be.indicesOf(j,ue))}function U(j){let ue=[],be=new Map;for(let ee=0,le=j.elements.length;ee<le;ee++){let Ae=j.elements[ee],{model:Ce}=Ae.unit,J=L(Ae.unit.elements,Ae.indices);be.has(Ce)?be.set(Ce,Be.union(J,be.get(Ce))):be.set(Ce,J)}for(let ee=0,le=j.structure.units.length;ee<le;++ee){let Ae=j.structure.units[ee],Ce=be.get(Ae.model);if(!Ce)continue;let J=V(Ae.elements,Ce);Se.size(J)&&(ue[ue.length]={unit:Ae,indices:J})}return N(j.structure,ue)}N.extendToAllInstances=U;function Q(j){let ue=[],be=new Set,{units:ee}=j.structure;for(let le=0,Ae=j.elements.length;le<Ae;le++){let Ce=j.elements[le];be.add(Ce.unit.conformation.operator.name)}for(let le=0,Ae=ee.length;le<Ae;++le){let Ce=ee[le];if(be.has(Ce.conformation.operator.name)){let J=Se.ofBounds(0,Ce.elements.length);ue[ue.length]={unit:Ce,indices:J}}}return N(j.structure,ue)}N.extendToWholeOperators=Q;let O=new Ci("98"),q=b();function X(j,ue,be){O.reset();for(let ee of j.elements){let{indices:le}=ee,{elements:Ae,conformation:Ce}=ee.unit;for(let J=0,z=Se.size(le);J<z;J++){let ae=Ae[Se.getAt(le,J)];Ce.position(ae,q),ue&&b.transformMat4(q,q,ue),O.includePositionRadius(q,Ce.r(ae))}}O.finishedIncludeStep();for(let ee of j.elements){let{indices:le}=ee,{elements:Ae,conformation:Ce}=ee.unit;for(let J=0,z=Se.size(le);J<z;J++){let ae=Ae[Se.getAt(le,J)];Ce.position(ae,q),ue&&b.transformMat4(q,q,ue),O.radiusPositionRadius(q,Ce.r(ae))}}return be?(be.box&&O.getBox(be.box),be.sphere&&O.getSphere(be.sphere),be):{box:O.getBox(),sphere:O.getSphere()}}N.getBoundary=X;let F=b();function Y(j,ue,be=0){let ee=be;for(let le of j.elements){let{indices:Ae}=le,{elements:Ce,conformation:J}=le.unit,z=Se.size(Ae);for(let ae=0;ae<z;ae++){let ge=Ce[Se.getAt(Ae,ae)];J.position(ge,F),b.toArray(F,ue,ee+ae*3)}ee+=z*3}return ue}N.toPositionsArray=Y;function $(j){let ue=o(j),be=Y(j,new Float32Array(3*ue));return lu.ofPositions(be)}N.getPrincipalAxes=$;function ce(j){let ue=0;j.forEach(le=>{ue+=o(le)});let be=new Float32Array(3*ue),ee=0;return j.forEach(le=>{Y(le,be,ee),ee+=o(le)*3}),lu.ofPositions(be)}N.getPrincipalAxesMany=ce;function ie(j,ue){return me.isAtomic(j)?j.model.atomicHierarchy.atomSourceIndex.value(ue):ue}function oe(j){if(N.isEmpty(j))return ne.struct.generator.empty();let ue=j.structure.models,be=new Map;for(let J of j.elements){let{indices:z}=J,{elements:ae}=J.unit,ge=J.unit.conformation.operator.name,ve;be.has(ge)?ve=be.get(ge).xs:(ve=Tn.create(),be.set(ge,{modelLabel:J.unit.model.label,modelIndex:J.unit.model.modelNum,xs:ve}));for(let Oe=0,ze=Se.size(z);Oe<ze;Oe++){let Re=ie(J.unit,ae[Se.getAt(z,Oe)]);Tn.add(ve,Re,Re)}}let ee=[],le=be.keys();for(;;){let J=le.next();if(J.done)break;let z=be.get(J.value);ee.push(W(J.value,z.xs.array,ue.length>1,z.modelLabel,z.modelIndex))}let Ae=new Map;for(let J=0,z=ee.length;J<z;++J){let ae=ee[J],ve=`${Du(Ro(ae.atom.ranges),Ro(ae.atom.set))}|${ae.entity?ae.entity.modelLabel+ae.entity.modelIndex:""}`;Ae.has(ve)?Ae.get(ve).chain.opName.push(...ae.chain.opName):Ae.set(ve,ae)}let Ce=[];return Ae.forEach(J=>{let{ranges:z,set:ae}=J.atom,{opName:ge}=J.chain,ve=ne.struct.atomProperty.core.operatorName(),Oe=ne.struct.atomProperty.core.sourceIndex(),ze=[];ae.length>0&&(ze[ze.length]=ne.core.set.has([ne.core.type.set(ae),Oe]));for(let Re=0,Ke=z.length/2;Re<Ke;Re++)ze[ze.length]=ne.core.rel.inRange([Oe,z[2*Re],z[2*Re+1]]);if(J.entity){let{modelLabel:Re,modelIndex:Ke}=J.entity;Ce.push(ne.struct.generator.atomGroups({"atom-test":ze.length>1?ne.core.logic.or(ze):ze[0],"chain-test":ge.length>1?ne.core.set.has([ne.core.type.set(ge),ve]):ne.core.rel.eq([ve,ge[0]]),"entity-test":ne.core.logic.and([ne.core.rel.eq([ne.struct.atomProperty.core.modelLabel(),Re]),ne.core.rel.eq([ne.struct.atomProperty.core.modelIndex(),Ke])])}))}else Ce.push(ne.struct.generator.atomGroups({"atom-test":ze.length>1?ne.core.logic.or(ze):ze[0],"chain-test":ge.length>1?ne.core.set.has([ne.core.type.set(ge),ve]):ne.core.rel.eq([ve,ge[0]])}))}),ne.struct.modifier.union([Ce.length===1?Ce[0]:ne.struct.combinator.merge(Ce.map(J=>ne.struct.modifier.union([J])))])}N.toExpression=oe;function W(j,ue,be,ee,le){Fs(ue);let Ae=[],Ce=[],J=0,z=ue.length;for(;J<z;){let ae=J;for(J++;J<z&&ue[J-1]+1===ue[J];)J++;let ge=J;if(ge-ae>12)Ae[Ae.length]=ue[ae],Ae[Ae.length]=ue[ge-1];else for(let ve=ae;ve<ge;ve++)Ce[Ce.length]=ue[ve]}return be?{atom:{set:Ce,ranges:Ae},chain:{opName:[j]},entity:{modelLabel:ee,modelIndex:le}}:{atom:{set:Ce,ranges:Ae},chain:{opName:[j]}}}})(Wd||={});var zue;(s=>{function e(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:xo.create(void 0),firstConformationLoc:xo.create(void 0),firstResidueLoc:xo.create(void 0),firstChainLoc:xo.create(void 0),firstUnitLoc:xo.create(void 0),firstStructureLoc:xo.create(void 0)}}s.create=e;function t(l,u,c){let m=l.get(u)||0;l.set(u,m+c)}function r(l,u,c){let{indices:m,unit:d}=c,{elements:p}=d,h=Se.size(m),f=new Map,y=new Map;if(h>0&&xo.set(l.firstElementLoc,u,d,p[Se.start(m)]),h===p.length)l.unitCount+=1,l.unitCount===1&&xo.set(l.firstUnitLoc,u,d,p[Se.start(m)]);else if(h===1){if(me.Traits.is(d.traits,me.Trait.MultiChain))return;l.elementCount+=1,l.elementCount===1&&xo.set(l.firstElementLoc,u,d,p[Se.start(m)])}else if(me.isAtomic(d)){let{index:g,offsets:x}=d.model.atomicHierarchy.residueAtomSegments,{label_alt_id:S}=d.model.atomicHierarchy.atoms,I=0;for(;I<h;){f.clear();let v=0,A=p[Se.getAt(m,I)],_=g[A];for(t(f,S.value(A),1),++I,++v;I<h;){let T=p[Se.getAt(m,I)];if(g[T]!==_)break;t(f,S.value(T),1),++I,++v}if(x[_+1]-x[_]===v)l.residueCount+=1,l.residueCount===1&&xo.set(l.firstResidueLoc,u,d,x[_]);else{y.clear();for(let T=x[_],w=x[_+1];T<w;++T)t(y,S.value(T),1);y.get("")===f.get("")&&f.forEach((T,w)=>{if(y.get(w)===T){if(w!==""&&(l.conformationCount+=1,l.conformationCount===1)){for(let D=x[_],M=x[_+1];D<M;++D)if(w===S.value(D)){xo.set(l.firstConformationLoc,u,d,D);break}}v-=T}}),l.elementCount+=v}}}else l.elementCount+=h,l.elementCount===1&&xo.set(l.firstElementLoc,u,d,p[Se.start(m)])}function n(l,u,c){let{indices:m,unit:d}=c,p=Se.size(m);if(p===0)return;let{elements:h}=d;if(!me.Traits.is(d.traits,me.Trait.MultiChain)){p===h.length&&(l.chainCount+=1,l.chainCount===1&&xo.set(l.firstChainLoc,u,d,h[Se.start(m)]));return}let f=me.isAtomic(d)?d.model.atomicHierarchy.chainAtomSegments:me.isSpheres(d)?d.model.coarseHierarchy.spheres.chainElementSegments:me.isGaussians(d)?d.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!f){console.warn("StructureElement loci stats: unknown unit type");return}let{index:y,offsets:g}=f,x=0;for(;x<p;){let S=0,I=h[Se.getAt(m,x)],v=y[I];for(++x,++S;x<p;){let A=h[Se.getAt(m,x)];if(y[A]!==v)break;++x,++S}g[v+1]-g[v]===S?(l.chainCount+=1,l.chainCount===1&&xo.set(l.firstChainLoc,u,d,g[v])):p===1&&(l.elementCount+=1,l.elementCount===1&&xo.set(l.firstElementLoc,u,d,I))}}function o(l,u,c,m,d){let p=c[m],h=me.isAtomic(p.unit)?p.unit.model.atomicHierarchy.chainAtomSegments:me.isSpheres(p.unit)?p.unit.model.coarseHierarchy.spheres.chainElementSegments:me.isGaussians(p.unit)?p.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!h){console.warn("StructureElement loci stats: unknown unit type");return}let{index:f,offsets:y}=h,g=new Map;for(let S=m;S<d;S++){p=c[S];let{indices:I,unit:v}=p,A=Se.size(I);if(A===0)continue;let{elements:_}=v;if(!me.Traits.is(v.traits,me.Trait.MultiChain)){let w=_[Se.start(I)];t(g,f[w],_.length);continue}let T=0;for(;T<A;){let w=0,D=_[Se.getAt(I,T)],M=f[D];for(++T,++w;T<A;){let E=_[Se.getAt(I,T)];if(f[E]!==M)break;++T,++w}t(g,M,w)}}let x=-1;if(g.forEach((S,I)=>{y[I+1]-y[I]===S&&(l.chainCount+=1,l.chainCount===1&&(x=I))}),!(x<0))for(let S=m;S<d;S++){p=c[S];let{indices:I,unit:v}=p,A=Se.size(I);if(A===0)continue;let{elements:_}=v,T=0;for(;T<A;){let w=_[Se.getAt(I,T)];if(f[w]===x){xo.set(l.firstChainLoc,u,v,w);return}}}}function i(l){let u=e();if(Wd.isEmpty(l))return u;let c=!1;if(Wd.isWholeStructure(l)){if(u.structureCount+=1,u.structureCount===1){let{unit:m,indices:d}=l.elements[0];xo.set(u.firstStructureLoc,l.structure,m,m.elements[Se.min(d)])}}else for(let m of l.elements)r(u,l.structure,m),me.Traits.is(m.unit.traits,me.Trait.Partitioned)?c=!0:n(u,l.structure,m);if(c)for(let m=0,d=l.elements.length;m<d;m++){let p=l.elements[m];if(!me.Traits.is(p.unit.traits,me.Trait.Partitioned))continue;let h=m;for(;m<d&&me.areSameChainOperatorGroup(l.elements[m].unit,p.unit);)m++;let f=m;m--,f-h===1?n(u,l.structure,p):o(u,l.structure,l.elements,h,f)}return u}s.ofLoci=i;function a(l,u,c){return u.elementCount===1&&c.elementCount===0?xo.copy(l.firstElementLoc,u.firstElementLoc):u.elementCount===0&&c.elementCount===1&&xo.copy(l.firstElementLoc,c.firstElementLoc),u.conformationCount===1&&c.conformationCount===0?xo.copy(l.firstConformationLoc,u.firstConformationLoc):u.conformationCount===0&&c.conformationCount===1&&xo.copy(l.firstConformationLoc,c.firstConformationLoc),u.residueCount===1&&c.residueCount===0?xo.copy(l.firstResidueLoc,u.firstResidueLoc):u.residueCount===0&&c.residueCount===1&&xo.copy(l.firstResidueLoc,c.firstResidueLoc),u.chainCount===1&&c.chainCount===0?xo.copy(l.firstChainLoc,u.firstChainLoc):u.chainCount===0&&c.chainCount===1&&xo.copy(l.firstChainLoc,c.firstChainLoc),u.unitCount===1&&c.unitCount===0?xo.copy(l.firstUnitLoc,u.firstUnitLoc):u.unitCount===0&&c.unitCount===1&&xo.copy(l.firstUnitLoc,c.firstUnitLoc),u.structureCount===1&&c.structureCount===0?xo.copy(l.firstStructureLoc,u.firstStructureLoc):u.structureCount===0&&c.structureCount===1&&xo.copy(l.firstStructureLoc,c.firstStructureLoc),l.elementCount=u.elementCount+c.elementCount,l.conformationCount=u.conformationCount+c.conformationCount,l.residueCount=u.residueCount+c.residueCount,l.chainCount=u.chainCount+c.chainCount,l.unitCount=u.unitCount+c.unitCount,l.structureCount=u.structureCount+c.structureCount,l}s.add=a})(zue||={});function xHe(e){return e}function Hue(e){throw new Error(`Property only available for ${e} models.`)}function CHe(e){return t=>me.isAtomic(t.unit)?e(t):Hue("atomic")}function SHe(e){return t=>me.isCoarse(t.unit)?e(t):Hue("coarse")}function vHe(e){return me.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}function IHe(e){return me.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}function AHe(e){return qe.entity.key(e)}function yt(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}(x=>{function e(S){return S.data.substring(S.tokenStart,S.tokenEnd)}x.getTokenString=e;function t(S){S.position=0,S.lineNumber=1,S.tokenStart=0,S.tokenEnd=0}x.reset=t;function r(S){let{data:I}=S;for(;S.position<S.length;)switch(I.charCodeAt(S.position)){case 10:return S.tokenEnd=S.position,++S.position,++S.lineNumber,!0;case 13:return S.tokenEnd=S.position,++S.position,++S.lineNumber,I.charCodeAt(S.position)===10&&++S.position,!0;default:++S.position;break}return S.tokenEnd=S.position,S.tokenStart!==S.tokenEnd}x.eatLine=r;function n(S){S.tokenStart=S.position}x.markStart=n;function o(S){return S.tokenStart=S.position,r(S)}x.markLine=o;function i(S){return o(S),e(S)}x.readLine=i;function a(S){o(S);let I=S.position;return g(S,S.tokenStart,S.tokenEnd),S.position=I,e(S)}x.readLineTrim=a;function s(S,I,v){let A=0;for(let _=0;_<I;_++){if(!o(S))return A;je.addUnchecked(v,S.tokenStart,S.tokenEnd),A++}return A}function l(S,I){let v=je.create(S.data,I*2);return s(S,I,v),v}x.markLines=l;function u(S,I){let v=[];for(let A=0;A<I;A++)v.push(x.readLine(S));return v}x.readLines=u;async function c(S,I,v,A=1e5){let _=je.create(S.data,I*2),T=0;return await ts(v,A,S,(w,D)=>{let M=Math.min(I-T,w);return s(D,M,_),T+=M,M},(w,D)=>w.update({message:"Parsing...",current:D.position,max:D.length})),_}x.readLinesAsync=c;function m(S){let I=x(S),v=je.create(I.data,Math.max(S.length/80,2));for(;o(I);)je.add(v,I.tokenStart,I.tokenEnd);return v}x.readAllLines=m;function d(S,I,v){let A=0;for(let _=0;_<I;_++){if(!o(S))return A;je.add(v,S.tokenStart,S.tokenEnd),A++}return A}async function p(S,I,v=1e5){let A=x(S),_=je.create(A.data,Math.max(S.length/80,2));return await ts(I,v,A,(T,w)=>(d(w,T,_),w.position<w.length?T:0),(T,w)=>T.update({message:"Parsing...",current:w.position,max:w.length})),_}x.readAllLinesAsync=p;function h(S){for(;S.position<S.length;)switch(S.data.charCodeAt(S.position)){case 9:case 10:case 13:case 32:S.tokenEnd=S.position;return;default:++S.position;break}S.tokenEnd=S.position}x.eatValue=h;function f(S){let I=-1;for(;S.position<S.length;){let v=S.data.charCodeAt(S.position);switch(v){case 9:case 32:I=v,++S.position;break;case 10:I!==13&&++S.lineNumber,I=v,++S.position;break;case 13:I=v,++S.position,++S.lineNumber;break;default:return I}}return I}x.skipWhitespace=f;function y(S){let I=-1;for(;S.position<S.length;){let v=S.data.charCodeAt(S.position);switch(v){case 9:case 32:I=v,++S.position;break;default:return I}}return I}x.skipStrictWhitespace=y;function g(S,I,v){let{data:A}=S,_=I,T=v-1,w=A.charCodeAt(_);for(;(w===9||w===32)&&_<=T;)w=A.charCodeAt(++_);for(w=A.charCodeAt(T);(w===9||w===32)&&T>=_;)w=A.charCodeAt(--T);return S.tokenStart=_,S.tokenEnd=T+1,S.position=v,S}x.trim=g})(yt||={});function jue(e,t,r){let n=t,o=r-1,i=e.charCodeAt(n);for(;(i===9||i===32)&&n<=o;)i=e.charCodeAt(++n);for(i=e.charCodeAt(o);(i===9||i===32)&&o>=n;)i=e.charCodeAt(--o);return e.substring(n,o+1)}var je;(i=>{function e(a){let s=new Uint32Array(1.61*a.indices.length|0);s.set(a.indices),a.indices=s,a.indicesLenMinus2=s.length-2|0}function t(a,s,l){let u=a;u.offset>u.indicesLenMinus2&&e(u),u.indices[u.offset++]=s,u.indices[u.offset++]=l,a.count++}i.add=t;function r(a,s){t(a,s.tokenStart,s.tokenEnd)}i.addToken=r;function n(a,s,l){a.indices[a.offset++]=s,a.indices[a.offset++]=l,a.count++}i.addUnchecked=n;function o(a,s){return s=Math.max(10,s),{data:a,indicesLenMinus2:s-2|0,count:0,offset:0,indices:new Uint32Array(s)}}i.create=o})(je||={});var jr;(o=>{function e(i,a=-1){return new r(i,a)}o.error=e;function t(i,a=[]){return new n(i,a)}o.success=t;class r{constructor(a,s){this.message=a;this.line=s;this.isError=!0}toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}}o.Error=r;class n{constructor(a,s){this.result=a;this.warnings=s;this.isError=!1}}o.Success=n})(jr||={});function Wue(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:e.tokenEnd=e.position;return;default:++e.position;break}e.tokenEnd=e.position}function THe(e,t){let r,n;for(++e.position;e.position<e.length;)if(n=e.data.charCodeAt(e.position),n===t)switch(r=e.data.charCodeAt(e.position+1),r){case 9:case 10:case 13:case 32:e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return;default:if(r===void 0){e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return}++e.position;break}else{if(n===10||n===13){e.tokenEnd=e.position;return}++e.position}e.tokenEnd=e.position}function PHe(e){for(e.position+=3;e.position<e.length;){if(e.data.charCodeAt(e.position)===39&&Zue(e)){e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,e.position+=3;return}++e.position}e.tokenEnd=e.position}function _He(e){let t=59,r=e.position+1,n;for(;r<e.length;)if(n=e.data.charCodeAt(r),n===59&&(t===10||t===13)){for(e.position=r+1,e.tokenStart++,r--,n=e.data.charCodeAt(r);n===10||n===13;)r--,n=e.data.charCodeAt(r);e.tokenEnd=r+1,e.isEscaped=!0;return}else(n===13||n===10&&t!==13)&&e.lineNumber++,t=n,++r;return e.position=r,t}function RHe(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 93:++e.position,e.tokenEnd=e.position,e.isImportGet=!1;return;default:++e.position;break}}function DHe(e){for(;e.position<e.length;){let t=e.data.charCodeAt(e.position);if(t===10||t===13)return;++e.position}}function wHe(e){let t=10;for(;e.position<e.length;){let r=e.data.charCodeAt(e.position);switch(r){case 9:case 32:t=r,++e.position;break;case 10:t!==13&&++e.lineNumber,t=r,++e.position;break;case 13:t=r,++e.position,++e.lineNumber;break;default:return t}}return t}function Zue(e){return!(e.length-e.position<2||e.data.charCodeAt(e.position+1)!==39||e.data.charCodeAt(e.position+2)!==39)}function EHe(e){let t=e.data.charCodeAt(e.tokenStart);return!(t!==68&&t!==100||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==84&&t!==116)||(t=e.data.charCodeAt(e.tokenStart+3),t!==65&&t!==97))}function MHe(e){let t=e.data.charCodeAt(e.tokenStart);return!(t!==83&&t!==115||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==86&&t!==118)||(t=e.data.charCodeAt(e.tokenStart+3),t!==69&&t!==101))}function BHe(e){if(e.tokenEnd-e.tokenStart!==5)return!1;let t=e.data.charCodeAt(e.tokenStart);return!(t!==76&&t!==108||(t=e.data.charCodeAt(e.tokenStart+1),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+2),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+3),t!==80&&t!==112))}function kHe(e){return!(e.tokenEnd-e.tokenStart!==11||e.data.charCodeAt(e.tokenStart+1)!==105||e.data.charCodeAt(e.tokenStart+2)!==109||e.data.charCodeAt(e.tokenStart+3)!==112||e.data.charCodeAt(e.tokenStart+4)!==111||e.data.charCodeAt(e.tokenStart+5)!==114||e.data.charCodeAt(e.tokenStart+6)!==116||e.data.charCodeAt(e.tokenStart+7)!==46||e.data.charCodeAt(e.tokenStart+8)!==103||e.data.charCodeAt(e.tokenStart+9)!==101||e.data.charCodeAt(e.tokenStart+10)!==116)}function LHe(e,t,r){let n,o=r-t,i=e.tokenStart-t,a=e.tokenEnd-e.tokenStart;if(a<o)return!1;for(n=t;n<r;++n)if(e.data.charCodeAt(n)!==e.data.charCodeAt(n+i))return!1;return o===a||e.data.charCodeAt(n+i)===46}function que(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return t;return t}function Yue(e,t){return e.data.substring(e.tokenStart,t)}function FHe(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return!1;return!0}function SH(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function Xue(e){let t=wHe(e);if(e.position>=e.length){e.tokenType=6;return}e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;let r=e.data.charCodeAt(e.position);switch(r){case 35:DHe(e),e.tokenType=5;break;case 39:if(Zue(e)){PHe(e),e.tokenType=3;break}case 34:THe(e,r),e.tokenType=3;break;case 59:t===10||t===13?_He(e):Wue(e),e.tokenType=3;break;default:e.isImportGet?RHe(e):Wue(e),e.isEscaped?e.tokenType=3:e.data.charCodeAt(e.tokenStart)===95?(e.inSaveFrame&&kHe(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenEnd-e.tokenStart>=5&&e.data.charCodeAt(e.tokenStart+4)===95?EHe(e)?e.tokenType=0:MHe(e)?e.tokenType=1:BHe(e)?e.tokenType=2:e.tokenType=3:e.tokenType=3;break}}function dx(e){for(Xue(e);e.tokenType===5;)Xue(e)}function VHe(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}function HM(){return{categoryNames:[],categoryData:Object.create(null)}}function IH(e,t){let r=Object.create(null);for(let n of e){let o=t[n];r[n]=qi(o.name,o.rowCount,o.fieldNames,o.fields)}return r}function Que(e,t,r){return V0(e.categoryNames,IH(e.categoryNames,e.categoryData),t,r)}function OHe(e,t){return V0(e.categoryNames,IH(e.categoryNames,e.categoryData),t)}function vH(e,t,r,n,o){if(t in e.categoryData){let i=e.categoryData[t];i.fieldNames.push(...n),Object.assign(i.fields,o)}else e.categoryData[t]={name:t,rowCount:r,fieldNames:n,fields:o},e.categoryNames.push(t)}function GHe(e,t){let r=e.tokenStart,n=que(e),o=Yue(e,n),i=Object.create(null),a=[],s=!0;for(;s;){if(e.tokenType!==4||!LHe(e,r,n)){s=!1;break}let l=SH(e).substring(o.length+1);if(dx(e),e.tokenType!==3)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};i[l]=It.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),a[a.length]=l,dx(e)}return vH(t,o.substr(1),1,a,i),{hasError:!1,errorLine:0,errorMessage:""}}function UHe(e,t){let{tokenizer:r,tokens:n,fieldCount:o}=t,i=t.tokenCount,a=0;for(;r.tokenType===3&&a<e;)je.add(n[i++%o],r.tokenStart,r.tokenEnd),dx(r),a++;return t.tokenCount=i,a}function NHe(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}async function zHe(e,t){let r=e.lineNumber;dx(e);let n=Yue(e,que(e)),o=FHe(e),i=[];for(;e.tokenType===4;)i[i.length]=o?SH(e):SH(e).substring(n.length+1),dx(e);let a=n==="_atom_site"?e.data.length/100|0:32,s=[],l=i.length;for(let m=0;m<l;m++)s[m]=je.create(e.data,a);let u={fieldCount:l,tokenCount:0,tokenizer:e,tokens:s};if(await ts(e.runtimeCtx,1e6,u,UHe,NHe),u.tokenCount%l!==0)return{hasError:!0,errorLine:e.lineNumber,errorMessage:`The number of values for loop starting at line ${r} is not a multiple of the number of columns.`};let c=u.tokenCount/l|0;if(o)for(let m=0;m<l;m++){let d={"":It.ofTokens(s[m])};vH(t,i[m].substr(1),c,[""],d)}else{let m=Object.create(null);for(let d=0;d<l;d++)m[i[d]]=It.ofTokens(s[d]);vH(t,n.substr(1),c,i,m)}return{hasError:!1,errorLine:0,errorMessage:""}}function Zv(e,t){return jr.error(t,e)}function HHe(e){return jr.success(e)}async function jHe(e,t){let r=[],n=VHe(e,t),o="",i=HM(),a=[],s=HM(),l=Lse(s.categoryNames,IH(s.categoryNames,s.categoryData),""),u="";for(t.update({message:"Parsing...",current:0,max:e.length}),dx(n);n.tokenType!==6;){let c=n.tokenType;if(c===0){if(n.inSaveFrame)return Zv(n.lineNumber,"Unexpected data block inside a save frame.");i.categoryNames.length>0&&r.push(Que(i,o,a)),o=e.substring(n.tokenStart+5,n.tokenEnd),i=HM(),a=[],dx(n)}else if(c===1){if(n.tokenEnd-n.tokenStart===5)s.categoryNames.length>0&&(a[a.length]=OHe(s,u)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return Zv(n.lineNumber,"Save frames cannot be nested.");n.inSaveFrame=!0,u=e.substring(n.tokenStart+5,n.tokenEnd),s=HM()}dx(n)}else if(c===2){let m=await zHe(n,n.inSaveFrame?s:i);if(m.hasError)return Zv(m.errorLine,m.errorMessage)}else if(c===4){let m=GHe(n,n.inSaveFrame?s:i);if(m.hasError)return Zv(m.errorLine,m.errorMessage)}else return console.log(n.tokenType,yt.getTokenString(n)),Zv(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")}return n.inSaveFrame?Zv(n.lineNumber,`Unfinished save frame (${l.header}).`):((i.categoryNames.length>0||a.length>0)&&r.push(Que(i,o,a)),HHe(F0(r)))}function AH(e){return Pe.create("Parse CIF",async t=>await jHe(e,t))}function Kue(e){let t=e.mask?kv(e.mask):void 0,r=kv(e.data),n=bi.isTypedArray(r),o=n?t?u=>t[u]===H.ValueKinds.Present?""+r[u]:"":u=>""+r[u]:t?u=>t[u]===H.ValueKinds.Present?r[u]:"":u=>r[u],i=n?u=>r[u]:u=>{let c=r[u];return kd(c,0,c.length)},a=n?u=>r[u]:u=>{let c=r[u];return mc(c,0,c.length)},s=t?u=>t[u]:u=>H.ValueKinds.Present,l=r.length;return{__array:r,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:l,str:o,int:i,float:a,valueKind:s,areValuesEqual:(u,c)=>r[u]===r[c],toStringArray:u=>bi.createAndFillArray(l,o,u),toIntArray:n?u=>bi.typedArrayWindow(r,u):u=>bi.createAndFillArray(l,i,u),toFloatArray:n?u=>bi.typedArrayWindow(r,u):u=>bi.createAndFillArray(l,a,u)}}function XM(e){return WM({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function TH(e,t){let r={};for(let n=0;n<t;n++){let o=WM(e);r[o]=WM(e)}return r}function PH(e,t){let r=new Uint8Array(t),n=e.offset;for(let o=0;o<t;o++)r[o]=e.buffer[o+n];return e.offset+=t,r}function jM(e,t){let r=sh(e.buffer,e.offset,t);return e.offset+=t,r}function _H(e,t){let r=new Array(t);for(let n=0;n<t;n++)r[n]=WM(e);return r}function WM(e){let t=e.buffer[e.offset],r,n;if((t&128)===0)return e.offset++,t;if((t&240)===128)return n=t&15,e.offset++,TH(e,n);if((t&240)===144)return n=t&15,e.offset++,_H(e,n);if((t&224)===160)return n=t&31,e.offset++,jM(e,n);if((t&224)===224)return r=e.dataView.getInt8(e.offset),e.offset++,r;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,PH(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,PH(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,PH(e,n);case 202:return r=e.dataView.getFloat32(e.offset+1),e.offset+=5,r;case 203:return r=e.dataView.getFloat64(e.offset+1),e.offset+=9,r;case 204:return r=e.buffer[e.offset+1],e.offset+=2,r;case 205:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,r;case 206:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,r;case 208:return r=e.dataView.getInt8(e.offset+1),e.offset+=2,r;case 209:return r=e.dataView.getInt16(e.offset+1),e.offset+=3,r;case 210:return r=e.dataView.getInt32(e.offset+1),e.offset+=5,r;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,jM(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,jM(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,jM(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,_H(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,_H(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,TH(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,TH(e,n)}throw new Error("Unknown type 0x"+t.toString(16))}function WHe(e,t){for(let r=0;r<2;r++)if(e[r]>t[r])return!1;return!0}function XHe(e){let t=Object.create(null),r=Object.create(null);for(let n of e.columns)t[n.name]=n;return{rowCount:e.rowCount,name:e.name.substring(1),fieldNames:e.columns.map(n=>n.name),getField(n){let o=t[n];if(o)return r[n]||(r[n]=Kue(o)),r[n]}}}function RH(e){return Pe.create("Parse BinaryCIF",async t=>{let r=[0,3];try{let n=XM(e);if(!WHe(r,n.version.match(/(\d)\.(\d)\.\d/).slice(1).map(i=>+i)))return jr.error(`Unsupported format version. Current ${n.version}, required ${r.join(".")}.`);let o=F0(n.dataBlocks.map(i=>{let a=Object.create(null);for(let s of i.categories)a[s.name.substring(1)]=XHe(s);return V0(i.categories.map(s=>s.name.substring(1)),a,i.header)}));return jr.success(o)}catch(n){return jr.error(""+n)}})}var Q0=H.Schema,Ko=Q0.str,QHe=Q0.float,Jue=Q0.List,bh=Q0.lstr,$m=Q0.Aliased,K2=Q0.int,qv=Q0.coord,$ue={chem_comp:{formula:Ko,formula_weight:QHe,id:Ko,mon_nstd_parent_comp_id:Jue(",",e=>e),name:Ko,one_letter_code:Ko,three_letter_code:Ko,type:$m(bh),pdbx_synonyms:Jue(";",e=>e),pdbx_type:Ko,pdbx_ambiguous_flag:Ko,pdbx_replaced_by:Ko,pdbx_replaces:Ko,pdbx_formal_charge:K2,pdbx_model_coordinates_details:Ko,pdbx_model_coordinates_db_code:Ko,pdbx_ideal_coordinates_details:Ko,pdbx_ideal_coordinates_missing_flag:$m(bh),pdbx_model_coordinates_missing_flag:$m(bh),pdbx_initial_date:Ko,pdbx_modified_date:Ko,pdbx_release_status:$m(Ko),pdbx_processing_site:$m(Ko)},chem_comp_atom:{alt_atom_id:Ko,atom_id:Ko,charge:K2,model_Cartn_x:qv,model_Cartn_y:qv,model_Cartn_z:qv,comp_id:Ko,type_symbol:Ko,pdbx_align:K2,pdbx_ordinal:K2,pdbx_model_Cartn_x_ideal:qv,pdbx_model_Cartn_y_ideal:qv,pdbx_model_Cartn_z_ideal:qv,pdbx_stereo_config:$m(bh),pdbx_aromatic_flag:$m(bh),pdbx_leaving_atom_flag:$m(bh)},chem_comp_bond:{atom_id_1:Ko,atom_id_2:Ko,comp_id:Ko,value_order:$m(bh),pdbx_ordinal:K2,pdbx_stereo_config:$m(bh),pdbx_aromatic_flag:$m(bh)},pdbx_chem_comp_descriptor:{comp_id:Ko,descriptor:Ko,type:$m(bh),program:Ko,program_version:Ko},pdbx_chem_comp_identifier:{comp_id:Ko,identifier:Ko,type:$m(Ko),program:Ko,program_version:Ko}};var J2=H.Schema,Yr=J2.str,ZHe=J2.float,ay=J2.lstr,Ac=J2.Aliased,Xd=J2.int,ece={pdbx_reference_molecule:{prd_id:Yr,formula_weight:ZHe,formula:Yr,type:Ac(ay),type_evidence_code:Yr,class:Ac(ay),class_evidence_code:Yr,name:Yr,represent_as:Ac(ay),chem_comp_id:Yr,compound_details:Yr,description:Yr,representative_PDB_id_code:Yr,release_status:Ac(ay),replaces:Yr,replaced_by:Yr},pdbx_reference_entity_list:{prd_id:Yr,ref_entity_id:Yr,type:Ac(ay),details:Yr,component_id:Xd},pdbx_reference_entity_nonpoly:{prd_id:Yr,ref_entity_id:Yr,name:Yr,chem_comp_id:Yr},pdbx_reference_entity_link:{link_id:Xd,prd_id:Yr,details:Yr,ref_entity_id_1:Yr,ref_entity_id_2:Yr,entity_seq_num_1:Xd,entity_seq_num_2:Xd,comp_id_1:Yr,comp_id_2:Yr,atom_id_1:Yr,atom_id_2:Yr,value_order:Ac(ay),component_1:Xd,component_2:Xd,link_class:Ac(Yr)},pdbx_reference_entity_poly_link:{link_id:Xd,prd_id:Yr,ref_entity_id:Yr,component_id:Xd,entity_seq_num_1:Xd,entity_seq_num_2:Xd,comp_id_1:Yr,comp_id_2:Yr,atom_id_1:Yr,atom_id_2:Yr,value_order:Ac(ay)},pdbx_reference_entity_poly:{prd_id:Yr,ref_entity_id:Yr,type:Ac(Yr),db_code:Yr,db_name:Yr},pdbx_reference_entity_poly_seq:{prd_id:Yr,ref_entity_id:Yr,mon_id:Yr,parent_mon_id:Yr,num:Xd,observed:Ac(ay),hetero:Ac(ay)},pdbx_reference_entity_sequence:{prd_id:Yr,ref_entity_id:Yr,type:Ac(Yr),NRP_flag:Ac(Yr),one_letter_codes:Yr},pdbx_reference_entity_src_nat:{prd_id:Yr,ref_entity_id:Yr,ordinal:Xd,organism_scientific:Yr,taxid:Yr,db_code:Yr,db_name:Yr},pdbx_prd_audit:{prd_id:Yr,date:Yr,processing_site:Ac(Yr),action_type:Ac(Yr)}};var tce=H.Schema,os=tce.str,qHe=tce.float,YHe={id:os,description:os},KHe={title:os,datablock_id:os,version:os},JHe={version:os,update:os,revision:os},$He={id:os,description:os},e6e={id:os,parent_id:os,description:os},t6e={code:os,primitive_code:os,construct:os,detail:os},r6e={code:os,detail:os},n6e={from_code:os,to_code:os,operator:os,factor:qHe},rce={datablock:YHe,dictionary:KHe,dictionary_history:JHe,sub_category:$He,category_group_list:e6e,item_type_list:t6e,item_units_list:r6e,item_units_conversion:n6e};var $2=H.Schema,xh=$2.str,QM=$2.int,sy=$2.float,ZM=$2.Aliased,px=$2.Vector,H7t={density_server_result:{server_version:xh,datetime_utc:xh,guid:xh,is_empty:ZM(xh),has_error:ZM(xh),error:xh,query_source_id:xh,query_type:ZM(xh),query_box_type:ZM(xh),query_box_a:px(3),query_box_b:px(3)}},qM={volume_data_3d_info:{name:xh,axis_order:px(3,QM),origin:px(3),dimensions:px(3),sample_rate:QM,sample_count:px(3,QM),spacegroup_number:QM,spacegroup_cell_size:px(3),spacegroup_cell_angles:px(3),mean_source:sy,mean_sampled:sy,sigma_source:sy,sigma_sampled:sy,min_source:sy,min_sampled:sy,max_source:sy,max_sampled:sy},volume_data_3d:{values:sy}};var YM=H.Schema,ha=YM.float,DH=YM.int,si=YM.str,o6e=YM.Matrix,nce={cell:{angle_alpha:ha,angle_beta:ha,angle_gamma:ha,formula_units_z:DH,length_a:ha,length_b:ha,length_c:ha,volume:ha},chemical:{melting_point:ha,name_common:si,name_systematic:si},chemical_formula:{moiety:si,sum:si,weight:ha},space_group:{crystal_system:si,it_number:DH,"name_h-m_full":si},space_group_symop:{operation_xyz:si},geom_bond:{atom_site_label_1:si,atom_site_label_2:si,distance:ha,publ_flag:si,site_symmetry_1:si,site_symmetry_2:si,valence:ha},audit:{block_doi:si},database_code:{cod:si,csd:si,depnum_ccdc_archive:si,depnum_ccdc_fiz:si,icsd:si,mdf:si,nbs:si},atom_site:{adp_type:si,calc_flag:si,disorder_assembly:si,disorder_group:si,fract_x:ha,fract_y:ha,fract_z:ha,label:si,occupancy:ha,refinement_flags:si,site_symmetry_multiplicity:DH,type_symbol:si,u_iso_or_equiv:ha},atom_site_aniso:{label:si,u_11:ha,u:o6e(3,3),u_12:ha,u_13:ha,u_22:ha,u_23:ha,u_33:ha},atom_type:{description:si,symbol:si},atom_type_scat:{dispersion_imag:ha,dispersion_real:ha,source:si}},oce={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]};var i6e=H.Schema,wH=i6e.int,ice={volume_data_3d_info:qM.volume_data_3d_info,segmentation_data_table:{set_id:wH,segment_id:wH},segmentation_data_3d:{values:wH}};var mu={parse:e=>tm.is(e)?AH(e):RH(e),parseText:AH,parseBinary:RH,toDatabaseCollection:Gse,toDatabase:nm,schema:{mmCIF:e=>nm(an,e),CCD:e=>nm($ue,e),BIRD:e=>nm(ece,e),dic:e=>nm(rce,e),cifCore:e=>nm(nce,e,oce),densityServer:e=>nm(qM,e),segmentation:e=>nm(ice,e)}};var a6e={U:an.atom_site_anisotrop.U,U_esd:an.atom_site_anisotrop.U_esd},am;(i=>{i.Schema=a6e,i.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance(a){return i.Provider.get(a.firstModel)?Cn.is(a.firstModel.sourceData)?Oi.Category.ofTable(a.firstModel.sourceData.data.db.atom_site_anisotrop):Oi.Category.Empty:Oi.Category.Empty}}]}},i.Provider=ll.create(i.Descriptor);function n(a,s){let l=new Int32Array(a.rowCount);l.fill(-1);for(let c=0,m=a.rowCount;c<m;c++)l[a.value(c)]=c;let u=new Int32Array(a.rowCount);u.fill(-1);for(let c=0,m=s.rowCount;c<m;++c){let d=l[s.value(c)];d!==-1&&(u[d]=c)}return u}i.getElementToAnsiotrop=n;function o(a,s){let l={};for(let c=0,m=a.rowCount;c<m;c++)l[a.value(c)]=c;let u=new Int32Array(a.rowCount);u.fill(-1);for(let c=0,m=s.rowCount;c<m;++c){let d=l[s.value(c)];d!==void 0&&(u[d]=c)}return u}i.getElementToAnsiotropFromLabel=o})(am||={});var ly;(u=>{let e="molstar_global_model_transform_info";u.Schema={[e]:{matrix:H.Schema.Matrix(4,4,H.Schema.float)}},u.Descriptor={name:e,cifExport:{categories:[{name:e,instance(c){let m=i(c.firstModel);if(!m)return Oi.Category.Empty;let d=Cr.ofRows(u.Schema.molstar_global_model_transform_info,[{matrix:m}]);return Oi.Category.ofTable(d)}}],prefix:"molstar"}},u.Provider=ll.create(u.Descriptor);function o(c,m){c.customProperties.has(u.Descriptor)||c.customProperties.add(u.Descriptor),u.Provider.set(c,m)}u.attach=o;function i(c){return u.Provider.get(c)}u.get=i;function a(c){if(!Cn.is(c.sourceData))return;let m=c.sourceData.data.frame.categories[e];if(!m)return;let d=uM(u.Schema[e],m);if(d._rowCount!==0)return d.matrix.value(0)}u.fromMmCif=a;function s(c){if(!Cn.is(c.sourceData))return!1;let m=c.sourceData.data.frame.categories[e];return!!m&&m.rowCount>0}u.hasData=s;function l(c,m){c.writeCategory({name:e,instance(){let d=Cr.ofRows(u.Schema.molstar_global_model_transform_info,[{matrix:m}]);return Oi.Category.ofTable(d)}})}u.writeMmCif=l})(ly||={});var Mjt={label_comp_id:an.atom_site.label_comp_id,label_seq_id:an.atom_site.label_seq_id,pdbx_PDB_ins_code:an.atom_site.pdbx_PDB_ins_code,label_asym_id:an.atom_site.label_asym_id,label_entity_id:an.atom_site.label_entity_id,auth_comp_id:an.atom_site.auth_atom_id,auth_seq_id:an.atom_site.auth_seq_id,auth_asym_id:an.atom_site.auth_asym_id},Bjt={...an.chem_comp_bond,molstar_protonation_variant:H.Schema.Str()},ace={...an.chem_comp,type:H.Schema.Aliased(H.Schema.str)};function lce(e,t){let{ihm_model_group:r,ihm_model_group_link:n}=t,o=Cr.pickRow(n,i=>n.model_id.value(i)===e);if(o){let i=Cr.pickRow(r,a=>r.id.value(a)===o.group_id);if(i)return i.name}return""}function sce(e){for(let t=0,r=e.rowCount;t<r;t++)if(e.valueKind(t)===H.ValueKinds.Present)return!0;return!1}function e_(e,t,r){(!e[t].isDefined||!sce(e[t]))&&(e[t]=e[r]),(!e[r].isDefined||!sce(e[r]))&&(e[r]=e[t])}function uce(e){let t=Cr.ofColumns(e._schema,e);return e_(t,"label_atom_id","auth_atom_id"),e_(t,"label_comp_id","auth_comp_id"),e_(t,"label_seq_id","auth_seq_id"),e_(t,"label_asym_id","auth_asym_id"),e_(t,"label_entity_id","label_asym_id"),t}var Co={entry:an.entry,struct:an.struct,struct_asym:an.struct_asym,ihm_model_list:an.ihm_model_list,ihm_model_group:an.ihm_model_group,ihm_model_group_link:an.ihm_model_group_link,entity:an.entity,entity_poly:an.entity_poly,entity_poly_seq:an.entity_poly_seq,pdbx_entity_branch:an.pdbx_entity_branch,chem_comp:ace,pdbx_chem_comp_identifier:an.pdbx_chem_comp_identifier,atom_site:an.atom_site,ihm_sphere_obj_site:an.ihm_sphere_obj_site,ihm_gaussian_obj_site:an.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:an.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:an.pdbx_molecule};function Gi(e,t=!1){let r=Object.create(null);for(let n of Object.keys(Co))n in e?r[n]=e[n]:r[n]=Cr.ofUndefinedColumns(Co[n],0);return t&&(r.atom_site=uce(r.atom_site)),r}var _i=class{constructor(){this.count=0;this.ids=[];this.types=[];this.descriptions=[];this.compoundsMap=new Map;this.namesMap=new Map;this.heteroMap=new Map;this.chainMap=new Map}set(t,r){this.count+=1,this.ids.push(`${this.count}`),this.types.push(t),this.descriptions.push([r])}getEntityId(t,r,n,o){return r===2?(this.waterId===void 0&&(this.set("water",o?.customName||"Water"),this.waterId=`${this.count}`),this.waterId):tx(r)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",o?.customName||`Polymer ${this.chainMap.size+1}`),this.chainMap.set(n,`${this.count}`)),this.chainMap.get(n)):(this.heteroMap.has(t)||(this.set("non-polymer",o?.customName||this.namesMap.get(t)||t),this.heteroMap.set(t,`${this.count}`)),this.heteroMap.get(t))}getEntityTable(){return Cr.ofPartialColumns(Co.entity,{id:H.ofStringArray(this.ids),type:H.ofStringAliasArray(this.types),pdbx_description:H.ofStringListArray(this.descriptions)},this.count)}setCompounds(t){for(let r=0,n=t.length;r<n;++r){let{chains:o,description:i}=t[r];this.set("polymer",i);for(let a=0,s=o.length;a<s;++a)this.compoundsMap.set(o[a],`${this.count}`)}}setNames(t){t.forEach(r=>this.namesMap.set(r[0],r[1]))}};var s6e=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],l6e=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],u6e=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],c6e=new Set(["FMN","NCN","FNS","FMA","ATP","ADP","AMP","GTP","GDP","GMP","LIG"]),cce=function(){let e=new Map;return[{id:"HIS",name:"HISTIDINE",type:"l-peptide linking"},{id:"ARG",name:"ARGININE",type:"l-peptide linking"},{id:"LYS",name:"LYSINE",type:"l-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"l-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"l-peptide linking"},{id:"LEU",name:"LEUCINE",type:"l-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"l-peptide linking"},{id:"ALA",name:"ALANINE",type:"l-peptide linking"},{id:"MET",name:"METHIONINE",type:"l-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"l-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"l-peptide linking"},{id:"VAL",name:"VALINE",type:"l-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"l-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"l-peptide linking"},{id:"TYR",name:"TYROSINE",type:"l-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"l-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"l-peptide linking"},{id:"THR",name:"THREONINE",type:"l-peptide linking"},{id:"PRO",name:"PROLINE",type:"l-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"l-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"l-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"l-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"l-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"l-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"l-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"l-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"I",name:"INOSINIC ACID",type:"rna linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"dna linking"}].forEach(r=>e.set(r.id,r)),e}(),mce=function(){let e=new Map;return[{id:"ZN2",name:"ZINC ION",type:"ion"},{id:"SOD",name:"SODIUM ION",type:"ion"},{id:"CES",name:"CESIUM ION",type:"ion"},{id:"CLA",name:"CHLORIDE ION",type:"ion"},{id:"CAL",name:"CALCIUM ION",type:"ion"},{id:"POT",name:"POTASSIUM ION",type:"ion"}].forEach(r=>e.set(r.id,r)),e}(),Ri=class{constructor(t,r){this.seqId=t;this.atomId=r;this.namesMap=new Map;this.comps=new Map;this.ids=[];this.names=[];this.types=[];this.mon_nstd_flags=[]}set(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(ey.has(t.id)?"y":"n")}getAtomIds(t){let r=new Set,n=this.seqId.value(t);for(;t<this.seqId.rowCount;){let o=this.seqId.value(t);if(o!==n)break;r.add(this.atomId.value(t)),n-o,t+=1}return r}hasAtomIds(t,r){for(let n=0,o=r.length;n<o;++n)if(!no.areIntersecting(t,r[n]))return!1;return!0}getType(t){return this.hasAtomIds(t,s6e)?"peptide linking":this.hasAtomIds(t,l6e)?"rna linking":this.hasAtomIds(t,u6e)?"dna linking":"other"}has(t){return this.comps.has(t)}get(t){return this.comps.get(t)}add(t,r){if(!this.has(t))if(cce.has(t))this.set(cce.get(t));else if(_v.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else if(c6e.has(t.toUpperCase()))this.set({id:t,name:this.namesMap.get(t)||t,type:"non-polymer"});else if(zd.has(t.toUpperCase()))this.set({id:t,name:this.namesMap.get(t)||t,type:"saccharide"});else{let n=this.getAtomIds(r);if(n.size===1&&mce.has(t))this.set(mce.get(t));else{let o=this.getType(n);this.set({id:t,name:this.namesMap.get(t)||t,type:o})}}return this.get(t)}getChemCompTable(){return Cr.ofPartialColumns(Co.chem_comp,{id:H.ofStringArray(this.ids),name:H.ofStringArray(this.names),type:H.ofStringAliasArray(this.types),mon_nstd_flag:H.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)}setNames(t){t.forEach(r=>this.namesMap.set(r[0],r[1]))}};var dce={molstar_bond_site:{atom_id_1:H.Schema.int,atom_id_2:H.Schema.int,value_order:H.Schema.Aliased(H.Schema.lstr),type_id:H.Schema.Aliased(H.Schema.lstr)}},n8t=Oi.fields().int("atom_id_1",(e,t)=>t[e].atom_id_1).int("atom_id_2",(e,t)=>t[e].atom_id_2).str("value_order",(e,t)=>t[e].value_order??"",{valueKind:(e,t)=>t[e].value_order===void 0?H.ValueKinds.NotPresent:H.ValueKinds.Present}).str("type_id",(e,t)=>t[e].type_id??"",{valueKind:(e,t)=>t[e].type_id===void 0?H.ValueKinds.NotPresent:H.ValueKinds.Present}).getFields();function m6e(e){if(Cn.is(e.sourceData))return wo.fromData(e.sourceData.data.db)}wo.Provider.formatRegistry.add("mmCIF",m6e);function d6e(e){if(!Cn.is(e.sourceData))return;let{struct_conf:t,struct_sheet_range:r}=e.sourceData.data.db;return yh.fromStruct(t,r,e.atomicHierarchy)}yh.Provider.formatRegistry.add("mmCIF",d6e);function p6e(e){if(!Cn.is(e.sourceData))return;let{atom_site_anisotrop:t}=e.sourceData.data.db,r=Cr.ofColumns(am.Schema,t),n=am.getElementToAnsiotrop(e.atomicConformation.atomId,t.id);return{data:r,elementToAnsiotrop:n}}function f6e(e){return Cn.is(e.sourceData)?e.sourceData.data.db.atom_site_anisotrop.U.isDefined:!1}am.Provider.formatRegistry.add("mmCIF",p6e,f6e);function h6e(e){if(!Cn.is(e.sourceData))return;let{chem_comp_bond:t}=e.sourceData.data.db;if(t._rowCount!==0)return{data:t,entries:ax.getEntriesFromChemCompBond(t)}}ax.Provider.formatRegistry.add("mmCIF",h6e);function g6e(e){if(!Cn.is(e.sourceData))return;let{struct_conn:t}=e.sourceData.data.db;if(t._rowCount===0)return;let r=vc.getEntriesFromStructConn(t,e),n=new Set;for(let o of r)o.partnerA.residueIndex!==o.partnerB.residueIndex&&n.add(cc(o.partnerA.residueIndex,o.partnerB.residueIndex));return{data:t,byAtomIndex:vc.getAtomIndexFromEntries(r),residueCantorPairs:n,entries:r}}vc.Provider.formatRegistry.add("mmCIF",g6e);function y6e(e){if(!Cn.is(e.sourceData))return;let{molstar_bond_site:t}=nm(dce,e.sourceData.data.frame);if(t._rowCount===0)return;let r=new Map,{atomId:n}=e.atomicConformation;for(let p=0;p<n.rowCount;p++)r.set(n.value(p),p);let o=[],i=[],a=[],s=[],{atom_id_1:l,atom_id_2:u,value_order:c,type_id:m}=t;for(let p=0;p<t._rowCount;p++){o.push(r.get(l.value(p))),i.push(r.get(u.value(p)));let h=ht.Flag.None,f=1;switch(c.value(p)){case"sing":f=1;break;case"doub":f=2;break;case"trip":f=3;break;case"quad":f=4;break;case"arom":f=1,h=ht.Flag.Aromatic;break;default:break}switch(m.value(p)){case"covale":h|=ht.Flag.Covalent;break;case"disulf":h|=ht.Flag.Covalent|ht.Flag.Disulfide;break;case"hydrog":h|=ht.Flag.HydrogenBond;break;case"metalc":h|=ht.Flag.MetallicCoordination;break}a.push(f),s.push(h)}return Do.fromData({pairs:{indexA:H.ofIntArray(o),indexB:H.ofIntArray(i),order:H.ofIntArray(a),flag:H.ofArray({array:s,schema:H.Schema.int})},count:e.atomicHierarchy.atoms._rowCount},{maxDistance:1/0})}Do.Provider.formatRegistry.add("mmCIF",y6e);ly.Provider.formatRegistry.add("mmCIF",ly.fromMmCif,ly.hasData);var Cn;(r=>{function e(n){return n?.kind==="mmCIF"}r.is=e;function t(n,o,i,a){return o||(o=mu.schema.mmCIF(n)),{kind:"mmCIF",name:o._name,data:{db:o,file:a,frame:n,source:i}}}r.fromFrame=t})(Cn||={});function JM(e,t){let r=Cn.fromFrame(e,void 0,void 0,t),n=Gi(r.data.db,!0);return Pe.create("Create mmCIF Model",o=>Fa(n,r,o))}var KM;(o=>{let e="__CcdCoordinateType__";o.CoordinateType={get(i){return i._staticPropertyData[e]},set(i,a){return i._staticPropertyData[e]=a}};function r(i){return i?.kind==="CCD"}o.is=r;function n(i,a){return a||(a=mu.schema.CCD(i)),{kind:"CCD",name:a._name,data:{db:a,frame:i}}}o.fromFrame=n})(KM||={});function fce(e){let t=KM.fromFrame(e);return Pe.create("Create CCD Models",r=>b6e(t.data.db,KM.fromFrame(e),r))}async function b6e(e,t,r){let n=await pce(e,t,{coordinateType:"ideal",cartn_x:"pdbx_model_Cartn_x_ideal",cartn_y:"pdbx_model_Cartn_y_ideal",cartn_z:"pdbx_model_Cartn_z_ideal"},r),o=await pce(e,t,{coordinateType:"model",cartn_x:"model_Cartn_x",cartn_y:"model_Cartn_y",cartn_z:"model_Cartn_z"},r),i=[];n&&i.push(n),o&&i.push(o);for(let a=0,s=i.length;a<s;++a)Ft.TrajectoryInfo.set(i[a],{index:a,size:i.length});return new cl(i)}async function pce(e,t,r,n){let{chem_comp:o,chem_comp_atom:i,chem_comp_bond:a}=e,{coordinateType:s,cartn_x:l,cartn_y:u,cartn_z:c}=r,m=o.name.value(0),d=o.id.value(0),{atom_id:p,charge:h,comp_id:f,pdbx_ordinal:y,type_symbol:g}=i,x=i._rowCount,S=[];for(let $=0;$<x;$++)i[l].valueKind($)>0||(S[S.length]=$);let I=S.length,v=H.ofConst("A",I,H.Schema.str),A=H.ofConst(1,I,H.Schema.int),_=H.ofConst("1",I,H.Schema.str),T=H.ofConst(1,I,H.Schema.float),w=H.ofConst(1,I,H.Schema.int),D=H.view(p,S),M=H.view(f,S),E=H.view(i[l],S),R=H.view(i[u],S),k=H.view(i[c],S),B=H.view(y,S),L=H.view(g,S),V=H.view(h,S),U=Cr.ofPartialColumns(Co.atom_site,{auth_asym_id:v,auth_atom_id:D,auth_comp_id:M,auth_seq_id:A,Cartn_x:E,Cartn_y:R,Cartn_z:k,id:B,label_asym_id:v,label_atom_id:D,label_comp_id:M,label_seq_id:A,label_entity_id:_,occupancy:T,type_symbol:L,pdbx_PDB_model_num:w,pdbx_formal_charge:V},I),Q=new _i;Q.setNames([[d,`${m} (${s})`]]),Q.getEntityId(d,0,"A");let O=new Ri(A,g);O.setNames([[d,`${m} (${s})`]]),O.add(d,0);let q=Gi({entity:Q.getEntityTable(),chem_comp:O.getChemCompTable(),atom_site:U}),X=await Fa(q,t,n);if(!X.representative)return;let F=X.representative,Y=ax.getEntriesFromChemCompBond(a);return ax.Provider.set(F,{data:a,entries:Y}),KM.CoordinateType.set(F,s),X.representative}var ed;(r=>{function e(n){let o=n.descriptor.name,i=n.type==="static"?"_staticPropertyData":"_dynamicPropertyData",a=l=>(o in l[i]||(l[i][o]={props:{...C.getDefaultValues(n.getParams(l))},data:Ug.create(void 0)}),l[i][o]),s=(l,u,c)=>{let m=a(l);l[i][o]={props:u,data:Ug.withValue(m.data,c)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:l=>{let u=C.clone(n.getParams(l));return C.setDefaultValues(u,a(l).props),u},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:async(l,u,c={},m)=>{m&&u.customProperties.reference(n.descriptor,!0);let d=a(u),p=C.merge(n.defaultParams,d.props,c);if(d.data.value&&C.areEqual(n.defaultParams,d.props,p))return;let{value:h,assets:f}=await n.obtain(l,u,p);u.customProperties.add(n.descriptor),u.customProperties.assets(n.descriptor,f),s(u,p,h)},ref:(l,u)=>l.customProperties.reference(n.descriptor,u),get:l=>a(l)?.data,set:(l,u={},c)=>{let m=a(l),d=C.merge(n.defaultParams,m.props,u);C.areEqual(n.defaultParams,m.props,d)||(s(l,d,c),l.customProperties.assets(n.descriptor))},props:l=>a(l).props}}r.createProvider=e;function t(n,o,i){let a={value:C.Value(i,{isHidden:!0})};return e({label:ta(n),descriptor:{name:n},isHidden:!0,type:o,defaultParams:a,getParams:()=>({value:C.Value(i,{isHidden:!0})}),isApplicable:()=>!0,obtain:async(s,l,u)=>({...C.getDefaultValues(a),...u})})}r.createSimple=t})(ed||={});var Tc;(i=>{i.Provider=ed.createProvider({label:"SIFTS Mapping",descriptor:{name:"sifts_sequence_mapping"},type:"static",defaultParams:{},getParams:()=>({}),isApplicable:a=>t(a),obtain:async(a,s)=>({value:o(s)})});function t(a){if(!Cn.is(a.sourceData))return!1;let{pdbx_sifts_xref_db_name:s,pdbx_sifts_xref_db_acc:l,pdbx_sifts_xref_db_num:u,pdbx_sifts_xref_db_res:c}=a.sourceData.data.db.atom_site;return s.isDefined&&l.isDefined&&u.isDefined&&c.isDefined}i.isAvailable=t;function r(a){let s=a.unit.model,l=i.Provider.get(s).value;if(!l)return"";let u=s.atomicHierarchy.residueAtomSegments.index[a.element];return l.accession[u]}i.getKey=r;function n(a){let s=a.unit.model,l=i.Provider.get(s).value;if(!l)return;let u=s.atomicHierarchy.residueAtomSegments.index[a.element],c=l.dbName[u];if(c)return`${c} ${l.accession[u]} ${l.num[u]} ${l.residue[u]}`}i.getLabel=n;function o(a){if(!Cn.is(a.sourceData))return;let{pdbx_sifts_xref_db_name:s,pdbx_sifts_xref_db_acc:l,pdbx_sifts_xref_db_num:u,pdbx_sifts_xref_db_res:c}=a.sourceData.data.db.atom_site;if(!s.isDefined||!l.isDefined||!u.isDefined||!c.isDefined)return;let{atomSourceIndex:m}=a.atomicHierarchy,{count:d,offsets:p}=a.atomicHierarchy.residueAtomSegments,h=new Array(d),f=new Array(d),y=new Array(d),g=new Array(d);for(let x=0;x<d;x++){let S=m.value(p[x]);if(s.valueKind(S)!==H.ValueKinds.Present){h[x]="",f[x]="",y[x]="",g[x]="";continue}h[x]=s.value(S),f[x]=l.value(S),y[x]=u.value(S),g[x]=c.value(S)}return{dbName:h,accession:f,num:y,residue:g}}})(Tc||={});function EH(e,t){if(Cn.is(e.sourceData))return e.sourceData.data.db[t]}function hce(e){if(e.length===0)return new Set;let t=e[0].model.entities.data.id;return new Set(gce(e).map(r=>t.value(r)))}function gce(e){if(e.length===0)return[];if(e.length===1)return e[0].entityIndices;let t=Tn.create();for(let r of e)for(let n of r.entityIndices)Tn.add(t,n,n);return Fs(t.array),t.array}var yce=Oi.Category,x6e=MH("struct_asym"),C6e=MH("entity_poly"),S6e=MH("entity_poly_seq");function MH(e){return{name:e,instance({structures:t,cache:r}){return v6e(t,e,r)}}}function v6e(e,t,r){let n=EH(e[0].model,t);if(!n)return yce.Empty;let{entity_id:o}=n,i=r.uniqueEntityIds||(r.uniqueEntityIds=hce(e)),a=H.indicesOf(o,s=>i.has(s));return yce.ofTable(n,a)}var I6e;(t=>{function e(r){let n=Array.isArray(r)?r:[r];return{structures:n,firstModel:n[0].model,cache:Object.create(null)}}t.create=e})(I6e||={});var A6e;(t=>t.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"]))(A6e||={});var xce={molstar_atom_site_operator_mapping:{label_asym_id:H.Schema.Str(),auth_asym_id:H.Schema.Str(),operator_name:H.Schema.Str(),suffix:H.Schema.Str(),assembly_id:H.Schema.Str(),assembly_operator_id:H.Schema.Int(),symmetry_operator_index:H.Schema.Int(),symmetry_hkl:H.Schema.Vector(3),ncs_id:H.Schema.Int()}},bce=(e,t)=>typeof t[e].operator.assembly>"u"?H.ValueKinds.NotPresent:H.ValueKinds.Present,BH=(e,t)=>t[e].operator.spgrOp===-1?H.ValueKinds.NotPresent:H.ValueKinds.Present,nXt=Oi.fields().str("label_asym_id",(e,t)=>t[e].label_asym_id).str("auth_asym_id",(e,t)=>t[e].auth_asym_id).str("operator_name",(e,t)=>t[e].operator.name).str("suffix",(e,t)=>t[e].operator.suffix).str("assembly_id",(e,t)=>t[e].operator.assembly?.id||"",{valueKind:bce}).int("assembly_operator_id",(e,t)=>t[e].operator.assembly?.operId||0,{valueKind:bce}).int("symmetry_operator_index",(e,t)=>t[e].operator.spgrOp,{valueKind:BH}).vec("symmetry_hkl",[(e,t)=>t[e].operator.hkl[0],(e,t)=>t[e].operator.hkl[1],(e,t)=>t[e].operator.hkl[2]],{valueKind:BH}).int("ncs_id",(e,t)=>t[e].operator.ncsId,{valueKind:BH}).getFields();function Cce(e,t,r,n){let{label_comp_id:o,type_symbol:i,_rowCount:a}=e.atoms,{_rowCount:s}=e.residues,{offsets:l}=t.residueAtomSegments,u=new Uint8Array(a);for(let g=0;g<a;++g)u[g]=sx(i.value(g));let c=new Int32Array(s),m=new Int32Array(s),d=new Int32Array(s),p=new Uint8Array(s),h=new Uint8Array(s),f=new Map,y=new Map;for(let g=0;g<s;++g){let x=o.value(l[g]),S=n,I,v;if(f.has(x))I=f.get(x),v=y.get(x);else{let D;S.has(x)?D=S.get(x).type:(Yb||console.info("chemComp not found",x),D=_9(x)),I=Tl(D,x),v=wse(D,I),f.set(x,I),y.set(x,v)}p[g]=I,h[g]=v;let A=gh(v,"trace"),_=r.findAtomsOnResidue(g,A);if(_===-1){let D=gh(v,"coarseBackbone");_=r.findAtomsOnResidue(g,D),_===-1&&tx(I)&&(_=r.findElementOnResidue(g,of("C")))}c[g]=_;let T=gh(v,"directionFrom");m[g]=r.findAtomsOnResidue(g,T);let w=gh(v,"directionTo");d[g]=r.findAtomsOnResidue(g,w)}return{atom:{atomicNumber:u},residue:{traceElementIndex:c,directionFromElementIndex:m,directionToElementIndex:d,moleculeType:p,polymerType:h}}}function Yv(e,t){return t?t.length===1?Xi(t.charCodeAt(0),e):t.length===2?Xi(t.charCodeAt(0),Xi(t.charCodeAt(1),e)):`${e} ${t}`:e}function T6e(e,t,r,n){if(e.has(t)){let o=e.get(t);o.has(r)||o.set(r,n)}else{let o=new Map;e.set(t,o),o.set(r,n)}}function P6e(e){throw new Error(`Missing entity entry for entity id '${e}'.`)}function _6e(e,t,r){return{entities:e,segments:r,label_seq_id:Be.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,type_symbol:t.atoms.type_symbol,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}var t_=rH.EmptyResidueKey(),FH=class{constructor(t){this.map=t;this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}getEntityFromChain(t){return this.map.chain_index_entity_index[t]}findEntity(t){let r=this.map.label_asym_id.get(t);return r!==void 0?r:-1}findChainLabel(t){let r=this.entityIndex(t.label_entity_id);if(r<0||!this.map.entity_index_label_asym_id.has(r))return-1;let n=this.map.entity_index_label_asym_id.get(r);return n&&n.has(t.label_asym_id)?n.get(t.label_asym_id):-1}findChainAuth(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;let r=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return r.has(t.auth_seq_id)?r.get(t.auth_seq_id):-1}findResidue(t,r,n,o){let i;arguments.length===1?i=t:(t_.label_entity_id=t,t_.label_asym_id=r,t_.auth_seq_id=n,t_.pdbx_PDB_ins_code=o,i=t_);let a=this.findChainLabel(i);if(a<0)return-1;let s=this.map.chain_index_auth_seq_id.get(a),l=Yv(i.auth_seq_id,i.pdbx_PDB_ins_code||"");return s.has(l)?s.get(l):-1}findResidueLabel(t){let r=this.findChainLabel(t);if(r<0)return-1;let n=this.map.chain_index_label_seq_id.get(r),o=Yv(t.label_seq_id,t.pdbx_PDB_ins_code||"");return n.has(o)?n.get(o):-1}findResidueAuth(t){let r=this.findChainAuth(t);if(r<0)return-1;let n=this.map.chain_index_auth_seq_id.get(r),o=Yv(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return n.has(o)?n.get(o):-1}findResidueInsertion(t){let r=this.findChainLabel(t);if(r<0)return-1;let n=this.map.chain_index_label_seq_id.get(r),o=Yv(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(n.has(o))return n.get(o);let i=Be.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),a=H0.chainStartResidueIndex(this.map.segments,r);if(i<a)return a;let s=H0.chainEndResidueIndexExcl(this.map.segments,r)-1;return i>=s?s:i}findAtom(t){let r=this.findResidue(t);return r<0?-1:typeof t.label_alt_id>"u"?kH(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,t.label_atom_id):LH(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)}findAtomAuth(t){let r=this.findResidueAuth(t);return r<0?-1:typeof t.label_alt_id>"u"?kH(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,t.auth_atom_id):LH(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)}findAtomOnResidue(t,r,n){return typeof n>"u"?kH(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r):LH(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,r,n)}findAtomsOnResidue(t,r){return R6e(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r)}findElementOnResidue(t,r){return D6e(this.residueOffsets[t],this.residueOffsets[t+1],this.map.type_symbol,r)}};function kH(e,t,r,n){for(let o=e;o<t;o++)if(r.value(o)===n)return o;return-1}function R6e(e,t,r,n){for(let o=e;o<t;o++)if(n.has(r.value(o)))return o;return-1}function LH(e,t,r,n,o,i){for(let a=e;a<t;a++)if(r.value(a)===o&&n.value(a)===i)return a;return-1}function D6e(e,t,r,n){for(let o=e;o<t;o++)if(r.value(o)===n)return o;return-1}function Sce(e,t,r){let n=_6e(t,e,r),{label_seq_id:o,auth_seq_id:i,pdbx_PDB_ins_code:a}=e.residues,{label_entity_id:s,label_asym_id:l,auth_asym_id:u}=e.chains,c=xe.ofBounds(0,e.atoms._rowCount),m=Xt.transientSegments(r.chainAtomSegments,c);for(;m.hasNext;){let d=m.move(),p=d.index,h=t.getEntityIndex(s.value(p));h<0&&P6e(s.value(p)),n.chain_index_entity_index[p]=h;let f=u.value(p),y=n.auth_asym_id_auth_seq_id.get(f);y||(y=new Map,n.auth_asym_id_auth_seq_id.set(f,y));let g=l.value(p);n.label_asym_id.has(g)||n.label_asym_id.set(g,h),T6e(n.entity_index_label_asym_id,h,g,p);let x=new Map,S=new Map;n.chain_index_label_seq_id.set(p,x),n.chain_index_auth_seq_id.set(p,S);let I=Xt.transientSegments(r.residueAtomSegments,c,d);for(;I.hasNext;){let A=I.move().index,_=i.value(A),T=a.value(A);x.set(Yv(o.value(A),T),A),S.set(Yv(_,T),A),y.set(_,p)}}return new FH(n)}function w6e(e){if(e._rowCount===0)return{residues:[],chains:[]};let t=0,r=e._rowCount,n=[t],o=[t],{label_entity_id:i,label_asym_id:a,label_seq_id:s,auth_seq_id:l,pdbx_PDB_ins_code:u}=e;for(let c=t+1;c<r;c++){let m=!i.areValuesEqual(c-1,c)||!a.areValuesEqual(c-1,c);(m||!s.areValuesEqual(c-1,c)||!l.areValuesEqual(c-1,c)||!u.areValuesEqual(c-1,c))&&(n[n.length]=c),m&&(o[o.length]=c)}return{residues:n,chains:o}}function E6e(e,t,r){let n=Cr.ofColumns(nue,{type_symbol:H.ofArray({array:H.mapToArray(e.type_symbol,of),schema:H.Schema.Aliased(H.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),o=Cr.view(e,oue,r.residues),i=Cr.view(e,iue,r.chains);if(!o.label_seq_id.isDefined){let a=new Int32Array(o.label_seq_id.rowCount),{residues:s,chains:l}=r,u=0,c=0;for(let m=0,d=a.length;m<d;++m)s[m]>=l[u+1]&&(u+=1,c=0),a[m]=++c;o.label_seq_id=H.ofIntArray(a)}return Cr.columnToArray(o,"label_seq_id",Int32Array),Cr.columnToArray(o,"auth_seq_id",Int32Array),{atoms:n,residues:o,chains:i,atomSourceIndex:t}}function M6e(e){return{id:en.create22(),atomId:e.id,occupancy:e.occupancy.isDefined?e.occupancy:H.ofConst(1,e._rowCount,H.Schema.float),B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}function B6e(e,t){return Cr.areEqual(e.chains,t.chains)&&Cr.areEqual(e.residues,t.residues)&&Cr.areEqual(e.atoms,t.atoms)}function k6e(e,t){let r=new Map;if(!Cn.is(t))return r;let{molstar_atom_site_operator_mapping:n}=nm(xce,t.data.frame);if(n._rowCount===0)return r;let o=new Map,i=new Map;for(let c=0;c<n._rowCount;c++){let m=n.assembly_operator_id.valueKind(c)===H.ValueKinds.Present?{id:n.assembly_id.value(c),operList:[],operId:n.assembly_operator_id.value(c)}:void 0,d=jn.create(n.operator_name.value(c),Z.identity(),{assembly:m,spgrOp:n.symmetry_operator_index.valueKind(c)===H.ValueKinds.Present?n.symmetry_operator_index.value(c):void 0,hkl:b.ofArray(n.symmetry_hkl.value(c)),ncsId:n.ncs_id.value(c)}),p=n.suffix.value(c),h=n.label_asym_id.value(c);o.set(`${h}${p}`,{name:h,operator:d});let f=n.auth_asym_id.value(c);i.set(`${f}${p}`,f)}let{label_asym_id:a,auth_asym_id:s}=e.chains,l=new Array(a.rowCount),u=new Array(a.rowCount);for(let c=0;c<a.rowCount;c++){let m=a.value(c),d=s.value(c);if(!o.has(m)){l[c]=m,u[c]=d;continue}let{name:p,operator:h}=o.get(m);r.set(c,h),l[c]=p,u[c]=i.get(d)||d}return e.chains.label_asym_id=H.ofArray({array:l,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=H.ofArray({array:u,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),r}function L6e(e,t,r,n,o,i){let a=w6e(e),s=E6e(e,t,a),l=k6e(s,o);if(i&&B6e(i.atomicHierarchy,s))return{sameAsPrevious:!0,hierarchy:i.atomicHierarchy,chainOperatorMapping:l};let u={residueAtomSegments:Xt.ofOffsets(a.residues,xe.ofBounds(0,e._rowCount)),chainAtomSegments:Xt.ofOffsets(a.chains,xe.ofBounds(0,e._rowCount))},c=Sce(s,r,u),m=Cce(s,u,c,n);return{sameAsPrevious:!1,hierarchy:{...s,...u,index:c,derived:m},chainOperatorMapping:l}}function VH(e,t,r,n,o,i){let{sameAsPrevious:a,hierarchy:s,chainOperatorMapping:l}=L6e(e,t,r,n,o,i),u=M6e(e);return{sameAsPrevious:a,hierarchy:s,conformation:u,chainOperatorMapping:l}}function Ice(e){return new GH(e)}var OH=class{findElement(t,r){return r.kind=void 0,r.index=-1,!1}findSphereElement(t){return-1}findGaussianElement(t){return-1}},Ace=new OH,GH=class{constructor(t){this.data=t;this._sphereMapping=void 0;this._gaussianMapping=void 0}get sphereMapping(){return this._sphereMapping||(this._sphereMapping=vce(this.data.spheres)),this._sphereMapping}get gaussianMapping(){return this._gaussianMapping||(this._gaussianMapping=vce(this.data.gaussians)),this._gaussianMapping}findSphereElement(t){let n=this.sphereMapping[t.label_entity_id];return!n||(n=n[t.label_asym_id],!n)?-1:n[t.label_seq_id]??-1}findGaussianElement(t){let n=this.gaussianMapping[t.label_entity_id];return!n||(n=n[t.label_asym_id],!n)?-1:n[t.label_seq_id]??-1}findElement(t,r){let n=this.findSphereElement(t);if(n>=0)return r.kind="spheres",r.index=n,!0;let o=this.findGaussianElement(t);return o>=0?(r.kind="gaussians",r.index=o,!0):!1}};function vce({count:e,entity_id:t,asym_id:r,seq_id_begin:n,seq_id_end:o}){let i={};for(let a=0;a<e;a++){let s=t.value(a),l=r.value(a);i[s]||(i[s]={}),i[s][l]||(i[s][l]={});let u=i[s][l],c=n.value(a),m=o.value(a);for(let d=c;d<=m;d++)u[d]=a}return i}var Tce={chainKey:[],entityKey:[],findSequenceKey:()=>-1,findChainKey:()=>-1,getEntityFromChain:()=>-1,count:0,entity_id:H.Undefined(0,H.Schema.str),asym_id:H.Undefined(0,H.Schema.str),seq_id_begin:H.Undefined(0,H.Schema.int),seq_id_end:H.Undefined(0,H.Schema.int),chainElementSegments:Xt.create([]),polymerRanges:kn.ofSortedRanges([]),gapRanges:kn.ofSortedRanges([])};var UH;(t=>t.Empty={isDefined:!1,spheres:Tce,gaussians:Tce,index:Ace})(UH||={});function F6e(e,t,r){if(e.has(t))return e.get(t);let n=r.index++;return e.set(t,n),n}function V6e(e,t){if(e.has(t))return e.get(t);let r=new Map;return e.set(t,r),r}function O6e(e,t,r){let n=e.getEntityIndex;return{findChainKey:(a,s)=>{let l=n(a);if(l<0)return-1;let u=t.get(l);return u.has(s)?u.get(s):-1},findSequenceKey:(a,s,l)=>{let u=n(a);if(u<0)return-1;let c=t.get(u);if(c===void 0)return-1;let m=c.get(s);if(m===void 0)return-1;let d=r.get(m),{elementIndices:p,seqRanges:h}=d,f=kn.firstIntersectionIndex(h,Se.ofSingleton(l));return f!==-1?p[f]:-1}}}function G6e(e){throw new Error(`Missing entity entry for entity id '${e}'.`)}function NH(e,t){let{entity_id:r,asym_id:n,seq_id_begin:o,seq_id_end:i,count:a,chainElementSegments:s}=e,l=new Map,u=new Map,c={index:0},m=new Int32Array(a),d=new Int32Array(a),p=new Int32Array(s.count);for(let g=0;g<a;g++)d[g]=t.getEntityIndex(r.value(g)),d[g]<0&&G6e(r.value(g));for(let g=0;g<s.count;g++){let x=s.offsets[g],S=s.offsets[g+1],I=d[x];p[g]=I;let v=V6e(u,I),A=F6e(v,n.value(x),c);for(let D=x;D<S;D++)m[D]=A;let _=[],T=[];for(let D=x;D<S;D++){let M=o.value(D),E=i.value(D);_.push(D),T.push(M,E)}let w={elementIndices:_,seqRanges:kn.ofSortedRanges(T)};l.set(A,w)}let{findChainKey:h,findSequenceKey:f}=O6e(t,u,l);return{chainKey:m,entityKey:d,findSequenceKey:f,findChainKey:h,getEntityFromChain:g=>p[g]}}function zH(e,t){let r=[],n=[],o=Xt.transientSegments(e.chainElementSegments,xe.ofBounds(0,e.count)),{seq_id_begin:i,seq_id_end:a}=e;for(;o.hasNext;){let{start:s,end:l}=o.move(),u=-1,c=-1;for(let m=s;m<l;++m){let d=a.value(m);m===s?(u=m,c=a.value(m)):i.value(m)-c>1&&(r.push(u,m-1),n.push(m-1,m),u=m),m===l-1&&r.push(u,m),c=d}}return{polymerRanges:kn.ofSortedRanges(r),gapRanges:kn.ofSortedRanges(n)}}var HH={hierarchy:UH.Empty,conformation:void 0};function _ce(e,t){let{ihm_sphere_obj_site:r,ihm_gaussian_obj_site:n}=e;if(r._rowCount===0&&n._rowCount===0)return HH;let o=Pce(r),i=U6e(r),a=NH(o,e.entities),s=zH(o,t),l=Pce(n),u=N6e(n),c=NH(l,e.entities),m=zH(l,t);return{hierarchy:{isDefined:!0,spheres:{...o,...a,...s},gaussians:{...l,...c,...m},index:Ice({spheres:o,gaussians:l})},conformation:{id:en.create22(),spheres:i,gaussians:u}}}function U6e(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}function N6e(e){let t=Co.ihm_gaussian_obj_site.covariance_matrix.space,r=[],{covariance_matrix:n}=e;for(let o=0,i=n.rowCount;o<i;o++)r[o]=xr.toMat3(Ot(),t,n.value(o));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:r}}function z6e(e,t,r){let n=[0];for(let o=1,i=e.rowCount;o<i;o++)!e.areValuesEqual(o-1,o)&&(n[n.length]=o);return{chainElementSegments:Xt.ofOffsets(n,xe.ofBounds(0,e.rowCount))}}function Pce(e){let{entity_id:t,seq_id_begin:r,seq_id_end:n,asym_id:o}=e;return{count:t.rowCount,entity_id:t,asym_id:o,seq_id_begin:r,seq_id_end:n,...z6e(o,r,n)}}var H6e={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},j6e={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},W6e={A:"A",C:"C",G:"G",T:"T",U:"U"};function jH(e){return H6e[e]||"X"}function WH(e){return W6e[e]||"X"}function XH(e){return j6e[e]||"X"}var Kv;(l=>{let e;(p=>(p.Protein="protein",p.RNA="RNA",p.DNA="DNA",p.Generic="generic"))(e=l.Kind||={});function t(u){let c=u.code.toArray();return(c instanceof Array?c:Array.from(c)).join("")}l.getSequenceString=t;function r(u){for(let c=0,m=Math.min(u.rowCount,10);c<m;c++){let d=u.value(c)||"";if(jH(d)!=="X")return"protein";if(WH(d)!=="X")return"RNA";if(XH(d)!=="X")return"DNA"}return"generic"}function n(u,c){let m;switch(u){case"protein":m=jH;break;case"DNA":m=XH;break;case"RNA":m=WH;break;case"generic":m=()=>"X";break;default:Rr(u)}return c&&c.size>0?d=>{let p=m(d);return p!=="X"||!c.has(d)?p:m(c.get(d))}:m}function o(u,c){if(c.rowCount===0)throw new Error("cannot be empty");let m=r(u);return new i(m,u,c)}l.ofResidueNames=o;class i{constructor(c,m,d){this.kind=c;this.microHet=new Map;let p=n(c),h=[],f=[],y=[],g=new Map,x=0,S=new Map;for(let v=0,A=d.rowCount;v<A;++v){let _=d.value(v);if(S.has(_))g.has(_)?g.get(_).push(m.value(v)):g.set(_,[f[S.get(_)],m.value(v)]);else{S.set(_,x);let T=m.value(v);f[x]=T,y[x]=_,h[x]=p(T),x+=1}}let I=[];for(let v=0,A=x;v<A;++v){let _=g.get(y[v]);if(_){let T=_.map(w=>{let D=p(w);return D==="X"?w:D});I[v]=`(${T.join("|")})`}else I[v]=h[v]==="X"?f[v]:h[v]}this.length=x,this.code=H.ofStringArray(h),this.compId=H.ofStringArray(f),this.seqId=H.ofIntArray(y),this.label=H.ofStringArray(I),this.microHet=g,this.indexMap=S}index(c){return this.indexMap.get(c)}}function a(u,c){let m="generic";return new s(m,u,c)}l.ofSequenceRanges=a;class s{constructor(c,m,d){this.kind=c;this.seqIdStart=m;this.seqIdEnd=d;this.microHet=new Map;let p=0,h=Number.MAX_SAFE_INTEGER;for(let y=0,g=this.seqIdStart.rowCount;y<g;y++){let x=this.seqIdStart.value(y),S=this.seqIdEnd.value(y);x<h&&(h=x),p<S&&(p=S)}let f=p-h+1;this.code=H.ofConst("X",f,H.Schema.str),this.label=H.ofConst("",f,H.Schema.str),this.seqId=H.ofLambda({value:y=>y+h+1,rowCount:f,schema:H.Schema.int}),this.compId=H.ofConst("",f,H.Schema.str),this.length=f,this.minSeqId=h}index(c){return c-this.minSeqId}}})(Kv||={});var $M;(a=>{let e={byEntityKey:{},sequences:[]};function t(...s){let l=[],u={};for(let c=0,m=s.length;c<m;++c)l.push(...s[c].sequences),Object.assign(u,s[c].byEntityKey);return{sequences:l,byEntityKey:u}}function r(s,l,u){let c=n(s,l),m=u.isDefined?o(s,u):e;return t(c,m)}a.fromHierarchy=r;function n(s,l){let{label_comp_id:u}=l.atoms,{label_seq_id:c}=l.residues,{chainAtomSegments:m,residueAtomSegments:d}=l,{count:p,offsets:h}=m,f={},y=[];if(p===1&&h[0]===0&&h[1]===0)return{byEntityKey:f,sequences:y};for(let g=0,x=l.chains._rowCount;g<x;g++){let S=l.index.getEntityFromChain(g);if(f[S]!==void 0||s.data.type.value(S)!=="polymer")continue;let I=g;for(g++;g<x&&S===l.index.getEntityFromChain(g)&&s.data.type.value(S)!=="polymer";)g++;g--;let v=d.index[h[I]],A=d.index[h[g+1]-1]+1,_=H.window(c,v,A),T=[];for(let D=v;D<A;++D)T.push(u.value(d.offsets[D]));let w=H.ofStringArray(T);f[S]={entityId:s.data.id.value(S),sequence:Kv.ofResidueNames(w,_)},y.push(f[S])}return{byEntityKey:f,sequences:y}}a.fromAtomicHierarchy=n;function o(s,l){let u=i(s,l.spheres),c=i(s,l.gaussians);return t(u,c)}a.fromCoarseHierarchy=o;function i(s,l){let{chainElementSegments:u,seq_id_begin:c,seq_id_end:m}=l,{count:d,offsets:p}=u,h={},f=[];if(d===1&&p[0]===0&&p[1]===0)return{byEntityKey:h,sequences:f};for(let y=0,g=d;y<g;y++){let x=l.getEntityFromChain(y);if(h[x]!==void 0)continue;let S=y;for(y++;y<g&&x===l.getEntityFromChain(y);)y++;y--;let I=p[S],v=p[y+1]-1,A=H.window(c,I,v),_=H.window(m,I,v);h[x]={entityId:s.data.id.value(x),sequence:Kv.ofSequenceRanges(A,_)},f.push(h[x])}return{byEntityKey:h,sequences:f}}a.fromCoarseElements=i})($M||={});function QH(e,t,r,n){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return $M.fromHierarchy(t,r,n);let{entity_id:o,num:i,mon_id:a}=e.entity_poly_seq,s={},l=[],u=o.rowCount,c=0;for(;c<u;){let m=c;for(;c<u-1&&o.areValuesEqual(c,c+1);)c++;c++;let d=o.value(m),p=H.window(a,m,c),h=H.window(i,m,c),f=t.getEntityIndex(d);s[f]={entityId:d,sequence:Kv.ofResidueNames(p,h)},l.push(s[f])}return{byEntityKey:s,sequences:l}}async function ZH(e,t,r,n){let o=BP(r,n-1),{label_entity_id:i,label_asym_id:a,label_seq_id:s}=t,l=dw(o,i.value);e.shouldUpdate&&await e.update();for(let u=0,c=l.length-1;u<c;u++){let m=dw(o,a.value,{start:l[u],end:l[u+1]});for(let d=0,p=m.length-1;d<p;d++){let h=m[d];s.valueKind(h)===H.ValueKinds.Present&&(dw(o,s.value,{sort:!0,start:h,end:m[d+1]}),e.shouldUpdate&&await e.update())}e.shouldUpdate&&await e.update()}return SY(o)&&o.length===t._rowCount?{atom_site:t,sourceIndex:H.ofIntArray(o)}:{atom_site:Cr.view(t,t._schema,o),sourceIndex:H.ofIntArray(o)}}function Rce(e,t,r,n,o){let{polymerType:i,traceElementIndex:a,directionFromElementIndex:s,directionToElementIndex:l}=o.residue,u=i[e],c=i[t];if(u===0||c===0||a[e]===-1||a[t]===-1)return!1;let m=n.findAtomsOnResidue(e,gh(u,"backboneStart")),d=n.findAtomsOnResidue(t,gh(c,"backboneEnd"));(m===-1||d===-1)&&(m=n.findAtomsOnResidue(e,gh(u,"coarseBackbone")),d=n.findAtomsOnResidue(t,gh(c,"coarseBackbone")));let{x:p,y:h,z:f}=r,y=b.create(p[m],h[m],f[m]),g=b.create(p[d],h[d],f[d]),x=s[e]===-1||l[e]===-1||s[t]===-1||l[t]===-1;return b.distance(y,g)<(x?10:3)}function qH(e,t,r,n){let o=[],i=[],a=new Map,s=Xt.transientSegments(e.chainAtomSegments,xe.ofBounds(0,e.atoms._rowCount)),l=Xt.transientSegments(e.residueAtomSegments,xe.ofBounds(0,e.atoms._rowCount)),{index:u,derived:c}=e,{label_seq_id:m}=e.residues,{label_entity_id:d}=e.chains,{moleculeType:p,traceElementIndex:h}=c.residue,f,y,g,x;for(;s.hasNext;){let S=s.move();l.setSegment(S),f=-1,y=-1,g=-1,x=-1;let I=t.getEntityIndex(d.value(S.index)),v=n.byEntityKey[I],A=v?v.sequence.seqId.value(v.sequence.seqId.rowCount-1):-1,_=e.residueAtomSegments.index[S.start],T=e.residueAtomSegments.index[S.end-1],w=m.value(_),D=m.value(T);for(w===1&&D===A&&r.xyzDefined&&Rce(_,T,r,u,c)&&(a.set(_,T),a.set(T,_));l.hasNext;){let M=l.move(),E=M.index,R=m.value(E);if(tx(p[E])&&h[E]!==-1)if(x!==-1)if(R!==f+1)o.push(x,g-1),i.push(y,M.end-1),x=M.start;else if(!l.hasNext)o.push(x,M.end-1);else{let k=e.residueAtomSegments.index[M.start],B=e.residueAtomSegments.index[g-1];r.xyzDefined&&!Rce(k,B,r,e.index,c)&&(o.push(x,g-1),i.push(y,M.end-1),x=M.start)}else x=M.start;else x!==-1&&(o.push(x,g-1),x=-1);y=M.start,g=M.end,f=R}}return{polymerRanges:kn.ofSortedRanges(o),gapRanges:kn.ofSortedRanges(i),cyclicPolymerMap:a}}function Dce(e){let t=new Map,r=(o,i,a)=>`${o}|${i}|${a}`,n=e.pdbx_unobs_or_zero_occ_residues;for(let o=0,i=n._rowCount;o<i;++o){let a=r(n.PDB_model_num.value(o),n.label_asym_id.value(o),n.label_seq_id.value(o));t.set(a,{polymer_flag:n.polymer_flag.value(o),occupancy_flag:n.occupancy_flag.value(o)})}return{has:(o,i,a)=>t.has(r(o,i,a)),get:(o,i,a)=>t.get(r(o,i,a)),size:t.size}}function wce(e){let t=new Map;if(e.chem_comp._rowCount>0){let{id:r}=e.chem_comp;for(let n=0,o=r.rowCount;n<o;++n)t.set(r.value(n),Cr.getRow(e.chem_comp,n))}else Mce(e).forEach(n=>{t.set(n,Ese(n))});return t}function Ece(e){let t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0){let{comp_id:r,type:n,identifier:o}=e.pdbx_chem_comp_identifier;for(let i=0,a=r.rowCount;i<a;++i)if(n.value(i)==="SNFG CARBOHYDRATE SYMBOL"||n.value(i)==="SNFG CARB SYMBOL"){let s=o.value(i),l=mse.get(s);l?t.set(r.value(i),l):console.warn(`Unknown SNFG name '${s}'`)}}if(e.chem_comp._rowCount>0){let{id:r,type:n}=e.chem_comp;for(let o=0,i=r.rowCount;o<i;++o){let a=r.value(o);if(t.has(a))continue;let s=n.value(o);zd.has(a)?t.set(a,zd.get(a)):Tl(s,a)===9&&t.set(a,oM)}}else{let r=Mce(e);zd.forEach((n,o)=>{!t.has(o)&&r.has(o)&&t.set(o,n)})}return t}var Mce=af(e=>{let t=new Set,{label_comp_id:r,auth_comp_id:n}=e.atom_site,o=r.isDefined?r:n;for(let i=0,a=o.rowCount;i<a;++i)t.add(o.value(i));return t});function YH(e,t){let r=new Map,{auth_asym_id:n,label_asym_id:o,label_entity_id:i}=e.chains;for(let a=0,s=e.chains._rowCount;a<s;a++){let l=o.value(a);r.set(l,{id:l,auth_id:n.value(a),entity_id:i.value(a)})}if(t?.struct_asym._rowCount){let{id:a,entity_id:s}=t.struct_asym;for(let l=0,u=a.rowCount;l<u;++l){let c=a.value(l);r.has(c)||r.set(c,{id:c,auth_id:"",entity_id:s.value(l)})}}return r}var Bce=H.Schema.Aliased(H.Schema.Str());function KH(e){let t;if(e.entity.id.isDefined)t=e.entity;else{let s=new Set,l=[],u=[],{label_entity_id:c,label_comp_id:m}=e.atom_site;for(let h=0,f=e.atom_site._rowCount;h<f;h++){let y=c.value(h);s.has(y)||(l.push(y),u.push(Mse(m.value(h))),s.add(y))}let{entity_id:d}=e.ihm_sphere_obj_site;for(let h=0,f=e.ihm_sphere_obj_site._rowCount;h<f;h++){let y=d.value(h);s.has(y)||(l.push(y),u.push("polymer"),s.add(y))}let{entity_id:p}=e.ihm_gaussian_obj_site;for(let h=0,f=e.ihm_gaussian_obj_site._rowCount;h<f;h++){let y=p.value(h);s.has(y)||(l.push(y),u.push("polymer"),s.add(y))}t=Cr.ofPartialColumns(Co.entity,{id:H.ofArray({array:l,schema:Co.entity.id}),type:H.ofArray({array:u,schema:Co.entity.type})},l.length)}let r=H.createIndexer(t.id),n=new Array(t._rowCount);n.fill("other");let o=new Set,i=!1;if(e.entity_poly&&e.entity_poly.type.isDefined){let{entity_id:s,type:l,_rowCount:u}=e.entity_poly;for(let c=0;c<u;++c){let m=s.value(c);n[r(m)]=l.value(c),o.add(m)}}else i=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined){let{entity_id:s,type:l,_rowCount:u}=e.pdbx_entity_branch;for(let c=0;c<u;++c){let m=s.value(c);n[r(m)]=l.value(c),o.add(m)}}else i=!0;if(o.size<n.length&&(i=!0),i){let s=new Map;if(e.chem_comp){let{id:l,type:u}=e.chem_comp;for(let c=0,m=e.chem_comp._rowCount;c<m;c++)s.set(l.value(c),u.value(c))}if(e.atom_site){let{label_entity_id:l,label_comp_id:u}=e.atom_site;for(let c=0,m=e.atom_site._rowCount;c<m;c++){let d=l.value(c);if(!o.has(d)){let p=u.value(c),h=s.get(p)||"other";n[r(d)]=Bse(p,h),o.add(d)}}}}let a=H.ofArray({array:n,schema:Bce});return{data:t,subtype:a,getEntityIndex:r}}function JH(e,t,r){if(!e.pdbx_molecule||!e.pdbx_molecule.prd_id.isDefined)return t;let n=new Array(t.data._rowCount);n.fill("");let{asym_id:o,prd_id:i,_rowCount:a}=e.pdbx_molecule;for(let l=0;l<a;++l){let u=o.value(l),c=r.get(u)?.entity_id;c!==void 0&&(n[t.getEntityIndex(c)]=i.value(l))}let s=H.ofArray({array:n,schema:H.Schema.str});return{...t,prd_id:s}}var cl=class{constructor(t){this.frames=t;this.frameCount=t.length,this.representative=t[0],this.duration=t.length}getFrameAtIndex(t){return this.frames[t]}};async function Fa(e,t,r){let n=Q6e(e,t),o=e.ihm_model_list._rowCount>0?await K6e(r,e,n,t):await Y6e(r,e,n,t);for(let i=0;i<o.length;i++)Ft.TrajectoryInfo.set(o[i],{index:i,size:o.length});return new cl(o)}function Q6e(e,t){return{missingResidues:Dce(e),chemicalComponentMap:wce(e),saccharideComponentMap:Ece(e)}}function Z6e(e,t,r,n,o,i,a){let s=VH(t,r,n,o.chemicalComponentMap,i,a),l=t.pdbx_PDB_model_num.value(0);if(a&&s.sameAsPrevious)return{...a,id:en.create22(),modelNum:l,atomicConformation:s.conformation,_dynamicPropertyData:Object.create(null)};let u=HH,c=QH(e,n,s.hierarchy,u.hierarchy),m=qH(s.hierarchy,n,s.conformation,c),d=YH(s.hierarchy),p=e.entry.id.valueKind(0)===H.ValueKinds.Present?e.entry.id.value(0):i.name,h=[];return p&&h.push(p),e.struct.title.valueKind(0)===H.ValueKinds.Present&&h.push(e.struct.title.value(0)),{id:en.create22(),entryId:p,label:h.join(" | "),entry:p,sourceData:i,modelNum:l,parent:void 0,entities:JH(e,n,d),sequence:c,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:m,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:u.hierarchy,coarseConformation:u.conformation,properties:{...o,structAsymMap:d},customProperties:new ka,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function q6e(e,t,r,n){let o=VH(t.atom_site,t.atom_site_sourceIndex,t.entities,r.chemicalComponentMap,n),i=_ce(t,r.chemicalComponentMap),a=QH(e,t.entities,o.hierarchy,i.hierarchy),s=qH(o.hierarchy,t.entities,o.conformation,a),l=e.entry.id.valueKind(0)===H.ValueKinds.Present?e.entry.id.value(0):n.name,u=[];l&&u.push(l),e.struct.title.valueKind(0)===H.ValueKinds.Present&&u.push(e.struct.title.value(0)),t.model_name&&u.push(t.model_name),t.model_group_name&&u.push(t.model_group_name);let c=YH(o.hierarchy,e);return{id:en.create22(),entryId:l,label:u.join(" | "),entry:l,sourceData:n,modelNum:t.model_id,parent:void 0,entities:JH(e,t.entities,c),sequence:a,atomicHierarchy:o.hierarchy,atomicConformation:o.conformation,atomicRanges:s,atomicChainOperatorMappinng:o.chainOperatorMapping,coarseHierarchy:i.hierarchy,coarseConformation:i.conformation,properties:{...r,structAsymMap:c},customProperties:new ka,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function kce(e,t){let r=e.rowCount;if(!e.isDefined)return r;let n=t+1;for(;n<r&&e.areValuesEqual(t,n);)n++;return n}async function Y6e(e,t,r,n){let o=[];if(t.atom_site){let i=t.atom_site.id.rowCount,a=KH(t),s=0;for(;s<i;){let l=kce(t.atom_site.pdbx_PDB_model_num,s),{atom_site:u,sourceIndex:c}=await ZH(e,t.atom_site,s,l),m=Z6e(t,u,c,a,r,n,o.length>0?o[o.length-1]:void 0);o.push(m),s=l}}return o}function $H(e,t){let r=new Map,n=e._rowCount,o=0;for(;o<n;){let i=kce(t,o),a=t.value(o);r.set(a,{table:Cr.window(e,e._schema,o,i),start:o,end:i}),o=i}return r}async function K6e(e,t,r,n){let o=KH(t),i=t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num,a=$H(t.atom_site,i),s=$H(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),l=$H(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),u=[];if(t.ihm_model_list){let{model_id:c,model_name:m}=t.ihm_model_list;for(let d=0;d<t.ihm_model_list._rowCount;d++){let p=c.value(d),h,f;if(a.has(p)){let x=a.get(p),{atom_site:S,sourceIndex:I}=await ZH(e,t.atom_site,x.start,x.end);h=S,f=I}else h=Cr.window(t.atom_site,t.atom_site._schema,0,0),f=H.ofIntArray([]);let y={model_id:p,model_name:m.value(d),model_group_name:lce(p,t),entities:o,atom_site:h,atom_site_sourceIndex:f,ihm_sphere_obj_site:s.has(p)?s.get(p).table:Cr.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:l.has(p)?l.get(p).table:Cr.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},g=q6e(t,y,r,n);u.push(g)}}return u}var Ft;(ie=>{function e(oe,W){let N=[],{frames:j}=W,ue=t(oe),be=_(oe),ee=oe.atomicHierarchy.atoms._rowCount;for(let le=0,Ae=j.length;le<Ae;++le){let Ce=j[le];if(Ce.elementCount!==ee)throw new Error(`Frame element count mismatch, got ${Ce.elementCount} but expected ${ee}.`);let J={...oe,id:en.create22(),modelNum:le,atomicConformation:o(oe,Ce),customProperties:new ka,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)};if(Ce.cell){let z=wo.fromCell(Ce.cell.size,Ce.cell.anglesInRadians);wo.Provider.set(J,z)}ie.TrajectoryInfo.set(J,{index:le,size:j.length}),ie.CoarseGrained.set(J,be),N.push(J)}return{trajectory:N,srcIndexArray:ue}}function t(oe){let W=oe.atomicHierarchy.atomSourceIndex,N;return"__srcIndexArray__"in oe._staticPropertyData?N=oe._dynamicPropertyData.__srcIndexArray__:(N=H.isIdentity(W)?void 0:W.toArray({array:Int32Array}),oe._dynamicPropertyData.__srcIndexArray__=N),N}function r(oe,W){return new cl(e(oe,W).trajectory)}ie.trajectoryFromModelAndCoordinates=r;function n(oe,W){return Pe.create("Create Trajectory",async N=>{let j=await Fa(oe.basic,oe.sourceData,N);if(j.frameCount===0)throw new Error("found no model");let ue=j.representative,{trajectory:be}=e(ue,W),ee={pairs:oe.bonds,count:ue.atomicHierarchy.atoms._rowCount},le=Do.fromData(ee),Ae=_(ue),Ce=0;for(let J of be)Do.Provider.set(J,le),ie.TrajectoryInfo.set(J,{index:Ce++,size:be.length}),ie.CoarseGrained.set(J,Ae);return new cl(be)})}ie.trajectoryFromTopologyAndCoordinates=n;function o(oe,W){return qm.getAtomicConformation(W,{atomId:oe.atomicConformation.atomId,occupancy:oe.atomicConformation.occupancy,B_iso_or_equiv:oe.atomicConformation.B_iso_or_equiv},t(oe))}ie.getAtomicConformationFromFrame=o;let i="__Center__";function a(oe){if(oe._dynamicPropertyData[i])return oe._dynamicPropertyData[i];let W=sse(oe.atomicConformation,oe.coarseConformation);return oe._dynamicPropertyData[i]=W,W}ie.getCenter=a;function s(oe){let W=new Int32Array(oe.rowCount),N=!1;for(let j=0,ue=oe.rowCount;j<ue;j++){let be=oe.value(j);be!==j&&(N=!1),W[be]=j}return{isIdentity:N,invertedIndex:W}}let l="__InvertedAtomSrcIndex__";function u(oe){if(oe._staticPropertyData[l])return oe._staticPropertyData[l];let W=s(oe.atomicHierarchy.atomSourceIndex);return oe._staticPropertyData[l]=W,W}ie.getInvertedAtomSourceIndex=u;let c="__TrajectoryInfo__";ie.TrajectoryInfo={get(oe){return oe._dynamicPropertyData[c]||{index:0,size:1}},set(oe,W){return oe._dynamicPropertyData[c]=W}};let d="__AsymIdCount__";ie.AsymIdCount={get(oe){if(oe._dynamicPropertyData[d])return oe._dynamicPropertyData[d];let W=lse(oe);return oe._dynamicPropertyData[d]=W,W}},ie.AsymIdOffset=ed.createSimple("asym_id_offset","static"),ie.Index=ed.createSimple("index","static"),ie.MaxIndex=ed.createSimple("max_index","static");function g(oe){return oe.parent||oe}ie.getRoot=g;function x(oe,W){return oe.atomicHierarchy===W.atomicHierarchy&&oe.coarseHierarchy===W.coarseHierarchy}ie.areHierarchiesEqual=x;let S="__CoordinatesHistory__";ie.CoordinatesHistory={get(oe){return oe._staticPropertyData[S]},set(oe,W){return oe._staticPropertyData[S]=W}};let v="__CoarseGrained__";ie.CoarseGrained={get(oe){return oe._staticPropertyData[v]},set(oe,W){return oe._staticPropertyData[v]=W}};function _(oe){let W=ie.CoarseGrained.get(oe);if(W===void 0){let N=0,j=0,{polymerType:ue,directionToElementIndex:be}=oe.atomicHierarchy.derived.residue;for(let J=0;J<ue.length;++J)ue[J]!==0&&(N+=1,be[J]!==-1&&(j+=1));let ee=!1,le=!1,{label_atom_id:Ae,_rowCount:Ce}=oe.atomicHierarchy.atoms;for(let J=0;J<Ce;++J){let z=Ae.value(J);if(!ee&&z==="BB"&&(ee=!0),!le&&z==="SC1"&&(le=!0),ee&&le)break}W=!1,Ce>0&&N>0&&(ee&&le||Ce/N<3||j===0)&&(W=!0),ie.CoarseGrained.set(oe,W)}return W}ie.isCoarseGrained=_;function T(oe){return oe.properties.saccharideComponentMap.size>0}ie.hasCarbohydrate=T;function w(oe){let{subtype:W}=oe.entities;for(let N=0,j=W.rowCount;N<j;++N)if(W.value(N).startsWith("polypeptide"))return!0;return!1}ie.hasProtein=w;function D(oe){let{subtype:W}=oe.entities;for(let N=0,j=W.rowCount;N<j;++N){let ue=W.value(N);if(ue.endsWith("ribonucleotide hybrid")||ue.endsWith("ribonucleotide"))return!0}return!1}ie.hasNucleic=D;function M(oe){if(!Cn.is(oe.sourceData))return!1;let{db:W}=oe.sourceData.data;for(let N=0,j=W.database_2.database_id.rowCount;N<j;++N)if(W.database_2.database_id.value(N)==="pdb")return!0;return!1}ie.isFromPdbArchive=M;function E(oe){return Cn.is(oe.sourceData)?oe.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)!==null||oe.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i)!==null:!1}ie.hasPdbId=E;function R(oe){if(Cn.is(oe.sourceData)){let{db:W}=oe.sourceData.data;return W.struct_conf.id.isDefined||W.struct_sheet_range.id.isDefined}else return yh.Provider.isApplicable(oe)}ie.hasSecondaryStructure=R;let k=b.create(1.5707963,1.5707963,1.5707963),B=b.create(1,1,1);function L(oe){let W=wo.Provider.get(oe)?.spacegroup;return!!W&&!(W.num===1&&b.equals(W.cell.anglesInRadians,k)&&b.equals(W.cell.size,B))}ie.hasCrystalSymmetry=L;function V(oe){if(!Cn.is(oe.sourceData))return!1;let{db:W}=oe.sourceData.data;for(let N=0;N<W.exptl.method.rowCount;N++)if(W.exptl.method.value(N).toUpperCase().indexOf("DIFFRACTION")>=0)return!0;return!1}ie.isFromXray=V;function U(oe){if(!Cn.is(oe.sourceData))return!1;let{db:W}=oe.sourceData.data;for(let N=0;N<W.exptl.method.rowCount;N++)if(W.exptl.method.value(N).toUpperCase().indexOf("MICROSCOPY")>=0)return!0;return!1}ie.isFromEm=U;function Q(oe){if(!Cn.is(oe.sourceData))return!1;let{db:W}=oe.sourceData.data;for(let N=0;N<W.exptl.method.rowCount;N++)if(W.exptl.method.value(N).toUpperCase().indexOf("NMR")>=0)return!0;return!1}ie.isFromNmr=Q;function O(oe){if(!Cn.is(oe.sourceData))return!1;let{db:W}=oe.sourceData.data;for(let N=0;N<W.struct.pdbx_structure_determination_methodology.rowCount;N++)if(W.struct.pdbx_structure_determination_methodology.value(N).toLowerCase()==="experimental")return!0;return!1}ie.isExperimental=O;function q(oe){if(!Cn.is(oe.sourceData))return!1;let{db:W}=oe.sourceData.data;for(let N=0;N<W.struct.pdbx_structure_determination_methodology.rowCount;N++)if(W.struct.pdbx_structure_determination_methodology.value(N).toLowerCase()==="integrative")return!0;return!1}ie.isIntegrative=q;function X(oe){if(!Cn.is(oe.sourceData))return!1;let{db:W}=oe.sourceData.data;for(let N=0;N<W.struct.pdbx_structure_determination_methodology.rowCount;N++)if(W.struct.pdbx_structure_determination_methodology.value(N).toLowerCase()==="computational")return!0;return!1}ie.isComputational=X;function F(oe){if(!Cn.is(oe.sourceData)||!V(oe))return!1;let{db:W}=oe.sourceData.data,{status_code_sf:N}=W.pdbx_database_status;return N.isDefined&&N.value(0)==="REL"}ie.hasXrayMap=F;function Y(oe){if(!Cn.is(oe.sourceData))return!1;let{db:W}=oe.sourceData.data,{db_name:N,content_type:j}=W.pdbx_database_related;for(let ue=0,be=W.pdbx_database_related._rowCount;ue<be;++ue)if(N.value(ue).toUpperCase()==="EMDB"&&j.value(ue)==="associated EM volume")return!0;return!1}ie.hasEmMap=Y;function $(oe){return Cn.is(oe.sourceData)?F(oe)||Y(oe):!1}ie.hasDensityMap=$;function ce(oe){if(!Cn.is(oe.sourceData)||ie.isIntegrative(oe))return!1;let{db:W}=oe.sourceData.data;return $(oe)||E(oe)&&(!W.exptl.method.isDefined||V(oe)&&(!W.pdbx_database_status.status_code_sf.isDefined||W.pdbx_database_status.status_code_sf.valueKind(0)===H.ValueKinds.Unknown)||U(oe)&&!W.pdbx_database_related.db_name.isDefined)}ie.probablyHasDensityMap=ce})(Ft||={});var J6e;(c=>{function e(m,d,p){if(!d)return{rowCount:0};if(p&&p[d.id])return p[d.id];let h=d.getElements(m),f={data:h,rowCount:h.elements.length};return p&&(p[d.id]=f),f}c.getCifDataSource=e;function t(m){return new eB(m)}c.fromAtomMap=t;function r(m){return new eB(e6(m))}c.fromAtomArray=r;let n=m=>m.atomicHierarchy.residueAtomSegments;function o(m){return new Jv("residue",m,n,me.Kind.Atomic)}c.fromResidueMap=o;function i(m){return new Jv("residue",e6(m),n,me.Kind.Atomic)}c.fromResidueArray=i;let a=m=>m.atomicHierarchy.chainAtomSegments;function s(m){return new Jv("chain",m,a,me.Kind.Atomic)}c.fromChainMap=s;function l(m){return new Jv("chain",e6(m),a,me.Kind.Atomic)}c.fromChainArray=l;function u(m){return new t6(m)}c.fromEntityMap=u})(J6e||={});function e6(e){let t=new Map;for(let r=0,n=e.length;r<n;r++)t.set(r,e[r]);return t}var Jv=class{constructor(t,r,n,o){this.level=t;this.map=r;this.segmentGetter=n;this.id=en.create22();this.kind=o}has(t){return this.map.has(t)}get(t){return this.map.get(t)}getStructureElements(t){let r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");let n=new Set,o=t.unitSymmetryGroups,i=[],a=this.segmentGetter(r[0]);for(let s of o){let l=s.units[0];if(l.kind!==this.kind)continue;let u=Xt.transientSegments(a,l.elements);for(;u.hasNext;){let c=u.move();!this.has(c.index)||n.has(c.index)||(n.add(c.index),i[i.length]=K.Location.create(t,l,l.elements[c.start]))}}return i.sort((s,l)=>s.element-l.element),i}getElements(t){let r=this.segmentGetter(t.model).index,n=this.getStructureElements(t);return{elements:n,property:o=>this.get(r[n[o].element])}}},eB=class{constructor(t){this.map=t;this.id=en.create22();this.level="atom";this.kind=me.Kind.Atomic}has(t){return this.map.has(t)}get(t){return this.map.get(t)}getStructureElements(t){if(t.models.length!==1)throw new Error("Only works on structures with a single model.");let n=new Set,o=t.unitSymmetryGroups,i=[];for(let a of o){let s=a.units[0];if(s.kind!==this.kind)continue;let l=s.elements;for(let u=0,c=l.length;u<c;u++){let m=l[u];!this.has(m)||n.has(m)||(n.add(l[u]),i[i.length]=K.Location.create(t,s,m))}}return i.sort((a,s)=>a.element-s.element),i}getElements(t){let r=this.getStructureElements(t);return{elements:r,property:n=>this.get(r[n].element)}}},t6=class{constructor(t){this.map=t;this.id=en.create22();this.level="entity";this.kind=me.Kind.Atomic}has(t){return this.map.has(t)}get(t){return this.map.get(t)}getStructureElements(t){let r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");let n=r[0].atomicHierarchy.index,o=new Set,i=t.unitSymmetryGroups,a=[],s=r[0].atomicHierarchy.chainAtomSegments;for(let l of i){let u=l.units[0];if(u.kind!==this.kind)continue;let c=Xt.transientSegments(s,u.elements);for(;c.hasNext;){let m=c.move(),d=n.getEntityFromChain(m.index);!this.has(d)||o.has(d)||(o.add(d),a[a.length]=K.Location.create(t,u,u.elements[m.start]))}}return a.sort((l,u)=>l.element-u.element),a}getElements(t){let r=this.getStructureElements(t),n=t.model.atomicHierarchy.chainAtomSegments.index,o=t.model.atomicHierarchy.index;return{elements:r,property:i=>this.get(o.getEntityFromChain(n[r[i].element]))}}};function r_(e){return C.Converted(Lce,$6e,C.Text(Lce(null),{...e,disableInteractiveUpdates:!0,placeholder:e?.placeholder??"null"}))}function $6e(e){let t=parseFloat(e);return isNaN(t)?null:t}function Lce(e){return e===null?"":e.toString()}function r6(e){return C.Converted(Fce,e7e,C.Text(Fce(null),{...e,placeholder:e?.placeholder??"null"}))}function e7e(e){return e===""?null:e}function Fce(e){return e===null?"":e}async function Oce(e){try{return{ok:!0,value:await e}}catch(t){return{ok:!1,error:t}}}var uy=class{constructor(){this._map=new Map}get(t){return this._map.get(t)}add(t,r){this._map.has(t)||this._map.set(t,[]),this._map.get(t).push(r)}},n_=class{constructor(t){this.limit=t;this.array=new Array(t),this.map=new Map}get(t){return 0<=t&&t<this.limit?this.array[t]:this.map.get(t)}set(t,r){0<=t&&t<this.limit?this.array[t]=r:this.map.set(t,r)}};function rn(e){return e!=null}function o_(...e){return e.some(rn)}function tB(e){return e.filter(t=>t!=null)}function Vce(e){return(KC(e)>>>0).toString(16).padStart(8,"0")}function rB(e){let t=e.split("").reverse().join("");return Vce(e)+Vce(t)}function Eo(e){return pE(e)}var t7e=/^#([0-9A-F]{3}){1,2}$/i,Gce={is(e){return typeof e=="string"&&t7e.test(e)}},Uce={is(e){return e in Lt}};function Nce(e,t){let r={};for(let n of Object.keys(t)){let o=t[n],i=!1;for(let a of e)if(a.is(o)){i=!0;break}if(!(!i||!o.tags)){for(let a of o.tags)if(a.startsWith("mvs-ref:")){r[a.substring(8)]=o.data;break}}}return r}var fx=class{constructor(t,r){this.defaultValue=r,this.options=Object.keys(t).map(n=>[n,t[n]]),this.nameDict=t}PDSelect(t,r){return C.Select(t??this.defaultValue,this.options,r)}prettyName(t){return this.nameDict[t]}get values(){return this.options.map(([t,r])=>t)}};var Va={count(e){return e.from.length},empty(){return{from:[],to:[]}},single(e,t){return{from:[e],to:[t]}},add(e,t,r){let n=Va.count(e);if(n>0){let o=e.to[n-1];if(t<o)throw new Error("Overlapping ranges not allowed");t===o?e.to[n-1]=r:(e.from.push(t),e.to.push(r))}else e.from.push(t),e.to.push(r);return e},foreach(e,t){let r=Va.count(e);for(let n=0;n<r;n++)t(e.from[n],e.to[n])},map(e,t){let r=Va.count(e),n=new Array(r);for(let o=0;o<r;o++)n[o]=t(e.from[o],e.to[o]);return n},union(e){let t=Va.empty();for(let i of e)ib(t.from,i.from),ib(t.to,i.to);let r=Rm(t.from.length).sort((i,a)=>t.from[i]-t.from[a]),n=Va.empty(),o=-1;for(let i of r){let a=t.from[i],s=t.to[i];o>=0&&a<=n.to[o]?s>n.to[o]&&(n.to[o]=s):(n.from.push(a),n.to.push(s),o++)}return n},selectAtomsInRanges(e,t,r,n={}){r??=[],r.length=0,n.value=void 0;let o=e.length,i=Va.count(t);if(o<=i){let a=Be.findPredecessorIndex(Be.ofSortedArray(t.to),e[0]+1);for(let s=0;s<o;s++){let l=e[s];for(;a<i&&t.to[a]<=l;)a++;a<i&&t.from[a]<=l&&(r.push(l),n.value??=s)}}else for(let a=0;a<i;a++){let s=t.from[a],l=t.to[a];for(let u=Be.findPredecessorIndex(e,s);u<o;u++){let c=e[u];if(c<l)r.push(c),n.value??=u;else break}}return r}};var i_={get(e){return e._dynamicPropertyData["indices-and-sortings"]??=i_.create(e)},create(e){let t=e.atomicHierarchy,r=t.atoms._rowCount,n=t.chains._rowCount,{label_entity_id:o,label_asym_id:i,auth_asym_id:a}=t.chains,{label_seq_id:s,auth_seq_id:l,pdbx_PDB_ins_code:u}=t.residues,{label_comp_id:c,auth_comp_id:m}=t.atoms,{Present:d}=H.ValueKind,p=new uy,h=new uy,f=new uy,y=new Map,g=new Map,x=new Map,S=new Map,I=!0,v=new Map,A=!0,_=new n_(r+1),T=new n_(r),w=new Set,D=new Set;for(let R=0;R<n;R++){p.add(o.value(R),R),h.add(i.value(R),R),f.add(a.value(R),R);let k=t.residueAtomSegments.index[t.chainAtomSegments.offsets[R]],B=t.residueAtomSegments.index[t.chainAtomSegments.offsets[R+1]-1]+1,L=Rg(Rm(k,B),q=>s.valueKind(q)===d);y.set(R,hx.create(L,s.value));let V=Rg(Rm(k,B),q=>l.valueKind(q)===d);g.set(R,hx.create(V,l.value));let U=new uy,Q=new uy,O=new uy;for(let q=k;q<B;q++){u.valueKind(q)===d&&U.add(u.value(q),q);let X=t.residueAtomSegments.offsets[q],F=t.residueAtomSegments.offsets[q+1];for(let Y=X;Y<F;Y++)w.add(c.value(Y)),D.add(m.value(Y));w.size>1&&(I=!1),D.size>1&&(A=!1);for(let Y of w)Q.add(Y,q);for(let Y of D)O.add(Y,q);w.clear(),D.clear()}x.set(R,U),S.set(R,Q),v.set(R,O)}let M=e.atomicConformation.atomId.value,E=t.atomSourceIndex.value;for(let R=0;R<r;R++)_.set(M(R),R),T.set(E(R),R);return{chainsByLabelEntityId:p,chainsByLabelAsymId:h,chainsByAuthAsymId:f,residuesSortedByLabelSeqId:y,residuesSortedByAuthSeqId:g,residuesByInsCode:x,residuesByLabelCompId:S,residuesByLabelCompIdIsPure:I,residuesByAuthCompId:v,residuesByAuthCompIdIsPure:A,atomsById:_,atomsByIndex:T}}},hx={create(e,t){vY(e,(n,o)=>t(n)-t(o)||n-o);let r=Be.ofSortedArray(e.map(t));return{keys:e,values:r}},getKeysWithValue(e,t){return hx.getKeysWithValueInRange(e,t,t)},getKeysWithValueInRange(e,t,r){let{keys:n,values:o}=e;if(!n)return[];let i=n.length,a=t!==void 0?Be.findPredecessorIndex(o,t):0,s;if(r!==void 0)for(s=a;s<i&&o[s]<=r;)s++;else s=i;return n.slice(a,s)}};var{str:uf,int:gx}=H.Schema,zce=new fx({whole_structure:"Whole Structure",entity:"Entity",chain:"Chain (label*)",auth_chain:"Chain (auth*)",residue:"Residue (label*)",auth_residue:"Residue (auth*)",residue_range:"Residue range (label*)",auth_residue_range:"Residue range (auth*)",atom:"Atom (label*)",auth_atom:"Atom (auth*)",all_atomic:"All atomic selectors"},"all_atomic");function n6(e){return rc(Hce,r7e[e])}var Hce={group_id:uf,label_entity_id:uf,label_asym_id:uf,auth_asym_id:uf,label_seq_id:gx,auth_seq_id:gx,pdbx_PDB_ins_code:uf,beg_label_seq_id:gx,end_label_seq_id:gx,beg_auth_seq_id:gx,end_auth_seq_id:gx,label_comp_id:uf,auth_comp_id:uf,label_atom_id:uf,auth_atom_id:uf,type_symbol:uf,atom_id:gx,atom_index:gx,instance_id:uf},r7e={whole_structure:["group_id"],entity:["group_id","label_entity_id"],chain:["group_id","label_entity_id","label_asym_id"],auth_chain:["group_id","auth_asym_id"],residue:["group_id","label_entity_id","label_asym_id","label_seq_id"],auth_residue:["group_id","auth_asym_id","auth_seq_id","pdbx_PDB_ins_code"],residue_range:["group_id","label_entity_id","label_asym_id","beg_label_seq_id","end_label_seq_id"],auth_residue_range:["group_id","auth_asym_id","beg_auth_seq_id","end_auth_seq_id"],atom:["group_id","label_entity_id","label_asym_id","label_seq_id","label_atom_id","type_symbol","atom_id","atom_index"],auth_atom:["group_id","auth_asym_id","auth_seq_id","pdbx_PDB_ins_code","auth_atom_id","type_symbol","atom_id","atom_index"],all_atomic:Object.keys(Hce)};var $v=[];function o6(e,t,r,n){if(rn(e.instance_id)&&e.instance_id!==r)return Va.empty();let o=t.atomicHierarchy,i=o.atoms._rowCount,a=o_(e.atom_id,e.atom_index),s=o_(e.label_atom_id,e.auth_atom_id,e.type_symbol)||rn(e.label_comp_id)&&!n.residuesByLabelCompIdIsPure||rn(e.auth_comp_id)&&!n.residuesByAuthCompIdIsPure,l=o_(e.label_seq_id,e.auth_seq_id,e.pdbx_PDB_ins_code,e.beg_label_seq_id,e.end_label_seq_id,e.beg_auth_seq_id,e.end_auth_seq_id,e.label_comp_id,e.auth_comp_id),u=o_(e.label_asym_id,e.auth_asym_id,e.label_entity_id);if(a){let h=a7e(t,e,n);return h!==void 0?Va.single(h,h+1):Va.empty()}if(!u&&!l&&!s)return Va.single(0,i);let c=n7e(t,e,n);if(!l&&!s){let h=o.chainAtomSegments.offsets,f=Va.empty();for(let y of c)Va.add(f,h[y],h[y+1]);return f}let m=o7e(t,e,n,c);if(!s){let h=o.residueAtomSegments.offsets,f=Va.empty();for(let y of m)Va.add(f,h[y],h[y+1]);return f}let d=i7e(t,e,n,m),p=Va.empty();for(let h of d)Va.add(p,h,h+1);return p}function Wce(e,t,r,n){return Va.union(e.map(o=>o6(o,t,r,n)))}function n7e(e,t,r){let{auth_asym_id:n,label_entity_id:o,_rowCount:i}=e.atomicHierarchy.chains,a;return rn(t.label_asym_id)&&(a=r.chainsByLabelAsymId.get(t.label_asym_id)??$v),rn(t.auth_asym_id)&&(a?a=a.filter(s=>n.value(s)===t.auth_asym_id):a=r.chainsByAuthAsymId.get(t.auth_asym_id)??$v),rn(t.label_entity_id)&&(a?a=a.filter(s=>o.value(s)===t.label_entity_id):a=r.chainsByLabelEntityId.get(t.label_entity_id)??$v),a??=Rm(i),a}function o7e(e,t,r,n){let{label_seq_id:o,auth_seq_id:i,pdbx_PDB_ins_code:a}=e.atomicHierarchy.residues,{label_comp_id:s,auth_comp_id:l}=e.atomicHierarchy.atoms,{residueAtomSegments:u,chainAtomSegments:c}=e.atomicHierarchy,{Present:m}=H.ValueKind,d=[];for(let p of n){let h;if(rn(t.label_seq_id)){let f=r.residuesSortedByLabelSeqId.get(p);h=hx.getKeysWithValue(f,t.label_seq_id)}if(rn(t.auth_seq_id))if(h)h=h.filter(f=>i.valueKind(f)===m&&i.value(f)===t.auth_seq_id);else{let f=r.residuesSortedByAuthSeqId.get(p);h=hx.getKeysWithValue(f,t.auth_seq_id)}if(rn(t.pdbx_PDB_ins_code)&&(h?h=h.filter(f=>a.value(f)===t.pdbx_PDB_ins_code):h=r.residuesByInsCode.get(p).get(t.pdbx_PDB_ins_code)??$v),rn(t.beg_label_seq_id)||rn(t.end_label_seq_id))if(h)rn(t.beg_label_seq_id)&&(h=h.filter(f=>o.valueKind(f)===m&&o.value(f)>=t.beg_label_seq_id)),rn(t.end_label_seq_id)&&(h=h.filter(f=>o.valueKind(f)===m&&o.value(f)<=t.end_label_seq_id));else{let f=r.residuesSortedByLabelSeqId.get(p);h=hx.getKeysWithValueInRange(f,t.beg_label_seq_id,t.end_label_seq_id)}if(rn(t.beg_auth_seq_id)||rn(t.end_auth_seq_id))if(h)rn(t.beg_auth_seq_id)&&(h=h.filter(f=>i.valueKind(f)===m&&i.value(f)>=t.beg_auth_seq_id)),rn(t.end_auth_seq_id)&&(h=h.filter(f=>i.valueKind(f)===m&&i.value(f)<=t.end_auth_seq_id));else{let f=r.residuesSortedByAuthSeqId.get(p);h=hx.getKeysWithValueInRange(f,t.beg_auth_seq_id,t.end_auth_seq_id)}if(rn(t.label_comp_id)&&(h?r.residuesByLabelCompIdIsPure?h=h.filter(f=>s.value(u.offsets[f])===t.label_comp_id):h=h.filter(f=>{for(let y=u.offsets[f],g=u.offsets[f+1];y<g;y++)if(s.value(y)===t.label_comp_id)return!0}):h=r.residuesByLabelCompId.get(p).get(t.label_comp_id)??$v),rn(t.auth_comp_id)&&(h?r.residuesByAuthCompIdIsPure?h=h.filter(f=>l.value(u.offsets[f])===t.auth_comp_id):h=h.filter(f=>{for(let y=u.offsets[f],g=u.offsets[f+1];y<g;y++)if(l.value(y)===t.auth_comp_id)return!0}):h=r.residuesByAuthCompId.get(p).get(t.auth_comp_id)??$v),!h){let f=u.index[c.offsets[p]],y=u.index[c.offsets[p+1]-1]+1;h=Rm(f,y)}ib(d,h)}return d}function i7e(e,t,r,n){let{label_atom_id:o,auth_atom_id:i,type_symbol:a,label_comp_id:s,auth_comp_id:l}=e.atomicHierarchy.atoms,u=e.atomicHierarchy.residueAtomSegments.offsets,c=[];for(let m of n){let d=Rm(u[m],u[m+1]);rn(t.label_atom_id)&&Rg(d,p=>o.value(p)===t.label_atom_id),rn(t.auth_atom_id)&&Rg(d,p=>i.value(p)===t.auth_atom_id),rn(t.type_symbol)&&Rg(d,p=>a.value(p)===t.type_symbol?.toUpperCase()),rn(t.label_comp_id)&&!r.residuesByLabelCompIdIsPure&&Rg(d,p=>s.value(p)===t.label_comp_id),rn(t.auth_comp_id)&&!r.residuesByAuthCompIdIsPure&&Rg(d,p=>l.value(p)===t.auth_comp_id),ib(c,d)}return c}function a7e(e,t,r){let n;if(!rn(t.atom_id)&&!rn(t.atom_index))throw new Error("ArgumentError: at least one of row.atom_id, row.atom_index must be defined.");if(rn(t.atom_id)&&rn(t.atom_index)){let o=r.atomsById.get(t.atom_id),i=r.atomsByIndex.get(t.atom_index);if(o!==i)return;n=o}if(rn(t.atom_id)&&(n=r.atomsById.get(t.atom_id)),rn(t.atom_index)&&(n=r.atomsByIndex.get(t.atom_index)),n!==void 0&&s7e(e,n,t))return n}function s7e(e,t,r){let n=e.atomicHierarchy,o=n.chainAtomSegments.index[t],i=n.chains.label_asym_id.value(o),a=n.chains.auth_asym_id.value(o),s=n.chains.label_entity_id.value(o);if(!td(r.label_asym_id,i)||!td(r.auth_asym_id,a)||!td(r.label_entity_id,s))return!1;let l=n.residueAtomSegments.index[t],u=n.residues.label_seq_id.valueKind(l)===H.ValueKind.Present?n.residues.label_seq_id.value(l):void 0,c=n.residues.auth_seq_id.valueKind(l)===H.ValueKind.Present?n.residues.auth_seq_id.value(l):void 0,m=n.residues.pdbx_PDB_ins_code.value(l);if(!td(r.label_seq_id,u)||!td(r.auth_seq_id,c)||!td(r.pdbx_PDB_ins_code,m)||!jce(r.beg_label_seq_id,r.end_label_seq_id,u)||!jce(r.beg_auth_seq_id,r.end_auth_seq_id,c))return!1;let d=n.atoms.label_comp_id.value(t),p=n.atoms.auth_comp_id.value(t),h=n.atoms.label_atom_id.value(t),f=n.atoms.auth_atom_id.value(t),y=n.atoms.type_symbol.value(t),g=e.atomicConformation.atomId.value(t),x=n.atomSourceIndex.value(t);return!(!td(r.label_comp_id,d)||!td(r.auth_comp_id,p)||!td(r.label_atom_id,h)||!td(r.auth_atom_id,f)||!td(r.type_symbol?.toUpperCase(),y)||!td(r.atom_id,g)||!td(r.atom_index,x))}function td(e,t){return!rn(e)||t===e}function jce(e,t,r){return!(rn(e)&&(!rn(r)||r<e)||rn(t)&&(!rn(r)||r>t))}function nB(e){return K.Schema.toExpression(e)}function eI(e){return K.Schema.toExpression({items:e})}function Xce(e){let t=0,r=new Map,n=[];for(let a=0;a<e.length;a++){let s=e[a].group_id;if(!rn(s))n.push(t++);else{let l=r.get(s);l===void 0?(r.set(s,t),n.push(t),t++):n.push(l)}}let o=Rm(e.length).sort((a,s)=>n[a]-n[s]),i=[];for(let a=0;a<e.length;a++)(a===0||n[o[a]]!==n[o[a-1]])&&i.push(a);return i.push(o.length),{count:i.length-1,offsets:i,grouped:o}}var l7e=new fx({json:"json",cif:"cif",bcif:"bcif"},"json"),u7e={json:"string",cif:"string",bcif:"binary"},i6={annotations:C.ObjectList({source:C.MappedStatic("source-cif",{"source-cif":C.EmptyGroup(),url:C.Group({url:C.Text(""),format:l7e.PDSelect()})}),schema:zce.PDSelect(),cifBlock:C.MappedStatic("index",{index:C.Group({index:C.Numeric(0,{min:0,step:1},{description:"0-based index of the block"})}),header:C.Group({header:C.Text(void 0,{description:"Block header"})})},{description:"Specify which CIF block contains annotation data (only relevant when format=cif or format=bcif)"}),cifCategory:r6({placeholder:"Take first category",description:"Specify which CIF category contains annotation data (only relevant when format=cif or format=bcif)"}),fieldRemapping:C.ObjectList({standardName:C.Text("",{placeholder:" ",description:"Standard name of the selector field (e.g. label_asym_id)"}),actualName:r6({placeholder:"Ignore field",description:"Actual name of the field in the annotation data (e.g. spam_chain_id), null to ignore the field with standard name"})},e=>`"${e.standardName}": ${e.actualName===null?"null":`"${e.actualName}"`}`,{description:'Optional remapping of annotation field names { standardName1: actualName1, ... }. Use { "label_asym_id": "X" } to load actual field "X" as "label_asym_id". Use { "label_asym_id": null } to ignore actual field "label_asym_id". Fields not mentioned here are mapped implicitely (i.e. actual name = standard name).'}),id:C.Text("",{description:"Arbitrary identifier that can be referenced by MVSAnnotationColorTheme"})},e=>e.id)},cy=ed.createProvider({label:"MVS Annotations",descriptor:{name:"mvs-annotations"},type:"static",defaultParams:i6,getParams:e=>i6,isApplicable:e=>!0,obtain:async(e,t,r)=>{r={...C.getDefaultValues(i6),...r};let n=r.annotations??[];return{value:await a6.fromSpecs(e,n,t)}}}),a6=class e{constructor(t){this.dict=t}static async fromSpecs(t,r,n){let o=r.map(Zce),i=await x7e(t,o,n),a={};for(let s=0;s<r.length;s++){let l=r[s];try{let u=i[s];if(!u.ok)throw u.error;a[l.id]=await oB.fromSpec(t,l,u.value)}catch(u){t.errorContext?.add("mvs",`Failed to obtain annotation (${u}).
Annotation specification source params: ${JSON.stringify(l.source.params)}`),console.error(`Failed to obtain annotation (${u}).
Annotation specification:`,l),a[l.id]=oB.createEmpty(l.schema)}}return new e(a)}getAnnotation(t){return this.dict[t]}getAllAnnotations(){return Object.values(this.dict)}};function tI(e,t){let r=e.isEmpty?[]:e.models;for(let n of r)if(n.customProperties.has(cy.descriptor)){let i=cy.get(n).value?.getAnnotation(t);if(i)return{annotation:i,model:n}}return{annotation:void 0,model:void 0}}var oB=class e{constructor(t,r,n){this.data=t;this.schema=r;this.fieldRemapping=n;this._indexedModels=new Map;this._rows=void 0;this._hasInstanceIds=void 0;this.nRows=d7e(t)}static async fromSpec(t,r,n){n??=await Qce(t,Zce(r));let o;switch(n.format){case"json":o=n;break;case"cif":if(n.data.blocks.length===0)throw new Error("No block in CIF");let i=r.cifBlock,a;switch(i.name){case"header":let u=n.data.blocks.find(c=>c.header===i.params.header);if(!u)throw new Error(`CIF block with header "${i.params.header}" not found`);a=u;break;case"index":if(a=n.data.blocks[i.params.index],!a)throw new Error(`CIF block with index ${i.params.index} not found`);break}let s=r.cifCategory??Object.keys(a.categories)[0];if(!s)throw new Error("There are no categories in CIF block");let l=a.categories[s];if(!l)throw new Error(`CIF category "${s}" not found`);o={format:"cif",data:l};break}return new e(o,r.schema,Object.fromEntries(r.fieldRemapping.map(i=>[i.standardName,i.actualName])))}static createEmpty(t){return new e({format:"json",data:[]},t,{})}getValueForLocation(t,r){let n=this.getIndexedModel(t.unit.model,t.unit.conformation.operator.instanceId),o=n!==null?n[t.element]:-1;return this.getValueForRow(o,r)}getValueForRow(t,r){if(!(t<0))switch(this.data.format){case"json":let n=c7e(t,r,this.data.data);return n===void 0||typeof n=="string"?n:`${n}`;case"cif":return m7e(t,r,this.data.data)}}getIndexedModel(t,r){let n=this.hasInstanceIds()?`${t.id}:${r}`:t.id;if(!this._indexedModels.has(n)){let o=this.getRowForEachAtom(t,r);this._indexedModels.set(n,o)}return this._indexedModels.get(n)}getRowForEachAtom(t,r){let n=i_.get(t),o=t.atomicHierarchy.atoms._rowCount,i=null,a=this.getRows();for(let s=0,l=a.length;s<l;s++){let u=a[s],c=o6(u,t,r,n);Va.count(c)!==0&&(i??=Array(o).fill(-1),Va.foreach(c,(m,d)=>i.fill(s,m,d)))}return i}getRows(){return this._rows??=this._getRows()}_getRows(){switch(this.data.format){case"json":return h7e(this.data.data,this.schema,this.fieldRemapping);case"cif":return g7e(this.data.data,this.schema,this.fieldRemapping)}}hasInstanceIds(){return this._hasInstanceIds??=this.getRows().some(t=>rn(t.instance_id))}getDistinctValuesInField(t,r){let n=new Set,o=[];for(let i=0;i<this.nRows;i++){let a=this.getValueForRow(i,t);r&&(a=a?.toUpperCase()),a!==void 0&&!n.has(a)&&(n.add(a),o.push(a))}return o}};function c7e(e,t,r){let n=r;return Array.isArray(n)?(n[e]??{})[t]:(n[t]??[])[e]}function m7e(e,t,r){let n=r.getField(t);if(n&&n.valueKind(e)===H.ValueKind.Present)return n.str(e)}function d7e(e){switch(e.format){case"json":return p7e(e.data);case"cif":return f7e(e.data)}}function p7e(e){let t=e;if(Array.isArray(t))return t.length;{let r=Object.keys(t);return r.length>0?t[r[0]].length:0}}function f7e(e){return e.rowCount}function h7e(e,t,r){let n=e,o=n6(t),i=Object.keys(o);if(Array.isArray(n))return n.map(a=>AG(a,i,r));{let a=AG(n,i,r);return TG(a)}}function g7e(e,t,r){let n=n6(t),o=Object.keys(n),i={};for(let a of o){let s=r[a];if(s===null)continue;s===void 0&&(s=a);let l=y7e(e,s,n[a]);l&&(i[a]=l)}return TG(i)}function y7e(e,t,r){if(e.getField(t)===void 0)return;let o=uM({[t]:r},e)[t];return b7e(o)}function b7e(e){let t=e.rowCount,r=H.ValueKind.Present,n=new Array(t);for(let o=0;o<t;o++)n[o]=e.valueKind(o)===r?e.value(o):void 0;return n}async function Qce(e,t,r){switch(t.kind){case"source-cif":return{format:"cif",data:C7e(r)};case"url":let n=Zr.getUrlAsset(e.assetManager,t.url),o=u7e[t.format],a=(await e.assetManager.resolve(n,o).runInContext(e.runtime)).data;if(!a)throw new Error("Missing data");switch(t.format){case"json":return{format:"json",data:JSON.parse(a)};case"cif":case"bcif":let l=await mu.parse(a).run();if(l.isError)throw new Error(`Failed to parse ${t.format}`);return{format:"cif",data:l.result}}}}async function x7e(e,t,r){let n={};for(let i of t){let a=Pg(i);n[a]??=Oce(Qce(e,i,r))}let o=await CY(n);return t.map(i=>o[Pg(i)])}function C7e(e){if(e&&Cn.is(e.sourceData)){if(e.sourceData.data.file)return e.sourceData.data.file;{let t=e.sourceData.data.frame,r=V0(Array.from(t.categoryNames),t.categories,t.header);return F0([r])}}else return console.warn("Could not get CifFile from Model, returning empty CifFile"),F0([])}function Zce(e){switch(e.source.name){case"url":return{kind:"url",...e.source.params};case"source-cif":return{kind:"source-cif"}}}var qce={isMvs:C.Boolean(!1,{description:"Flag this model as managed by MolViewSpec and enable MolViewSpec features"})},rI=ed.createProvider({label:"MVS",descriptor:{name:"mvs-is-mvs-model"},type:"static",defaultParams:qce,getParams:e=>qce,isApplicable:e=>!0,obtain:async(e,t,r)=>({value:{}})});function S7e(e){return!!rI.props(e)?.isMvs}function yx(e){return e.models.some(S7e)}var v7e={colors:C.MappedStatic("list",{list:C.ColorList("category-10",{description:"List of colors.",presetKind:"set"}),dictionary:C.ObjectList({value:C.Text(),color:C.Color(Lt.white)},e=>`${e.value}: ${Fe.toHexStyle(e.color)}`,{description:"Mapping of annotation values to colors."})}),repeatColorList:C.Boolean(!1,{hideIf:e=>e.colors.name!=="list",description:"Repeat color list once all colors are depleted (only applies if `colors` is a list)."}),sort:C.Select("none",[["none","None"],["lexical","Lexical"],["numeric","Numeric"]],{hideIf:e=>e.colors.name!=="list",description:"Sort actual annotation values before assigning colors from a list (none = take values in order of their first occurrence)."}),sortDirection:C.Select("ascending",[["ascending","Ascending"],["descending","Descending"]],{hideIf:e=>e.colors.name!=="list",description:"Sort direction."}),caseInsensitive:C.Boolean(!1,{description:"Treat annotation values as case-insensitive strings."}),setMissingColor:C.Boolean(!1,{description:"Allow setting a color for missing values."}),missingColor:C.Color(Lt.white,{hideIf:e=>!e.setMissingColor,description:"Color to use when (a) `colors` is a dictionary and given key is not present, or (b) `color` is a list and there are more actual annotation values than listed colors and `repeat_color_list` is not true."})},I7e={colors:C.ObjectList({color:C.Color(Lt.white),fromValue:C.Numeric(-1/0),toValue:C.Numeric(1/0)},e=>`${Fe.toHexStyle(e.color)} [${e.fromValue}, ${e.toValue}]`,{description:"Mapping of annotation value ranges to colors."}),mode:C.Select("normalized",[["normalized","Normalized"],["absolute","Absolute"]],{description:"Defines whether the annotation values should be normalized before assigning color based on checkpoints in `colors` (`x_normalized = (x - x_min) / (x_max - x_min)`, where `[x_min, x_max]` are either `value_domain` if provided, or the lowest and the highest value encountered in the annotation)."}),xMin:r_({hideIf:e=>e.mode!=="normalized",placeholder:"auto",description:'Defines `x_min` for normalization of annotation values. If not provided, minimum of the actual values will be used. Only used when `mode` is `"normalized"'}),xMax:r_({hideIf:e=>e.mode!=="normalized",placeholder:"auto",description:'Defines `x_max` for normalization of annotation values. If not provided, maximum of the actual values will be used. Only used when `mode` is `"normalized"'})},A7e={colors:C.ColorList("yellow-green",{description:"List of colors, with optional checkpoints.",presetKind:"scale",offsets:!0}),mode:C.Select("normalized",[["normalized","Normalized"],["absolute","Absolute"]],{description:"Defines whether the annotation values should be normalized before assigning color based on checkpoints in `colors` (`x_normalized = (x - x_min) / (x_max - x_min)`, where `[x_min, x_max]` are either `value_domain` if provided, or the lowest and the highest value encountered in the annotation)."}),xMin:r_({hideIf:e=>e.mode!=="normalized",placeholder:"auto",description:'Defines `x_min` for normalization of annotation values. If not provided, minimum of the actual values will be used. Only used when `mode` is `"normalized"'}),xMax:r_({hideIf:e=>e.mode!=="normalized",placeholder:"auto",description:'Defines `x_max` for normalization of annotation values. If not provided, maximum of the actual values will be used. Only used when `mode` is `"normalized"'}),setUnderflowColor:C.Boolean(!1,{description:"Allow setting a color for values below the lowest checkpoint."}),underflowColor:C.Color(Lt.white,{hideIf:e=>!e.setUnderflowColor,description:"Color for values below the lowest checkpoint."}),setOverflowColor:C.Boolean(!1,{description:"Allow setting a color for values above the highest checkpoint."}),overflowColor:C.Color(Lt.white,{hideIf:e=>!e.setOverflowColor,description:"Color for values above the highest checkpoint."})},Yce={annotationId:C.Text("",{description:'Reference to "Annotation" custom model property'}),fieldName:C.Text("color",{description:"Annotation field (column) from which to take color values"}),background:C.Color(Lt.gainsboro,{description:"Color for elements without annotation"}),palette:C.MappedStatic("direct",{direct:C.EmptyGroup(),categorical:C.Group(v7e),discrete:C.Group(I7e),continuous:C.Group(A7e)})};function Kce(e,t){let r=()=>t.background;if(e.structure&&!e.structure.isEmpty){let{annotation:n}=tI(e.structure,t.annotationId);if(n){let o=T7e(t.palette,n,t.fieldName),i=s=>{let l=n?.getValueForLocation(s,t.fieldName);return(l!==void 0?o(l):void 0)??t.background},a=K.Location.create(e.structure);r=s=>K.Location.is(s)?i(s):Ct.isLocation(s)?(a.unit=s.aUnit,a.element=s.aUnit.elements[s.aIndex],i(a)):t.background}else console.error(`Annotation source "${t.annotationId}" not present`)}return{factory:Kce,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:"Assigns colors based on custom MolViewSpec annotation data."}}var iB={name:"mvs-annotation",label:"MVS Annotation",category:"Miscellaneous",factory:Kce,getParams:e=>Yce,defaultValues:C.getDefaultValues(Yce),isApplicable:e=>!!e.structure&&yx(e.structure)};function T7e(e,t,r){if(e.name==="direct")return Eo;if(e.name==="categorical")return P7e(e.params,t,r);if(e.name==="discrete")return _7e(e.params,t,r);if(e.name==="continuous")return R7e(e.params,t,r);throw new Error(`NotImplementedError: makePaletteFunction for ${e.name}`)}function P7e(e,t,r){let n={};if(e.colors.name==="dictionary")for(let{value:i,color:a}of e.colors.params){let s=e.caseInsensitive?i.toUpperCase():i;n[s]=a}else if(e.colors.name==="list"){let i=t.getDistinctValuesInField(r,e.caseInsensitive);e.sort==="lexical"?i.sort():e.sort==="numeric"&&i.sort((l,u)=>Number.parseFloat(l)-Number.parseFloat(u)),e.sortDirection==="descending"&&i.reverse();let a=e.colors.params.colors.map(Fe.fromColorListEntry),s=0;for(let l of i)n[l]=a[s++],s>=a.length&&e.repeatColorList&&(s=0)}let o=e.setMissingColor?e.missingColor:void 0;return e.caseInsensitive?i=>n[i.toUpperCase()]??o:i=>n[i]??o}function _7e(e,t,r){if(e.colors.length===0)return()=>{};let n=Jce(e,t,r);return o=>{let i=parseFloat(o);if(isNaN(i))return;let a=n(i);for(let s=e.colors.length-1;s>=0;s--){let{color:l,fromValue:u,toValue:c}=e.colors[s];if(u<=a&&a<=c)return l}}}function R7e(e,t,r){let{colors:n,checkpoints:o}=D7e(e);if(n.length===0)return()=>{};let i=Jce(e,t,r),a=e.setUnderflowColor?e.underflowColor:void 0,s=e.setOverflowColor?e.overflowColor:void 0;return l=>{let u=parseFloat(l);if(isNaN(u))return;let c=i(u),m=Be.findPredecessorIndex(o,c);if(m===0)return c===o[0]?n[0]:a;if(m===o.length)return s;let d=(c-o[m-1])/(o[m]-o[m-1]);return Fe.interpolate(n[m-1],n[m],d)}}function Jce(e,t,r){if(e.mode==="normalized"){let n=e.xMin,o=e.xMax;if(n===null||o===null){let i=t.getDistinctValuesInField(r,!1).map(parseFloat).filter(a=>!isNaN(a));i.length>0?(n??=i.reduce((a,s)=>a<s?a:s),o??=i.reduce((a,s)=>a>s?a:s)):(n??=0,o??=1)}return n===o?i=>i<n?-.5:i===n?.5:1.5:i=>(i-n)/(o-n)}else return n=>n}function D7e(e){if(e.colors.colors.every(t=>Array.isArray(t))){let t=e.colors.colors.sort((o,i)=>o[1]-i[1]),r=t.map(Fe.fromColorListEntry),n=Be.ofSortedArray(t.map(o=>o[1]));return{colors:r,checkpoints:n}}else{let t=e.colors.colors.map(Fe.fromColorListEntry),r=t.length-1,n=Be.ofSortedArray(t.map((o,i)=>i/r));return{colors:t,checkpoints:n}}}var ur={Atom:"Atom Property",Chain:"Chain Property",Residue:"Residue Property",Symmetry:"Symmetry",Validation:"Validation",Misc:"Miscellaneous"};var aB=13421772,w7e="Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",$ce={};function E7e(e){return $ce}function eme(e,t){let r;if(e.structure){let{elements:n,getElementIndices:o}=e.structure.carbohydrates,i=(a,s)=>{if(!me.isAtomic(a))return aB;let l=o(a,s);return l.length>0?n[l[0]].component.color:aB};r=(a,s)=>s?tr.Secondary:K.Location.is(a)?i(a.unit,a.element):Ct.isLocation(a)?i(a.aUnit,a.aUnit.elements[a.aIndex]):aB}else r=()=>aB;return{factory:eme,granularity:"group",color:r,props:t,description:w7e,legend:Ru(dse)}}var tme={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:ur.Residue,factory:eme,getParams:E7e,defaultValues:C.getDefaultValues($ce),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>Ft.hasCarbohydrate(t))};var rme=13421772,M7e="Gives everything the same, uniform color.",my={value:C.Color(rme),saturation:C.Numeric(0,{min:-6,max:6,step:.1}),lightness:C.Numeric(0,{min:-6,max:6,step:.1})};function B7e(e){return my}function cf(e,t){let r=Wi(t.value,rme);return r=Fe.saturate(r,t.saturation),r=Fe.lighten(r,t.lightness),{factory:cf,granularity:"uniform",color:()=>r,props:t,description:M7e,legend:Ru([["uniform",r]])}}var nme={name:"uniform",label:"Uniform",category:ur.Misc,factory:cf,getParams:B7e,defaultValues:C.getDefaultValues(my),isApplicable:e=>!0};var s6={hue:C.Interval([1,360],{min:0,max:360,step:1}),chroma:C.Interval([40,70],{min:0,max:100,step:1}),luminance:C.Interval([15,85],{min:0,max:100,step:1}),sort:C.Select("contrast",C.arrayToOptions(["none","contrast"]),{description:"no sorting leaves colors approximately ordered by hue"}),clusteringStepCount:C.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:C.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0}),sampleCountFactor:C.Numeric(5,{min:1,max:100,step:1},{isHidden:!0})},nI=2,Z0=[0,0,0],q0=[0,0,0];function k7e(e,t){return ma.toHcl(Z0,e),ma.fromColor(q0,ma.toColor(e)),Z0[0]>=t.hue[0]&&Z0[0]<=t.hue[1]&&Z0[1]>=t.chroma[0]&&Z0[1]<=t.chroma[1]&&Z0[2]>=t.luminance[0]&&Z0[2]<=t.luminance[1]&&q0[0]>=e[0]-nI&&q0[0]<=e[0]+nI&&q0[1]>=e[1]-nI&&q0[1]<=e[1]+nI&&q0[2]>=e[2]-nI&&q0[2]<=e[2]+nI}function L7e(e){let t=e.slice(0),r=[t.shift()];for(;t.length>0;){let n=r[r.length-1],o=0,i=Number.NEGATIVE_INFINITY;for(let a=0;a<t.length;++a){let s=ma.distance(n,t[a]);s>i&&(i=s,o=a)}r.push(t.splice(o,1)[0])}return r}function F7e(e,t){let r=new Map,n=Math.ceil(Math.cbrt(e)),o=Yc(),i=Math.max((t.hue[1]-t.hue[0])/n,1),a=Math.max((t.chroma[1]-t.chroma[0])/n,1),s=Math.max((t.luminance[1]-t.luminance[0])/n,1);for(let l=t.hue[0]+i/2;l<=t.hue[1];l+=i)for(let u=t.chroma[0]+a/2;u<=t.chroma[1];u+=a)for(let c=t.luminance[0]+s/2;c<=t.luminance[1];c+=s){let m=ma.fromHcl(ma(),Yc.set(o,l,u,c));k7e(m,t)&&r.set(ma.toColor(m),m)}return Array.from(r.values())}function ome(e,t){let r=1/0,n=0;for(let o=0;o<e.length;o++){let i=ma.distance(t,e[o]);i<r&&(r=i,n=o)}return n}function ime(e,t={}){let r={...C.getDefaultValues(s6),...t};if(e<=0)return[];let n=F7e(Math.max(r.minSampleCount,e*r.sampleCountFactor),r);if(n.length<e)return console.warn("Not enough samples to generate distinct colors, increase sample count."),new Array(e).fill(Lt.lightgrey);let o=[],i=[],a=Math.floor(n.length/e);for(let l=0;l<n.length&&(o.push(n[l]),i.push([]),!(o.length>=e));l+=a);for(let l=1;l<=r.clusteringStepCount;++l){let u=Ya(i),c=Ya(n);for(let d=0;d<o.length;++d){let p=ome(c,o[d]);u[d].push(n[p]),c.splice(p,1)}for(let d=0;d<c.length;++d){let p=ome(o,n[d]);u[p].push(n[d])}let m=Ya(o);for(let d=0;d<u.length;++d){let p=u[d],h=p.length;if(h===0)continue;let f=0,y=0,g=0;for(let v of p)f+=v[0],y+=v[1],g+=v[2];let x=f/h,S=y/h,I=g/h;o[d]=[x,S,I]}if(oa(m,o))break}return(r.sort==="contrast"?L7e(o):o).map(l=>ma.toColor(l))}var sme={type:"generate",colorList:"red-yellow-blue"};function Ho(e={}){let t={...sme,...e};return{palette:C.MappedStatic(t.type,{colors:C.Group({list:C.ColorList(t.colorList)},{isFlat:!0}),generate:C.Group({...s6,maxCount:C.Numeric(75,{min:1,max:250,step:1})},{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}var WYt=C.getDefaultValues(Ho()),ame={valueLabel:e=>`${e+1}`,minLabel:"Start",maxLabel:"End"};function Jo(e,t,r={}){let n,o;if(t.palette.name==="colors"&&t.palette.params.list.kind==="interpolate"){let{list:i}=t.palette.params,a=[0,e-1],{minLabel:s,maxLabel:l}={...ame,...r},u=i.colors;u.length===0&&(u=Ma(sme.colorList).list);let c=Ba.create({listOrName:u,domain:a,minLabel:s,maxLabel:l});o=c.legend,n=c.color}else{let i;t.palette.name==="colors"?(i=t.palette.params.list.colors.map(u=>Array.isArray(u)?u[0]:u),i.length===0&&(i=Ma("dark-2").list.map(u=>Array.isArray(u)?u[0]:u))):(e=Math.min(e,t.palette.params.maxCount),i=ime(e,t.palette.params));let a=r.valueLabel??ame.valueLabel,s=i.length,l=[];for(let u=0;u<e;++u){let c=u%s;l[c]===void 0?l[c]=[a(u),i[c]]:l[c][0]+=`, ${a(u)}`}o=Ru(l),n=u=>i[u%s]}return{color:n,legend:o}}var V7e="many-distinct",lme=16448250,O7e="Gives every chain a color based on its `asym_id` value.",Ch={asymId:C.Select("auth",C.arrayToOptions(["auth","label"])),...Ho({type:"colors",colorList:V7e})};function G7e(e){let t=C.clone(Ch);return e.structure?.models.some(r=>r.coarseHierarchy.isDefined)&&(t.asymId.defaultValue="label"),t}function U7e(e,t){switch(e.kind){case me.Kind.Atomic:return t==="auth"?qe.chain.auth_asym_id:qe.chain.label_asym_id;case me.Kind.Spheres:case me.Kind.Gaussians:return qe.coarse.asym_id}}function ume(e,t){let r=U7e(e.unit,t)(e);return e.structure.root.models.length>1?cme(e.unit.model,r):r}function cme(e,t){return`${t}|${(Ft.Index.get(e).value||0)+1}`}function N7e(e,t){let r=new Map;for(let n of e.models){let o=Ft.AsymIdOffset.get(n).value,i=(t==="auth"?o?.auth:o?.label)||0,a=0;n.properties.structAsymMap.forEach(({auth_id:s},l)=>{let u=t==="auth"?s:l,c=e.models.length>1?cme(n,u):u;r.has(c)||(r.set(c,a+i),++a)})}return r}function Sh(e,t){let r,n;if(e.structure){let o=K.Location.create(e.structure.root),i=N7e(e.structure.root,t.asymId),a=Array.from(i.keys()),s=u=>a[u],l=Jo(i.size,t,{valueLabel:s});n=l.legend,r=u=>{let c;if(K.Location.is(u)){let m=ume(u,t.asymId);c=i.get(m)}else if(Ct.isLocation(u)){o.unit=u.aUnit,o.element=u.aUnit.elements[u.aIndex];let m=ume(o,t.asymId);c=i.get(m)}return c===void 0?lme:l.color(c)}}else r=()=>lme;return{factory:Sh,granularity:"group",color:r,props:t,description:O7e,legend:n}}var sB={name:"chain-id",label:"Chain Id",category:ur.Chain,factory:Sh,getParams:G7e,defaultValues:C.getDefaultValues(Ch),isApplicable:e=>!!e.structure};var mme=13421772,z7e="Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",dme={...Ho({type:"colors",colorList:"red-yellow-blue"})};function H7e(e){return dme}function pme(e,t){let r,n;if(e.structure){let{units:o}=e.structure.root,i=o.length,a=new Map,s=new Map,l=0;for(let c=0;c<i;++c)a.set(c,l),l+=o[c].elements.length,s.set(o[c].id,c);let u=Jo(l,t);n=u.legend,r=c=>{if(K.Location.is(c)){let m=s.get(c.unit.id),d=Se.findPredecessorIndex(o[m].elements,c.element);return u.color(a.get(m)+d)}else if(Ct.isLocation(c)){let m=s.get(c.aUnit.id),d=Se.findPredecessorIndex(o[m].elements,c.aUnit.elements[c.aIndex]);return u.color(a.get(m)+d)}return mme}}else r=()=>mme;return{factory:pme,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:z7e,legend:n}}var fme={name:"element-index",label:"Element Index",category:ur.Atom,factory:pme,getParams:H7e,defaultValues:C.getDefaultValues(dme),isApplicable:e=>!!e.structure};function bx(e){let t={};return gi(e,(r,n)=>{t[n]=C.Color(e[n])}),t}var j7e="many-distinct",hme=13421772,W7e="Assigns a color based on the operator name of a transformed chain.",lB={...Ho({type:"colors",colorList:j7e})};function X7e(e){return C.clone(lB)}function Q7e(e){let t=new Map;for(let r=0,n=e.units.length;r<n;++r){let o=e.units[r].conformation.operator.name;t.has(o)||t.set(o,t.size)}return t}function uB(e,t){let r,n;if(e.structure){let o=Q7e(e.structure.root),i=Array.from(o.keys()),a=l=>i[l],s=Jo(o.size,t,{valueLabel:a});n=s.legend,r=l=>{let u;if(K.Location.is(l)){let c=l.unit.conformation.operator.name;u=o.get(c)}else if(Ct.isLocation(l)){let c=l.aUnit.conformation.operator.name;u=o.get(c)}return u===void 0?hme:s.color(u)}}else r=()=>hme;return{factory:uB,granularity:"instance",color:r,props:t,description:W7e,legend:n}}var oI={name:"operator-name",label:"Operator Name",category:ur.Symmetry,factory:uB,getParams:X7e,defaultValues:C.getDefaultValues(lB),isApplicable:e=>!!e.structure};var Z7e="many-distinct",l6=16448250,q7e=16715021,Y7e="Gives every chain a color based on its `label_entity_id` value.",vh={...Ho({type:"colors",colorList:Z7e}),overrideWater:C.Boolean(!1,{description:"Override the color for water molecules."}),waterColor:C.Color(q7e,{hideIf:e=>!e.overrideWater,description:"Color for water molecules (if overrideWater is true)."})};function K7e(e){return C.clone(vh)}function cB(e,t){return`${e}|${t}`}function J7e(e){let t=new WeakMap,r=0;for(let n=0,o=e.models.length;n<o;++n){let i=e.models[n].sourceData;t.has(i)||t.set(i,r++)}return t}function $7e(e,t){let r=new Map;for(let n=0,o=e.models.length;n<o;++n){let i=t.get(e.models[n].sourceData)??-1,{label_entity_id:a}=e.models[n].atomicHierarchy.chains;for(let l=0,u=a.rowCount;l<u;++l){let c=cB(a.value(l),i);r.has(c)||r.set(c,r.size)}let{coarseHierarchy:s}=e.models[n];if(s.isDefined){let{entity_id:l}=s.spheres;for(let c=0,m=l.rowCount;c<m;++c){let d=cB(l.value(c),i);r.has(d)||r.set(d,r.size)}let{entity_id:u}=s.gaussians;for(let c=0,m=u.rowCount;c<m;++c){let d=cB(u.value(c),i);r.has(d)||r.set(d,r.size)}}}return r}function eje(e){switch(e.unit.kind){case me.Kind.Atomic:return qe.chain.label_entity_id(e);case me.Kind.Spheres:case me.Kind.Gaussians:return qe.coarse.entity_id(e)}}function Ih(e,t){let r,n;if(e.structure){let o=K.Location.create(e.structure.root),i=J7e(e.structure),a=$7e(e.structure.root,i),s=Array.from(a.keys()),l=c=>s[c],u=Jo(a.size,t,{valueLabel:l});n=u.legend,r=c=>{let m;if(K.Location.is(c))m=c;else if(Ct.isLocation(c))o.unit=c.aUnit,o.element=c.aUnit.elements[c.aIndex],m=o;else return l6;let d=eje(m),p=i.get(m.unit.model.sourceData)??-1;if(t.overrideWater){let y=m.unit.model.entities;if(y.data.type.value(y.getEntityIndex(d))==="water")return t.waterColor}let h=cB(d,p),f=a.get(h);return f===void 0?l6:u.color(f)}}else r=()=>l6;return{factory:Ih,granularity:"group",color:r,props:t,description:Y7e,legend:n}}var gme={name:"entity-id",label:"Entity Id",category:ur.Chain,factory:Ih,getParams:K7e,defaultValues:C.getDefaultValues(vh),isApplicable:e=>!!e.structure};var c6="dark-2",mB=16448250,tje="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",Ah={...Ho({type:"colors",colorList:c6})};function rje(e){let t=C.clone(Ah);return e.structure&&bme(e.structure.root.models).srcKeySerialMap.size>lr[c6].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:Ma(c6).list}}),t}function yme(e,t){return`${e}|${t}`}function nje(e,t,r,n,o,i){return`${e}|${t}|${r}|${i||o||n}`}function u6(e,t,r,n,o,i,a,s){let{entity_id:l,pdbx_src_id:u,pdbx_beg_seq_num:c,pdbx_end_seq_num:m}=o;for(let d=0,p=o._rowCount;d<p;++d){let h=l.value(d),f=yme(r,h),y;if(e.has(f))y=e.get(f);else{let _=n.entities.getEntityIndex(h),T=n.sequence.sequences[_].sequence;y=new Int16Array(T.length),e.set(f,y)}let g=a?a.value(d):"",x=s?s.value(d)[0]:"",S=nje(r,h,i.value(d),u.value(d),g,x),I=c.valueKind(d)===H.ValueKinds.Present?c.value(d):1,v=m.valueKind(d)===H.ValueKinds.Present?m.value(d):y.length,A;t.has(S)?A=t.get(S):(A=t.size+1,t.set(S,A));for(let _=I,T=v;_<=T;++_)y[_-1]=A}}function bme(e){let t=new Map,r=new Map;for(let n=0,o=e.length;n<o;++n){let i=e[n];if(!Cn.is(i.sourceData))continue;let{entity_src_gen:a,entity_src_nat:s,pdbx_entity_src_syn:l}=i.sourceData.data.db;u6(t,r,n,i,a,a.pdbx_gene_src_scientific_name,a.plasmid_name,a.pdbx_gene_src_gene),u6(t,r,n,i,s,s.pdbx_organism_scientific,s.pdbx_plasmid_name),u6(t,r,n,i,l,l.organism_scientific)}return{seqToSrcByModelEntity:t,srcKeySerialMap:r}}function oje(e){let t=0;return Array.from(e.keys()).map(r=>{let n=r.split("|"),o=n[2];return`${ule(n[3])?`Unnamed ${++t}`:n[3]}${o?` (${o})`:""}`})}function Th(e,t){let r,n;if(e.structure){let o=K.Location.create(e.structure),{models:i}=e.structure.root,{seqToSrcByModelEntity:a,srcKeySerialMap:s}=bme(i),l=oje(s),u=d=>l[d],c=Jo(s.size,t,{valueLabel:u});n=c.legend;let m=d=>{let p=i.indexOf(d.unit.model),h=qe.entity.id(d),f=yme(p,h),y=a.get(f);if(y){let g=y[qe.residue.label_seq_id(d)-1]-1;return g===-1?mB:c.color(g)}else return mB};r=d=>K.Location.is(d)?m(d):Ct.isLocation(d)?(o.unit=d.aUnit,o.element=d.aUnit.elements[d.aIndex],m(o)):mB}else r=()=>mB;return{factory:Th,granularity:"group",color:r,props:t,description:tje,legend:n}}var xme={name:"entity-source",label:"Entity Source",category:ur.Chain,factory:Th,getParams:rje,defaultValues:C.getDefaultValues(Ah),isApplicable:e=>!!e.structure};var Cme=13421772,ije="Gives every model a unique color based on its index.",Ph={...Ho({type:"colors",colorList:"many-distinct"})};function aje(e){return C.clone(Ph)}function _h(e,t){let r,n,o=-1;if(e.structure){let i=(Ft.MaxIndex.get(e.structure.models[0]).value??-1)+1;o=i;let a=Jo(i,t);n=a.legend,r=s=>K.Location.is(s)?a.color(Ft.Index.get(s.unit.model).value||0):Ct.isLocation(s)?a.color(Ft.Index.get(s.aUnit.model).value||0):Cme}else r=()=>Cme;return{factory:_h,granularity:"instance",color:r,props:t,contextHash:o,description:ije,legend:n}}var Sme={name:"model-index",label:"Model Index",category:ur.Chain,factory:_h,getParams:aje,defaultValues:C.getDefaultValues(Ph),isApplicable:e=>!!e.structure&&e.structure.elementCount>0};var vme=13421772,sje="Gives every structure a unique color based on its index.",Rh={...Ho({type:"colors",colorList:"many-distinct"})};function lje(e){return C.clone(Rh)}function Dh(e,t){let r,n,o=-1;if(e.structure){let i=(De.MaxIndex.get(e.structure).value??-1)+1;o=i;let a=Jo(i,t);n=a.legend,r=s=>K.Location.is(s)?a.color(De.Index.get(s.structure).value||0):Ct.isLocation(s)?a.color(De.Index.get(s.aStructure).value||0):vme}else r=()=>vme;return{factory:Dh,granularity:"instance",color:r,props:t,contextHash:o,description:sje,legend:n}}var Ime={name:"structure-index",label:"Structure Index",category:ur.Chain,factory:Dh,getParams:lje,defaultValues:C.getDefaultValues(Rh),isApplicable:e=>!!e.structure&&e.structure.elementCount>0};var m6="dark-2",Ame=13421772,uje="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",dB={...Ho({type:"colors",colorList:m6})};function cje(e){let t=C.clone(dB);return e.structure&&e.structure.root.units.length>lr[m6].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:Ma(m6).list}}),t}function pB(e,t){let r,n;if(e.structure){let{units:o}=e.structure.root,i=Jo(o.length,t);n=i.legend;let a=new Map;for(let s=0,l=o.length;s<l;++s)a.set(o[s].id,i.color(s));r=s=>K.Location.is(s)?a.get(s.unit.id):Ct.isLocation(s)?a.get(s.aUnit.id):Ame}else r=()=>Ame;return{factory:pB,granularity:"instance",color:r,props:t,description:uje,legend:n}}var Tme={name:"unit-index",label:"Chain Instance",category:ur.Chain,factory:pB,getParams:cje,defaultValues:C.getDefaultValues(dB),isApplicable:e=>!!e.structure};var Pme=13421772,mje="Gives every model (frame) a unique color based on the index in its trajectory.",xx={...Ho({type:"colors",colorList:"purples"})};function dje(e){return C.clone(xx)}function Cx(e,t){let r,n,o=-1;if(e.structure){let{models:i}=e.structure.root,a=0;for(let c of i)a=Math.max(a,Ft.TrajectoryInfo.get(c)?.size||0);let s=[a],l=Jo(a,t);n=l.legend;let u=new Map;for(let c=0,m=i.length;c<m;++c){let d=Ft.TrajectoryInfo.get(i[c])?.index||0;u.set(d,l.color(d)),s.push(d)}o=Ro(s),r=c=>K.Location.is(c)?u.get(Ft.TrajectoryInfo.get(c.unit.model).index):Ct.isLocation(c)?u.get(Ft.TrajectoryInfo.get(c.aUnit.model).index):Pme}else r=()=>Pme;return{factory:Cx,granularity:"instance",color:r,props:t,contextHash:o,description:mje,legend:n}}var _me={name:"trajectory-index",label:"Trajectory Index",category:ur.Chain,factory:Cx,getParams:dje,defaultValues:C.getDefaultValues(xx),isApplicable:e=>!!e.structure&&e.structure.elementCount>0&&Ft.TrajectoryInfo.get(e.structure.models[0]).size>1};var fB={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215},Rme=16777215,pje="Assigns a color to every atom according to its chemical element.",hB={carbonColor:C.MappedStatic("chain-id",{"chain-id":C.Group(Ch),"unit-index":C.Group(dB,{label:"Chain Instance"}),"entity-id":C.Group(vh),"entity-source":C.Group(Ah),"operator-name":C.Group(lB),"model-index":C.Group(Ph),"structure-index":C.Group(Rh),"trajectory-index":C.Group(xx),uniform:C.Group(my),"element-symbol":C.EmptyGroup()},{description:"Use chain-id coloring for carbon atoms."}),saturation:C.Numeric(0,{min:-6,max:6,step:.1}),lightness:C.Numeric(.2,{min:-6,max:6,step:.1}),colors:C.MappedStatic("default",{default:C.EmptyGroup(),custom:C.Group(bx(fB))})};function fje(e){return C.clone(hB)}function hje(e,t){let r=e[t];return r===void 0?Rme:r}function gje(e,t){switch(t.name){case"chain-id":return Sh(e,t.params);case"unit-index":return pB(e,t.params);case"entity-id":return Ih(e,t.params);case"entity-source":return Th(e,t.params);case"operator-name":return uB(e,t.params);case"model-index":return _h(e,t.params);case"structure-index":return Dh(e,t.params);case"trajectory-index":return Cx(e,t.params);case"uniform":return cf(e,t.params);case"element-symbol":return;default:Rr(t)}}function gB(e,t){let r=Db(t.colors.name==="default"?fB:t.colors.params,t.saturation,t.lightness),n=gje(e,t.carbonColor),o=n?.color,i=n?.contextHash??-1;function a(u,c){return o&&u==="C"?o(c,!1):hje(r,u)}function s(u){if(K.Location.is(u)){if(me.isAtomic(u.unit)){let{type_symbol:c}=u.unit.model.atomicHierarchy.atoms;return a(c.value(u.element),u)}}else if(Ct.isLocation(u)&&me.isAtomic(u.aUnit)){let{type_symbol:c}=u.aUnit.model.atomicHierarchy.atoms,m=c.value(u.aUnit.elements[u.aIndex]);return a(m,u)}return Rme}let l=t.carbonColor.name==="operator-name"||t.carbonColor.name==="unit-index"?"groupInstance":"group";return{factory:gB,granularity:l,preferSmoothing:!0,color:s,props:t,contextHash:i,description:pje,legend:Ru(Object.keys(r).map(u=>[u,r[u]]))}}var Dme={name:"element-symbol",label:"Element Symbol",category:ur.Atom,factory:gB,getParams:fje,defaultValues:C.getDefaultValues(hB),isApplicable:e=>!!e.structure};var Eme={water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655},d6=16777113,yje="Assigns a color based on the molecule type of a residue.",Sx={saturation:C.Numeric(0,{min:-6,max:6,step:.1}),lightness:C.Numeric(0,{min:-6,max:6,step:.1}),colors:C.MappedStatic("default",{default:C.EmptyGroup(),custom:C.Group(bx(Eme))})};function bje(e){return Sx}function wme(e,t,r){switch(Fv(t,r)){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return d6}function vx(e,t){let r=Db(t.colors.name==="default"?Eme:t.colors.params,t.saturation,t.lightness);function n(o){return K.Location.is(o)?wme(r,o.unit,o.element):Ct.isLocation(o)?wme(r,o.aUnit,o.aUnit.elements[o.aIndex]):d6}return{factory:vx,granularity:"group",color:n,props:t,description:yje,legend:Ru(Object.keys(r).map(o=>[o,r[o]]).concat([["Other/unknown",d6]]))}}var Mme={name:"molecule-type",label:"Molecule Type",category:ur.Residue,factory:vx,getParams:bje,defaultValues:C.getDefaultValues(Sx),isApplicable:e=>!!e.structure};var p6="dark-2",Bme=16448250,xje="Gives every polymer chain a color based on its `asym_id` value.",Lme={...Ho({type:"colors",colorList:p6})};function Cje(e){let t=C.clone(Lme);return e.structure&&Fme(e.structure.root).size>lr[p6].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:Ma(p6).list}}),t}function kme(e){switch(e.kind){case me.Kind.Atomic:return qe.chain.label_asym_id;case me.Kind.Spheres:case me.Kind.Gaussians:return qe.coarse.asym_id}}function Fme(e){let t=new Map;for(let r=0,n=e.unitSymmetryGroups.length;r<n;++r){let o=e.unitSymmetryGroups[r].units[0],{model:i}=o;if(me.isAtomic(o)){let{chainAtomSegments:a,chains:s}=i.atomicHierarchy,l=Xt.transientSegments(a,o.elements);for(;l.hasNext;){let{index:u}=l.move(),c=s.label_entity_id.value(u),m=i.entities.getEntityIndex(c);if(i.entities.data.type.value(m)==="polymer"){let d=s.label_asym_id.value(u);t.has(d)||t.set(d,t.size)}}}else if(me.isCoarse(o)){let{chainElementSegments:a,asym_id:s,entity_id:l}=me.isSpheres(o)?i.coarseHierarchy.spheres:i.coarseHierarchy.gaussians,u=Xt.transientSegments(a,o.elements);for(;u.hasNext;){let{index:c}=u.move(),m=a.offsets[c],d=l.value(m),p=i.entities.getEntityIndex(d);if(i.entities.data.type.value(p)==="polymer"){let h=s.value(m);t.has(h)||t.set(h,t.size)}}}}return t}function Vme(e,t){let r,n;if(e.structure){let o=K.Location.create(e.structure),i=Fme(e.structure.root),a=Array.from(i.keys()),s=u=>a[u],l=Jo(i.size,t,{valueLabel:s});n=l.legend,r=u=>{let c;if(K.Location.is(u)){let m=kme(u.unit);c=i.get(m(u))}else if(Ct.isLocation(u)){let m=kme(u.aUnit);o.unit=u.aUnit,o.element=u.aUnit.elements[u.aIndex],c=i.get(m(o))}return c===void 0?Bme:l.color(c)}}else r=()=>Bme;return{factory:Vme,granularity:"group",color:r,props:t,description:xje,legend:n}}var Ome={name:"polymer-id",label:"Polymer Chain Id",category:ur.Chain,factory:Vme,getParams:Cje,defaultValues:C.getDefaultValues(Lme),isApplicable:e=>!!e.structure};var f6="dark-2",Gme=13421772,Sje="Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",Ume={...Ho({type:"colors",colorList:f6})};function vje(e){let t=C.clone(Ume);return e.structure&&Nme(e.structure.root)>lr[f6].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:Ma(f6).list}}),t}function Nme(e){let t=0,{units:r}=e;for(let n=0,o=r.length;n<o;++n)r[n].polymerElements.length>0&&++t;return t}function zme(e,t){let r,n;if(e.structure){let o=Jo(Nme(e.structure.root),t);n=o.legend;let{units:i}=e.structure.root,a=new Map;for(let s=0,l=0,u=i.length;s<u;++s)i[s].polymerElements.length>0&&(a.set(i[s].id,o.color(l)),++l);r=s=>{let l;return K.Location.is(s)?l=a.get(s.unit.id):Ct.isLocation(s)&&(l=a.get(s.aUnit.id)),l!==void 0?l:Gme}}else r=()=>Gme;return{factory:zme,granularity:"instance",color:r,props:t,description:Sje,legend:n}}var Hme={name:"polymer-index",label:"Polymer Chain Instance",category:ur.Chain,factory:zme,getParams:vje,defaultValues:C.getDefaultValues(Ume),isApplicable:e=>!!e.structure};var a_={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945},h6=16711935,Ije="Assigns a color to every residue according to its name.",bB={saturation:C.Numeric(0,{min:-6,max:6,step:.1}),lightness:C.Numeric(1,{min:-6,max:6,step:.1}),colors:C.MappedStatic("default",{default:C.EmptyGroup(),custom:C.Group(bx(a_))})};function Aje(e){return bB}function jme(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function Wme(e,t){let r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){let o=e.coarseElements.entityKey[t];return e.model.sequence.byEntityKey[o].sequence.compId.value(r-1)}}function yB(e,t){let r=e[t];return r===void 0?h6:r}function xB(e,t){let r=Db(t.colors.name==="default"?a_:t.colors.params,t.saturation,t.lightness);function n(o){if(K.Location.is(o))if(me.isAtomic(o.unit)){let i=jme(o.unit,o.element);return yB(r,i)}else{let i=Wme(o.unit,o.element);if(i)return yB(r,i)}else if(Ct.isLocation(o))if(me.isAtomic(o.aUnit)){let i=jme(o.aUnit,o.aUnit.elements[o.aIndex]);return yB(r,i)}else{let i=Wme(o.aUnit,o.aUnit.elements[o.aIndex]);if(i)return yB(r,i)}return h6}return{factory:xB,granularity:"group",preferSmoothing:!0,color:n,props:t,description:Ije,legend:Ru(Object.keys(r).map(o=>[o,r[o]]).concat([["Unknown",h6]]))}}var Xme={name:"residue-name",label:"Residue Name",category:ur.Residue,factory:xB,getParams:Aje,defaultValues:C.getDefaultValues(bB),isApplicable:e=>!!e.structure};var sm={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722},g6=8421504,Tje="Assigns a color based on the type of secondary structure and basic molecule type.",CB={saturation:C.Numeric(-1,{min:-6,max:6,step:.1}),lightness:C.Numeric(0,{min:-6,max:6,step:.1}),colors:C.MappedStatic("default",{default:C.EmptyGroup(),custom:C.Group(bx(sm))})};function Pje(e){return CB}function Qme(e,t,r,n){let o=Kt.create(Kt.Flag.None);if(n&&me.isAtomic(t)){let i=n.get(t.invariantId);i&&(o=i.type[i.getIndex(t.residueIndex[r])])}if(Kt.is(o,Kt.Flag.Helix))return Kt.is(o,Kt.Flag.Helix3Ten)?e.threeTenHelix:Kt.is(o,Kt.Flag.HelixPi)?e.piHelix:e.alphaHelix;if(Kt.is(o,Kt.Flag.Beta))return e.betaStrand;if(Kt.is(o,Kt.Flag.Bend))return e.bend;if(Kt.is(o,Kt.Flag.Turn))return e.turn;{let i=Fv(t,r);if(i===7)return e.dna;if(i===6)return e.rna;if(i===9)return e.carbohydrate;if(i===5)return e.coil}return g6}function SB(e,t){let r=e.structure&&zs.get(e.structure),n=r?Du(r.id,r.version):-1,o=Db(t.colors.name==="default"?sm:t.colors.params,t.saturation,t.lightness);function i(a){return K.Location.is(a)?Qme(o,a.unit,a.element,r?.value):Ct.isLocation(a)?Qme(o,a.aUnit,a.aUnit.elements[a.aIndex],r?.value):g6}return{factory:SB,granularity:"group",preferSmoothing:!0,color:i,props:t,contextHash:n,description:Tje,legend:Ru(Object.keys(o).map(a=>[a,o[a]]).concat([["Other",g6]]))}}var Zme={name:"secondary-structure",label:"Secondary Structure",category:ur.Residue,factory:SB,getParams:Pje,defaultValues:C.getDefaultValues(CB),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?zs.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&zs.ref(e.structure,!1)}};var _je=13421772,Rje="Gives every polymer residue a color based on its `seq_id` value.",vB={list:C.ColorList("turbo-no-black",{presetKind:"scale"})};function Dje(e){return vB}function qme(e,t){let{model:r}=e;switch(e.kind){case me.Kind.Atomic:let n=r.atomicHierarchy.residueAtomSegments.index[t];return r.atomicHierarchy.residues.label_seq_id.value(n);case me.Kind.Spheres:return Math.round((r.coarseHierarchy.spheres.seq_id_begin.value(t)+r.coarseHierarchy.spheres.seq_id_end.value(t))/2);case me.Kind.Gaussians:return Math.round((r.coarseHierarchy.gaussians.seq_id_begin.value(t)+r.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function Yme(e,t){let{model:r}=e,n="";switch(e.kind){case me.Kind.Atomic:let a=r.atomicHierarchy.chainAtomSegments.index[t];n=r.atomicHierarchy.chains.label_entity_id.value(a);break;case me.Kind.Spheres:n=r.coarseHierarchy.spheres.entity_id.value(t);break;case me.Kind.Gaussians:n=r.coarseHierarchy.gaussians.entity_id.value(t);break}if(n==="")return 0;let o=r.entities.getEntityIndex(n);if(o===-1)return 0;let i=r.sequence.byEntityKey[o];return i===void 0?0:i.sequence.length}function IB(e,t){let r=Ba.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"});return{factory:IB,granularity:"group",preferSmoothing:!0,color:o=>{if(K.Location.is(o)){let{unit:i,element:a}=o,s=qme(i,a);if(s>0){let l=Yme(i,a);if(l)return r.setDomain(0,l-1),r.color(s)}}else if(Ct.isLocation(o)){let{aUnit:i,aIndex:a}=o,s=qme(i,i.elements[a]);if(s>0){let l=Yme(i,i.elements[a]);if(l)return r.setDomain(0,l-1),r.color(s)}}return _je},props:t,description:Rje,legend:r?r.legend:void 0}}var Kme={name:"sequence-id",label:"Sequence Id",category:ur.Residue,factory:IB,getParams:Dje,defaultValues:C.getDefaultValues(vB),isApplicable:e=>!!e.structure};function wje(e,t){for(let r=0,n=t*3;r<n;r+=3){let o=e[r],i=e[r+1],a=e[r+2],s=1/Math.sqrt(o*o+i*i+a*a);e[r]=o*s,e[r+1]=i*s,e[r+2]=a*s}return e}var lm=b();function Pc(e,t,r,n){for(let o=0,i=n*3;o<i;o+=3)b.fromArray(lm,t,r+o),b.transformMat4(lm,lm,e),b.toArray(lm,t,r+o)}function tde(e,t,r,n){for(let o=0,i=n*3;o<i;o+=3)b.fromArray(lm,t,r+o),b.transformMat3(lm,lm,e),b.toArray(lm,t,r+o)}function rde(e,t){for(let r=0,n=e.length;r<n;r+=3)b.fromArray(lm,e,r),b.normalize(lm,lm),b.scale(lm,lm,t),b.toArray(lm,e,r)}var Jme=b(),y6=b(),$me=b(),Qd=b(),ede=b();function AB(e,t,r,n,o){for(let i=0,a=o*3;i<a;i+=3){let s=t[i]*3,l=t[i+1]*3,u=t[i+2]*3;b.fromArray(Jme,e,s),b.fromArray(y6,e,l),b.fromArray($me,e,u),b.sub(Qd,$me,y6),b.sub(ede,Jme,y6),b.cross(Qd,Qd,ede),r[s]+=Qd[0],r[s+1]+=Qd[1],r[s+2]+=Qd[2],r[l]+=Qd[0],r[l+1]+=Qd[1],r[l+2]+=Qd[2],r[u]+=Qd[0],r[u+1]+=Qd[1],r[u+2]+=Qd[2]}return wje(r,n)}function Zd(e,t,r=1){let n=ol(e),o=new Int32Array(n+2),i=new Int32Array(t),a=new Int32Array(t);for(let u=0,c=t*r;u<c;u+=r)++a[e[u]];let s=0;for(let u=0;u<t;u++)o[u]=s,s+=a[u];o[t]=s;let l=new Int32Array(s);for(let u=0,c=t*r;u<c;u+=r){let m=e[u],d=o[m]+i[m];l[d]=u,++i[m]}return{indices:l,offsets:o}}var b6=b.fromArray,TB=b.transformMat4Offset;function Eje(e,t){e=Math.max(e,2);let r=Math.sqrt(e),n=Math.ceil(r);n=n+(t-n%t)%t;let o=n>0?Math.ceil(e/n):0;return{width:n,height:o,length:n*o*t}}function so(e,t,r,n){let{length:o,width:i,height:a}=Eje(e,t);return n=n&&n.length>=o?n:new r(o),{array:n,width:i,height:a}}var qd=b(),Mje=new Ci("14"),Bje=new Ci("98");function nde(e){return e>1e5?Mje:Bje}function um(e,t,r){let n=r*3,o=nde(t);o.reset();for(let a=0,s=t*3;a<s;a+=n)b6(qd,e,a),o.includePosition(qd);o.finishedIncludeStep();for(let a=0,s=t*3;a<s;a+=n)b6(qd,e,a),o.radiusPosition(qd);let i=o.getSphere();if(t<=14){let a=[];for(let s=0,l=t*3;s<l;s+=n)a.push(b6(b(),e,s));ye.setExtrema(i,a)}return i}var x6=Z();function Si(e,t,r,n){if(r===1){Z.fromArray(x6,t,n);let l=ye.clone(e);return Z.isIdentity(x6)?l:ye.transform(l,l,x6)}let o=nde(r);o.reset();let{center:i,radius:a,extrema:s}=e;if(s&&r<=14){for(let l=0,u=r;l<u;++l)for(let c of s)TB(qd,c,t,0,0,l*16+n),o.includePosition(qd);o.finishedIncludeStep();for(let l=0,u=r;l<u;++l)for(let c of s)TB(qd,c,t,0,0,l*16+n),o.radiusPosition(qd)}else{for(let l=0,u=r;l<u;++l)TB(qd,i,t,0,0,l*16+n),o.includePositionRadius(qd,a);o.finishedIncludeStep();for(let l=0,u=r;l<u;++l)TB(qd,i,t,0,0,l*16+n),o.radiusPositionRadius(qd,a)}return o.getSphere()}var du=new Uint8Array(772);du[1]=1;du[2]=1;du[3]=1;du[256]=1;du[512]=1;du[768]=1;du[257]=2;du[513]=2;du[769]=2;du[258]=2;du[514]=2;du[770]=2;du[259]=2;du[515]=2;du[771]=2;function C6(e,t){if(t===0)return 0;let r=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),n=t-4>>2,o=4*n,i=0;if(n<0)for(let a=0;a<t;++a)i+=e[a]&&1;else{for(let a=0;a<n;++a){let s=r[a];i+=du[s&65535]+du[s>>16]}for(let a=o;a<t;++a)i+=e[a]&&1}return i/t}function oo(e,t,r){let n=so(Math.max(1,e),1,Uint8Array,r&&r.tMarker.ref.value.array),o=C6(n.array,e),i=o===0?0:-1;return r?(P.updateIfChanged(r.uMarker,0),P.update(r.tMarker,n),P.update(r.uMarkerTexDim,Ie.create(n.width,n.height)),P.updateIfChanged(r.markerAverage,o),P.updateIfChanged(r.markerStatus,i),P.updateIfChanged(r.dMarkerType,t),r):{uMarker:P.create(0),tMarker:P.create(n),uMarkerTexDim:P.create(Ie.create(n.width,n.height)),markerAverage:P.create(o),markerStatus:P.create(i),dMarkerType:P.create(t)}}var j$t={array:new Uint8Array(1),width:1,height:1};var pu={kind:"null-location"};function PB(e,t,r){return{kind:"data-location",tag:e,data:t,element:r}}function Kr(e,t,r,n,o=!1,i=()=>!1,a){if(e%r!==0)throw new Error("incompatible groupCount and stride");let s={location:pu,location2:pu,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},l=s.groupIndex<e,u=!1,c=0,m=0,d=!1,p=!!a;return{get hasNext(){return l},get isNextNewInstance(){return u},groupCount:e,instanceCount:t,count:e*t,stride:r,nonInstanceable:o,hasLocation2:p,move(){return l&&(s.groupIndex=c,s.instanceIndex=m,s.index=m*e+c,s.location=n(c,d?-1:m),p&&(s.location2=a(c,d?-1:m)),s.isSecondary=i(c,d?-1:m),c+=r,c===e?(++m,u=!0,m<t&&(c=0)):u=!1,l=c<e),s},reset(){s.location=pu,s.location2=pu,s.index=0,s.groupIndex=0,s.instanceIndex=0,s.isSecondary=!1,l=s.groupIndex<e,u=!1,c=0,m=0,d=!1},skipInstance(){l&&s.instanceIndex===m&&(++m,c=0,l=m<t)},voidInstances(){d=!0}}}var wh={get hasNext(){return!1},get isNextNewInstance(){return!1},groupCount:0,instanceCount:0,count:0,stride:0,nonInstanceable:!1,hasLocation2:!1,move(){return{location:pu,location2:pu,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1}},reset(){},skipInstance(){},voidInstances(){}};function As(e,t){return{kind:"position-location",position:e?b.clone(e):b(),normal:t?b.clone(t):b()}}function iI(e){return!!e&&e.kind==="position-location"}var ide=oi();function kje(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if(Ht(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}function aI(e,t){let r=e.checkFramebufferStatus(e.FRAMEBUFFER);if(r!==e.FRAMEBUFFER_COMPLETE){let n=kje(e,r);throw new Error(`Framebuffer status: ${n}${t?` (${t})`:""}`)}}function ode(e){let t=e.createFramebuffer();if(t===null)throw new Error("Could not create WebGL framebuffer");return t}function ade(e){let t=ode(e),r=!1;return{id:ide(),bind:()=>e.bindFramebuffer(e.FRAMEBUFFER,t),reset:()=>{t=ode(e)},destroy:()=>{r||(e.deleteFramebuffer(t),r=!0)}}}function sde(){return{id:ide(),bind:()=>{},reset:()=>{},destroy:()=>{}}}function S6(e){let t=ude(e);if(t===null)throw new Error('Could not find support for "instanced_arrays"');let r=mde(e);if(r===null)throw new Error('Could not find support for "element_index_uint"');let n=cde(e);if(n===null)throw new Error('Could not find support for "standard_derivatives"');let o=pde(e);$t&&o===null&&console.log('Could not find support for "texture_float"');let i=fde(e);$t&&i===null&&console.log('Could not find support for "texture_float_linear"');let a=hde(e);$t&&a===null&&console.log('Could not find support for "texture_half_float"');let s=gde(e);$t&&s===null&&console.log('Could not find support for "texture_half_float_linear"');let l=Ade(e);$t&&l===null&&console.log('Could not find support for "depth_texture"');let u=yde(e);$t&&u===null&&console.log('Could not find support for "blend_minmax"');let c=dde(e);$t&&c===null&&console.log('Could not find support for "vertex_array_object"');let m=bde(e);$t&&m===null&&console.log('Could not find support for "frag_depth"');let d=xde(e);$t&&d===null&&console.log('Could not find support for "color_buffer_float"');let p=Cde(e);$t&&p===null&&console.log('Could not find support for "color_buffer_half_float"');let h=Sde(e);$t&&h===null&&console.log('Could not find support for "draw_buffers"');let f=vde(e);$t&&f===null&&console.log('Could not find support for "draw_buffers_indexed"');let y=Ide(e);$t&&y===null&&console.log('Could not find support for "shader_texture_lod"');let g=Tde(e);$t&&g===null&&console.log('Could not find support for "sRGB"');let x=Pde(e);$t&&x===null&&console.log('Could not find support for "disjoint_timer_query"');let S=_de(e);$t&&S===null&&console.log('Could not find support for "multi_draw"');let I=Rde(e);$t&&I===null&&console.log('Could not find support for "draw_instanced_base_vertex_base_instance"');let v=Dde(e);$t&&v===null&&console.log('Could not find support for "multi_draw_instanced_base_vertex_base_instance"');let A=wde(e);$t&&A===null&&console.log('Could not find support for "parallel_shader_compile"');let _=Ede(e);$t&&_===null&&console.log('Could not find support for "fbo_render_mipmap"');let T=Mde(e);$t&&T===null&&console.log('Could not find support for "provoking_vertex"');let w=Bde(e);$t&&w===null&&console.log('Could not find support for "clip_cull_distance"');let D=kde(e);$t&&D===null&&console.log('Could not find support for "conservative_depth"');let M=Lde(e);$t&&M===null&&console.log('Could not find support for "stencil_texturing"');let E=Fde(e);$t&&E===null&&console.log('Could not find support for "clip_control"');let R=Vde(e);$t&&R===null&&console.log('Could not find support for "render_snorm"');let k=Ode(e);$t&&k===null&&console.log('Could not find support for "render_shared_exponent"');let B=Gde(e);$t&&B===null&&console.log('Could not find support for "texture_norm16"');let L=Ude(e);$t&&L===null&&console.log('Could not find support for "depth_clamp"');let V=Nde(e);$t&&V===null&&console.log('Could not find support for "multiview2"');let U=zde(e);return{instancedArrays:t,standardDerivatives:n,elementIndexUint:r,textureFloat:o,textureFloatLinear:i,textureHalfFloat:a,textureHalfFloatLinear:s,depthTexture:l,blendMinMax:u,vertexArrayObject:c,fragDepth:m,colorBufferFloat:d,colorBufferHalfFloat:p,drawBuffers:h,drawBuffersIndexed:f,shaderTextureLod:y,sRGB:g,disjointTimerQuery:x,multiDraw:S,drawInstancedBaseVertexBaseInstance:I,multiDrawInstancedBaseVertexBaseInstance:v,parallelShaderCompile:A,fboRenderMipmap:_,provokingVertex:T,clipCullDistance:w,conservativeDepth:D,stencilTexturing:M,clipControl:E,renderSnorm:R,renderSharedExponent:k,textureNorm16:B,depthClamp:L,multiview2:V,noNonInstancedActiveAttribs:U}}function lde(e,t){let r=S6(e);gi(t,(n,o)=>{o==="noNonInstancedActiveAttribs"?t.noNonInstancedActiveAttribs=r.noNonInstancedActiveAttribs:n!==null&&(r[o]===null?t[o]=null:Object.assign(n,r[o]))})}function Hde(e,t){let r={},n=e.getParameter(e.FRONT_FACE),o=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),a=e.getParameter(e.DEPTH_CLEAR_VALUE),s=e.getParameter(e.DEPTH_FUNC),l=e.getParameter(e.COLOR_WRITEMASK),u=e.getParameter(e.COLOR_CLEAR_VALUE),c=e.getParameter(e.BLEND_SRC_RGB),m=e.getParameter(e.BLEND_DST_RGB),d=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),h=e.getParameter(e.BLEND_COLOR),f=e.getParameter(e.BLEND_EQUATION_RGB),y=e.getParameter(e.BLEND_EQUATION_ALPHA),g=e.getParameter(e.STENCIL_FUNC),x=e.getParameter(e.STENCIL_VALUE_MASK),S=e.getParameter(e.STENCIL_REF),I=e.getParameter(e.STENCIL_BACK_FUNC),v=e.getParameter(e.STENCIL_BACK_VALUE_MASK),A=e.getParameter(e.STENCIL_BACK_REF),_=e.getParameter(e.STENCIL_WRITEMASK),T=e.getParameter(e.STENCIL_BACK_WRITEMASK),w=e.getParameter(e.STENCIL_FAIL),D=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),M=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),E=e.getParameter(e.STENCIL_BACK_FAIL),R=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),k=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),B=e.getParameter(e.MAX_VERTEX_ATTRIBS),L=[],V=e.getParameter(e.VIEWPORT),U=e.getParameter(e.SCISSOR_BOX),Q=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,O=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1,q=()=>{for(let X=0;X<B;++X)L[X]=0};return q(),{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:X=>{r[X]!==!0&&(e.enable(X),r[X]=!0)},disable:X=>{r[X]!==!1&&(e.disable(X),r[X]=!1)},frontFace:X=>{X!==n&&(e.frontFace(X),n=X)},cullFace:X=>{X!==o&&(e.cullFace(X),o=X)},depthMask:X=>{X!==i&&(e.depthMask(X),i=X)},clearDepth:X=>{X!==a&&(e.clearDepth(X),a=X)},depthFunc:X=>{X!==s&&(e.depthFunc(X),s=X)},colorMask:(X,F,Y,$)=>{(X!==l[0]||F!==l[1]||Y!==l[2]||$!==l[3])&&(e.colorMask(X,F,Y,$),l[0]=X,l[1]=F,l[2]=Y,l[3]=$)},clearColor:(X,F,Y,$)=>{(X!==u[0]||F!==u[1]||Y!==u[2]||$!==u[3])&&(e.clearColor(X,F,Y,$),u[0]=X,u[1]=F,u[2]=Y,u[3]=$)},blendFunc:(X,F)=>{(X!==c||F!==m||X!==d||F!==p)&&(e.blendFunc(X,F),c=X,m=F,d=X,p=F)},blendFuncSeparate:(X,F,Y,$)=>{(X!==c||F!==m||Y!==d||$!==p)&&(e.blendFuncSeparate(X,F,Y,$),c=X,m=F,d=Y,p=$)},blendEquation:X=>{(X!==f||X!==y)&&(e.blendEquation(X),f=X,y=X)},blendEquationSeparate:(X,F)=>{(X!==f||F!==y)&&(e.blendEquationSeparate(X,F),f=X,y=F)},blendColor:(X,F,Y,$)=>{(X!==h[0]||F!==h[1]||Y!==h[2]||$!==h[3])&&(e.blendColor(X,F,Y,$),h[0]=X,h[1]=F,h[2]=Y,h[3]=$)},stencilFunc:(X,F,Y)=>{(X!==g||F!==S||Y!==x||X!==I||F!==A||Y!==v)&&(e.stencilFunc(X,F,Y),g=X,S=F,x=Y,I=X,A=F,v=Y)},stencilFuncSeparate:(X,F,Y,$)=>{X===e.FRONT?(F!==g||Y!==S||$!==x)&&(e.stencilFuncSeparate(X,F,Y,$),g=F,S=Y,x=$):X===e.BACK?(F!==I||Y!==A||$!==v)&&(e.stencilFuncSeparate(X,F,Y,$),I=F,A=Y,v=$):X===e.FRONT_AND_BACK&&(F!==g||Y!==S||$!==x||F!==I||Y!==A||$!==v)&&(e.stencilFuncSeparate(X,F,Y,$),g=F,S=Y,x=$,I=F,A=Y,v=$)},stencilMask:X=>{(X!==_||X!==T)&&(e.stencilMask(X),_=X,T=X)},stencilMaskSeparate:(X,F)=>{X===e.FRONT?F!==_&&(e.stencilMaskSeparate(X,F),_=F):X===e.BACK?F!==T&&(e.stencilMaskSeparate(X,F),T=F):X===e.FRONT_AND_BACK&&(F!==_||F!==T)&&(e.stencilMaskSeparate(X,F),_=F,T=F)},stencilOp:(X,F,Y)=>{(X!==w||F!==M||Y!==D||X!==E||F!==k||Y!==R)&&(e.stencilOp(X,F,Y),w=X,M=F,D=Y,E=X,k=F,R=Y)},stencilOpSeparate:(X,F,Y,$)=>{X===e.FRONT?(F!==w||Y!==M||$!==D)&&(e.stencilOpSeparate(X,F,Y,$),w=F,M=Y,D=$):X===e.BACK?(F!==E||Y!==k||$!==R)&&(e.stencilOpSeparate(X,F,Y,$),E=F,k=Y,R=$):X===e.FRONT_AND_BACK&&(F!==w||Y!==M||$!==D||F!==E||Y!==k||$!==R)&&(e.stencilOpSeparate(X,F,Y,$),w=F,M=Y,D=$,E=F,k=Y,R=$)},enableVertexAttrib:X=>{e.enableVertexAttribArray(X),L[X]=1},clearVertexAttribsState:q,disableUnusedVertexAttribs:()=>{for(let X=0;X<B;++X)L[X]===0&&e.disableVertexAttribArray(X)},viewport:(X,F,Y,$)=>{(X!==V[0]||F!==V[1]||Y!==V[2]||$!==V[3])&&(e.viewport(X,F,Y,$),V[0]=X,V[1]=F,V[2]=Y,V[3]=$)},scissor:(X,F,Y,$)=>{(X!==U[0]||F!==U[1]||Y!==U[2]||$!==U[3])&&(e.scissor(X,F,Y,$),U[0]=X,U[1]=F,U[2]=Y,U[3]=$)},clipControl:t.clipControl?(X,F)=>{(X!==Q||F!==O)&&(t.clipControl.clipControl(X,F),Q=X,O=F)}:void 0,reset:()=>{r={},n=e.getParameter(e.FRONT_FACE),o=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),a=e.getParameter(e.DEPTH_CLEAR_VALUE),s=e.getParameter(e.DEPTH_FUNC),l=e.getParameter(e.COLOR_WRITEMASK),u=e.getParameter(e.COLOR_CLEAR_VALUE),c=e.getParameter(e.BLEND_SRC_RGB),m=e.getParameter(e.BLEND_DST_RGB),d=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),h=e.getParameter(e.BLEND_COLOR),f=e.getParameter(e.BLEND_EQUATION_RGB),y=e.getParameter(e.BLEND_EQUATION_ALPHA),g=e.getParameter(e.STENCIL_FUNC),x=e.getParameter(e.STENCIL_VALUE_MASK),S=e.getParameter(e.STENCIL_REF),I=e.getParameter(e.STENCIL_BACK_FUNC),v=e.getParameter(e.STENCIL_BACK_VALUE_MASK),A=e.getParameter(e.STENCIL_BACK_REF),_=e.getParameter(e.STENCIL_WRITEMASK),T=e.getParameter(e.STENCIL_BACK_WRITEMASK),w=e.getParameter(e.STENCIL_FAIL),D=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),M=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),E=e.getParameter(e.STENCIL_BACK_FAIL),R=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),k=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),B=e.getParameter(e.MAX_VERTEX_ATTRIBS),L.length=0;for(let X=0;X<B;++X)L[X]=0;V=e.getParameter(e.VIEWPORT),U=e.getParameter(e.SCISSOR_BOX),Q=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,O=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1}}}var jde=`
float preFogAlpha = gl_FragColor.a;
if (uFog) {
    float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
    float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;
    if (!uTransparentBackground) {
        if (gl_FragColor.a < 1.0) {
            // transparent objects are blended with background color
            gl_FragColor.a = fogAlpha;
        } else {
            // mix opaque objects with background color
            gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);
        }
    } else {
        #if defined(dRenderVariant_colorDpoit) && !defined(dGeometryType_directVolume)
            if (gl_FragColor.a < 1.0) {
                // transparent objects are blended with background color
                gl_FragColor.a = fogAlpha;
            } else {
                // opaque objects need to be pre-multiplied alpha
                gl_FragColor.rgb *= fogAlpha;
                gl_FragColor.a = fogAlpha;
            }
        #else
            // pre-multiplied alpha expected for transparent background
            gl_FragColor.rgb *= fogAlpha;
            gl_FragColor.a = fogAlpha;
        #endif
    }
} else if (uTransparentBackground) {
    #if !defined(dRenderVariant_colorDpoit) && !defined(dGeometryType_directVolume)
        // pre-multiplied alpha expected for transparent background
        gl_FragColor.rgb *= gl_FragColor.a;
    #endif
}
`;var Wde=`
if (interior) {
    if (uInteriorColorFlag) {
        gl_FragColor.rgb = uInteriorColor;
    } else {
        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;
    }

    #ifdef dTransparentBackfaces_opaque
        gl_FragColor.a = 1.0;
    #endif
}
`;var Xde=`
#if defined(dIgnoreLight)
    #ifdef bumpEnabled
        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {
            material.rgb += fbm(vModelPosition * uBumpFrequency) * uBumpAmplitude * bumpiness;
            material.rgb -= 0.5 * uBumpAmplitude * bumpiness;
        }
    #endif

    #if defined(dRenderVariant_color)
        material.rgb += material.rgb * emissive;
    #endif

    gl_FragColor = material;
#else
    #ifdef bumpEnabled
        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {
            normal = perturbNormal(-vViewPosition, normal, fbm(vModelPosition * uBumpFrequency), (uBumpAmplitude * bumpiness) / uBumpFrequency);
        }
    #endif

    vec4 color = material;

    #if defined(dCelShaded)
        // clamp to avoid artifacts
        metalness = clamp(metalness, 0.0, 0.99);
        roughness = clamp(roughness, 0.05, 1.0);
    #endif

    GeometricContext geometry;
    geometry.position = -vViewPosition;
    geometry.normal = normal;
    geometry.viewDir = normalize(vViewPosition);

    PhysicalMaterial physicalMaterial;
    physicalMaterial.diffuseColor = color.rgb * (1.0 - metalness);
    #ifdef enabledFragDepth
        physicalMaterial.roughness = min(max(roughness, 0.0525), 1.0);
    #else
        vec3 dxy = max(abs(dFdx(normal)), abs(dFdy(normal)));
        float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);
        physicalMaterial.roughness = min(max(roughness, 0.0525) + geometryRoughness, 1.0);
    #endif
    physicalMaterial.specularColor = mix(vec3(0.04), color.rgb, metalness);
    physicalMaterial.specularF90 = 1.0;

    IncidentLight directLight;

    vec3 outgoingLight = vec3(0.0);

    #if defined(dCelShaded)
        float celDiffuse;
        float celSpecular;
        float celIntensity;

        #pragma unroll_loop_start
        for (int i = 0; i < dLightCount; ++i) {
            directLight.direction = uLightDirection[i];
            directLight.color = uLightColor[i] * PI; // * PI for punctual light

            celDiffuse = RECIPROCAL_PI * max(dot(geometry.normal, directLight.direction), 0.0) * (1.0 - metalness);
            celSpecular = luminance(saturate(dot(geometry.normal, directLight.direction)) * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, physicalMaterial.specularColor, physicalMaterial.specularF90, roughness));

            celIntensity = celDiffuse + celSpecular;
            celIntensity = ceil(celIntensity * uCelSteps) / uCelSteps;

            outgoingLight += color.rgb * directLight.color * celIntensity;
        }
        #pragma unroll_loop_end

        outgoingLight += physicalMaterial.diffuseColor * luminance(uAmbientColor);
    #else
        ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));

        #pragma unroll_loop_start
        for (int i = 0; i < dLightCount; ++i) {
            directLight.direction = uLightDirection[i];
            directLight.color = uLightColor[i] * PI; // * PI for punctual light
            RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);
        }
        #pragma unroll_loop_end

        vec3 irradiance = uAmbientColor * PI; // * PI for punctual light
        RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);

        // indirect specular only metals
        vec3 radiance = uAmbientColor * metalness;
        vec3 iblIrradiance = uAmbientColor * metalness;
        vec3 clearcoatRadiance = vec3(0.0);
        RE_IndirectSpecular_Physical(radiance, iblIrradiance, clearcoatRadiance, geometry, physicalMaterial, reflectedLight);

        outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;
    #endif
    outgoingLight = clamp(outgoingLight, 0.01, 0.99); // prevents black artifacts on specular highlight with transparent background

    #if defined(dRenderVariant_color)
        outgoingLight += color.rgb * emissive;
    #endif

    gl_FragColor = vec4(outgoingLight, color.a);
#endif

gl_FragColor.rgb *= uExposure;
`;var Qde=`

#if defined(dColorMarker)
    if (marker > 0.0) {
        if ((uMarkerPriority == 1 && marker != 2.0) || (uMarkerPriority != 1 && marker == 1.0)) {
            gl_FragColor.rgb = mix(gl_FragColor.rgb, uHighlightColor, uHighlightStrength);
            gl_FragColor.a = max(gl_FragColor.a, uHighlightStrength * 0.002); // for direct-volume rendering
        } else {
            gl_FragColor.rgb = mix(gl_FragColor.rgb, uSelectColor, uSelectStrength);
            gl_FragColor.a = max(gl_FragColor.a, uSelectStrength * 0.002); // for direct-volume rendering
        }
    } else if (uMarkerAverage > 0.0) {
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uDimColor, uDimStrength);
        gl_FragColor.a = max(gl_FragColor.a, uDimStrength * 0.002); // for direct-volume rendering
    }
#endif
`;var Zde=`
#if dClipObjectCount != 0 && defined(dClipping)
    #if defined(dClippingType_instance)
        vClipping = readFromTexture(tClipping, aInstance, uClippingTexDim).a;
    #elif defined(dMarkerType_groupInstance)
        vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;
    #endif
#endif
`;var qde=`
#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dColorType_attribute)
        vColor.rgb = aColor;
    #elif defined(dColorType_instance)
        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;
    #elif defined(dColorType_group)
        #if defined(dDualColor)
            vec4 color2;
            if (aColorMode == 2.0) {
                vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
            } else {
                vColor.rgb = readFromTexture(tColor, group * 2.0, uColorTexDim).rgb;
                color2.rgb = readFromTexture(tColor, group * 2.0 + 1.0, uColorTexDim).rgb;
            }
        #else
            vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
        #endif
    #elif defined(dColorType_groupInstance)
        #if defined(dDualColor)
            vec4 color2;
            if (aColorMode == 2.0) {
                vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
            } else {
                vColor.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0, uColorTexDim).rgb;
                color2.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0 + 1.0, uColorTexDim).rgb;
            }
        #else
            vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
        #endif
    #elif defined(dColorType_vertex)
        vColor.rgb = readFromTexture(tColor, vertexId, uColorTexDim).rgb;
    #elif defined(dColorType_vertexInstance)
        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + vertexId, uColorTexDim).rgb;
    #elif defined(dColorType_volume)
        vec3 cgridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;
    #elif defined(dColorType_volumeInstance)
        vec3 cgridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;
    #endif

    #ifdef dUsePalette
        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / PALETTE_SCALE;
    #endif

    #ifdef dOverpaint
        #if defined(dOverpaintType_instance)
            vOverpaint = readFromTexture(tOverpaint, aInstance, uOverpaintTexDim);
        #elif defined(dOverpaintType_groupInstance)
            vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);
        #elif defined(dOverpaintType_vertexInstance)
            vOverpaint = readFromTexture(tOverpaint, int(aInstance) * uVertexCount + vertexId, uOverpaintTexDim);
        #elif defined(dOverpaintType_volumeInstance)
            vec3 ogridPos = (uOverpaintGridTransform.w * (vModelPosition - uOverpaintGridTransform.xyz)) / uOverpaintGridDim;
            vOverpaint = texture3dFrom2dLinear(tOverpaintGrid, ogridPos, uOverpaintGridDim, uOverpaintTexDim);
        #endif

        // pre-mix to avoid darkening due to empty overpaint
        #ifdef dColorType_uniform
            vOverpaint.rgb = mix(uColor.rgb, vOverpaint.rgb, vOverpaint.a);
        #else
            vOverpaint.rgb = mix(vColor.rgb, vOverpaint.rgb, vOverpaint.a);
        #endif
        vOverpaint *= uOverpaintStrength;
    #endif

    #ifdef dEmissive
        #if defined(dEmissiveType_instance)
            vEmissive = readFromTexture(tEmissive, aInstance, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_groupInstance)
            vEmissive = readFromTexture(tEmissive, aInstance * float(uGroupCount) + group, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_vertexInstance)
            vEmissive = readFromTexture(tEmissive, int(aInstance) * uVertexCount + vertexId, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_volumeInstance)
            vec3 egridPos = (uEmissiveGridTransform.w * (vModelPosition - uEmissiveGridTransform.xyz)) / uEmissiveGridDim;
            vEmissive = texture3dFrom2dLinear(tEmissiveGrid, egridPos, uEmissiveGridDim, uEmissiveTexDim).a;
        #endif
        vEmissive *= uEmissiveStrength;
    #endif

    #ifdef dSubstance
        #if defined(dSubstanceType_instance)
            vSubstance = readFromTexture(tSubstance, aInstance, uSubstanceTexDim);
        #elif defined(dSubstanceType_groupInstance)
            vSubstance = readFromTexture(tSubstance, aInstance * float(uGroupCount) + group, uSubstanceTexDim);
        #elif defined(dSubstanceType_vertexInstance)
            vSubstance = readFromTexture(tSubstance, int(aInstance) * uVertexCount + vertexId, uSubstanceTexDim);
        #elif defined(dSubstanceType_volumeInstance)
            vec3 sgridPos = (uSubstanceGridTransform.w * (vModelPosition - uSubstanceGridTransform.xyz)) / uSubstanceGridDim;
            vSubstance = texture3dFrom2dLinear(tSubstanceGrid, sgridPos, uSubstanceGridDim, uSubstanceTexDim);
        #endif

        // pre-mix to avoid artifacts due to empty substance
        vSubstance.rgb = mix(vec3(uMetalness, uRoughness, uBumpiness), vSubstance.rgb, vSubstance.a);
        vSubstance *= uSubstanceStrength;
    #endif
#elif defined(dRenderVariant_emissive)
    #ifdef dEmissive
        #if defined(dEmissiveType_instance)
            vEmissive = readFromTexture(tEmissive, aInstance, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_groupInstance)
            vEmissive = readFromTexture(tEmissive, aInstance * float(uGroupCount) + group, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_vertexInstance)
            vEmissive = readFromTexture(tEmissive, int(aInstance) * uVertexCount + vertexId, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_volumeInstance)
            vec3 egridPos = (uEmissiveGridTransform.w * (vModelPosition - uEmissiveGridTransform.xyz)) / uEmissiveGridDim;
            vEmissive = texture3dFrom2dLinear(tEmissiveGrid, egridPos, uEmissiveGridDim, uEmissiveTexDim).a;
        #endif
        vEmissive *= uEmissiveStrength;
    #endif
#elif defined(dRenderVariant_pick)
    #ifdef requiredDrawBuffers
        vObject = vec4(packIntToRGB(float(uObjectId)), 1.0);
        vInstance = vec4(packIntToRGB(aInstance), 1.0);
        vGroup = vec4(packIntToRGB(group), 1.0);
    #else
        if (uPickType == 1) {
            vColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
        } else if (uPickType == 2) {
            vColor = vec4(packIntToRGB(aInstance), 1.0);
        } else {
            vColor = vec4(packIntToRGB(group), 1.0);
        }
    #endif
#endif

#ifdef dTransparency
    #if defined(dTransparencyType_instance)
        vTransparency = readFromTexture(tTransparency, aInstance, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_groupInstance)
        vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_vertexInstance)
        vTransparency = readFromTexture(tTransparency, int(aInstance) * uVertexCount + vertexId, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_volumeInstance)
        vec3 tgridPos = (uTransparencyGridTransform.w * (vModelPosition - uTransparencyGridTransform.xyz)) / uTransparencyGridDim;
        vTransparency = texture3dFrom2dLinear(tTransparencyGrid, tgridPos, uTransparencyGridDim, uTransparencyTexDim).a;
    #endif
    vTransparency *= uTransparencyStrength;
#endif
`;var Yde=`
#ifdef dGeometryType_textureMesh
    float group = unpackRGBToInt(readFromTexture(tGroup, vertexId, uGeoTexDim).rgb);
#else
    float group = aGroup;
#endif
`;var Kde=`
#if defined(dNeedsMarker)
    #if defined(dMarkerType_instance)
        vMarker = readFromTexture(tMarker, aInstance, uMarkerTexDim).a;
    #elif defined(dMarkerType_groupInstance)
        vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;
    #endif
#endif
`;var Jde=`
#if defined(dNeedsMarker)
    float marker = uMarker;
    if (uMarker == -1.0) {
        marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win
    }
#endif

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dUsePalette)
        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);
    #elif defined(dColorType_uniform)
        vec4 material = vec4(uColor, uAlpha);
    #elif defined(dColorType_varying)
        vec4 material = vec4(vColor.rgb, uAlpha);
    #endif

    // mix material with overpaint
    #if defined(dOverpaint)
        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);
    #endif

    float emissive = uEmissive;
    #ifdef dEmissive
        emissive += vEmissive;
    #endif

    float metalness = uMetalness;
    float roughness = uRoughness;
    float bumpiness = uBumpiness;
    #ifdef dSubstance
        float sf = clamp(vSubstance.a, 0.0, 0.99); // clamp to avoid artifacts
        metalness = mix(metalness, vSubstance.r, sf);
        roughness = mix(roughness, vSubstance.g, sf);
        bumpiness = mix(bumpiness, vSubstance.b, sf);
    #endif

    #if defined(dXrayShaded)
        material.a = calcXrayShadedAlpha(material.a, normal);
    #endif
#elif defined(dRenderVariant_depth)
    if (fragmentDepth > getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {
        discard;
    }
    vec4 material;
    if (uRenderMask == MaskOpaque) {
        #if defined(dXrayShaded)
            discard;
        #endif
        #if defined(dTransparency)
            float dta = 1.0 - vTransparency;
            #if __VERSION__ == 100 || defined(dVaryingGroup)
                if (vTransparency < 0.1) dta = 1.0; // hard cutoff to avoid artifacts
            #endif

            if (uAlpha * dta < 1.0) {
                discard;
            }
        #else
            if (uAlpha < 1.0) {
                discard;
            }
        #endif
        material = packDepthToRGBA(fragmentDepth);
    } else if (uRenderMask == MaskTransparent) {
        float alpha = uAlpha;
        #if defined(dTransparency)
            float dta = 1.0 - vTransparency;
            alpha *= dta;
        #endif

        #ifdef dXrayShaded
            alpha = calcXrayShadedAlpha(alpha, normal);
        #else
            if (alpha == 1.0) {
                discard;
            }
        #endif
        material = packDepthWithAlphaToRGBA(fragmentDepth, alpha);
    }
#elif defined(dRenderVariant_marking)
    vec4 material;
    if(uMarkingType == 1) {
        if (marker > 0.0)
            discard;
        #ifdef enabledFragDepth
            material = packDepthToRGBA(gl_FragDepthEXT);
        #else
            material = packDepthToRGBA(gl_FragCoord.z);
        #endif
    } else {
        if (marker == 0.0)
            discard;
        float depthTest = 1.0;
        if (uMarkingDepthTest) {
            depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;
        }
        bool isHighlight = intMod(marker, 2.0) > 0.1;
        float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
        float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
        if (fogFactor == 1.0)
            discard;
        material = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);
    }
#elif defined(dRenderVariant_emissive)
    float emissive = uEmissive;
    #ifdef dEmissive
        emissive += vEmissive;
    #endif
    vec4 material = vec4(emissive);
#endif

// apply per-group transparency
#if defined(dTransparency) && (defined(dRenderVariant_pick) || defined(dRenderVariant_color) || defined(dRenderVariant_emissive) || defined(dRenderVariant_tracing))
    float ta = 1.0 - vTransparency;
    if (vTransparency < 0.09) ta = 1.0; // hard cutoff looks better

    #if defined(dRenderVariant_pick)
        if (ta * uAlpha < uPickingAlphaThreshold)
            discard; // ignore so the element below can be picked
    #elif defined(dRenderVariant_emissive)
        if (ta < 1.0)
            discard; // emissive not supported with transparency
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        material.a *= ta;
    #endif
#endif
`;var $de=`
mat4 model = uModel * aTransform;
mat4 modelView = uView * model;
#ifdef dGeometryType_textureMesh
    vec3 position = readFromTexture(tPosition, vertexId, uGeoTexDim).xyz;
#else
    vec3 position = aPosition;
#endif
vec4 position4 = vec4(position, 1.0);
// for accessing tColorGrid in vert shader and for clipping in frag shader
vModelPosition = (model * position4).xyz;
vec4 mvPosition = modelView * position4;
vViewPosition = mvPosition.xyz;
gl_Position = uProjection * mvPosition;
`;var epe=`
#if defined(dSizeType_uniform)
    float size = uSize;
#elif defined(dSizeType_attribute)
    float size = aSize;
#elif defined(dSizeType_instance)
    float size = unpackRGBToInt(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);
#elif defined(dSizeType_group)
    float size = unpackRGBToInt(readFromTexture(tSize, group, uSizeTexDim).rgb);
#elif defined(dSizeType_groupInstance)
    float size = unpackRGBToInt(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);
#endif

#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    size /= 100.0; // NOTE factor also set in TypeScript
#endif

size *= uSizeFactor;
`;var tpe=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float fogAlpha = (1.0 - fogFactor) * uAlpha;
float alpha = uAlpha;
#ifdef dXrayShaded
    // add bias to make picking xray shaded elements easier
    alpha = calcXrayShadedAlpha(alpha, normal) + (0.3 * uPickingAlphaThreshold);
#endif
// if not opaque enough ignore so the element below can be picked
if (alpha < uPickingAlphaThreshold || fogAlpha < 0.1) {
    #ifdef dTransparentBackfaces_opaque
        if (!interior) discard;
    #else
        discard;
    #endif
}
`;var rpe=`
#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dTransparentBackfaces_off)
        if (interior && material.a < 1.0) discard;
    #elif defined(dTransparentBackfaces_opaque)
        if (interior) material.a = 1.0;
    #endif

    #if !defined(dXrayShaded)
        if ((uRenderMask == MaskOpaque && material.a < 1.0) ||
            (uRenderMask == MaskTransparent && material.a == 1.0)
        ) {
            discard;
        }
    #endif
#endif

#if defined(dRenderVariant_depth)
    #if defined(dTransparentBackfaces_off)
        if (interior) discard;
    #endif
#endif
`;var npe=`
#if defined(dClipVariant_instance) && dClipObjectCount != 0
    vec3 mCenter = (uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz;
    if (clipTest(mCenter)) {
        // move out of [ -w, +w ] to 'discard' in vert shader
        gl_Position.z = 2.0 * gl_Position.w;
    }
#endif
`;var ope=`
#if defined(dClipVariant_pixel) && dClipObjectCount != 0
    if (clipTest(vModelPosition))
        discard;
#endif
`;var ipe=`
uniform float uMetalness;
uniform float uRoughness;
uniform float uBumpiness;
#ifdef bumpEnabled
    uniform float uBumpFrequency;
    uniform float uBumpAmplitude;
#endif
uniform float uEmissive;

// Density value to estimate object thickness
uniform float uDensity;

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_varying)
        varying vec4 vColor;
    #endif

    #ifdef dUsePalette
        uniform sampler2D tPalette;
        varying float vPaletteV;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
    #endif

    #ifdef dEmissive
        varying float vEmissive;
    #endif

    #ifdef dSubstance
        varying vec4 vSubstance;
    #endif
#elif defined(dRenderVariant_emissive)
    #ifdef dEmissive
        varying float vEmissive;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100 || !defined(dVaryingGroup)
        #ifdef requiredDrawBuffers
            varying vec4 vObject;
            varying vec4 vInstance;
            varying vec4 vGroup;
        #else
            varying vec4 vColor;
        #endif
    #else
        #ifdef requiredDrawBuffers
            flat in vec4 vObject;
            flat in vec4 vInstance;
            flat in vec4 vGroup;
        #else
            flat in vec4 vColor;
        #endif
    #endif
#endif

#ifdef dTransparency
    varying float vTransparency;
#endif
`;var ape=`
uniform float uMetalness;
uniform float uRoughness;
uniform float uBumpiness;

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_attribute)
        varying vec4 vColor;
        attribute vec3 aColor;
    #elif defined(dColorType_texture)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #elif defined(dColorType_grid)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform vec3 uColorGridDim;
        uniform vec4 uColorGridTransform;
        uniform sampler2D tColorGrid;
    #elif defined(dColorType_direct)
        varying vec4 vColor;
    #endif

    #ifdef dUsePalette
        varying float vPaletteV;
    #endif

    #ifdef dOverpaint
        #if defined(dOverpaintType_instance) || defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform sampler2D tOverpaint;
        #elif defined(dOverpaintType_volumeInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform vec3 uOverpaintGridDim;
            uniform vec4 uOverpaintGridTransform;
            uniform sampler2D tOverpaintGrid;
        #endif
        uniform float uOverpaintStrength;
    #endif

    #ifdef dEmissive
        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance) || defined(dEmissiveType_vertexInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform sampler2D tEmissive;
        #elif defined(dEmissiveType_volumeInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform vec3 uEmissiveGridDim;
            uniform vec4 uEmissiveGridTransform;
            uniform sampler2D tEmissiveGrid;
        #endif
        uniform float uEmissiveStrength;
    #endif

    #ifdef dSubstance
        #if defined(dSubstanceType_instance) || defined(dSubstanceType_groupInstance) || defined(dSubstanceType_vertexInstance)
            varying vec4 vSubstance;
            uniform vec2 uSubstanceTexDim;
            uniform sampler2D tSubstance;
        #elif defined(dSubstanceType_volumeInstance)
            varying vec4 vSubstance;
            uniform vec2 uSubstanceTexDim;
            uniform vec3 uSubstanceGridDim;
            uniform vec4 uSubstanceGridTransform;
            uniform sampler2D tSubstanceGrid;
        #endif
        uniform float uSubstanceStrength;
    #endif
#elif defined(dRenderVariant_emissive)
    #ifdef dEmissive
        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance) || defined(dEmissiveType_vertexInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform sampler2D tEmissive;
        #elif defined(dEmissiveType_volumeInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform vec3 uEmissiveGridDim;
            uniform vec4 uEmissiveGridTransform;
            uniform sampler2D tEmissiveGrid;
        #endif
        uniform float uEmissiveStrength;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100 || !defined(dVaryingGroup)
        #ifdef requiredDrawBuffers
            varying vec4 vObject;
            varying vec4 vInstance;
            varying vec4 vGroup;
        #else
            varying vec4 vColor;
        #endif
    #else
        #ifdef requiredDrawBuffers
            flat out vec4 vObject;
            flat out vec4 vInstance;
            flat out vec4 vGroup;
        #else
            flat out vec4 vColor;
        #endif
    #endif
#endif

#ifdef dTransparency
    #if defined(dTransparencyType_instance) || defined(dTransparencyType_groupInstance) || defined(dTransparencyType_vertexInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform sampler2D tTransparency;
    #elif defined(dTransparencyType_volumeInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform vec3 uTransparencyGridDim;
        uniform vec4 uTransparencyGridTransform;
        uniform sampler2D tTransparencyGrid;
    #endif
    uniform float uTransparencyStrength;
#endif
`;var spe=`
vec3 quaternionTransform(const in vec4 q, const in vec3 v) {
    vec3 t = 2.0 * cross(q.xyz, v);
    return v + q.w * t + cross(q.xyz, t);
}

vec4 computePlane(const in vec3 normal, const in vec3 inPoint) {
    return vec4(normalize(normal), -dot(normal, inPoint));
}

float planeSD(const in vec4 plane, const in vec3 center) {
    return -dot(plane.xyz, center - plane.xyz * -plane.w);
}

float sphereSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
    return (
        length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0
    ) * min(min(size.x, size.y), size.z);
}

float cubeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
    vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;
    return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));
}

float cylinderSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
    vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

    vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;
    return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
}

float infiniteConeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
    vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

    float q = length(t.xy);
    return dot(size.xy, vec2(q, t.z));
}

float getSignedDistance(const in vec3 center, const in int type, const in vec3 position, const in vec4 rotation, const in vec3 scale, const in mat4 transform) {
    vec3 c = (transform * vec4(center, 1.0)).xyz;
    if (type == 1) {
        vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));
        vec4 plane = computePlane(normal, position);
        return planeSD(plane, c);
    } else if (type == 2) {
        return sphereSD(position, rotation, scale * 0.5, c);
    } else if (type == 3) {
        return cubeSD(position, rotation, scale * 0.5, c);
    } else if (type == 4) {
        return cylinderSD(position, rotation, scale * 0.5, c);
    } else if (type == 5) {
        return infiniteConeSD(position, rotation, scale * 0.5, c);
    } else {
        return 0.1;
    }
}

#if __VERSION__ == 100
    // 8-bit
    int bitwiseAnd(in int a, in int b) {
        int d = 128;
        int result = 0;
        for (int i = 0; i < 8; ++i) {
            if (d <= 0) break;
            if (a >= d && b >= d) result += d;
            if (a >= d) a -= d;
            if (b >= d) b -= d;
            d /= 2;
        }
        return result;
    }

    bool hasBit(const in int mask, const in int bit) {
        return bitwiseAnd(mask, bit) == 0;
    }
#else
    bool hasBit(const in int mask, const in int bit) {
        return (mask & bit) == 0;
    }
#endif

#if dClipObjectCount != 0
    bool clipTest(const in vec3 center) {
        // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)
        #if defined(dClipping)
            int flag = int(floor(vClipping * 255.0 + 0.5));
        #else
            int flag = 0;
        #endif

        #pragma unroll_loop_start
        for (int i = 0; i < dClipObjectCount; ++i) {
            if (flag == 0 || hasBit(flag, UNROLLED_LOOP_INDEX + 1)) {
                bool test = getSignedDistance(center, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i], uClipObjectTransform[i]) <= 0.0;
                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {
                    return true;
                }
            }
        }
        #pragma unroll_loop_end
        return false;
    }
#endif
`;var lpe=`
uniform int uObjectId;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform int uPickType;
uniform int uMarkingType;

uniform vec4 uCameraPlane;
uniform vec4 uLod;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
    uniform mat4 uClipObjectTransform[dClipObjectCount];

    #if defined(dClipping)
        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)
            varying float vClipping;
        #else
            flat in float vClipping;
        #endif
    #endif
#endif

#if defined(dColorMarker)
    uniform vec3 uHighlightColor;
    uniform vec3 uSelectColor;
    uniform vec3 uDimColor;
    uniform float uHighlightStrength;
    uniform float uSelectStrength;
    uniform float uDimStrength;
    uniform int uMarkerPriority;
    uniform float uMarkerAverage;
#endif

#if defined(dNeedsMarker)
    uniform float uMarker;
    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)
        varying float vMarker;
    #else
        flat in float vMarker;
    #endif
#endif

#if defined(dRenderVariant_colorDpoit)
    #define MAX_DPOIT_DEPTH 99999.0 // NOTE constant also set in TypeScript
    uniform sampler2D tDpoitDepth;
    uniform sampler2D tDpoitFrontColor;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform vec2 uViewOffset;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform bool uFog;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform bool uDoubleSided;
uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uXrayEdgeFalloff;
uniform float uCelSteps;
uniform float uExposure;

uniform mat4 uProjection;

uniform int uRenderMask;
uniform bool uMarkingDepthTest;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

float getDepthPacked(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}

// "Bump Mapping Unparametrized Surfaces on the GPU" Morten S. Mikkelsen
// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf
vec3 perturbNormal(in vec3 position, in vec3 normal, in float height, in float scale) {
    vec3 sigmaS = dFdx(position);
    vec3 sigmaT = dFdy(position);

    vec3 r1 = cross(sigmaT, normal);
    vec3 r2 = cross(normal, sigmaS);
    float det = dot(sigmaS, r1);
    if (det == 0.0) return normal;

    float bs = dFdx(height);
    float bt = dFdy(height);

    vec3 surfGrad = sign(det) * (bs * r1 + bt * r2);
    return normalize(abs(det) * normal - scale * surfGrad);
}

float hash(in float h) {
    return fract(sin(h) * 43758.5453123);
}

float noise(in vec3 x) {
    vec3 p = floor(x);
    vec3 f = fract(x);
    f = f * f * (3.0 - 2.0 * f);

    float n = p.x + p.y * 157.0 + 113.0 * p.z;
    return mix(
        mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),
            mix(hash(n + 157.0), hash(n + 158.0), f.x), f.y),
        mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),
            mix(hash(n + 270.0), hash(n + 271.0), f.x), f.y), f.z);
}

float fbm(in vec3 p) {
    float f = 0.0;
    f += 0.5 * noise(p);
    p *= 2.01;
    f += 0.25 * noise(p);
    p *= 2.02;
    f += 0.125 * noise(p);

    return f;
}

#ifdef dXrayShaded
    float calcXrayShadedAlpha(in float alpha, const in vec3 normal) {
        #if defined(dXrayShaded_on)
            alpha *= 1.0 - pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);
        #elif defined(dXrayShaded_inverted)
            alpha *= pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);
        #endif
        return clamp(alpha, 0.001, 0.999);
    }
#endif
`;var upe=`
uniform mat4 uProjection, uModel, uView;
uniform vec3 uCameraPosition;
uniform vec4 uCameraPlane;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;
uniform vec4 uInvariantBoundingSphere;
uniform vec4 uLod;

uniform bool uDoubleSided;
uniform int uPickType;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
    uniform mat4 uClipObjectTransform[dClipObjectCount];

    #if defined(dClipping)
        uniform vec2 uClippingTexDim;
        uniform sampler2D tClipping;
        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)
            varying float vClipping;
        #else
            flat out float vClipping;
        #endif
    #endif
#endif

#if defined(dNeedsMarker)
    uniform float uMarker;
    uniform vec2 uMarkerTexDim;
    uniform sampler2D tMarker;
    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)
        varying float vMarker;
    #else
        flat out float vMarker;
    #endif
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

#if defined(noNonInstancedActiveAttribs)
    // int() is needed for some Safari versions
    // see https://bugs.webkit.org/show_bug.cgi?id=244152
    #define VertexID int(gl_VertexID)
#else
    attribute float aVertex;
    #define VertexID int(aVertex)
#endif

#if defined(enabledMultiDraw)
    #define DrawID gl_DrawID
#else
    #define DrawID uDrawId
#endif
`;var cpe=`
// TODO find a better place for these convenience defines

#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit) || defined(dRenderVariant_colorDpoit)
    #define dRenderVariant_color
#endif

#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)
    #define dColorType_texture
#endif

#if defined(dColorType_volume) || defined(dColorType_volumeInstance)
    #define dColorType_grid
#endif

#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)
    #define dColorType_varying
#endif

#if ((defined(dRenderVariant_color) || defined(dRenderVariant_tracing)) && defined(dColorMarker)) || defined(dRenderVariant_marking)
    #define dNeedsMarker
#endif

#if defined(dXrayShaded_on) || defined(dXrayShaded_inverted)
    #define dXrayShaded
#endif

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing) || ((defined(dRenderVariant_depth) || defined(dRenderVariant_pick)) && defined(dXrayShaded))
    #define dNeedsNormal
#endif

#define MaskAll 0
#define MaskOpaque 1
#define MaskTransparent 2

//

#define PI 3.14159265
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6
#define ONE_MINUS_EPSILON 1.0 - EPSILON
#define TWO_PI 6.2831853
#define HALF_PI 1.570796325

#define PALETTE_SCALE 16777214.0 // (1 << 24) - 2

#define saturate(a) clamp(a, 0.0, 1.0)

#if __VERSION__ == 100
    #define round(x) floor((x) + 0.5)
#endif

float intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }
vec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }
float intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }
int imod(const in int a, const in int b) { return a - b * (a / b); }

float pow2(const in float x) { return x * x; }

vec3 packIntToRGB(in float value) {
    value = clamp(round(value), 0.0, 16777216.0 - 1.0) + 1.0;
    vec3 c = vec3(0.0);
    c.b = mod(value, 256.0);
    value = floor(value / 256.0);
    c.g = mod(value, 256.0);
    value = floor(value / 256.0);
    c.r = mod(value, 256.0);
    return c / 255.0;
}
float unpackRGBToInt(const in vec3 rgb) {
    return (floor(rgb.r * 255.0 + 0.5) * 256.0 * 256.0 + floor(rgb.g * 255.0 + 0.5) * 256.0 + floor(rgb.b * 255.0 + 0.5)) - 1.0;
}

vec2 packUnitIntervalToRG(const in float v) {
    vec2 enc;
    enc.xy = vec2(fract(v * 256.0), v);
    enc.y -= enc.x * (1.0 / 256.0);
    enc.xy *=  256.0 / 255.0;

    return enc;
}

float unpackRGToUnitInterval(const in vec2 enc) {
    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));
}

vec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {
    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);
    p = invProjection * p;
    return p.xyz / p.w;
}

const float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)
const vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);
const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);
const float ShiftRight8 = 1.0 / 256.0;

vec4 packDepthToRGBA(const in float v) {
    vec4 r = vec4(fract(v * PackFactors), v);
    r.yzw -= r.xyz * ShiftRight8; // tidy overflow
    return r * PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v) {
    return dot(v, UnpackFactors);
}

vec4 packDepthWithAlphaToRGBA(const in float depth, const in float alpha){
    vec3 r = vec3(fract(depth * PackFactors.yz), depth);
    r.yz -= r.xy * ShiftRight8; // tidy overflow
    return vec4(r * PackUpscale, alpha);
}
vec2 unpackRGBAToDepthWithAlpha(const in vec4 v) {
    return vec2(dot(v.xyz, UnpackFactors.yzw), v.w);
}

vec4 sRGBToLinear(const in vec4 c) {
    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);
}
vec4 linearTosRGB(const in vec4 c) {
    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);
}

float luminance(vec3 c) {
    // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance
    const vec3 W = vec3(0.2125, 0.7154, 0.0721);
    return dot(c, W);
}

float linearizeDepth(const in float depth, const in float near, const in float far) {
    return (2.0 * near) / (far + near - depth * (far - near));
}

float perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {
    return (near * far) / ((far - near) * invClipZ - far);
}

float orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {
    return linearClipZ * (near - far) - near;
}

float depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {
    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);
}

// see https://github.com/graphitemaster/normals_revisited and https://www.shadertoy.com/view/3s33zj
mat3 adjoint(const in mat4 m) {
    return mat3(
        cross(m[1].xyz, m[2].xyz),
        cross(m[2].xyz, m[0].xyz),
        cross(m[0].xyz, m[1].xyz)
    );
}

#if __VERSION__ == 100
    // transpose

    float transpose(const in float m) {
        return m;
    }

    mat2 transpose2(const in mat2 m) {
        return mat2(
            m[0][0], m[1][0],
            m[0][1], m[1][1]
        );
    }

    mat3 transpose3(const in mat3 m) {
        return mat3(
            m[0][0], m[1][0], m[2][0],
            m[0][1], m[1][1], m[2][1],
            m[0][2], m[1][2], m[2][2]
        );
    }

    mat4 transpose4(const in mat4 m) {
        return mat4(
            m[0][0], m[1][0], m[2][0], m[3][0],
            m[0][1], m[1][1], m[2][1], m[3][1],
            m[0][2], m[1][2], m[2][2], m[3][2],
            m[0][3], m[1][3], m[2][3], m[3][3]
        );
    }

    // inverse

    float inverse(const in float m) {
        return 1.0 / m;
    }

    mat2 inverse2(const in mat2 m) {
        return mat2(m[1][1],-m[0][1],
                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
    }

    mat3 inverse3(const in mat3 m) {
        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];
        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];
        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];

        float b01 = a22 * a11 - a12 * a21;
        float b11 = -a22 * a10 + a12 * a20;
        float b21 = a21 * a10 - a11 * a20;

        float det = a00 * b01 + a01 * b11 + a02 * b21;

        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
    }

    mat4 inverse4(const in mat4 m) {
        float
            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],

            b00 = a00 * a11 - a01 * a10,
            b01 = a00 * a12 - a02 * a10,
            b02 = a00 * a13 - a03 * a10,
            b03 = a01 * a12 - a02 * a11,
            b04 = a01 * a13 - a03 * a11,
            b05 = a02 * a13 - a03 * a12,
            b06 = a20 * a31 - a21 * a30,
            b07 = a20 * a32 - a22 * a30,
            b08 = a20 * a33 - a23 * a30,
            b09 = a21 * a32 - a22 * a31,
            b10 = a21 * a33 - a23 * a31,
            b11 = a22 * a33 - a23 * a32,

            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

        return mat4(
            a11 * b11 - a12 * b10 + a13 * b09,
            a02 * b10 - a01 * b11 - a03 * b09,
            a31 * b05 - a32 * b04 + a33 * b03,
            a22 * b04 - a21 * b05 - a23 * b03,
            a12 * b08 - a10 * b11 - a13 * b07,
            a00 * b11 - a02 * b08 + a03 * b07,
            a32 * b02 - a30 * b05 - a33 * b01,
            a20 * b05 - a22 * b02 + a23 * b01,
            a10 * b10 - a11 * b08 + a13 * b06,
            a01 * b08 - a00 * b10 - a03 * b06,
            a30 * b04 - a31 * b02 + a33 * b00,
            a21 * b02 - a20 * b04 - a23 * b00,
            a11 * b07 - a10 * b09 - a12 * b06,
            a00 * b09 - a01 * b07 + a02 * b06,
            a31 * b01 - a30 * b03 - a32 * b00,
            a20 * b03 - a21 * b01 + a22 * b00) / det;
    }

    #define isNaN(x) ((x) != (x))
    #define isInf(x) ((x) == (x) + 1.0)
#else
    #define transpose2(m) transpose(m)
    #define transpose3(m) transpose(m)
    #define transpose4(m) transpose(m)

    #define inverse2(m) inverse(m)
    #define inverse3(m) inverse(m)
    #define inverse4(m) inverse(m)

    #define isNaN isnan
    #define isInf isinf
#endif
`;var mpe=`
if (uLod.w == 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {
    float d = dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w;
    float ta = min(
        smoothstep(uLod.x, uLod.x + uLod.z, d),
        1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)
    );

    #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        float at = 0.0;

        // shift by view-offset during multi-sample rendering to allow for blending
        vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;

        const mat4 thresholdMatrix = mat4(
            1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,
            13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,
            4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,
            16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0
        );
        int ci = int(intMod(coord.x, 4.0));
        int ri = int(intMod(coord.y, 4.0));
        #if __VERSION__ == 100
            vec4 i = vec4(float(ci * 4 + ri));
            vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +
                thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +
                thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +
                thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));
            at = v.x + v.y + v.z + v.w;
        #else
            at = thresholdMatrix[ci][ri];
        #endif

        if (ta < 0.99 && (ta < 0.01 || ta < at)) {
            discard;
        }
    #else
        if (ta < uPickingAlphaThreshold) {
            discard;
        }
    #endif
}
`;var dpe=`
    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba
    // MIT License, Copyright (c) 2020 Equinor

    float shiftRight (float v, float amt) {
    v = floor(v) + 0.5;
    return floor(v / exp2(amt));
    }
    float shiftLeft (float v, float amt) {
        return floor(v * exp2(amt) + 0.5);
    }
    float maskLast (float v, float bits) {
        return mod(v, shiftLeft(1.0, bits));
    }
    float extractBits (float num, float from, float to) {
        from = floor(from + 0.5); to = floor(to + 0.5);
        return maskLast(shiftRight(num, from), to - from);
    }

    vec4 floatToRgba(float texelFloat, bool littleEndian) {
        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);
        float sign = texelFloat > 0.0 ? 0.0 : 1.0;
        texelFloat = abs(texelFloat);
        float exponent = floor(log2(texelFloat));
        float biased_exponent = exponent + 127.0;
        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;
        float t = biased_exponent / 2.0;
        float last_bit_of_biased_exponent = fract(t) * 2.0;
        float remaining_bits_of_biased_exponent = floor(t);
        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;
        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;
        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;
        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;
        return (
            littleEndian
                ? vec4(byte4, byte3, byte2, byte1)
                : vec4(byte1, byte2, byte3, byte4)
        );
    }
`;var ppe=`
#if dLightCount != 0
    uniform vec3 uLightDirection[dLightCount];
    uniform vec3 uLightColor[dLightCount];
#endif
uniform vec3 uAmbientColor;

struct PhysicalMaterial {
    vec3 diffuseColor;
    float roughness;
    vec3 specularColor;
    float specularF90;
};

struct IncidentLight {
    vec3 color;
    vec3 direction;
};

struct ReflectedLight {
    vec3 directDiffuse;
    vec3 directSpecular;
    vec3 indirectDiffuse;
    vec3 indirectSpecular;
};

struct GeometricContext {
    vec3 position;
    vec3 normal;
    vec3 viewDir;
};

vec3 BRDF_Lambert(const in vec3 diffuseColor) {
    return RECIPROCAL_PI * diffuseColor;
}

vec3 F_Schlick(const in vec3 f0, const in float f90, const in float dotVH) {
    // Original approximation by Christophe Schlick '94
    // float fresnel = pow( 1.0 - dotVH, 5.0 );
    // Optimized variant (presented by Epic at SIGGRAPH '13)
    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
    float fresnel = exp2((-5.55473 * dotVH - 6.98316) * dotVH);
    return f0 * (1.0 - fresnel) + (f90 * fresnel);
}

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float V_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {
    float a2 = pow2(alpha);
    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));
    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));
    return 0.5 / max(gv + gl, EPSILON);
}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disney\u2019s reparameterization
float D_GGX(const in float alpha, const in float dotNH) {
    float a2 = pow2(alpha);
    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1
    return RECIPROCAL_PI * a2 / pow2(denom);
}

// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility
vec3 BRDF_GGX(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness) {
    float alpha = pow2(roughness); // UE4's roughness
    vec3 halfDir = normalize( lightDir + viewDir);
    float dotNL = saturate(dot(normal, lightDir));
    float dotNV = saturate(dot(normal, viewDir));
    float dotNH = saturate(dot(normal, halfDir));
    float dotVH = saturate(dot(viewDir, halfDir));
    vec3 F = F_Schlick(f0, f90, dotVH);
    float V = V_GGX_SmithCorrelated(alpha, dotNL, dotNV);
    float D = D_GGX(alpha, dotNH);
    return F * (V * D);
}

// Analytical approximation of the DFG LUT, one half of the
// split-sum approximation used in indirect specular lighting.
// via 'environmentBRDF' from "Physically Based Shading on Mobile"
// https://www.unrealengine.com/blog/physically-based-shading-on-mobile
vec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {
    float dotNV = saturate(dot(normal, viewDir));
    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);
    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
    vec4 r = roughness * c0 + c1;
    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;
    vec2 fab = vec2(-1.04, 1.04) * a004 + r.zw;
    return fab;
}

// Fdez-Ag\xFCera's "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"
// Approximates multiscattering in order to preserve energy.
// http://www.jcgt.org/published/0008/01/03/
void computeMultiscattering(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {
    vec2 fab = DFGApprox(normal, viewDir, roughness);
    vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
    float Ess = fab.x + fab.y;
    float Ems = 1.0 - Ess;
    vec3 Favg = specularColor + (1.0 - specularColor) * 0.047619; // 1/21
    vec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);
    singleScatter += FssEss;
    multiScatter += Fms * Ems;
}

void RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    float dotNL = saturate(dot(geometry.normal, directLight.direction));
    vec3 irradiance = dotNL * directLight.color;
    reflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);
    reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}

void RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}

void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    // Both indirect specular and indirect diffuse light accumulate here
    vec3 singleScattering = vec3(0.0);
    vec3 multiScattering = vec3(0.0);
    vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
    computeMultiscattering(geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering);
    vec3 diffuse = material.diffuseColor * (1.0 - ( singleScattering + multiScattering));
    reflectedLight.indirectSpecular += radiance * singleScattering;
    reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
    reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
`;var fpe=`
float matrixScale(in mat4 m){
    vec4 r = m[0];
    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);
}
`;var hpe=`
varying vec3 vNormal;
`;var gpe=`
vec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {
    float x = intMod(i, dim.x);
    float y = floor(intDiv(i, dim.x));
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}

vec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {
    int x = imod(i, int(dim.x));
    int y = i / int(dim.x);
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}
`;var ype=`
    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float
    // BSD 3-Clause License
    //
    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.
    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
    //
    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
    // OF THE POSSIBILITY OF SUCH DAMAGE.

    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {
        ivec4 bytes = ivec4(inputFloats * 255.0);
        return (
            littleEndian
                ? bytes.abgr
                : bytes
        );
    }

    // Break the four bytes down into an array of 32 bits.
    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {
        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {
            float acc = float(bytes[channelIndex]);
            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {
                float powerOfTwo = exp2(float(indexInByte));
                bool bit = acc >= powerOfTwo;
                bits[channelIndex * 8 + (7 - indexInByte)] = bit;
                acc = mod(acc, powerOfTwo);
            }
        }
    }

    // Compute the exponent of the 32-bit float.
    float getExponent(bool bits[32]) {
        const int startIndex = 1;
        const int bitStringLength = 8;
        const int endBeforeIndex = startIndex + bitStringLength;
        float acc = 0.0;
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Compute the mantissa of the 32-bit float.
    float getMantissa(bool bits[32], bool subnormal) {
        const int startIndex = 9;
        const int bitStringLength = 23;
        const int endBeforeIndex = startIndex + bitStringLength;
        // Leading/implicit/hidden bit convention:
        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.
        float acc = float(!subnormal) * exp2(float(bitStringLength));
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Parse the float from its 32 bits.
    float bitsToFloat(bool bits[32]) {
        float signBit = float(bits[0]) * -2.0 + 1.0;
        float exponent = getExponent(bits);
        bool subnormal = abs(exponent - 0.0) < 0.01;
        float mantissa = getMantissa(bits, subnormal);
        float exponentBias = 127.0;
        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);
    }

    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {
        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);
        bool bits[32];
        bytesToBits(rgbaBytes, bits);
        return bitsToFloat(bits);
    }
`;var bpe=`
#if defined(dSizeType_uniform)
    uniform float uSize;
#elif defined(dSizeType_attribute)
    attribute float aSize;
#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    uniform vec2 uSizeTexDim;
    uniform sampler2D tSize;
#endif

uniform float uSizeFactor;
`;var xpe=`
vec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {
    float gdYZ = gridDim.z * gridDim.y;
    float gdZ = gridDim.z;
    vec3 p0 = floor(pos * gridDim);
    vec3 p1 = ceil(pos * gridDim);
    vec3 pd = (pos * gridDim - p0) / (p1 - p0);
    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s00 = mix(s000, s100, pd.x);
    vec4 s01 = mix(s001, s101, pd.x);
    vec4 s10 = mix(s010, s110, pd.x);
    vec4 s11 = mix(s011, s111, pd.x);
    vec4 s0 = mix(s00, s10, pd.y);
    vec4 s1 = mix(s01, s11, pd.y);
    return mix(s0, s1, pd.z);
}
`;var Cpe=`
vec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice0 = floor(pos.z * gridDim.z);
    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;
    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));
    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color0 = texture2D(tex, coord0);

    float zSlice1 = zSlice0 + 1.0;
    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;
    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));
    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color1 = texture2D(tex, coord1);

    float delta0 = abs((pos.z * gridDim.z) - zSlice0);
    return mix(color0, color1, delta0);
}
`;var Spe=`
vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;
    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    return texture2D(tex, coord);
}
`;var vpe=`
#if defined(dRenderVariant_colorWboit)
    if (uRenderMask == MaskOpaque) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderMask == MaskTransparent) {
        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {
            #ifdef dTransparentBackfaces_off
                if (interior) discard;
            #endif
            float alpha = gl_FragColor.a;
            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);
            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);
            // extra alpha is to handle pre-multiplied alpha
            #ifndef dGeometryType_directVolume
                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);
            #else
                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);
            #endif
        } else {
            discard;
        }
    }
#endif
`;var Ipe=`
#if defined(dRenderVariant_colorDpoit)
    if (uRenderMask == MaskOpaque) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderMask == MaskTransparent) {
        vec2 coords = gl_FragCoord.xy / uDrawingBufferSize;
        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(coords)) {
            #ifdef dTransparentBackfaces_off
                if (interior) discard;
            #endif

            // adapted from https://github.com/tsherif/webgl2examples
            // The MIT License, Copyright 2017 Tarek Sherif, Shuai Shao

            vec2 lastDepth = texture2D(tDpoitDepth, coords).rg;
            vec4 lastFrontColor = texture2D(tDpoitFrontColor, coords);

            vec4 fragColor = gl_FragColor;

            // depth value always increases
            // so we can use MAX blend equation
            gl_FragData[2].rg = vec2(-MAX_DPOIT_DEPTH);

            // front color always increases
            // so we can use MAX blend equation
            gl_FragColor = lastFrontColor;

            // back color is separately blend afterwards each pass
            gl_FragData[1] = vec4(0.0);

            float nearestDepth = -lastDepth.x;
            float furthestDepth = lastDepth.y;
            float alphaMultiplier = 1.0 - lastFrontColor.a;

            if (fragmentDepth < nearestDepth || fragmentDepth > furthestDepth) {
                // Skip this depth since it's been peeled.
                return;
            }

            if (fragmentDepth > nearestDepth && fragmentDepth < furthestDepth) {
                // This needs to be peeled.
                // The ones remaining after MAX blended for
                // all need-to-peel will be peeled next pass.
                gl_FragData[2].rg = vec2(-fragmentDepth, fragmentDepth);
                return;
            }

            // write to back and front color buffer
            if (fragmentDepth == nearestDepth) {
                gl_FragColor.rgb += fragColor.rgb * fragColor.a * alphaMultiplier;
                gl_FragColor.a = 1.0 - alphaMultiplier * (1.0 - fragColor.a);
            } else {
                gl_FragData[1] += fragColor;
            }

        } else {
            discard;
        }
    }
#endif
`;var Ape=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform vec4 uViewport;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

void main(){
    int vertexId = VertexID;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_size

    #ifdef dPointSizeAttenuation
        gl_PointSize = size * uPixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 5.0;
    #else
        gl_PointSize = size * uPixelRatio;
    #endif
    gl_PointSize = max(1.0, gl_PointSize);

    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`;var Tpe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

const vec2 center = vec2(0.5);
const float radius = 0.5;

void main(){
    #include fade_lod
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dPointStyle_circle)
        float dist = distance(gl_PointCoord, center);
        if (dist > radius) discard;
    #elif defined(dPointStyle_fuzzy)
        float dist = distance(gl_PointCoord, center);
        float fuzzyAlpha = 1.0 - smoothstep(0.0, radius, dist);
        if (fuzzyAlpha < 0.0001) discard;
    #endif

    #if defined(dPointStyle_fuzzy) && (defined(dRenderVariant_color) || defined(dRenderVariant_tracing))
        material.a *= fuzzyAlpha;
    #endif

    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        gl_FragColor = material;
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normalize(vViewPosition), emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var Ppe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;
uniform mat4 uInvProjection;
uniform float uIsOrtho;
uniform bool uHasHeadRotation;
uniform mat4 uInvHeadRotation;

uniform vec2 uTexDim;
uniform sampler2D tPositionGroup;

attribute mat4 aTransform;
attribute float aInstance;

varying float vRadius;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#include matrix_scale

/**
 * Bounding rectangle of a clipped, perspective-projected 3D Sphere.
 * Michael Mara, Morgan McGuire. 2013
 *
 * Specialization by Arseny Kapoulkine, MIT License Copyright (c) 2018
 * https://github.com/zeux/niagara
 */
void sphereProjection(const in vec3 p, const in float r, const in vec2 mapping) {
    vec3 pr = p * r;
    float pzr2 = p.z * p.z - r * r;

    float vx = sqrt(p.x * p.x + pzr2);
    float minx = ((vx * p.x - pr.z) / (vx * p.z + pr.x)) * uProjection[0][0];
    float maxx = ((vx * p.x + pr.z) / (vx * p.z - pr.x)) * uProjection[0][0];

    float vy = sqrt(p.y * p.y + pzr2);
    float miny = ((vy * p.y - pr.z) / (vy * p.z + pr.y)) * uProjection[1][1];
    float maxy = ((vy * p.y + pr.z) / (vy * p.z - pr.y)) * uProjection[1][1];

    gl_Position.xy = vec2(maxx + minx, maxy + miny) * -0.5;
    gl_Position.xy -= mapping * vec2(maxx - minx, maxy - miny) * 0.5;
    gl_Position.xy *= gl_Position.w;
}

void main(void){
    vec2 mapping = vec2(1.0, 1.0); // vertices 2 and 5
    #if __VERSION__ == 100
        int m = imod(VertexID, 6);
    #else
        int m = VertexID % 6;
    #endif
    if (m == 0) {
        mapping = vec2(-1.0, 1.0);
    } else if (m == 1 || m == 3) {
        mapping = vec2(-1.0, -1.0);
    } else if (m == 4) {
        mapping = vec2(1.0, -1.0);
    }

    int vertexId = VertexID / 6;

    vec4 positionGroup = readFromTexture(tPositionGroup, vertexId, uTexDim);
    vec3 position = positionGroup.rgb;
    float group = positionGroup.a;

    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vRadius = size * matrixScale(uModel);

    vec4 position4 = vec4(position, 1.0);
    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    float d;
    if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {
        d = dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w;
        float f = min(
            smoothstep(uLod.x, uLod.x + uLod.z, d),
            1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)
        ) * uLod.w;
        vRadius *= f;
    }

    vec4 mvPosition = uModelView * aTransform * position4;

    #ifdef dApproximate
        vec4 mvCorner = vec4(mvPosition.xyz, 1.0);
        mvCorner.xy += mapping * vRadius;
        gl_Position = uProjection * mvCorner;
    #else
        if (uIsOrtho == 1.0) {
            vec4 mvCorner = vec4(mvPosition.xyz, 1.0);
            mvCorner.xy += mapping * vRadius;
            gl_Position = uProjection * mvCorner;
        } else if (uHasHeadRotation) {
            vec4 mvCorner = vec4(mvPosition.xyz, 1.0);
            mvCorner.xy += mapping * vRadius * 1.4;
            gl_Position = uProjection * mvCorner;
        } else {
            gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
            sphereProjection(mvPosition.xyz, vRadius, mapping);
        }
    #endif

    vec4 vPoint4 = uInvProjection * gl_Position;
    vPoint = vPoint4.xyz / vPoint4.w;
    vPointViewPosition = -mvPosition.xyz / mvPosition.w;

    if (gl_Position.z < -gl_Position.w) {
        mvPosition.z -= 2.0 * vRadius; // avoid clipping
        gl_Position.z = (uProjection * vec4(mvPosition.xyz, 1.0)).z;
    }

    if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {
        if (d < uLod.x || d > uLod.y) {
            // move out of [ -w, +w ] to 'discard' in vert shader
            gl_Position.z = 2.0 * gl_Position.w;
        }
    }

    #if defined(dClipPrimitive) && !defined(dClipVariant_instance) && dClipObjectCount != 0
        if (clipTest(vModelPosition)) {
            // move out of [ -w, +w ] to 'discard' in vert shader
            gl_Position.z = 2.0 * gl_Position.w;
        }
    #else
        #include clip_instance
    #endif
}
`;var _pe=`
precision highp float;
precision highp int;

#define bumpEnabled

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip

uniform mat4 uInvView;
uniform float uAlphaThickness;

varying float vRadius;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#ifdef dSolidInterior
    const bool solidInterior = true;
#else
    const bool solidInterior = false;
#endif

bool SphereImpostor(out vec3 modelPos, out vec3 cameraPos, out vec3 cameraNormal, out bool interior, out float fragmentDepth){
    vec3 cameraSpherePos = -vPointViewPosition;

    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);
    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);
    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);

    float B = dot(rayDirection, cameraSphereDir);
    float det = B * B + vRadius * vRadius - dot(cameraSphereDir, cameraSphereDir);

    if (det < 0.0) return false;

    float sqrtDet = sqrt(det);
    float posT = mix(B + sqrtDet, B - sqrtDet, uIsOrtho);
    float negT = mix(B - sqrtDet, B + sqrtDet, uIsOrtho);

    cameraPos = rayDirection * negT + rayOrigin;
    modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;
    fragmentDepth = calcDepth(cameraPos);

    bool objectClipped = false;

    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0
        if (clipTest(modelPos)) {
            objectClipped = true;
            fragmentDepth = -1.0;
        }
    #endif

    if (fragmentDepth > 0.0) {
        cameraNormal = normalize(cameraPos - cameraSpherePos);
        interior = false;
        return true;
    } else if (uDoubleSided || solidInterior) {
        cameraPos = rayDirection * posT + rayOrigin;
        modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;
        fragmentDepth = calcDepth(cameraPos);
        cameraNormal = -normalize(cameraPos - cameraSpherePos);
        interior = true;
        if (fragmentDepth > 0.0) {
            #ifdef dSolidInterior
                if (!objectClipped) {
                    fragmentDepth = 0.0 + (0.0000001 / vRadius);
                    cameraNormal = -mix(normalize(vPoint), vec3(0.0, 0.0, -1.0), uIsOrtho);
                }
            #endif
            return true;
        }
    }

    return false;
}

void main(void){
    vec3 cameraNormal;
    float fragmentDepth;

    #ifdef dApproximate
        vec3 pointDir = -vPointViewPosition - vPoint;
        if (dot(pointDir, pointDir) > vRadius * vRadius) discard;
        vec3 vViewPosition = -vPointViewPosition;
        fragmentDepth = gl_FragCoord.z;
        #if !defined(dIgnoreLight) || defined(dXrayShaded) || defined(dRenderVariant_tracing)
            pointDir.z -= cos(length(pointDir)) * vRadius * 0.5;
            cameraNormal = -normalize(pointDir);
        #endif
        interior = false;
    #else
        vec3 modelPos;
        vec3 cameraPos;
        bool hit = SphereImpostor(modelPos, cameraPos, cameraNormal, interior, fragmentDepth);
        if (!hit) discard;

        if (fragmentDepth < 0.0) discard;
        if (fragmentDepth > 1.0) discard;

        gl_FragDepthEXT = fragmentDepth;

        vec3 vModelPosition = modelPos;
        vec3 vViewPosition = cameraPos;
    #endif

    #include fade_lod
    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0
        #include clip_pixel
    #endif

    #ifdef dNeedsNormal
        vec3 normal = -cameraNormal;
    #endif

    #include assign_material_color

    #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        if (uRenderMask == MaskTransparent && uAlphaThickness > 0.0) {
            material.a *= min(1.0, vRadius / uAlphaThickness);
        }
    #endif

    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        #include apply_light_color
        #include apply_interior_color
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normal, emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var Rpe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec3 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;
attribute float aScale;
attribute float aCap;
attribute float aColorMode;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform float uIsOrtho;
uniform vec3 uCameraDir;

#include matrix_scale

void main() {
    int vertexId = VertexID;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelTransform = uModel * aTransform;

    vTransform = modelTransform;
    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;
    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;
    vSize = size * aScale * matrixScale(uModel);
    vCap = aCap;

    vModelPosition = (vStart + vEnd) * 0.5;
    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 dir = vEnd - vStart;
    float f = aMapping.x > 0.0 ? 1.0 : 0.0;
    // ensure cylinder 'dir' is pointing towards the camera
    if(dot(camDir, dir) < 0.0) {
        dir = -dir;
        f = 1.0 - f;
    }

    vec3 left = cross(camDir, dir);
    vec3 up = cross(left, dir);
    left = vSize * normalize(left);
    up = vSize * normalize(up);

    // move vertex in object-space from center to corner
    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;

    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);
    vViewPosition = mvPosition.xyz;
    gl_Position = uProjection * mvPosition;

    if (gl_Position.z < -gl_Position.w) {
        mvPosition.z -= 2.0 * (length(vEnd - vStart) + vSize); // avoid clipping
        gl_Position.z = (uProjection * mvPosition).z;
    }

    #if defined(dDualColor) && defined(dRenderVariant_color) && (defined(dColorType_group) || defined(dColorType_groupInstance))
        // dual-color mixing
        // - for aColorMode between 0 and 1 use aColorMode to interpolate
        // - for aColorMode == 2 do nothing, i.e., use vColor
        // - for aColorMode == 3 use position on cylinder axis to interpolate
        if (aColorMode <= 1.0){
            vColor.rgb = mix(vColor.rgb, color2.rgb, aColorMode);
        } else if (aColorMode == 3.0) {
            vColor.rgb = mix(vColor.rgb, color2.rgb, mix(-0.25, 1.25, f / 1.5));
        }
    #endif

    #include clip_instance
}
`;var Dpe=`
precision highp float;
precision highp int;

#define bumpEnabled

uniform mat4 uView;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform vec3 uCameraDir;
uniform vec3 uCameraPosition;
uniform mat4 uInvView;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip

#ifdef dSolidInterior
    const bool solidInterior = true;
#else
    const bool solidInterior = false;
#endif

// adapted from https://www.shadertoy.com/view/4lcSRn
// The MIT License, Copyright 2016 Inigo Quilez
bool CylinderImpostor(
    in vec3 rayOrigin, in vec3 rayDir,
    in vec3 start, in vec3 end, in float radius,
    out vec3 cameraNormal, out bool interior,
    out vec3 modelPosition, out vec3 viewPosition, out float fragmentDepth
){
    vec3 ba = end - start;
    vec3 oc = rayOrigin - start;

    float baba = dot(ba, ba);
    float bard = dot(ba, rayDir);
    float baoc = dot(ba, oc);

    float k2 = baba - bard * bard;
    float k1 = baba * dot(oc, rayDir) - baoc * bard;
    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;

    float h = k1 * k1 - k2 * k0;
    if (h < 0.0) return false;

    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;
    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;

    #ifdef dSolidInterior
        bool topInterior = !topCap;
        bool bottomInterior = !bottomCap;
        topCap = true;
        bottomCap = true;
    #else
        bool topInterior = false;
        bool bottomInterior = false;
    #endif

    bool clipped = false;
    bool objectClipped = false;

    // body outside
    h = sqrt(h);
    float t = (-k1 - h) / k2;
    float y = baoc + t * bard;
    if (y > 0.0 && y < baba) {
        interior = false;
        cameraNormal = (oc + t * rayDir - ba * y / baba) / radius;
        modelPosition = rayOrigin + t * rayDir;
        viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
        fragmentDepth = calcDepth(viewPosition);
        #if defined(dClipVariant_pixel) && dClipObjectCount != 0
            if (clipTest(modelPosition)) {
                objectClipped = true;
                fragmentDepth = -1.0;
                #ifdef dSolidInterior
                    topCap = !topInterior;
                    bottomCap = !bottomInterior;
                #endif
            }
        #endif
        if (fragmentDepth > 0.0) return true;
        clipped = true;
    }

    if (!clipped) {
        if (topCap && y < 0.0) {
            // top cap
            t = -baoc / bard;
            if (abs(k1 + k2 * t) < h) {
                interior = topInterior;
                cameraNormal = -ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    if (clipTest(modelPosition)) {
                        objectClipped = true;
                        fragmentDepth = -1.0;
                        #ifdef dSolidInterior
                            topCap = !topInterior;
                            bottomCap = !bottomInterior;
                        #endif
                    }
                #endif
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (interior) cameraNormal = -rayDir;
                    #endif
                    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                        return true;
                    #else
                        return !interior;
                    #endif
                }
            }
        } else if (bottomCap && y >= 0.0) {
            // bottom cap
            t = (baba - baoc) / bard;
            if (abs(k1 + k2 * t) < h) {
                interior = bottomInterior;
                cameraNormal = ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    if (clipTest(modelPosition)) {
                        objectClipped = true;
                        fragmentDepth = -1.0;
                        #ifdef dSolidInterior
                            topCap = !topInterior;
                            bottomCap = !bottomInterior;
                        #endif
                    }
                #endif
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (interior) cameraNormal = -rayDir;
                    #endif
                    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                        return true;
                    #else
                        return !interior;
                    #endif
                }
            }
        }
    }

    if (uDoubleSided || solidInterior) {
        // body inside
        h = -h;
        t = (-k1 - h) / k2;
        y = baoc + t * bard;
        if (y > 0.0 && y < baba) {
            interior = true;
            cameraNormal = -(oc + t * rayDir - ba * y / baba) / radius;
            modelPosition = rayOrigin + t * rayDir;
            viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
            fragmentDepth = calcDepth(viewPosition);
            if (fragmentDepth > 0.0) {
                #ifdef dSolidInterior
                    if (!objectClipped) {
                        fragmentDepth = 0.0 + (0.0000002 / vSize);
                        cameraNormal = -rayDir;
                    }
                #endif
                return true;
            }
        }

        if (topCap && y < 0.0) {
            // top cap
            t = -baoc / bard;
            if (abs(k1 + k2 * t) < -h) {
                interior = true;
                cameraNormal = ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (!objectClipped) {
                            fragmentDepth = 0.0 + (0.0000002 / vSize);
                            cameraNormal = -rayDir;
                        }
                    #endif
                    return true;
                }
            }
        } else if (bottomCap && y >= 0.0) {
            // bottom cap
            t = (baba - baoc) / bard;
            if (abs(k1 + k2 * t) < -h) {
                interior = true;
                cameraNormal = -ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (!objectClipped) {
                            fragmentDepth = 0.0 + (0.0000002 / vSize);
                            cameraNormal = -rayDir;
                        }
                    #endif
                    return true;
                }
            }
        }
    }

    return false;
}

void main() {
    vec3 rayOrigin = vModelPosition;
    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);

    vec3 cameraNormal;
    vec3 modelPosition;
    vec3 viewPosition;
    float fragmentDepth;
    bool hit = CylinderImpostor(rayOrigin, rayDir, vStart, vEnd, vSize, cameraNormal, interior, modelPosition, viewPosition, fragmentDepth);
    if (!hit) discard;

    if (fragmentDepth < 0.0) discard;
    if (fragmentDepth > 1.0) discard;

    gl_FragDepthEXT = fragmentDepth;

    vec3 vViewPosition = viewPosition;
    vec3 vModelPosition = modelPosition;

    #include fade_lod
    #include clip_pixel

    #ifdef dNeedsNormal
        mat3 normalMatrix = adjoint(uView);
        vec3 normal = normalize(normalMatrix * -normalize(cameraNormal));
    #endif

    #include assign_material_color
    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        #include apply_light_color
        #include apply_interior_color
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normal, emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var wpe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute float aDepth;
attribute vec2 aTexCoord;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

uniform float uOffsetX;
uniform float uOffsetY;
uniform float uOffsetZ;

uniform float uIsOrtho;
uniform float uPixelRatio;
uniform vec4 uViewport;
uniform mat4 uInvHeadRotation;

varying vec2 vTexCoord;

#include matrix_scale

void main(void){
    int vertexId = VertexID;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vTexCoord = aTexCoord;

    float scale = matrixScale(uModelView);

    float offsetX = uOffsetX * scale;
    float offsetY = uOffsetY * scale;
    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // TODO
    // #ifdef FIXED_SIZE
    //     if (ortho) {
    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -uCameraPosition.z) * 0.1;
    //     } else {
    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 0.1;
    //     }
    // #endif

    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);

    if (vTexCoord.x == 10.0) { // indicates background plane
        // move a bit to the back, taking distance to camera into account to avoid z-fighting
        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);
    }

    vec3 cornerOffset = vec3(0.0);
    cornerOffset.xy += aMapping * size * scale;
    cornerOffset.x += offsetX;
    cornerOffset.y += offsetY;

    mvCorner.xyz += (uInvHeadRotation * vec4(cornerOffset, 1.0)).xyz;

    if (uIsOrtho == 1.0) {
        mvCorner.z += offsetZ;
    } else {
        mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;
    }

    gl_Position = uProjection * mvCorner;

    vViewPosition = -mvCorner.xyz;

    #include clip_instance
}
`;var Epe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

uniform sampler2D tFont;

uniform vec3 uBorderColor;
uniform float uBorderWidth;
uniform vec3 uBackgroundColor;
uniform float uBackgroundOpacity;

varying vec2 vTexCoord;

void main(){
    #include fade_lod
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    if (vTexCoord.x > 1.0) {
        #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
            material = vec4(uBackgroundColor, uBackgroundOpacity * material.a);
        #endif
    } else {
        // retrieve signed distance
        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;

        if (sdf < 0.5) discard;

        #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
            // add border
            float t = 0.5 + uBorderWidth;
            if (uBorderWidth > 0.0 && sdf < t) {
                material.xyz = uBorderColor;
            }
        #endif
    }

    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        gl_FragColor = material;
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(-normalize(vViewPosition), emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var Mpe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform vec4 uViewport;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec2 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;

void trimSegment(const in vec4 start, inout vec4 end) {
    // trim end segment so it terminates between the camera plane and the near plane
    // conservative estimate of the near plane
    float a = uProjection[2][2];  // 3rd entry in 3rd column
    float b = uProjection[3][2];  // 3rd entry in 4th column
    float nearEstimate = -0.5 * b / a;
    float alpha = (nearEstimate - start.z) / (end.z - start.z);
    end.xyz = mix(start.xyz, end.xyz, alpha);
}

void main(){
    float aspect = uViewport.z / uViewport.w;
    int vertexId = VertexID;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelView = uView * uModel * aTransform;

    // camera space
    vec4 start = modelView * vec4(aStart, 1.0);
    vec4 end = modelView * vec4(aEnd, 1.0);

    // assign position
    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);
    vec4 mvPosition = modelView * position4;
    vViewPosition = mvPosition.xyz;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane
    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly
    // perhaps there is a more elegant solution -- WestLangley
    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column
    if (perspective) {
        if (start.z < 0.0 && end.z >= 0.0) {
            trimSegment(start, end);
        } else if (end.z < 0.0 && start.z >= 0.0) {
            trimSegment(end, start);
        }
    }

    // clip space
    vec4 clipStart = uProjection * start;
    vec4 clipEnd = uProjection * end;

    // ndc space
    vec2 ndcStart = clipStart.xy / clipStart.w;
    vec2 ndcEnd = clipEnd.xy / clipEnd.w;

    // direction
    vec2 dir = ndcEnd - ndcStart;

    // account for clip-space aspect ratio
    dir.x *= aspect;
    dir = normalize(dir);

    // perpendicular to dir
    vec2 offset = vec2(dir.y, - dir.x);

    // undo aspect ratio adjustment
    dir.x /= aspect;
    offset.x /= aspect;

    // sign flip
    if (aMapping.x < 0.0) offset *= -1.0;

    // calculate linewidth
    float linewidth;
    #ifdef dLineSizeAttenuation
        linewidth = size * uPixelRatio * ((uViewport.w / 2.0) / -start.z) * 5.0;
    #else
        linewidth = size * uPixelRatio;
    #endif
    linewidth = max(1.0, linewidth);

    // adjust for linewidth
    offset *= linewidth;

    // adjust for clip-space to screen-space conversion
    offset /= uViewport.w;

    // select end
    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;

    // back to clip space
    offset *= clip.w;
    clip.xy += offset;
    gl_Position = clip;

    #include clip_instance
}
`;var Bpe=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

void main(){
    #include fade_lod
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color
    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        gl_FragColor = material;
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normalize(vViewPosition), emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var kpe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include common_clip
#include texture3d_from_2d_linear

#ifdef dGeometryType_textureMesh
    uniform vec2 uGeoTexDim;
    uniform sampler2D tPosition;
    uniform sampler2D tGroup;
    uniform sampler2D tNormal;
#else
    attribute vec3 aPosition;
    attribute float aGroup;
    attribute vec3 aNormal;
#endif
attribute mat4 aTransform;
attribute float aInstance;

varying vec3 vNormal;

void main(){
    int vertexId = VertexID;

    #include assign_group
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_color_varying
    #include clip_instance

    #ifdef dGeometryType_textureMesh
        vec3 normal = readFromTexture(tNormal, vertexId, uGeoTexDim).xyz;
    #else
        vec3 normal = aNormal;
    #endif
    mat3 normalMatrix = adjoint(modelView);
    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));
    #if defined(dFlipSided)
        if (!uDoubleSided) { // TODO checking uDoubleSided should not be required, ASR
            transformedNormal = -transformedNormal;
        }
    #endif
    vNormal = transformedNormal;
}
`;var Lpe=`
precision highp float;
precision highp int;

#define bumpEnabled

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include normal_frag_params
#include common_clip

void main() {
    #include fade_lod
    #include clip_pixel

    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)
    vec3 fdx = dFdx(vViewPosition);
    vec3 fdy = dFdy(vViewPosition);
    vec3 faceNormal = normalize(cross(fdx,fdy));
    bool frontFacing = dot(vNormal, faceNormal) > 0.0;

    #if defined(dFlipSided)
        interior = frontFacing;
    #else
        interior = !frontFacing;
    #endif

    float fragmentDepth = gl_FragCoord.z;

    #ifdef dNeedsNormal
        #if defined(dFlatShaded)
            vec3 normal = -faceNormal;
        #else
            vec3 normal = -normalize(vNormal);
            if (uDoubleSided) normal *= float(frontFacing) * 2.0 - 1.0;
        #endif
    #endif

    #include assign_material_color
    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        #include apply_light_color
        #include apply_interior_color
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normal, emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var Fpe=`
precision highp float;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;

uniform mat4 uModelView;
uniform mat4 uProjection;
uniform vec4 uInvariantBoundingSphere;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform vec3 uBboxMax;
uniform vec3 uGridDim;
uniform mat4 uTransform;

uniform mat4 uUnitToCartn;

void main() {
    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);
    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;

    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;
    vInstance = aInstance;
    vBoundingSphere = vec4(
        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,
        uInvariantBoundingSphere.w
    );
    vTransform = aTransform;

    gl_Position = uProjection * mvPosition;

    // move z position to near clip plane (but not too close to get precision issues)
    gl_Position.z = gl_Position.w - 0.01;
}
`;var Vpe=`
precision highp float;
precision highp int;

#include common
#include light_frag_params

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
    uniform mat4 uClipObjectTransform[dClipObjectCount];
#endif
#include common_clip

#include read_from_texture
#include texture3d_from_1d_trilinear
#include texture3d_from_2d_nearest
#include texture3d_from_2d_linear

uniform mat4 uProjection, uTransform, uModelView, uModel, uView;
uniform vec3 uCameraDir;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform mat4 uInvView;
uniform vec3 uGridDim;
uniform vec3 uBboxSize;
uniform sampler2D tTransferTex;
uniform float uTransferScale;
uniform float uStepScale;
uniform float uJumpLength;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;

#if defined(dColorMarker)
    uniform vec3 uHighlightColor;
    uniform vec3 uSelectColor;
    uniform vec3 uDimColor;
    uniform float uHighlightStrength;
    uniform float uSelectStrength;
    uniform float uDimStrength;
    uniform int uMarkerPriority;
    uniform float uMarkerAverage;

    uniform float uMarker;
    uniform vec2 uMarkerTexDim;
    uniform sampler2D tMarker;
#endif

uniform float uMetalness;
uniform float uRoughness;
uniform float uEmissive;

// Density value to estimate object thickness
uniform float uDensity;

uniform bool uFog;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform bool uTransparentBackground;
uniform float uXrayEdgeFalloff;
uniform float uCelSteps;
uniform float uExposure;

uniform int uRenderMask;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform vec3 uCellDim;
uniform vec3 uCameraPosition;
uniform mat4 uCartnToUnit;

#if __VERSION__ != 100
    // for webgl1 this is given as a 'define'
    uniform int uMaxSteps;
#endif

#if defined(dGridTexType_2d)
    precision highp sampler2D;
    uniform sampler2D tGridTex;
    uniform vec3 uGridTexDim;
#elif defined(dGridTexType_3d)
    precision highp sampler3D;
    uniform sampler3D tGridTex;
#endif

#if defined(dColorType_uniform)
    uniform vec3 uColor;
#elif defined(dColorType_texture)
    uniform vec2 uColorTexDim;
    uniform sampler2D tColor;
#endif

#ifdef dOverpaint
    #if defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#endif

#ifdef dUsePalette
    uniform vec2 uPaletteDomain;
    uniform sampler2D tPalette;
#endif

#if defined(dGridTexType_2d)
    vec4 textureVal(vec3 pos) {
        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
    vec4 textureGroup(vec3 pos) {
        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
#elif defined(dGridTexType_3d)
    vec4 textureVal(vec3 pos) {
        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));
    }
    vec4 textureGroup(vec3 pos) {
        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);
    }
#endif

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}

float transferFunction(float value) {
    return texture2D(tTransferTex, vec2(value, 0.0)).a;
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

const float gradOffset = 0.5;

vec3 v3m4(vec3 p, mat4 m) {
    return (m * vec4(p, 1.0)).xyz;
}

float preFogAlphaBlended = 0.0;

vec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {
    mat3 normalMatrix = adjoint(uModelView * vTransform);
    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);
    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
        mat4 modelTransform = uModel * vTransform * uTransform;
    #endif
    mat4 modelViewTransform = uModelView * vTransform * uTransform;

    vec3 scaleVol = vec3(1.0) / uGridDim;
    vec3 pos = startLoc;
    vec4 cell;
    float prevValue = -1.0;
    float value = 0.0;
    vec4 src = vec4(0.0);
    vec4 dst = vec4(0.0);
    float fragmentDepth;

    vec3 posMin = vec3(0.0);
    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;

    vec3 unitPos;

    vec3 nextPos;
    float nextValue;

    vec4 material;
    vec4 overpaint;
    float metalness = uMetalness;
    float roughness = uRoughness;
    float emissive = uEmissive;

    vec3 gradient = vec3(1.0);
    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);
    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);
    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);

    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);
    float maxDistSq = maxDist * maxDist;

    for (int i = 0; i < uMaxSteps; ++i) {
        // break when beyond bounding-sphere or far-plane
        vec3 distVec = startLoc - pos;
        if (dot(distVec, distVec) > maxDistSq) break;

        unitPos = v3m4(pos, cartnToUnit);

        // continue when outside of grid
        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||
            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z
        ) {
            prevValue = value;
            pos += step;
            continue;
        }

        cell = textureVal(unitPos);
        value = cell.a; // current voxel value

        if (uJumpLength > 0.0 && value < 0.01) {
            nextPos = pos + rayDir * uJumpLength;
            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;
            if (nextValue < 0.01) {
                prevValue = nextValue;
                pos = nextPos;
                continue;
            }
        }

        vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);
        if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
            break;

        #if defined(dClipVariant_pixel) && dClipObjectCount != 0
            vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);
            if (clipTest(modelPosition)) {
                prevValue = value;
                pos += step;
                continue;
            }
        #endif

        vec3 vViewPosition = mvPosition.xyz;
        material.a = transferFunction(value);

        #ifdef dPackedGroup
            float group = unpackRGBToInt(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);
        #else
            vec3 g = floor(unitPos * uGridDim + 0.5);
            // note that we swap x and z because the texture is flipped around y
            #if defined(dAxisOrder_012)
                float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y; // 210
            #elif defined(dAxisOrder_021)
                float group = g.y + g.z * uGridDim.y + g.x * uGridDim.y * uGridDim.z; // 120
            #elif defined(dAxisOrder_102)
                float group = g.z + g.x * uGridDim.z + g.y * uGridDim.z * uGridDim.x; // 201
            #elif defined(dAxisOrder_120)
                float group = g.x + g.z * uGridDim.x + g.y * uGridDim.x * uGridDim.z; // 021
            #elif defined(dAxisOrder_201)
                float group = g.y + g.x * uGridDim.y + g.z * uGridDim.y * uGridDim.x; // 102
            #elif defined(dAxisOrder_210)
                float group = g.x + g.y * uGridDim.x + g.z * uGridDim.x * uGridDim.y; // 012
            #endif
        #endif

        #if defined(dColorType_direct) && defined(dUsePalette)
            float paletteValue = (value - uPaletteDomain[0]) / (uPaletteDomain[1] - uPaletteDomain[0]);
            material.rgb = texture2D(tPalette, vec2(clamp(paletteValue, 0.0, 1.0), 0.0)).rgb;
        #elif defined(dColorType_uniform)
            material.rgb = uColor;
        #elif defined(dColorType_instance)
            material.rgb = readFromTexture(tColor, vInstance, uColorTexDim).rgb;
        #elif defined(dColorType_group)
            material.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
        #elif defined(dColorType_groupInstance)
            material.rgb = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;
        #elif defined(dColorType_vertex)
            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, 0.0).rgb;
        #elif defined(dColorType_vertexInstance)
            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;
        #endif

        #ifdef dOverpaint
            #if defined(dOverpaintType_groupInstance)
                overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);
            #elif defined(dOverpaintType_vertexInstance)
                overpaint = texture3dFrom1dTrilinear(tOverpaint, unitPos, uGridDim, uOverpaintTexDim, vInstance * float(uVertexCount));
            #endif

            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);
        #endif

        #if defined(dIgnoreLight)
            gl_FragColor.rgb = material.rgb;
        #else
            if (material.a >= 0.01) {
                #ifdef dPackedGroup
                    // compute gradient by central differences
                    gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;
                    gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;
                    gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;
                #else
                    gradient = cell.xyz * 2.0 - 1.0;
                #endif
                vec3 normal = -normalize(normalMatrix * normalize(gradient));
                #include apply_light_color
            } else {
                gl_FragColor.rgb = material.rgb;
            }
        #endif

        gl_FragColor.a = material.a * uAlpha * uTransferScale;

        #if defined(dColorMarker)
            float marker = uMarker;
            if (uMarker == -1.0) {
                marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
            }
        #endif
        #include apply_marker_color

        preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
        fragmentDepth = calcDepth(mvPosition.xyz);
        #include apply_fog

        src = gl_FragColor;

        if (!uTransparentBackground || !uFog) {
            // done in 'apply_fog' otherwise
            src.rgb *= src.a;
        }
        dst = (1.0 - dst.a) * src + dst; // standard blending

        // break if the color is opaque enough
        if (dst.a > 0.95)
            break;

        pos += step;
    }

    return dst;
}

// TODO: support float texture for higher precision values???
// TODO: support clipping exclusion texture support

void main() {
    #if defined(dRenderVariant_tracing) || defined(dRenderVariant_emissive)
        discard;
    #else
        if (gl_FrontFacing)
            discard;

        vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);
        vec3 step = rayDir * uStepScale;

        float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;
        float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);
        vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);
        gl_FragColor = raymarch(start, step, rayDir);

        float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);
        float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);
        #include wboit_write
    #endif
}
`;var Ope=`
precision highp float;
precision highp int;

#include common
#include common_vert_params

attribute vec3 aPosition;
attribute vec2 aUv;
attribute mat4 aTransform;
attribute float aInstance;

varying vec2 vUv;
varying float vInstance;

void main() {
    int vertexId = VertexID;

    #include assign_position

    vUv = aUv;
    vInstance = aInstance;
}
`;var Gpe=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_frag_params
#include common_clip

uniform float uEmissive;

// Density value to estimate object thickness
uniform float uDensity;

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #ifdef dOverpaint
        #if defined(dOverpaintType_instance) || defined(dOverpaintType_groupInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform sampler2D tOverpaint;
        #endif
        uniform float uOverpaintStrength;
    #endif
#endif

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing) || defined(dRenderVariant_emissive)
    #ifdef dEmissive
        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform sampler2D tEmissive;
        #endif
        uniform float uEmissiveStrength;
    #endif
#endif

#ifdef dTransparency
    #if defined(dTransparencyType_instance) || defined(dTransparencyType_groupInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform sampler2D tTransparency;
    #endif
    uniform float uTransparencyStrength;
#endif

uniform vec2 uImageTexDim;
uniform sampler2D tImageTex;
uniform sampler2D tGroupTex;
uniform sampler2D tValueTex;

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

varying vec2 vUv;
varying float vInstance;

#ifdef dUsePalette
    uniform sampler2D tPalette;
    uniform vec3 uPaletteDefault;
#endif

uniform int uTrimType;
uniform vec3 uTrimCenter;
uniform vec4 uTrimRotation;
uniform vec3 uTrimScale;
uniform mat4 uTrimTransform;

uniform float uIsoLevel;

#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)
    #define dInterpolation_cubic
#endif

#if defined(dInterpolation_cubic)
    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)
        #if defined(dInterpolation_catmulrom)
            const float B = 0.0;
            const float C = 0.5;
        #elif defined(dInterpolation_mitchell)
            const float B = 0.333;
            const float C = 0.333;
        #endif

        float cubicFilter(float x){
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f < 1.0) {
                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +
                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +
                    (6.0 - 2.0 * B)) / 6.0;
            }else if (f >= 1.0 && f < 2.0){
                return ((-B - 6.0 * C) * ( f * f * f)
                    + (6.0 * B + 30.0 * C) * (f * f) +
                    (-(12.0 * B) - 48.0 * C) * f +
                    8.0 * B + 24.0 * C) / 6.0;
            }else{
                return 0.0;
            }
        }
    #elif defined(dInterpolation_bspline)
        float cubicFilter(float x) {
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f >= 0.0 && f <= 1.0){
                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);
            } else if (f > 1.0 && f <= 2.0) {
                return 1.0 / 6.0 * pow((2.0 - f), 3.0);
            }
            return 1.0;
        }
    #endif

    vec4 biCubic(sampler2D tex, vec2 texCoord) {
        vec2 texelSize = 1.0 / uImageTexDim;
        texCoord -= texelSize / 2.0;
        vec4 nSum = vec4(0.0);
        float nDenom = 0.0;
        vec2 cell = fract(texCoord * uImageTexDim);
        for (float m = -1.0; m <= 2.0; ++m) {
            for (float n = -1.0; n <= 2.0; ++n) {
                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));
                float c = abs(cubicFilter(m - cell.x) * cubicFilter(-n + cell.y));
                nSum += vecData * c;
                nDenom += c;
            }
        }
        return nSum / nDenom;
    }
#endif

void main() {
    if (uTrimType != 0 && getSignedDistance(vModelPosition, uTrimType, uTrimCenter, uTrimRotation, uTrimScale, uTrimTransform) > 0.0) discard;

    #include fade_lod
    #include clip_pixel

    #if defined(dInterpolation_cubic)
        #ifdef dUsePalette
            vec4 material = texture2D(tImageTex, vUv);
            if (material.rgb != vec3(1.0)) {
                material = biCubic(tImageTex, vUv);
            }
        #else
            vec4 material = biCubic(tImageTex, vUv);
        #endif
    #else
        vec4 material = texture2D(tImageTex, vUv);
    #endif

    if (uIsoLevel >= 0.0) {
        if (texture2D(tValueTex, vUv).r < uIsoLevel) discard;

        material.a = uAlpha;
    } else {
        if (material.a == 0.0) discard;

        material.a *= uAlpha;
    }

    float fragmentDepth = gl_FragCoord.z;

    vec3 packedGroup = texture2D(tGroupTex, vUv).rgb;
    float group = packedGroup == vec3(0.0) ? -1.0 : unpackRGBToInt(packedGroup);

    // apply per-group transparency
    #if defined(dTransparency) && (defined(dRenderVariant_pick) || defined(dRenderVariant_color) || defined(dRenderVariant_emissive) || defined(dRenderVariant_tracing))
        float transparency = 0.0;
        #if defined(dTransparencyType_instance)
            transparency = readFromTexture(tTransparency, vInstance, uTransparencyTexDim).a;
        #elif defined(dTransparencyType_groupInstance)
            transparency = readFromTexture(tTransparency, vInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
        #endif
        transparency *= uTransparencyStrength;

        float ta = 1.0 - transparency;
        if (transparency < 0.09) ta = 1.0; // hard cutoff looks better

        #if defined(dRenderVariant_pick)
            if (ta * uAlpha < uPickingAlphaThreshold)
                discard; // ignore so the element below can be picked
        #elif defined(dRenderVariant_emissive)
            if (ta < 1.0)
                discard; // emissive not supported with transparency
        #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
            material.a *= ta;
        #endif
    #endif

    if ((uRenderMask == MaskOpaque && material.a < 1.0) ||
        (uRenderMask == MaskTransparent && material.a == 1.0)
    ) {
        discard;
    }

    #if defined(dNeedsMarker)
        float marker = uMarker;
        if (group == -1.0) {
            marker = 0.0;
        } else if (uMarker == -1.0) {
            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
        }
    #endif

    #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing) || defined(dRenderVariant_emissive)
        float emissive = uEmissive;
        if (group == -1.0) {
            emissive = 0.0;
        } else {
            #ifdef dEmissive
                #if defined(dEmissiveType_instance)
                    emissive += readFromTexture(tEmissive, vInstance, uEmissiveTexDim).a * uEmissiveStrength;
                #elif defined(dEmissiveType_groupInstance)
                    emissive += readFromTexture(tEmissive, vInstance * float(uGroupCount) + group, uEmissiveTexDim).a * uEmissiveStrength;
                #endif
            #endif
        }
    #endif

    #if defined(dRenderVariant_pick)
        if (group == -1.0) discard;

        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
            gl_FragData[1] = vec4(packIntToRGB(vInstance), 1.0);
            gl_FragData[2] = vec4(packIntToRGB(group), 1.0);
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
            if (uPickType == 1) {
                gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
            } else if (uPickType == 2) {
                gl_FragColor = vec4(packIntToRGB(vInstance), 1.0);
            } else {
                gl_FragColor = vec4(packIntToRGB(group), 1.0);
            }
        #endif
    #elif defined(dRenderVariant_depth)
        if (uRenderMask == MaskOpaque) {
            gl_FragColor = packDepthToRGBA(fragmentDepth);
        } else if (uRenderMask == MaskTransparent) {
            gl_FragColor = packDepthWithAlphaToRGBA(fragmentDepth, material.a);
        }
    #elif defined(dRenderVariant_marking)
        if (uMarkingType == 1) {
            if (marker > 0.0)
                discard;
            gl_FragColor = packDepthToRGBA(fragmentDepth);
        } else {
            if (marker == 0.0)
                discard;
            float depthTest = 1.0;
            if (uMarkingDepthTest) {
                depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;
            }
            bool isHighlight = intMod(marker, 2.0) > 0.1;
            float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
            float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
            if (fogFactor == 1.0)
                discard;
            gl_FragColor = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);
        }
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = vec4(emissive);
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        #ifdef dUsePalette
            if (material.rgb == vec3(1.0)) {
                material.rgb = uPaletteDefault;
            } else {
                float v = ((material.r * 256.0 * 256.0 * 255.0 + material.g * 256.0 * 255.0 + material.b * 255.0) - 1.0) / PALETTE_SCALE;
                material.rgb = texture2D(tPalette, vec2(v, 0.0)).rgb;
            }
        #endif

        // mix material with overpaint
        #if defined(dOverpaint)
            vec4 overpaint = vec4(0.0);
            if (group != -1.0) {
                #if defined(dOverpaintType_instance)
                    overpaint = readFromTexture(tOverpaint, vInstance, uOverpaintTexDim);
                #elif defined(dOverpaintType_groupInstance)
                    overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);
                #endif
                overpaint *= uOverpaintStrength;
            }
            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);
        #endif

        gl_FragColor = material;
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normalize(vViewPosition), emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`;var Hpe=oi(),Lje={apply_fog:jde,apply_interior_color:Wde,apply_light_color:Xde,apply_marker_color:Qde,assign_clipping_varying:Zde,assign_color_varying:qde,assign_group:Yde,assign_marker_varying:Kde,assign_material_color:Jde,assign_position:$de,assign_size:epe,check_picking_alpha:tpe,check_transparency:rpe,clip_instance:npe,clip_pixel:ope,color_frag_params:ipe,color_vert_params:ape,common_clip:spe,common_frag_params:lpe,common_vert_params:upe,common:cpe,fade_lod:mpe,float_to_rgba:dpe,light_frag_params:ppe,matrix_scale:fpe,normal_frag_params:hpe,read_from_texture:gpe,rgba_to_float:ype,size_vert_params:bpe,texture3d_from_1d_trilinear:xpe,texture3d_from_2d_linear:Cpe,texture3d_from_2d_nearest:Spe,wboit_write:vpe,dpoit_write:Ipe},Fje=/^(?!\/\/)\s*#include\s+(\S+)/gm,Vje=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*\+\+i\s*\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,Oje=/[ \t]*\/\/.*\n/g,Gje=/[ \t]*\/\*[\s\S]*?\*\//g,Uje=/\n{2,}/g;function Upe(e){return e.replace(Fje,(t,r)=>{let n=Lje[r];if(!n)throw new Error(`empty chunk, '${r}'`);return n}).trim().replace(Oje,`
`).replace(Gje,`
`).replace(Uje,`
`)}function Nje(e){return e.replace(Vje,zje)}function zje(e,t,r,n){let o="";for(let i=parseInt(t);i<parseInt(r);++i)o+=n.replace(/\[\s*i\s*\]/g,`[${i}]`).replace(/UNROLLED_LOOP_INDEX/g,`${i}`);return o}function Hje(e,t){return t.dLightCount&&(e=e.replace(/dLightCount/g,`${t.dLightCount.ref.value}`)),t.dClipObjectCount&&(e=e.replace(/dClipObjectCount/g,`${t.dClipObjectCount.ref.value}`)),e}function Npe(e,t){return Nje(Hje(e,t))}function Dr(e,t,r,n={},o={},i){return{id:Hpe(),name:e,vert:Upe(t),frag:Upe(r),extensions:n,outTypes:o,ignoreDefine:i}}function s_(e,t,r){if(t.startsWith("color")||t==="tracing"){if(e==="dLightCount")return!!r.dIgnoreLight?.ref.value}else{let n=["dColorType","dUsePalette","dOverpaintType","dOverpaint","dSubstanceType","dSubstance","dColorMarker","dCelShaded","dLightCount"];return t!=="depth"&&!t.startsWith("pick")&&n.push("dXrayShaded"),t!=="emissive"&&n.push("dEmissiveType","dEmissive"),n.includes(e)}return!1}function _B(e,t,r){return e==="dLightCount"?!0:s_(e,t,r)}var jpe=Dr("points",Ape,Tpe,{drawBuffers:"optional"},{},_B),Wpe=Dr("spheres",Ppe,_pe,{fragDepth:"required",drawBuffers:"optional"},{},s_),Xpe=Dr("cylinders",Rpe,Dpe,{fragDepth:"required",drawBuffers:"optional"},{},s_),Qpe=Dr("text",wpe,Epe,{drawBuffers:"optional"},{},_B),Zpe=Dr("lines",Mpe,Bpe,{drawBuffers:"optional"},{},_B),RB=Dr("mesh",kpe,Lpe,{drawBuffers:"optional"},{},s_),qpe=Dr("direct-volume",Fpe,Vpe,{fragDepth:"optional",drawBuffers:"optional"},{},s_),Ype=Dr("image",Ope,Gpe,{drawBuffers:"optional"},{},_B);function zpe(e,t){if(e===void 0)return"";let r=e.dRenderVariant?.ref.value||"",n=[];for(let o in e){if(t?.(o,r,e))continue;let a=e[o].ref.value;a!==void 0&&(typeof a=="string"?n.push(`#define ${o}_${a}`):typeof a=="number"?n.push(`#define ${o} ${a}`):typeof a=="boolean"?a&&n.push(`#define ${o}`):Rr(a))}return n.join(`
`)+`
`}function jje(e,t){let r=[];if(t.drawBuffers){if(e.drawBuffers)r.push("#define requiredDrawBuffers");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.multiDraw){if(e.multiDraw)r.push("#extension GL_ANGLE_multi_draw : require"),r.push("#define enabledMultiDraw");else if(t.multiDraw==="required")throw new Error("required 'GL_ANGLE_multi_draw' extension not available")}return r.join(`
`)+`
`}function Wje(e,t){let r=["#extension GL_OES_standard_derivatives : enable"];if(t.fragDepth){if(e.fragDepth)r.push("#extension GL_EXT_frag_depth : enable"),r.push("#define enabledFragDepth");else if(t.fragDepth==="required")throw new Error("required 'GL_EXT_frag_depth' extension not available")}if(t.drawBuffers){if(e.drawBuffers)r.push("#extension GL_EXT_draw_buffers : require"),r.push("#define requiredDrawBuffers"),r.push("#define gl_FragColor gl_FragData[0]");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.shaderTextureLod){if(e.shaderTextureLod)r.push("#extension GL_EXT_shader_texture_lod : enable"),r.push("#define enabledShaderTextureLod");else if(t.shaderTextureLod==="required")throw new Error("required 'GL_EXT_shader_texture_lod' extension not available")}return e.depthTexture&&r.push("#define depthTextureSupport"),r.join(`
`)+`
`}var Xje=`
#define attribute in
#define varying out
#define texture2D texture
`,Qje=`
#define varying in
#define texture2D texture
#define textureCube texture
#define texture2DLodEXT textureLod
#define textureCubeLodEXT textureLod

#define gl_FragColor out_FragData0
#define gl_FragDepthEXT gl_FragDepth
`;function Zje(e,t){let r=["#version 300 es"];if(t.drawBuffers&&e.drawBuffers&&r.push("#define requiredDrawBuffers"),t.multiDraw){if(e.multiDraw)r.push("#extension GL_ANGLE_multi_draw : require"),r.push("#define enabledMultiDraw");else if(t.multiDraw==="required")throw new Error("required 'GL_ANGLE_multi_draw' extension not available")}if(t.clipCullDistance){if(e.clipCullDistance)r.push("#extension GL_ANGLE_clip_cull_distance : enable"),r.push("#define enabledClipCullDistance");else if(t.clipCullDistance==="required")throw new Error("required 'GL_ANGLE_clip_cull_distance' extension not available")}if(t.conservativeDepth){if(e.conservativeDepth)r.push("#extension GL_EXT_conservative_depth : enable"),r.push("#define enabledConservativeDepth");else if(t.conservativeDepth==="required")throw new Error("required 'GL_EXT_conservative_depth' extension not available")}if(t.multiview2){if(e.multiview2)r.push("#extension GL_OVR_multiview2 : require"),r.push("#define enabledMultiview2");else if(t.multiview2==="required")throw new Error("required 'GL_OVR_multiview2' extension not available")}return e.noNonInstancedActiveAttribs&&r.push("#define noNonInstancedActiveAttribs"),r.push(Xje),r.join(`
`)+`
`}function qje(e,t,r,n){let o=["#version 300 es",`layout(location = 0) out highp ${n[0]||"vec4"} out_FragData0;`];if(r.fragDepth&&t.fragDepth&&o.push("#define enabledFragDepth"),r.drawBuffers&&t.drawBuffers){o.push("#define requiredDrawBuffers");let i=e.getParameter(e.MAX_DRAW_BUFFERS);for(let a=1,s=i;a<s;++a)o.push(`layout(location = ${a}) out highp ${n[a]||"vec4"} out_FragData${a};`)}return r.shaderTextureLod&&t.shaderTextureLod&&o.push("#define enabledShaderTextureLod"),t.depthTexture&&o.push("#define depthTextureSupport"),o.push(Qje),o.join(`
`)+`
`}function Yje(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}function Kpe(e,t,r,n){let o=zpe(r,n.ignoreDefine),i=zpe(r,n.ignoreDefine),a=Ht(e)?Zje(t,n.extensions):jje(t,n.extensions),s=Ht(e)?qje(e,t,n.extensions,n.outTypes):Wje(t,n.extensions),l=Ht(e)?Yje(n.frag):n.frag;return{id:Hpe(),name:n.name,vert:`${a}${o}${Npe(n.vert,r)}`,frag:`${s}${i}${Npe(l,r)}`,extensions:n.extensions,outTypes:n.outTypes}}function efe(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"q":case"q[]":return e.FLOAT_VEC4;case"iv2":case"iv2[]":return e.INT_VEC2;case"iv3":case"iv3[]":return e.INT_VEC3;case"iv4":case"iv4[]":return e.INT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:console.error(`unknown uniform kind '${t}'`)}}function tfe(e){return e.endsWith("[]")}function Kje(e,t,r){e.uniform1f(t,r)}function Jje(e,t,r){e.uniform1fv(t,r)}function $je(e,t,r){e.uniform1i(t,r)}function e8e(e,t,r){e.uniform1iv(t,r)}function t8e(e,t,r){e.uniform2fv(t,r)}function r8e(e,t,r){e.uniform3fv(t,r)}function Jpe(e,t,r){e.uniform4fv(t,r)}function n8e(e,t,r){e.uniform2iv(t,r)}function o8e(e,t,r){e.uniform3iv(t,r)}function i8e(e,t,r){e.uniform4iv(t,r)}function a8e(e,t,r){e.uniformMatrix3fv(t,!1,r)}function s8e(e,t,r){e.uniformMatrix4fv(t,!1,r)}function $pe(e){switch(e){case"f":return Kje;case"f[]":return Jje;case"i":case"t":case"b":return $je;case"i[]":case"t[]":case"b[]":return e8e;case"v2":case"v2[]":return t8e;case"v3":case"v3[]":return r8e;case"v4":case"v4[]":return Jpe;case"q":case"q[]":return Jpe;case"iv2":case"iv2[]":return n8e;case"iv3":case"iv3[]":return o8e;case"iv4":case"iv4[]":return i8e;case"m3":case"m3[]":return a8e;case"m4":case"m4[]":return s8e}}function rfe(e){let t={};return Object.keys(e).forEach(r=>{let n=e[r];n.type==="uniform"?t[r]=$pe(n.kind):n.type==="texture"&&(t[r]=$pe("t"))}),t}function nfe(e){let t={};return Object.keys(e).forEach(r=>{t[r]=P.create(Ya(e[r].ref.value))}),t}var l8e=oi();function u8e(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW}}function c8e(e,t){if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Int32Array)return e.INT;if(t instanceof Float32Array)return e.FLOAT;Rr(t)}function m8e(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":if(Ht(e))return e.UNIFORM_BUFFER;throw new Error("WebGL2 is required for uniform buffers")}}function dy(e){let t=e.createBuffer();if(t===null)throw new Error("Could not create WebGL buffer");return t}function ofe(e,t,r,n){let o=dy(e),i=u8e(e,r),a=m8e(e,n),s=c8e(e,t),l=t.BYTES_PER_ELEMENT,u=t.length;function c(d){e.bindBuffer(a,o),e.bufferData(a,d,i)}c(t);let m=!1;return{id:l8e(),_usageHint:i,_bufferType:a,_dataType:s,_bpe:l,length:u,getBuffer:()=>o,updateData:c,updateSubData:(d,p,h)=>{e.bindBuffer(a,o),h-p===d.length?e.bufferSubData(a,0,d):e.bufferSubData(a,p*l,d.subarray(p,p+h))},reset:()=>{o=dy(e),c(t)},destroy:()=>{m||(e.deleteBuffer(o),m=!0)}}}function ife(e,t,r){switch(t){case"float32":switch(r){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}default:Rr(t)}}function afe(e,t,r,n,o,i,a="static"){let{instancedArrays:s}=r,l=ofe(e,n,a,"attribute"),{_bufferType:u,_dataType:c,_bpe:m}=l;return{...l,divisor:i,bind:d=>{if(e.bindBuffer(u,l.getBuffer()),o===16)for(let p=0;p<4;++p)t.enableVertexAttrib(d+p),e.vertexAttribPointer(d+p,4,c,!1,4*4*m,p*4*m),s.vertexAttribDivisor(d+p,i);else t.enableVertexAttrib(d),e.vertexAttribPointer(d,o,c,!1,0,0),s.vertexAttribDivisor(d,i)},changeOffset:(d,p)=>{let h=p*m*o;if(e.bindBuffer(u,l.getBuffer()),o===16)for(let f=0;f<4;++f)e.vertexAttribPointer(d+f,4,c,!1,4*4*m,f*4*m+h);else e.vertexAttribPointer(d,o,c,!1,0,h)}}}function sfe(e,t,r){let n=[];return Object.keys(t).forEach(o=>{let i=t[o];i.type==="attribute"&&(n[n.length]=[o,e.resources.attribute(r[o].ref.value,i.itemSize,i.divisor)])}),n}function lfe(e,t,r="static"){let n=ofe(e,t,r,"elements");return{...n,bind:()=>{e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.getBuffer())}}}var d8e=oi();function p8e(e,t,r){let n={};return Object.keys(r).forEach(o=>{let i=r[o];if(i.type==="attribute"){let a=e.getAttribLocation(t,o);n[o]=a}else if(i.type==="uniform"){let a=e.getUniformLocation(t,o);a===null&&tfe(i.kind)&&(a=e.getUniformLocation(t,o+"[0]")),n[o]=a}else if(i.type==="texture"){let a=e.getUniformLocation(t,o);n[o]=a}}),n}function f8e(e,t,r){let n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let o=0;o<n;++o){let i=e.getActiveAttrib(t,o);if(i){let{name:a,type:s}=i;if(a.startsWith("__activeAttribute")||a==="gl_InstanceID"||a==="gl_VertexID"||a==="gl_DrawID"||a==="gl_ViewID_OVR")continue;let l=r[a];if(l===void 0)throw new Error(`missing 'uniform' or 'texture' with name '${a}' in schema`);if(l.type!=="attribute")throw new Error(`'${a}' must be of type 'attribute' but is '${l.type}'`);let u=ife(e,l.kind,l.itemSize);if(u!==s)throw new Error(`unexpected attribute type '${u}' for ${a}, expected '${s}'`)}}}function h8e(e,t,r){let n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let o=0;o<n;++o){let i=e.getActiveUniform(t,o);if(i){let{name:a,type:s}=i;if(a.startsWith("__activeUniform")||a==="gl_InstanceID"||a==="gl_VertexID"||a==="gl_DrawID"||a==="gl_ViewID_OVR")continue;let l=a.replace(/[[0-9]+\]$/,""),u=r[l];if(u===void 0)throw new Error(`missing 'uniform' or 'texture' with name '${a}' in schema`);if(u.type==="uniform"){if(efe(e,u.kind)!==s)throw new Error(`unexpected uniform type for ${a}`)}else if(u.type==="texture"){if(u.kind==="image-float32"||u.kind==="image-uint8"){if(s!==e.SAMPLER_2D)throw new Error(`unexpected sampler type for '${a}'`)}else if(u.kind==="volume-float32"||u.kind==="volume-uint8")if(Ht(e)){if(s!==e.SAMPLER_3D)throw new Error(`unexpected sampler type for '${a}'`)}else throw new Error("WebGL2 is required to use SAMPLER_3D")}else throw new Error(`'${a}' must be of type 'uniform' or 'texture' but is '${u.type}'`)}}}function g8e(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(`Could not compile WebGL program. 

${e.getProgramInfoLog(t)}`)}function DB(e){let t=e.createProgram();if(t===null)throw new Error("Could not create WebGL program");return t}function ufe(e,t,r,n,o){let{defineValues:i,shaderCode:a,schema:s}=o,l=DB(e),u=d8e(),c=Kpe(e,r,i,a),m=n("vert",c.vert),d=n("frag",c.frag),p,h;function f(){m.attach(l),d.attach(l),e.linkProgram(l),$t&&g8e(e,l),p=p8e(e,l,s),h=rfe(s),$t&&(f8e(e,l,s),h8e(e,l,s))}f();let y=!1;return{id:u,use:()=>{t.currentProgramId=u,e.useProgram(l)},setUniforms:g=>{for(let x=0,S=g.length;x<S;++x){let[I,v]=g[x];if(v){let A=p[I];A!==null&&h[I](e,A,v.ref.value)}}},uniform:(g,x)=>{let S=p[g];S!==null&&h[g](e,S,x)},bindAttributes:g=>{t.clearVertexAttribsState();for(let x=0,S=g.length;x<S;++x){let[I,v]=g[x],A=p[I];A!==-1&&v.bind(A)}t.disableUnusedVertexAttribs()},offsetAttributes:(g,x)=>{for(let S=0,I=g.length;S<I;++S){let[v,A]=g[S],_=p[v];_!==-1&&A.changeOffset(_,x)}},bindTextures:(g,x)=>{for(let S=0,I=g.length;S<I;++S){let[v,A]=g[S],_=p[v];_!=null&&(A.bind(S+x),h[v](e,_,S+x))}},reset:()=>{l=DB(e),f()},destroy:()=>{y||(m.destroy(),d.destroy(),e.deleteProgram(l),y=!0)}}}var y8e=oi();function b8e(e){let t=e.split(`
`);for(let r=0;r<t.length;++r)t[r]=r+1+": "+t[r];return t.join(`
`)}function l_(e,t){let{type:r,source:n}=t,o=e.createShader(r==="vert"?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(o===null)throw new Error(`Error creating ${r} shader`);if(e.shaderSource(o,n),e.compileShader(o),$t&&e.getShaderParameter(o,e.COMPILE_STATUS)===!1)throw console.warn(`'${r}' shader info log '${e.getShaderInfoLog(o)}'
${b8e(n)}`),new Error(`Error compiling ${r} shader`);return o}function cfe(e,t){let r=l_(e,t);return{id:y8e(),attach:n=>{e.attachShader(n,r)},reset:()=>{r=l_(e,t)},destroy:()=>{e.deleteShader(r)}}}function x8e(e,t=0){return{value:e,usageCount:t}}function C8e(e){return{free:()=>{e.usageCount-=1},value:e.value}}function v6(e,t,r){let n=new Map;return{get:o=>{let i=e(o),a=n.get(i);return a||(a=x8e(t(o)),n.set(i,a)),a.usageCount+=1,C8e(a)},clear:()=>{n.forEach((o,i)=>{o.usageCount<=0&&(o.usageCount<0&&console.warn("Reference usageCount below zero."),r(o.value),n.delete(i))})},get count(){return n.size},dispose:()=>{n.forEach(o=>r(o.value)),n.clear()}}}var S8e=oi();function v8e(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth24":if(Ht(e))return e.DEPTH_COMPONENT24;throw new Error("WebGL2 needed for `depth24` renderbuffer format");case"depth32f":if(Ht(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format");case"depth24-stencil8":if(Ht(e))return e.DEPTH24_STENCIL8;throw new Error("WebGL2 needed for `depth24-stencil8` renderbuffer format");case"depth32f-stencil8":if(Ht(e))return e.DEPTH32F_STENCIL8;throw new Error("WebGL2 needed for `depth32f-stencil8` renderbuffer format")}}function I8e(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}function mfe(e){let t=e.createRenderbuffer();if(t===null)throw new Error("Could not create WebGL renderbuffer");return t}function dfe(e,t,r,n,o){let i=mfe(e),a=()=>e.bindRenderbuffer(e.RENDERBUFFER,i),s=v8e(e,t),l=I8e(e,r);function u(){a(),e.renderbufferStorage(e.RENDERBUFFER,s,n,o)}u();let c=!1;return{id:S8e(),bind:a,attachFramebuffer:m=>{m.bind(),a(),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,i),$t&&aI(e)},detachFramebuffer:m=>{m.bind(),a(),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,null),$t&&aI(e)},setSize:(m,d)=>{n=m,o=d,u()},reset:()=>{i=mfe(e),u()},destroy:()=>{c||(e.deleteRenderbuffer(i),c=!0)}}}var A8e=oi();function pfe(e){let{vertexArrayObject:t}=e;if(!t)throw new Error("VertexArrayObject not supported");let r=t.createVertexArray();if(!r)throw new Error("Could not create WebGL vertex array");return r}function ffe(e){let{vertexArrayObject:t}=e;if(t===null)throw new Error("VertexArrayObject not supported");return t}function hfe(e,t,r,n,o){let i=A8e(),a=pfe(t),s=ffe(t);function l(){s.bindVertexArray(a),o&&o.bind(),r.bindAttributes(n),s.bindVertexArray(null)}l();let u=!1;return{id:i,bind:()=>{s.bindVertexArray(a)},update:l,reset:()=>{a=pfe(t),s=ffe(t),l()},destroy:()=>{u||(o&&(s.bindVertexArray(a),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),s.deleteVertexArray(a),u=!0)}}}function T8e(e){return typeof e=="boolean"?e?1:0:typeof e=="number"?e*1e4:KC(e)}function gfe(e){return{...e.value,destroy:()=>{e.free()}}}function yfe(e,t,r,n){let o={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,cubeTexture:new Set,vertexArray:new Set};function i(u,c){return o[u].add(c),r.resourceCounts[u]+=1,{...c,destroy:()=>{c.destroy(),o[u].delete(c),r.resourceCounts[u]-=1}}}let a=v6(u=>JSON.stringify(u),u=>i("shader",cfe(e,u)),u=>{u.destroy()});function s(u,c){return gfe(a.get({type:u,source:c}))}let l=v6(u=>{let c=[u.shaderCode.id],m=u.defineValues.dRenderVariant?.ref.value||"";return Object.keys(u.defineValues).forEach(d=>{u.shaderCode.ignoreDefine?.(d,m,u.defineValues)||c.push(KC(d),T8e(u.defineValues[d].ref.value))}),Ro(c).toString()},u=>i("program",ufe(e,t,n,s,u)),u=>{u.destroy()});return{attribute:(u,c,m,d)=>i("attribute",afe(e,t,n,u,c,m,d)),elements:(u,c)=>i("elements",lfe(e,u,c)),framebuffer:()=>i("framebuffer",ade(e)),program:(u,c,m)=>gfe(l.get({defineValues:u,shaderCode:c,schema:m})),renderbuffer:(u,c,m,d)=>i("renderbuffer",dfe(e,u,c,m,d)),shader:s,texture:(u,c,m,d)=>i("texture",bfe(e,n,u,c,m,d)),cubeTexture:(u,c,m)=>i("cubeTexture",xfe(e,u,c,m)),vertexArray:(u,c,m)=>i("vertexArray",hfe(e,n,u,c,m)),getByteCounts:()=>{let u=0;o.texture.forEach(d=>{u+=d.getByteCount()}),o.cubeTexture.forEach(d=>{u+=d.getByteCount()});let c=0;o.attribute.forEach(d=>{c+=d.length*4});let m=0;return o.elements.forEach(d=>{m+=d.length*4}),{texture:u,attribute:c,elements:m}},reset:()=>{o.attribute.forEach(u=>u.reset()),o.elements.forEach(u=>u.reset()),o.framebuffer.forEach(u=>u.reset()),o.renderbuffer.forEach(u=>u.reset()),o.shader.forEach(u=>u.reset()),o.program.forEach(u=>u.reset()),o.vertexArray.forEach(u=>u.reset()),o.texture.forEach(u=>u.reset()),o.cubeTexture.forEach(u=>u.reset())},destroy:()=>{o.attribute.forEach(u=>u.destroy()),o.elements.forEach(u=>u.destroy()),o.framebuffer.forEach(u=>u.destroy()),o.renderbuffer.forEach(u=>u.destroy()),o.shader.forEach(u=>u.destroy()),o.program.forEach(u=>u.destroy()),o.vertexArray.forEach(u=>u.destroy()),o.texture.forEach(u=>u.destroy()),o.cubeTexture.forEach(u=>u.destroy()),a.clear(),l.clear()}}}var P8e=oi();function Cfe(e,t,r,n,o=!0,i="uint8",a="nearest",s="rgba"){if(s==="alpha"&&!Ht(e))throw new Error("cannot render to alpha format in webgl1");let l=t.framebuffer(),u=i==="fp16"?t.texture("image-float16",s,"fp16",a):i==="float32"?t.texture("image-float32",s,"float",a):t.texture("image-uint8",s,"ubyte",a),c=o?Ht(e)?t.renderbuffer("depth32f","depth",r,n):t.renderbuffer("depth16","depth",r,n):null;function m(){u.define(r,n),u.attachFramebuffer(l,"color0"),c&&c.attachFramebuffer(l)}m();let d=!1;return{id:P8e(),texture:u,framebuffer:l,depthRenderbuffer:c,getWidth:()=>r,getHeight:()=>n,bind:()=>{l.bind()},setSize:(p,h)=>{r===p&&n===h||(r=p,n=h,u.define(r,n),c&&c.setSize(r,n))},reset:()=>{m()},destroy:()=>{d||(u.destroy(),l.destroy(),c&&c.destroy(),d=!0)}}}function _8e(e,t,r){return e-=e/r,e+=t/r,e}var wB=class{constructor(t){this.count=t;this.avgs=new Map}add(t,r){let n=this.avgs.get(t)||r;return n=_8e(n,r,this.count),this.avgs.set(t,n),n}get(t){return this.avgs.get(t)}stats(){return Object.fromEntries(this.avgs.entries())}clear(){this.avgs.clear()}};function R8e(e){e.calls.drawInstanced=0,e.calls.drawInstancedBase=0,e.calls.multiDrawInstancedBase=0,e.calls.counts=0,e.culled.lod=0,e.culled.frustum=0,e.culled.occlusion=0}function D8e(e){return e.disjointTimerQuery?e.disjointTimerQuery.createQuery():null}function Sfe(e,t,r,n){let o=t.disjointTimerQuery,i=n?.avgCount??30,a=new Map,s=new Map,l=[],u=new wB(i),c=new wB(i),m=[],d=null,p=!1,h=()=>{s.clear(),l.length=0,u.clear(),c.clear(),m=[],d=null,p=!1,o&&a.forEach((y,g)=>{o.deleteQuery(g)}),a.clear()},f=()=>{if(!o)return;let y=D8e(t);y&&(o.beginQuery(o.TIME_ELAPSED,y),s.forEach((g,x)=>{g.queries.push(y)}),a.set(y,{refCount:s.size}),d=y)};return{resolve:()=>{let y=[];if(!o||!m.length||p)return y;a.forEach((x,S)=>{if(x.timeElapsed!==void 0)return;let I=o.getQueryParameter(S,o.QUERY_RESULT_AVAILABLE),v=e.getParameter(o.GPU_DISJOINT);if(I&&!v){let A=o.getQueryParameter(S,o.QUERY_RESULT);x.timeElapsed=A}(I||v)&&o.deleteQuery(S)});let g=[];for(let x of m)if(x.queries.every(S=>a.get(S)?.timeElapsed!==void 0)){let S=0;for(let I of x.queries){let v=a.get(I);S+=v.timeElapsed,v.refCount-=1}if(x.timeElapsed=S,x.root){let I=[],v=(_,T)=>{for(let w of _){let D=w.timeElapsed,M=w.cpu.end-w.cpu.start,E={label:w.label,gpuElapsed:D,gpuAvg:u.add(w.label,D),cpuElapsed:M,cpuAvg:c.add(w.label,M),children:[],calls:w.calls,note:w.note};T.push(E),v(w.children,E.children)}};v(x.children,I);let A=x.cpu.end-x.cpu.start;y.push({label:x.label,gpuElapsed:S,gpuAvg:u.add(x.label,S),cpuElapsed:A,cpuAvg:c.add(x.label,A),children:I,calls:x.calls,note:x.note})}}else g.push(x);return m=g,a.forEach((x,S)=>{x.refCount===0&&a.delete(S)}),y},mark:(y,g)=>{if(!o)return;if(s.has(y))throw new Error(`Timer mark for '${y}' already exists`);let x=g?.captureStats??!1;d!==null&&o.endQuery(o.TIME_ELAPSED);let S={label:y,queries:[],children:[],root:d===null,cpu:{start:Mn(),end:-1},captureStats:x};if(g?.note&&(S.note=g.note),s.set(y,S),l.length&&l[l.length-1].children.push(S),l.push(S),x){if(p)throw new Error("Already capturing stats");R8e(r),p=!0}f()},markEnd:y=>{if(!o)return;let g=s.get(y);if(!g)throw new Error(`Timer mark for '${y}' does not exist`);if(l.pop()?.label!==y)throw new Error(`Timer mark for '${y}' has pending nested mark`);o.endQuery(o.TIME_ELAPSED),s.delete(y),g.cpu.end=Mn(),g.captureStats&&(g.calls={...r.calls},p=!1),m.push(g),s.size>0?f():d=null},stats:()=>({gpu:u.stats(),cpu:c.stats()}),formatedStats:()=>{let y={},g=u.stats(),x=c.stats();for(let S of Object.keys(g)){let I=`${(g[S]/1e3/1e3).toFixed(2)}`,v=`${x[S].toFixed(2)}`;y[S]=`${I} ms | CPU: ${v} ms`}return y},clear:h,destroy:()=>{h()}}}function w8e(e){let t=`${(e.gpuElapsed/1e3/1e3).toFixed(2)}`,r=`${(e.gpuAvg/1e3/1e3).toFixed(2)}`,n=`${e.cpuElapsed.toFixed(2)}`,o=`${e.cpuAvg.toFixed(2)}`;return`${e.label} ${t} ms (avg. ${r} ms) | CPU: ${n} ms (avg. ${o} ms)`}function sI(e){e.map(t=>{let r=w8e(t);t.children.length||t.calls||t.note?(console.groupCollapsed(r),t.calls&&console.log(t.calls),t.note&&console.log(t.note),sI(t.children),console.groupEnd()):console.log(r)})}function Tfe(e,t){function r(o){try{return e.getContext(o,t)}catch{return null}}let n=(t?.preferWebGl1?null:r("webgl2"))||r("webgl")||r("experimental-webgl");return $t&&console.log(`isWebgl2: ${Ht(n)}`),n}function A6(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function Pfe(e,t){let r=e.getError();if(r!==e.NO_ERROR)throw new Error(`WebGL error: '${A6(e,r)}'${t?` (${t})`:""}`)}function E8e(e){let t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(let o=0;o<t;++o)e.activeTexture(e.TEXTURE0+o),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),Ht(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));let r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);let n=e.getParameter(e.MAX_VERTEX_ATTRIBS);for(let o=0;o<n;++o)e.vertexAttribPointer(o,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null)}var _fe=new Uint8Array(1*4);function Rfe(e,t,r){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),r()):$g.setImmediate(Rfe,e,t,r)}function Dfe(e,t){let r=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);r?$g.setImmediate(Rfe,e,r,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,_fe),t())}var vfe=!1;function M8e(e){return new Promise(t=>{Ht(e)?Dfe(e,t):(vfe||(console.info("Sync object not supported in WebGL"),vfe=!0),wfe(e),t())})}function wfe(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,_fe)}function Ife(e,t,r,n,o,i){if($t&&aI(e),i instanceof Uint8Array)e.readPixels(t,r,n,o,e.RGBA,e.UNSIGNED_BYTE,i);else if(i instanceof Float32Array)e.readPixels(t,r,n,o,e.RGBA,e.FLOAT,i);else if(i instanceof Int32Array&&Ht(e))e.readPixels(t,r,n,o,e.RGBA_INTEGER,e.INT,i);else throw new Error("unsupported readPixels buffer type");$t&&Pfe(e)}function I6(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}function EB(e){let t=e.drawingBufferWidth,r=e.drawingBufferHeight;return{width:t,height:r}}function lI(e,t,r,n){let o=t==="vertex"?e.VERTEX_SHADER:e.FRAGMENT_SHADER,i=e[`${r.toUpperCase()}_${n.toUpperCase()}`];return e.getShaderPrecisionFormat(o,i)}function Afe(e,t){return{lowFloat:lI(e,t,"low","float"),mediumFloat:lI(e,t,"medium","float"),highFloat:lI(e,t,"high","float"),lowInt:lI(e,t,"low","int"),mediumInt:lI(e,t,"medium","int"),highInt:lI(e,t,"high","int")}}function B8e(){return{resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,cubeTexture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0,calls:{drawInstanced:0,drawInstancedBase:0,multiDrawInstancedBase:0,counts:0},culled:{lod:0,frustum:0,occlusion:0}}}function Efe(e,t={}){let r=S6(e),n=Hde(e,r),o=B8e(),i=yfe(e,n,o,r),a=Sfe(e,r,o),s={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:Ht(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:r.drawBuffers?e.getParameter(r.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(s.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');let l={vertex:Afe(e,"vertex"),fragment:Afe(e,"fragment")};$t&&console.log({parameters:s,shaderPrecisionFormats:l});let u=r.provokingVertex;u?.provokingVertex(u.FIRST_VERTEX_CONVENTION);let c=!1,m=new En,d=t.pixelScale||1,p;if(Ht(e)){let f=e.createBuffer(),y,g,x=!1,S=()=>{e.bindBuffer(e.PIXEL_PACK_BUFFER,f),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,y),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),x=!1,g(),g=void 0,y=void 0};p=(I,v,A,_,T)=>new Promise((w,D)=>{if(x){D("Can not call multiple readPixelsAsync at the same time");return}x=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,f),e.bufferData(e.PIXEL_PACK_BUFFER,A*_*4,e.STREAM_READ),e.readPixels(I,v,A,_,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),g=w,y=T,Dfe(e,S)})}else p=async(f,y,g,x,S)=>{Ife(e,f,y,g,x,S)};let h=new Set;return{gl:e,isWebGL2:Ht(e),get pixelRatio(){return(typeof window<"u"&&window.devicePixelRatio||1)*(d||1)},extensions:r,state:n,stats:o,resources:i,timer:a,get maxTextureSize(){return s.maxTextureSize},get max3dTextureSize(){return s.max3dTextureSize},get maxRenderbufferSize(){return s.maxRenderbufferSize},get maxDrawBuffers(){return s.maxDrawBuffers},get maxTextureImageUnits(){return s.maxTextureImageUnits},get shaderPrecisionFormats(){return l},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return c||e.isContextLost()},contextRestored:m,setContextLost:()=>{c=!0,a.clear()},handleContextRestored:f=>{lde(e,r),n.reset(),n.currentMaterialId=-1,n.currentProgramId=-1,n.currentRenderItemId=-1,i.reset(),h.forEach(y=>y.reset()),f?.(),c=!1,m.next(Mn())},setPixelScale:f=>{d=f},createRenderTarget:(f,y,g,x,S,I)=>{let v=Cfe(e,i,f,y,g,x,S,I);return h.add(v),{...v,destroy:()=>{v.destroy(),h.delete(v)}}},createDrawTarget:()=>({id:-1,texture:Mo(e),framebuffer:sde(),depthRenderbuffer:null,getWidth:()=>EB(e).width,getHeight:()=>EB(e).height,bind:()=>{I6(e)},setSize:()=>{},reset:()=>{},destroy:()=>{}}),bindDrawingBuffer:()=>I6(e),getDrawingBufferSize:()=>EB(e),readPixels:(f,y,g,x,S)=>{Ife(e,f,y,g,x,S)},readPixelsAsync:p,waitForGpuCommandsComplete:()=>M8e(e),waitForGpuCommandsCompleteSync:()=>wfe(e),getFenceSync:()=>Ht(e)?e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0):null,checkSyncStatus:f=>Ht(e)?e.getSyncParameter(f,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(f),!0):!1:!0,deleteSync:f=>{Ht(e)&&e.deleteSync(f)},clear:(f,y,g,x)=>{let S=EB(e);I6(e),n.enable(e.SCISSOR_TEST),n.depthMask(!0),n.colorMask(!0,!0,!0,!0),n.clearColor(f,y,g,x),n.viewport(0,0,S.width,S.height),n.scissor(0,0,S.width,S.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},checkError:f=>{Pfe(e,f)},checkFramebufferStatus:f=>{aI(e,f)},destroy:f=>{i.destroy(),E8e(e),f?.doNotForceWebGLContextLoss||(e.getExtension("WEBGL_lose_context")?.loseContext(),e.getExtension("STACKGL_destroy_context")?.destroy())}}}function Ht(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext}function ude(e){if(Ht(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};{let t=e.getExtension("ANGLE_instanced_arrays");return t===null?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}}function cde(e){if(Ht(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};{let t=e.getExtension("OES_standard_derivatives");return t===null?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}}function mde(e){return Ht(e)?{}:e.getExtension("OES_element_index_uint")}function dde(e){if(Ht(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};{let t=e.getExtension("OES_vertex_array_object");return t===null?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}}function pde(e){return Ht(e)?{}:e.getExtension("OES_texture_float")}function fde(e){return e.getExtension("OES_texture_float_linear")}function hde(e){if(Ht(e))return{HALF_FLOAT:e.HALF_FLOAT};{let t=e.getExtension("OES_texture_half_float");return t===null?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}}function gde(e){return e.getExtension("OES_texture_half_float_linear")}function yde(e){if(Ht(e))return{MIN:e.MIN,MAX:e.MAX};{let t=e.getExtension("EXT_blend_minmax");return t===null?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}}function bde(e){return Ht(e)?{}:e.getExtension("EXT_frag_depth")}function xde(e){if(Ht(e))return e.getExtension("EXT_color_buffer_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});{let t=e.getExtension("WEBGL_color_buffer_float");return t===null?(e.getExtension("OES_texture_float"),Mfe(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}}function Cde(e){if(Ht(e))return e.getExtension("EXT_color_buffer_half_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});{let t=e.getExtension("EXT_color_buffer_half_float");return t===null?(e.getExtension("OES_texture_half_float"),Mfe(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}}function Sde(e){if(Ht(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};{let t=e.getExtension("WEBGL_draw_buffers");return t===null?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}}function vde(e){let t=e.getExtension("OES_draw_buffers_indexed");return t===null?null:{enablei:t.enableiOES.bind(t),disablei:t.disableiOES.bind(t),blendEquationi:t.blendEquationiOES.bind(t),blendEquationSeparatei:t.blendEquationSeparateiOES.bind(t),blendFunci:t.blendFunciOES.bind(t),blendFuncSeparatei:t.blendFuncSeparateiOES.bind(t),colorMaski:t.colorMaskiOES.bind(t)}}function Ide(e){return Ht(e)?{}:e.getExtension("EXT_shader_texture_lod")}function Ade(e){if(Ht(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};{let t=e.getExtension("WEBGL_depth_texture");return t===null?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}}function Tde(e){if(Ht(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};{let t=e.getExtension("EXT_sRGB");return t===null?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}}function Pde(e){if(Ht(e)){let t=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query");return t===null?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:e.CURRENT_QUERY,QUERY_RESULT:e.QUERY_RESULT,QUERY_RESULT_AVAILABLE:e.QUERY_RESULT_AVAILABLE,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:e.createQuery.bind(e),deleteQuery:e.deleteQuery.bind(e),isQuery:e.isQuery.bind(e),beginQuery:e.beginQuery.bind(e),endQuery:e.endQuery.bind(e),queryCounter:t.queryCounterEXT.bind(t),getQuery:e.getQuery.bind(e),getQueryParameter:e.getQueryParameter.bind(e)}}else{let t=e.getExtension("EXT_disjoint_timer_query");return t===null?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:t.CURRENT_QUERY_EXT,QUERY_RESULT:t.QUERY_RESULT_EXT,QUERY_RESULT_AVAILABLE:t.QUERY_RESULT_AVAILABLE_EXT,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:t.createQueryEXT.bind(t),deleteQuery:t.deleteQueryEXT.bind(t),isQuery:t.isQueryEXT.bind(t),beginQuery:t.beginQueryEXT.bind(t),endQuery:t.endQueryEXT.bind(t),queryCounter:t.queryCounterEXT.bind(t),getQuery:t.getQueryEXT.bind(t),getQueryParameter:t.getQueryObjectEXT.bind(t)}}}function _de(e){let t=e.getExtension("WEBGL_multi_draw");return t?{multiDrawArrays:t.multiDrawArraysWEBGL.bind(t),multiDrawElements:t.multiDrawElementsWEBGL.bind(t),multiDrawArraysInstanced:t.multiDrawArraysInstancedWEBGL.bind(t),multiDrawElementsInstanced:t.multiDrawElementsInstancedWEBGL.bind(t)}:null}function Rde(e){let t=e.getExtension("WEBGL_draw_instanced_base_vertex_base_instance");return t?{drawArraysInstancedBaseInstance:t.drawArraysInstancedBaseInstanceWEBGL.bind(t),drawElementsInstancedBaseVertexBaseInstance:t.drawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(t)}:null}function Dde(e){let t=e.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance");return t?{multiDrawArraysInstancedBaseInstance:t.multiDrawArraysInstancedBaseInstanceWEBGL.bind(t),multiDrawElementsInstancedBaseVertexBaseInstance:t.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(t)}:null}function wde(e){let t=e.getExtension("KHR_parallel_shader_compile");return t===null?null:{COMPLETION_STATUS:t.COMPLETION_STATUS_KHR}}function Ede(e){return Ht(e)?{}:e.getExtension("OES_fbo_render_mipmap")}function Mde(e){if(Ht(e)){let t=e.getExtension("WEBGL_provoking_vertex");if(t)return{FIRST_VERTEX_CONVENTION:t.FIRST_VERTEX_CONVENTION_WEBGL,LAST_VERTEX_CONVENTION:t.LAST_VERTEX_CONVENTION_WEBGL,PROVOKING_VERTEX:t.PROVOKING_VERTEX_WEBGL,provokingVertex:t.provokingVertexWEBGL.bind(t)}}return null}function Bde(e){if(Ht(e)){let t=e.getExtension("WEBGL_clip_cull_distance");if(t)return{MAX_CLIP_DISTANCES:t.MAX_CLIP_DISTANCES_WEBGL,MAX_CULL_DISTANCES:t.MAX_CULL_DISTANCES_WEBGL,MAX_COMBINED_CLIP_AND_CULL_DISTANCES:t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL,CLIP_DISTANCE0:t.CLIP_DISTANCE0_WEBGL,CLIP_DISTANCE1:t.CLIP_DISTANCE1_WEBGL,CLIP_DISTANCE2:t.CLIP_DISTANCE2_WEBGL,CLIP_DISTANCE3:t.CLIP_DISTANCE3_WEBGL,CLIP_DISTANCE4:t.CLIP_DISTANCE4_WEBGL,CLIP_DISTANCE5:t.CLIP_DISTANCE5_WEBGL,CLIP_DISTANCE6:t.CLIP_DISTANCE6_WEBGL,CLIP_DISTANCE7:t.CLIP_DISTANCE7_WEBGL}}return null}function kde(e){return Ht(e)&&e.getExtension("EXT_conservative_depth")?{}:null}function Lde(e){if(Ht(e)){let t=e.getExtension("WEBGL_stencil_texturing");if(t)return{DEPTH_STENCIL_TEXTURE_MODE:t.DEPTH_STENCIL_TEXTURE_MODE_WEBGL,STENCIL_INDEX:t.STENCIL_INDEX_WEBGL}}return null}function Fde(e){let t=e.getExtension("EXT_clip_control");return t?{LOWER_LEFT:t.LOWER_LEFT_EXT,UPPER_LEFT:t.UPPER_LEFT_EXT,NEGATIVE_ONE_TO_ONE:t.NEGATIVE_ONE_TO_ONE_EXT,ZERO_TO_ONE:t.ZERO_TO_ONE_EXT,CLIP_ORIGIN:t.CLIP_ORIGIN_EXT,CLIP_DEPTH_MODE:t.CLIP_DEPTH_MODE_EXT,clipControl:t.clipControlEXT.bind(t)}:null}function Vde(e){return Ht(e)&&e.getExtension("EXT_render_snorm")?{}:null}function Ode(e){return Ht(e)&&e.getExtension("WEBGL_render_shared_exponent")?{}:null}function Gde(e){let t=e.getExtension("EXT_texture_norm16");return t?{R16:t.R16_EXT,RG16:t.RG16_EXT,RGB16:t.RGB16_EXT,RGBA16:t.RGBA16_EXT,R16_SNORM:t.R16_SNORM_EXT,RG16_SNORM:t.RG16_SNORM_EXT,RGB16_SNORM:t.RGB16_SNORM_EXT,RGBA16_SNORM:t.RGBA16_SNORM_EXT}:null}function Ude(e){let t=e.getExtension("EXT_depth_clamp");return t?{DEPTH_CLAMP:t.DEPTH_CLAMP_EXT}:null}function Nde(e){if(Ht(e)){let t=e.getExtension("OVR_multiview2");if(t)return{FRAMEBUFFER_ATTACHMENT_TEXTURE_NUM_VIEWS:t.FRAMEBUFFER_ATTACHMENT_TEXTURE_NUM_VIEWS_OVR,FRAMEBUFFER_ATTACHMENT_TEXTURE_BASE_VIEW_INDEX:t.FRAMEBUFFER_ATTACHMENT_TEXTURE_BASE_VIEW_INDEX_OVR,MAX_VIEWS:t.MAX_VIEWS_OVR,FRAMEBUFFER_INCOMPLETE_VIEW_TARGETS:t.FRAMEBUFFER_INCOMPLETE_VIEW_TARGETS_OVR,framebufferTextureMultiview:t.framebufferTextureMultiviewOVR.bind(t)}}return null}function zde(e){if(!Ht(e))return!1;if(typeof navigator<"u"){let t=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);return t?parseInt(t[1])>=85:!0}return!1}var k8e=`
attribute vec4 aPosition;

void main() {
    gl_Position = aPosition;
}`,L8e=`
precision mediump float;
uniform vec4 uColor;
uniform sampler2D uTexture;

void main() {
    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;
}`,F8e=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function Mfe(e,t){let r=l_(e,{type:"vert",source:k8e}),n=l_(e,{type:"frag",source:L8e});if(!r||!n)return!1;let o=DB(e);e.attachShader(o,r),e.attachShader(o,n),e.linkProgram(o),e.useProgram(o);let i=e.getAttribLocation(o,"aPosition"),a=e.getUniformLocation(o,"uColor");if(!a)return $t&&console.log("error getting 'uColor' uniform location"),!1;let s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,F8e,e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);let l=e.createTexture(),u=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,l),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,u);let c=e.createTexture();e.bindTexture(e.TEXTURE_2D,c),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);let m=e.createFramebuffer();if(e.bindFramebuffer(e.FRAMEBUFFER,m),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,c,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)return $t&&console.log(`error creating framebuffer for '${t}'`),!1;e.bindTexture(e.TEXTURE_2D,l),e.uniform4fv(a,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,c),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(a,[0,1/10,1/20,1]),e.drawArrays(e.TRIANGLES,0,6);let p=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,p),p[0]!==0||p[1]<248||p[2]<248||p[3]<254)return $t&&console.log(`not able to actually render to '${t}' texture`),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,m);let h=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,h);let f=e.getError();if(f)return $t&&console.log(`error reading float pixels: '${A6(e,f)}'`),!1}return!0}var P6=oi();function V8e(e,t){switch(t){case"image-uint8":return e.TEXTURE_2D;case"image-float32":return e.TEXTURE_2D;case"image-float16":return e.TEXTURE_2D;case"image-depth":return e.TEXTURE_2D}if(Ht(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":return e.TEXTURE_3D;case"volume-float32":return e.TEXTURE_3D;case"volume-float16":return e.TEXTURE_3D}throw new Error(`unknown texture kind '${t}'`)}function Ffe(e,t,r){switch(t){case"alpha":return Ht(e)&&(r==="float"||r==="fp16")?e.RED:Ht(e)&&r==="int"?e.RED_INTEGER:e.ALPHA;case"rgb":return Ht(e)&&r==="int"?e.RGB_INTEGER:e.RGB;case"rg":if(Ht(e)&&(r==="float"||r==="fp16"))return e.RG;if(Ht(e)&&r==="int")return e.RG_INTEGER;throw new Error('texture format "rg" requires webgl2 and type "float" or int"');case"rgba":return Ht(e)&&r==="int"?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function O8e(e,t,r){if(Ht(e))switch(t){case"alpha":switch(r){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rg":switch(r){case"ubyte":return e.RG;case"float":return e.RG32F;case"fp16":return e.RG16F;case"int":return e.RG32I}case"rgb":switch(r){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(r){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(r){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return Ffe(e,t,r)}function Vfe(e,t,r,n,o){return G8e(e)*U8e(t)*r*n*(o||1)}function G8e(e){switch(e){case"alpha":return 1;case"rg":return 2;case"rgb":return 3;case"rgba":return 4;case"depth":return 4}}function U8e(e){switch(e){case"ubyte":return 1;case"ushort":return 2;case"float":return 4;case"fp16":return 2;case"int":return 4}}function N8e(e,t,r){switch(r){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if(Ht(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}function Bfe(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function MB(e,t,r){switch(r){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(r){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function kfe(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement}function z8e(e,t,r){return t===r.TEXTURE_2D}function Lfe(e,t,r){return t===r.TEXTURE_3D}function T6(e){let t=e.createTexture();if(t===null)throw new Error("Could not create WebGL texture");return t}function bfe(e,t,r,n,o,i){let a=P6(),s=T6(e);if(r.endsWith("float32")&&o!=="float"||r.endsWith("float16")&&o!=="fp16"||r.endsWith("uint8")&&o!=="ubyte"||r.endsWith("int32")&&o!=="int"||r.endsWith("depth")&&o!=="ushort"&&o!=="float")throw new Error(`texture kind '${r}' and type '${o}' are incompatible`);if(!t.depthTexture&&n==="depth")throw new Error("extension 'WEBGL_depth_texture' needed for 'depth' texture format");let l=V8e(e,r),u=Bfe(e,i),c=Ffe(e,n,o),m=O8e(e,n,o),d=N8e(e,t,o);function p(){e.bindTexture(l,s),e.texParameteri(l,e.TEXTURE_MAG_FILTER,u),e.texParameteri(l,e.TEXTURE_MIN_FILTER,u),e.texParameteri(l,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(l,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(l,null)}p();let h=0,f=0,y=0,g,x=!1,S=!1;function I(T,w,D){if(T===0||w===0||Ht(e)&&l===e.TEXTURE_3D&&D===0)throw new Error("empty textures are not allowed");if(!(h===T&&f===w&&y===(D||0)))if(h=T,f=w,y=D||0,e.bindTexture(l,s),l===e.TEXTURE_2D)e.texImage2D(l,0,m,h,f,0,c,d,null);else if(Ht(e)&&l===e.TEXTURE_3D&&y!==void 0)e.texImage3D(l,0,m,h,f,y,0,c,d,null);else throw new Error("unknown texture target")}I(1,1,Ht(e)&&l===e.TEXTURE_3D?1:0);function v(T,w=!1){if(T.width===0||T.height===0||!kfe(T)&&Ht(e)&&Lfe(T,l,e)&&T.depth===0)throw new Error("empty textures are not allowed");if(e.bindTexture(l,s),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),kfe(T))h=T.width,f=T.height,e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,m,c,d,T);else if(z8e(T,l,e)){let D=T.filter?Bfe(e,T.filter):u;e.texParameteri(l,e.TEXTURE_MAG_FILTER,D),e.texParameteri(l,e.TEXTURE_MIN_FILTER,D),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!T.flipY),w?e.texSubImage2D(l,0,0,0,T.width,T.height,c,d,T.array):(h=T.width,f=T.height,e.texImage2D(l,0,m,h,f,0,c,d,T.array))}else if(Ht(e)&&Lfe(T,l,e))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),w?e.texSubImage3D(l,0,0,0,0,T.width,T.height,T.depth,c,d,T.array):(h=T.width,f=T.height,y=T.depth,e.texImage3D(l,0,m,h,f,y,0,c,d,T.array));else throw new Error("unknown texture target");e.bindTexture(l,null),g=T}function A(){if(l!==e.TEXTURE_2D)throw new Error("mipmap only supported for 2d textures");if(Ht(e)||Rb(h)&&Rb(f))e.bindTexture(l,s),e.texParameteri(l,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(l),e.bindTexture(l,null),x=!0;else throw new Error("mipmap unsupported for non-power-of-two textures and webgl1")}function _(T,w,D){if(T.bind(),l===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,MB(e,t,w),e.TEXTURE_2D,s,0);else if(Ht(e)&&l===e.TEXTURE_3D){if(D===void 0)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,MB(e,t,w),s,0,D)}else throw new Error("unknown/unsupported texture target")}return{id:a,target:l,format:c,internalFormat:m,type:d,filter:u,getWidth:()=>h,getHeight:()=>f,getDepth:()=>y,getByteCount:()=>Vfe(n,o,h,f,y),define:I,load:v,mipmap:A,bind:T=>{e.activeTexture(e.TEXTURE0+T),e.bindTexture(l,s)},unbind:T=>{e.activeTexture(e.TEXTURE0+T),e.bindTexture(l,null)},attachFramebuffer:_,detachFramebuffer:(T,w)=>{if(T.bind(),l===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,MB(e,t,w),e.TEXTURE_2D,null,0);else if(Ht(e)&&l===e.TEXTURE_3D)e.framebufferTextureLayer(e.FRAMEBUFFER,MB(e,t,w),null,0,0);else throw new Error("unknown texture target")},reset:()=>{s=T6(e),p();let[T,w,D]=[h,f,y];h=0,f=0,y=0,I(T,w,D),g&&v(g),x&&A()},destroy:()=>{S||(e.deleteTexture(s),S=!0)}}}function _6(e,t,r){let{resources:n}=e,o=[];return Object.keys(t).forEach(i=>{let a=t[i];if(a.type==="texture"){let s=r[i];if(s)if(a.kind==="texture")o[o.length]=[i,s.ref.value];else{let l=n.texture(a.kind,a.format,a.dataType,a.filter);l.load(s.ref.value),o[o.length]=[i,l]}}}),o}function R6(e,t,r){let n=new Image;n.onload=function(){r.load(n),P.update(t,r)},n.src=e}function H8e(e,t){switch(t){case"nx":return e.TEXTURE_CUBE_MAP_NEGATIVE_X;case"ny":return e.TEXTURE_CUBE_MAP_NEGATIVE_Y;case"nz":return e.TEXTURE_CUBE_MAP_NEGATIVE_Z;case"px":return e.TEXTURE_CUBE_MAP_POSITIVE_X;case"py":return e.TEXTURE_CUBE_MAP_POSITIVE_Y;case"pz":return e.TEXTURE_CUBE_MAP_POSITIVE_Z}}function xfe(e,t,r,n){let o=e.TEXTURE_CUBE_MAP,i=e.LINEAR,a=e.RGBA,s=e.RGBA,l=e.UNSIGNED_BYTE,u=0,c=e.createTexture();e.bindTexture(o,c);function m(f,y,g,x){u===0&&(u=g.width),e.bindTexture(o,c),e.texImage2D(f,y,a,u,u,0,s,l,null),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(o,c),e.texImage2D(f,y,a,s,l,g),p+=1,p===6&&(h||(r?(e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(o)):e.texParameteri(o,e.TEXTURE_MIN_FILTER,i),e.texParameteri(o,e.TEXTURE_MAG_FILTER,i)),x||n?.(h))}let d=[],p=0;gi(t,(f,y)=>{if(!f)return;let g=0,x=H8e(e,y),S=new Image;f instanceof File?S.src=URL.createObjectURL(f):Eb(f)?f.then(I=>{S.src=URL.createObjectURL(I)}):S.src=f,d.push({cubeTarget:x,level:g,image:S}),S.addEventListener("load",()=>{m(x,g,S,!1)}),S.addEventListener("error",()=>{n?.(!0)})});let h=!1;return{id:P6(),target:o,format:s,internalFormat:a,type:l,filter:i,getWidth:()=>u,getHeight:()=>u,getDepth:()=>0,getByteCount:()=>Vfe("rgba","ubyte",u,u,0)*6*(r?2:1),define:()=>{},load:()=>{},mipmap:()=>{},bind:f=>{e.activeTexture(e.TEXTURE0+f),e.bindTexture(o,c)},unbind:f=>{e.activeTexture(e.TEXTURE0+f),e.bindTexture(o,null)},attachFramebuffer:()=>{},detachFramebuffer:()=>{},reset:()=>{c=T6(e),e.bindTexture(o,c),p=0;for(let{cubeTarget:f,level:y,image:g}of d)m(f,y,g,!0)},destroy:()=>{h||(e.deleteTexture(c),h=!0)}}}var Ofe=-1;function Gfe(e){return e.format===Ofe}function Mo(e){let t=e?.TEXTURE_2D??3553;return{id:P6(),target:t,format:Ofe,internalFormat:0,type:0,filter:0,getWidth:()=>0,getHeight:()=>0,getDepth:()=>0,getByteCount:()=>0,define:()=>{},load:()=>{},mipmap:()=>{},bind:r=>{e&&(e.activeTexture(e.TEXTURE0+r),e.bindTexture(t,null))},unbind:r=>{e&&(e.activeTexture(e.TEXTURE0+r),e.bindTexture(t,null))},attachFramebuffer:()=>{throw new Error("cannot attach null-texture to a framebuffer")},detachFramebuffer:()=>{throw new Error("cannot detach null-texture from a framebuffer")},reset:()=>{},destroy:()=>{}}}function Ki(e,t,r,n){let o=j8e(e,t,r,n);if(r.palette){P.updateIfChanged(o.dUsePalette,!0);let[i,a]=r.palette.domain||[0,1];P.update(o.uPaletteDomain,Ie.set(o.uPaletteDomain.ref.value,i,a)),P.update(o.uPaletteDefault,Fe.toVec3Normalized(o.uPaletteDefault.ref.value,r.palette.defaultColor??13421772)),W8e(r.palette,o.tPalette)}else P.updateIfChanged(o.dUsePalette,!1);return o}function j8e(e,t,r,n){switch(r.granularity){case"uniform":return Q8e(e,r.color,n);case"instance":return e.nonInstanceable?Ufe(e,r.color,n):Z8e(e,r.color,n);case"group":return Ufe(e,r.color,n);case"groupInstance":return q8e(e,r.color,n);case"vertex":return Y8e(t,r.color,n);case"vertexInstance":return K8e(t,r.color,n);case"volume":return Nfe(r.grid,"volume",n);case"volumeInstance":return Nfe(r.grid,"volumeInstance",n);case"direct":return J8e(n)}}function W8e(e,t){let r=!0,n=t.ref.value;if(e.colors.length!==n.width||n.filter!==e.filter)r=!1;else{let a=n.array,s=0;for(let l of e.colors){let[u,c,m]=Fe.toRgb(l);if(a[s++]!==u||a[s++]!==c||a[s++]!==m){r=!1;break}}}if(r)return;let o=new Uint8Array(e.colors.length*3),i=0;for(let a of e.colors){let[s,l,u]=Fe.toRgb(a);o[i++]=s,o[i++]=l,o[i++]=u}P.update(t,{array:o,height:1,width:e.colors.length,filter:e.filter})}function X8e(e,t){return t?(P.update(t.uColor,Fe.toVec3Normalized(t.uColor.ref.value,e)),P.updateIfChanged(t.dColorType,"uniform"),t):{uColor:P.create(Fe.toVec3Normalized(b(),e)),tColor:P.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:P.create(Mo()),uPaletteDomain:P.create(Ie.create(0,1)),uPaletteDefault:P.create(b()),tPalette:P.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:P.create(Ie.create(1,1)),uColorGridDim:P.create(b.create(1,1,1)),uColorGridTransform:P.create(Ut.create(0,0,0,1)),dColorType:P.create("uniform"),dUsePalette:P.create(!1)}}function Q8e(e,t,r){return X8e(t(pu,!1),r)}function u_(e,t,r){return r?(P.update(r.tColor,e),P.update(r.uColorTexDim,Ie.create(e.width,e.height)),P.updateIfChanged(r.dColorType,t),r):{uColor:P.create(b()),tColor:P.create(e),tColorGrid:P.create(Mo()),uPaletteDomain:P.create(Ie.create(0,1)),uPaletteDefault:P.create(b()),tPalette:P.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:P.create(Ie.create(e.width,e.height)),uColorGridDim:P.create(b.create(1,1,1)),uColorGridTransform:P.create(Ut.create(0,0,0,1)),dColorType:P.create(t),dUsePalette:P.create(!1)}}function Z8e(e,t,r){let{instanceCount:n}=e,o=so(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){let{location:i,isSecondary:a,instanceIndex:s}=e.move();Fe.toArray(t(i,a),o.array,s*3),e.skipInstance()}return u_(o,"instance",r)}function Ufe(e,t,r){let{groupCount:n,hasLocation2:o}=e,i=so(Math.max(1,n*(o?2:1)),3,Uint8Array,r&&r.tColor.ref.value.array);e.reset();let a=o?6:3;for(;e.hasNext&&!e.isNextNewInstance;){let{location:s,location2:l,isSecondary:u,groupIndex:c}=e.move();Fe.toArray(t(s,u),i.array,c*a),o&&Fe.toArray(t(l,u),i.array,c*a+3)}return u_(i,"group",r)}function q8e(e,t,r){let{groupCount:n,instanceCount:o,hasLocation2:i}=e,a=o*n*(i?2:1),s=so(Math.max(1,a),3,Uint8Array,r&&r.tColor.ref.value.array);e.reset();let l=i?6:3;for(;e.hasNext;){let{location:u,location2:c,isSecondary:m,index:d}=e.move();Fe.toArray(t(u,m),s.array,d*l),i&&Fe.toArray(t(c,m),s.array,d*l+3)}return u_(s,"groupInstance",r)}function Y8e(e,t,r){let{groupCount:n,stride:o}=e,i=so(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;){let{location:a,isSecondary:s,groupIndex:l}=e.move(),u=t(a,s);for(let c=0;c<o;++c)Fe.toArray(u,i.array,(l+c)*3)}return u_(i,"vertex",r)}function K8e(e,t,r){let{groupCount:n,instanceCount:o,stride:i}=e,a=o*n,s=so(Math.max(1,a),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){let{location:l,isSecondary:u,index:c}=e.move(),m=t(l,u);for(let d=0;d<i;++d)Fe.toArray(m,s.array,(c+d)*3)}return u_(s,"vertexInstance",r)}function Nfe(e,t,r){let{colors:n,dimension:o,transform:i}=e,a=n.getWidth(),s=n.getHeight();return r?(P.update(r.tColorGrid,n),P.update(r.uColorTexDim,Ie.create(a,s)),P.update(r.uColorGridDim,b.clone(o)),P.update(r.uColorGridTransform,Ut.clone(i)),P.updateIfChanged(r.dColorType,t),r):{uColor:P.create(b()),tColor:P.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:P.create(n),uPaletteDomain:P.create(Ie.create(0,1)),uPaletteDefault:P.create(b()),tPalette:P.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:P.create(Ie.create(a,s)),uColorGridDim:P.create(b.clone(o)),uColorGridTransform:P.create(Ut.clone(i)),dColorType:P.create(t),dUsePalette:P.create(!1)}}function J8e(e){return e?(P.updateIfChanged(e.dColorType,"direct"),e):{uColor:P.create(b()),tColor:P.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:P.create(Mo()),uPaletteDomain:P.create(Ie.create(0,1)),uPaletteDefault:P.create(b()),tPalette:P.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:P.create(Ie.create(1,1)),uColorGridDim:P.create(b.create(1,1,1)),uColorGridTransform:P.create(Ut.create(0,0,0,1)),dColorType:P.create("direct"),dUsePalette:P.create(!1)}}var D6=b.transformMat4Offset,$8e=b.fromArray,BB=ut.add;function zfe(){return{cellSize:0,cellCount:0,cellOffsets:new Uint32Array,cellSpheres:new Float32Array,cellTransform:new Float32Array,cellInstance:new Float32Array,batchSize:0,batchCount:0,batchOffsets:new Uint32Array,batchSpheres:new Float32Array,batchCell:new Uint32Array}}function Hfe(e,t,r){let n=eWe(e,t),o=tWe(n,r),i=new Uint32Array(n.cellOffsets.length),a=new Float32Array(n.cellSpheres.length),s=new Float32Array(n.cellInstance.length),l=0;for(let c=0,m=o.batchCell.length;c<m;++c){let d=o.batchCell[c],p=n.cellOffsets[d],f=n.cellOffsets[d+1]-p;i[c+1]=i[c]+f;for(let y=0;y<4;++y)a[c*4+y]=n.cellSpheres[d*4+y];for(let y=0;y<f;++y){let g=p+y,x=n.cellInstance[g];for(let S=0;S<16;++S)n.cellTransform[l*16+S]=e.transform[x*16+S];s[l]=x,l+=1}}return{cellSize:n.cellSize,cellCount:n.cellCount,cellOffsets:i,cellSpheres:a,cellTransform:n.cellTransform,cellInstance:s,batchSize:o.batchSize,batchCount:o.batchCount,batchOffsets:o.batchOffsets,batchSpheres:o.batchSpheres,batchCell:_a(o.batchCell)}}function eWe(e,t){let{instanceCount:r,instance:n,transform:o,invariantBoundingSphere:i}=e,a=new Float32Array(r),s=new Float32Array(r),l=new Float32Array(r),u=Se.ofBounds(0,r),c=ut.setEmpty(ut()),{center:m,radius:d}=i,p=b.create(d,d,d),h=b();for(let R=0;R<r;++R)D6(h,m,o,0,0,R*16),a[R]=h[0],s[R]=h[1],l[R]=h[2],BB(c,h);ut.expand(c,c,p);let f={x:a,y:s,z:l,indices:u},y={box:c,sphere:ye.fromBox3D(ye(),c)},g=Cc(f,y,b.create(t,t,t)),{array:x,offset:S,count:I}=g.buckets,v=S.length,A=new Uint32Array(v+1),_=new Float32Array(v*4),T=new Float32Array(r*16),w=new Float32Array(r),D=ut(),M=ye(),E=0;for(let R=0;R<v;++R){let k=S[R],B=I[R];A[R]=k;let L=E;for(let V=k,U=k+B;V<U;++V){let Q=x[V];w[E]=n[Q];for(let O=0;O<16;++O)T[E*16+O]=o[Q*16+O];E+=1}if(B===1)D6(_,m,T,R*4,0,L*16),_[R*4+3]=d;else{ut.setEmpty(D);let V=L*16;for(let U=0;U<B;++U)D6(h,m,T,0,0,U*16+V),BB(D,h);ut.expand(D,D,p),ye.fromBox3D(M,D),ye.toArray(M,_,R*4)}}return A[v]=S[v-1]+I[v-1],{cellSize:t,cellCount:v,cellOffsets:A,cellSpheres:_,cellTransform:T,cellInstance:w}}function tWe(e,t){let{cellCount:r,cellSpheres:n}=e,o=new Float32Array(r),i=new Float32Array(r),a=new Float32Array(r),s=Se.ofBounds(0,r),l=ut.setEmpty(ut()),u=b(),c=0;for(let w=0;w<r;++w){let D=w*4;$8e(u,n,D),o[w]=u[0],i[w]=u[1],a[w]=u[2],BB(l,u),c=Math.max(c,n[D+3])}let m=b.create(c,c,c);ut.expand(l,l,m);let d={x:o,y:i,z:a,indices:s},p={box:l,sphere:ye.fromBox3D(ye(),l)},h=Cc(d,p,b.create(t,t,t)),{array:f,offset:y,count:g}=h.buckets,x=y.length,S=new Uint32Array(x+1),I=new Float32Array(x*4),v=new Uint32Array(r),A=ut(),_=ye(),T=0;for(let w=0;w<x;++w){let D=y[w],M=g[w];S[w]=D;for(let E=D,R=D+M;E<R;++E)v[T]=f[E],T+=1;if(M===1){let E=f[D];I[w*4]=n[E*4],I[w*4+1]=n[E*4+1],I[w*4+2]=n[E*4+2],I[w*4+3]=n[E*4+3]}else{ut.setEmpty(A),c=0;for(let E=D,R=D+M;E<R;++E){let k=f[E];u[0]=n[k*4],u[1]=n[k*4+1],u[2]=n[k*4+2],BB(A,u),c=Math.max(c,n[k*4+3])}b.set(m,c,c,c),ut.expand(A,A,m),ye.fromBox3D(_,A),ye.toArray(_,I,w*4)}}return S[x]=y[x-1]+g[x-1],{batchSize:t,batchCount:x,batchOffsets:S,batchSpheres:I,batchCell:v}}var jfe=Ot(),rWe=Z();function nWe(e,t){for(let r=0;r<t;r++)if(Ot.fromMat4(jfe,Z.fromArray(rWe,e,r*16)),Ot.determinant(jfe)<0)return!0;return!1}function Y0(e,t,r,n,o,i){let a=nWe(e,t);if(i){P.update(i.matrix,i.matrix.ref.value);let s=i.transform.ref.value.length>=t*16?i.transform.ref.value:new Float32Array(t*16);s.set(e),P.update(i.transform,s),P.updateIfChanged(i.uInstanceCount,t),P.updateIfChanged(i.instanceCount,t);let l=i.aTransform.ref.value.length>=t*16?i.aTransform.ref.value:new Float32Array(t*16);P.update(i.aTransform,l);let u=i.extraTransform.ref.value.length>=t*16?i.extraTransform.ref.value:new Float32Array(t*16);P.update(i.extraTransform,uI(u,t));let c=i.aInstance.ref.value.length>=t?i.aInstance.ref.value:new Float32Array(t);P.update(i.aInstance,_a(c,t)),P.update(i.hasReflection,a)}else i={aTransform:P.create(new Float32Array(t*16)),matrix:P.create(Z.identity()),transform:P.create(new Float32Array(e)),extraTransform:P.create(uI(new Float32Array(t*16),t)),uInstanceCount:P.create(t),instanceCount:P.create(t),aInstance:P.create(_a(new Float32Array(t))),hasReflection:P.create(a),instanceGrid:P.create(zfe())};return E6(i,r,n,o),i}var w6=new Float32Array(16);Z.toArray(Z.identity(),w6,0);function kB(e){return Y0(new Float32Array(w6),1,void 0,0,0,e)}function uI(e,t){for(let r=0;r<t;r++)e.set(w6,r*16);return e}function E6(e,t,r,n){let o=e.aTransform.ref.value,i=e.aInstance.ref.value,a=e.instanceCount.ref.value,s=e.matrix.ref.value,l=e.transform.ref.value,u=e.extraTransform.ref.value;for(let c=0;c<a;c++){let m=c*16;Z.mulOffset(o,u,l,m,m,m),Z.mulOffset(o,s,o,m,0,m),i[c]=c}if(t&&a>0){let c=Hfe({instanceCount:a,instance:i,transform:o,invariantBoundingSphere:t},r,n);P.update(e.instanceGrid,c),P.update(e.aInstance,c.cellInstance),P.update(e.aTransform,c.cellTransform)}else P.update(e.aInstance,i),P.update(e.aTransform,o)}var oWe="Gives everything the same, uniform size.",Wfe={value:C.Numeric(1,{min:0,max:20,step:.1})};function iWe(e){return Wfe}function LB(e,t){let r=t.value;return{factory:LB,granularity:"uniform",size:()=>r,props:t,description:oWe}}var Xfe={name:"uniform",label:"Uniform",category:"",factory:LB,getParams:iWe,defaultValues:C.getDefaultValues(Wfe),isApplicable:e=>!0};function Oa(e){return{...Oa.Zero,...e}}(o=>{o.Zero={metalness:0,roughness:0,bumpiness:0};function t(i,a,s){return a[s]=i.metalness*255,a[s+1]=i.roughness*255,a[s+2]=i.bumpiness*255,a}o.toArray=t;function r({metalness:i,roughness:a,bumpiness:s}){return`M ${i.toFixed(2)} | R ${a.toFixed(2)} | B ${s.toFixed(2)}`}o.toString=r;function n(i){return C.Group({metalness:C.Numeric(0,{min:0,max:1,step:.01}),roughness:C.Numeric(1,{min:0,max:1,step:.01}),bumpiness:C.Numeric(0,{min:0,max:1,step:.01})},{...i,presets:[[{metalness:0,roughness:1,bumpiness:0},"Matte"],[{metalness:0,roughness:.2,bumpiness:0},"Plastic"],[{metalness:0,roughness:.6,bumpiness:0},"Glossy"],[{metalness:1,roughness:.6,bumpiness:0},"Metallic"]]})}o.getParam=n})(Oa||={});function mf(){}(m=>{m.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5},m.Params={variant:C.Select("pixel",C.arrayToOptions(["instance","pixel"])),objects:C.ObjectList({type:C.Select("plane",C.objectToOptions(m.Type,d=>ta(d))),invert:C.Boolean(!1),position:C.Vec3(b()),rotation:C.Group({axis:C.Vec3(b.create(1,0,0)),angle:C.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:C.Vec3(b.create(1,1,1)),transform:C.Mat4(Z.identity())},d=>ta(d.type))};function r(d){return{count:0,type:new Array(d).fill(1),invert:new Array(d).fill(!1),position:new Array(d*3).fill(0),rotation:new Array(d*4).fill(0),scale:new Array(d*3).fill(1),transform:new Array(d*16).fill(0)}}let n=Tr(),o=Tr(),i=b(),a=b(),s=Z(),l=Z();function u(d,p){let h=d.objects.length,{type:f,invert:y,position:g,rotation:x,scale:S,transform:I}=p?.objects||r(h);for(let v=0;v<h;++v){let A=d.objects[v];f[v]=m.Type[A.type],y[v]=A.invert,b.toArray(A.position,g,v*3),Tr.toArray(Tr.setAxisAngle(n,A.rotation.axis,vr(A.rotation.angle)),x,v*4),b.toArray(A.scale,S,v*3),Z.toArray(A.transform,I,v*16)}return{variant:d.variant,objects:{count:h,type:f,invert:y,position:g,rotation:x,scale:S,transform:I}}}m.getClip=u;function c(d,p){if(d.variant!==p.variant||d.objects.count!==p.objects.count)return!1;let h=d.objects,f=p.objects;for(let y=0,g=h.count;y<g;++y)if(h.invert[y]!==f.invert[y]||h.type[y]!==f.type[y]||(b.fromArray(i,h.position,y*3),b.fromArray(a,f.position,y*3),!b.equals(i,a))||(b.fromArray(i,h.scale,y*3),b.fromArray(a,f.scale,y*3),!b.equals(i,a))||(Tr.fromArray(n,h.rotation,y*4),Tr.fromArray(o,f.rotation,y*4),!Tr.equals(n,o))||(Z.fromArray(s,h.transform,y*16),Z.fromArray(l,f.transform,y*16),!Z.areEqual(s,l,1e-6)))return!1;return!0}m.areEqual=c})(mf||={});var aWe={custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}},sWe=Object.keys(aWe),c_=C.arrayToOptions(sWe),FB={smoothColors:C.MappedStatic("auto",{auto:C.Group({}),on:C.Group({resolutionFactor:C.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:C.Numeric(3,{min:1,max:12,step:1})}),off:C.Group({})})};function cm(e){return!!e.smoothColors}function fu(e,t,r){if((e.name==="on"||e.name==="auto"&&t)&&r&&r<3){let n=3;return e.name==="on"?(r*=e.params.resolutionFactor,n=e.params.sampleStride):(r*=2-aw(0,1.1,r),r=Math.max(.5,r),r>1.2&&(n=2)),{resolution:r,stride:n}}}var We;(c=>{c.MaterialCategory={category:"Material"},c.ShadingCategory={category:"Shading"},c.CullingLodCategory={category:"Culling & LOD"},c.CustomQualityParamInfo={category:"Custom Quality",hideIf:m=>typeof m.quality<"u"&&m.quality!=="custom"},c.Params={alpha:C.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:C.Select("auto",c_,{isEssential:!0,description:"Visual/rendering quality of the representation."}),material:Oa.getParam(),clip:C.Group(mf.Params),emissive:C.Numeric(0,{min:0,max:1,step:.01}),density:C.Numeric(.2,{min:0,max:1,step:.01},{description:"Density value to estimate object thickness."}),instanceGranularity:C.Boolean(!1,{description:"Use instance granularity for marker, transparency, clipping, overpaint, substance data to save memory."}),lod:C.Vec3(b(),void 0,{...c.CullingLodCategory,description:"Level of detail.",fieldLabels:{x:"Min Distance",y:"Max Distance",z:"Overlap (Shader)"}}),cellSize:C.Numeric(200,{min:0,max:5e3,step:100},{...c.CullingLodCategory,description:"Instance grid cell size."}),batchSize:C.Numeric(2e3,{min:0,max:5e4,step:500},{...c.CullingLodCategory,description:"Instance grid batch size."})};function i(m=Lt.grey,d=1,p){p||(p=kB());let h=Kr(1,p.instanceCount.ref.value,1,()=>pu,!1,()=>!1),f={color:cf({},{value:m,lightness:0,saturation:0}),size:LB({},{value:d})};return{transform:p,locationIterator:h,theme:f}}c.createSimple=i;function a(m,d){let p=mf.getClip(m.clip);return{alpha:P.create(m.alpha),uAlpha:P.create(m.alpha),uVertexCount:P.create(d.vertexCount),uGroupCount:P.create(d.groupCount),drawCount:P.create(d.drawCount),uMetalness:P.create(m.material.metalness),uRoughness:P.create(m.material.roughness),uBumpiness:P.create(m.material.bumpiness),uEmissive:P.create(m.emissive),uDensity:P.create(m.density),dLightCount:P.create(1),dColorMarker:P.create(!0),dClipObjectCount:P.create(p.objects.count),dClipVariant:P.create(p.variant),uClipObjectType:P.create(p.objects.type),uClipObjectInvert:P.create(p.objects.invert),uClipObjectPosition:P.create(p.objects.position),uClipObjectRotation:P.create(p.objects.rotation),uClipObjectScale:P.create(p.objects.scale),uClipObjectTransform:P.create(p.objects.transform),instanceGranularity:P.create(m.instanceGranularity),uLod:P.create(Ut.create(m.lod[0],m.lod[1],m.lod[2],0))}}c.createValues=a;function s(m,d){P.updateIfChanged(m.alpha,d.alpha),P.updateIfChanged(m.uMetalness,d.material.metalness),P.updateIfChanged(m.uRoughness,d.material.roughness),P.updateIfChanged(m.uBumpiness,d.material.bumpiness),P.updateIfChanged(m.uEmissive,d.emissive),P.updateIfChanged(m.uDensity,d.density);let p=mf.getClip(d.clip);P.updateIfChanged(m.dClipObjectCount,p.objects.count),P.updateIfChanged(m.dClipVariant,p.variant),P.update(m.uClipObjectType,p.objects.type),P.update(m.uClipObjectInvert,p.objects.invert),P.update(m.uClipObjectPosition,p.objects.position),P.update(m.uClipObjectRotation,p.objects.rotation),P.update(m.uClipObjectScale,p.objects.scale),P.update(m.uClipObjectTransform,p.objects.transform),P.updateIfChanged(m.instanceGranularity,d.instanceGranularity),P.update(m.uLod,Ut.set(m.uLod.ref.value,d.lod[0],d.lod[1],d.lod[2],0))}c.updateValues=s;function l(m={}){let d=m.alpha===void 0?!0:m.alpha===1;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:d,writeDepth:d}}c.createRenderableState=l;function u(m,d){m.opaque=d.alpha*m.alphaFactor>=1,m.writeDepth=m.opaque}c.updateRenderableState=u})(We||={});function Zfe(e,t,r,n){for(let o=t;o<r;++o)Fe.toArray(n,e,o*4),e[o*4+3]=255;return!0}function M6(e,t,r){return e.fill(0,t*4,r*4),!0}function qfe(e,t,r){let n=so(Math.max(1,e),4,Uint8Array,r&&r.tOverpaint.ref.value.array);return r?(P.update(r.tOverpaint,n),P.update(r.uOverpaintTexDim,Ie.create(n.width,n.height)),P.updateIfChanged(r.dOverpaint,e>0),P.updateIfChanged(r.dOverpaintType,t),r):{tOverpaint:P.create(n),uOverpaintTexDim:P.create(Ie.create(n.width,n.height)),dOverpaint:P.create(e>0),tOverpaintGrid:P.create(Mo()),uOverpaintGridDim:P.create(b.create(1,1,1)),uOverpaintGridTransform:P.create(Ut.create(0,0,0,1)),dOverpaintType:P.create(t),uOverpaintStrength:P.create(1)}}var Qfe={array:new Uint8Array(4),width:1,height:1};function _l(e){return e?(P.update(e.tOverpaint,Qfe),P.update(e.uOverpaintTexDim,Ie.create(1,1)),e):{tOverpaint:P.create(Qfe),uOverpaintTexDim:P.create(Ie.create(1,1)),dOverpaint:P.create(!1),tOverpaintGrid:P.create(Mo()),uOverpaintGridDim:P.create(b.create(1,1,1)),uOverpaintGridTransform:P.create(Ut.create(0,0,0,1)),dOverpaintType:P.create("groupInstance"),uOverpaintStrength:P.create(1)}}function Kfe(e,t,r,n){for(let o=t;o<r;++o)e[o]=n*255;return!0}function B6(e,t){if(t===0||e.length<t)return 0;let r=0;for(let n=0;n<t;++n)r+=e[n];return r/(255*t)}function k6(e,t){if(t===0||e.length<t)return 1;let r=255;for(let n=0;n<t;++n)e[n]>0&&e[n]<r&&(r=e[n]);return r/255}function Jfe(e,t,r){e.fill(0,t,r)}function $fe(e,t,r){let n=so(Math.max(1,e),1,Uint8Array,r&&r.tTransparency.ref.value.array);return r?(P.update(r.tTransparency,n),P.update(r.uTransparencyTexDim,Ie.create(n.width,n.height)),P.updateIfChanged(r.dTransparency,e>0),P.updateIfChanged(r.transparencyAverage,B6(n.array,e)),P.updateIfChanged(r.transparencyMin,k6(n.array,e)),P.updateIfChanged(r.dTransparencyType,t),r):{tTransparency:P.create(n),uTransparencyTexDim:P.create(Ie.create(n.width,n.height)),dTransparency:P.create(e>0),transparencyAverage:P.create(0),transparencyMin:P.create(1),tTransparencyGrid:P.create(Mo()),uTransparencyGridDim:P.create(b.create(1,1,1)),uTransparencyGridTransform:P.create(Ut.create(0,0,0,1)),dTransparencyType:P.create(t),uTransparencyStrength:P.create(1)}}var Yfe={array:new Uint8Array(1),width:1,height:1};function Rl(e){return e?(P.update(e.tTransparency,Yfe),P.update(e.uTransparencyTexDim,Ie.create(1,1)),e):{tTransparency:P.create(Yfe),uTransparencyTexDim:P.create(Ie.create(1,1)),dTransparency:P.create(!1),transparencyAverage:P.create(0),transparencyMin:P.create(1),tTransparencyGrid:P.create(Mo()),uTransparencyGridDim:P.create(b.create(1,1,1)),uTransparencyGridTransform:P.create(Ut.create(0,0,0,1)),dTransparencyType:P.create("groupInstance"),uTransparencyStrength:P.create(1)}}function the(e,t,r,n){return e.fill(n,t,r),!0}function rhe(e,t,r){e.fill(0,t,r)}function nhe(e,t,r){let n=so(Math.max(1,e),1,Uint8Array,r&&r.tClipping.ref.value.array);return r?(P.update(r.tClipping,n),P.update(r.uClippingTexDim,Ie.create(n.width,n.height)),P.updateIfChanged(r.dClipping,e>0),P.updateIfChanged(r.dClippingType,t),r):{tClipping:P.create(n),uClippingTexDim:P.create(Ie.create(n.width,n.height)),dClipping:P.create(e>0),dClippingType:P.create(t)}}var ehe={array:new Uint8Array(1),width:1,height:1};function Dl(e){return e?(P.update(e.tClipping,ehe),P.update(e.uClippingTexDim,Ie.create(1,1)),P.updateIfChanged(e.dClipping,!1),e):{tClipping:P.create(ehe),uClippingTexDim:P.create(Ie.create(1,1)),dClipping:P.create(!1),dClippingType:P.create("groupInstance")}}function ihe(e,t,r,n){for(let o=t;o<r;++o)Oa.toArray(n,e,o*4),e[o*4+3]=255;return!0}function L6(e,t,r){return e.fill(0,t*4,r*4),!0}function ahe(e,t,r){let n=so(Math.max(1,e),4,Uint8Array,r&&r.tSubstance.ref.value.array);return r?(P.update(r.tSubstance,n),P.update(r.uSubstanceTexDim,Ie.create(n.width,n.height)),P.updateIfChanged(r.dSubstance,e>0),P.updateIfChanged(r.dSubstanceType,t),r):{tSubstance:P.create(n),uSubstanceTexDim:P.create(Ie.create(n.width,n.height)),dSubstance:P.create(e>0),tSubstanceGrid:P.create(Mo()),uSubstanceGridDim:P.create(b.create(1,1,1)),uSubstanceGridTransform:P.create(Ut.create(0,0,0,1)),dSubstanceType:P.create(t),uSubstanceStrength:P.create(1)}}var ohe={array:new Uint8Array(4),width:1,height:1};function wl(e){return e?(P.update(e.tSubstance,ohe),P.update(e.uSubstanceTexDim,Ie.create(1,1)),e):{tSubstance:P.create(ohe),uSubstanceTexDim:P.create(Ie.create(1,1)),dSubstance:P.create(!1),tSubstanceGrid:P.create(Mo()),uSubstanceGridDim:P.create(b.create(1,1,1)),uSubstanceGridTransform:P.create(Ut.create(0,0,0,1)),dSubstanceType:P.create("groupInstance"),uSubstanceStrength:P.create(1)}}function lhe(e,t,r,n){for(let o=t;o<r;++o)e[o]=n*255;return!0}function F6(e,t){if(t===0||e.length<t)return 0;let r=0;for(let n=0;n<t;++n)r+=e[n];return r/(255*t)}function uhe(e,t,r){e.fill(0,t,r)}function che(e,t,r){let n=so(Math.max(1,e),1,Uint8Array,r&&r.tEmissive.ref.value.array);return r?(P.update(r.tEmissive,n),P.update(r.uEmissiveTexDim,Ie.create(n.width,n.height)),P.updateIfChanged(r.dEmissive,e>0),P.updateIfChanged(r.emissiveAverage,F6(n.array,e)),P.updateIfChanged(r.dEmissiveType,t),r):{tEmissive:P.create(n),uEmissiveTexDim:P.create(Ie.create(n.width,n.height)),dEmissive:P.create(e>0),emissiveAverage:P.create(0),tEmissiveGrid:P.create(Mo()),uEmissiveGridDim:P.create(b.create(1,1,1)),uEmissiveGridTransform:P.create(Ut.create(0,0,0,1)),dEmissiveType:P.create(t),uEmissiveStrength:P.create(1)}}var she={array:new Uint8Array(1),width:1,height:1};function El(e){return e?(P.update(e.tEmissive,she),P.update(e.uEmissiveTexDim,Ie.create(1,1)),e):{tEmissive:P.create(she),uEmissiveTexDim:P.create(Ie.create(1,1)),dEmissive:P.create(!1),emissiveAverage:P.create(0),tEmissiveGrid:P.create(Mo()),uEmissiveGridDim:P.create(b.create(1,1,1)),uEmissiveGridTransform:P.create(Ut.create(0,0,0,1)),dEmissiveType:P.create("groupInstance"),uEmissiveStrength:P.create(1)}}var ft;(E=>{function e(R,k,B,L,V,U,Q){return Q?o(R,k,B,L,V,U,Q):n(R,k,B,L,V,U)}E.create=e;function t(R){let k=R?R.vertexBuffer.ref.value:new Float32Array(0),B=R?R.indexBuffer.ref.value:new Uint32Array(0),L=R?R.normalBuffer.ref.value:new Float32Array(0),V=R?R.groupBuffer.ref.value:new Float32Array(0);return e(k,B,L,V,0,0,R)}E.createEmpty=t;function r(R){return Ro([R.vertexCount,R.triangleCount,R.vertexBuffer.ref.version,R.indexBuffer.ref.version,R.normalBuffer.ref.version,R.groupBuffer.ref.version])}function n(R,k,B,L,V,U){let Q=ye(),O,q=-1,X=-1,F={kind:"mesh",vertexCount:V,triangleCount:U,vertexBuffer:P.create(R),indexBuffer:P.create(k),normalBuffer:P.create(B),groupBuffer:P.create(L),varyingGroup:P.create(!1),get boundingSphere(){let Y=r(F);if(Y!==q){let $=um(F.vertexBuffer.ref.value,F.vertexCount,1);ye.copy(Q,$),q=Y}return Q},get groupMapping(){return F.groupBuffer.ref.version!==X&&(O=Zd(F.groupBuffer.ref.value,F.vertexCount),X=F.groupBuffer.ref.version),O},setBoundingSphere(Y){ye.copy(Q,Y),q=r(F)},meta:{}};return F}function o(R,k,B,L,V,U,Q){return Q.vertexCount=V,Q.triangleCount=U,P.update(Q.vertexBuffer,R),P.update(Q.indexBuffer,k),P.update(Q.normalBuffer,B),P.update(Q.groupBuffer,L),Q}function i(R){let{vertexCount:k,triangleCount:B}=R,L=R.vertexBuffer.ref.value,V=R.indexBuffer.ref.value,U=R.normalBuffer.ref.value.length>=k*3?R.normalBuffer.ref.value:new Float32Array(k*3);U===R.normalBuffer.ref.value&&U.fill(0,0,k*3),AB(L,V,U,k,B),P.update(R.normalBuffer,U)}E.computeNormals=i;function a(R,k=3){let B=R.vertexBuffer.ref.value,L=new Map,V=(O,q)=>`${O[0].toFixed(q)}|${O[1].toFixed(q)}|${O[2].toFixed(q)}`,U=0,Q=b();for(let O=0,q=R.vertexCount;O<q;++O){b.fromArray(Q,B,O*3);let X=V(Q,k),F=L.get(X);F!==void 0?(U+=1,L.set(X,F+1)):L.set(X,1)}return U}E.checkForDuplicateVertices=a;let s=Ot();function l(R,k){let B=R.vertexBuffer.ref.value;if(Pc(k,B,0,R.vertexCount),!Z.isTranslationAndUniformScaling(k)){let L=Ot.directionTransform(s,k);tde(L,R.normalBuffer.ref.value,0,R.vertexCount)}P.update(R.vertexBuffer,B)}E.transform=l;function u(R){let{originalData:k}="kind"in R?R.meta:R.meta.ref.value;return k}E.getOriginalData=u;function c(R,k=!0){let{indexBuffer:B,vertexBuffer:L,groupBuffer:V,normalBuffer:U,triangleCount:Q,vertexCount:O}=R,q=B.ref.value,X=L.ref.value,F=V.ref.value,Y=U.ref.value,$=Qe.create(Uint32Array,3,1024,Q),ce=Qe.create(Float32Array,3,1024,X);ce.currentIndex=O*3,ce.elementCount=O;let ie=Qe.create(Float32Array,3,1024,Y);ie.currentIndex=O*3,ie.elementCount=O;let oe=Qe.create(Float32Array,1,1024,F);oe.currentIndex=O,oe.elementCount=O;let W=b(),N=b(),j=b(),ue=b(),be=b(),ee=b();function le(Re){b.fromArray(W,X,Re*3),b.fromArray(ue,Y,Re*3),Qe.add3(ce,W[0],W[1],W[2]),Qe.add3(ie,ue[0],ue[1],ue[2])}function Ae(Re,Ke){b.fromArray(W,X,Re*3),b.fromArray(N,X,Ke*3),b.scale(W,b.add(W,W,N),.5),b.fromArray(ue,Y,Re*3),b.fromArray(be,Y,Ke*3),b.scale(ue,b.add(ue,ue,be),.5),Qe.add3(ce,W[0],W[1],W[2]),Qe.add3(ie,ue[0],ue[1],ue[2])}function Ce(Re,Ke,tt){b.fromArray(W,X,Re*3),b.fromArray(N,X,Ke*3),b.fromArray(j,X,tt*3),b.scale(W,b.add(W,b.add(W,W,N),j),1/3),b.fromArray(ue,Y,Re*3),b.fromArray(be,Y,Ke*3),b.fromArray(ee,Y,tt*3),b.scale(ue,b.add(ue,b.add(ue,ue,be),ee),1/3),Qe.add3(ce,W[0],W[1],W[2]),Qe.add3(ie,ue[0],ue[1],ue[2])}function J(Re,Ke,tt,bt,Pt){++ae,le(Re),Ae(Re,Ke),Ae(Re,tt),Qe.add3($,z,z+1,z+2);for(let fr=0;fr<3;++fr)Qe.add(oe,bt);z+=3,ae+=2,le(Ke),le(tt),Ae(Re,Ke),Ae(Re,tt),Qe.add3($,z,z+1,z+3),Qe.add3($,z,z+3,z+2);for(let fr=0;fr<4;++fr)Qe.add(oe,Pt);z+=4}let z=O,ae=0;if(k)for(let Re=0,Ke=Q;Re<Ke;++Re){let tt=q[Re*3],bt=q[Re*3+1],Pt=q[Re*3+2],fr=F[tt],gt=F[bt],Sr=F[Pt];if(fr===gt&&fr===Sr)++ae,Qe.add3($,tt,bt,Pt);else if(fr===gt)J(Pt,tt,bt,Sr,fr);else if(fr===Sr)J(bt,Pt,tt,gt,Sr);else if(gt===Sr)J(tt,bt,Pt,fr,gt);else{ae+=2,le(tt),Ae(tt,bt),Ae(tt,Pt),Ce(tt,bt,Pt),Qe.add3($,z,z+1,z+3),Qe.add3($,z,z+3,z+2);for(let zr=0;zr<4;++zr)Qe.add(oe,fr);z+=4,ae+=2,le(bt),Ae(bt,Pt),Ae(bt,tt),Ce(tt,bt,Pt),Qe.add3($,z,z+1,z+3),Qe.add3($,z,z+3,z+2);for(let zr=0;zr<4;++zr)Qe.add(oe,gt);z+=4,ae+=2,le(Pt),Ae(Pt,bt),Ae(Pt,tt),Ce(tt,bt,Pt),Qe.add3($,z+3,z+1,z),Qe.add3($,z+2,z+3,z);for(let zr=0;zr<4;++zr)Qe.add(oe,Sr);z+=4}}else for(let Re=0,Ke=Q;Re<Ke;++Re){let tt=q[Re*3],bt=q[Re*3+1],Pt=q[Re*3+2],fr=F[tt],gt=F[bt],Sr=F[Pt];if(fr!==gt||fr!==Sr){++ae,le(tt),le(bt),le(Pt),Qe.add3($,z,z+1,z+2);let zr=gt===Sr?gt:fr;for(let Nn=0;Nn<3;++Nn)Qe.add(oe,zr);z+=3}else++ae,Qe.add3($,tt,bt,Pt)}let ge=Qe.compact($),ve=Qe.compact(ce),Oe=Qe.compact(ie),ze=Qe.compact(oe);return R.vertexCount=z,R.triangleCount=ae,P.update(L,ve),P.update(V,ze),P.update(B,ge),P.update(U,Oe),R.meta.originalData={indexBuffer:q,vertexCount:O,triangleCount:Q},R}E.uniformTriangleGroup=c;function m(R){let{vertexCount:k,triangleCount:B}=R,L=R.indexBuffer.ref.value,V=[];for(let U=0;U<k;++U)V[U]=[];for(let U=0;U<B;++U){let Q=L[U*3],O=L[U*3+1],q=L[U*3+2];qo(V[Q],O),qo(V[Q],q),qo(V[O],Q),qo(V[O],q),qo(V[q],Q),qo(V[q],O)}return V}function d(R){let{triangleCount:k}=R,B=R.indexBuffer.ref.value,L=new Map,V=(U,Q)=>{let O=cc(U,Q),q=L.get(O)||0;L.set(O,q+1)};for(let U=0;U<k;++U){let Q=B[U*3],O=B[U*3+1],q=B[U*3+2];V(Q,O),V(Q,q),V(O,q)}return L}function p(R){let k=new Set,B=[0,0];return R.forEach((L,V)=>{L===1&&(N1(B,V),k.add(B[0]),k.add(B[1]))}),k}function h(R,k,B){let L=new Map,V=(U,Q)=>{L.has(U)?qo(L.get(U),Q):L.set(U,[Q])};return k.forEach(U=>{let Q=R[U];for(let O of Q)k.has(O)&&B.get(cc(U,O))===1&&V(U,O)}),L}function f(R,k){let{indexBuffer:B,triangleCount:L}=R,V=B.ref.value,U=Qe.create(Uint32Array,3,1024,L),Q=0;for(let q=0;q<L;++q){let X=V[q*3],F=V[q*3+1],Y=V[q*3+2];k[X].length===2||k[F].length===2||k[Y].length===2||(Qe.add3(U,X,F,Y),Q+=1)}let O=Qe.compact(U);return R.triangleCount=Q,P.update(B,O),R}function y(R,k,B,L){let{vertexBuffer:V,indexBuffer:U,normalBuffer:Q,triangleCount:O}=R,q=V.ref.value,X=U.ref.value,F=Q.ref.value,Y=Qe.create(Uint32Array,3,1024,O),$=0;for(let ae=0;ae<O;++ae)Qe.add3(Y,X[ae*3],X[ae*3+1],X[ae*3+2]),$+=1;let ce=b(),ie=b(),oe=b(),W=b(),N=b(),j=b(),ue=b(),be=b(),ee=b(),le=b(),Ae=vr(120),Ce=new Set,J=Array.from(B.keys()).filter(ae=>B.get(ae).length<2).map(ae=>{let ge=B.get(ae);return b.fromArray(ce,q,ae*3),b.fromArray(ie,q,ge[0]*3),b.fromArray(oe,q,ge[1]*3),b.sub(N,ie,ce),b.sub(j,oe,ce),[ae,b.angle(N,j)]});J.sort(([,ae],[,ge])=>ae-ge);for(let[ae,ge]of J){if(Ce.has(ae)||ge>Ae)continue;let ve=B.get(ae);if(k[ve[0]].includes(ve[1])&&!B.get(ve[0])?.includes(ve[1])||(b.fromArray(ce,q,ae*3),b.fromArray(ie,q,ve[0]*3),b.fromArray(oe,q,ve[1]*3),b.sub(N,ie,ce),b.sub(j,oe,ce),b.add(be,N,j),b.squaredDistance(ce,ie)>=L))continue;let Oe=!1;for(let ze of k[ae])if(!ve.includes(ze)&&(b.fromArray(W,q,ze*3),b.sub(ue,W,ce),b.dot(be,ue)<0)){Oe=!0;break}Oe&&(b.fromArray(ee,F,ae*3),b.triangleNormal(le,ce,ie,oe),b.dot(le,ee)>0?Qe.add3(Y,ae,ve[0],ve[1]):Qe.add3(Y,ve[1],ve[0],ae),Ce.add(ae),Ce.add(ve[0]),Ce.add(ve[1]),$+=1)}let z=Qe.compact(Y);return R.triangleCount=$,P.update(U,z),R}function g(R,k,B){let{iterations:L,lambda:V}=B,U=b(),Q=b(),O=b(),q=b(),X=-V,F=new Float32Array(R.vertexBuffer.ref.value.length),Y=$=>{let ce=R.vertexBuffer.ref.value;F.set(ce),k.forEach((oe,W)=>{if(oe.length!==2)return;b.fromArray(U,ce,W*3),b.fromArray(Q,ce,oe[0]*3),b.fromArray(O,ce,oe[1]*3);let N=1/b.distance(U,Q),j=1/b.distance(U,O);b.scale(Q,Q,N),b.scale(O,O,j),b.add(q,Q,O),b.scale(q,q,1/(N+j)),b.sub(q,q,U),b.scale(q,q,$),b.add(q,U,q),b.toArray(q,F,W*3)});let ie=R.vertexBuffer.ref.value;P.update(R.vertexBuffer,F),F=ie};for(let $=0;$<L;++$)Y(V),Y(X)}function x(R,k){f(R,m(R));for(let Q=0;Q<10;++Q){let O=R.triangleCount,q=d(R),X=m(R),F=p(q),Y=h(X,F,q);if(y(R,X,Y,k.maxNewEdgeLength*k.maxNewEdgeLength),R.triangleCount===O)break}let B=d(R),L=m(R),V=p(B),U=h(L,V,B);return g(R,U,{iterations:k.iterations,lambda:.5}),R}E.smoothEdges=x,E.Params={...We.Params,doubleSided:C.Boolean(!1,We.CustomQualityParamInfo),flipSided:C.Boolean(!1,We.ShadingCategory),flatShaded:C.Boolean(!1,We.ShadingCategory),ignoreLight:C.Boolean(!1,We.ShadingCategory),celShaded:C.Boolean(!1,We.ShadingCategory),xrayShaded:C.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],We.ShadingCategory),transparentBackfaces:C.Select("off",C.arrayToOptions(["off","on","opaque"]),We.ShadingCategory),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},We.ShadingCategory),bumpAmplitude:C.Numeric(1,{min:0,max:5,step:.1},We.ShadingCategory)},E.Utils={Params:E.Params,createEmpty:t,createValues:A,createValuesSimple:_,updateValues:T,updateBoundingSphere:w,createRenderableState:D,updateRenderableState:M,createPositionIterator:v};function v(R,k){let B=R.vertexCount,L=k.instanceCount.ref.value,V=As(),U=V.position,Q=V.normal,O=R.vertexBuffer.ref.value,q=R.normalBuffer.ref.value,X=k.aTransform.ref.value;return Kr(B,L,1,(Y,$)=>($<0?(b.fromArray(U,O,Y*3),b.fromArray(Q,q,Y*3)):(b.transformMat4Offset(U,O,X,0,Y*3,$*16),b.transformDirectionOffset(Q,q,X,0,Y*3,$*16)),V))}function A(R,k,B,L,V){let{instanceCount:U,groupCount:Q}=B,O=v(R,k),q=Ki(B,O,L.color),X=V.instanceGranularity?oo(U,"instance"):oo(U*Q,"groupInstance"),F=_l(),Y=Rl(),$=El(),ce=wl(),ie=Dl(),oe={drawCount:R.triangleCount*3,vertexCount:R.vertexCount,groupCount:Q,instanceCount:U},W=ye.clone(R.boundingSphere),N=Si(W,k.aTransform.ref.value,U,0);return{dGeometryType:P.create("mesh"),aPosition:R.vertexBuffer,aNormal:R.normalBuffer,aGroup:R.groupBuffer,elements:R.indexBuffer,dVaryingGroup:R.varyingGroup,boundingSphere:P.create(N),invariantBoundingSphere:P.create(W),uInvariantBoundingSphere:P.create(Ut.ofSphere(W)),...q,...X,...F,...Y,...$,...ce,...ie,...k,...We.createValues(V,oe),uDoubleSided:P.create(V.doubleSided),dFlatShaded:P.create(V.flatShaded),dFlipSided:P.create(V.flipSided),dIgnoreLight:P.create(V.ignoreLight),dCelShaded:P.create(V.celShaded),dXrayShaded:P.create(V.xrayShaded==="inverted"?"inverted":V.xrayShaded===!0?"on":"off"),dTransparentBackfaces:P.create(V.transparentBackfaces),uBumpFrequency:P.create(V.bumpFrequency),uBumpAmplitude:P.create(V.bumpAmplitude),meta:P.create(R.meta)}}function _(R,k,B,L,V){let U=We.createSimple(B,L,V),Q={...C.getDefaultValues(E.Params),...k};return A(R,U.transform,U.locationIterator,U.theme,Q)}function T(R,k){We.updateValues(R,k),P.updateIfChanged(R.uDoubleSided,k.doubleSided),P.updateIfChanged(R.dFlatShaded,k.flatShaded),P.updateIfChanged(R.dFlipSided,k.flipSided),P.updateIfChanged(R.dIgnoreLight,k.ignoreLight),P.updateIfChanged(R.dCelShaded,k.celShaded),P.updateIfChanged(R.dXrayShaded,k.xrayShaded==="inverted"?"inverted":k.xrayShaded===!0?"on":"off"),P.updateIfChanged(R.dTransparentBackfaces,k.transparentBackfaces),P.updateIfChanged(R.uBumpFrequency,k.bumpFrequency),P.updateIfChanged(R.uBumpAmplitude,k.bumpAmplitude)}function w(R,k){let B=ye.clone(k.boundingSphere),L=Si(B,R.aTransform.ref.value,R.instanceCount.ref.value,0);ye.equals(L,R.boundingSphere.ref.value)||P.update(R.boundingSphere,L),ye.equals(B,R.invariantBoundingSphere.ref.value)||(P.update(R.invariantBoundingSphere,B),P.update(R.uInvariantBoundingSphere,Ut.fromSphere(R.uInvariantBoundingSphere.ref.value,B)))}function D(R){let k=We.createRenderableState(R);return M(k,R),k}function M(R,k){We.updateRenderableState(R,k),R.opaque=R.opaque&&!k.xrayShaded,R.writeDepth=R.opaque}})(ft||={});function df(e,t,r){return e=Br(Math.round(e),0,16777215)+1,t[r+2]=e%256,e=Math.floor(e/256),t[r+1]=e%256,e=Math.floor(e/256),t[r]=e%256,t}function Ix(e,t,r){return Math.floor(e)*256*256+Math.floor(t)*256+Math.floor(r)-1}var VB=255/256,V6=b.create(256*256*256,256*256,256),lWe=Ut.create(VB/V6[0],VB/V6[1],VB/V6[2],VB/1),mhe=Ut();function dhe(e,t,r,n){return Ut.set(mhe,e/255,t/255,r/255,n/255),Ut.dot(mhe,lWe)}function phe(e,t){let r=-1/0;for(let n=0,o=e.length;n<o;n+=t){let i=Ix(e[n],e[n+1],e[n+2]);i>r&&(r=i)}return r}function Ml(e,t,r){switch(Ga.getGranularity(e,t.granularity)){case"uniform":return dWe(e,t.size,r);case"group":return fWe(e,t.size,r);case"groupInstance":return hWe(e,t.size,r);case"instance":return pWe(e,t.size,r)}}var OB=100;function Ax(e){switch(e.dSizeType.ref.value){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":let r=0,n=e.tSize.ref.value.array;for(let o=0,i=n.length;o<i;o+=3){let a=Ix(n[o],n[o+1],n[o+2]);r<a&&(r=a)}return r/OB}}var uWe={array:new Uint8Array(3),width:1,height:1};function cWe(){return{tSize:P.create(uWe),uSizeTexDim:P.create(Ie.create(1,1))}}function mWe(e,t){return t?(P.update(t.uSize,e),P.updateIfChanged(t.dSizeType,"uniform"),t):{uSize:P.create(e),...cWe(),dSizeType:P.create("uniform")}}function dWe(e,t,r){return mWe(t(pu),r)}function O6(e,t,r){return r?(P.update(r.tSize,e),P.update(r.uSizeTexDim,Ie.create(e.width,e.height)),P.updateIfChanged(r.dSizeType,t),r):{uSize:P.create(0),tSize:P.create(e),uSizeTexDim:P.create(Ie.create(e.width,e.height)),dSizeType:P.create(t)}}function pWe(e,t,r){let{instanceCount:n}=e,o=so(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){let i=e.move();df(t(i.location)*OB,o.array,i.instanceIndex*3),e.skipInstance()}return O6(o,"instance",r)}function fWe(e,t,r){let{groupCount:n}=e,o=so(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){let i=e.move();df(t(i.location)*OB,o.array,i.groupIndex*3)}return O6(o,"group",r)}function hWe(e,t,r){let{groupCount:n,instanceCount:o}=e,i=o*n,a=so(Math.max(1,i),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext;){let s=e.move();df(t(s.location)*OB,a.array,s.index*3)}return O6(a,"groupInstance",r)}var ml;(g=>{function e(x,S,I,v){return v?o(x,S,I,v):n(x,S,I)}g.create=e;function t(x){let S=x?x.centerBuffer.ref.value:new Float32Array(0),I=x?x.groupBuffer.ref.value:new Float32Array(0);return e(S,I,0,x)}g.createEmpty=t;function r(x){return Ro([x.pointCount,x.centerBuffer.ref.version,x.groupBuffer.ref.version])}function n(x,S,I){let v=ye(),A,_=-1,T=-1,w={kind:"points",pointCount:I,centerBuffer:P.create(x),groupBuffer:P.create(S),get boundingSphere(){let D=r(w);if(D!==_){let M=um(w.centerBuffer.ref.value,w.pointCount,1);ye.copy(v,M),_=D}return v},get groupMapping(){return w.groupBuffer.ref.version!==T&&(A=Zd(w.groupBuffer.ref.value,w.pointCount),T=w.groupBuffer.ref.version),A},setBoundingSphere(D){ye.copy(v,D),_=r(w)}};return w}function o(x,S,I,v){return v.pointCount=I,P.update(v.centerBuffer,x),P.update(v.groupBuffer,S),v}function i(x,S){let I=x.centerBuffer.ref.value;Pc(S,I,0,x.pointCount),P.update(x.centerBuffer,I)}g.transform=i,g.StyleTypes={square:"Square",circle:"Circle",fuzzy:"Fuzzy"},g.StyleTypeNames=Object.keys(g.StyleTypes),g.Params={...We.Params,sizeFactor:C.Numeric(3,{min:0,max:10,step:.1}),pointSizeAttenuation:C.Boolean(!1),pointStyle:C.Select("square",C.objectToOptions(g.StyleTypes))},g.Utils={Params:g.Params,createEmpty:t,createValues:m,createValuesSimple:d,updateValues:p,updateBoundingSphere:h,createRenderableState:f,updateRenderableState:y,createPositionIterator:c};function c(x,S){let I=x.pointCount,v=S.instanceCount.ref.value,A=As(),_=A.position,T=x.centerBuffer.ref.value,w=S.aTransform.ref.value;return Kr(I,v,1,(M,E)=>(E<0?b.fromArray(_,T,M*3):b.transformMat4Offset(_,T,w,0,M*3,E*16),A))}function m(x,S,I,v,A){let{instanceCount:_,groupCount:T}=I,w=c(x,S),D=Ki(I,w,v.color),M=Ml(I,v.size),E=A.instanceGranularity?oo(_,"instance"):oo(_*T,"groupInstance"),R=_l(),k=Rl(),B=El(),L=wl(),V=Dl(),U={drawCount:x.pointCount,vertexCount:x.pointCount,groupCount:T,instanceCount:_},Q=ye.clone(x.boundingSphere),O=Si(Q,S.aTransform.ref.value,_,0);return{dGeometryType:P.create("points"),aPosition:x.centerBuffer,aGroup:x.groupBuffer,boundingSphere:P.create(O),invariantBoundingSphere:P.create(Q),uInvariantBoundingSphere:P.create(Ut.ofSphere(Q)),...D,...M,...E,...R,...k,...B,...L,...V,...S,...We.createValues(A,U),uSizeFactor:P.create(A.sizeFactor),dPointSizeAttenuation:P.create(A.pointSizeAttenuation),dPointStyle:P.create(A.pointStyle)}}function d(x,S,I,v,A){let _=We.createSimple(I,v,A),T={...C.getDefaultValues(g.Params),...S};return m(x,_.transform,_.locationIterator,_.theme,T)}function p(x,S){We.updateValues(x,S),P.updateIfChanged(x.uSizeFactor,S.sizeFactor),P.updateIfChanged(x.dPointSizeAttenuation,S.pointSizeAttenuation),P.updateIfChanged(x.dPointStyle,S.pointStyle)}function h(x,S){let I=ye.clone(S.boundingSphere),v=Si(I,x.aTransform.ref.value,x.instanceCount.ref.value,0);ye.equals(v,x.boundingSphere.ref.value)||P.update(x.boundingSphere,v),ye.equals(I,x.invariantBoundingSphere.ref.value)||(P.update(x.invariantBoundingSphere,I),P.update(x.uInvariantBoundingSphere,Ut.fromSphere(x.uInvariantBoundingSphere.ref.value,I)))}function f(x){let S=We.createRenderableState(x);return y(S,x),S}function y(x,S){We.updateRenderableState(x,S),x.opaque=x.opaque&&S.pointStyle!=="fuzzy",x.writeDepth=x.opaque}})(ml||={});function G6(e,t,r,n,o,i,a){for(let s=0;s<t;s++){for(let l=0;l<r;l++)n[l]=e[l*t+s];fhe(n,o,i,a,r);for(let l=0;l<r;l++)e[l*t+s]=o[l]}for(let s=0;s<r;s++){for(let l=0;l<t;l++)n[l]=e[s*t+l];fhe(n,o,i,a,t);for(let l=0;l<t;l++)e[s*t+l]=Math.sqrt(o[l])}}function fhe(e,t,r,n,o){r[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(let i=1,a=0;i<o;i++){let s=(e[i]+i*i-(e[r[a]]+r[a]*r[a]))/(2*i-2*r[a]);for(;s<=n[a];)a--,s=(e[i]+i*i-(e[r[a]]+r[a]*r[a]))/(2*i-2*r[a]);a++,r[a]=i,n[a]=s,n[a+1]=Number.MAX_SAFE_INTEGER}for(let i=0,a=0;i<o;i++){for(;n[a+1]<i;)a++;t[i]=(i-r[a])*(i-r[a])+e[r[a]]}}var U6={};function ghe(e){let t=JSON.stringify(e);return U6[t]===void 0&&(U6[t]=new N6(e)),U6[t]}var z6={fontFamily:C.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:C.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:C.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:C.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:C.Select("normal",[["normal","Normal"],["bold","Bold"]])},N6=class{constructor(t={}){this.mapped={};this.scratchW=0;this.scratchH=0;this.currentX=0;this.currentY=0;this.cutoff=.5;let r={...C.getDefaultValues(z6),...t};this.props=r;let n=32*(r.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(this.lineHeight*.75),this.texture=so(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchContext=yWe(this.maxWidth,this.lineHeight,{willReadFrequently:!0}),this.scratchContext.font=`${r.fontStyle} ${r.fontVariant} ${r.fontWeight} ${n}px ${r.fontFamily}`,this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get("\uFFFD")}get(t){if(this.mapped[t]===void 0){this.draw(t);let{array:r,width:n,height:o}=this.texture,i=this.scratchData;if(this.currentX+this.scratchW>n&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>o)return console.warn("canvas to small"),this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(let a=0;a<this.scratchH;++a)for(let s=0;s<this.scratchW;++s)r[n*(this.currentY+a)+this.currentX+s]=i[a*this.scratchW+s];this.currentX+=this.scratchW}return this.mapped[t]}draw(t){let r=this.lineHeight,n=this.scratchContext,o=this.scratchData,i=n.measureText(t),a=Math.min(this.maxWidth,Math.ceil(i.width+2*this.buffer)),s=a*r;n.clearRect(0,0,a,r),n.fillText(t,this.buffer,this.middle);let l=n.getImageData(0,0,a,r);for(let u=0;u<s;u++){let c=l.data[u*4+3]/255;this.gridOuter[u]=c===1?0:c===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-c),2),this.gridInner[u]=c===1?Number.MAX_SAFE_INTEGER:c===0?0:Math.pow(Math.max(0,c-.5),2)}G6(this.gridOuter,a,r,this.f,this.d,this.v,this.z),G6(this.gridInner,a,r,this.f,this.d,this.v,this.z);for(let u=0;u<s;u++){let c=this.gridOuter[u]-this.gridInner[u];o[u]=Math.max(0,Math.min(255,Math.round(255-255*(c/this.radius+this.cutoff))))}this.scratchW=a,this.scratchH=r}},hhe;function gWe(){if(!hhe)throw new Error("When running in Node.js and wanting to use Canvas API, call mol-util/data-source's setCanvasModule function first and pass imported `canvas` module to it.");return hhe}function yWe(e,t,r){if(tf)return gWe().createCanvas(e,t).getContext("2d",r);{let n=document.createElement("canvas");return n.width=e,n.height=t,n.getContext("2d",r)}}var Ui;(h=>{function e(f,y,g,x,S,I,v,A,_){return _?o(f,y,g,x,S,I,v,A,_):n(f,y,g,x,S,I,v,A)}h.create=e;function t(f){let y=f?f.fontTexture.ref.value:so(0,1,Uint8Array),g=f?f.centerBuffer.ref.value:new Float32Array(0),x=f?f.mappingBuffer.ref.value:new Float32Array(0),S=f?f.depthBuffer.ref.value:new Float32Array(0),I=f?f.indexBuffer.ref.value:new Uint32Array(0),v=f?f.groupBuffer.ref.value:new Float32Array(0),A=f?f.tcoordBuffer.ref.value:new Float32Array(0);return e(y,g,x,S,I,v,A,0,f)}h.createEmpty=t;function r(f){return Ro([f.charCount,f.fontTexture.ref.version,f.centerBuffer.ref.version,f.mappingBuffer.ref.version,f.depthBuffer.ref.version,f.indexBuffer.ref.version,f.groupBuffer.ref.version,f.tcoordBuffer.ref.version])}function n(f,y,g,x,S,I,v,A){let _=ye(),T,w=-1,D=-1,M={kind:"text",charCount:A,fontTexture:P.create(f),centerBuffer:P.create(y),mappingBuffer:P.create(g),depthBuffer:P.create(x),indexBuffer:P.create(S),groupBuffer:P.create(I),tcoordBuffer:P.create(v),get boundingSphere(){let E=r(M);if(E!==w){let R=um(M.centerBuffer.ref.value,M.charCount*4,4);ye.copy(_,R),w=E}return _},get groupMapping(){return M.groupBuffer.ref.version!==D&&(T=Zd(M.groupBuffer.ref.value,M.charCount,4),D=M.groupBuffer.ref.version),T},setBoundingSphere(E){ye.copy(_,E),w=r(M)}};return M}function o(f,y,g,x,S,I,v,A,_){return _.charCount=A,P.update(_.fontTexture,f),P.update(_.centerBuffer,y),P.update(_.mappingBuffer,g),P.update(_.depthBuffer,x),P.update(_.indexBuffer,S),P.update(_.groupBuffer,I),P.update(_.tcoordBuffer,v),_}h.Params={...We.Params,...z6,sizeFactor:C.Numeric(1,{min:0,max:10,step:.1}),borderWidth:C.Numeric(0,{min:0,max:.5,step:.01}),borderColor:C.Color(Lt.grey),offsetX:C.Numeric(0,{min:0,max:10,step:.1}),offsetY:C.Numeric(0,{min:0,max:10,step:.1}),offsetZ:C.Numeric(0,{min:0,max:10,step:.1}),background:C.Boolean(!1),backgroundMargin:C.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:C.Color(Lt.grey),backgroundOpacity:C.Numeric(1,{min:0,max:1,step:.01}),tether:C.Boolean(!1),tetherLength:C.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:C.Numeric(.3,{min:0,max:1,step:.01}),attachment:C.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])},h.Utils={Params:h.Params,createEmpty:t,createValues:l,createValuesSimple:u,updateValues:c,updateBoundingSphere:m,createRenderableState:d,updateRenderableState:p,createPositionIterator:s};function s(f,y){let g=f.charCount*4,x=y.instanceCount.ref.value,S=As(),I=S.position,v=f.centerBuffer.ref.value,A=y.aTransform.ref.value;return Kr(g,x,4,(T,w)=>(w<0?b.fromArray(I,v,T*3):b.transformMat4Offset(I,v,A,0,T*3,w*16),S))}function l(f,y,g,x,S){let{instanceCount:I,groupCount:v}=g,A=s(f,y),_=Ki(g,A,x.color),T=Ml(g,x.size),w=S.instanceGranularity?oo(I,"instance"):oo(I*v,"groupInstance"),D=_l(),M=Rl(),E=El(),R=wl(),k=Dl(),B={drawCount:f.charCount*2*3,vertexCount:f.charCount*4,groupCount:v,instanceCount:I},L=yhe(f.mappingBuffer.ref.value,f.depthBuffer.ref.value,f.charCount,Ax(T)),V=ye.expand(ye(),f.boundingSphere,L),U=Si(V,y.aTransform.ref.value,I,0);return{dGeometryType:P.create("text"),aPosition:f.centerBuffer,aMapping:f.mappingBuffer,aDepth:f.depthBuffer,aGroup:f.groupBuffer,elements:f.indexBuffer,boundingSphere:P.create(U),invariantBoundingSphere:P.create(V),uInvariantBoundingSphere:P.create(Ut.ofSphere(V)),..._,...T,...w,...D,...M,...E,...R,...k,...y,aTexCoord:f.tcoordBuffer,tFont:f.fontTexture,padding:P.create(L),...We.createValues(S,B),uSizeFactor:P.create(S.sizeFactor),uBorderWidth:P.create(Br(S.borderWidth,0,.5)),uBorderColor:P.create(Fe.toArrayNormalized(S.borderColor,b.zero(),0)),uOffsetX:P.create(S.offsetX),uOffsetY:P.create(S.offsetY),uOffsetZ:P.create(S.offsetZ),uBackgroundColor:P.create(Fe.toArrayNormalized(S.backgroundColor,b.zero(),0)),uBackgroundOpacity:P.create(S.backgroundOpacity)}}function u(f,y,g,x,S){let I=We.createSimple(g,x,S),v={...C.getDefaultValues(h.Params),...y};return l(f,I.transform,I.locationIterator,I.theme,v)}function c(f,y){We.updateValues(f,y),P.updateIfChanged(f.uSizeFactor,y.sizeFactor),P.updateIfChanged(f.uBorderWidth,y.borderWidth),Fe.fromNormalizedArray(f.uBorderColor.ref.value,0)!==y.borderColor&&(Fe.toArrayNormalized(y.borderColor,f.uBorderColor.ref.value,0),P.update(f.uBorderColor,f.uBorderColor.ref.value)),P.updateIfChanged(f.uOffsetX,y.offsetX),P.updateIfChanged(f.uOffsetY,y.offsetY),P.updateIfChanged(f.uOffsetZ,y.offsetZ),Fe.fromNormalizedArray(f.uBackgroundColor.ref.value,0)!==y.backgroundColor&&(Fe.toArrayNormalized(y.backgroundColor,f.uBackgroundColor.ref.value,0),P.update(f.uBackgroundColor,f.uBackgroundColor.ref.value)),P.updateIfChanged(f.uBackgroundOpacity,y.backgroundOpacity)}function m(f,y){let g=yhe(f.aMapping.ref.value,f.aDepth.ref.value,y.charCount,Ax(f)),x=ye.expand(ye(),y.boundingSphere,g),S=Si(x,f.aTransform.ref.value,f.instanceCount.ref.value,0);ye.equals(S,f.boundingSphere.ref.value)||P.update(f.boundingSphere,S),ye.equals(x,f.invariantBoundingSphere.ref.value)||(P.update(f.invariantBoundingSphere,x),P.update(f.uInvariantBoundingSphere,Ut.fromSphere(f.uInvariantBoundingSphere.ref.value,x))),P.update(f.padding,g)}function d(f){let y=We.createRenderableState(f);return p(y,f),y}function p(f,y){We.updateRenderableState(f,y),f.pickable=!1,f.opaque=!1,f.writeDepth=!0}})(Ui||={});function yhe(e,t,r,n){let o=0,i=0;for(let a=0,s=r*4;a<s;++a){let l=2*a,u=Math.abs(e[l]);u>o&&(o=u);let c=Math.abs(e[l+1]);c>o&&(o=c);let m=Math.abs(t[a]);m>i&&(i=m)}return Math.max(i,n+n*o)}var _c=b(),pf=b(),m_=b(),bhe=Qe.add,GB=Qe.add3,Ua;(t=>{function e(r=2048,n=1024,o){let i=Qe.create(Float32Array,1,n,o?o.groupBuffer.ref.value:r),a=Qe.create(Float32Array,3,n,o?o.startBuffer.ref.value:r),s=Qe.create(Float32Array,3,n,o?o.endBuffer.ref.value:r),l=(m,d,p,h,f,y,g)=>{for(let x=0;x<4;++x)GB(a,m,d,p),GB(s,h,f,y),bhe(i,g)},u=(m,d,p)=>{for(let h=0;h<4;++h)GB(a,m[0],m[1],m[2]),GB(s,d[0],d[1],d[2]),bhe(i,p)},c=(m,d,p,h)=>{let f=b.distance(m,d),y=p%2!==0,g=Math.floor((p+1)/2),x=f/(p+.5);b.setMagnitude(m_,b.sub(m_,d,m),x),b.copy(_c,m);for(let S=0;S<g;++S)b.add(_c,_c,m_),y&&S===g-1?b.copy(pf,d):b.add(pf,_c,m_),l(_c[0],_c[1],_c[2],pf[0],pf[1],pf[2],h),b.add(_c,_c,m_)};return{add:l,addVec:u,addFixedCountDashes:c,addFixedLengthDashes:(m,d,p,h)=>{let f=b.distance(m,d);c(m,d,f/p,h)},addCage:(m,d,p)=>{let{vertices:h,edges:f}=d;for(let y=0,g=f.length;y<g;y+=2)b.fromArray(_c,h,f[y]*3),b.fromArray(pf,h,f[y+1]*3),b.transformMat4(_c,_c,m),b.transformMat4(pf,pf,m),l(_c[0],_c[1],_c[2],pf[0],pf[1],pf[2],p)},getLines:()=>{let m=i.elementCount/4,d=Qe.compact(i,!0),p=Qe.compact(a,!0),h=Qe.compact(s,!0),f=o&&m<=o.lineCount?o.mappingBuffer.ref.value:new Float32Array(m*8),y=o&&m<=o.lineCount?o.indexBuffer.ref.value:new Uint32Array(m*6);return(!o||m>o.lineCount)&&bWe(m,f,y),ln.create(f,y,d,p,h,m,o)}}}t.create=e})(Ua||={});function bWe(e,t,r){for(let n=0;n<e;++n){let o=n*8;t[o]=-1,t[o+1]=-1,t[o+2]=1,t[o+3]=-1,t[o+4]=-1,t[o+5]=1,t[o+6]=1,t[o+7]=1}for(let n=0;n<e;++n){let o=n*4,i=n*6;r[i]=o,r[i+1]=o+1,r[i+2]=o+2,r[i+3]=o+1,r[i+4]=o+3,r[i+5]=o+2}}var ln;(h=>{function e(f,y,g,x,S,I,v){return v?i(f,y,g,x,S,I,v):o(f,y,g,x,S,I)}h.create=e;function t(f){let y=f?f.mappingBuffer.ref.value:new Float32Array(0),g=f?f.indexBuffer.ref.value:new Uint32Array(0),x=f?f.groupBuffer.ref.value:new Float32Array(0),S=f?f.startBuffer.ref.value:new Float32Array(0),I=f?f.endBuffer.ref.value:new Float32Array(0);return e(y,g,x,S,I,0,f)}h.createEmpty=t;function r(f,y){let g=f.vertexBuffer.ref.value,x=f.indexBuffer.ref.value,S=f.groupBuffer.ref.value,I=Ua.create(f.triangleCount*3,f.triangleCount/10,y);for(let v=0,A=f.triangleCount*3;v<A;v+=3){let _=x[v],T=x[v+1],w=x[v+2],D=g[_*3],M=g[_*3+1],E=g[_*3+2],R=g[T*3],k=g[T*3+1],B=g[T*3+2],L=g[w*3],V=g[w*3+1],U=g[w*3+2];I.add(D,M,E,R,k,B,S[_]),I.add(D,M,E,L,V,U,S[_]),I.add(R,k,B,L,V,U,S[T])}return I.getLines()}h.fromMesh=r;function n(f){return Ro([f.lineCount,f.mappingBuffer.ref.version,f.indexBuffer.ref.version,f.groupBuffer.ref.version,f.startBuffer.ref.version,f.endBuffer.ref.version])}function o(f,y,g,x,S,I){let v=ye(),A,_=-1,T=-1,w={kind:"lines",lineCount:I,mappingBuffer:P.create(f),indexBuffer:P.create(y),groupBuffer:P.create(g),startBuffer:P.create(x),endBuffer:P.create(S),get boundingSphere(){let D=n(w);if(D!==_){let M=um(w.startBuffer.ref.value,w.lineCount*4,4),E=um(w.endBuffer.ref.value,w.lineCount*4,4);ye.expandBySphere(v,M,E),_=D}return v},get groupMapping(){return w.groupBuffer.ref.version!==T&&(A=Zd(w.groupBuffer.ref.value,w.lineCount,4),T=w.groupBuffer.ref.version),A},setBoundingSphere(D){ye.copy(v,D),_=n(w)}};return w}function i(f,y,g,x,S,I,v){return I>v.lineCount&&(P.update(v.mappingBuffer,f),P.update(v.indexBuffer,y)),v.lineCount=I,P.update(v.groupBuffer,g),P.update(v.startBuffer,x),P.update(v.endBuffer,S),v}function a(f,y){let g=f.startBuffer.ref.value;Pc(y,g,0,f.lineCount*4),P.update(f.startBuffer,g);let x=f.endBuffer.ref.value;Pc(y,x,0,f.lineCount*4),P.update(f.endBuffer,x)}h.transform=a,h.Params={...We.Params,sizeFactor:C.Numeric(2,{min:0,max:10,step:.1}),lineSizeAttenuation:C.Boolean(!1)},h.Utils={Params:h.Params,createEmpty:t,createValues:c,createValuesSimple:m,updateValues:d,updateBoundingSphere:p,createRenderableState:We.createRenderableState,updateRenderableState:We.updateRenderableState,createPositionIterator:u};function u(f,y){let g=f.lineCount*4,x=y.instanceCount.ref.value,S=As(),I=S.position,v=f.startBuffer.ref.value,A=f.endBuffer.ref.value,_=y.aTransform.ref.value;return Kr(g,x,2,(w,D)=>{let M=w%4===0?v:A;return D<0?b.fromArray(I,M,w*3):b.transformMat4Offset(I,M,_,0,w*3,D*16),S})}function c(f,y,g,x,S){let{instanceCount:I,groupCount:v}=g,A=u(f,y),_=Ki(g,A,x.color),T=Ml(g,x.size),w=S.instanceGranularity?oo(I,"instance"):oo(I*v,"groupInstance"),D=_l(),M=Rl(),E=El(),R=wl(),k=Dl(),B={drawCount:f.lineCount*2*3,vertexCount:f.lineCount*4,groupCount:v,instanceCount:I},L=ye.clone(f.boundingSphere),V=Si(L,y.aTransform.ref.value,I,0);return{dGeometryType:P.create("lines"),aMapping:f.mappingBuffer,aGroup:f.groupBuffer,aStart:f.startBuffer,aEnd:f.endBuffer,elements:f.indexBuffer,boundingSphere:P.create(V),invariantBoundingSphere:P.create(L),uInvariantBoundingSphere:P.create(Ut.ofSphere(L)),..._,...T,...w,...D,...M,...E,...R,...k,...y,...We.createValues(S,B),uSizeFactor:P.create(S.sizeFactor),dLineSizeAttenuation:P.create(S.lineSizeAttenuation),uDoubleSided:P.create(!0),dFlipSided:P.create(!1)}}function m(f,y,g,x,S){let I=We.createSimple(g,x,S),v={...C.getDefaultValues(h.Params),...y};return c(f,I.transform,I.locationIterator,I.theme,v)}function d(f,y){We.updateValues(f,y),P.updateIfChanged(f.uSizeFactor,y.sizeFactor),P.updateIfChanged(f.dLineSizeAttenuation,y.lineSizeAttenuation)}function p(f,y){let g=ye.clone(y.boundingSphere),x=Si(g,f.aTransform.ref.value,f.instanceCount.ref.value,0);ye.equals(x,f.boundingSphere.ref.value)||P.update(f.boundingSphere,x),ye.equals(g,f.invariantBoundingSphere.ref.value)||(P.update(f.invariantBoundingSphere,g),P.update(f.uInvariantBoundingSphere,Ut.fromSphere(f.uInvariantBoundingSphere.ref.value,g)))}})(ln||={});var xhe=b(),Che=b(),She=b();function K0(e,t){let r=t.length,n=ff(r/3);for(let o=0;o<r;o+=3)b.fromArray(xhe,e,t[o]*3),b.fromArray(Che,e,t[o+1]*3),b.fromArray(She,e,t[o+2]*3),n.add(xhe,Che,She);return n.getPrimitive()}var UB=b();function ff(e,t){t===void 0&&(t=e*3);let r=new Float32Array(t*3),n=new Float32Array(t*3),o=new Uint32Array(e*3),i=0,a=0;return{add:(s,l,u)=>{b.toArray(s,r,i),b.toArray(l,r,i+3),b.toArray(u,r,i+6),b.triangleNormal(UB,s,l,u);for(let c=0;c<3;++c)b.toArray(UB,n,i+3*c),o[a+c]=i/3+c;i+=9,a+=3},addQuad:(s,l,u,c)=>{b.toArray(s,r,i),b.toArray(l,r,i+3),b.toArray(u,r,i+6),b.toArray(c,r,i+9),b.triangleNormal(UB,s,l,u);for(let d=0;d<4;++d)b.toArray(UB,n,i+3*d);let m=i/3;o[a]=m,o[a+1]=m+1,o[a+2]=m+2,o[a+3]=m+2,o[a+4]=m+3,o[a+5]=m,i+=12,a+=6},getPrimitive:()=>({vertices:r,normals:n,indices:o})}}var cI=b(),xWe=Ot();function mI(e,t){let{vertices:r,normals:n}=e,o=Ot.directionTransform(xWe,t);for(let i=0,a=r.length;i<a;i+=3)b.transformMat4(cI,b.fromArray(cI,r,i),t),b.toArray(cI,r,i),b.transformMat3(cI,b.fromArray(cI,n,i),o),b.toArray(cI,n,i);return e}function Rc(e,t,r=-1){let n=new Float32Array(e*3),o=r===-1?e<=4?Math.sqrt(2)/2:.6:r,i=t?1:0;for(let a=0,s=e;a<s;++a){let l=(a*2+i)/e*Math.PI;n[a*3]=Math.cos(l)*o,n[a*3+1]=Math.sin(l)*o,n[a*3+2]=0}return n}function Eh(e,t){return{vertices:e,edges:t}}function j6(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var H6=b.zero();function W6(e,t){let{vertices:r}=e;for(let n=0,o=r.length;n<o;n+=3)b.transformMat4(H6,b.fromArray(H6,r,n),t),b.toArray(H6,r,n);return e}var py=b(),fy=b(),hy=b(),dI=b(),ga=Rc(4,!0);function vhe(e){let n=ff(12,e?36:24);for(let o=0;o<4;++o){let i=(o+1)%4;b.set(py,ga[o*3],ga[o*3+1],-.5),b.set(fy,ga[i*3],ga[i*3+1],-.5),b.set(hy,ga[i*3],ga[i*3+1],.5),b.set(dI,ga[o*3],ga[o*3+1],.5),e?n.add(py,fy,hy):n.addQuad(py,fy,hy,dI)}return b.set(py,ga[0],ga[1],-.5),b.set(fy,ga[3],ga[4],-.5),b.set(hy,ga[6],ga[7],-.5),b.set(dI,ga[9],ga[10],-.5),e?n.add(hy,fy,py):n.addQuad(dI,hy,fy,py),b.set(py,ga[0],ga[1],.5),b.set(fy,ga[3],ga[4],.5),b.set(hy,ga[6],ga[7],.5),b.set(dI,ga[9],ga[10],.5),e?n.add(py,fy,hy):n.addQuad(py,fy,hy,dI),n.getPrimitive()}var X6;function Tx(){return X6||(X6=vhe(!1)),X6}var Q6;function Ihe(){return Q6||(Q6=vhe(!0)),Q6}var Z6;function J0(){return Z6||(Z6=Eh([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),Z6}function q6(e){return e.map(t=>({x:t[0],alpha:t[1]}))}function Y6(e,t){let r=[{x:0,alpha:0},{x:0,alpha:0},...e,{x:1,alpha:0},{x:1,alpha:0}],n=256,o=t?t.ref.value.array:new Uint8Array(n),i=0,a,s,l,u,c,m,d=e.length+1;for(let h=0;h<d;++h){a=r[h+1].x,s=r[h+2].x,l=r[h].alpha,u=r[h+1].alpha,c=r[h+2].alpha,m=r[h+3].alpha;let f=Math.round((s-a)*n);for(let y=0;y<f;++y){let g=y/f;o[i]=Math.max(0,G1(l,u,c,m,g,.5)*255),++i}}let p={array:o,width:256,height:1};return t?(P.update(t,p),t):P.create(p)}function The(e,t,r){if(r)return Ahe(e,t,r.min,r.max);{let[n,o]=Su(e);return Ahe(e,t,n,o)}}function Ahe(e,t,r,n){let o=(n-r)/t;o===0&&(o=1);let i=new Int32Array(t);for(let a=0,s=e.length;a<s;a++){let l=Math.floor((e[a]-r)/o);l>=t?l=t-1:l<0&&(l=0),i[l]++}return{min:r,max:n,binWidth:o,counts:i}}var Xn;(u=>{u.One={transform:{kind:"matrix",matrix:Z.identity()},cells:xr.create(xr.Space([1,1,1],[0,1,2]),xr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};let t=Z.zero(),r=Z.zero();function n(c){if(c.transform.kind==="matrix")return Z.copy(Z(),c.transform.matrix);if(c.transform.kind==="spacegroup"){let{cells:{space:m}}=c,d=Z.fromScaling(t,b.div(b.zero(),ut.size(b.zero(),c.transform.fractionalBox),b.ofArray(m.dimensions))),p=Z.fromTranslation(r,c.transform.fractionalBox.min);return Z.mul3(Z.zero(),c.transform.cell.fromFractional,p,d)}return Z.identity()}u.getGridToCartesianTransform=n;function o(c,m){return c===m}u.areEquivalent=o;function i(c){return c.cells.data.length===0}u.isEmpty=i;function a(c,m){m||(m=ye());let d=c.cells.space.dimensions,p=u.getGridToCartesianTransform(c);return ye.fromDimensionsAndTransform(m,d,p)}u.getBoundingSphere=a;function s(c,m){let d=c._historams;return d||(d=c._historams={}),d[m]||(d[m]=The(c.cells.data,m,{min:c.stats.min,max:c.stats.max})),d[m]}u.getHistogram=s;function l(c,m){let d=u.getGridToCartesianTransform(c);Z.invert(d,d);let p=b(),{stats:h}=c,{dimensions:f,get:y}=c.cells.space,g=c.cells.data,[x,S,I]=f;return function(A){b.copy(p,A),b.transformMat4(p,p,d);let _=Math.trunc(p[0]),T=Math.trunc(p[1]),w=Math.trunc(p[2]);if(_<0||_>=x||T<0||T>=S||w<0||w>=I)return Number.NaN;let D=p[0]-_,M=p[1]-T,E=p[2]-w,R=Math.min(_+1,x-1),k=Math.min(T+1,S-1),B=Math.min(w+1,I-1),L=y(g,_,T,w),V=y(g,R,T,w),U=y(g,_,k,w),Q=y(g,R,k,w),O=$n($n(L,V,D),$n(U,Q,D),M);L=y(g,_,T,B),V=y(g,R,T,B),U=y(g,_,k,B),Q=y(g,R,k,B);let q=$n($n(L,V,D),$n(U,Q,D),M),X=$n(O,q,E);return m==="relative"?(X-h.mean)/h.sigma:X}}u.makeGetTrilinearlyInterpolated=l})(Xn||={});function Phe(e,t){return Pe.create("Create Volume",async()=>{let{header:r,values:n}=e,o=xr.Space(r.dim,[0,1,2],Float64Array),i;if(r.dataSetIds.length===0)i=n;else{let[u,c,m]=r.dim,d=(t?.dataIndex||0)+1,p=0,h=0;i=new Float64Array(u*c*m);for(let f=0;f<u;f++)for(let y=0;y<c;y++)for(let g=0;g<m;g++)i[p++]=n[h],h+=d}let a=xr.create(o,xr.Data1(i)),s=Z.fromTranslation(Z(),r.origin),l=Z.fromBasis(Z(),r.basisX,r.basisY,r.basisZ);return Z.mul(s,s,l),{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:a,stats:{min:tb(i),max:ol(i),mean:rb(i),sigma:nb(i)}},instances:[{transform:Z.identity()}],sourceData:NB.create(e),customProperties:new ka,_propertyData:Object.create(null)}})}var NB;(r=>{function e(n){return n?.kind==="cube"}r.is=e;function t(n){return{kind:"cube",name:n.name,data:n}}r.create=t})(NB||={});function zB(e,t){return Pe.create("Create Volume",async r=>{let{volume_data_3d_info:n,volume_data_3d:o}=e,i=Yi.create(n.spacegroup_number.value(0),b.ofArray(n.spacegroup_cell_size.value(0)),b.scale(b.zero(),b.ofArray(n.spacegroup_cell_angles.value(0)),Math.PI/180)),a=n.axis_order.value(0),s=xr.convertToCanonicalAxisIndicesFastToSlow(a),l=s(n.sample_count.value(0)),u=xr.Space(l,xr.invertAxisOrder(a),Float32Array),c=xr.create(u,xr.Data1(o.values.toArray({array:Float32Array}))),m=b.ofArray(s(n.origin.value(0))),d=b.ofArray(s(n.dimensions.value(0)));return{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:i,fractionalBox:ut.create(m,b.add(b.zero(),m,d))},cells:c,stats:{min:n.min_sampled.value(0),max:n.max_sampled.value(0),mean:n.mean_sampled.value(0),sigma:n.sigma_sampled.value(0)}},instances:[{transform:Z.identity()}],sourceData:HB.create(e),customProperties:new ka,_propertyData:Object.create(null)}})}var HB;(r=>{function e(n){return n?.kind==="dscif"}r.is=e;function t(n){return{kind:"dscif",name:n._name,data:n}}r.create=t})(HB||={});var Ve;(v=>{function e(A){return A?.grid?.cells?.space?.dimensions?.length&&A?.sourceData&&A?.customProperties&&A?._propertyData}v.is=e;let t;(k=>{function A(B,L,V){return eo(M(B,V).absoluteValue,M(L,V).absoluteValue,V.sigma/100)}k.areSame=A;function _(B){return{kind:"absolute",absoluteValue:B}}k.absolute=_;function T(B){return{kind:"relative",relativeValue:B}}k.relative=T;function w(B,L){return L*B.sigma+B.mean}k.calcAbsolute=w;function D(B,L){return B.sigma===0?0:(L-B.mean)/B.sigma}k.calcRelative=D;function M(B,L){return B.kind==="absolute"?B:{kind:"absolute",absoluteValue:k.calcAbsolute(L,B.relativeValue)}}k.toAbsolute=M;function E(B,L){return B.kind==="relative"?B:{kind:"relative",relativeValue:k.calcRelative(L,B.absoluteValue)}}k.toRelative=E;function R(B){return B.kind==="relative"?`${B.relativeValue.toFixed(2)} \u03C3`:`${B.absoluteValue.toPrecision(4)}`}k.toString=R})(t=v.IsoValue||={});function r(A,_,T){if(T==="relative")return t.relative(_);let w=t.absolute(_);if(HB.is(A.sourceData)){let D={min:A.sourceData.data.volume_data_3d_info.min_source.value(0),max:A.sourceData.data.volume_data_3d_info.max_source.value(0),mean:A.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:A.sourceData.data.volume_data_3d_info.sigma_source.value(0)};return v.IsoValue.toRelative(w,D)}return w}v.adjustedIsoValue=r;let n={min:-1,max:1,mean:0,sigma:.1};function o(A,_){let T=_||n,{min:w,max:D,mean:M,sigma:E}=T,R=(w-M)/E,k=(D-M)/E,B=A;return A.kind==="absolute"?A.absoluteValue<w?B=v.IsoValue.absolute(w):A.absoluteValue>D&&(B=v.IsoValue.absolute(D)):A.relativeValue<R?B=v.IsoValue.relative(R):A.relativeValue>k&&(B=v.IsoValue.relative(k)),C.Conditioned(B,{absolute:C.Converted(L=>v.IsoValue.toAbsolute(L,Xn.One.stats).absoluteValue,L=>v.IsoValue.absolute(L),C.Numeric(M,{min:w,max:D,step:N2(E/100,2)},{immediateUpdate:!0})),relative:C.Converted(L=>v.IsoValue.toRelative(L,Xn.One.stats).relativeValue,L=>v.IsoValue.relative(L),C.Numeric(Math.min(1,k),{min:R,max:k,step:N2(Math.round((D-w)/E)/100,2)},{immediateUpdate:!0}))},L=>L.kind==="absolute"?"absolute":"relative",(L,V)=>V==="absolute"?v.IsoValue.toAbsolute(L,T):v.IsoValue.toRelative(L,T),{isEssential:!0})}v.createIsoValueParam=o,v.IsoValueParam=o(v.IsoValue.relative(2)),v.One={label:"",grid:Xn.One,instances:[],sourceData:{kind:"",name:"",data:{}},customProperties:new ka,_propertyData:Object.create(null)};function s(A,_){return Xn.areEquivalent(A.grid,_.grid)&&l(A,_)}v.areEquivalent=s;function l(A,_){if(A.instances.length!==_.instances.length)return!1;for(let T=0,w=A.instances.length;T<w;++T)if(!Z.areEqual(A.instances[T].transform,_.instances[T].transform,1e-6))return!1;return!0}v.areInstanceTransformsEqual=l;function u(A){return Xn.isEmpty(A.grid)||A.instances.length===0}v.isEmpty=u;function c(A){return NB.is(A.sourceData)?A.sourceData.data.header.orbitals:!1}v.isOrbitals=c;function m(A,_){return{kind:"volume-loci",volume:A,instances:_}}v.Loci=m;function d(A){return!!A&&A.kind==="volume-loci"}v.isLoci=d;function p(A,_){return A.volume===_.volume&&Se.areEqual(A.instances,_.instances)}v.areLociEqual=p;function h(A){return u(A.volume)||Se.isEmpty(A.instances)}v.isLociEmpty=h;function f(A,_){return Xn.getBoundingSphere(A.grid,_)}v.getBoundingSphere=f;let y;(E=>{function A(R,k,B){return{kind:"isosurface-loci",volume:R,isoValue:k,instances:B}}E.Loci=A;function _(R){return!!R&&R.kind==="isosurface-loci"}E.isLoci=_;function T(R,k){return R.volume===k.volume&&v.IsoValue.areSame(R.isoValue,k.isoValue,R.volume.grid.stats)&&Se.areEqual(R.instances,k.instances)}E.areLociEqual=T;function w(R){return u(R.volume)||Se.isEmpty(R.instances)}E.isLociEmpty=w;let D=ut();function M(R,k,B){let L=v.IsoValue.toAbsolute(k,R.grid.stats).absoluteValue,V=L<0,U=[0,0,0],Q=R.grid.cells.space.getCoords,O=R.grid.cells.data,[q,X,F]=R.grid.cells.space.dimensions,Y=q-1,$=X-1,ce=F-1,ie=0,oe=0,W=0;for(let j=0,ue=O.length;j<ue;++j)(V&&O[j]<=L||!V&&O[j]>=L)&&(Q(j,U),U[0]<Y&&(Y=U[0]),U[1]<$&&($=U[1]),U[2]<ce&&(ce=U[2]),U[0]>ie&&(ie=U[0]),U[1]>oe&&(oe=U[1]),U[2]>W&&(W=U[2]));b.set(D.min,Y-1,$-1,ce-1),b.set(D.max,ie+1,oe+1,W+1);let N=Xn.getGridToCartesianTransform(R.grid);return ut.transform(D,D,N),ye.fromBox3D(B||ye(),D)}E.getBoundingSphere=M})(y=v.Isosurface||={});let g;(V=>{function A(U,Q){return{kind:"cell-loci",volume:U,elements:Q}}V.Loci=A;function _(U){return!!U&&U.kind==="cell-loci"}V.isLoci=_;function T(U,Q){if(U.volume!==Q.volume||U.elements.length!==Q.elements.length)return!1;for(let O=0,q=U.elements.length;O<q;++O){let X=U.elements[O],F=Q.elements[O];if(!Se.areEqual(X.instances,F.instances)||!Se.areEqual(X.indices,F.indices))return!1}return!0}V.areLociEqual=T;function w(U){for(let{indices:Q,instances:O}of U.elements)if(!Se.isEmpty(O)||!Se.isEmpty(Q))return!1;return!0}V.isLociEmpty=w;function D(U){let Q=0;for(let{indices:O,instances:q}of U.elements)Q+=Se.size(O)*Se.size(q);return Q}V.getLociSize=D;function M(U,Q,O){return{kind:"cell-location",volume:U,cell:Q,instance:O}}V.Location=M;function E(U){return!!U&&U.kind==="cell-location"}V.isLocation=E;let R=new Ci("98"),k=b(),B=b();function L(U,Q,O){R.reset();let q=Xn.getGridToCartesianTransform(U.grid),{getCoords:X}=U.grid.cells.space;for(let{indices:Y,instances:$}of Q)for(let ce=0,ie=Se.size(Y);ce<ie;ce++){let oe=Se.getAt(Y,ce);X(oe,k),b.transformMat4(k,k,q);for(let W=0,N=Se.size($);W<N;W++){let j=U.instances[Se.getAt($,W)];b.transformMat4(B,k,j.transform),R.includePosition(B)}}R.finishedIncludeStep();for(let{indices:Y,instances:$}of Q)for(let ce=0,ie=Se.size(Y);ce<ie;ce++){let oe=Se.getAt(Y,ce);X(oe,k),b.transformMat4(k,k,q);for(let W=0,N=Se.size($);W<N;W++){let j=U.instances[Se.getAt($,W)];b.transformMat4(B,k,j.transform),R.radiusPosition(B)}}let F=R.getSphere(O);return ye.expand(F,F,Z.getMaxScaleOnAxis(q)*10)}V.getBoundingSphere=L})(g=v.Cell||={});let x;(V=>{function A(U,Q){return{kind:"segment-loci",volume:U,elements:Q}}V.Loci=A;function _(U){return!!U&&U.kind==="segment-loci"}V.isLoci=_;function T(U,Q){if(U.volume!==Q.volume||U.elements.length!==Q.elements.length)return!1;for(let O=0,q=U.elements.length;O<q;++O){let X=U.elements[O],F=Q.elements[O];if(!Se.areEqual(X.instances,F.instances)||!Se.areEqual(X.segments,F.segments))return!1}return!0}V.areLociEqual=T;function w(U){for(let{segments:Q,instances:O}of U.elements)if(!Se.isEmpty(O)||!Se.isEmpty(Q))return!1;return!0}V.isLociEmpty=w;function D(U){let Q=0;for(let{segments:O,instances:q}of U.elements)Q+=Se.size(O)*Se.size(q);return Q}V.getLociSize=D;let M=ut(),E=ut(),R=ut();function k(U,Q,O){let q=v.Segmentation.get(U);if(q){ut.setEmpty(M);let X=Xn.getGridToCartesianTransform(U.grid);for(let{segments:F,instances:Y}of Q){ut.setEmpty(E);for(let $=0,ce=Se.size(F);$<ce;$++){let ie=Se.getAt(F,$),oe=q.bounds[ie];ut.add(E,oe.min),ut.add(E,oe.max)}ut.transform(E,E,X);for(let $=0,ce=Se.size(Y);$<ce;$++){let ie=U.instances[Se.getAt(Y,$)];ut.transform(R,E,ie.transform),ut.addBox3D(M,R)}}return ye.fromBox3D(O||ye(),M)}else return v.getBoundingSphere(U,O)}V.getBoundingSphere=k;function B(U,Q,O){return{kind:"segment-location",volume:U,segment:Q,instance:O}}V.Location=B;function L(U){return!!U&&U.kind==="segment-location"}V.isLocation=L})(x=v.Segment||={}),v.PickingGranularity={set(A,_){A._propertyData.__picking_granularity__=_},get(A){return A._propertyData.__picking_granularity__??"voxel"}},v.Segmentation={set(A,_){A._propertyData.__segmentation__=_},get(A){return A._propertyData.__segmentation__}}})(Ve||={});var K6=Tx(),Bl;(g=>{function e(x,S,I,v,A,_,T,w,D,M,E){return E?n(x,S,I,v,A,_,T,w,D,M,E):r(x,S,I,v,A,_,T,w,D,M)}g.create=e;function t(x){return Ro([x.bboxSize.ref.version,x.gridDimension.ref.version,x.gridTexture.ref.version,x.transform.ref.version,x.gridStats.ref.version])}function r(x,S,I,v,A,_,T,w,D,M){let E=ye(),R=-1,k=_.getWidth(),B=_.getHeight(),L=_.getDepth(),V={kind:"direct-volume",gridDimension:P.create(S),gridTexture:P.create(_),gridTextureDim:P.create(b.create(k,B,L)),gridStats:P.create(Ut.create(T.min,T.max,T.mean,T.sigma)),bboxMin:P.create(x.min),bboxMax:P.create(x.max),bboxSize:P.create(b.sub(b(),x.max,x.min)),transform:P.create(I),cellDim:P.create(A),unitToCartn:P.create(v),cartnToUnit:P.create(Z.invert(Z(),v)),get boundingSphere(){let U=t(V);if(U!==R){let Q=CWe(V.gridDimension.ref.value,V.transform.ref.value);ye.copy(E,Q),R=U}return E},packedGroup:P.create(w),axisOrder:P.create(D),dataType:P.create(M),setBoundingSphere(U){ye.copy(E,U),R=t(V)},meta:{}};return V}function n(x,S,I,v,A,_,T,w,D,M,E){let R=_.getWidth(),k=_.getHeight(),B=_.getDepth();return P.update(E.gridDimension,S),P.update(E.gridTexture,_),P.update(E.gridTextureDim,b.set(E.gridTextureDim.ref.value,R,k,B)),P.update(E.gridStats,Ut.set(E.gridStats.ref.value,T.min,T.max,T.mean,T.sigma)),P.update(E.bboxMin,x.min),P.update(E.bboxMax,x.max),P.update(E.bboxSize,b.sub(E.bboxSize.ref.value,x.max,x.min)),P.update(E.transform,I),P.update(E.cellDim,A),P.update(E.unitToCartn,v),P.update(E.cartnToUnit,Z.invert(Z(),v)),P.updateIfChanged(E.packedGroup,w),P.updateIfChanged(E.axisOrder,b.fromArray(E.axisOrder.ref.value,D,0)),P.updateIfChanged(E.dataType,M),E}function o(x){let S=ut(),I=b(),v=Z.identity(),A=Z.identity(),_=b(),T=Mo(),w=Xn.One.stats,D=!1,M=b.create(0,1,2);return e(S,I,v,A,_,T,w,D,M,"byte",x)}g.createEmpty=o,g.Params={...We.Params,ignoreLight:C.Boolean(!1,We.ShadingCategory),celShaded:C.Boolean(!1,We.ShadingCategory),xrayShaded:C.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],We.ShadingCategory),controlPoints:C.LineGraph([Ie.create(.19,0),Ie.create(.2,.05),Ie.create(.25,.05),Ie.create(.26,0),Ie.create(.79,0),Ie.create(.8,.05),Ie.create(.85,.05),Ie.create(.86,0)],{isEssential:!0}),stepsPerCell:C.Numeric(3,{min:1,max:10,step:1}),jumpLength:C.Numeric(0,{min:0,max:20,step:.1})},g.Utils={Params:g.Params,createEmpty:o,createValues:m,createValuesSimple:d,updateValues:p,updateBoundingSphere:h,createRenderableState:f,updateRenderableState:y,createPositionIterator:s};function s(x,S){let I=x.transform.ref.value,[v,A,_]=x.gridDimension.ref.value,T=v*A*_,w=S.instanceCount.ref.value,D=As(),M=D.position,E=S.aTransform.ref.value;return Kr(T,w,1,(k,B)=>{let L=Math.floor(k/_);return M[0]=Math.floor(L/A),M[1]=L%A,M[2]=k%_,b.transformMat4(M,M,I),B>=0&&b.transformMat4Offset(M,M,E,0,0,B*16),D})}function l(x,S){return Math.ceil(b.magnitude(x)*S)}function u(x,S){return Math.min(...x)*(1/S)}function c(x){return 1/x}function m(x,S,I,v,A){let{gridTexture:_,gridTextureDim:T,gridStats:w}=x,{bboxSize:D,bboxMin:M,bboxMax:E,gridDimension:R,transform:k}=x,{instanceCount:B,groupCount:L}=I,V=s(x,S),U=Ki(I,V,v.color),Q=A.instanceGranularity?oo(B,"instance"):oo(B*L,"groupInstance"),O=_l(),q=Rl(),X=El(),F=wl(),Y=Dl(),[$,ce,ie]=R.ref.value,oe={drawCount:K6.indices.length,vertexCount:$*ce*ie,groupCount:L,instanceCount:B},W=ye.clone(x.boundingSphere),N=Si(W,S.aTransform.ref.value,B,0),j=q6(A.controlPoints),ue=Y6(j);return{dGeometryType:P.create("directVolume"),...U,...Q,...O,...q,...X,...F,...Y,...S,...We.createValues(A,oe),aPosition:P.create(K6.vertices),elements:P.create(K6.indices),boundingSphere:P.create(N),invariantBoundingSphere:P.create(W),uInvariantBoundingSphere:P.create(Ut.ofSphere(W)),uBboxMin:M,uBboxMax:E,uBboxSize:D,uMaxSteps:P.create(l(R.ref.value,A.stepsPerCell)),uStepScale:P.create(u(x.cellDim.ref.value,A.stepsPerCell)),uJumpLength:P.create(A.jumpLength),uTransform:k,uGridDim:R,tTransferTex:ue,uTransferScale:P.create(c(A.stepsPerCell)),dGridTexType:P.create(_.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:T,tGridTex:_,uGridStats:w,uCellDim:x.cellDim,uCartnToUnit:x.cartnToUnit,uUnitToCartn:x.unitToCartn,dPackedGroup:x.packedGroup,dAxisOrder:P.create(x.axisOrder.ref.value.join("")),dIgnoreLight:P.create(A.ignoreLight),dCelShaded:P.create(A.celShaded),dXrayShaded:P.create(A.xrayShaded==="inverted"?"inverted":A.xrayShaded===!0?"on":"off"),meta:P.create(x.meta)}}function d(x,S,I,v,A){let _=We.createSimple(I,v,A),T={...C.getDefaultValues(g.Params),...S};return m(x,_.transform,_.locationIterator,_.theme,T)}function p(x,S){We.updateValues(x,S),P.updateIfChanged(x.dIgnoreLight,S.ignoreLight),P.updateIfChanged(x.dCelShaded,S.celShaded),P.updateIfChanged(x.dXrayShaded,S.xrayShaded==="inverted"?"inverted":S.xrayShaded===!0?"on":"off");let I=q6(S.controlPoints);Y6(I,x.tTransferTex),P.updateIfChanged(x.uMaxSteps,l(x.uGridDim.ref.value,S.stepsPerCell)),P.updateIfChanged(x.uStepScale,u(x.uCellDim.ref.value,S.stepsPerCell)),P.updateIfChanged(x.uTransferScale,c(S.stepsPerCell)),P.updateIfChanged(x.uJumpLength,S.jumpLength)}function h(x,S){let I=ye.clone(S.boundingSphere),v=Si(I,x.aTransform.ref.value,x.instanceCount.ref.value,0);ye.equals(v,x.boundingSphere.ref.value)||P.update(x.boundingSphere,v),ye.equals(I,x.invariantBoundingSphere.ref.value)||(P.update(x.invariantBoundingSphere,I),P.update(x.uInvariantBoundingSphere,Ut.fromSphere(x.uInvariantBoundingSphere.ref.value,I)))}function f(x){let S=We.createRenderableState(x);return S.opaque=!1,S.writeDepth=!1,S}function y(x,S){We.updateRenderableState(x,S),x.opaque=!1,x.writeDepth=!1}})(Bl||={});function CWe(e,t){return ye.fromDimensionsAndTransform(ye(),e,t)}var Ts;(I=>{function e(v,A,_,T){return T?o(v,A,_,T):n(v,A,_)}I.create=e;function t(v){let A=v?v.centerBuffer.ref.value:new Float32Array(0),_=v?v.groupBuffer.ref.value:new Float32Array(0);return e(A,_,0,v)}I.createEmpty=t;function r(v){return Ro([v.sphereCount,v.centerBuffer.ref.version,v.groupBuffer.ref.version])}function n(v,A,_){let T=ye(),w,D=-1,M=-1,E=P.create(so(1,4,Float32Array)),R=P.create(Ie.create(0,0)),k=P.create([]),B=P.create(0),L={kind:"spheres",sphereCount:_,centerBuffer:P.create(v),groupBuffer:P.create(A),get boundingSphere(){let V=r(L);if(V!==D){let U=um(L.centerBuffer.ref.value,L.sphereCount,1);ye.copy(T,U),D=V}return T},get groupMapping(){return L.groupBuffer.ref.version!==M&&(w=Zd(L.groupBuffer.ref.value,L.sphereCount),M=L.groupBuffer.ref.version),w},setBoundingSphere(V){ye.copy(T,V),D=r(L)},shaderData:{positionGroup:E,texDim:R,lodLevels:k,sizeFactor:B,update(V){let U=V?.lodLevels??l(k.ref.value),Q=V?.sizeFactor??B.ref.value,O=c(U,Q),q=so(L.sphereCount,4,Float32Array,E.ref.value.array),X=i(q,L.centerBuffer.ref.value,L.groupBuffer.ref.value,L.sphereCount,O),F=X?s(U,Q,X,L.sphereCount):[];P.update(E,q),P.update(R,Ie.set(R.ref.value,q.width,q.height)),P.update(k,F),P.update(B,Q)}}};return L.shaderData.update(),L}function o(v,A,_,T){return T.sphereCount=_,P.update(T.centerBuffer,v),P.update(T.groupBuffer,A),T.shaderData.update(),T}function i(v,A,_,T,w){let{array:D}=v;if(w.length===0){for(let R=0;R<T;++R)D[R*4+0]=A[R*3+0],D[R*4+1]=A[R*3+1],D[R*4+2]=A[R*3+2],D[R*4+3]=_[R];return}let M=[0],E=0;for(let R=0,k=w.length;R<k;++R){let B=w[R];for(let L=0;L<T;++L){let V=!1;for(let U=0;U<R;++U)if(L%w[U]===0){V=!0;break}!V&&L%B===0&&(D[E*4+0]=A[L*3+0],D[E*4+1]=A[L*3+1],D[E*4+2]=A[L*3+2],D[E*4+3]=_[L],E+=1)}M.push(E*6)}return M}function a(v,A){if(v.length!==A.length)return!1;for(let _=0,T=v.length;_<T;++_)if(v[_].maxDistance!==A[_].maxDistance||v[_].minDistance!==A[_].minDistance||v[_].overlap!==A[_].overlap||v[_].stride!==A[_].stride||v[_].scaleBias!==A[_].scaleBias)return!1;return!0}function s(v,A,_,T){return v.map((w,D)=>{let M=u(w,A);return[w.minDistance,w.maxDistance,w.overlap,_[_.length-1-D],Math.pow(Math.min(T,M),1/w.scaleBias),w.stride,w.scaleBias]})}function l(v){return v.map(A=>({minDistance:A[0],maxDistance:A[1],overlap:A[2],stride:A[5],scaleBias:A[6]}))}function u(v,A){return Math.max(1,Math.round(v.stride/Math.pow(A,v.scaleBias)))}function c(v,A){return v.map(_=>u(_,A)).reverse()}I.Params={...We.Params,sizeFactor:C.Numeric(1,{min:0,max:10,step:.1}),doubleSided:C.Boolean(!1,We.CustomQualityParamInfo),ignoreLight:C.Boolean(!1,We.ShadingCategory),celShaded:C.Boolean(!1,We.ShadingCategory),xrayShaded:C.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],We.ShadingCategory),transparentBackfaces:C.Select("off",C.arrayToOptions(["off","on","opaque"]),We.ShadingCategory),solidInterior:C.Boolean(!0,We.ShadingCategory),clipPrimitive:C.Boolean(!1,{...We.ShadingCategory,description:"Clip whole sphere instead of cutting it."}),approximate:C.Boolean(!1,{...We.ShadingCategory,description:"Faster rendering, but has artifacts."}),alphaThickness:C.Numeric(0,{min:0,max:20,step:1},{...We.ShadingCategory,description:"If not zero, adjusts alpha for radius."}),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},We.ShadingCategory),bumpAmplitude:C.Numeric(1,{min:0,max:5,step:.1},We.ShadingCategory),lodLevels:C.ObjectList({minDistance:C.Numeric(0),maxDistance:C.Numeric(0),overlap:C.Numeric(0),stride:C.Numeric(0),scaleBias:C.Numeric(3,{min:.1,max:10,step:.1})},v=>`${v.stride}`,{...We.CullingLodCategory,defaultValue:[]})},I.Utils={Params:I.Params,createEmpty:t,createValues:h,createValuesSimple:f,updateValues:y,updateBoundingSphere:g,createRenderableState:x,updateRenderableState:S,createPositionIterator:p};function p(v,A){let _=v.sphereCount,T=A.instanceCount.ref.value,w=As(),D=w.position,M=v.centerBuffer.ref.value,E=A.aTransform.ref.value;return Kr(_,T,1,(k,B)=>(B<0?b.fromArray(D,M,k*3):b.transformMat4Offset(D,M,E,0,k*3,B*16),w))}function h(v,A,_,T,w){let{instanceCount:D,groupCount:M}=_,E=p(v,A),R=Ki(_,E,T.color),k=Ml(_,T.size),B=w.instanceGranularity?oo(D,"instance"):oo(D*M,"groupInstance"),L=_l(),V=Rl(),U=El(),Q=wl(),O=Dl(),q={drawCount:v.sphereCount*2*3,vertexCount:v.sphereCount*6,groupCount:M,instanceCount:D},X=v.boundingSphere.radius?Ax(k)*w.sizeFactor:0,F=ye.expand(ye(),v.boundingSphere,X),Y=Si(F,A.aTransform.ref.value,D,0);return v.shaderData.update({lodLevels:w.lodLevels,sizeFactor:w.sizeFactor}),{dGeometryType:P.create("spheres"),uTexDim:v.shaderData.texDim,tPositionGroup:v.shaderData.positionGroup,boundingSphere:P.create(Y),invariantBoundingSphere:P.create(F),uInvariantBoundingSphere:P.create(Ut.ofSphere(F)),...R,...k,...B,...L,...V,...U,...Q,...O,...A,padding:P.create(X),...We.createValues(w,q),uSizeFactor:v.shaderData.sizeFactor,uDoubleSided:P.create(w.doubleSided),dIgnoreLight:P.create(w.ignoreLight),dCelShaded:P.create(w.celShaded),dXrayShaded:P.create(w.xrayShaded==="inverted"?"inverted":w.xrayShaded===!0?"on":"off"),dTransparentBackfaces:P.create(w.transparentBackfaces),dSolidInterior:P.create(w.solidInterior),dClipPrimitive:P.create(w.clipPrimitive),dApproximate:P.create(w.approximate),uAlphaThickness:P.create(w.alphaThickness),uBumpFrequency:P.create(w.bumpFrequency),uBumpAmplitude:P.create(w.bumpAmplitude),lodLevels:v.shaderData.lodLevels,centerBuffer:v.centerBuffer,groupBuffer:v.groupBuffer}}function f(v,A,_,T,w){let D=We.createSimple(_,T,w),M={...C.getDefaultValues(I.Params),...A};return h(v,D.transform,D.locationIterator,D.theme,M)}function y(v,A){We.updateValues(v,A),P.updateIfChanged(v.uSizeFactor,A.sizeFactor),P.updateIfChanged(v.uDoubleSided,A.doubleSided),P.updateIfChanged(v.dIgnoreLight,A.ignoreLight),P.updateIfChanged(v.dCelShaded,A.celShaded),P.updateIfChanged(v.dXrayShaded,A.xrayShaded==="inverted"?"inverted":A.xrayShaded===!0?"on":"off"),P.updateIfChanged(v.dTransparentBackfaces,A.transparentBackfaces),P.updateIfChanged(v.dSolidInterior,A.solidInterior),P.updateIfChanged(v.dClipPrimitive,A.clipPrimitive),P.updateIfChanged(v.dApproximate,A.approximate),P.updateIfChanged(v.uAlphaThickness,A.alphaThickness),P.updateIfChanged(v.uBumpFrequency,A.bumpFrequency),P.updateIfChanged(v.uBumpAmplitude,A.bumpAmplitude);let _=l(v.lodLevels.ref.value);if(!a(A.lodLevels,_)){let T=v.uVertexCount.ref.value/6,w=c(A.lodLevels,A.sizeFactor),D=i(v.tPositionGroup.ref.value,v.centerBuffer.ref.value,v.groupBuffer.ref.value,T,w),M=D?s(A.lodLevels,A.sizeFactor,D,T):[];P.update(v.tPositionGroup,v.tPositionGroup.ref.value),P.update(v.lodLevels,M)}}function g(v,A){let _=A.boundingSphere.radius?Ax(v)*v.uSizeFactor.ref.value:0,T=ye.expand(ye(),A.boundingSphere,_),w=Si(T,v.aTransform.ref.value,v.instanceCount.ref.value,0);ye.equals(w,v.boundingSphere.ref.value)||P.update(v.boundingSphere,w),ye.equals(T,v.invariantBoundingSphere.ref.value)||(P.update(v.invariantBoundingSphere,T),P.update(v.uInvariantBoundingSphere,Ut.fromSphere(v.uInvariantBoundingSphere.ref.value,T))),P.update(v.padding,_)}function x(v){let A=We.createRenderableState(v);return S(A,v),A}function S(v,A){We.updateRenderableState(v,A),v.opaque=v.opaque&&!A.xrayShaded,v.writeDepth=v.opaque}})(Ts||={});var is;(p=>{class e{constructor(){this.index=0;this.textures=[]}get(){return this.textures[this.index]}set(f,y,g){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:f,group:y,normal:g}),this.index=(this.index+1)%2}destroy(){for(let f of this.textures)f.vertex.destroy(),f.group.destroy(),f.normal.destroy()}}p.DoubleBuffer=e;function t(h,f,y,g,x,S,I){let v=y.getWidth(),A=y.getHeight();return I?(I.vertexCount=h,I.groupCount=f,P.update(I.geoTextureDim,Ie.set(I.geoTextureDim.ref.value,v,A)),P.update(I.vertexTexture,y),P.update(I.groupTexture,g),P.update(I.normalTexture,x),I.doubleBuffer.set(y,g,x),ye.copy(I.boundingSphere,S),I):{kind:"texture-mesh",vertexCount:h,groupCount:f,geoTextureDim:P.create(Ie.create(v,A)),vertexTexture:P.create(y),groupTexture:P.create(g),normalTexture:P.create(x),varyingGroup:P.create(!1),doubleBuffer:new e,boundingSphere:ye.clone(S),meta:{}}}p.create=t;function r(h){let f=h?h.vertexTexture.ref.value:Mo(),y=h?h.groupTexture.ref.value:Mo(),g=h?h.normalTexture.ref.value:Mo(),x=h?h.boundingSphere:ye();return t(0,0,f,y,g,x,h)}p.createEmpty=r,p.Params={...We.Params,doubleSided:C.Boolean(!1,We.CustomQualityParamInfo),flipSided:C.Boolean(!1,We.ShadingCategory),flatShaded:C.Boolean(!1,We.ShadingCategory),ignoreLight:C.Boolean(!1,We.ShadingCategory),celShaded:C.Boolean(!1,We.ShadingCategory),xrayShaded:C.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],We.ShadingCategory),transparentBackfaces:C.Select("off",C.arrayToOptions(["off","on","opaque"]),We.ShadingCategory),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},We.ShadingCategory),bumpAmplitude:C.Numeric(1,{min:0,max:5,step:.1},We.ShadingCategory)},p.Utils={Params:p.Params,createEmpty:r,createValues:s,createValuesSimple:l,updateValues:u,updateBoundingSphere:c,createRenderableState:m,updateRenderableState:d,createPositionIterator:a};let i="texture-mesh";function a(h,f){let y=h.meta.webgl;if(!y)return Kr(1,1,1,()=>pu);y.namedFramebuffers[i]||(y.namedFramebuffers[i]=y.resources.framebuffer());let g=y.namedFramebuffers[i],[x,S]=h.geoTextureDim.ref.value,I=new Float32Array(x*S*4);g.bind(),h.vertexTexture.ref.value.attachFramebuffer(g,0),y.readPixels(0,0,x,S,I);let v=new Float32Array(x*S*4);g.bind(),h.normalTexture.ref.value.attachFramebuffer(g,0),y.readPixels(0,0,x,S,v);let A=h.vertexCount,_=f.instanceCount.ref.value,T=As(),w=T.position,D=T.normal,M=f.aTransform.ref.value;return Kr(A,_,1,(R,k)=>(k<0?(b.fromArray(w,I,R*4),b.fromArray(D,v,R*4)):(b.transformMat4Offset(w,I,M,0,R*4,k*16),b.transformDirectionOffset(D,v,M,0,R*4,k*16)),T))}function s(h,f,y,g,x){let{instanceCount:S,groupCount:I}=y,v=p.Utils.createPositionIterator(h,f),A=Ki(y,v,g.color),_=x.instanceGranularity?oo(S,"instance"):oo(S*I,"groupInstance"),T=_l(),w=Rl(),D=El(),M=wl(),E=Dl(),R={drawCount:h.vertexCount,vertexCount:h.vertexCount,groupCount:I,instanceCount:S},k=ye.clone(h.boundingSphere),B=Si(k,f.aTransform.ref.value,S,0);return{dGeometryType:P.create("textureMesh"),uGeoTexDim:h.geoTextureDim,tPosition:h.vertexTexture,tGroup:h.groupTexture,tNormal:h.normalTexture,dVaryingGroup:h.varyingGroup,boundingSphere:P.create(B),invariantBoundingSphere:P.create(k),uInvariantBoundingSphere:P.create(Ut.ofSphere(k)),...A,..._,...T,...w,...D,...M,...E,...f,...We.createValues(x,R),uDoubleSided:P.create(x.doubleSided),dFlatShaded:P.create(x.flatShaded),dFlipSided:P.create(x.flipSided),dIgnoreLight:P.create(x.ignoreLight),dCelShaded:P.create(x.celShaded),dXrayShaded:P.create(x.xrayShaded==="inverted"?"inverted":x.xrayShaded===!0?"on":"off"),dTransparentBackfaces:P.create(x.transparentBackfaces),uBumpFrequency:P.create(x.bumpFrequency),uBumpAmplitude:P.create(x.bumpAmplitude),meta:P.create(h.meta)}}function l(h,f,y,g,x){let S=We.createSimple(y,g,x),I={...C.getDefaultValues(p.Params),...f};return s(h,S.transform,S.locationIterator,S.theme,I)}function u(h,f){We.updateValues(h,f),P.updateIfChanged(h.uDoubleSided,f.doubleSided),P.updateIfChanged(h.dFlatShaded,f.flatShaded),P.updateIfChanged(h.dFlipSided,f.flipSided),P.updateIfChanged(h.dIgnoreLight,f.ignoreLight),P.updateIfChanged(h.dCelShaded,f.celShaded),P.updateIfChanged(h.dXrayShaded,f.xrayShaded==="inverted"?"inverted":f.xrayShaded===!0?"on":"off"),P.updateIfChanged(h.dTransparentBackfaces,f.transparentBackfaces),P.updateIfChanged(h.uBumpFrequency,f.bumpFrequency),P.updateIfChanged(h.uBumpAmplitude,f.bumpAmplitude)}function c(h,f){let y=ye.clone(f.boundingSphere),g=Si(y,h.aTransform.ref.value,h.instanceCount.ref.value,0);ye.equals(g,h.boundingSphere.ref.value)||P.update(h.boundingSphere,g),ye.equals(y,h.invariantBoundingSphere.ref.value)||(P.update(h.invariantBoundingSphere,y),P.update(h.uInvariantBoundingSphere,Ut.fromSphere(h.uInvariantBoundingSphere.ref.value,y)))}function m(h){let f=We.createRenderableState(h);return d(f,h),f}function d(h,f){We.updateRenderableState(h,f),h.opaque=h.opaque&&!f.xrayShaded,h.writeDepth=h.opaque}})(is||={});function _he(e,t){let r={},n={},o={},i={},a={},s={},l={};return Object.keys(e).forEach(u=>{let c=e[u];c.type==="attribute"&&(r[u]=t[u]),c.type==="define"&&(n[u]=t[u]),c.type==="texture"&&t[u]!==void 0&&(c.variant==="material"?i[u]=t[u]:o[u]=t[u]),c.type==="uniform"&&t[u]!==void 0&&(c.variant==="material"?s[u]=t[u]:c.variant==="buffered"?l[u]=t[u]:a[u]=t[u])}),{attributeValues:r,defineValues:n,textureValues:o,materialTextureValues:i,uniformValues:a,materialUniformValues:s,bufferedUniformValues:l}}function Rhe(e){let t={};return Object.keys(e).forEach(r=>{t[r]=e[r].ref.version}),t}function Sn(e,t,r){return{type:"attribute",kind:e,itemSize:t,divisor:r}}function he(e,t){return{type:"uniform",kind:e,variant:t}}function pt(e,t,r,n,o){return{type:"texture",kind:e,format:t,dataType:r,filter:n,variant:o}}function Yd(e){return{type:"elements",kind:e}}function ct(e,t){return{type:"define",kind:e,options:t}}function Vn(e){return{type:"value",kind:e}}var kl={uDrawId:he("i"),uModel:he("m4"),uView:he("m4"),uInvView:he("m4"),uModelView:he("m4"),uInvModelView:he("m4"),uProjection:he("m4"),uInvProjection:he("m4"),uModelViewProjection:he("m4"),uInvModelViewProjection:he("m4"),uHasHeadRotation:he("b"),uInvHeadRotation:he("m4"),uIsOrtho:he("f"),uPixelRatio:he("f"),uViewport:he("v4"),uViewOffset:he("v2"),uDrawingBufferSize:he("v2"),uCameraPosition:he("v3"),uCameraDir:he("v3"),uCameraPlane:he("v4"),uNear:he("f"),uFar:he("f"),uFog:he("b"),uFogNear:he("f"),uFogFar:he("f"),uFogColor:he("v3"),uTransparentBackground:he("b"),uLightDirection:he("v3[]"),uLightColor:he("v3[]"),uAmbientColor:he("v3"),uPickingAlphaThreshold:he("f"),uInteriorDarkening:he("f"),uInteriorColorFlag:he("b"),uInteriorColor:he("v3"),uHighlightColor:he("v3"),uSelectColor:he("v3"),uDimColor:he("v3"),uHighlightStrength:he("f"),uSelectStrength:he("f"),uDimStrength:he("f"),uMarkerPriority:he("i"),uMarkerAverage:he("f"),uXrayEdgeFalloff:he("f"),uCelSteps:he("f"),uExposure:he("f"),uRenderMask:he("i"),uMarkingDepthTest:he("b"),uMarkingType:he("i"),uPickType:he("i")},Ll={tDepth:pt("texture","depth","ushort","nearest"),tDpoitDepth:pt("texture","rg","float","nearest"),tDpoitFrontColor:pt("texture","rgba","float","nearest"),tDpoitBackColor:pt("texture","rgba","float","nearest")},Fl={uObjectId:he("i")},SWe={uColor:he("v3","material"),uColorTexDim:he("v2"),uColorGridDim:he("v3"),uColorGridTransform:he("v4"),uPaletteDomain:he("v2"),uPaletteDefault:he("v3"),tColor:pt("image-uint8","rgb","ubyte","nearest"),tPalette:pt("image-uint8","rgb","ubyte","nearest"),tColorGrid:pt("texture","rgb","ubyte","linear"),dColorType:ct("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance","direct"]),dUsePalette:ct("boolean")},Mh={uSize:he("f","material"),uSizeTexDim:he("v2"),tSize:pt("image-uint8","rgb","ubyte","nearest"),dSizeType:ct("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:he("f","material")},vWe={uMarker:he("f"),uMarkerTexDim:he("v2"),tMarker:pt("image-uint8","alpha","ubyte","nearest"),markerAverage:Vn("number"),markerStatus:Vn("number"),dMarkerType:ct("string",["instance","groupInstance"])},IWe={uOverpaintTexDim:he("v2"),tOverpaint:pt("image-uint8","rgba","ubyte","nearest"),dOverpaint:ct("boolean"),uOverpaintGridDim:he("v3"),uOverpaintGridTransform:he("v4"),tOverpaintGrid:pt("texture","rgba","ubyte","linear"),dOverpaintType:ct("string",["instance","groupInstance","volumeInstance"]),uOverpaintStrength:he("f","material")},AWe={uTransparencyTexDim:he("v2"),tTransparency:pt("image-uint8","alpha","ubyte","nearest"),dTransparency:ct("boolean"),transparencyAverage:Vn("number"),transparencyMin:Vn("number"),uTransparencyGridDim:he("v3"),uTransparencyGridTransform:he("v4"),tTransparencyGrid:pt("texture","alpha","ubyte","linear"),dTransparencyType:ct("string",["instance","groupInstance","volumeInstance"]),uTransparencyStrength:he("f","material")},TWe={uEmissiveTexDim:he("v2"),tEmissive:pt("image-uint8","alpha","ubyte","nearest"),dEmissive:ct("boolean"),emissiveAverage:Vn("number"),uEmissiveGridDim:he("v3"),uEmissiveGridTransform:he("v4"),tEmissiveGrid:pt("texture","alpha","ubyte","linear"),dEmissiveType:ct("string",["instance","groupInstance","volumeInstance"]),uEmissiveStrength:he("f","material")},PWe={uSubstanceTexDim:he("v2"),tSubstance:pt("image-uint8","rgba","ubyte","nearest"),dSubstance:ct("boolean"),uSubstanceGridDim:he("v3"),uSubstanceGridTransform:he("v4"),tSubstanceGrid:pt("texture","rgba","ubyte","linear"),dSubstanceType:ct("string",["instance","groupInstance","volumeInstance"]),uSubstanceStrength:he("f","material")},_We={uClippingTexDim:he("v2"),tClipping:pt("image-uint8","alpha","ubyte","nearest"),dClipping:ct("boolean"),dClippingType:ct("string",["instance","groupInstance"])},Vl={dGeometryType:ct("string",["cylinders","directVolume","image","lines","mesh","points","spheres","text","textureMesh"]),...SWe,...vWe,...IWe,...AWe,...TWe,...PWe,..._We,dLightCount:ct("number"),dColorMarker:ct("boolean"),dClipObjectCount:ct("number"),dClipVariant:ct("string",["instance","pixel"]),uClipObjectType:he("i[]","material"),uClipObjectInvert:he("b[]","material"),uClipObjectPosition:he("v3[]","material"),uClipObjectRotation:he("v4[]","material"),uClipObjectScale:he("v3[]","material"),uClipObjectTransform:he("m4[]","material"),aInstance:Sn("float32",1,1),aTransform:Sn("float32",16,1),uAlpha:he("f","material"),uMetalness:he("f","material"),uRoughness:he("f","material"),uBumpiness:he("f","material"),uEmissive:he("f","material"),uDensity:he("f","material"),uVertexCount:he("i"),uInstanceCount:he("i"),uGroupCount:he("i"),uInvariantBoundingSphere:he("v4"),uLod:he("v4"),drawCount:Vn("number"),instanceCount:Vn("number"),alpha:Vn("number"),matrix:Vn("m4"),transform:Vn("float32"),extraTransform:Vn("float32"),hasReflection:Vn("boolean"),instanceGranularity:Vn("boolean"),boundingSphere:Vn("sphere"),invariantBoundingSphere:Vn("sphere"),instanceGrid:Vn("instanceGrid")};var Dhe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords);
}
`;var bn=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

void main(void) {
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`;var RWe=3e7,DWe=oi();function wWe(e,t){let{gl:r}=e;switch(t){case"points":return r.POINTS;case"lines":return r.LINES;case"line-strip":return r.LINE_STRIP;case"line-loop":return r.LINE_LOOP;case"triangles":return r.TRIANGLES;case"triangle-strip":return r.TRIANGLE_STRIP;case"triangle-fan":return r.TRIANGLE_FAN}}var EWe={color:"",pick:"",depth:"",marking:"",emissive:"",tracing:""},MWe=Object.keys(EWe),BWe={compute:""},kWe=Object.keys(BWe);function J6(e,t,r,n,o){return r={...r,dRenderVariant:P.create(t)},o.dRenderVariant===void 0&&Object.defineProperty(o,"dRenderVariant",{value:ct("string")}),e.resources.program(r,n,o)}function LWe(){return{attributes:!1,defines:!1,elements:!1,textures:!1}}function FWe(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}function $6(e,t){if(e==="color")switch(t){case"blended":return"colorBlended";case"wboit":return"colorWboit";case"dpoit":return"colorDpoit"}return e}function Ol(e,t,r,n,o,i,a){return whe(e,t,r,n,o,i,MWe,a)}function Wr(e,t,r,n,o,i=-1){return whe(e,t,r,n,o,i,kWe,void 0)}function whe(e,t,r,n,o,i,a,s){let l=DWe(),{stats:u,state:c,resources:m}=e,{instancedArrays:d,vertexArrayObject:p,multiDrawInstancedBaseVertexBaseInstance:h,drawInstancedBaseVertexBaseInstance:f}=e.extensions;if(a=a.filter(ie=>ie==="tracing"?!!e.extensions.drawBuffers:!0),o.uVertexCount&&!e.extensions.noNonInstancedActiveAttribs){let ie=o.uVertexCount.ref.value;o.aVertex=P.create(_a(new Float32Array(ie))),n.aVertex=Sn("float32",1,0)}let{attributeValues:y,defineValues:g,textureValues:x,materialTextureValues:S,uniformValues:I,materialUniformValues:v,bufferedUniformValues:A}=_he(n,o),_=Object.entries(I),T=Object.entries(v),w=Object.entries(A),D=Object.entries(nfe(A)),M=Object.entries(g),E=Rhe(o),R=wWe(e,t),k={};for(let ie of a)k[ie]=J6(e,$6(ie,s),g,r,n);let B=_6(e,n,x),L=_6(e,n,S),V=sfe(e,n,y),U=[];for(let ie=0,oe=V.length;ie<oe;++ie){let W=V[ie];W[1].divisor===1&&U.push(W)}let Q,O=o.elements;O&&O.ref.value&&(Q=m.elements(O.ref.value));let q={};for(let ie of a)q[ie]=p?m.vertexArray(k[ie],V,Q):null;let X=o.drawCount.ref.value,F=o.instanceCount.ref.value;u.drawCount+=X,u.instanceCount+=F,u.instancedDrawCount+=F*X;let Y=LWe(),$=!1,ce=-1;return{id:l,materialId:i,getProgram:ie=>k[ie],setTransparency:ie=>{if(ie!==s){s=ie;for(let oe of a)k[oe].destroy(),k[oe]=J6(e,$6(oe,s),g,r,n)}},render:(ie,oe,W)=>{if(X===0||F===0)return;let N=k[ie];if(N.id===ce&&c.currentRenderItemId===l)N.setUniforms(_),N.bindTextures(B,oe);else{let j=q[ie];(N.id!==c.currentProgramId||N.id!==ce||i===-1||i!==c.currentMaterialId)&&(N.id!==c.currentProgramId&&N.use(),N.setUniforms(T),N.bindTextures(L,oe+B.length),c.currentMaterialId=i,ce=N.id),N.setUniforms(_),N.setUniforms(D),N.bindTextures(B,oe),j?(j.bind(),Q&&Q.bind()):(Q&&Q.bind(),N.bindAttributes(V)),c.currentRenderItemId=l}if($t&&e.checkFramebufferStatus(`Framebuffer error rendering item id ${l}`),W){for(let j of W)if(j.count!==0){if(N.setUniforms(j.uniforms),h)Q?h.multiDrawElementsInstancedBaseVertexBaseInstance(R,j.counts,0,Q._dataType,j.offsets,0,j.instanceCounts,0,j.baseVertices,0,j.baseInstances,0,j.count):h.multiDrawArraysInstancedBaseInstance(R,j.firsts,0,j.counts,0,j.instanceCounts,0,j.baseInstances,0,j.count);else if(f)if(Q)for(let ue=0;ue<j.count;++ue)j.counts[ue]>0&&(N.uniform("uDrawId",ue),f.drawElementsInstancedBaseVertexBaseInstance(R,j.counts[ue],Q._dataType,j.offsets[ue],j.instanceCounts[ue],j.baseVertices[ue],j.baseInstances[ue]));else for(let ue=0;ue<j.count;++ue)j.counts[ue]>0&&(N.uniform("uDrawId",ue),f.drawArraysInstancedBaseInstance(R,j.firsts[ue],j.counts[ue],j.instanceCounts[ue],j.baseInstances[ue]));else if(Q)for(let ue=0;ue<j.count;++ue)j.counts[ue]>0&&(N.uniform("uDrawId",ue),N.offsetAttributes(U,j.baseInstances[ue]),d.drawElementsInstanced(R,j.counts[ue],Q._dataType,j.offsets[ue],j.instanceCounts[ue]));else for(let ue=0;ue<j.count;++ue)j.counts[ue]>0&&(N.uniform("uDrawId",ue),N.offsetAttributes(U,j.baseInstances[ue]),d.drawArraysInstanced(R,0,j.counts[ue],j.instanceCounts[ue]));if(He){h?u.calls.multiDrawInstancedBase+=1:f?u.calls.drawInstancedBase+=j.count:u.calls.drawInstanced+=j.count;for(let ue=0;ue<j.count;++ue)u.calls.counts+=j.instanceCounts[ue]}}}else{let j=0;for(;;){let ue=Math.min(X-j,RWe);if(Q?d.drawElementsInstanced(R,ue,Q._dataType,j*Q._bpe,F):d.drawArraysInstanced(R,j,ue,F),j+=ue,j>=X)break}He&&(u.calls.drawInstanced+=1,u.calls.counts+=F)}$t&&e.checkError(`Draw error rendering item id ${l}`)},update:()=>{if(FWe(Y),o.aVertex){let ie=o.uVertexCount.ref.value;o.aVertex.ref.value.length<ie&&P.update(o.aVertex,_a(new Float32Array(ie)))}for(let ie=0,oe=M.length;ie<oe;++ie){let[W,N]=M[ie];N.ref.version!==E[W]&&(Y.defines=!0,E[W]=N.ref.version)}if(Y.defines)for(let ie of a)k[ie].destroy(),k[ie]=J6(e,$6(ie,s),g,r,n);o.drawCount.ref.version!==E.drawCount&&(u.drawCount+=o.drawCount.ref.value-X,u.instancedDrawCount+=F*o.drawCount.ref.value-F*X,X=o.drawCount.ref.value,E.drawCount=o.drawCount.ref.version),o.instanceCount.ref.version!==E.instanceCount&&(u.instanceCount+=o.instanceCount.ref.value-F,u.instancedDrawCount+=o.instanceCount.ref.value*X-F*X,F=o.instanceCount.ref.value,E.instanceCount=o.instanceCount.ref.version);for(let ie=0,oe=V.length;ie<oe;++ie){let[W,N]=V[ie],j=y[W];if(j.ref.version!==E[W]){if(N.length>=j.ref.value.length)N.updateSubData(j.ref.value,0,N.length);else{N.destroy();let{itemSize:ue,divisor:be}=n[W];V[ie][1]=m.attribute(j.ref.value,ue,be),Y.attributes=!0}E[W]=j.ref.version}}if(Q&&o.elements.ref.version!==E.elements&&(Q.length>=o.elements.ref.value.length?Q.updateSubData(o.elements.ref.value,0,Q.length):(Q.destroy(),Q=m.elements(o.elements.ref.value),Y.elements=!0),E.elements=o.elements.ref.version),Y.attributes||Y.defines||Y.elements)for(let ie of a){let oe=q[ie];oe&&oe.destroy(),q[ie]=p?m.vertexArray(k[ie],V,Q):null}for(let ie=0,oe=B.length;ie<oe;++ie){let[W,N]=B[ie],j=x[W];j.ref.version!==E[W]&&(n[W].kind!=="texture"?(N.load(j.ref.value),Y.textures=!0):B[ie][1]=j.ref.value,E[W]=j.ref.version)}for(let ie=0,oe=L.length;ie<oe;++ie){let[W,N]=L[ie],j=S[W];j.ref.version!==E[W]&&(n[W].kind!=="texture"?(N.load(j.ref.value),Y.textures=!0):L[ie][1]=j.ref.value,E[W]=j.ref.version)}for(let ie=0,oe=w.length;ie<oe;++ie){let[W,N]=w[ie];N.ref.version!==E[W]&&(P.update(D[ie][1],Ya(N.ref.value)),E[W]=N.ref.version)}},destroy:()=>{if(!$){for(let ie of a){k[ie].destroy();let oe=q[ie];oe&&oe.destroy()}B.forEach(([ie,oe])=>{n[ie].kind!=="texture"&&oe.destroy()}),L.forEach(([ie,oe])=>{n[ie].kind!=="texture"&&oe.destroy()}),V.forEach(([ie,oe])=>oe.destroy()),Q&&Q.destroy(),u.drawCount-=X,u.instanceCount-=F,u.instancedDrawCount-=F*X,$=!0}}}}function jo(){return jo.create(b.create(1,0,0),0)}(f=>{function e(y,g){return{normal:y,constant:g}}f.create=e;function t(y,g){return b.copy(y.normal,g.normal),y.constant=g.constant,y}f.copy=t;function r(y){return t(f(),y)}f.clone=r;function n(y,g){let x=1/b.magnitude(g.normal);return b.scale(y.normal,g.normal,x),y.constant=g.constant*x,y}f.normalize=n;function o(y,g){return b.negate(y.normal,g.normal),y.constant=-g.constant,y}f.negate=o;function i(y,g,x){return b.toArray(y.normal,g,x),g[x+3]=y.constant,g}f.toArray=i;function a(y,g,x){return b.fromArray(y.normal,g,x),y.constant=g[x+3],y}f.fromArray=a;function s(y,g,x){return b.copy(y.normal,g),y.constant=-b.dot(y.normal,x),y}f.fromNormalAndCoplanarPoint=s;function l(y,g,x,S){let I=b.triangleNormal(b(),g,x,S);return s(y,I,g),y}f.fromCoplanarPoints=l;let u=b();function c(y,g,x,S,I){b.set(u,g,x,S);let v=1/b.magnitude(u);return b.scale(y.normal,u,v),y.constant=I*v,y}f.setUnnormalized=c;function m(y,g){return b.dot(y.normal,g)+y.constant}f.distanceToPoint=m;function d(y,g){return m(y,g.center)-g.radius}f.distanceToSphere3D=d;function p(y,g,x){return b.scaleAndAdd(y,x,g.normal,-m(g,x))}f.projectPoint=p;function h(y,g,x){let S=b.dot(g.normal,x.direction);if(S===0)return!1;let I=-(b.dot(g.normal,x.origin)+g.constant)/S;return I<0?!1:(b.scaleAndAdd(y,x.origin,x.direction,I),!0)}f.intersectRay3D=h})(jo||={});function Bh(){return Bh.create(jo(),jo(),jo(),jo(),jo(),jo())}(u=>{let e;(y=>(y[y.Right=0]="Right",y[y.Left=1]="Left",y[y.Bottom=2]="Bottom",y[y.Top=3]="Top",y[y.Far=4]="Far",y[y.Near=5]="Near"))(e=u.PlaneIndex||={});function t(c,m,d,p,h,f){return[c,m,d,p,h,f]}u.create=t;function r(c,m){for(let d=0;d<6;++d)jo.copy(c[d],m[d]);return c}u.copy=r;function n(c){return r(u(),c)}u.clone=n;function o(c,m){let d=m[0],p=m[1],h=m[2],f=m[3],y=m[4],g=m[5],x=m[6],S=m[7],I=m[8],v=m[9],A=m[10],_=m[11],T=m[12],w=m[13],D=m[14],M=m[15];return jo.setUnnormalized(c[0],f-d,S-y,_-I,M-T),jo.setUnnormalized(c[1],f+d,S+y,_+I,M+T),jo.setUnnormalized(c[2],f+p,S+g,_+v,M+w),jo.setUnnormalized(c[3],f-p,S-g,_-v,M-w),jo.setUnnormalized(c[4],f-h,S-x,_-A,M-D),jo.setUnnormalized(c[5],f+h,S+x,_+A,M+D),c}u.fromProjectionMatrix=o;function i(c,m){let d=m.center,p=-m.radius;for(let h=0;h<6;++h)if(jo.distanceToPoint(c[h],d)<p)return!1;return!0}u.intersectsSphere3D=i;let a=b();function s(c,m){for(let d=0;d<6;++d){let p=c[d];if(a[0]=p.normal[0]>0?m.max[0]:m.min[0],a[1]=p.normal[1]>0?m.max[1]:m.min[1],a[2]=p.normal[2]>0?m.max[2]:m.min[2],jo.distanceToPoint(p,a)<0)return!1}return!0}u.intersectsBox3D=s;function l(c,m){for(let d=0;d<6;++d)if(jo.distanceToPoint(c[d],m)<0)return!1;return!0}u.containsPoint=l})(Bh||={});var jB=jo.distanceToPoint,WB=Bh.intersectsSphere3D,XB=ye.fromArray,Ehe=oi();function e7(e,t){return t&&t.instanceCounts.length>=e?t:{firsts:new Int32Array(e),counts:new Int32Array(e),offsets:new Int32Array(e),instanceCounts:new Int32Array(e),baseVertices:new Int32Array(e),baseInstances:new Uint32Array(e),count:0,uniforms:[]}}function Gl(e,t,r){let n=Ehe(),o=e7(0),i=[],a=!1,s=-1,l=ye(),u=()=>{let c=t.lodLevels?.ref.value;if(c&&c.length>0){let{cellCount:m}=t.instanceGrid.ref.value;i.length=c.length;for(let d=0,p=c.length;d<p;++d)i[d]=e7(m,i[d]),i[d].count=0;if(t.lodLevels.ref.version!==s){for(let d=0,p=c.length;d<p;++d)i[d].uniforms.length!==1&&(i[d].uniforms.length=1,i[d].uniforms[0]=["uLod",P.create(Ut())]),P.update(i[d].uniforms[0][1],Ut.set(i[d].uniforms[0][1].ref.value,c[d][0],c[d][1],c[d][2],c[d][4]));s=t.lodLevels.ref.version}}};return u(),{id:n,materialId:e.materialId,values:t,state:r,cull:(c,m,d,p)=>{if(a=!1,t.drawCount.ref.value===0||t.instanceCount.ref.value===0||t.instanceGrid.ref.value.cellSize<=1)return;let{cellOffsets:h,cellSpheres:f,cellCount:y,batchOffsets:g,batchSpheres:x,batchCount:S,batchCell:I,batchSize:v}=t.instanceGrid.ref.value,[A,_]=t.uLod.ref.value,T=A!==0||_!==0,w=2*v,D=t.lodLevels?.ref.value;if(D&&D.length>0){if(t.lodLevels?.ref.version!==s)u();else for(let M=0,E=D.length;M<E;++M)i[M].count=0;for(let M=0;M<S;++M){let E=g[M],R=g[M+1];if(R-E===0)continue;XB(l,x,M*4);let B=jB(c,l.center);if(T&&(B+l.radius<A||B-l.radius>_)){He&&(p.culled.lod+=h[I[R-1]+1]-h[I[E]]);continue}if(!WB(m,l)){He&&(p.culled.frustum+=h[I[R-1]+1]-h[I[E]]);continue}if(d!==null&&d(l)){He&&(p.culled.occlusion+=h[I[R-1]+1]-h[I[E]]);continue}for(let L=E;L<R;++L){let V=I[L],U=h[V],O=h[V+1]-U;if(O===0)continue;XB(l,f,V*4);let q=jB(c,l.center);if(T&&(q+l.radius<A||q-l.radius>_)){He&&(p.culled.lod+=O);continue}if(!WB(m,l)){He&&(p.culled.frustum+=O);continue}if(d!==null&&q-l.radius<w&&d(l)){He&&(p.culled.occlusion+=O);continue}for(let X=0,F=D.length;X<F;++X){if(q+l.radius<D[X][0]||q-l.radius>D[X][1])continue;let Y=i[X],$=Y.count;$>0&&Y.baseInstances[$-1]+Y.instanceCounts[$-1]===U&&Y.counts[$-1]===D[X][3]?Y.instanceCounts[$-1]+=O:(Y.counts[$]=D[X][3],Y.instanceCounts[$]=O,Y.baseInstances[$]=U,Y.count+=1)}}}}else{o=e7(y,o);let{baseInstances:M,instanceCounts:E,counts:R}=o,k=0;for(let B=0;B<S;++B){let L=g[B],V=g[B+1];if(V-L!==0){if(XB(l,x,B*4),T){let Q=jB(c,l.center);if(Q+l.radius<A||Q-l.radius>_){He&&(p.culled.lod+=h[I[V-1]+1]-h[I[L]]);continue}}if(!WB(m,l)){He&&(p.culled.frustum+=h[I[V-1]+1]-h[I[L]]);continue}if(d!==null&&d(l)){He&&(p.culled.occlusion+=h[I[V-1]+1]-h[I[L]]);continue}for(let Q=L;Q<V;++Q){let O=I[Q],q=h[O],F=h[O+1]-q;if(F===0)continue;XB(l,f,O*4);let Y=jB(c,l.center);if(T&&(Y+l.radius<A||Y-l.radius>_)){He&&(p.culled.lod+=F);continue}if(!WB(m,l)){He&&(p.culled.frustum+=F);continue}if(d!==null&&Y-l.radius<w&&d(l)){He&&(p.culled.occlusion+=F);continue}k>0&&M[k-1]+E[k-1]===q?E[k-1]+=F:(R[k]=t.drawCount.ref.value,E[k]=F,M[k]=q,k+=1)}}}o.count=k,i.length=1,i[0]=o,i[0].uniforms.length=0}a=!0},uncull:()=>{a=!1},render:(c,m)=>{t.uAlpha&&t.alpha&&P.updateIfChanged(t.uAlpha,Br(t.alpha.ref.value*r.alphaFactor,0,1)),e.render(c,m,a?i:void 0)},getProgram:c=>e.getProgram(c),setTransparency:c=>e.setTransparency(c),update:()=>{e.update(),u()},dispose:()=>e.destroy()}}function Xr(e,t){return{id:Ehe(),values:t,render:()=>e.render("compute",0),update:()=>e.update(),dispose:()=>e.destroy()}}var d_=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),un={drawCount:Vn("number"),instanceCount:Vn("number"),aPosition:Sn("float32",2,0),uQuadScale:he("v2")},cn={drawCount:P.create(6),instanceCount:P.create(1),aPosition:P.create(d_),uQuadScale:P.create(Ie.create(1,1))},VWe={...un,tColor:pt("texture","rgba","ubyte","nearest"),uTexSize:he("v2")},OWe=Dr("copy",bn,Dhe);function mm(e,t){let r={...cn,tColor:P.create(t),uTexSize:P.create(Ie.create(t.getWidth(),t.getHeight()))},n={...VWe},o=Wr(e,"triangles",OWe,n,r);return Xr(o,r)}var Mhe=new Uint32Array([0,1,2,1,3,2]),GWe=new Float32Array([0,1,0,0,1,1,1,0]),QB={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},Bhe=Object.keys(QB);var hu;(f=>{function e(){return{type:0,center:b(),rotation:Tr(),scale:b(),transform:Z()}}f.createEmptyTrim=e;function t(y,g,x,S,I,v,A){return A?o(y,g,x,S,I,v,A):n(y,g,x,S,I,v)}f.create=t;function r(y){return Ro([y.cornerBuffer.ref.version])}function n(y,g,x,S,I,v){let A=ye(),_=-1,T=y.width,w=y.height,D={kind:"image",imageTexture:P.create(y),imageTextureDim:P.create(Ie.create(T,w)),cornerBuffer:P.create(g),groupTexture:P.create(x),valueTexture:P.create(S),trimType:P.create(I.type),trimCenter:P.create(I.center),trimRotation:P.create(I.rotation),trimScale:P.create(I.scale),trimTransform:P.create(I.transform),isoLevel:P.create(v),get boundingSphere(){let M=r(D);if(M!==_){let E=UWe(D.cornerBuffer.ref.value);ye.copy(A,E),_=M}return A},setBoundingSphere(M){ye.copy(A,M),_=r(D)}};return D}function o(y,g,x,S,I,v,A){let _=y.width,T=y.height;return P.update(A.imageTexture,y),P.update(A.imageTextureDim,Ie.set(A.imageTextureDim.ref.value,_,T)),P.update(A.cornerBuffer,g),P.update(A.groupTexture,x),P.update(A.valueTexture,S),P.updateIfChanged(A.trimType,I.type),P.update(A.trimCenter,b.copy(A.trimCenter.ref.value,I.center)),P.update(A.trimRotation,Tr.copy(A.trimRotation.ref.value,I.rotation)),P.update(A.trimScale,b.copy(A.trimScale.ref.value,I.scale)),P.update(A.trimTransform,Z.copy(A.trimTransform.ref.value,I.transform)),P.updateIfChanged(A.isoLevel,v),A}function i(y){let g=so(0,4,Uint8Array),x=y?y.cornerBuffer.ref.value:new Float32Array(8*3),S=so(0,4,Uint8Array),I=so(0,1,Float32Array),v=e();return t(g,x,S,I,v,-1,y)}f.createEmpty=i,f.Params={...We.Params,interpolation:C.Select("bspline",C.objectToOptions(QB))},f.Utils={Params:f.Params,createEmpty:i,createValues:u,createValuesSimple:c,updateValues:m,updateBoundingSphere:d,createRenderableState:p,updateRenderableState:h,createPositionIterator:l};function l(y,g){return Kr(1,1,1,()=>pu)}function u(y,g,x,S,I){let{instanceCount:v,groupCount:A}=x,_=l(y,g),T=Ki(x,_,S.color),w=I.instanceGranularity?oo(v,"instance"):oo(v*A,"groupInstance"),D=_l(),M=Rl(),E=El(),R=wl(),k=Dl(),B={drawCount:Mhe.length,vertexCount:d_.length/3,groupCount:A,instanceCount:v},L=ye.clone(y.boundingSphere),V=Si(L,g.aTransform.ref.value,v,0);return{dGeometryType:P.create("image"),...T,...w,...D,...M,...E,...R,...k,...g,...We.createValues(I,B),aPosition:y.cornerBuffer,aUv:P.create(GWe),elements:P.create(Mhe),aGroup:P.create(_a(new Float32Array(4))),boundingSphere:P.create(V),invariantBoundingSphere:P.create(L),uInvariantBoundingSphere:P.create(Ut.ofSphere(L)),dInterpolation:P.create(I.interpolation),uImageTexDim:y.imageTextureDim,tImageTex:y.imageTexture,tGroupTex:y.groupTexture,tValueTex:y.valueTexture,uTrimType:y.trimType,uTrimCenter:y.trimCenter,uTrimRotation:y.trimRotation,uTrimScale:y.trimScale,uTrimTransform:y.trimTransform,uIsoLevel:y.isoLevel}}function c(y,g,x,S,I){let v=We.createSimple(x,S,I),A={...C.getDefaultValues(f.Params),...g};return u(y,v.transform,v.locationIterator,v.theme,A)}function m(y,g){We.updateValues(y,g),P.updateIfChanged(y.dInterpolation,g.interpolation)}function d(y,g){let x=ye.clone(g.boundingSphere),S=Si(x,y.aTransform.ref.value,y.instanceCount.ref.value,0);ye.equals(S,y.boundingSphere.ref.value)||P.update(y.boundingSphere,S),ye.equals(x,y.invariantBoundingSphere.ref.value)||(P.update(y.invariantBoundingSphere,x),P.update(y.uInvariantBoundingSphere,Ut.fromSphere(y.uInvariantBoundingSphere.ref.value,x)))}function p(y){let g=We.createRenderableState(y);return g.opaque=!1,g}function h(y,g){We.updateRenderableState(y,g),y.opaque=!1}})(hu||={});function UWe(e){let t=b(),r=[];for(let i=0,a=e.length;i<a;i+=3){let s=b.fromArray(b(),e,i);r.push(s),b.add(t,t,s)}b.scale(t,t,1/(e.length/3));let n=0;for(let i of r){let a=b.distance(t,i);a>n&&(n=a)}let o=ye.create(t,n);return ye.setExtrema(o,r),o}var Di;(f=>{function e(y,g,x,S,I,v,A,_,T,w){return w?o(y,g,x,S,I,v,A,_,T,w):n(y,g,x,S,I,v,A,_,T)}f.create=e;function t(y){let g=y?y.mappingBuffer.ref.value:new Float32Array(0),x=y?y.indexBuffer.ref.value:new Uint32Array(0),S=y?y.groupBuffer.ref.value:new Float32Array(0),I=y?y.startBuffer.ref.value:new Float32Array(0),v=y?y.endBuffer.ref.value:new Float32Array(0),A=y?y.scaleBuffer.ref.value:new Float32Array(0),_=y?y.capBuffer.ref.value:new Float32Array(0),T=y?y.colorModeBuffer.ref.value:new Float32Array(0);return e(g,x,S,I,v,A,_,T,0,y)}f.createEmpty=t;function r(y){return Ro([y.cylinderCount,y.mappingBuffer.ref.version,y.indexBuffer.ref.version,y.groupBuffer.ref.version,y.startBuffer.ref.version,y.endBuffer.ref.version,y.scaleBuffer.ref.version,y.capBuffer.ref.version,y.colorModeBuffer.ref.version])}function n(y,g,x,S,I,v,A,_,T){let w=ye(),D,M=-1,E=-1,R={kind:"cylinders",cylinderCount:T,mappingBuffer:P.create(y),indexBuffer:P.create(g),groupBuffer:P.create(x),startBuffer:P.create(S),endBuffer:P.create(I),scaleBuffer:P.create(v),capBuffer:P.create(A),colorModeBuffer:P.create(_),get boundingSphere(){let k=r(R);if(k!==M){let B=um(R.startBuffer.ref.value,R.cylinderCount*6,6),L=um(R.endBuffer.ref.value,R.cylinderCount*6,6);ye.expandBySphere(w,B,L),M=k}return w},get groupMapping(){return R.groupBuffer.ref.version!==E&&(D=Zd(R.groupBuffer.ref.value,R.cylinderCount,6),E=R.groupBuffer.ref.version),D},setBoundingSphere(k){ye.copy(w,k),M=r(R)}};return R}function o(y,g,x,S,I,v,A,_,T,w){return T>w.cylinderCount&&(P.update(w.mappingBuffer,y),P.update(w.indexBuffer,g)),w.cylinderCount=T,P.update(w.groupBuffer,x),P.update(w.startBuffer,S),P.update(w.endBuffer,I),P.update(w.scaleBuffer,v),P.update(w.capBuffer,A),P.update(w.colorModeBuffer,_),w}function i(y,g){let x=y.startBuffer.ref.value;Pc(g,x,0,y.cylinderCount*6),P.update(y.startBuffer,x);let S=y.endBuffer.ref.value;Pc(g,S,0,y.cylinderCount*6),P.update(y.endBuffer,S)}f.transform=i,f.Params={...We.Params,sizeFactor:C.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:C.Numeric(1,{min:0,max:3,step:.01}),doubleSided:C.Boolean(!1,We.CustomQualityParamInfo),ignoreLight:C.Boolean(!1,We.ShadingCategory),celShaded:C.Boolean(!1,We.ShadingCategory),xrayShaded:C.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],We.ShadingCategory),transparentBackfaces:C.Select("off",C.arrayToOptions(["off","on","opaque"]),We.ShadingCategory),solidInterior:C.Boolean(!0,We.ShadingCategory),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},We.ShadingCategory),bumpAmplitude:C.Numeric(1,{min:0,max:5,step:.1},We.ShadingCategory),colorMode:C.Select("default",C.arrayToOptions(["default","interpolate"]),We.ShadingCategory)},f.Utils={Params:f.Params,createEmpty:t,createValues:u,createValuesSimple:c,updateValues:m,updateBoundingSphere:d,createRenderableState:p,updateRenderableState:h,createPositionIterator:l};function l(y,g){let x=y.cylinderCount*6,S=g.instanceCount.ref.value,I=As(),v=I.position,A=y.startBuffer.ref.value,_=y.endBuffer.ref.value,T=g.aTransform.ref.value;return Kr(x,S,2,(D,M)=>{let E=D%6===0?A:_;return M<0?b.fromArray(v,E,D*3):b.transformMat4Offset(v,E,T,0,D*3,M*16),I})}function u(y,g,x,S,I){let{instanceCount:v,groupCount:A}=x,_=l(y,g),T=Ki(x,_,S.color),w=Ml(x,S.size),D=I.instanceGranularity?oo(v,"instance"):oo(v*A,"groupInstance"),M=_l(),E=Rl(),R=El(),k=wl(),B=Dl(),L={drawCount:y.cylinderCount*4*3,vertexCount:y.cylinderCount*6,groupCount:A,instanceCount:v},V=Ax(w)*I.sizeFactor,U=ye.clone(y.boundingSphere),Q=Si(U,g.aTransform.ref.value,v,0);return{dGeometryType:P.create("cylinders"),aMapping:y.mappingBuffer,aGroup:y.groupBuffer,aStart:y.startBuffer,aEnd:y.endBuffer,aScale:y.scaleBuffer,aCap:y.capBuffer,aColorMode:y.colorModeBuffer,elements:y.indexBuffer,boundingSphere:P.create(Q),invariantBoundingSphere:P.create(U),uInvariantBoundingSphere:P.create(Ut.ofSphere(U)),...T,...w,...D,...M,...E,...R,...k,...B,...g,padding:P.create(V),...We.createValues(I,L),uSizeFactor:P.create(I.sizeFactor*I.sizeAspectRatio),uDoubleSided:P.create(I.doubleSided),dIgnoreLight:P.create(I.ignoreLight),dCelShaded:P.create(I.celShaded),dXrayShaded:P.create(I.xrayShaded==="inverted"?"inverted":I.xrayShaded===!0?"on":"off"),dTransparentBackfaces:P.create(I.transparentBackfaces),dSolidInterior:P.create(I.solidInterior),uBumpFrequency:P.create(I.bumpFrequency),uBumpAmplitude:P.create(I.bumpAmplitude),dDualColor:P.create(I.colorMode==="interpolate")}}function c(y,g,x,S,I){let v=We.createSimple(x,S,I),A={...C.getDefaultValues(f.Params),...g};return u(y,v.transform,v.locationIterator,v.theme,A)}function m(y,g){We.updateValues(y,g),P.updateIfChanged(y.uSizeFactor,g.sizeFactor*g.sizeAspectRatio),P.updateIfChanged(y.uDoubleSided,g.doubleSided),P.updateIfChanged(y.dIgnoreLight,g.ignoreLight),P.updateIfChanged(y.dCelShaded,g.celShaded),P.updateIfChanged(y.dXrayShaded,g.xrayShaded==="inverted"?"inverted":g.xrayShaded===!0?"on":"off"),P.updateIfChanged(y.dTransparentBackfaces,g.transparentBackfaces),P.updateIfChanged(y.dSolidInterior,g.solidInterior),P.updateIfChanged(y.uBumpFrequency,g.bumpFrequency),P.updateIfChanged(y.uBumpAmplitude,g.bumpAmplitude),P.updateIfChanged(y.dDualColor,g.colorMode==="interpolate")}function d(y,g){let x=ye.clone(g.boundingSphere),S=Si(x,y.aTransform.ref.value,y.instanceCount.ref.value,0);ye.equals(S,y.boundingSphere.ref.value)||P.update(y.boundingSphere,S),ye.equals(x,y.invariantBoundingSphere.ref.value)||(P.update(y.invariantBoundingSphere,x),P.update(y.uInvariantBoundingSphere,Ut.fromSphere(y.uInvariantBoundingSphere.ref.value,x)))}function p(y){let g=We.createRenderableState(y);return h(g,y),g}function h(y,g){We.updateRenderableState(y,g),y.opaque=y.opaque&&!g.xrayShaded,y.writeDepth=y.opaque}})(Di||={});var Ga;(i=>{function e(a){switch(a.kind){case"mesh":return a.triangleCount*3;case"points":return a.pointCount;case"spheres":return a.sphereCount*2*3;case"cylinders":return a.cylinderCount*4*3;case"text":return a.charCount*2*3;case"lines":return a.lineCount*2*3;case"direct-volume":return 12*3;case"image":return 2*3;case"texture-mesh":return a.vertexCount}}i.getDrawCount=e;function t(a){switch(a.kind){case"mesh":return a.vertexCount;case"points":return a.pointCount;case"spheres":return a.sphereCount*6;case"cylinders":return a.cylinderCount*6;case"text":return a.charCount*4;case"lines":return a.lineCount*4;case"direct-volume":let[s,l,u]=a.gridDimension.ref.value;return s*l*u;case"image":return 4;case"texture-mesh":return a.vertexCount}}i.getVertexCount=t;function r(a){switch(a.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return e(a)===0?0:ol(a.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return phe(a.groupTexture.ref.value.array,4)+1;case"texture-mesh":return a.groupCount}}i.getGroupCount=r;function n(a){switch(a.kind){case"mesh":return ft.Utils;case"points":return ml.Utils;case"spheres":return Ts.Utils;case"cylinders":return Di.Utils;case"text":return Ui.Utils;case"lines":return ln.Utils;case"direct-volume":return Bl.Utils;case"image":return hu.Utils;case"texture-mesh":return is.Utils}}i.getUtils=n;function o(a,s){return s==="instance"&&a.nonInstanceable?"group":s}i.getGranularity=o})(Ga||={});var NWe=1,zWe="Assigns sizes as defined by the shape object.",khe={};function HWe(e){return khe}function ZB(e,t){return{factory:ZB,granularity:"groupInstance",size:r=>js.isLocation(r)?r.shape.getSize(r.group,r.instance):NWe,props:t,description:zWe}}var Lhe={name:"shape-group",label:"Shape Group",category:"",factory:ZB,getParams:HWe,defaultValues:C.getDefaultValues(khe),isApplicable:e=>!!e.shape};var jWe={...Vl,aPosition:Sn("float32",3,0),elements:Yd("uint32"),uBboxMin:he("v3"),uBboxMax:he("v3"),uBboxSize:he("v3"),uMaxSteps:he("i"),uStepScale:he("f"),uJumpLength:he("f"),uTransform:he("m4"),uGridDim:he("v3"),tTransferTex:pt("image-uint8","alpha","ubyte","linear"),uTransferScale:he("f","material"),dGridTexType:ct("string",["2d","3d"]),uGridTexDim:he("v3"),tGridTex:pt("texture","rgba","ubyte","linear"),uGridStats:he("v4"),uCellDim:he("v3"),uCartnToUnit:he("m4"),uUnitToCartn:he("m4"),dPackedGroup:ct("boolean"),dAxisOrder:ct("string",["012","021","102","120","201","210"]),dIgnoreLight:ct("boolean"),dCelShaded:ct("boolean"),dXrayShaded:ct("string",["off","on","inverted"]),meta:Vn("unknown")};function Fhe(e,t,r,n,o,i){let a={...kl,...Ll,...Fl,...jWe};e.isWebGL2||(a.uMaxSteps=ct("number"));let s={uObjectId:P.create(t)},u=Ol(e,"triangles",qpe,a,{...r,...s},o,i);return Gl(u,r,n)}var WWe={...Vl,aGroup:Sn("float32",1,0),aPosition:Sn("float32",3,0),aNormal:Sn("float32",3,0),elements:Yd("uint32"),dVaryingGroup:ct("boolean"),dFlatShaded:ct("boolean"),uDoubleSided:he("b","material"),dFlipSided:ct("boolean"),dIgnoreLight:ct("boolean"),dCelShaded:ct("boolean"),dXrayShaded:ct("string",["off","on","inverted"]),dTransparentBackfaces:ct("string",["off","on","opaque"]),uBumpFrequency:he("f","material"),uBumpAmplitude:he("f","material"),meta:Vn("unknown")};function Vhe(e,t,r,n,o,i){let a={...kl,...Ll,...Fl,...WWe},s={uObjectId:P.create(t)},u=Ol(e,"triangles",RB,a,{...r,...s},o,i);return Gl(u,r,n)}var XWe={...Vl,...Mh,aGroup:Sn("float32",1,0),aPosition:Sn("float32",3,0),dPointSizeAttenuation:ct("boolean"),dPointStyle:ct("string",["square","circle","fuzzy"])};function Ohe(e,t,r,n,o,i){let a={...kl,...Ll,...Fl,...XWe},s={uObjectId:P.create(t)},u=Ol(e,"points",jpe,a,{...r,...s},o,i);return Gl(u,r,n)}var QWe={...Vl,...Mh,aGroup:Sn("float32",1,0),aMapping:Sn("float32",2,0),aStart:Sn("float32",3,0),aEnd:Sn("float32",3,0),elements:Yd("uint32"),dLineSizeAttenuation:ct("boolean"),uDoubleSided:he("b","material"),dFlipSided:ct("boolean")};function Ghe(e,t,r,n,o,i){let a={...kl,...Ll,...Fl,...QWe},s={uObjectId:P.create(t)},u=Ol(e,"triangles",Zpe,a,{...r,...s},o,i);return Gl(u,r,n)}var ZWe={...Vl,...Mh,uTexDim:he("v2"),tPositionGroup:pt("image-float32","rgba","float","nearest"),padding:Vn("number"),uDoubleSided:he("b","material"),dIgnoreLight:ct("boolean"),dCelShaded:ct("boolean"),dXrayShaded:ct("string",["off","on","inverted"]),dTransparentBackfaces:ct("string",["off","on","opaque"]),dSolidInterior:ct("boolean"),dClipPrimitive:ct("boolean"),dApproximate:ct("boolean"),uAlphaThickness:he("f"),uBumpFrequency:he("f","material"),uBumpAmplitude:he("f","material"),lodLevels:Vn("unknown"),centerBuffer:Vn("float32"),groupBuffer:Vn("float32")};function Uhe(e,t,r,n,o,i){let a={...kl,...Ll,...Fl,...ZWe},s={uObjectId:P.create(t)},u=Ol(e,"triangles",Wpe,a,{...r,...s},o,i);return Gl(u,r,n)}var qWe={...Vl,...Mh,aGroup:Sn("float32",1,0),aPosition:Sn("float32",3,0),aMapping:Sn("float32",2,0),aDepth:Sn("float32",1,0),elements:Yd("uint32"),aTexCoord:Sn("float32",2,0),tFont:pt("image-uint8","alpha","ubyte","linear"),padding:Vn("number"),uBorderWidth:he("f","material"),uBorderColor:he("v3","material"),uOffsetX:he("f","material"),uOffsetY:he("f","material"),uOffsetZ:he("f","material"),uBackgroundColor:he("v3","material"),uBackgroundOpacity:he("f","material")};function Nhe(e,t,r,n,o,i){let a={...kl,...Ll,...Fl,...qWe},s={uObjectId:P.create(t)},u=Ol(e,"triangles",Qpe,a,{...r,...s},o,i);return Gl(u,r,n)}var YWe={...Vl,uGeoTexDim:he("v2","buffered"),tPosition:pt("texture","rgb","float","nearest"),tGroup:pt("texture","alpha","float","nearest"),tNormal:pt("texture","rgb","float","nearest"),dVaryingGroup:ct("boolean"),dFlatShaded:ct("boolean"),uDoubleSided:he("b","material"),dFlipSided:ct("boolean"),dIgnoreLight:ct("boolean"),dCelShaded:ct("boolean"),dXrayShaded:ct("string",["off","on","inverted"]),dTransparentBackfaces:ct("string",["off","on","opaque"]),uBumpFrequency:he("f","material"),uBumpAmplitude:he("f","material"),meta:Vn("unknown")};function zhe(e,t,r,n,o,i){let a={...kl,...Ll,...Fl,...YWe},s={uObjectId:P.create(t)},u=Ol(e,"triangles",RB,a,{...r,...s},o,i);return Gl(u,r,n)}var KWe={...Vl,aGroup:Sn("float32",1,0),aPosition:Sn("float32",3,0),aUv:Sn("float32",2,0),elements:Yd("uint32"),uImageTexDim:he("v2"),tImageTex:pt("image-uint8","rgba","ubyte","nearest"),tGroupTex:pt("image-uint8","rgba","ubyte","nearest"),tValueTex:pt("image-float32","alpha","float","linear"),uTrimType:he("i"),uTrimCenter:he("v3"),uTrimRotation:he("q"),uTrimScale:he("v3"),uTrimTransform:he("m4"),uIsoLevel:he("f"),dInterpolation:ct("string",Bhe)};function Hhe(e,t,r,n,o,i){let a={...kl,...Ll,...Fl,...KWe},s={uObjectId:P.create(t)},u=Ol(e,"triangles",Ype,a,{...r,...s},o,i);return Gl(u,r,n)}var JWe={...Vl,...Mh,aGroup:Sn("float32",1,0),aStart:Sn("float32",3,0),aEnd:Sn("float32",3,0),aMapping:Sn("float32",3,0),aScale:Sn("float32",1,0),aCap:Sn("float32",1,0),aColorMode:Sn("float32",1,0),elements:Yd("uint32"),padding:Vn("number"),uDoubleSided:he("b","material"),dIgnoreLight:ct("boolean"),dCelShaded:ct("boolean"),dXrayShaded:ct("string",["off","on","inverted"]),dTransparentBackfaces:ct("string",["off","on","opaque"]),dSolidInterior:ct("boolean"),uBumpFrequency:he("f","material"),uBumpAmplitude:he("f","material"),dDualColor:ct("boolean")};function jhe(e,t,r,n,o,i){let a={...kl,...Ll,...Fl,...JWe},s={uObjectId:P.create(t)},u=Ol(e,"triangles",Xpe,a,{...r,...s},o,i);return Gl(u,r,n)}var $We=oi(0,2147483647),Dc=oi(0,2147483647);function Kd(e,t,r,n){return{id:$We(),type:e,values:t,state:r,materialId:n}}function Whe(e,t,r){switch(t.type){case"mesh":return Vhe(e,t.id,t.values,t.state,t.materialId,r);case"points":return Ohe(e,t.id,t.values,t.state,t.materialId,r);case"spheres":return Uhe(e,t.id,t.values,t.state,t.materialId,r);case"cylinders":return jhe(e,t.id,t.values,t.state,t.materialId,r);case"text":return Nhe(e,t.id,t.values,t.state,t.materialId,r);case"lines":return Ghe(e,t.id,t.values,t.state,t.materialId,r);case"direct-volume":return Fhe(e,t.id,t.values,t.state,t.materialId,r);case"image":return Hhe(e,t.id,t.values,t.state,t.materialId,r);case"texture-mesh":return zhe(e,t.id,t.values,t.state,t.materialId,r)}throw new Error("unsupported type")}var Gr;(u=>{function e(c,m,d,p,h,f,y,g){return{id:en.create22(),name:c,sourceData:m,geometry:d,transforms:y||[Z.identity()],get groupCount(){return g??Ga.getGroupCount(d)},getColor:p,getSize:h,getLabel:f}}u.create=e;function t(c){return{color:qB({shape:c},{}),size:ZB({shape:c},{})}}u.getTheme=t;function r(c){let m=c.transforms.length,d=js.Location(c),p=(h,f)=>(d.group=h,d.instance=f,d);return Kr(c.groupCount,m,1,p)}u.groupIterator=r;function n(c,m,d,p,h){let f=h&&h.aTransform.ref.value.length>=c.length*16?h.aTransform.ref.value:new Float32Array(c.length*16);for(let y=0,g=c.length;y<g;++y)Z.toArray(c[y],f,y*16);return Y0(f,c.length,m,d,p,h)}u.createTransform=n;function o(c,m){let d=t(c),p=Ga.getUtils(c.geometry),h=Dc(),f=r(c),y=n(c.transforms,c.geometry.boundingSphere,m.cellSize,m.batchSize),g=p.createValues(c.geometry,y,f,d,m),x=p.createRenderableState(m);return Kd(c.geometry.kind,g,x,h)}u.createRenderObject=o;function i(c){return{kind:"shape-loci",shape:c}}u.Loci=i;function a(c){return!!c&&c.kind==="shape-loci"}u.isLoci=a;function s(c,m){return c.shape===m.shape}u.areLociEqual=s;function l(c){return c.shape.groupCount===0}u.isLociEmpty=l})(Gr||={});var js;(d=>{function e(p,h=0,f=0){return{kind:"group-location",shape:p,group:h,instance:f}}d.Location=e;function t(p){return!!p&&p.kind==="group-location"}d.isLocation=t;function r(p,h){return{kind:"group-loci",shape:p,groups:h}}d.Loci=r;function n(p){return!!p&&p.kind==="group-loci"}d.isLoci=n;function o(p,h){if(p.shape!==h.shape||p.groups.length!==h.groups.length)return!1;for(let f=0,y=p.groups.length;f<y;++f){let{ids:g,instance:x}=p.groups[f],{ids:S,instance:I}=h.groups[f];if(x!==I||!Se.areEqual(g,S))return!1}return!0}d.areLociEqual=o;function i(p){return a(p)===0}d.isLociEmpty=i;function a(p){let h=0;for(let f of p.groups)h+=Se.size(f.ids);return h}d.size=a;let s=new cu,l=b.zero();function u(p,h,f,y){let{indices:g,offsets:x}=h;for(let{ids:S,instance:I}of p)Se.forEach(S,v=>{for(let A=x[v],_=x[v+1];A<_;++A)b.fromArray(l,f,g[A]*3),b.transformMat4(l,l,y[I]),s.includeStep(l)})}function c(p,h,f,y){let{indices:g,offsets:x}=h;for(let{ids:S,instance:I}of p)Se.forEach(S,v=>{for(let A=x[v],_=x[v+1];A<_;++A)b.fromArray(l,f,g[A]*3),b.transformMat4(l,l,y[I]),s.radiusStep(l)})}function m(p,h){h||(h=ye()),s.reset();let f=0,{geometry:y,transforms:g}=p.shape;if(y.kind==="mesh"||y.kind==="points"){let x=y.kind==="mesh"?y.vertexBuffer.ref.value:y.centerBuffer.ref.value;u(p.groups,y.groupMapping,x,g),s.finishedIncludeStep(),c(p.groups,y.groupMapping,x,g)}else if(y.kind==="lines"){let x=y.startBuffer.ref.value,S=y.endBuffer.ref.value;u(p.groups,y.groupMapping,x,g),u(p.groups,y.groupMapping,S,g),s.finishedIncludeStep(),c(p.groups,y.groupMapping,x,g),c(p.groups,y.groupMapping,S,g)}else if(y.kind==="spheres"||y.kind==="text"){let x=y.centerBuffer.ref.value;u(p.groups,y.groupMapping,x,g),s.finishedIncludeStep(),c(p.groups,y.groupMapping,x,g);for(let{ids:S,instance:I}of p.groups)Se.forEach(S,v=>{let A=p.shape.getSize(v,I);f<A&&(f=A)})}else return ye.copy(h,y.boundingSphere);return b.copy(h.center,s.center),h.radius=Math.sqrt(s.radiusSq),ye.expand(h,h,f),h}d.getBoundingSphere=m})(js||={});var eXe=13421772,tXe="Assigns colors as defined by the shape object.",Xhe={};function rXe(e){return Xhe}function qB(e,t){return{factory:qB,granularity:"groupInstance",color:r=>js.isLocation(r)?r.shape.getColor(r.group,r.instance):eXe,props:t,description:tXe}}var Qhe={name:"shape-group",label:"Shape Group",category:ur.Misc,factory:qB,getParams:rXe,defaultValues:C.getDefaultValues(Xhe),isApplicable:e=>!!e.shape};var nXe=16777113,oXe="Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",YB={domain:C.Interval([0,100]),list:C.ColorList("red-white-blue",{presetKind:"scale"})};function iXe(e){return YB}function Zhe(e,t){return me.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):me.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}function KB(e,t){let r;t.list.kind==="set"?r=Ba.createDiscrete({reverse:!0,domain:t.domain,listOrName:t.list.colors}):r=Ba.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});function n(o){return K.Location.is(o)?r.color(Zhe(o.unit,o.element)):Ct.isLocation(o)?r.color(Zhe(o.aUnit,o.aUnit.elements[o.aIndex])):nXe}return{factory:KB,granularity:"group",preferSmoothing:!0,color:n,props:t,description:oXe,legend:r?r.legend:void 0}}var qhe={name:"uncertainty",label:"Uncertainty/Disorder",category:ur.Atom,factory:KB,getParams:iXe,defaultValues:C.getDefaultValues(YB),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined)};var aXe=15658734,sXe="Assigns an illustrative color that gives every chain a color based on the chosen style but with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",Yhe={style:C.MappedStatic("entity-id",{uniform:C.Group(my),"chain-id":C.Group(Ch),"entity-id":C.Group(vh),"entity-source":C.Group(Ah),"molecule-type":C.Group(Sx),"model-index":C.Group(Ph),"structure-index":C.Group(Rh),"trajectory-index":C.Group(xx)}),carbonLightness:C.Numeric(.8,{min:-6,max:6,step:.1})};function lXe(e){return C.clone(Yhe)}function uXe(e,t){switch(t.name){case"uniform":return cf(e,t.params);case"chain-id":return Sh(e,t.params);case"entity-id":return Ih(e,t.params);case"entity-source":return Th(e,t.params);case"molecule-type":return vx(e,t.params);case"model-index":return _h(e,t.params);case"structure-index":return Dh(e,t.params);case"trajectory-index":return Cx(e,t.params);default:Rr(t)}}function Khe(e,t){let{color:r,legend:n,contextHash:o}=uXe(e,t.style);function i(s,l){let u=r(s,!1);return l==="C"?Fe.lighten(u,t.carbonLightness):u}function a(s){if(K.Location.is(s)&&me.isAtomic(s.unit)){let l=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return i(s,l)}else if(Ct.isLocation(s)&&me.isAtomic(s.aUnit)){let l=s.aUnit.elements[s.aIndex],u=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(l);return i(s,u)}return aXe}return{factory:Khe,granularity:"group",preferSmoothing:!0,color:a,props:t,contextHash:o,description:sXe,legend:n}}var Jhe={name:"illustrative",label:"Illustrative",category:ur.Misc,factory:Khe,getParams:lXe,defaultValues:C.getDefaultValues(Yhe),isApplicable:e=>!!e.structure};var cXe='Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',JB={list:C.ColorList("red-yellow-green",{presetKind:"scale"}),scale:C.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])};function mXe(e){return JB}var dXe={DGwif:0,DGwoct:1,"Oct-IF":2};function pXe(e,t){let r=aM[e];return r===void 0?0:r[t]}function $he(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function ege(e,t){let r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){let o=e.coarseElements.entityKey[t];return e.model.sequence.byEntityKey[o].sequence.compId.value(r-1)}}function $B(e,t){let r=dXe[t.scale],n=1/0,o=-1/0;for(let s in aM){let l=aM[s][r];n=Math.min(n,l),o=Math.max(o,l)}let i=Ba.create({listOrName:t.list.colors,domain:[o,n],minLabel:"Hydrophilic",maxLabel:"Hydrophobic"});function a(s){let l;return K.Location.is(s)?me.isAtomic(s.unit)?l=$he(s.unit,s.element):l=ege(s.unit,s.element):Ct.isLocation(s)&&(me.isAtomic(s.aUnit)?l=$he(s.aUnit,s.aUnit.elements[s.aIndex]):l=ege(s.aUnit,s.aUnit.elements[s.aIndex])),i.color(l?pXe(l,r):0)}return{factory:$B,granularity:"group",preferSmoothing:!0,color:a,props:t,description:cXe,legend:i?i.legend:void 0}}var tge={name:"hydrophobicity",label:"Hydrophobicity",category:ur.Residue,factory:$B,getParams:mXe,defaultValues:C.getDefaultValues(JB),isApplicable:e=>!!e.structure};var fXe=13421772,hXe="Assigns a color based on the occupancy of an atom.",ek={domain:C.Interval([0,1]),list:C.ColorList("purples",{presetKind:"scale"})};function gXe(e){return ek}function rge(e,t){return me.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}function tk(e,t){let r=Ba.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});function n(o){return K.Location.is(o)?r.color(rge(o.unit,o.element)):Ct.isLocation(o)?r.color(rge(o.aUnit,o.aUnit.elements[o.aIndex])):fXe}return{factory:tk,granularity:"group",preferSmoothing:!0,color:n,props:t,description:hXe,legend:r?r.legend:void 0}}var nge={name:"occupancy",label:"Occupancy",category:ur.Atom,factory:tk,getParams:gXe,defaultValues:C.getDefaultValues(ek),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicConformation.occupancy.isDefined)};var r7="dark-2",oge=13421772,yXe="Assigns a color based on the operator HKL value of a transformed chain.",ige={...Ho({type:"colors",colorList:r7})};function bXe(e){let t=C.clone(ige);return e.structure&&age(e.structure.root).map.size>lr[r7].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:Ma(r7).list}}),t}var p_=1e4;function n7(e){return e.map(t=>`${t+p_}`.padStart(5,"0")).join("")}function o7(e){let t=sle(p_,0),r=parseInt(e.substr(0,t)),n=parseInt(e.substr(t,t)),o=parseInt(e.substr(t+t,t));return b.create(r-p_,n-p_,o-p_)}function t7(e){return e.map(t=>t+5).join("")}function age(e){let t=new Map,r=new Set;for(let a=0,s=e.units.length;a<s;++a){let l=n7(e.units[a].conformation.operator.hkl);r.add(l)}let n=Array.from(r.values()).sort();n.forEach(a=>t.set(a,t.size));let o=o7(n[0]),i=o7(n[n.length-1]);return{min:o,max:i,map:t}}function sge(e,t){let r,n;if(e.structure){let{min:o,max:i,map:a}=age(e.structure.root),s=[];a.forEach((c,m)=>{let d=c%a.size,p=t7(o7(m));s[d]===void 0?s[d]=p:s[d]+=`, ${p}`});let l={minLabel:t7(o),maxLabel:t7(i),valueLabel:c=>s[c]},u=Jo(a.size,t,l);n=u.legend,r=c=>{let m;if(K.Location.is(c)){let d=n7(c.unit.conformation.operator.hkl);m=a.get(d)}else if(Ct.isLocation(c)){let d=n7(c.aUnit.conformation.operator.hkl);m=a.get(d)}return m===void 0?oge:u.color(m)}}else r=()=>oge;return{factory:sge,granularity:"instance",color:r,props:t,description:yXe,legend:n}}var lge={name:"operator-hkl",label:"Operator HKL",category:ur.Symmetry,factory:sge,getParams:bXe,defaultValues:C.getDefaultValues(ige),isApplicable:e=>!!e.structure};var kh;(r=>(r.Descriptor={name:"atom_partial_charge"},r.Provider=ll.create(r.Descriptor)))(kh||={});var i7=16777113,xXe="Assigns a color based on the partial charge of an atom.",rk={domain:C.Interval([-1,1]),list:C.ColorList("red-white-blue",{presetKind:"scale"})};function CXe(e){return rk}function uge(e,t){return kh.Provider.get(e.model)?.data.value(t)}function nk(e,t){let r=Ba.create({domain:t.domain,listOrName:t.list.colors});function n(o){if(K.Location.is(o)){let i=uge(o.unit,o.element);return i!==void 0?r.color(i):i7}else if(Ct.isLocation(o)){let i=uge(o.aUnit,o.aUnit.elements[o.aIndex]);return i!==void 0?r.color(i):i7}return i7}return{factory:nk,granularity:"group",preferSmoothing:!0,color:n,props:t,description:xXe,legend:r?r.legend:void 0}}var cge={name:"partial-charge",label:"Partial Charge",category:ur.Atom,factory:nk,getParams:CXe,defaultValues:C.getDefaultValues(rk),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>kh.Provider.get(t)!==void 0)};var SXe="many-distinct",mge=16448250,vXe="Gives every atom a color based on its `label_atom_id` value.",dge={...Ho({type:"colors",colorList:SXe})};function IXe(e){return C.clone(dge)}function AXe(e){let t=new Map;for(let r of e.models){let{label_atom_id:n}=r.atomicHierarchy.atoms;for(let o=0,i=n.rowCount;o<i;++o){let a=n.value(o);t.has(a)||t.set(a,t.size)}}return t}function pge(e,t){let r,n;if(e.structure){let o=K.Location.create(e.structure.root),i=AXe(e.structure.root),a=Array.from(i.keys()),s=u=>a[u],l=Jo(i.size,t,{valueLabel:s});n=l.legend,r=u=>{let c;if(K.Location.is(u)){let m=qe.atom.label_atom_id(u);c=i.get(m)}else if(Ct.isLocation(u)){o.unit=u.aUnit,o.element=u.aUnit.elements[u.aIndex];let m=qe.atom.label_atom_id(o);c=i.get(m)}return c===void 0?mge:l.color(c)}}else r=()=>mge;return{factory:pge,granularity:"group",preferSmoothing:!0,color:r,props:t,description:vXe,legend:n}}var fge={name:"atom-id",label:"Atom Id",category:ur.Atom,factory:pge,getParams:IXe,defaultValues:C.getDefaultValues(dge),isApplicable:e=>!!e.structure};var a7="Assign color based on the given value of a volume cell.",hge={colorList:C.ColorList({kind:"interpolate",colors:[[Lt.white,0],[Lt.red,.25],[Lt.white,.5],[Lt.blue,.75],[Lt.white,1]]},{offsets:!0,isEssential:!0}),domain:C.MappedStatic("auto",{custom:C.Interval([-1,1],{step:.001}),auto:C.Group({symmetric:C.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),isRelative:C.Boolean(!1,{description:"If true the value is treated as relative to the volume mean and sigma."}),defaultColor:C.Color(13421772)};function TXe(e){return hge}function ok(e,t){if(e.volume){let{min:r,max:n,mean:o,sigma:i}=e.volume.grid.stats,a=t.domain.name==="custom"?t.domain.params:[r,n],{colorList:s,defaultColor:l}=t;if(t.domain.name==="auto"&&t.isRelative&&(a[0]=(a[0]-o)/i,a[1]=(a[1]-o)/i),t.domain.name==="auto"&&t.domain.params.symmetric){let u=Math.max(Math.abs(a[0]),Math.abs(a[1]));a[0]=-u,a[1]=u}if(e.locationKinds?.includes("direct-location")){let u=[Qp(a[0],r,n),Qp(a[1],r,n)],c=as.Palette(s.colors,s.kind,u,l);return{factory:ok,granularity:"direct",props:t,description:a7,palette:c}}else{let u=Xn.makeGetTrilinearlyInterpolated(e.volume.grid,"none"),c=d=>{if(!iI(d))return t.defaultColor;let p=u(d.position);return isNaN(p)?t.defaultColor:Br((p-a[0])/(a[1]-a[0]),0,1)*as.PaletteScale},m=as.Palette(s.colors,s.kind,void 0,l);return{factory:ok,granularity:"vertex",preferSmoothing:!0,color:c,palette:m,props:t,description:a7}}}else return{factory:ok,granularity:"uniform",color:()=>t.defaultColor,props:t,description:a7}}var gge={name:"volume-value",label:"Volume Value",category:ur.Misc,factory:ok,getParams:TXe,defaultValues:C.getDefaultValues(hge),isApplicable:e=>!!e.volume&&!Ve.Segmentation.get(e.volume)};var yge=13421772,PXe="Gives every volume segment a unique color.",bge={...Ho({type:"colors",colorList:"many-distinct"})};function _Xe(e){return C.clone(bge)}function xge(e,t){let r,n,o=e.volume&&Ve.Segmentation.get(e.volume);if(o){let i=o.segments.size,a=Array.from(o.segments.keys()),s=Jo(i,t);n=s.legend,r=l=>Ve.Segment.isLocation(l)?s.color(a.indexOf(l.segment)):yge}else r=()=>yge;return{factory:xge,granularity:"instance",color:r,props:t,description:PXe,legend:n}}var Cge={name:"volume-segment",label:"Volume Segment",category:ur.Misc,factory:xge,getParams:_Xe,defaultValues:C.getDefaultValues(bge),isApplicable:e=>!!e.volume&&!!Ve.Segmentation.get(e.volume)};var RXe="Assigns a color based on volume value at a given vertex.",Sge={volume:C.ValueRef(e=>e.state.data.selectQ(r=>r.root.subtree().filter(n=>Ve.is(n.obj?.data))).map(r=>[r.transform.ref,r.obj?.label??"<unknown>"]),(e,t)=>t(e)),coloring:C.MappedStatic("absolute-value",{"absolute-value":C.Group({domain:C.MappedStatic("auto",{custom:C.Interval([-1,1],{step:.001}),auto:C.Group({symmetric:C.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:C.ColorList("red-white-blue",{presetKind:"scale"})}),"relative-value":C.Group({domain:C.MappedStatic("auto",{custom:C.Interval([-1,1],{step:.001}),auto:C.Group({symmetric:C.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:C.ColorList("red-white-blue",{presetKind:"scale"})})}),defaultColor:C.Color(13421772),normalOffset:C.Numeric(0,{min:0,max:20,step:.1},{description:"Offset vertex position along its normal by given amount."}),usePalette:C.Boolean(!1,{description:"Use a palette to color at the pixel level."})};function vge(e,t){let r;try{r=t.volume.getValue()}catch{}let n,o,{normalOffset:i,defaultColor:a,usePalette:s}=t;if(r){let l=t.coloring.params,{stats:u}=r.grid,c=l.domain.name==="custom"?l.domain.params:[u.min,u.max],m=t.coloring.name==="relative-value";if(l.domain.name==="auto"&&m&&(c[0]=(c[0]-u.mean)/u.sigma,c[1]=(c[1]-u.mean)/u.sigma),l.domain.name==="auto"&&l.domain.params.symmetric){let f=Math.max(Math.abs(c[0]),Math.abs(c[1]));c[0]=-f,c[1]=f}let d=Ba.create({domain:c,listOrName:l.list.colors}),p=b(),h=Xn.makeGetTrilinearlyInterpolated(r.grid,m?"relative":"none");n=f=>{if(!iI(f))return a;i>0?b.scaleAndAdd(p,f.position,f.normal,i):b.copy(p,f.position);let y=h(p);return isNaN(y)?a:s?Br((y-c[0])/(c[1]-c[0]),0,1)*as.PaletteScale:d.color(y)},o=s?{colors:l.list.colors.map(f=>Array.isArray(f)?f[0]:f),filter:l.list.kind==="set"?"nearest":"linear"}:void 0}else n=()=>a;return{factory:vge,granularity:"vertex",preferSmoothing:!0,color:n,palette:o,props:t,description:RXe}}var Ige={name:"external-volume",label:"External Volume",category:ur.Misc,factory:vge,getParams:()=>Sge,defaultValues:C.getDefaultValues(Sge),isApplicable:e=>!0};var DXe="Uses separate themes for coloring mainchain and sidechain visuals.",Age={mainchain:C.MappedStatic("molecule-type",{uniform:C.Group(my),"chain-id":C.Group(Ch),"entity-id":C.Group(vh),"entity-source":C.Group(Ah),"molecule-type":C.Group(Sx),"model-index":C.Group(Ph),"structure-index":C.Group(Rh),"secondary-structure":C.Group(CB),"trajectory-index":C.Group(xx)}),sidechain:C.MappedStatic("residue-name",{uniform:C.Group(my),"residue-name":C.Group(bB),"element-symbol":C.Group(hB),hydrophobicity:C.Group(JB),uncertainty:C.Group(YB),occupancy:C.Group(ek),"sequence-id":C.Group(vB),"partial-charge":C.Group(rk)})};function wXe(e){return C.clone(Age)}function EXe(e,t){switch(t.name){case"uniform":return cf(e,t.params);case"chain-id":return Sh(e,t.params);case"entity-id":return Ih(e,t.params);case"entity-source":return Th(e,t.params);case"molecule-type":return vx(e,t.params);case"model-index":return _h(e,t.params);case"structure-index":return Dh(e,t.params);case"secondary-structure":return SB(e,t.params);case"trajectory-index":return Cx(e,t.params);default:Rr(t)}}function MXe(e,t){switch(t.name){case"uniform":return cf(e,t.params);case"residue-name":return xB(e,t.params);case"element-symbol":return gB(e,t.params);case"hydrophobicity":return $B(e,t.params);case"uncertainty":return KB(e,t.params);case"occupancy":return tk(e,t.params);case"sequence-id":return IB(e,t.params);case"partial-charge":return nk(e,t.params);default:Rr(t)}}function Tge(e,t){let r=EXe(e,t.mainchain),n=MXe(e,t.sidechain),o=Du(r.contextHash??0,n.contextHash??0);function i(s,l){return l?r.color(s,!1):n.color(s,!1)}let a=r.legend;return r.legend?.kind==="table-legend"&&n.legend?.kind==="table-legend"&&(a={kind:"table-legend",table:[...r.legend.table,...n.legend.table]}),{factory:Tge,granularity:"group",preferSmoothing:!1,color:i,props:t,contextHash:o,description:DXe,legend:a}}var Pge={name:"cartoon",label:"Cartoon",category:ur.Misc,factory:Tge,getParams:wXe,defaultValues:C.getDefaultValues(Age),isApplicable:e=>!!e.structure};var s7=16777113,BXe="Assigns a color based on the formal charge of an atom.",Rge={domain:C.Interval([-3,3]),list:C.ColorList({kind:"set",colors:lr["red-white-blue"].list})};function kXe(e){return Rge}function _ge(e,t){return me.isAtomic(e)?e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(t):0}function Dge(e,t){let r=Ba.create({domain:t.domain,listOrName:t.list.colors});function n(o){if(K.Location.is(o)){let i=_ge(o.unit,o.element);return i!==void 0?r.color(i):s7}else if(Ct.isLocation(o)){let i=_ge(o.aUnit,o.aUnit.elements[o.aIndex]);return i!==void 0?r.color(i):s7}return s7}return{factory:Dge,granularity:"group",preferSmoothing:!0,color:n,props:t,description:BXe,legend:r?r.legend:void 0}}var wge={name:"formal-charge",label:"Formal Charge",category:ur.Atom,factory:Dge,getParams:kXe,defaultValues:C.getDefaultValues(Rge),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicHierarchy.atoms.pdbx_formal_charge.isDefined)};var kr=X0.Const,cr=X0.Dynamic,LXe=[kr(Te.core.type.bool,function(t,r){return!!r[0](t)}),kr(Te.core.type.num,function(t,r){return+r[0](t)}),kr(Te.core.type.str,function(t,r){return""+r[0](t)}),kr(Te.core.type.list,function(t,r){return Y2.forEachEval(r,t,(n,o,i)=>i[o]=n,[])}),kr(Te.core.type.set,function(t,r){return Y2.forEachEval(r,t,function(o,i,a){return a.add(o)},new Set)}),kr(Te.core.type.regex,function(t,r){return new RegExp(r[0](t),r[1]&&r[1](t)||"")}),kr(Te.core.type.bitflags,function(t,r){return+r[0](t)}),kr(Te.core.type.compositeKey,function(t,r){return Y2.forEachEval(r,t,(n,o,i)=>i[o]=""+n,[]).join("-")}),kr(Te.core.logic.not,(e,t)=>!t[0](e)),kr(Te.core.logic.and,(e,t)=>{if(typeof t.length=="number"){for(let r=0,n=t.length;r<n;r++)if(!t[r](e))return!1}else for(let r of Object.keys(t))if(!t[r](e))return!1;return!0}),kr(Te.core.logic.or,(e,t)=>{if(typeof t.length=="number"){for(let r=0,n=t.length;r<n;r++)if(t[r](e))return!0}else for(let r of Object.keys(t))if(t[r](e))return!0;return!1}),kr(Te.core.rel.eq,(e,t)=>t[0](e)===t[1](e)),kr(Te.core.rel.neq,(e,t)=>t[0](e)!==t[1](e)),kr(Te.core.rel.lt,(e,t)=>t[0](e)<t[1](e)),kr(Te.core.rel.lte,(e,t)=>t[0](e)<=t[1](e)),kr(Te.core.rel.gr,(e,t)=>t[0](e)>t[1](e)),kr(Te.core.rel.gre,(e,t)=>t[0](e)>=t[1](e)),kr(Te.core.rel.inRange,(e,t)=>{let r=t[0](e);return r>=t[1](e)&&r<=t[2](e)}),kr(Te.core.math.add,(e,t)=>{let r=0;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r+=t[n](e);else for(let n of Object.keys(t))r+=t[n](e);return r}),kr(Te.core.math.sub,(e,t)=>{let r=0;if(typeof t.length=="number"){if(t.length===1)return-t[0](e);r=t[0](e)||0;for(let n=1,o=t.length;n<o;n++)r-=t[n](e)}else{let n=Object.keys(t);if(n.length===1)return-t[n[0]](e);r=t[n[0]](e)||0;for(let o=1,i=n.length;o<i;o++)r-=t[n[o]](e)}return r}),kr(Te.core.math.mult,(e,t)=>{let r=1;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r*=t[n](e);else for(let n of Object.keys(t))r*=t[n](e);return r}),kr(Te.core.math.div,(e,t)=>t[0](e)/t[1](e)),kr(Te.core.math.pow,(e,t)=>Math.pow(t[0](e),t[1](e))),kr(Te.core.math.mod,(e,t)=>t[0](e)%t[1](e)),kr(Te.core.math.min,(e,t)=>{let r=Number.POSITIVE_INFINITY;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r=Math.min(t[n](e),r);else for(let n of Object.keys(t))r=Math.min(t[n](e),r);return r}),kr(Te.core.math.max,(e,t)=>{let r=Number.NEGATIVE_INFINITY;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r=Math.max(t[n](e),r);else for(let n of Object.keys(t))r=Math.max(t[n](e),r);return r}),kr(Te.core.math.cantorPairing,(e,t)=>Xi(t[0](e),t[1](e))),kr(Te.core.math.sortedCantorPairing,(e,t)=>cc(t[0](e),t[1](e))),kr(Te.core.math.invertCantorPairing,(e,t)=>N1([0,0],t[0](e))),kr(Te.core.math.floor,(e,t)=>Math.floor(t[0](e))),kr(Te.core.math.ceil,(e,t)=>Math.ceil(t[0](e))),kr(Te.core.math.roundInt,(e,t)=>Math.round(t[0](e))),kr(Te.core.math.trunc,(e,t)=>Math.trunc(t[0](e))),kr(Te.core.math.abs,(e,t)=>Math.abs(t[0](e))),kr(Te.core.math.sign,(e,t)=>Math.sign(t[0](e))),kr(Te.core.math.sqrt,(e,t)=>Math.sqrt(t[0](e))),kr(Te.core.math.cbrt,(e,t)=>Math.cbrt(t[0](e))),kr(Te.core.math.sin,(e,t)=>Math.sin(t[0](e))),kr(Te.core.math.cos,(e,t)=>Math.cos(t[0](e))),kr(Te.core.math.tan,(e,t)=>Math.tan(t[0](e))),kr(Te.core.math.asin,(e,t)=>Math.asin(t[0](e))),kr(Te.core.math.acos,(e,t)=>Math.acos(t[0](e))),kr(Te.core.math.atan,(e,t)=>Math.atan(t[0](e))),kr(Te.core.math.sinh,(e,t)=>Math.sinh(t[0](e))),kr(Te.core.math.cosh,(e,t)=>Math.cosh(t[0](e))),kr(Te.core.math.tanh,(e,t)=>Math.tanh(t[0](e))),kr(Te.core.math.exp,(e,t)=>Math.exp(t[0](e))),kr(Te.core.math.log,(e,t)=>Math.log(t[0](e))),kr(Te.core.math.log10,(e,t)=>Math.log10(t[0](e))),kr(Te.core.math.atan2,(e,t)=>Math.atan2(t[0](e),t[1](e))),kr(Te.core.str.match,(e,t)=>t[0](e).test(t[1](e))),kr(Te.core.str.concat,(e,t)=>{let r=[];if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r.push(t[n](e).toString());else for(let n of Object.keys(t))r.push(t[n](e).toString());return r.join("")}),kr(Te.core.list.getAt,(e,t)=>t[0](e)[t[1](e)]),kr(Te.core.list.equal,(e,t)=>kC(t[0](e),t[1](e))),kr(Te.core.set.has,function(t,r){return r[0](t).has(r[1](t))}),kr(Te.core.set.isSubset,function(t,r){return no.isSuperset(r[1](t),r[0](t))}),kr(Te.core.flags.hasAny,(e,t)=>{let r=t[1](e),n=t[0](e);return r?(n&r)!==0:!!n}),kr(Te.core.flags.hasAll,(e,t)=>{let r=t[1](e),n=t[0](e);return r?(n&r)===r:!n}),kr(Te.structureQuery.type.elementSymbol,(e,t)=>of(t[0](e))),kr(Te.structureQuery.type.atomName,(e,t)=>aee(t[0](e))),kr(Te.structureQuery.type.bondFlags,(e,t)=>{let r=ht.Flag.None;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r=Ege(r,t[n](e));else for(let n of Object.keys(t))r=Ege(r,t[n](e));return r}),kr(Te.structureQuery.type.ringFingerprint,(e,t)=>Jm.elementFingerprint(FXe(e,t))),kr(Te.structureQuery.type.secondaryStructureFlags,(e,t)=>{let r=Kt.Flag.None;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r=Mge(r,t[n](e));else for(let n of Object.keys(t))r=Mge(r,t[n](e));return r}),cr(Te.structureQuery.filter.pick,(e,t)=>Fn.filters.pick(t[0],t.test)(e)),cr(Te.structureQuery.filter.first,(e,t)=>Fn.filters.first(t[0])(e)),cr(Te.structureQuery.filter.withSameAtomProperties,(e,t)=>Fn.filters.withSameAtomProperties(t[0],t.source,t.property)(e)),cr(Te.structureQuery.filter.intersectedBy,(e,t)=>Fn.filters.areIntersectedBy(t[0],t.by)(e)),cr(Te.structureQuery.filter.within,(e,t)=>Fn.filters.within({query:t[0],target:t.target,minRadius:t["min-radius"]?.(e),maxRadius:t["max-radius"]?.(e),elementRadius:t["atom-radius"],invert:t.invert?.(e)})(e)),cr(Te.structureQuery.filter.isConnectedTo,(e,t)=>Fn.filters.isConnectedTo({query:t[0],target:t.target,disjunct:t.disjunct?.(e),invert:t.invert?.(e),bondTest:t["bond-test"]})(e)),cr(Te.structureQuery.generator.atomGroups,function(t,r){return Fn.generators.atoms({entityTest:r["entity-test"],chainTest:r["chain-test"],residueTest:r["residue-test"],atomTest:r["atom-test"],groupBy:r["group-by"]})(t)}),cr(Te.structureQuery.generator.all,function(t){return Fn.generators.all(t)}),cr(Te.structureQuery.generator.empty,function(t){return Fn.generators.none(t)}),cr(Te.structureQuery.generator.bondedAtomicPairs,function(t,r){return Fn.generators.bondedAtomicPairs(r&&r[0])(t)}),cr(Te.structureQuery.generator.rings,function(t,r){return Fn.generators.rings(r?.fingerprint?.(t),r?.["only-aromatic"]?.(t))(t)}),cr(Te.structureQuery.generator.queryInSelection,function(t,r){return Fn.generators.querySelection(r[0],r.query,r["in-complement"]?.(t))(t)}),cr(Te.structureQuery.modifier.includeSurroundings,function(t,r){return Fn.modifiers.includeSurroundings(r[0],{radius:r.radius(t),wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),elementRadius:r["atom-radius"]})(t)}),cr(Te.structureQuery.modifier.surroundingLigands,function(t,r){return Fn.modifiers.surroundingLigands({query:r[0],radius:r.radius(t),includeWater:!!(r["include-water"]&&r["include-water"](t))})(t)}),cr(Te.structureQuery.modifier.wholeResidues,function(t,r){return Fn.modifiers.wholeResidues(r[0])(t)}),cr(Te.structureQuery.modifier.union,function(t,r){return Fn.modifiers.union(r[0])(t)}),cr(Te.structureQuery.modifier.expandProperty,function(t,r){return Fn.modifiers.expandProperty(r[0],r.property)(t)}),cr(Te.structureQuery.modifier.exceptBy,function(t,r){return Fn.modifiers.exceptBy(r[0],r.by)(t)}),cr(Te.structureQuery.modifier.includeConnected,function(t,r){return Fn.modifiers.includeConnected({query:r[0],bondTest:r["bond-test"],wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),layerCount:r["layer-count"]&&r["layer-count"](t)||1,fixedPoint:r["fixed-point"]?.(t)??!1})(t)}),cr(Te.structureQuery.modifier.intersectBy,function(t,r){return Fn.modifiers.intersectBy(r[0],r.by)(t)}),cr(Te.structureQuery.combinator.merge,(e,t)=>Fn.combinators.merge(t)(e)),cr(Te.structureQuery.atomProperty.core.elementSymbol,Bo(qe.atom.type_symbol)),cr(Te.structureQuery.atomProperty.core.vdw,(e,t)=>hh(qe.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),cr(Te.structureQuery.atomProperty.core.mass,(e,t)=>kle(qe.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),cr(Te.structureQuery.atomProperty.core.atomicNumber,(e,t)=>sx(qe.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),cr(Te.structureQuery.atomProperty.core.x,Bo(qe.atom.x)),cr(Te.structureQuery.atomProperty.core.y,Bo(qe.atom.y)),cr(Te.structureQuery.atomProperty.core.z,Bo(qe.atom.z)),cr(Te.structureQuery.atomProperty.core.sourceIndex,Bo(qe.atom.sourceIndex)),cr(Te.structureQuery.atomProperty.core.operatorName,Bo(qe.unit.operator_name)),cr(Te.structureQuery.atomProperty.core.instanceId,Bo(qe.unit.instance_id)),cr(Te.structureQuery.atomProperty.core.operatorKey,Bo(qe.unit.operator_key)),cr(Te.structureQuery.atomProperty.core.modelIndex,Bo(qe.unit.model_index)),cr(Te.structureQuery.atomProperty.core.modelLabel,Bo(qe.unit.model_label)),cr(Te.structureQuery.atomProperty.core.atomKey,(e,t)=>{let r=t&&t[0]&&t[0](e)||e.element;return Xi(r.unit.id,r.element)}),cr(Te.structureQuery.atomProperty.macromolecular.residueKey,(e,t)=>K.residueIndex(t&&t[0]&&t[0](e)||e.element)),cr(Te.structureQuery.atomProperty.macromolecular.chainKey,(e,t)=>K.chainIndex(t&&t[0]&&t[0](e)||e.element)),cr(Te.structureQuery.atomProperty.macromolecular.entityKey,(e,t)=>K.entityIndex(t&&t[0]&&t[0](e)||e.element)),cr(Te.structureQuery.atomProperty.macromolecular.id,Bo(qe.atom.id)),cr(Te.structureQuery.atomProperty.macromolecular.isHet,(e,t)=>qe.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)!=="ATOM"),cr(Te.structureQuery.atomProperty.macromolecular.label_atom_id,Bo(qe.atom.label_atom_id)),cr(Te.structureQuery.atomProperty.macromolecular.label_alt_id,Bo(qe.atom.label_alt_id)),cr(Te.structureQuery.atomProperty.macromolecular.label_comp_id,Bo(qe.atom.label_comp_id)),cr(Te.structureQuery.atomProperty.macromolecular.label_seq_id,Bo(qe.residue.label_seq_id)),cr(Te.structureQuery.atomProperty.macromolecular.label_asym_id,Bo(qe.chain.label_asym_id)),cr(Te.structureQuery.atomProperty.macromolecular.label_entity_id,Bo(qe.entity.id)),cr(Te.structureQuery.atomProperty.macromolecular.auth_atom_id,Bo(qe.atom.auth_atom_id)),cr(Te.structureQuery.atomProperty.macromolecular.auth_comp_id,Bo(qe.atom.auth_comp_id)),cr(Te.structureQuery.atomProperty.macromolecular.auth_seq_id,Bo(qe.residue.auth_seq_id)),cr(Te.structureQuery.atomProperty.macromolecular.auth_asym_id,Bo(qe.chain.auth_asym_id)),cr(Te.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,Bo(qe.residue.pdbx_PDB_ins_code)),cr(Te.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,Bo(qe.atom.pdbx_formal_charge)),cr(Te.structureQuery.atomProperty.macromolecular.occupancy,Bo(qe.atom.occupancy)),cr(Te.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,Bo(qe.atom.B_iso_or_equiv)),cr(Te.structureQuery.atomProperty.macromolecular.entityType,Bo(qe.entity.type)),cr(Te.structureQuery.atomProperty.macromolecular.entitySubtype,Bo(qe.entity.subtype)),cr(Te.structureQuery.atomProperty.macromolecular.entityPrdId,Bo(qe.entity.prd_id)),cr(Te.structureQuery.atomProperty.macromolecular.entityDescription,Bo(qe.entity.pdbx_description)),cr(Te.structureQuery.atomProperty.macromolecular.objectPrimitive,Bo(qe.unit.object_primitive)),cr(Te.structureQuery.atomProperty.macromolecular.isNonStandard,Bo(qe.residue.isNonStandard)),cr(Te.structureQuery.atomProperty.macromolecular.secondaryStructureKey,Bo(qe.residue.secondary_structure_key)),cr(Te.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,Bo(qe.residue.secondary_structure_type)),cr(Te.structureQuery.atomProperty.macromolecular.chemCompType,Bo(qe.residue.chem_comp_type)),cr(Te.structureQuery.atomProperty.ihm.hasSeqId,function(t,r){let n=t.element,o=r&&r[0]&&r[0](t);return n.unit.kind===me.Kind.Atomic?o===qe.residue.label_seq_id(n):o>=qe.coarse.seq_id_begin(n)&&o<=qe.coarse.seq_id_end(n)}),cr(Te.structureQuery.atomProperty.ihm.overlapsSeqIdRange,function(t,r){let n=t.element,o=(r&&r.beg&&r.beg(t))??-Number.MAX_VALUE,i=(r&&r.end&&r.end(t))??Number.MAX_VALUE;if(n.unit.kind===me.Kind.Atomic){let l=qe.residue.label_seq_id(n);return l>=o&&l<=i}let a=qe.coarse.seq_id_begin(n),s=qe.coarse.seq_id_end(n);return a>=o&&a<=i||s>=o&&s<=i||a<=o&&s>=i}),cr(Te.structureQuery.atomSet.atomCount,function(t,r){return Fn.atomset.atomCount(t)}),cr(Te.structureQuery.atomSet.countQuery,function(t,r){return Fn.atomset.countQuery(r[0])(t)}),cr(Te.structureQuery.atomSet.propertySet,function(t,r){return Fn.atomset.propertySet(r[0])(t)}),cr(Te.structureQuery.bondProperty.order,(e,t)=>e.atomicBond.order),cr(Te.structureQuery.bondProperty.flags,(e,t)=>e.atomicBond.type),cr(Te.structureQuery.bondProperty.key,(e,t)=>e.atomicBond.key),cr(Te.structureQuery.bondProperty.atomA,(e,t)=>e.atomicBond.a),cr(Te.structureQuery.bondProperty.atomB,(e,t)=>e.atomicBond.b),cr(Te.structureQuery.bondProperty.length,(e,t)=>e.atomicBond.length),cr(Te.internal.generator.bundleElement,function(t,r){return Y9(r.groupedUnits(t),r.ranges(t),r.set(t))}),cr(Te.internal.generator.bundle,function(t,r){return K9(r.elements(t))(t)}),cr(Te.internal.generator.current,function(t,r){return t.tryGetCurrentSelection()})];function Bo(e){return(t,r)=>e(r&&r[0]&&r[0](t)||t.element)}function Ege(e,t){return e|(ht.isName(t)?ht.fromName(t):ht.Flag.None)}function Mge(e,t){switch(t.toLowerCase()){case"helix":return e|Kt.Flag.Helix;case"alpha":return e|Kt.Flag.Helix|Kt.Flag.HelixAlpha;case"pi":return e|Kt.Flag.Helix|Kt.Flag.HelixPi;case"310":return e|Kt.Flag.Helix|Kt.Flag.Helix3Ten;case"beta":return e|Kt.Flag.Beta;case"strand":return e|Kt.Flag.Beta|Kt.Flag.BetaStrand;case"sheet":return e|Kt.Flag.Beta|Kt.Flag.BetaSheet;case"turn":return e|Kt.Flag.Turn;case"bend":return e|Kt.Flag.Bend;case"coil":return e|Kt.Flag.NA;default:return e}}function FXe(e,t){let r=[];if(!t)return r;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r.push(t[n](e));else{let n=Object.keys(t);for(let o=1,i=n.length;o<i;o++)r.push(t[n[o]](e))}return r}(function(){for(let e of LXe)Qv.addSymbol(e)})();var x7={};Bi(x7,{DeflateData:()=>UQe,Download:()=>$0,DownloadBlob:()=>f7,ImportJson:()=>YQe,ImportString:()=>qQe,LazyVolume:()=>JQe,ParseBlob:()=>NQe,ParseCcp4:()=>b7,ParseCif:()=>y7,ParseCube:()=>zQe,ParseDsn6:()=>QQe,ParseDx:()=>ZQe,ParseJson:()=>KQe,ParsePly:()=>XQe,ParsePrmtop:()=>jQe,ParsePsf:()=>HQe,ParseTop:()=>WQe,RawData:()=>h7,ReadFile:()=>g7});var dm;(s=>{function e(l){let u=new DataView(l.buffer);return Object.assign(l.subarray(0),{readInt8:c=>u.getInt8(c),readUInt8:c=>u.getUint8(c),writeInt8:(c,m)=>u.setInt8(m,c),writeUInt8:(c,m)=>u.setUint8(m,c),readInt16LE:c=>u.getInt16(c,!0),readInt32LE:c=>u.getInt32(c,!0),readUInt16LE:c=>u.getUint16(c,!0),readUInt32LE:c=>u.getUint32(c,!0),readFloatLE:c=>u.getFloat32(c,!0),readDoubleLE:c=>u.getFloat64(c,!0),writeInt16LE:(c,m)=>u.setInt16(m,c,!0),writeInt32LE:(c,m)=>u.setInt32(m,c,!0),writeUInt16LE:(c,m)=>u.setUint16(m,c,!0),writeUInt32LE:(c,m)=>u.setUint32(m,c,!0),writeFloatLE:(c,m)=>u.setFloat32(m,c,!0),writeDoubleLE:(c,m)=>u.setFloat64(m,c,!0),readInt16BE:c=>u.getInt16(c,!1),readInt32BE:c=>u.getInt32(c,!1),readUInt16BE:c=>u.getUint16(c,!1),readUInt32BE:c=>u.getUint32(c,!1),readFloatBE:c=>u.getFloat32(c,!1),readDoubleBE:c=>u.getFloat64(c,!1),writeInt16BE:(c,m)=>u.setInt16(m,c,!1),writeInt32BE:(c,m)=>u.setInt32(m,c,!1),writeUInt16BE:(c,m)=>u.setUint16(m,c,!1),writeUInt32BE:(c,m)=>u.setUint32(m,c,!1),writeFloatBE:(c,m)=>u.setFloat32(m,c,!1),writeDoubleBE:(c,m)=>u.setFloat64(m,c,!1),copy:(c,m,d,p)=>(m=Wi(m,0),d=Wi(d,0),p=Wi(p,l.length),c.set(l.subarray(d,p),m),p-d)})}s.fromUint8Array=e;function t(l){return e(new Uint8Array(l))}s.fromArrayBuffer=t;function r(l){return l}s.fromBuffer=r,s.IsNativeEndianLittle=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function o(l,u,c,m,d){for(let p=0,h=c;p<h;p+=m)for(let f=0;f<m;f++)u[d+p+m-f-1]=l[d+p+f]}s.flipByteOrder=o;function i(l,u=0,c){let m=new Int16Array(l,u,c);for(let d=0,p=m.length;d<p;++d){let h=m[d];m[d]=(h&255)<<8|h>>8&255}}s.flipByteOrderInPlace2=i;function a(l,u,c,m,d){s.IsNativeEndianLittle||!c||m<=1||o(l,u,c,m,d)}s.ensureLittleEndian=a})(dm||={});var f_;(t=>{function e(r,n){return{name:n,readBuffer:(o,i,a,s)=>{let l,u;if(typeof i=="number"){a=Wi(a,i);let c=o,m=Math.min(r.length,c+a);l=m-c,u=dm.fromUint8Array(new Uint8Array(r.buffer,c,m-c))}else{a=Wi(a,i.length);let c=o,m=Math.min(r.length,c+a);i.set(r.subarray(c,m),s),l=m-c,u=i}return a!==l&&console.warn(`byteCount ${a} and bytesRead ${l} differ`),Promise.resolve({bytesRead:l,buffer:u})},writeBuffer:(o,i,a)=>(a=Wi(a,i.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)),writeBufferSync:(o,i,a)=>(a=Wi(a,i.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0),close:iu}}t.fromBuffer=e})(f_||={});var Ul;(o=>(o.Float32="float32",o.Int8="int8",o.Int16="int16",o.Uint16="uint16"))(Ul||={});function l7(e){return e===Ul.Float32?4:e===Ul.Int16||e===Ul.Uint16?2:1}function VXe(e,t,r=0,n){return e===Ul.Float32?new Float32Array(t,r,n):e===Ul.Int16?new Int16Array(t,r,n):e===Ul.Uint16?new Uint16Array(t,r,n):new Int8Array(t,r,n)}function Bge(e,t){let r=l7(t),n=new ArrayBuffer(r*e),o=dm.fromArrayBuffer(n),i=dm.IsNativeEndianLittle?n:new ArrayBuffer(r*e);return{type:t,elementByteSize:r,readBuffer:o,valuesBuffer:new Uint8Array(i),values:VXe(t,i)}}async function kge(e,t,r,n,o,i){return await t.readBuffer(r,e.readBuffer,n,o),e.elementByteSize>1&&(i!==void 0&&i!==dm.IsNativeEndianLittle||!dm.IsNativeEndianLittle)&&dm.flipByteOrder(e.readBuffer,e.valuesBuffer,n,e.elementByteSize,o),e.values}async function OXe(e){let{buffer:r}=await e.readBuffer(0,1024),n=String.fromCharCode(r.readUInt8(52*4),r.readUInt8(52*4+1),r.readUInt8(52*4+2),r.readUInt8(52*4+3));if(n!=="MAP ")throw new Error('ccp4 format error, missing "MAP " string');let o=[r.readUInt8(53*4),r.readUInt8(53*4+1)],i=!1;o[0]===68&&o[1]===65?i=!0:o[0]===17&&o[1]===17?i=!1:r.readInt32LE(12)<=16&&(i=!0);let a=i?u=>r.readInt32LE(u*4):u=>r.readInt32BE(u*4),s=i?u=>r.readFloatLE(u*4):u=>r.readFloatBE(u*4);return{header:{NC:a(0),NR:a(1),NS:a(2),MODE:a(3),NCSTART:a(4),NRSTART:a(5),NSSTART:a(6),NX:a(7),NY:a(8),NZ:a(9),xLength:s(10),yLength:s(11),zLength:s(12),alpha:s(13),beta:s(14),gamma:s(15),MAPC:a(16),MAPR:a(17),MAPS:a(18),AMIN:s(19),AMAX:s(20),AMEAN:s(21),ISPG:a(22),NSYMBT:a(23),LSKFLG:a(24),SKWMAT:[],SKWTRN:[],userFlag1:a(39),userFlag2:a(40),originX:s(49),originY:s(50),originZ:s(51),MAP:n,MACHST:o,ARMS:s(54)},littleEndian:i}}async function GXe(e,t,r,n,o,i){if(Fge(e)){let a=3*o;await r.readBuffer(n,t.readBuffer,o,a);let s=new Int8Array(t.valuesBuffer.buffer,a),l=(e.AMAX-e.AMIN)/255,u=.5*(e.AMIN+e.AMAX+l);for(let c=0,m=o;c<m;++c)t.values[c]=l*s[c]+u}else await kge(t,r,n,o,0,i)}function Lge(e){switch(e){case 0:return Ul.Int8;case 1:return Ul.Int16;case 2:return Ul.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:Ul.Uint16;case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error(`unknown mode '${e}'`)}function Fge(e){return e.userFlag1===-128&&e.userFlag2===127}function u7(e){return Fge(e)?Ul.Float32:Lge(e.MODE)}function UXe(e){return 256*4+e.NSYMBT}async function NXe(e,t,r){await r.update({message:"Parsing CCP4/MRC/MAP file..."});let{header:n,littleEndian:o}=await OXe(e),i=UXe(n),a=Lge(n.MODE),s=u7(n),l=n.NC*n.NR*n.NS,u=l7(a),c=l*u,m=Bge(l,s);return GXe(n,m,e,i,c,o),{header:n,values:m.values,name:e.name}}function zXe(e,t){return Pe.create("Parse CCP4/MRC/MAP",async r=>{try{return jr.success(await NXe(e,t,r))}catch(n){return jr.error(n)}})}function Vge(e,t){return zXe(f_.fromBuffer(dm.fromUint8Array(e),t),e.length)}var c7=512;function jXe(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}function WXe(e,t){let r=t?o=>e.readInt16LE(o*2):o=>e.readInt16BE(o*2),n=1/r(17);return{xStart:r(0),yStart:r(1),zStart:r(2),xExtent:r(3),yExtent:r(4),zExtent:r(5),xRate:r(6),yRate:r(7),zRate:r(8),xlen:r(9)*n,ylen:r(10)*n,zlen:r(11)*n,alpha:r(12)*n,beta:r(13)*n,gamma:r(14)*n,divisor:r(15)/100,summand:r(16),sigma:void 0}}function Oge(e){let{xExtent:t,yExtent:r,zExtent:n}=e,o=Math.ceil(t/8),i=Math.ceil(r/8),a=Math.ceil(n/8);return{xBlocks:o,yBlocks:i,zBlocks:a}}async function XXe(e){let{buffer:t}=await e.readBuffer(0,c7),r=String.fromCharCode.apply(null,t),n=r.startsWith(":-)"),o=n||t.readInt16LE(18*2)===100;return{header:n?jXe(r):WXe(t,o),littleEndian:o}}async function QXe(e,t,r,n){n||dm.flipByteOrderInPlace2(t.buffer);let{divisor:o,summand:i,xExtent:a,yExtent:s,zExtent:l}=e,{xBlocks:u,yBlocks:c,zBlocks:m}=Oge(e),d=0;for(let p=0;p<m;++p)for(let h=0;h<c;++h)for(let f=0;f<u;++f)for(let y=0;y<8;++y){let g=8*p+y;for(let x=0;x<8;++x){let S=8*h+x;for(let I=0;I<8;++I){let v=8*f+I;if(v<a&&S<s&&g<l){let A=(v*s+S)*l+g;r[A]=(t[d]-i)/o,++d}else{d+=8-I;break}}}}}function ZXe(e){let{xExtent:t,yExtent:r,zExtent:n}=e,{xBlocks:o,yBlocks:i,zBlocks:a}=Oge(e),s=t*r*n,l=o*8*i*8*a*8,c=l*1;return{count:l,byteCount:c,valueCount:s}}async function qXe(e,t,r){await r.update({message:"Parsing DSN6/BRIX file..."});let{header:n,littleEndian:o}=await XXe(e),{buffer:i}=await e.readBuffer(c7,t-c7),{valueCount:a}=ZXe(n),s=new Float32Array(a);return await QXe(n,i,s,o),{header:n,values:s,name:e.name}}function YXe(e,t){return Pe.create("Parse DSN6/BRIX",async r=>{try{return jr.success(await qXe(e,t,r))}catch(n){return jr.error(n)}})}function Gge(e,t){return YXe(f_.fromBuffer(dm.fromUint8Array(e),t),e.length)}var JXe={char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8},$Xe=new Set(Object.keys(JXe));function ik(e){if(!$Xe.has(e))throw new Error(`unknown ply type '${e}'`);return e}function Uge(e,t,r){let n=new Map;for(let o=0,i=t.length;o<i;++o)n.set(t[o],e[o]);return{comments:r,elementNames:t,getElement:o=>n.get(o)}}function eQe(e,t){let r=yt(e);return{data:e,tokenizer:r,runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}function tQe(e){let t=e.data.indexOf("end_header",e.position);if(t===-1)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,yt.eatLine(e)}function rQe(e){let{tokenizer:t,comments:r,elementSpecs:n}=e;tQe(t);let o=yt.getTokenString(t).split(/\r?\n/);if(o[0]!=="ply")throw new Error("data not starting with 'ply'");if(o[1]!=="format ascii 1.0")throw new Error("format not 'ascii 1.0'");let i,a,s;function l(){if(i!==void 0&&a!==void 0&&s!==void 0){let u=!1;for(let c=0,m=s.length;c<m;++c)if(s[c].kind==="list"){u=!0;break}u&&s.length,u?n.push({kind:"list",name:i,count:a,property:s[0]}):n.push({kind:"table",name:i,count:a,properties:s})}}for(let u=2,c=o.length;u<c;++u){let m=o[u],d=m.split(" ");if(m.startsWith("comment"))r.push(m.substr(8));else if(m.startsWith("element"))l(),s=[],i=d[1],a=parseInt(d[2]);else if(m.startsWith("property")){if(s===void 0)throw new Error("properties outside of element");d[1]==="list"?s.push({kind:"list",countType:ik(d[2]),dataType:ik(d[3]),name:d[4]}):s.push({kind:"column",type:ik(d[1]),name:d[2]})}else m.startsWith("end_header")?l():console.warn("unknown header line")}}function nQe(e){let{elementSpecs:t}=e;for(let r=0,n=t.length;r<n;++r){let o=t[r];o.kind==="table"?oQe(e,o):o.kind==="list"&&iQe(e,o)}}function Nge(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return H.Schema.int;case"float":case"double":case"float32":case"float64":return H.Schema.float}}function oQe(e,t){let{elements:r,tokenizer:n}=e,{count:o,properties:i}=t,a=i.length,s=[],l=[],u=[],c=new Map;for(let m=0,d=a;m<d;++m){let p=je.create(n.data,o*2);u.push(p)}for(let m=0,d=o;m<d;++m)for(let p=0,h=a;p<h;++p)yt.skipWhitespace(n),yt.markStart(n),yt.eatValue(n),je.addUnchecked(u[p],n.tokenStart,n.tokenEnd);for(let m=0,d=a;m<d;++m){let{type:p,name:h}=i[m],f=sM(u[m],Nge(p));s.push(h),l.push(p),c.set(h,f)}r.push({kind:"table",rowCount:o,propertyNames:s,propertyTypes:l,getProperty:m=>c.get(m)})}function iQe(e,t){let{elements:r,tokenizer:n}=e,{count:o,property:i}=t,a=je.create(n.data,o*2*3),s=new Uint32Array(o+1),l=0;for(let m=0,d=o;m<d;++m){for(yt.skipWhitespace(n),yt.markStart(n);yt.skipWhitespace(n)!==10;)++l,yt.markStart(n),yt.eatValue(n),je.addToken(a,n);s[m+1]=l}let u={entries:[],count:0},c=sM(a,Nge(i.dataType));r.push({kind:"list",rowCount:o,name:i.name,type:i.dataType,value:m=>{let d=s[m]+1,p=c.value(d-1);for(let h=d,f=d+p;h<f;++h)u.entries[h-d]=c.value(h);return u.count=p,u}})}async function aQe(e,t){let r=eQe(e,t);t.update({message:"Parsing...",current:0,max:e.length}),rQe(r),nQe(r);let{elements:n,elementSpecs:o,comments:i}=r,a=o.map(l=>l.name),s=Uge(n,a,i);return jr.success(s)}function zge(e){return Pe.create("Parse PLY",async t=>await aQe(e,t))}var{readLine:sk,skipWhitespace:Hge,eatValue:jge,eatLine:lQe,markStart:m7}=yt,ak=/\s+/,uQe=/(^\*|REMARK)*/;function cQe(e,t){return{tokenizer:e,runtimeCtx:t}}async function mQe(e,t){let{tokenizer:r}=e,n=je.create(r.data,t*2),o=je.create(r.data,t*2),i=je.create(r.data,t*2),a=je.create(r.data,t*2),s=je.create(r.data,t*2),l=je.create(r.data,t*2),u=je.create(r.data,t*2),c=je.create(r.data,t*2),{position:m}=r,d=sk(r).trim();r.position=m;let p=d.split(ak).length===7,h=p?6:8,{length:f}=r,y=0;return await ts(e.runtimeCtx,1e5,void 0,g=>{let x=Math.min(t-y,g);for(let S=0;S<x;++S){for(let I=0;I<h;++I)if(Hge(r),m7(r),jge(r),p)switch(I){case 0:je.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:je.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 2:je.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 3:je.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 4:je.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 5:je.addUnchecked(c,r.tokenStart,r.tokenEnd);break}else switch(I){case 0:je.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:je.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 2:je.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 3:je.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 4:je.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 5:je.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 6:je.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case 7:je.addUnchecked(c,r.tokenStart,r.tokenEnd);break}lQe(r),m7(r)}return y+=x,x},g=>g.update({message:"Parsing...",current:r.position,max:f})),{count:t,atomId:Gt(n)(H.Schema.int),segmentName:p?Gt(i)(H.Schema.str):Gt(o)(H.Schema.str),residueId:Gt(i)(H.Schema.int),residueName:p?Gt(i)(H.Schema.str):Gt(a)(H.Schema.str),atomName:Gt(s)(H.Schema.str),atomType:Gt(l)(H.Schema.str),charge:Gt(u)(H.Schema.float),mass:Gt(c)(H.Schema.float)}}async function dQe(e,t){let{tokenizer:r}=e,n=je.create(r.data,t*2),o=je.create(r.data,t*2),{length:i}=r,a=0;return await ts(e.runtimeCtx,10,void 0,s=>{let l=Math.min(t-a,s);for(let u=0;u<l;++u)for(let c=0;c<2;++c)switch(Hge(r),m7(r),jge(r),c){case 0:je.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:je.addUnchecked(o,r.tokenStart,r.tokenEnd);break}return a+=l,l},s=>s.update({message:"Parsing...",current:r.position,max:i})),{count:t,atomIdA:Gt(n)(H.Schema.int),atomIdB:Gt(o)(H.Schema.int)}}function pQe(e,t){let r=[];for(let n=0;n<t;++n){let o=sk(e.tokenizer);r.push(o.replace(uQe,"").trim())}return r}async function fQe(e,t){let r=yt(e),n=cQe(r,t),o,i,a,s=sk(n.tokenizer).trim();for(;r.tokenEnd<r.length;){let u=sk(n.tokenizer).trim();if(u.includes("!NTITLE")){let c=parseInt(u.split(ak)[0]);o=pQe(n,c)}else if(u.includes("!NATOM")){let c=parseInt(u.split(ak)[0]);i=await mQe(n,c)}else if(u.includes("!NBOND")){let c=parseInt(u.split(ak)[0]);a=await dQe(n,c);break}else u.includes("!NTHETA")||u.includes("!NPHI")||u.includes("!NIMPHI")||u.includes("!NDON")||u.includes("!NACC")||u.includes("!NNB")||u.includes("!NGRP NST2")||u.includes("!MOLNT")||u.includes("!NUMLP NUMLPH")||u.includes("!NCRTERM")}if(o===void 0&&(o=[]),i===void 0)return jr.error("no atoms data");if(a===void 0)return jr.error("no bonds data");let l={id:s,title:o,atoms:i,bonds:a};return jr.success(l)}function Wge(e){return Pe.create("Parse PSF",async t=>await fQe(e,t))}var Xge=.529177210859;function hQe(e){let t=yt.readLines(e,6),r=(x,S)=>{let I=+t[x].trim().split(/\s+/g)[S];return Number.isNaN(I)?0:I},n=x=>{let S=r(x+2,0),I=Xge;return[Math.abs(S),b.create(r(x+2,1)*I,r(x+2,2)*I,r(x+2,3)*I),S]},o=t[0].trim(),i=t[1].trim(),[a,s,l]=n(0),[u,c]=n(1),[m,d]=n(2),[p,h]=n(3),f=gQe(e,a,Xge),y=[];if(l>=0){let x=r(2,4);x===0&&(x=1);for(let S=0;S<x;S++)y.push(S)}else{let x=yt.readLine(e).trim().split(/\s+/g);for(let S=0,I=+x[0];S<I;S++)y.push(+x[S+1])}return{header:{orbitals:l<0,comment1:o,comment2:i,atomCount:a,origin:s,dim:b.create(u,m,p),basisX:c,basisY:d,basisZ:h,dataSetIds:y},atoms:f}}function gQe(e,t,r){let n=new Int32Array(t),o=new Float64Array(t),i=new Float32Array(t),a=new Float32Array(t),s=new Float32Array(t);for(let l=0;l<t;l++){let u=yt.readLine(e).trim().split(/\s+/g);n[l]=+u[0],o[l]=+u[1],i[l]=+u[2]*r,a[l]=+u[3]*r,s[l]=+u[4]*r}return{count:t,number:H.ofArray({array:n,schema:H.Schema.int}),nuclearCharge:H.ofArray({array:o,schema:H.Schema.float}),x:H.ofArray({array:i,schema:H.Schema.float}),y:H.ofArray({array:a,schema:H.Schema.float}),z:H.ofArray({array:s,schema:H.Schema.float})}}function yQe(e,t,r){let n=r.dim[0]*r.dim[1]*r.dim[2]*r.dataSetIds.length,o=100*100*100,i=new Float64Array(n),a=0;return ts(e,o,i,(s,l)=>{let u=Math.min(n,a+s);for(let c=a;c<u;c++)yt.skipWhitespace(t),t.tokenStart=t.position,yt.eatValue(t),l[c]=mc(t.data,t.tokenStart,t.tokenEnd);return a=u,u===n?0:o},(s,l,u)=>s.update({current:Math.min(u,n),max:n}))}function Qge(e,t){return Pe.create("Parse Cube",async r=>{await r.update("Reading header...");let n=yt(e),{header:o,atoms:i}=hQe(n),a=await yQe(r,n,o);return jr.success({header:o,atoms:i,values:a,name:t})})}function Zge(e){let t={h:b()},r=0,n=0,o=/\s+/g;for(;;){let i=yt.readLine(e),a;if(i.startsWith("object 1"))a=i.split(o),t.dim=b.create(parseInt(a[5]),parseInt(a[6]),parseInt(a[7]));else if(i.startsWith("origin"))a=i.split(o),t.min=b.create(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));else if(i.startsWith("delta"))a=i.split(o),n===0?t.h[0]=parseFloat(a[1]):n===1?t.h[1]=parseFloat(a[2]):n===2&&(t.h[2]=parseFloat(a[3])),n+=1;else if(i.startsWith("object 3")){r+=i.length+1;break}r+=i.length+1}return{header:t,headerByteCount:r}}function bQe(e,t,r){let n=r.dim[0]*r.dim[1]*r.dim[2],o=100*100*100,i=new Float64Array(n),a=0;return ts(e,o,i,(s,l)=>{let u=Math.min(n,a+s);for(let c=a;c<u;c++)yt.skipWhitespace(t),t.tokenStart=t.position,yt.eatValue(t),l[c]=mc(t.data,t.tokenStart,t.tokenEnd);return a=u,u===n?0:o},(s,l,u)=>s.update({current:Math.min(u,n),max:n}))}async function xQe(e,t,r){await e.update("Reading header...");let n=yt(t),{header:o}=Zge(n);await e.update("Reading values...");let i=await bQe(e,n,o);return jr.success({header:o,values:i,name:r})}async function CQe(e,t,r){await e.update("Reading header...");let n=sh(t,0,1e3),o=yt(n),{header:i,headerByteCount:a}=Zge(o);await e.update("Reading values...");let s=i.dim[0]*i.dim[1]*i.dim[2],l=new DataView(t.buffer,t.byteOffset+a),u=new Float64Array(s);for(let c=0;c<s;c++)u[c]=l.getFloat64(c*8,!0);return jr.success({header:i,values:u,name:r})}function qge(e,t){return Pe.create("Parse DX",r=>tm.is(e)?xQe(r,e,t):CQe(r,e,t))}var SQe={NATOM:"",NTYPES:"",NBONH:"",MBONA:"",NTHETH:"",MTHETA:"",NPHIH:"",MPHIA:"",NHPARM:"",NPARM:"",NNB:"",NRES:"",NBONA:"",NTHETA:"",NPHIA:"",NUMBND:"",NUMANG:"",NPTRA:"",NATYP:"",NPHB:"",IFPERT:"",NBPER:"",NGPER:"",NDPER:"",MBPER:"",MGPER:"",MDPER:"",IFBOX:"",NMXRS:"",IFCAP:"",NUMEXTRA:"",NCOPY:""},Yge=Object.keys(SQe),{readLine:h_,markLine:Kge,trim:vQe}=yt;function IQe(e,t){return{tokenizer:e,runtimeCtx:t}}function AQe(e){let{tokenizer:t}=e,r=[];for(;t.tokenEnd<t.length&&t.data.charAt(t.position)!=="%";){let n=h_(t).trim();n&&r.push(n)}return r}function TQe(e){let{tokenizer:t}=e,r=Object.create(null);Yge.forEach(o=>{r[o]=0});let n=0;for(;t.tokenEnd<t.length&&t.data.charAt(t.position)!=="%";){let o=h_(t),i=Math.min(n+10,32);for(let a=0;n<i;++a,++n)r[Yge[n]]=parseInt(o.substring(a*8,a*8+8).trim())}return r}function Px(e,t,r,n){let{tokenizer:o}=e,i=je.create(o.data,t*2),a=0;for(;o.tokenEnd<o.length&&o.data.charAt(o.position)!=="%";){o.tokenStart=o.position;let s=Math.min(a+r,t);for(let l=0;a<s;++l,++a){let u=o.position;vQe(o,o.position,o.position+n),je.addUnchecked(i,o.tokenStart,o.tokenEnd),o.position=u+n}Kge(o)}return i}async function PQe(e,t){let r=yt(e),n=IQe(r,t),o=Object.create(null),i=0;for(;r.tokenEnd<r.length;){r.position-i>1e5&&t.shouldUpdate&&(i=r.position,await t.update({current:r.position,max:r.length}));let a=h_(n.tokenizer).trim();if(a.startsWith("%VERSION"))o.version=a.substring(8).trim();else if(a.startsWith("%FLAG")){let s=a.substring(5).trim(),l=h_(n.tokenizer).trim();for(;l.startsWith("%COMMENT");)l=h_(n.tokenizer).trim();if(!l.startsWith("%FORMAT"))throw new Error(`expected %FORMAT got "${l}"`);if(s==="TITLE"||s==="CTITLE")o.title=AQe(n);else if(s==="POINTERS")o.pointers=TQe(n);else if(s==="ATOM_NAME"){let u=Px(n,o.pointers.NATOM,20,4);o.atomName=Gt(u)(H.Schema.str)}else if(s==="CHARGE"){let u=Px(n,o.pointers.NATOM,5,16);o.charge=Gt(u)(H.Schema.float)}else if(s==="MASS"){let u=Px(n,o.pointers.NATOM,5,16);o.mass=Gt(u)(H.Schema.float)}else if(s==="RESIDUE_LABEL"){let u=Px(n,o.pointers.NRES,20,4);o.residueLabel=Gt(u)(H.Schema.str)}else if(s==="RESIDUE_POINTER"){let u=Px(n,o.pointers.NRES,10,8);o.residuePointer=Gt(u)(H.Schema.int)}else if(s==="BONDS_INC_HYDROGEN"){let u=Px(n,o.pointers.NBONH*3,10,8);o.bondsIncHydrogen=Gt(u)(H.Schema.int)}else if(s==="BONDS_WITHOUT_HYDROGEN"){let u=Px(n,o.pointers.NBONA*3,10,8);o.bondsWithoutHydrogen=Gt(u)(H.Schema.int)}else if(s==="RADII"){let u=Px(n,o.pointers.NATOM,5,16);o.radii=Gt(u)(H.Schema.float)}else for(;r.tokenEnd<r.length&&r.data.charAt(r.position)!=="%";)Kge(r)}}return jr.success(o)}function Jge(e){return Pe.create("Parse PRMTOP",async t=>await PQe(e,t))}var _Qe={nr:H.Schema.Int(),type:H.Schema.Str(),resnr:H.Schema.Int(),residu:H.Schema.Str(),atom:H.Schema.Str(),cgnr:H.Schema.Int(),charge:H.Schema.Float(),mass:H.Schema.Float()},RQe={ai:H.Schema.Int(),aj:H.Schema.Int()},DQe={compound:H.Schema.Str(),molCount:H.Schema.Int()},{readLine:d7,markLine:_x,skipWhitespace:Rx,markStart:lk,eatValue:p7,eatLine:wQe}=yt;function EQe(e,t){return{tokenizer:e,runtimeCtx:t}}var MQe=/\[ (.+) \]/,BQe=/\s+/;function kQe(e){let{tokenizer:t}=e,r;for(;t.tokenEnd<t.length;){Rx(t);let n=t.data.charAt(t.position);if(n==="[")break;if(n===";"||n==="*"){_x(t);continue}if(r!==void 0)throw new Error("more than one molName");r=d7(t).split(BQe)[0]}if(r===void 0)throw new Error("missing molName");return r}function LQe(e){let{tokenizer:t}=e,r=je.create(t.data,64),n=je.create(t.data,64),o=je.create(t.data,64),i=je.create(t.data,64),a=je.create(t.data,64),s=je.create(t.data,64),l=je.create(t.data,64),u=je.create(t.data,64);for(;t.tokenEnd<t.length;){Rx(t);let c=t.data.charAt(t.position);if(c==="[")break;if(c===";"||c==="*"){_x(t);continue}for(let m=0;m<8;++m)switch(Rx(t),lk(t),p7(t),m){case 0:je.add(r,t.tokenStart,t.tokenEnd);break;case 1:je.add(n,t.tokenStart,t.tokenEnd);break;case 2:je.add(o,t.tokenStart,t.tokenEnd);break;case 3:je.add(i,t.tokenStart,t.tokenEnd);break;case 4:je.add(a,t.tokenStart,t.tokenEnd);break;case 5:je.add(s,t.tokenStart,t.tokenEnd);break;case 6:je.add(l,t.tokenStart,t.tokenEnd);break;case 7:je.add(u,t.tokenStart,t.tokenEnd);break}_x(t)}return Cr.ofColumns(_Qe,{nr:Gt(r)(H.Schema.int),type:Gt(n)(H.Schema.str),resnr:Gt(o)(H.Schema.int),residu:Gt(i)(H.Schema.str),atom:Gt(a)(H.Schema.str),cgnr:Gt(s)(H.Schema.int),charge:Gt(l)(H.Schema.float),mass:Gt(u)(H.Schema.float)})}function FQe(e){let{tokenizer:t}=e,r=je.create(t.data,64),n=je.create(t.data,64);for(;t.tokenEnd<t.length;){Rx(t);let o=t.data.charAt(t.position);if(o==="[")break;if(o===";"||o==="*"){_x(t);continue}for(let i=0;i<2;++i)switch(Rx(t),lk(t),p7(t),i){case 0:je.add(r,t.tokenStart,t.tokenEnd);break;case 1:je.add(n,t.tokenStart,t.tokenEnd);break}_x(t)}return Cr.ofColumns(RQe,{ai:Gt(r)(H.Schema.int),aj:Gt(n)(H.Schema.int)})}function VQe(e){let{tokenizer:t}=e,r;for(;t.tokenEnd<t.length;){Rx(t);let n=t.data.charAt(t.position);if(n==="[")break;if(n===";"||n==="*"){_x(t);continue}if(r!==void 0)throw new Error("more than one system");r=d7(t).trim()}if(r===void 0)throw new Error("missing system");return r}function OQe(e){let{tokenizer:t}=e,r=je.create(t.data,64),n=je.create(t.data,64);for(;t.tokenEnd<t.length&&(Rx(t),!(t.position>=t.length));){let o=t.data.charAt(t.position);if(o==="[")break;if(o===";"||o==="*"){_x(t);continue}for(let i=0;i<2;++i)switch(Rx(t),lk(t),p7(t),i){case 0:je.add(r,t.tokenStart,t.tokenEnd);break;case 1:je.add(n,t.tokenStart,t.tokenEnd);break}wQe(t),lk(t)}return Cr.ofColumns(DQe,{compound:Gt(r)(H.Schema.str),molCount:Gt(n)(H.Schema.int)})}async function GQe(e,t){let r=yt(e),n=EQe(r,t),o=Object.create(null),i=0;o.compounds={};let a={},s="";function l(){s&&a.atoms&&(o.compounds[s]=a,a={},s="")}for(;r.tokenEnd<r.length;){r.position-i>1e5&&t.shouldUpdate&&(i=r.position,await t.update({current:r.position,max:r.length}));let u=d7(n.tokenizer).trim();if(!(!u||u[0]==="*"||u[0]===";")){if(u.startsWith("#include"))throw new Error("#include statements not allowed");if(u.startsWith("[")){let c=u.match(MQe);if(c===null)throw new Error("expected field name");let m=c[1];if(m==="moleculetype")l(),s=kQe(n);else if(m==="atoms")a.atoms=LQe(n);else if(m==="bonds")a.bonds=FQe(n);else if(m==="system")o.system=VQe(n);else if(m==="molecules")l(),o.molecules=OQe(n);else for(;r.tokenEnd<r.length&&r.data.charAt(r.position)!=="[";)_x(r)}}}return jr.success(o)}function $ge(e){return Pe.create("Parse TOP",async t=>await GQe(e,t))}var $0=Bt.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[re.Root],to:[re.Data.String,re.Data.Binary],params:{url:C.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:C.Optional(C.Text("")),isBinary:C.Optional(C.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply({params:e,cache:t},r){return Pe.create("Download",async n=>{let o=Zr.getUrlAsset(r.managers.asset,e.url),i=await r.managers.asset.resolve(o,e.isBinary?"binary":"string").runInContext(n);return t.asset=i,e.isBinary?new re.Data.Binary(i.data,{label:e.label?e.label:o.url}):new re.Data.String(i.data,{label:e.label?e.label:o.url})})},dispose({cache:e}){e?.asset?.dispose()},update({oldParams:e,newParams:t,b:r}){return e.url!==t.url||e.isBinary!==t.isBinary?Je.UpdateResult.Recreate:e.label!==t.label?(r.label=t.label||(typeof t.url=="string"?t.url:t.url.url),Je.UpdateResult.Updated):Je.UpdateResult.Unchanged}}),f7=Bt.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:re.Root,to:re.Data.Blob,params:{sources:C.ObjectList({id:C.Text("",{label:"Unique ID"}),url:C.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:C.Optional(C.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:C.Optional(C.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},e=>`${e.id}: ${e.url}`),maxConcurrency:C.Optional(C.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply({params:e,cache:t},r){return Pe.create("Download Blob",async n=>{let o=[],i=await Nae(n,r.managers.asset,e.sources,e.maxConcurrency||4),a=[];for(let s=0;s<i.length;s++){let l=i[s],u=e.sources[s];l.kind==="error"?r.log.warn(`Download ${l.id} (${u.url}) failed: ${l.error}`):(a.push(l.result),o.push(u.isBinary?{id:l.id,kind:"binary",data:l.result.data}:{id:l.id,kind:"string",data:l.result.data}))}return t.assets=a,new re.Data.Blob(o,{label:"Data Blob",description:`${o.length} ${o.length===1?"entry":"entries"}`})})},dispose({cache:e},t){let r=e?.assets;if(r)for(let n of r)n.dispose()}}),UQe=Bt.BuiltIn({name:"defalate-data",display:{name:"Deflate",description:"Deflate compressed data"},params:{method:C.Select("gzip",[["gzip","gzip"]]),isString:C.Boolean(!1),stringEncoding:C.Optional(C.Select("utf-8",[["utf-8","UTF8"]])),label:C.Optional(C.Text(""))},from:[re.Data.Binary],to:[re.Data.Binary,re.Data.String]})({apply({a:e,params:t},r){return Pe.create("Gzip",async n=>{let o=await HE(n,e.data),i=t.label?t.label:e.label;if(t.isString){let a=LE(o);return new re.Data.String(a,{label:i})}return new re.Data.Binary(o,{label:i})})}}),h7=Bt.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[re.Root],to:[re.Data.String,re.Data.Binary],params:{data:C.Value("",{isHidden:!0}),label:C.Optional(C.Text(""))}})({apply({params:e}){return Pe.create("Raw Data",async()=>{if(typeof e.data=="string")return new re.Data.String(e.data,{label:e.label?e.label:"String"});if(Array.isArray(e.data))return new re.Data.Binary(new Uint8Array(e.data),{label:e.label?e.label:"Binary"});if(e.data instanceof ArrayBuffer)return new re.Data.Binary(new Uint8Array(e.data),{label:e.label?e.label:"Binary"});if(e.data instanceof Uint8Array)return new re.Data.Binary(e.data,{label:e.label?e.label:"Binary"});Rr(e.data)})},update({oldParams:e,newParams:t,b:r}){return e.data!==t.data?Je.UpdateResult.Recreate:e.label!==t.label?(r.label=t.label||r.label,Je.UpdateResult.Updated):Je.UpdateResult.Unchanged},customSerialization:{toJSON(e){if(typeof e.data=="string"||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){let t=new Uint8Array(e.data),r=new Array(t.length);for(let n=0,o=t.length;n<o;n++)r[n]=t[n];return{data:r,label:e.label}}else if(e.data instanceof Uint8Array){let t=new Array(e.data.length);for(let r=0,n=e.data.length;r<n;r++)t[r]=e.data[r];return{data:t,label:e.label}}},fromJSON(e){return e}}}),g7=Bt.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:re.Root,to:[re.Data.String,re.Data.Binary],params:{file:C.File(),label:C.Optional(C.Text("")),isBinary:C.Optional(C.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply({params:e,cache:t},r){return Pe.create("Open File",async n=>{if(e.file===null)return r.log.error("No file(s) selected"),An.Null;let o=await r.managers.asset.resolve(e.file,e.isBinary?"binary":"string").runInContext(n);return t.asset=o,e.isBinary?new re.Data.Binary(o.data,{label:e.label?e.label:e.file.name}):new re.Data.String(o.data,{label:e.label?e.label:e.file.name})})},dispose({cache:e}){e?.asset?.dispose()},update({oldParams:e,newParams:t,b:r}){return e.label!==t.label?(r.label=t.label||e.file?.name||"",Je.UpdateResult.Updated):Je.UpdateResult.Unchanged},isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user loaded files."})}),NQe=Bt.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:re.Data.Blob,to:re.Format.Blob,params:{formats:C.ObjectList({id:C.Text("",{label:"Unique ID"}),format:C.Select("cif",[["cif","cif"]])},e=>`${e.id}: ${e.format}`)}})({apply({a:e,params:t},r){return Pe.create("Parse Blob",async n=>{let o=new Map;for(let a of t.formats)o.set(a.id,a.format);let i=[];for(let a of e.data){if(!o.has(a.id))continue;let s=await(a.kind==="string"?mu.parse(a.data):mu.parseBinary(a.data)).runInContext(n);if(s.isError)throw new Error(`${a.id}: ${s.message}`);i.push({id:a.id,kind:"cif",data:s.result})}return new re.Format.Blob(i,{label:"Format Blob",description:`${i.length} ${i.length===1?"entry":"entries"}`})})}}),y7=Bt.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[re.Data.String,re.Data.Binary],to:re.Format.Cif})({apply({a:e}){return Pe.create("Parse CIF",async t=>{let r=await mu.parse(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return r.result.blocks.length===0?An.Null:new re.Format.Cif(r.result)})}}),zQe=Bt.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:re.Data.String,to:re.Format.Cube})({apply({a:e}){return Pe.create("Parse Cube",async t=>{let r=await Qge(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);return new re.Format.Cube(r.result)})}}),HQe=Bt.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[re.Data.String],to:re.Format.Psf})({apply({a:e}){return Pe.create("Parse PSF",async t=>{let r=await Wge(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return new re.Format.Psf(r.result)})}}),jQe=Bt.BuiltIn({name:"parse-prmtop",display:{name:"Parse PRMTOP",description:"Parse PRMTOP from String data"},from:[re.Data.String],to:re.Format.Prmtop})({apply({a:e}){return Pe.create("Parse PRMTOP",async t=>{let r=await Jge(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return new re.Format.Prmtop(r.result)})}}),WQe=Bt.BuiltIn({name:"parse-top",display:{name:"Parse TOP",description:"Parse TOP from String data"},from:[re.Data.String],to:re.Format.Top})({apply({a:e}){return Pe.create("Parse TOP",async t=>{let r=await $ge(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return new re.Format.Top(r.result)})}}),XQe=Bt.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[re.Data.String],to:re.Format.Ply})({apply({a:e}){return Pe.create("Parse PLY",async t=>{let r=await zge(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return new re.Format.Ply(r.result,{label:r.result.comments[0]||"PLY Data"})})}}),b7=Bt.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[re.Data.Binary],to:re.Format.Ccp4})({apply({a:e}){return Pe.create("Parse CCP4/MRC/MAP",async t=>{let r=await Vge(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);return new re.Format.Ccp4(r.result)})}}),QQe=Bt.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[re.Data.Binary],to:re.Format.Dsn6})({apply({a:e}){return Pe.create("Parse DSN6/BRIX",async t=>{let r=await Gge(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);return new re.Format.Dsn6(r.result)})}}),ZQe=Bt.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[re.Data.Binary,re.Data.String],to:re.Format.Dx})({apply({a:e}){return Pe.create("Parse DX",async t=>{let r=await qge(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);return new re.Format.Dx(r.result)})}}),qQe=Bt.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:re.Root,to:re.Data.String,params:{data:C.Value(""),label:C.Optional(C.Text(""))}})({apply({params:{data:e,label:t}}){return new re.Data.String(e,{label:t||""})},update({oldParams:e,newParams:t,b:r}){return e.data!==t.data?Je.UpdateResult.Recreate:e.label!==t.label?(r.label=t.label||"",Je.UpdateResult.Updated):Je.UpdateResult.Unchanged},isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user imported strings."})}),YQe=Bt.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:re.Root,to:re.Format.Json,params:{data:C.Value({}),label:C.Optional(C.Text(""))}})({apply({params:{data:e,label:t}}){return new re.Format.Json(e,{label:t||""})},update({oldParams:e,newParams:t,b:r}){return e.data!==t.data?Je.UpdateResult.Recreate:e.label!==t.label?(r.label=t.label||"",Je.UpdateResult.Updated):Je.UpdateResult.Unchanged},isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user imported JSON."})}),KQe=Bt.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[re.Data.String],to:re.Format.Json})({apply({a:e}){return Pe.create("Parse JSON",async t=>{let r=await new Response(tm.toString(e.data)).json();return new re.Format.Json(r)})}}),JQe=Bt.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:re.Root,to:re.Volume.Lazy,params:{url:C.Url(""),isBinary:C.Boolean(!1),format:C.Text("ccp4"),entryId:C.Value("",{isHidden:!0}),isovalues:C.ObjectList({type:C.Text("relative"),value:C.Numeric(0),color:C.Color(Lt.black),alpha:C.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:C.Numeric(0)},e=>`${e.type} ${e.value}`)}})({apply({a:e,params:t}){return Pe.create("Lazy Volume",async r=>{let n=Array.isArray(t.entryId)?t.entryId.join(", "):t.entryId;return new re.Volume.Lazy(t,{label:`${n||t.url}`,description:"Lazy Volume"})})}});var C7={};Bi(C7,{CreateGroup:()=>$Qe});var $Qe=Bt.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:re.Group,params:{label:C.Text("Group"),description:C.Optional(C.Text(""))}})({apply({params:e}){return new re.Group({},e)},update({oldParams:e,newParams:t,b:r}){return Yf(e,t)?Je.UpdateResult.Unchanged:(r.label=t.label,r.description=t.description,Je.UpdateResult.Updated)}});var yj={};Bi(yj,{CoordinatesFromDcd:()=>hYe,CoordinatesFromLammpstraj:()=>xYe,CoordinatesFromNctraj:()=>bYe,CoordinatesFromTrr:()=>yYe,CoordinatesFromXtc:()=>gYe,CustomModelProperties:()=>w_,CustomStructureProperties:()=>E_,ModelFromTrajectory:()=>D_,ModelWithCoordinates:()=>VYe,MultiStructureSelectionFromBundle:()=>UYe,MultiStructureSelectionFromExpression:()=>GYe,ShapeFromPly:()=>WYe,StructureComplexElement:()=>jYe,StructureComplexElementTypes:()=>_xe,StructureComponent:()=>gj,StructureFromModel:()=>pj,StructureFromTrajectory:()=>FYe,StructureInstances:()=>hj,StructureSelectionFromBundle:()=>zYe,StructureSelectionFromExpression:()=>OYe,StructureSelectionFromScript:()=>NYe,TopologyFromPrmtop:()=>SYe,TopologyFromPsf:()=>CYe,TopologyFromTop:()=>vYe,TrajectoryFromBlob:()=>AYe,TrajectoryFromCifCore:()=>BYe,TrajectoryFromCube:()=>MYe,TrajectoryFromGRO:()=>TYe,TrajectoryFromLammpsData:()=>_Ye,TrajectoryFromLammpsTrajData:()=>RYe,TrajectoryFromMOL:()=>DYe,TrajectoryFromMOL2:()=>EYe,TrajectoryFromMmCif:()=>mj,TrajectoryFromModelAndCoordinates:()=>Pk,TrajectoryFromPDB:()=>dj,TrajectoryFromSDF:()=>wYe,TrajectoryFromXYZ:()=>PYe,TransformStructureConformation:()=>fj});function eZe(e){let t=new DataView(e.buffer),r=Object.create(null),n=[],o=0,i=new Int32Array(e.buffer,0,23),a=i[0]!==t.getInt32(0);if(i[0]!==84){let f=e.byteLength;for(let y=0;y<f;y+=4)t.setFloat32(y,t.getFloat32(y),!0)}if(i[0]!==84)throw new Error("dcd bad format, header block start");if(String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7))!=="CORD")throw new Error("dcd bad format, format string");let l=!1,u=!1,c=!1;if(i[22]!==0&&(l=!0,i[12]!==0&&(u=!0),i[13]===1&&(c=!0)),r.NSET=i[2],r.ISTART=i[3],r.NSAVC=i[4],r.NAMNF=i[10],l?r.DELTA=t.getFloat32(44,a):r.DELTA=t.getFloat64(44,a),i[22]!==84)throw new Error("dcd bad format, header block end");o=o+21*4+8;let m=t.getInt32(o,a),d=o+1;if((m-4)%80!==0)throw new Error("dcd bad format, title block start");if(r.TITLE=ole(e.subarray(d,m)),t.getInt32(d+m+4-1,a)!==m)throw new Error("dcd bad format, title block end");if(o=o+m+8,t.getInt32(o,a)!==4)throw new Error("dcd bad format, natom block start");if(r.NATOM=t.getInt32(o+4,a),t.getInt32(o+8,a)!==4)throw new Error("dcd bad format, natom block end");if(o=o+4+8,r.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");let p=r.NATOM,h=p*4;for(let f=0,y=r.NSET;f<y;++f){let g=Object.create(null);g.elementCount=p,u&&(o+=4,g.cell=[t.getFloat64(o,a),t.getFloat64(o+1,a),t.getFloat64(o+2*8,a),t.getFloat64(o+3*8,a),t.getFloat64(o+4*8,a),t.getFloat64(o+5*8,a)],o+=48,o+=4);for(let x=0;x<3;++x){if(t.getInt32(o,a)!==h)throw new Error(`dcd bad format, coord block start: ${f}, ${x}`);o+=4;let S=new Float32Array(e.buffer,o,p);if(x===0?g.x=S:x===1?g.y=S:g.z=S,o+=h,t.getInt32(o,a)!==h)throw new Error(`dcd bad format, coord block end: ${f}, ${x}`);o+=4}if(c){let x=t.getInt32(o,a);o+=4+x+4}n.push(g)}return{header:r,frames:n}}function eye(e){return Pe.create("Parse DCD",async t=>{try{let r=eZe(e);return jr.success(r)}catch(r){return jr.error(r)}})}function tye(e){return function(t,r,n){return tZe(e,t,r,n)}}function tZe(e,t,r,n){let{data:o,indices:i,count:a}=e,{valueType:s}=n,l=s==="str"?u=>{let c=i[2*u]+t,m=i[2*u+1];if(c>=m)return"";let d=c+r;return d>m&&(d=m),jue(o,c,d)}:s==="int"?u=>{let c=i[2*u]+t;return c>i[2*u+1]?0:Hg(o,c,c+r)}:u=>{let c=i[2*u]+t;return c>i[2*u+1]?0:See(o,c,c+r)};return{schema:n,__array:void 0,isDefined:!0,rowCount:a,value:l,valueKind:u=>H.ValueKinds.Present,toArray:u=>bi.createAndFillArray(a,l,u),areValuesEqual:(u,c)=>l(u)===l(c)}}function rZe(){return{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]}}function nZe(e,t){return{tokenizer:e,header:rZe(),numberOfAtoms:0,runtimeCtx:t}}function oZe(e){let{tokenizer:t,header:r}=e,n=yt.readLine(t);n.trim().length===0&&(n=yt.readLine(t));let o=n.lastIndexOf("t=");o>=0?(r.timeInPs=parseFloat(n.substring(o+2)),r.title=n.substring(0,o).trim(),r.title&&r.title[r.title.length-1]===","&&(r.title=r.title.substring(0,r.title.length-1))):r.title=n}function iZe(e){let{tokenizer:t}=e;yt.markLine(t);let r=yt.getTokenString(t);e.numberOfAtoms=parseInt(r)}async function aZe(e){let{tokenizer:t,numberOfAtoms:r}=e,n=await yt.readLinesAsync(t,r,e.runtimeCtx,1e5),i=t.data.substring(n.indices[0],n.indices[1]).substring(20).match(/\.\d+/g),a=i.length===6;e.header.hasVelocities=a,e.header.precision.position=i[0].length-1,e.header.precision.velocity=a?i[3].length-1:0;let s=20,l=e.header.precision.position+5,u=s+3*l,c=e.header.precision.velocity+4,m=tye(n),d=H.Undefined(e.numberOfAtoms,H.Schema.float);return{count:e.numberOfAtoms,residueNumber:m(0,5,H.Schema.int),residueName:m(5,5,H.Schema.str),atomName:m(10,5,H.Schema.str),atomNumber:m(15,5,H.Schema.int),x:m(s,l,H.Schema.float),y:m(s+l,l,H.Schema.float),z:m(s+2*l,l,H.Schema.float),vx:a?m(u,c,H.Schema.float):d,vy:a?m(u+c,c,H.Schema.float):d,vz:a?m(u+2*c,c,H.Schema.float):d}}function sZe(e){let{tokenizer:t}=e,r=yt.readLine(t).trim().split(/\s+/g);e.header.box=[+r[0],+r[1],+r[2]]}async function lZe(e,t){let r=yt(e);await t.update({message:"Parsing...",current:0,max:e.length});let n=[];for(;r.position<e.length;){let i=nZe(r,t);oZe(i),iZe(i);let a=await aZe(i);sZe(i),n.push({header:i.header,atoms:a})}let o={structures:n};return jr.success(o)}function rye(e){return Pe.create("Parse GRO",async t=>await lZe(e,t))}function nye(e,t,r=!1){return Pe.create("Parse PDB",async n=>jr.success({lines:await yt.readAllLinesAsync(e,n),id:t,isPdbqt:r}))}var uZe={radius:1,detail:0};function oye(e,t,r){let{radius:n,detail:o}={...uZe,...r},i=cZe(),{vertices:a,indices:s}=i;u(o),rde(a,n);let l=new Float32Array(a.length);return AB(a,s,l,a.length/3,s.length/3),{vertices:new Float32Array(a),normals:new Float32Array(l),indices:new Uint32Array(s)};function u(m){let d=b(),p=b(),h=b();for(let f=0;f<t.length;f+=3)b.fromArray(d,e,t[f+0]*3),b.fromArray(p,e,t[f+1]*3),b.fromArray(h,e,t[f+2]*3),c(d,p,h,m)}function c(m,d,p,h){let f=Math.pow(2,h),y=[];for(let g=0;g<=f;++g){y[g]=[];let x=b();b.lerp(x,m,p,g/f);let S=b();b.lerp(S,d,p,g/f);let I=f-g;for(let v=0;v<=I;++v)if(v===0&&g===f)y[g][v]=x;else{let A=b();b.lerp(A,x,S,v/I),y[g][v]=A}}for(let g=0;g<f;++g)for(let x=0;x<2*(f-g)-1;++x){let S=Math.floor(x/2);x%2===0?i.add(y[g][S+1],y[g+1][S],y[g][S]):i.add(y[g][S+1],y[g+1][S+1],y[g+1][S])}}}function cZe(){let e=[],t=[],r=new Map;function n(o){let i=`${o[0].toFixed(5)}|${o[1].toFixed(5)}|${o[2].toFixed(5)}`,a=r.get(i);return a===void 0&&(a=e.length/3,r.set(i,a),e.push(...o)),a}return{vertices:e,indices:t,add:(o,i,a)=>{t.push(n(o),n(i),n(a))}}}var Jd=(1+Math.sqrt(5))/2,iye=[-1,Jd,0,1,Jd,0,-1,-Jd,0,1,-Jd,0,0,-1,Jd,0,1,Jd,0,-1,-Jd,0,1,-Jd,Jd,0,-1,Jd,0,1,-Jd,0,-1,-Jd,0,1],mZe=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],dZe=[0,11,5,11,0,5,1,5,0,1,1,7,0,7,7,10,0,10,10,11,5,9,4,11,2,10,6,7,1,8,3,9,4,9,3,4,2,4,2,3,2,6,3,6,6,8,3,8,8,9,4,5,2,11,6,10,7,8,1,9],S7;function aye(){return S7||(S7=K0(iye,mZe)),S7}var Cxr=Eh(iye,dZe);var{vertices:pZe,indices:fZe}=aye();function pm(e){return 10*Math.pow(Math.pow(2,e),2)+2}function sye(e){return oye(pZe,fZe,{detail:e,radius:1})}var lye=new Map,hZe=Z.identity();function gZe(e,t,r){return Z.scaleUniformly(e,Z.fromTranslation(e,t),r)}function v7(e){let t=lye.get(e);return t===void 0&&(t=sye(e),lye.set(e,t)),t}function Nr(e,t,r,n){et.addPrimitive(e,gZe(hZe,t,r),v7(n))}var hf={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:Math.PI*2};function uye(e){let{radiusTop:t,radiusBottom:r,height:n,radialSegments:o,heightSegments:i,topCap:a,bottomCap:s,thetaStart:l,thetaLength:u}={...hf,...e},c=[],m=[],d=[],p=0,h=[],f=n/2;return y(),a&&t>0&&g(!0),s&&r>0&&g(!1),{vertices:new Float32Array(m),normals:new Float32Array(d),indices:new Uint32Array(c)};function y(){let x=b.zero(),S=(r-t)/n;for(let I=0;I<=i;++I){let v=[],A=I/i,_=A*(r-t)+t;for(let T=0;T<=o;++T){let D=T/o*u+l,M=Math.sin(D),E=Math.cos(D);m.push(_*M,-A*n+f,_*E),b.normalize(x,b.set(x,M,S,E)),d.push(...x),v.push(p++)}h.push(v)}for(let I=0;I<o;++I)for(let v=0;v<i;++v){let A=h[v][I],_=h[v+1][I],T=h[v+1][I+1],w=h[v][I+1];c.push(A,_,w),c.push(_,T,w)}}function g(x){let S=x===!0?t:r,I=x===!0?1:-1,v=p;for(let _=1;_<=o;++_)m.push(0,f*I,0),d.push(0,I,0),++p;let A=p;for(let _=0;_<=o;++_){let w=_/o*u+l,D=Math.cos(w),M=Math.sin(w);m.push(S*M,f*I,S*D),d.push(0,I,0),++p}for(let _=0;_<o;++_){let T=v+_,w=A+_;x===!0?c.push(w,w+1,T):c.push(w+1,w,T)}}}var cye=b(),mye=b(),fm=b(),hm=b(),Lh=b(),pI=b(),yZe={height:1,topCap:!0,bottomCap:!0};function eS(e,t){let r=e.length/3;if(r<3)throw new Error("need at least 3 points to build a prism");let{height:n,topCap:o,bottomCap:i}={...yZe,...t},a=r*2,s=r*4,l=(o?1:0)+(i?1:0);r===3?(a+=l,s+=l*3):r===4?(a+=l*2,s+=l*4):(a+=l*r,s+=l*r*3);let u=ff(a,s),c=n*.5;b.set(cye,0,0,-c),b.set(mye,0,0,c);for(let m=0;m<r;++m){let d=(m+1)%r;b.set(fm,e[m*3],e[m*3+1],-c),b.set(hm,e[d*3],e[d*3+1],-c),b.set(Lh,e[d*3],e[d*3+1],c),b.set(pI,e[m*3],e[m*3+1],c),u.addQuad(fm,hm,Lh,pI)}if(r===3)o&&(b.set(fm,e[0],e[1],-c),b.set(hm,e[3],e[4],-c),b.set(Lh,e[6],e[7],-c),u.add(Lh,hm,fm)),i&&(b.set(fm,e[0],e[1],c),b.set(hm,e[3],e[4],c),b.set(Lh,e[6],e[7],c),u.add(fm,hm,Lh));else if(r===4)o&&(b.set(fm,e[0],e[1],-c),b.set(hm,e[3],e[4],-c),b.set(Lh,e[6],e[7],-c),b.set(pI,e[9],e[10],-c),u.addQuad(pI,Lh,hm,fm)),i&&(b.set(fm,e[0],e[1],c),b.set(hm,e[3],e[4],c),b.set(Lh,e[6],e[7],c),b.set(pI,e[9],e[10],c),u.addQuad(fm,hm,Lh,pI));else for(let m=0;m<r;++m){let d=(m+1)%r;o&&(b.set(fm,e[m*3],e[m*3+1],-c),b.set(hm,e[d*3],e[d*3+1],-c),u.add(cye,hm,fm)),i&&(b.set(fm,e[m*3],e[m*3+1],c),b.set(hm,e[d*3],e[d*3+1],c),u.add(fm,hm,mye))}return u.getPrimitive()}var I7;function dye(){return I7||(I7=eS(Rc(4,!1))),I7}var A7;function pye(){return A7||(A7=eS(Rc(5,!1))),A7}var T7;function fye(){return T7||(T7=eS(Rc(6,!1))),T7}var P7;function hye(){return P7||(P7=eS(Rc(6,!0))),P7}var _7;function gye(){return _7||(_7=eS(Rc(7,!1))),_7}var yye=new Map,bye=b.create(0,1,0),$d=b(),uk=b(),xye=b(),Oh=Z(),Cye=Z(),Sye=b(),Vh=b(),R7=b();function g_(e,t,r,n,o){return b.setMagnitude(uk,r,n/2),b.add(xye,t,uk),o?b.matchDirection(R7,bye,uk):b.copy(R7,bye),b.set(Sye,1,n,1),b.makeRotation(Cye,R7,uk),Z.scale(e,Cye,Sye),Z.setTranslation(e,xye)}var Fh=new Int32Array(9);function bZe(e){return Fh[0]=Math.round(1e3*(e.radiusTop??hf.radiusTop)),Fh[1]=Math.round(1e3*(e.radiusBottom??hf.radiusBottom)),Fh[2]=Math.round(1e3*(e.height??hf.height)),Fh[3]=e.radialSegments??hf.radialSegments,Fh[4]=e.heightSegments??hf.heightSegments,Fh[5]=e.topCap??hf.topCap?1:0,Fh[6]=e.bottomCap??hf.bottomCap?1:0,Fh[7]=Math.round(1e3*(e.thetaStart??hf.thetaStart)),Fh[8]=Math.round(1e3*(e.thetaLength??hf.thetaLength)),Ro(Fh)}function y_(e){let t=bZe(e),r=yye.get(t);if(r===void 0){if(e.radialSegments&&e.radialSegments<=4){let n=Math.max(3,e.radialSegments),o=eS(Rc(n,!0,e.radiusTop),e);r=mI(o,Z.rotX90)}else r=uye(e);yye.set(t,r)}return r}function b_(e,t,r,n){let o=b.distance(t,r);b.sub($d,r,t),g_(Oh,t,$d,o,!1),et.addPrimitive(e,Oh,y_(n))}function nn(e,t,r,n,o){let i=b.distance(t,r)*n;b.sub($d,r,t),g_(Oh,t,$d,i,!0),et.addPrimitive(e,Oh,y_(o))}function vye(e,t,r,n,o,i){let a=b.distance(t,r)*n,s=y_(i);b.sub($d,r,t),b.add(Vh,t,o),g_(Oh,Vh,$d,a,!0),et.addPrimitive(e,Oh,s),b.sub(Vh,t,o),g_(Oh,Vh,$d,a,!0),et.addPrimitive(e,Oh,s)}function ep(e,t,r,n,o,i,a){let s=b.distance(t,r)*n,l=o%2!==0,u=Math.floor((o+1)/2),c=s/(o+.5),m=y_(a);b.setMagnitude($d,b.sub($d,r,t),c),b.copy(Vh,t);for(let d=0;d<u;++d)b.add(Vh,Vh,$d),l&&d===u-1&&(!i&&a.topCap&&(a.topCap=!1,m=y_(a)),c/=2),g_(Oh,Vh,$d,c,!1),et.addPrimitive(e,Oh,m),b.add(Vh,Vh,$d)}var ya=b(),Iye=Ot(),gf=b(),tp=b(),gy=b(),ck=b(),zu=b.fromArray,xZe=b.triangleNormal,Aye=b.copy,mk=b.transformMat4,Tye=b.transformMat3,Pye=Ot.directionTransform,Hu=Qe.add3,dk=Qe.add,et;(m=>{function e(d=2048,p=1024,h){return{currentGroup:-1,vertices:Qe.create(Float32Array,3,p,h?h.vertexBuffer.ref.value:d),normals:Qe.create(Float32Array,3,p,h?h.normalBuffer.ref.value:d),indices:Qe.create(Uint32Array,3,p*3,h?h.indexBuffer.ref.value:d*3),groups:Qe.create(Float32Array,1,p,h?h.groupBuffer.ref.value:d),mesh:h}}m.createState=e;function t(d,p,h,f){let{vertices:y,normals:g,indices:x,groups:S,currentGroup:I}=d,v=y.elementCount;Hu(y,p[0],p[1],p[2]),Hu(y,h[0],h[1],h[2]),Hu(y,f[0],f[1],f[2]),xZe(ya,p,h,f);for(let A=0;A<3;++A)Hu(g,ya[0],ya[1],ya[2]),dk(S,I);Hu(x,v,v+1,v+2)}m.addTriangle=t;function r(d,p,h,f,y){let{vertices:g,normals:x,indices:S,groups:I,currentGroup:v}=d,A=g.elementCount;Hu(g,p[0],p[1],p[2]),Hu(g,h[0],h[1],h[2]),Hu(g,f[0],f[1],f[2]);for(let _=0;_<3;++_)Hu(x,y[0],y[1],y[2]),dk(I,v);Hu(S,A,A+1,A+2)}m.addTriangleWithNormal=r;function n(d,p,h){zu(gy,p,h[0]*3),zu(ck,p,h[1]*3);for(let f=2,y=h.length;f<y;f+=2)Aye(gf,gy),Aye(tp,ck),zu(gy,p,h[f]*3),zu(ck,p,h[f+1]*3),t(d,gf,tp,gy),t(d,tp,ck,gy)}m.addTriangleStrip=n;function o(d,p,h){zu(gf,p,h[0]*3);for(let f=2,y=h.length;f<y;++f)zu(tp,p,h[f-1]*3),zu(gy,p,h[f]*3),t(d,gf,gy,tp)}m.addTriangleFan=o;function i(d,p,h,f){zu(gf,p,h[0]*3);for(let y=2,g=h.length;y<g;++y)zu(tp,p,h[y-1]*3),zu(gy,p,h[y]*3),r(d,gf,gy,tp,f)}m.addTriangleFanWithNormal=i;function a(d,p,h){let{vertices:f,normals:y,indices:g}=h,{vertices:x,normals:S,indices:I,groups:v,currentGroup:A}=d,_=x.elementCount,T=Pye(Iye,p);for(let w=0,D=f.length;w<D;w+=3)mk(ya,zu(ya,f,w),p),Hu(x,ya[0],ya[1],ya[2]),Tye(ya,zu(ya,y,w),T),Hu(S,ya[0],ya[1],ya[2]),dk(v,A);for(let w=0,D=g.length;w<D;w+=3)Hu(I,g[w]+_,g[w+1]+_,g[w+2]+_)}m.addPrimitive=a;function s(d,p,h){let{vertices:f,normals:y,indices:g}=h,{vertices:x,normals:S,indices:I,groups:v,currentGroup:A}=d,_=x.elementCount,T=Pye(Iye,p);for(let w=0,D=f.length;w<D;w+=3)mk(ya,zu(ya,f,w),p),Hu(x,ya[0],ya[1],ya[2]),Tye(ya,zu(ya,y,w),T),Hu(S,-ya[0],-ya[1],-ya[2]),dk(v,A);for(let w=0,D=g.length;w<D;w+=3)Hu(I,g[w+2]+_,g[w+1]+_,g[w]+_)}m.addPrimitiveFlipped=s;function l(d,p,h,f,y,g){let{vertices:x,edges:S}=h,I={radiusTop:f,radiusBottom:f,radialSegments:g};for(let v=0,A=S.length;v<A;v+=2)zu(gf,x,S[v]*3),zu(tp,x,S[v+1]*3),mk(gf,gf,p),mk(tp,tp,p),Nr(d,gf,f,y),Nr(d,tp,f,y),nn(d,gf,tp,1,I)}m.addCage=l;function u(d,p,h){a(d,p,{vertices:h.vertexBuffer.ref.value.subarray(0,h.vertexCount*3),normals:h.normalBuffer.ref.value.subarray(0,h.vertexCount*3),indices:h.indexBuffer.ref.value.subarray(0,h.triangleCount*3)})}m.addMesh=u;function c(d){let{vertices:p,normals:h,indices:f,groups:y,mesh:g}=d,x=Qe.compact(p,!0),S=Qe.compact(f,!0),I=Qe.compact(h,!0),v=Qe.compact(y,!0);return ft.create(x,S,I,v,d.vertices.elementCount,d.indices.elementCount,g)}m.getMesh=c})(et||={});function wye(e){let t=e&&e.getElement("vertex"),r=e&&e.getElement("material"),n={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},o=[["",""]],i=[["",""]];if(t){for(let l=0,u=t.propertyNames.length;l<u;++l){let c=t.propertyNames[l],m=t.propertyTypes[l];(m==="uchar"||m==="uint8"||m==="ushort"||m==="uint16"||m==="uint"||m==="uint32"||m==="int")&&o.push([c,c]),(m==="uchar"||m==="uint8")&&i.push([c,c])}t.propertyNames.includes("atomid")?n.group="atomid":t.propertyNames.includes("material_index")&&(n.group="material_index"),t.propertyNames.includes("red")&&(n.vRed="red"),t.propertyNames.includes("green")&&(n.vGreen="green"),t.propertyNames.includes("blue")&&(n.vBlue="blue")}let a=[["",""]];if(r){for(let l=0,u=r.propertyNames.length;l<u;++l){let c=r.propertyNames[l],m=r.propertyTypes[l];(m==="uchar"||m==="uint8")&&a.push([c,c])}r.propertyNames.includes("red")&&(n.mRed="red"),r.propertyNames.includes("green")&&(n.mGreen="green"),r.propertyNames.includes("blue")&&(n.mBlue="blue")}let s=n.vRed&&n.vGreen&&n.vBlue?"vertex":n.mRed&&n.mGreen&&n.mBlue?"material":"uniform";return{...ft.Params,coloring:C.MappedStatic(s,{vertex:C.Group({red:C.Select(n.vRed,i,{label:"Red Property"}),green:C.Select(n.vGreen,i,{label:"Green Property"}),blue:C.Select(n.vBlue,i,{label:"Blue Property"})},{isFlat:!0}),material:C.Group({red:C.Select(n.mRed,a,{label:"Red Property"}),green:C.Select(n.mGreen,a,{label:"Green Property"}),blue:C.Select(n.mBlue,a,{label:"Blue Property"})},{isFlat:!0}),uniform:C.Group({color:C.Color(Lt.grey),saturation:C.Numeric(0,{min:-6,max:6,step:.1}),lightness:C.Numeric(0,{min:-6,max:6,step:.1})},{isFlat:!0})}),grouping:C.MappedStatic(n.group?"vertex":"none",{vertex:C.Group({group:C.Select(n.group,o,{label:"Group Property"})},{isFlat:!0}),none:C.Group({})})}}var _ye=wye();function CZe(e,t,r,n,o){let{vertices:i,normals:a,groups:s}=r,l=n.getProperty("x"),u=n.getProperty("y"),c=n.getProperty("z");if(!l||!u||!c)throw new Error("missing coordinate properties");let m=n.getProperty("nx"),d=n.getProperty("ny"),p=n.getProperty("nz"),h=!!m&&!!d&&!!p;for(let f=e;f<t;++f)Qe.add3(i,l.value(f),u.value(f),c.value(f)),h&&Qe.add3(a,m.value(f),d.value(f),p.value(f)),Qe.add(s,o[f])}function SZe(e,t,r,n){let{indices:o}=r;for(let i=e;i<t;++i){let{entries:a,count:s}=n.value(i);s===3?Qe.add3(o,a[0],a[1],a[2]):s===4&&(Qe.add3(o,a[2],a[1],a[0]),Qe.add3(o,a[2],a[0],a[3]))}}async function vZe(e,t,r,n,o){let i=et.createState(t.rowCount,t.rowCount/4,o),a=t.getProperty("x"),s=t.getProperty("y"),l=t.getProperty("z");if(!a||!s||!l)throw new Error("missing coordinate properties");let u=t.getProperty("nx"),c=t.getProperty("ny"),m=t.getProperty("nz"),d=!!u&&!!c&&!!m,p=1e5;for(let f=0,y=t.rowCount;f<y;f+=p)CZe(f,Math.min(f+p,y),i,t,n),e.shouldUpdate&&await e.update({message:"adding ply mesh vertices",current:f,max:y});for(let f=0,y=r.rowCount;f<y;f+=p)SZe(f,Math.min(f+p,y),i,r),e.shouldUpdate&&await e.update({message:"adding ply mesh faces",current:f,max:y});let h=et.getMesh(i);return d||ft.computeNormals(h),P.updateIfChanged(h.varyingGroup,!0),h}var yy=H.Schema.int;function IZe(e,t){let{grouping:r}=t,{rowCount:n}=e,o=r.name==="vertex"?e.getProperty(r.params.group):void 0,i=r.name==="vertex"?ta(r.params.group):"Vertex",a=o?o.toArray({array:Uint32Array}):_a(new Uint32Array(n)),s=o?ol(a):n-1,l=new Uint32Array(s+1);for(let u=0,c=a.length;u<c;++u)l[a[u]]=u;return{ids:a,map:l,label:i}}function Rye(e,t,r){let{coloring:n}=r,{rowCount:o}=e,i,a,s;if(n.name==="vertex")i=e.getProperty(n.params.red)||H.ofConst(127,o,yy),a=e.getProperty(n.params.green)||H.ofConst(127,o,yy),s=e.getProperty(n.params.blue)||H.ofConst(127,o,yy);else if(n.name==="material")i=t&&t.getProperty(n.params.red)||H.ofConst(127,o,yy),a=t&&t.getProperty(n.params.green)||H.ofConst(127,o,yy),s=t&&t.getProperty(n.params.blue)||H.ofConst(127,o,yy);else{let l=n.params.color;l=Fe.saturate(l,n.params.saturation),l=Fe.lighten(l,n.params.lightness);let[u,c,m]=Fe.toRgb(l);i=H.ofConst(u,o,yy),a=H.ofConst(c,o,yy),s=H.ofConst(m,o,yy)}return{kind:n.name,red:i,green:a,blue:s}}function Dye(e,t,r,n){let{kind:o,red:i,green:a,blue:s}=r,{ids:l,map:u,label:c}=n,{source:m,transforms:d}=e;return Gr.create("ply-mesh",m,t,p=>{let h=o==="material"?p:u[p];return Fe.fromRgb(i.value(h),a.value(h),s.value(h))},()=>1,p=>`${c} ${l[p]}`,d)}function AZe(){let e,t,r,n,o,i;return async(s,l,u,c)=>{let m=l.source.getElement("vertex");if(!m)throw new Error("missing vertex element");let d=l.source.getElement("face");if(!d)throw new Error("missing face element");let p=l.source.getElement("material"),h=!1,f=!1;return(!e||e!==l)&&(h=!0),(!t||!C.isParamEqual(_ye.grouping,t.grouping,u.grouping))&&(h=!0),(!t||!C.isParamEqual(_ye.coloring,t.coloring,u.coloring))&&(f=!0),h?(o=Rye(m,p,u),i=IZe(m,u),n=await vZe(s,m,d,i.ids,c&&c.geometry),r=Dye(l,n,o,i)):f&&(o=Rye(m,p,u),r=Dye(l,n,o,i)),e=l,t=Ya(u),r}}function Eye(e,t){return Pe.create("Shape Provider",async r=>({label:"Mesh",data:{source:e,transforms:t?.transforms},params:wye(e),getShape:AZe(),geometryUtils:ft.Utils}))}function rd(){return rd.empty()}(n=>{function e(o,i){return{size:o,anglesInRadians:i}}n.create=e;function t(){return e(b(),b())}n.empty=t;function r(o,i,a){let s=b.magnitude(o),l=b.magnitude(i),u=b.magnitude(a),c=Math.acos(b.dot(i,a)/(l*u)),m=Math.acos(b.dot(o,a)/(s*u)),d=Math.acos(b.dot(o,i)/(s*l));return s<=0||l<=0||u<=0||c>=Math.PI||m>=Math.PI||d>=Math.PI?t():e(b.create(s,l,u),b.create(c,m,d))}n.fromBasis=r})(rd||={});var TZe=20.45482949774598;function Mye(e){return Pe.create("Parse DCD",async t=>{await t.update("Converting to coordinates");let{header:r}=e,n=r.DELTA?rs(r.DELTA*TZe,"ps"):rs(1,"step"),o=r.ISTART>=1?rs((r.ISTART-1)*n.value,n.unit):rs(0,n.unit),i=[];for(let a=0,s=e.frames.length;a<s;++a){let l=e.frames[a],u={elementCount:l.elementCount,time:rs(o.value+n.value*a,n.unit),x:l.x,y:l.y,z:l.z,xyzOrdering:{isIdentity:!0}};if(l.cell){let c=l.cell;c[1]>=-1&&c[1]<=1&&c[3]>=-1&&c[3]<=1&&c[4]>=-1&&c[4]<=1?u.cell=rd.create(b.create(c[0],c[2],c[5]),b.create(vr(90-Math.asin(c[1])*90/YC),vr(90-Math.asin(c[3])*90/YC),vr(90-Math.asin(c[4])*90/YC))):c[0]<0||c[1]<0||c[2]<0||c[3]<0||c[4]<0||c[5]<0||c[3]>180||c[4]>180||c[5]>180?u.cell=rd.fromBasis(b.create(c[0],c[1],c[3]),b.create(c[1],c[2],c[4]),b.create(c[3],c[4],c[5])):u.cell=rd.create(b.create(c[0],c[2],c[5]),b.create(vr(eo(c[1],0,1e-6)?90:c[1]),vr(eo(c[3],0,1e-6)?90:c[3]),vr(eo(c[4],0,1e-6)?90:c[4])))}i.push(u)}return qm.create(i,n,o)})}function fI(e,t,r,n){let o=r,i=n-1,a=t.charCodeAt(o);for(;(a===32||a>=48&&a<=57)&&o<=i;)a=t.charCodeAt(++o);for(a=t.charCodeAt(i);(a===32||a>=48&&a<=57)&&i>=o;)a=t.charCodeAt(--i);if(++i,o===i)return je.add(e,o,i);if(o+1===i)return je.add(e,o,i);if(a=t.charCodeAt(o),o+2===i){let s=t.charCodeAt(o+1);if((a===78||a===110)&&(s===65||s===97)||(a===67||a===99)&&(s===76||s===108)||(a===70||a===102)&&(s===69||s===101)||(a===83||a===115)&&(s===73||s===105)||(a===66||a===98)&&(s===82||s===114)||(a===65||a===97)&&(s===83||s===115))return je.add(e,o,o+2)}if(a===67||a===99||a===72||a===104||a===78||a===110||a===79||a===111||a===80||a===112||a===83||a===115)return je.add(e,o,o+1);je.add(e,o,o)}var PZe=new Set(["NA","CL","FE","SI","BR","AS","LI"]),_Ze=new Set(["C","H","N","O","P","S","F","B"]),RZe=/^[\s\d]+|[\s\d]+$/g;function rp(e,t){e=e.replace(RZe,"").toUpperCase();let r=e.length;if(r===0||r===1||PZe.has(e))return e;if(r===3&&t===e){if(e==="SOD")return"NA";if(e==="POT")return"K";if(e==="CES")return"CS";if(e==="CAL")return"CA";if(e==="CLA")return"CL"}return _Ze.has(e[0])?e[0]:""}var D7="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function DZe(e){let t=D7.length,r=e,n=0,o=D7[r%t];for(;r>=t;)r=Math.floor(r/t),o+=D7[r%t],n+=1;return n>=5&&console.warn("getChainId overflow"),o}var yf=af(DZe);function wZe(e,t){let r=e.atomName,n=e.residueName,o=new Array(e.count),i=new Array(e.count),a=new Uint32Array(e.count),s=new Uint32Array(e.count),l=new Array(e.count),u=new _i,c=new Ri(e.residueNumber,e.atomName),m="",d=0,p="",h=0,f=0,y=-1;for(let S=0,I=e.count;S<I;++S){let v=e.residueNumber.value(S);if(v!==y){let A=e.residueName.value(S),_=Tl(c.add(A,S).type,A);(_!==f||v!==y+1&&!(y===99999&&v===0))&&(p=yf(d),d+=1,h=0),m=u.getEntityId(A,_,p),h+=1,y=v,f=_}o[S]=m,i[S]=p,a[S]=h,s[S]=S,l[S]=rp(e.atomName.value(S),e.residueName.value(S))}let g=H.ofStringArray(i),x=Cr.ofPartialColumns(Co.atom_site,{auth_asym_id:g,auth_atom_id:r,auth_comp_id:n,auth_seq_id:e.residueNumber,Cartn_x:H.ofFloatArray(H.mapToArray(e.x,S=>S*10,Float32Array)),Cartn_y:H.ofFloatArray(H.mapToArray(e.y,S=>S*10,Float32Array)),Cartn_z:H.ofFloatArray(H.mapToArray(e.z,S=>S*10,Float32Array)),id:H.ofIntArray(s),label_asym_id:g,label_atom_id:r,label_comp_id:n,label_seq_id:H.ofIntArray(a),label_entity_id:H.ofStringArray(o),occupancy:H.ofConst(1,e.count,H.Schema.float),type_symbol:H.ofStringArray(l),pdbx_PDB_model_num:H.ofConst(t,e.count,H.Schema.int)},e.count);return Gi({entity:u.getEntityTable(),chem_comp:c.getChemCompTable(),atom_site:x})}var Bye;(r=>{function e(n){return n?.kind==="gro"}r.is=e;function t(n){return{kind:"gro",name:n.structures[0].header.title,data:n}}r.fromGro=t})(Bye||={});function kye(e){return Pe.create("Parse GRO",async t=>{let r=Bye.fromGro(e),n=[];for(let o=0,i=e.structures.length;o<i;++o){let a=wZe(e.structures[o].atoms,o+1),s=await Fa(a,r,t);s.frameCount===1&&n.push(s.representative)}return new cl(n)})}function Fye(e,t){let r=(i,a)=>(t.substr(i,a)||"").trim(),n={entry_id:It.ofString(e),length_a:It.ofString(r(6,9)),length_b:It.ofString(r(15,9)),length_c:It.ofString(r(24,9)),angle_alpha:It.ofString(r(33,7)),angle_beta:It.ofString(r(40,7)),angle_gamma:It.ofString(r(47,7)),Z_PDB:It.ofString(r(66,4)),pdbx_unique_axis:It.ofString("?")},o={entry_id:It.ofString(e),"space_group_name_H-M":It.ofString(r(55,11)),Int_Tables_number:It.ofString("?"),cell_setting:It.ofString("?"),space_group_name_Hall:It.ofString("?")};return[qi.ofFields("cell",n),qi.ofFields("symmetry",o)]}function Lye(e,t){return{id:e,details:t,groups:[]}}function Vye(e,t,r){let n=[],o,i,a,s=1,l=1,u=f=>e.data.substring(e.indices[2*f],e.indices[2*f+1]);for(let f=t;f<r;f++){let y=u(f);if(y.substr(11,12)==="BIOMOLECULE:"){let g=y.substr(23).trim(),x=`Biomolecule ${g}`;y=u(f+1),y.substr(11,30)!=="APPLY THE FOLLOWING TO CHAINS:"&&(f++,x=y.substr(11).trim()),o=Lye(g,x),n.push(o)}else if(y.substr(13,5)==="BIOMT"){let g=y.split(/\s+/),x=parseInt(y[18])-1;x===0&&(a=Z.identity(),i.operators.push({id:s++,matrix:a})),Z.setValue(a,x,0,parseFloat(g[4])),Z.setValue(a,x,1,parseFloat(g[5])),Z.setValue(a,x,2,parseFloat(g[6])),Z.setValue(a,x,3,parseFloat(g[7]))}else if(y.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||y.substr(11,30)==="                   AND CHAINS:"){y.substr(11,5)==="APPLY"&&(i={chains:[],operators:[]},o.groups.push(i));let g=y.substr(41,30).split(",");for(let x=0,S=g.length;x<S;++x){let I=g[x].trim();I&&i.chains.push(I)}}else if(y.substr(11,33)==="APPLYING THE FOLLOWING TO CHAINS:"){o=Lye(`${l}`,`Biomolecule ${l}`),n.push(o),l+=1,i={chains:[],operators:[]},o.groups.push(i),f++,y=u(f);let g=y.substr(11,69).split(",");for(let x=0,S=g.length;x<S;++x){let I=g[x].trim();I&&i.chains.push(I)}}}if(n.length===0)return[];let c={id:It.ofStrings(n.map(f=>f.id)),details:It.ofStrings(n.map(f=>f.details))},m=[];for(let f of n)for(let y of f.groups)m.push({assembly_id:f.id,oper_expression:y.operators.map(g=>g.id).join(","),asym_id_list:y.chains.join(",")});let d={assembly_id:It.ofStrings(m.map(f=>f.assembly_id)),oper_expression:It.ofStrings(m.map(f=>f.oper_expression)),asym_id_list:It.ofStrings(m.map(f=>f.asym_id_list))},p=[];for(let f of n)for(let y of f.groups)for(let g of y.operators){let x={id:""+g.id,type:"?",name:"?",symmetry_operation:"?"};for(let S=0;S<3;S++){for(let I=0;I<3;I++)x[`matrix[${S+1}][${I+1}]`]=""+Z.getValue(g.matrix,S,I);x[`vector[${S+1}]`]=""+Z.getValue(g.matrix,S,3)}p.push(x)}let h={id:It.ofStrings(p.map(f=>f.id)),type:It.ofStrings(p.map(f=>f.type)),name:It.ofStrings(p.map(f=>f.name)),symmetry_operation:It.ofStrings(p.map(f=>f.symmetry_operation))};for(let f=0;f<3;f++){for(let g=0;g<3;g++){let x=`matrix[${f+1}][${g+1}]`;h[x]=It.ofStrings(p.map(S=>S[x]))}let y=`vector[${f+1}]`;h[y]=It.ofStrings(p.map(g=>g[y]))}return[qi.ofFields("pdbx_struct_assembly",c),qi.ofFields("pdbx_struct_assembly_gen",d),qi.ofFields("pdbx_struct_oper_list",h)]}function Oye(e,t,r){let n=[],o,i=u=>e.data.substring(e.indices[2*u],e.indices[2*u+1]);for(let u=t;u<r;u++){let c=i(u),m=c.split(/\s+/),d=parseInt(c[5])-1;d===0&&(o=Z.identity(),n.push(o)),Z.setValue(o,d,0,parseFloat(m[2])),Z.setValue(o,d,1,parseFloat(m[3])),Z.setValue(o,d,2,parseFloat(m[4])),Z.setValue(o,d,3,parseFloat(m[5]))}if(n.length===0)return[];let a=[],s=1;for(let u of n){let c={id:"ncsop"+s++,code:".",details:"."};for(let m=0;m<3;m++){for(let d=0;d<3;d++)c[`matrix[${m+1}][${d+1}]`]=""+Z.getValue(u,m,d);c[`vector[${m+1}]`]=""+Z.getValue(u,m,3)}a.push(c)}let l={id:It.ofStrings(a.map(u=>u.id)),code:It.ofStrings(a.map(u=>u.code)),details:It.ofStrings(a.map(u=>u.details))};for(let u=0;u<3;u++){for(let m=0;m<3;m++){let d=`matrix[${u+1}][${m+1}]`;l[d]=It.ofStrings(a.map(p=>p[d]))}let c=`vector[${u+1}]`;l[c]=It.ofStrings(a.map(m=>m[c]))}return[qi.ofFields("struct_ncs_oper",l)]}var EZe={1:"helx_rh_al_p",2:"helx_rh_om_p",3:"helx_rh_pi_p",4:"helx_rh_ga_p",5:"helx_rh_3t_p",6:"helx_lh_al_p",7:"helx_lh_om_p",8:"helx_lh_ga_p",9:"helx_rh_27_p",10:"helx_rh_pp_p"};function MZe(e){return EZe[e]||"helx_p"}function Gye(e,t,r){let n=[],o=c=>e.data.substring(e.indices[2*c],e.indices[2*c+1]);for(let c=t;c<r;c++){let m=o(c);n.push({serNum:m.substr(7,3).trim(),helixID:m.substr(11,3).trim(),initResName:m.substr(15,3).trim(),initChainID:m.substr(19,1).trim(),initSeqNum:m.substr(21,4).trim(),initICode:m.substr(25,1).trim(),endResName:m.substr(27,3).trim(),endChainID:m.substr(31,3).trim(),endSeqNum:m.substr(33,4).trim(),endICode:m.substr(37,1).trim(),helixClass:m.substr(38,2).trim(),comment:m.substr(40,30).trim(),length:m.substr(71,5).trim()})}let i=It.ofStrings(n.map(c=>c.initChainID)),a=It.ofStrings(n.map(c=>c.initResName)),s=It.ofStrings(n.map(c=>c.endChainID)),l=It.ofStrings(n.map(c=>c.endResName)),u={beg_label_asym_id:i,beg_label_comp_id:a,beg_label_seq_id:It.ofUndefined(n.length,H.Schema.int),beg_auth_asym_id:i,beg_auth_comp_id:a,beg_auth_seq_id:It.ofStrings(n.map(c=>c.initSeqNum)),conf_type_id:It.ofStrings(n.map(c=>MZe(c.helixClass))),details:It.ofStrings(n.map(c=>c.comment)),end_label_asym_id:s,end_label_comp_id:l,end_label_seq_id:It.ofUndefined(n.length,H.Schema.int),end_auth_asym_id:s,end_auth_comp_id:l,end_auth_seq_id:It.ofStrings(n.map(c=>c.endSeqNum)),id:It.ofStrings(n.map(c=>c.serNum)),pdbx_beg_PDB_ins_code:It.ofStrings(n.map(c=>c.initICode)),pdbx_end_PDB_ins_code:It.ofStrings(n.map(c=>c.endICode)),pdbx_PDB_helix_class:It.ofStrings(n.map(c=>c.helixClass)),pdbx_PDB_helix_length:It.ofStrings(n.map(c=>c.length)),pdbx_PDB_helix_id:It.ofStrings(n.map(c=>c.helixID))};return qi.ofFields("struct_conf",u)}function Uye(e,t,r){let n=[],o=d=>e.data.substring(e.indices[2*d],e.indices[2*d+1]);for(let d=t;d<r;d++){let p=o(d);n.push({strand:p.substr(7,3).trim(),sheetID:p.substr(11,3).trim(),numStrands:p.substr(14,2).trim(),initResName:p.substr(17,3).trim(),initChainID:p.substr(21,1).trim(),initSeqNum:p.substr(22,4).trim(),initICode:p.substr(26,1).trim(),endResName:p.substr(28,3).trim(),endChainID:p.substr(32,1).trim(),endSeqNum:p.substr(33,4).trim(),endICode:p.substr(37,1).trim(),sense:p.substr(38,2).trim(),curAtom:p.substr(41,4).trim(),curResName:p.substr(45,3).trim(),curChainId:p.substr(49,1).trim(),curResSeq:p.substr(50,4).trim(),curICode:p.substr(54,1).trim(),prevAtom:p.substr(56,4).trim(),prevResName:p.substr(60,3).trim(),prevChainId:p.substr(64,1).trim(),prevResSeq:p.substr(65,4).trim(),prevICode:p.substr(69,1).trim()})}let i=It.ofStrings(n.map(d=>d.initChainID)),a=It.ofStrings(n.map(d=>d.initResName)),s=It.ofStrings(n.map(d=>d.initSeqNum)),l=It.ofStrings(n.map(d=>d.endChainID)),u=It.ofStrings(n.map(d=>d.endResName)),c=It.ofStrings(n.map(d=>d.endSeqNum)),m={beg_label_asym_id:i,beg_label_comp_id:a,beg_label_seq_id:s,beg_auth_asym_id:i,beg_auth_comp_id:a,beg_auth_seq_id:s,end_label_asym_id:l,end_label_comp_id:l,end_label_seq_id:c,end_auth_asym_id:l,end_auth_comp_id:u,end_auth_seq_id:c,id:It.ofStrings(n.map(d=>d.strand)),sheet_id:It.ofStrings(n.map(d=>d.sheetID)),pdbx_beg_PDB_ins_code:It.ofStrings(n.map(d=>d.initICode)),pdbx_end_PDB_ins_code:It.ofStrings(n.map(d=>d.endICode))};return qi.ofFields("struct_sheet_range",m)}var BZe={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function Nye(e,t,r){let n=l=>e.data.substring(e.indices[2*l],e.indices[2*l+1]),o,i={chains:[],description:""},a=[];for(let l=t;l<r;l++){let c=n(l).substr(10,70).trim(),m=c.indexOf(":"),d=c.substring(0,m),p;d in BZe?(o=d,p=c.substring(m+2)):p=c,p=p.replace(/;$/,""),o==="MOL_ID"?(i={chains:[],description:""},a.push(i)):o==="MOLECULE"?(i.description&&(i.description+=" "),i.description+=p):o==="CHAIN"&&Array.prototype.push.apply(i.chains,p.split(/\s*,\s*/))}let s=[];for(let l of a)for(let u of l.chains)s.push({description:l.description,chains:[u]});return s}function zye(e,t,r){let n=i=>e.data.substring(e.indices[2*i],e.indices[2*i+1]),o=new Map;for(let i=t;i<r;i++){let a=n(i),s=a.substr(11,3).trim(),l=a.substr(15).trim();o.has(s)?o.set(s,`${o.get(s)} ${l}`):o.set(s,l)}return o}function Hye(e,t){let r=()=>[],n=()=>je.create(e,2*t);return{index:0,group_PDB:n(),id:r(),auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:r(),label_entity_id:r(),partial_charge:n()}}var pk=class{constructor(t,r,n,o){this.asymIds=t;this.modelNums=r;this.terIndices=n;this.hasAssemblies=o;this.asymIdCounts=new Map;this.currModelNum=void 0;this.currAsymId="";this.currLabelAsymId=""}clear(){this.asymIdCounts.clear(),this.currModelNum=void 0}get(t){let r=this.asymIds.value(t);if(this.hasAssemblies)return r;let n=this.modelNums[t];if(n!==this.currModelNum?(this.asymIdCounts.clear(),this.currModelNum=n,this.currLabelAsymId=r):this.currAsymId!==r&&(this.currAsymId=r,this.currLabelAsymId=r),this.asymIdCounts.has(r)){if(this.terIndices.has(t)){let o=this.asymIdCounts.get(r)+1;this.asymIdCounts.set(r,o),this.currLabelAsymId=`${r}_${o}`}}else this.asymIdCounts.set(r,0);return this.currLabelAsymId}};function jye(e,t,r){t.clear();let n=It.ofStrings(e.pdbx_PDB_model_num),o=It.ofTokens(e.auth_asym_id),i=It.ofTokens(e.auth_seq_id),a=It.ofTokens(e.pdbx_PDB_ins_code),s=It.ofTokens(e.auth_atom_id),l=It.ofTokens(e.auth_comp_id),u=It.ofStrings(e.id),c=n.str(0),m=o.str(0),d=i.int(0),p=a.str(0),h=d,f=new Map,y=new Map,g=[],x=[],S=[],I=!1;for(let T=0,w=u.rowCount;T<w;++T)if(a.str(T)!==""){I=!0;break}for(let T=0,w=u.rowCount;T<w;++T){let D=n.str(T),M=o.str(T),E=i.int(T),R=a.str(T),k=s.str(T);if(D!==c?(f.clear(),y.clear(),c=D,m=M,d=E,p=R,h=E):m!==M?(y.clear(),m=M,d=E,p=R,h=E):d!==E?(y.clear(),d===h?h=E:h+=1,d=E,p=R):p!==R&&(y.clear(),p=R,h+=1),g[T]=t.get(T),y.has(k)){let B=y.get(k)+1;y.set(k,B),k=`${k}_${B}`}else y.set(k,0);x[T]=k,I&&(S[T]=h)}let v=H.ofStringArray(g),A=H.ofStringArray(x),_=I?It.ofColumn(H.ofIntArray(S)):It.ofUndefined(e.index,H.Schema.int);return{auth_asym_id:o,auth_atom_id:s,auth_comp_id:l,auth_seq_id:i,B_iso_or_equiv:It.ofTokens(e.B_iso_or_equiv),Cartn_x:It.ofTokens(e.Cartn_x),Cartn_y:It.ofTokens(e.Cartn_y),Cartn_z:It.ofTokens(e.Cartn_z),group_PDB:It.ofTokens(e.group_PDB),id:u,label_alt_id:It.ofTokens(e.label_alt_id),label_asym_id:It.ofColumn(v),label_atom_id:It.ofColumn(A),label_comp_id:l,label_seq_id:_,label_entity_id:It.ofStrings(e.label_entity_id),occupancy:kse(e.occupancy)?It.ofUndefined(e.index,H.Schema.float):It.ofTokens(e.occupancy),type_symbol:It.ofTokens(e.type_symbol),pdbx_PDB_ins_code:It.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:n,partial_charge:It.ofTokens(e.partial_charge)}}function w7(e,t,r,n,o,i){let{data:a}=r,s=o-n;je.addToken(e.group_PDB,yt.trim(r,n,n+6)),yt.trim(r,n+6,n+11),e.id[e.index]=r.data.substring(r.tokenStart,r.tokenEnd),je.addToken(e.auth_atom_id,yt.trim(r,n+12,n+16)),a.charCodeAt(n+16)===32?je.add(e.label_alt_id,0,0):je.add(e.label_alt_id,n+16,n+17),je.addToken(e.auth_comp_id,yt.trim(r,n+17,n+20)),je.add(e.auth_asym_id,n+21,n+22),je.addToken(e.auth_seq_id,yt.trim(r,n+22,n+26)),a.charCodeAt(n+26)===32?je.add(e.pdbx_PDB_ins_code,0,0):je.add(e.pdbx_PDB_ins_code,n+26,n+27),je.addToken(e.Cartn_x,yt.trim(r,n+30,n+38)),je.addToken(e.Cartn_y,yt.trim(r,n+38,n+46)),je.addToken(e.Cartn_z,yt.trim(r,n+46,n+54)),je.addToken(e.occupancy,yt.trim(r,n+54,n+60)),s>=66?je.addToken(e.B_iso_or_equiv,yt.trim(r,n+60,n+66)):je.add(e.B_iso_or_equiv,0,0),i&&je.addToken(e.partial_charge,yt.trim(r,n+70,n+76)),s>=78&&!i?(yt.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?je.addToken(e.type_symbol,r):fI(e.type_symbol,a,n+12,n+16)):fI(e.type_symbol,a,n+12,n+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function Wye(e,t){let r=()=>[],n=()=>new Float32Array(t),o=()=>je.create(e,2*t);return{index:0,count:t,id:r(),type_symbol:o(),pdbx_label_atom_id:o(),pdbx_label_alt_id:o(),pdbx_label_comp_id:o(),pdbx_label_asym_id:o(),pdbx_label_seq_id:o(),pdbx_PDB_ins_code:o(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:o(),pdbx_auth_comp_id:o(),pdbx_auth_asym_id:o(),pdbx_auth_atom_id:o()}}function Xye(e){let t=It.ofTokens(e.pdbx_auth_seq_id),r=It.ofTokens(e.pdbx_auth_comp_id),n=It.ofTokens(e.pdbx_auth_asym_id),o=It.ofTokens(e.pdbx_auth_atom_id),i={id:It.ofStrings(e.id),type_symbol:It.ofTokens(e.type_symbol),pdbx_label_atom_id:o,pdbx_label_alt_id:It.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:r,pdbx_label_asym_id:n,pdbx_label_seq_id:t,pdbx_PDB_ins_code:It.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:r,pdbx_auth_asym_id:n,pdbx_auth_atom_id:o};return i["U[1][1]"]=It.ofNumbers(e["U[1][1]"]),i["U[2][2]"]=It.ofNumbers(e["U[2][2]"]),i["U[3][3]"]=It.ofNumbers(e["U[3][3]"]),i["U[1][2]"]=It.ofNumbers(e["U[1][2]"]),i["U[1][3]"]=It.ofNumbers(e["U[1][3]"]),i["U[2][3]"]=It.ofNumbers(e["U[2][3]"]),i}function Qye(e,t,r,n,o){let{data:i}=r,a=o-n;yt.trim(r,n+6,n+11),e.id[e.index]=i.substring(r.tokenStart,r.tokenEnd),je.addToken(e.pdbx_auth_atom_id,yt.trim(r,n+12,n+16)),i.charCodeAt(n+16)===32?je.add(e.pdbx_label_alt_id,0,0):je.add(e.pdbx_label_alt_id,n+16,n+17),je.addToken(e.pdbx_auth_comp_id,yt.trim(r,n+17,n+20)),je.add(e.pdbx_auth_asym_id,n+21,n+22),je.addToken(e.pdbx_auth_seq_id,yt.trim(r,n+22,n+26)),i.charCodeAt(n+26)===32?je.add(e.pdbx_PDB_ins_code,0,0):je.add(e.pdbx_PDB_ins_code,n+26,n+27),e["U[1][1]"][e.index]=Hg(i,n+28,n+35)/1e4,e["U[2][2]"][e.index]=Hg(i,n+35,n+42)/1e4,e["U[3][3]"][e.index]=Hg(i,n+42,n+49)/1e4,e["U[1][2]"][e.index]=Hg(i,n+49,n+56)/1e4,e["U[1][3]"][e.index]=Hg(i,n+56,n+63)/1e4,e["U[2][3]"][e.index]=Hg(i,n+63,n+70)/1e4,a>=78?(yt.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?je.addToken(e.type_symbol,r):fI(e.type_symbol,i,n+12,n+16)):fI(e.type_symbol,i,n+12,n+16),e.index++}function Zye(e,t,r,n){let o={};for(let _=0,T=n.id.rowCount;_<T;++_)o[n.id.str(_)]=_;let i=_=>e.data.substring(e.indices[2*_],e.indices[2*_+1]),a=[],s=[],l=[],u=[],c=[],m=[],d=[],p=[],h=[],f=[],y=[],g=[],x=[],S=[],I=[11,16,21,26],v=1;for(let _=t;_<r;_++){let T=i(_),w=o[parseInt(T.substr(6,5))],D={};if(w!==void 0)for(let M=0;M<4;++M){let E=parseInt(T.substr(I[M],5));if(Number.isNaN(E))continue;let R=o[E];R!==void 0&&(w>R||D[R]===void 0&&(a.push(`covale${v}`),s.push("covale"),l.push(n.label_asym_id.str(w)),u.push(n.label_seq_id.int(w)),c.push(n.auth_seq_id.int(w)),m.push(n.label_atom_id.str(w)),d.push(n.label_alt_id.str(w)),p.push(n.pdbx_PDB_ins_code.str(w)),h.push(n.label_asym_id.str(R)),f.push(n.label_seq_id.int(R)),y.push(n.auth_seq_id.int(R)),g.push(n.label_atom_id.str(R)),x.push(n.label_alt_id.str(R)),S.push(n.pdbx_PDB_ins_code.str(R)),v+=1))}}let A={id:It.ofStrings(a),conn_type_id:It.ofStrings(s),ptnr1_label_asym_id:It.ofStrings(l),ptnr1_label_seq_id:It.ofNumbers(u),ptnr1_auth_seq_id:It.ofNumbers(c),ptnr1_label_atom_id:It.ofStrings(m),pdbx_ptnr1_label_alt_id:It.ofStrings(d),pdbx_ptnr1_PDB_ins_code:It.ofStrings(p),ptnr2_label_asym_id:It.ofStrings(h),ptnr2_label_seq_id:It.ofNumbers(f),ptnr2_auth_seq_id:It.ofNumbers(y),ptnr2_label_atom_id:It.ofStrings(g),pdbx_ptnr2_label_alt_id:It.ofStrings(x),pdbx_ptnr2_PDB_ins_code:It.ofStrings(S)};return qi.ofFields("struct_conn",A)}function qye(e,t,r,n){let o=e.substring(t,r);n.id_code=o.substring(62,66).trim()||void 0,n.dep_date=o.substring(50,59).trim()||void 0,n.classification=o.substring(10,50).trim()||void 0}async function Yye(e){let{lines:t}=e,{data:r,indices:n}=t,o=yt(r),i=!!e.isPdbqt,a=0,s=0;for(let M=0,E=t.count;M<E;M++){let R=n[2*M],k=n[2*M+1];switch(r.charAt(R)){case"A":ra(r,R,k,"ATOM  ")?a++:ra(r,R,k,"ANISOU")&&s++;break;case"H":ra(r,R,k,"HETATM")&&a++;break}}let l={},u=Hye(r,a),c=Wye(r,s),m=new _i,d=[],p=[],h=0,f="",y,g=!1,x=new Set;for(let M=0,E=t.count;M<E;M++){let R=n[2*M],k=n[2*M+1];switch(r.charAt(R)){case"A":ra(r,R,k,"ATOM  ")?(h||(h++,f=""+h),w7(u,f,o,R,k,i)):ra(r,R,k,"ANISOU")&&Qye(c,f,o,R,k);break;case"C":if(ra(r,R,k,"CRYST1"))d.push(...Fye(e.id||"?",r.substring(R,k)));else if(ra(r,R,k,"CONECT")){let B=M+1;for(;R=n[2*B],k=n[2*B+1],!!ra(r,R,k,"CONECT");)B++;y?$t&&console.log("only single CONECT block allowed, ignoring others"):y=[M,B],M=B-1}else if(ra(r,R,k,"COMPND")){let B=M+1;for(;R=n[2*B],k=n[2*B+1],!!ra(r,R,k,"COMPND");)B++;m.setCompounds(Nye(t,M,B)),M=B-1}break;case"H":if(ra(r,R,k,"HEADER"))qye(r,R,k,l);else if(ra(r,R,k,"HETATM"))h||(h++,f=""+h),w7(u,f,o,R,k,i);else if(ra(r,R,k,"HELIX")){let B=M+1;for(;R=n[2*B],k=n[2*B+1],!!ra(r,R,k,"HELIX");)B++;d.push(Gye(t,M,B)),M=B-1}else if(ra(r,R,k,"HETNAM")){let B=M+1;for(;R=n[2*B],k=n[2*B+1],!!ra(r,R,k,"HETNAM");)B++;p.push(...Array.from(zye(t,M,B).entries())),M=B-1}break;case"M":if(ra(r,R,k,"MODEL ")&&(h++,f=""+h),ra(r,R,k,"MTRIX")){let B=M+1;for(;R=n[2*B],k=n[2*B+1],!!ra(r,R,k,"MTRIX");)B++;d.push(...Oye(t,M,B)),M=B-1}break;case"O":break;case"R":if(ra(r,R,k,"REMARK 350")){let B=M+1;for(;R=n[2*B],k=n[2*B+1],!!ra(r,R,k,"REMARK 350");)B++;d.push(...Vye(t,M,B)),M=B-1,g=!0}break;case"S":if(ra(r,R,k,"SHEET")){let B=M+1;for(;R=n[2*B],k=n[2*B+1],!!ra(r,R,k,"SHEET");)B++;d.push(Uye(t,M,B)),M=B-1}break;case"T":ra(r,R,k,"TER")&&x.add(u.index)}}if(l.id_code){let M={id:It.ofString(l.id_code)};d.push(qi.ofFields("entry",M))}if(l.classification){let M={pdbx_keywords:It.ofString(l.classification)};d.push(qi.ofFields("struct_keywords",M))}if(l.dep_date){let M={recvd_initial_deposition_date:It.ofString(l.dep_date)};d.push(qi.ofFields("pdbx_database_status",M))}let S=H.ofIntTokens(u.auth_seq_id),I=H.ofStringTokens(u.auth_atom_id),v=H.ofStringTokens(u.auth_comp_id),A=H.ofStringTokens(u.auth_asym_id),_=new pk(A,u.pdbx_PDB_model_num,x,g),T=new Ri(S,I);T.setNames(p),m.setNames(p);for(let M=0,E=v.rowCount;M<E;++M){let R=v.value(M),k=Tl(T.add(R,M).type,R),B=_.get(M);u.label_entity_id[M]=m.getEntityId(R,k,B)}let w=jye(u,_,{hasAssemblies:g});i||delete w.partial_charge,y&&d.push(Zye(t,y[0],y[1],w));let D={entity:qi.ofTable("entity",m.getEntityTable()),chem_comp:qi.ofTable("chem_comp",T.getChemCompTable()),atom_site:qi.ofFields("atom_site",w),atom_site_anisotrop:qi.ofFields("atom_site_anisotrop",Xye(c))};for(let M of d)D[M.name]=M;return{header:e.id||"PDB",categoryNames:Object.keys(D),categories:D}}var Kye;(r=>{function e(n){return n?.kind==="pdb"}r.is=e;function t(n){return{kind:"pdb",name:n.id||"",data:n}}r.create=t})(Kye||={});function Jye(e){return Pe.create("Parse PDB",async t=>{await t.update("Converting to mmCIF");let r=await Yye(e),n=Cn.fromFrame(r,void 0,Kye.create(e)),o=Gi(n.data.db,!0),i=await Fa(o,n,t),a=r.categories.atom_site?.getField("partial_charge");if(a&&i.frameCount===1){let s=i.representative,l=s.atomicHierarchy.atomSourceIndex,c=H.isIdentity(l)?void 0:l.toArray({array:Int32Array}),m=a.toFloatArray(),d=c?H.ofFloatArray(H.mapToArray(l,p=>m[p],Float32Array)):H.ofFloatArray(m);kh.Provider.set(s,{data:d,type:"GASTEIGER"})}return i})}function kZe(e){let t=new Array(e.count),r=new Array(e.count),n=new Uint32Array(e.count),o=new Uint32Array(e.count),i=new Array(e.count),a=new _i,s=new Ri(e.residueId,e.atomName),l="",u=0,c="",m=0,d=e.segmentName.value(0),p=!1,h=0,f=-1;for(let g=0,x=e.count;g<x;++g){let S=e.residueId.value(g),I=e.segmentName.value(g);if(d!==I?(c=yf(u),u+=1,m=0,p=!0,d=I):p=!1,p||S!==f){let v=e.residueName.value(g),A=Tl(s.add(v,g).type,v);!p&&(A!==h||S!==f+1)&&(c=yf(u),u+=1,m=0),l=a.getEntityId(v,A,c),m+=1,f=S,h=A}t[g]=l,r[g]=c,n[g]=m,o[g]=g,i[g]=rp(e.atomName.value(g),e.residueName.value(g))}let y=Cr.ofPartialColumns(Co.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:H.ofIntArray(o),label_asym_id:H.ofStringArray(r),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:H.ofIntArray(n),label_entity_id:H.ofStringArray(t),occupancy:H.ofConst(1,e.count,H.Schema.float),type_symbol:H.ofStringArray(i),pdbx_PDB_model_num:H.ofConst(1,e.count,H.Schema.int)},e.count);return Gi({entity:a.getEntityTable(),chem_comp:s.getChemCompTable(),atom_site:y})}var $ye;(r=>{function e(n){return n?.kind==="psf"}r.is=e;function t(n){return{kind:"psf",name:n.id,data:n}}r.fromPsf=t})($ye||={});function ebe(e){return Pe.create("Parse PSF",async t=>{let r=$ye.fromPsf(e),n=kZe(e.atoms),{atomIdA:o,atomIdB:i}=e.bonds,a={indexA:H.ofLambda({value:s=>o.value(s)-1,rowCount:o.rowCount,schema:o.schema}),indexB:H.ofLambda({value:s=>i.value(s)-1,rowCount:i.rowCount,schema:i.schema}),order:H.ofConst(1,e.bonds.count,H.Schema.int)};return B0.create(e.id,n,a,r)})}function tbe(e){return Object.keys(e).filter(t=>!isNaN(t)).map(t=>+t).sort((t,r)=>t-r).map(t=>e[t])}function fk(e,t,r){return e&&e[t]!==void 0?e[t]:r}function mt(e,...t){return{kind:"alias",aliases:t,symbol:e}}function hk(e,t,...r){return e.info.namespace="molscript-macro",e.id=`molscript-macro.${e.info.name}`,{kind:"macro",symbol:e,translate:t,aliases:[e.info.name,...r]}}function LZe(e){return e.kind==="alias"||e.kind==="macro"}var FZe=[["Core symbols",mt(Te.core.type.bool,"bool"),mt(Te.core.type.num,"num"),mt(Te.core.type.str,"str"),mt(Te.core.type.regex,"regex"),mt(Te.core.type.list,"list"),mt(Te.core.type.set,"set"),mt(Te.core.type.compositeKey,"composite-key"),mt(Te.core.logic.not,"not"),mt(Te.core.logic.and,"and"),mt(Te.core.logic.or,"or"),mt(Te.core.ctrl.if,"if"),mt(Te.core.ctrl.fn,"fn"),mt(Te.core.ctrl.eval,"eval"),mt(Te.core.math.add,"add","+"),mt(Te.core.math.sub,"sub","-"),mt(Te.core.math.mult,"mult","*"),mt(Te.core.math.div,"div","/"),mt(Te.core.math.pow,"pow","**"),mt(Te.core.math.mod,"mod"),mt(Te.core.math.min,"min"),mt(Te.core.math.max,"max"),mt(Te.core.math.cantorPairing,"cantor-pairing"),mt(Te.core.math.sortedCantorPairing,"sorted-cantor-pairing"),mt(Te.core.math.invertCantorPairing,"invert-cantor-pairing"),mt(Te.core.math.floor,"floor"),mt(Te.core.math.ceil,"ceil"),mt(Te.core.math.roundInt,"round"),mt(Te.core.math.trunc,"trunc"),mt(Te.core.math.abs,"abs"),mt(Te.core.math.sign,"sign"),mt(Te.core.math.sqrt,"sqrt"),mt(Te.core.math.cbrt,"cbrt"),mt(Te.core.math.sin,"sin"),mt(Te.core.math.cos,"cos"),mt(Te.core.math.tan,"tan"),mt(Te.core.math.asin,"asin"),mt(Te.core.math.acos,"acos"),mt(Te.core.math.atan,"atan"),mt(Te.core.math.sinh,"sinh"),mt(Te.core.math.cosh,"cosh"),mt(Te.core.math.tanh,"tanh"),mt(Te.core.math.exp,"exp"),mt(Te.core.math.log,"log"),mt(Te.core.math.log10,"log10"),mt(Te.core.math.atan2,"atan2"),mt(Te.core.rel.eq,"eq","="),mt(Te.core.rel.neq,"neq","!="),mt(Te.core.rel.lt,"lt","<"),mt(Te.core.rel.lte,"lte","<="),mt(Te.core.rel.gr,"gr",">"),mt(Te.core.rel.gre,"gre",">="),mt(Te.core.rel.inRange,"in-range"),mt(Te.core.str.concat,"concat"),mt(Te.core.str.match,"regex.match"),mt(Te.core.list.getAt,"list.get"),mt(Te.core.set.has,"set.has"),mt(Te.core.set.isSubset,"set.subset")],["Structure",["Types",mt(Te.structureQuery.type.entityType,"ent-type"),mt(Te.structureQuery.type.authResidueId,"auth-resid"),mt(Te.structureQuery.type.labelResidueId,"label-resid"),mt(Te.structureQuery.type.ringFingerprint,"ringfp"),mt(Te.structureQuery.type.bondFlags,"bond-flags")],["Slots",mt(Te.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",mt(Te.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),mt(Te.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),mt(Te.structureQuery.generator.rings,"sel.atom.rings"),mt(Te.structureQuery.generator.empty,"sel.atom.empty"),mt(Te.structureQuery.generator.all,"sel.atom.all"),mt(Te.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),hk(O0("sel.atom.atoms",ar.Dictionary({0:St(we.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),Nt.ElementSelection,"A selection of singleton atom sets."),e=>ne.struct.generator.atomGroups({"atom-test":fk(e,0,!0)})),hk(O0("sel.atom.res",ar.Dictionary({0:St(we.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),Nt.ElementSelection,"A selection of atom sets grouped by residue."),e=>ne.struct.generator.atomGroups({"residue-test":fk(e,0,!0),"group-by":ne.ammp("residueKey")})),hk(O0("sel.atom.chains",ar.Dictionary({0:St(we.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),Nt.ElementSelection,"A selection of atom sets grouped by chain."),e=>ne.struct.generator.atomGroups({"chain-test":fk(e,0,!0),"group-by":ne.ammp("chainKey")}))],["Modifiers",mt(Te.structureQuery.modifier.queryEach,"sel.atom.query-each"),mt(Te.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),mt(Te.structureQuery.modifier.exceptBy,"sel.atom.except-by"),mt(Te.structureQuery.modifier.unionBy,"sel.atom.union-by"),mt(Te.structureQuery.modifier.union,"sel.atom.union"),mt(Te.structureQuery.modifier.cluster,"sel.atom.cluster"),mt(Te.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),mt(Te.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),mt(Te.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),mt(Te.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",mt(Te.structureQuery.filter.pick,"sel.atom.pick"),mt(Te.structureQuery.filter.first,"sel.atom.first"),mt(Te.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),mt(Te.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),mt(Te.structureQuery.filter.within,"sel.atom.within"),mt(Te.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",mt(Te.structureQuery.combinator.intersect,"sel.atom.intersect"),mt(Te.structureQuery.combinator.merge,"sel.atom.merge"),mt(Te.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",mt(Te.structureQuery.atomSet.atomCount,"atom.set.atom-count"),mt(Te.structureQuery.atomSet.countQuery,"atom.set.count-query"),mt(Te.structureQuery.atomSet.reduce,"atom.set.reduce"),mt(Te.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",mt(Te.structureQuery.atomProperty.core.elementSymbol,"atom.el"),mt(Te.structureQuery.atomProperty.core.vdw,"atom.vdw"),mt(Te.structureQuery.atomProperty.core.mass,"atom.mass"),mt(Te.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),mt(Te.structureQuery.atomProperty.core.x,"atom.x"),mt(Te.structureQuery.atomProperty.core.y,"atom.y"),mt(Te.structureQuery.atomProperty.core.z,"atom.z"),mt(Te.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),mt(Te.structureQuery.atomProperty.core.operatorName,"atom.op-name"),mt(Te.structureQuery.atomProperty.core.instanceId,"atom.instance-id"),mt(Te.structureQuery.atomProperty.core.operatorKey,"atom.op-key"),mt(Te.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),mt(Te.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),mt(Te.structureQuery.atomProperty.core.atomKey,"atom.key"),mt(Te.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),mt(Te.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),mt(Te.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),mt(Te.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),mt(Te.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),mt(Te.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),mt(Te.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),mt(Te.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),mt(Te.structureQuery.atomProperty.macromolecular.id,"atom.id"),mt(Te.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),mt(Te.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),mt(Te.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),mt(Te.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),mt(Te.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),mt(Te.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),mt(Te.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),mt(Te.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),mt(Te.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),mt(Te.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),mt(Te.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),mt(Te.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),mt(Te.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),mt(Te.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),mt(Te.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),mt(Te.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),mt(Te.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),mt(Te.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),mt(Te.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),mt(Te.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),mt(Te.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),mt(Te.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),mt(Te.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent"),mt(Te.structureQuery.atomProperty.ihm.hasSeqId,"atom.ihm.has-seq-id"),mt(Te.structureQuery.atomProperty.ihm.overlapsSeqIdRange,"atom.ihm.overlaps-seq-id-range")],["Bond Properties",mt(Te.structureQuery.bondProperty.order,"bond.order"),mt(Te.structureQuery.bondProperty.length,"bond.length"),mt(Te.structureQuery.bondProperty.key,"bond.key"),mt(Te.structureQuery.bondProperty.atomA,"bond.atom-a"),mt(Te.structureQuery.bondProperty.atomB,"bond.atom-b"),hk(O0("bond.is",ar.List(Nt.BondFlag),we.Bool,`Test if the current bond has at least one (or all if partial = false) of the specified flags: ${we.oneOfValues(Nt.BondFlag).join(", ")}`),e=>ne.core.flags.hasAny([ne.struct.bondProperty.flags(),ne.struct.type.bondFlags(tbe(e))]))]]],rbe=[];function nbe(e){for(let t of e)LZe(t)?rbe.push(t):t instanceof Array&&nbe(t)}nbe(FZe);var gk=function(){let e=[],t=Object.create(null),r=Tn.create(),n=Tn.create();for(let o of rbe){for(let a of o.aliases){if(e.push([a,o]),t[a])throw new Error(`Alias '${a}' already in use.`);t[a]=o}let i=o.symbol.args;if(i.kind!=="dictionary"){i.type.kind==="oneof"&&we.oneOfValues(i.type).forEach(a=>Tn.add(n,a,a));continue}for(let a of Object.keys(i.map)){isNaN(a)&&Tn.add(r,a,a);let s=i.map[a];s.type.kind==="oneof"&&we.oneOfValues(s.type).forEach(l=>Tn.add(n,l,l))}}return{symbolList:e,symbolMap:t,namedArgs:r.array,constants:n.array}}();var tSr=gk.constants,rSr=gk.namedArgs,hI=gk.symbolMap,nSr=gk.symbolList;function x_(e){if(La.isLiteral(e))return e;if(La.isSymbol(e)){if(!hI[e.name])return e;let a=hI[e.name];if(a.kind==="alias")return La.Symbol(hI[e.name].symbol.id);throw a.translate([])}let t=La.isSymbol(e.head)&&!!hI[e.head.name]&&hI[e.head.name].kind==="macro",r=t?e.head:x_(e.head),n=r!==e.head;if(!e.args)return t?x_(e.head):n?La.Apply(r):e;let o=!1,i;if(La.isArgumentsArray(e.args)){i=[];for(let a=0,s=e.args.length;a<s;a++){let l=e.args[a],u=x_(l);l!==u&&(o=!0),i[i.length]=u}if(o||(i=e.args),!t&&!n&&!o)return e}else{i={};for(let a of Object.keys(e.args)){let s=e.args[a],l=x_(s);s!==l&&(o=!0),i[a]=l}if(!t&&!n&&!o)return e;o||(i=e.args)}if(t){let a=hI[e.head.name];return a.kind!=="macro"?La.Apply(r,i):a.translate(i)}return La.Apply(r,i)}function obe(e){return x_(e)}var Ye=class e{constructor(t){this._=t}parse(t){let r=this.skip(e.eof)._(t,0);return r.status?{success:!0,value:r.value}:{success:!1,index:ibe(t,r.furthest),expected:r.expected}}tryParse(t){let r=this.parse(t);if(r.success)return r.value;{let n=GZe(t,r);throw new Error(n)}}or(t){return e.alt(this,t)}trim(t){return this.wrap(t,t)}wrap(t,r){return E7(1,typeof t=="string"?e.string(t):t,this,typeof r=="string"?e.string(r):r)}thru(t){return t(this)}then(t){return E7(1,this,t)}many(){return new e((t,r)=>{let n=[],o;for(;;)if(o=np(this._(t,r),o),o.status){if(r===o.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");r=o.index,n.push(o.value)}else return np(ju(r,n),o)})}times(t,r){let n=typeof r>"u"?t:r;return new e((o,i)=>{let a=[],s,l,u;for(u=0;u<t;u++)if(s=this._(o,i),l=np(s,l),s.status)i=s.index,a.push(s.value);else return l;for(;u<n&&(s=this._(o,i),l=np(s,l),s.status);u+=1)i=s.index,a.push(s.value);return np(ju(i,a),l)})}result(t){return this.map(()=>t)}atMost(t){return this.times(0,t)}atLeast(t){return e.seq(this.times(t),this.many()).map(r=>[...r[0],...r[1]])}map(t){return new e((r,n)=>{let o=this._(r,n);return o.status?np(ju(o.index,t(o.value)),o):o})}skip(t){return E7(0,this,t)}mark(){return e.seq(e.index,this,e.index).map(t=>({start:t[0],value:t[1],end:t[2]}))}node(t){return e.seq(e.index,this,e.index).map(r=>({name:t,start:r[0],value:r[1],end:r[2]}))}sepBy(t){return e.sepBy(this,t)}sepBy1(t){return e.sepBy1(this,t)}lookahead(t){return this.skip(e.lookahead(t))}notFollowedBy(t){return this.skip(e.notFollowedBy(t))}desc(t){return new e((r,n)=>{let o=this._(r,n);return o.status||(o.expected=[t]),o})}fallback(t){return this.or(e.succeed(t))}ap(t){return e.seq(t,this).map(([r,n])=>r(n))}chain(t){return new e((r,n)=>{let o=this._(r,n);if(!o.status)return o;let i=t(o.value);return np(i._(r,o.index),o)})}};(X=>{function e(F,Y,$){let ce=[].slice.call(arguments);if(ce.length===0)throw new Error("seqMap needs at least one argument");let ie=ce.pop();return zZe(ie),r.apply(null,ce).map(function(oe){return ie.apply(null,oe)})}X.seqMap=e;function t(F){let Y={};for(let $ of Object.keys(F))(function(ce){Y[ce]=S(()=>F[ce](Y))})($);return Y}X.createLanguage=t;function r(...F){let Y=F.length;return new X(($,ce)=>{let ie,oe=new Array(Y),W=ce;for(let N=0;N<Y;N++){if(ie=np(F[N]._($,W),ie),!ie.status)return ie;oe[N]=ie.value,W=ie.index}return np(ju(W,oe),ie)})}X.seq=r;function n(...F){return F.length===0?m("zero alternates"):new X(($,ce)=>{let ie;for(let oe=0;oe<F.length;oe++)if(ie=np(F[oe]._($,ce),ie),ie.status)return ie;return ie})}X.alt=n;function o(F,Y){return i(F,Y).or(c([]))}X.sepBy=o;function i(F,Y){let $=Y.then(F).many();return r(F,$).map(ce=>[ce[0],...ce[1]])}X.sepBy1=i;function a(F){let Y=`'${F}'`;if(F.length===1){let $=F.charCodeAt(0);return new X((ce,ie)=>ce.charCodeAt(ie)===$?ju(ie+1,F):by(ie,Y))}return new X(($,ce)=>{let ie=ce+F.length;return $.slice(ce,ie)===F?ju(ie,F):by(ce,Y)})}X.string=a;function s(F){let Y=""+F;return Y.slice(Y.lastIndexOf("/")+1)}function l(F){return RegExp("^(?:"+F.source+")",s(F))}function u(F,Y=0){let $=l(F),ce=""+F;return new X((ie,oe)=>{let W=$.exec(ie.slice(oe));if(W){if(0<=Y&&Y<=W.length){let j=W[0],ue=W[Y];return ju(oe+j.length,ue)}let N=`invalid match group (0 to ${W.length}) in ${ce}`;return by(oe,N)}return by(oe,ce)})}X.regexp=u;function c(F){return new X((Y,$)=>ju($,F))}X.succeed=c;function m(F){return new X((Y,$)=>by($,F))}X.fail=m;function d(F){if(NZe(F))return new X((Y,$)=>{let ce=F._(Y,$);return ce.status&&(ce.index=$,ce.value=null),ce});if(typeof F=="string")return d(a(F));if(F instanceof RegExp)return d(u(F));throw new Error("not a string, regexp, or parser: "+F)}X.lookahead=d;function p(F){return new X((Y,$)=>{let ce=F._(Y,$);return ce.status?by($,'not "'+Y.slice($,ce.index)+'"'):ju($,null)})}X.notFollowedBy=p;function h(F){return new X((Y,$)=>{let ce=Y.charAt($);return $<Y.length&&F(ce)?ju($+1,ce):by($,"a character "+F)})}X.test=h;function f(F){return h(Y=>F.indexOf(Y)>=0)}X.oneOf=f;function y(F){return h(Y=>F.indexOf(Y)<0)}X.noneOf=y;function g(F,Y){return h($=>F<=$&&$<=Y).desc(F+"-"+Y)}X.range=g;function x(F){return new X((Y,$)=>{let ce=$;for(;ce<Y.length&&F(Y.charAt(ce));)ce++;return ju(ce,Y.slice($,ce))})}X.takeWhile=x;function S(F){let Y=new X(($,ce)=>{let ie=F()._;return Y._=ie,ie($,ce)});return Y}X.lazy=S;function I(){return m("empty")}X.empty=I,X.index=new X(function(F,Y){return ju(Y,ibe(F,Y))}),X.anyChar=new X((F,Y)=>Y>=F.length?by(Y,"any character"):ju(Y+1,F.charAt(Y))),X.all=new X(function(F,Y){return ju(F.length,F.slice(Y))}),X.eof=new X(function(F,Y){return Y<F.length?by(Y,"EOF"):ju(Y,null)}),X.digit=u(/[0-9]/).desc("a digit"),X.digits=u(/[0-9]*/).desc("optional digits"),X.letter=u(/[a-z]/i).desc("a letter"),X.letters=u(/[a-z]*/i).desc("optional letters"),X.optWhitespace=u(/\s*/).desc("optional whitespace"),X.whitespace=u(/\s+/).desc("whitespace"),X.cr=a("\r"),X.lf=a(`
`),X.crlf=a(`\r
`),X.newline=n(X.crlf,X.lf,X.cr).desc("newline"),X.end=n(X.newline,X.eof);function O(F){return c(F)}X.of=O;function q(F){return u(F)}X.regex=q})(Ye||={});function E7(e,...t){let r=t.length;return new Ye((n,o)=>{let i,a,s=o;for(let l=0;l<r;l++){if(i=np(t[l]._(n,s),i),!i.status)return i;e===l&&(a=i.value),s=i.index}return np(ju(s,a),i)})}function ju(e,t){return{status:!0,index:e,value:t}}function by(e,t){return{status:!1,furthest:e,expected:[t]}}function np(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;let r=e.furthest===t.furthest?UZe(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:r}}function ibe(e,t){let r=e.slice(0,t).split(`
`),n=r.length,o=r[r.length-1].length+1;return{offset:t,line:n,column:o}}function VZe(e){return e.length===1?e[0]:"one of "+e.join(", ")}function OZe(e,t){let r=t.index,n=r.offset;if(n===e.length)return", got the end of the input";let o=n>0?"'...":"'",i=e.length-n>12?"...'":"'";return` at line ${r.line} column ${r.column}, got ${o}${e.slice(n,n+12)}${i}`}function GZe(e,t){return`expected ${VZe(t.expected)}${OZe(e,t)}`}function UZe(e,t){let r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;let o=new Set,i=[];for(let a=0;a<r;a++)o.has(e[a])||(i[i.length]=e[a],o.add(e[a]));for(let a=0;a<n;a++)o.has(t[a])||(i[i.length]=t[a],o.add(t[a]));return i.sort(),i}function NZe(e){return e instanceof Ye}function zZe(e){if(typeof e!="function")throw new Error("not a function: "+e)}function abe(e){return sbe.parse(e)}var sbe;(S=>{let e;(T=>{function I(w){return{kind:"string",value:w}}T.str=I;function v(w){return{kind:"symbol",value:w}}T.symb=v;function A(w,D){return{kind:"list",bracket:w,nodes:D}}T.list=A;function _(w){return{kind:"comment",value:w}}T.comment=_})(e||={});let t=Ye.regexp(/[\n\r\s]*/),r=Ye.lazy(()=>Ye.alt(n,c,o,i).trim(t)),n=Ye.takeWhile(I=>I!=="`").trim("`").map(e.str),o=Ye.regexp(/[^()\[\]{};`,\n\r\s]+/).map(e.symb),i=Ye.regexp(/\s*;+([^\n\r]*)\n/,1).map(e.comment),a=r.many(),s=a.wrap("(",")").map(I=>e.list("(",I)),l=a.wrap("[","]").map(I=>e.list("[",I)),u=a.wrap("{","}").map(I=>e.list("{",I)),c=Ye.alt(s,l,u),m=r.many();function d(I){return m.tryParse(I)}function p(I){switch(I.kind){case"string":return I.value;case"symbol":{let v=I.value;if(v.length>1)switch(v.charAt(0)){case".":return ne.atomName(v.substr(1));case"_":return ne.struct.type.elementSymbol([v.substr(1)])}return v==="true"?!0:v==="false"?!1:g(v)?+v:La.Symbol(v)}case"list":switch(I.bracket){case"[":return ne.core.type.list(y(I.nodes).map(p));case"{":return ne.core.type.set(y(I.nodes).map(p));case"(":{if(I.nodes[0].kind==="comment")throw new Error("Invalid expression");let v=p(I.nodes[0]);return La.Apply(v,h(I.nodes))}default:Rr(I.bracket)}default:Rr(I)}}function h(I){if(I.length<=1)return;if(!f(I)){let T=[];for(let w=1,D=I.length;w<D;w++){let M=I[w];M.kind!=="comment"&&(T[T.length]=p(M))}return T}let v={},A=!0,_=0;for(let T=1,w=I.length;T<w;T++){let D=I[T];if(D.kind!=="comment")if(D.kind==="symbol"&&D.value.length>1&&D.value.charAt(0)===":"){let M=D.value.substr(1);for(++T;T<w&&I[T].kind==="comment";)T++;if(T>=w)throw new Error(`There must be a value foolowed a named arg ':${M}'.`);if(I[T].kind==="comment")throw new Error("Invalid expression");v[M]=p(I[T]),isNaN(+M)&&(A=!1)}else v[_++]=p(D)}if(A){let T=Object.keys(v).map(D=>+D).sort((D,M)=>D-M),w=!0;for(let D=0,M=T.length;D<M;D++)if(T[D]!==D){w=!1;break}if(w){let D=[];for(let M=0,E=T.length;M<E;M++)D[M]=v[M];return D}}return v}function f(I){for(let v=1,A=I.length;v<A;v++){let _=I[v];if(_.kind==="symbol"&&_.value.length>1&&_.value.charAt(0)===":")return!0}return!1}function y(I){let v=!1;for(let A=0,_=I.length;A<_;A++)if(I[A].kind==="comment"){v=!0;break}return v?I.filter(A=>A.kind!=="comment"):I}function g(I){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(I)&&!isNaN(+I)}function x(I){let v=d(I),A=[];for(let _ of v)_.kind!=="comment"&&(A[A.length]=p(_));return A}S.parse=x})(sbe||={});var $o=ne;function dl(e,t,r){let n=Ye.lazy(()=>Ye.seq(e,n).map(o=>r(...o)).or(t));return n}function C_(e,t,r){return Ye.seqMap(t,e.many(),(n,o)=>o.reduce((i,a)=>r(a,i),n))}function Ws(e,t,r){return Ye.seqMap(t,Ye.seq(e,t).many(),(n,o)=>o.reduce((i,a)=>{let[s,l]=a;return r(s,i,l)},n))}function Dx(e,t){return e.reduce((n,o)=>{let i=o.isUnsupported?xy(`operator '${o.name}' not supported`):o.map;return o.type(o.rule,n,i)},t)}function op(e,t=0){return Ye.optWhitespace.then(Ye.regexp(e,t).skip(Ye.optWhitespace))}function wc(e,t=0){return Ye.regexp(e,t).skip(Ye.optWhitespace)}function S_(e,t=0){return Ye.optWhitespace.then(Ye.regexp(e,t))}function yk(e,t){let r=t?`${e}|${Gg(t)}`:e,n=RegExp(`(${r})\\s+([-+]?[0-9]*\\.?[0-9]+)\\s+OF`,"i");return op(n,2).map(parseFloat)}function xy(e){return function(){throw new Error(e)}}function v_(e){return e.length===1?e[0]:e.length>1?$o.core.logic.and(e):void 0}function ube(e){return e.length===1?e[0]:e.length>1?$o.core.logic.or(e):void 0}function M7(e,t){if(t&&t.op!==void 0&&t.val!==void 0){let r=[e,t.val];switch(t.op){case"=":return $o.core.rel.eq(r);case"!=":return $o.core.rel.neq(r);case">":return $o.core.rel.gr(r);case"<":return $o.core.rel.lt(r);case">=":return $o.core.rel.gre(r);case"<=":return $o.core.rel.lte(r);default:throw new Error(`operator '${t.op}' not supported`)}}else return t&&t.flags!==void 0?$o.core.flags.hasAny([e,t.flags]):t&&t.min!==void 0&&t.max!==void 0?$o.core.rel.inRange([e,t.min,t.max]):Array.isArray(t)?t.length>1?$o.core.set.has([$o.core.type.set(t),e]):$o.core.rel.eq([e,t[0]]):$o.core.rel.eq([e,t])}function Nl(e){return $o.struct.generator.queryInSelection({0:e,query:$o.struct.generator.all(),"in-complement":!0})}function gm(e,t){return e.length<t.length?1:-1}function B7(e,t){let r=(t?[e].concat(t):[e]).sort(gm).map(Gg).join("|");return RegExp(`${r}`,"i")}function cbe(e){let t={};return Object.keys(e).sort(gm).forEach(r=>{let n=e[r],o=xy(`property '${r}' not supported`),i=Ye.regexp(n.regex).map(a=>(n.isUnsupported&&o(),M7(n.property,n.map(a))));n.isNumeric||(t[r]=i)}),t}function bk(e){let t=[];return Object.keys(e).sort(gm).forEach(r=>{let n=e[r],o=xy(`property '${r}' not supported`),i=Ye.regexp(n.regex).map(l=>(n.isUnsupported&&o(),M7(n.property,n.map(l)))),a=Ye.regexp(B7(r,n.abbr)).trim(Ye.optWhitespace),s=l=>$o.struct.generator.atomGroups({[n.level]:l});n.isNumeric?t.push(a.then(Ye.seq(Ye.regexp(/>=|<=|=|!=|>|</).trim(Ye.optWhitespace),Ye.regexp(n.regex).map(n.map))).map(l=>(n.isUnsupported&&o(),M7(n.property,{op:l[0],val:l[1]}))).map(s)):t.push(a.then(i).map(s))}),t}function gI(e){let t=[];return Object.keys(e).sort(gm).forEach(r=>{let n=e[r],o=n.map?n.map:xy(`keyword '${r}' not supported`),i=Ye.regexp(B7(r,n.abbr)).map(o);t.push(i)}),t}function mbe(e,t){let r=[],n=Ye.regexp(/\(\s*/),o=Ye.regexp(/\s*\)/);return Object.keys(e).sort(gm).forEach(i=>{let a=e[i],s=a.map?a.map:xy(`function '${i}' not supported`),l=Ye.regexp(new RegExp(i,"i")).skip(n).then(t).skip(o).map(s);r.push(l)}),r}function I_(e,t){let r=[];return Object.keys(e).sort(gm).forEach(n=>{let o=e[n],i=xy(`property '${n}' not supported`),a=Ye.regexp(B7(n,o.abbr)).lookahead(t).map(()=>(o.isUnsupported&&i(),o.property));r.push(a)}),r}function yI(e,t,r,n){let o=[];for(let i in e)o.push(i),e[i].abbr&&o.push(...e[i].abbr);for(let i in t)o.push(i),t[i].abbr&&o.push(...t[i].abbr);return r.forEach(i=>{o.push(i.name),i.abbr&&o.push(...i.abbr)}),o}function nd(e){return $o.core.type.set(e.map($o.atomName))}function od(e){return $o.struct.generator.queryInSelection({0:e,query:$o.struct.generator.all()})}function rS(e,t,r){switch(e.head.name){case"structure-query.atom-property.macromolecular.label_atom_id":return $o.atomName(t);case"structure-query.atom-property.core.element-symbol":return $o.es(t);case"structure-query.atom-property.macromolecular.secondary-structure-flags":return r&&(t=[r[t.toUpperCase()]||"none"]),$o.struct.type.secondaryStructureFlags([t]);default:return t}}var lbe="structure-query.atom-property.macromolecular.",HZe=["entityKey","label_entity_id","entityType"],jZe=["chainKey","label_asym_id","label_entity_id","auth_asym_id","entityType"],WZe=["residueKey","label_comp_id","label_seq_id","auth_comp_id","auth_seq_id","pdbx_formal_charge","secondaryStructureKey","secondaryStructureFlags","isModified","modifiedParentName"];function dbe(e){if(e.head.name.startsWith(lbe)){let t=e.head.name.substr(lbe.length);if(HZe.includes(t))return"entity-test";if(jZe.includes(t))return"chain-test";if(WZe.includes(t))return"residue-test"}return"atom-test"}var XZe=["structure-query.atom-property.macromolecular.secondary-structure-flags"];function pbe(e,t){if(XZe.includes(e.head.name)){let r=t[0].head,n=[];return t.forEach(o=>n.push(...o.args[0])),$o.core.flags.hasAny([e,{head:r,args:n}])}else{if(t.length===1)return $o.core.rel.eq([e,t[0]]);if(t.length>1)return $o.core.set.has([$o.core.type.set(t),e])}}function On(e){return $o.struct.generator.atomGroups({"residue-test":$o.core.set.has([$o.core.type.set(e),$o.ammp("label_comp_id")])})}var Na=ne,ip=/[-+]?[0-9]*\.?[0-9]+/,A_=/[0-9]+/;function Pr(e){return e}var QZe={none:"none",turn:"turn",sheet:"beta",helix:"helix",dna:"dna",rna:"rna",carbohydrate:"carbohydrate",helix310:"3-10",helixalpha:"alpha",helixpi:"pi",0:"none",1:"turn",2:"beta",3:"helix",4:"dna",5:"rna",6:"carbohydrate",7:"3-10",8:"alpha",9:"pi"};function k7(e){if(e.head){if(e.head.name&&e.head.name==="core.type.regex"&&(e=e.args[0].replace(/^\^|\$$/g,"")),e=QZe[e.toString().toLowerCase()]||"none",["dna","rna","carbohydrate"].indexOf(e)!==-1)throw new Error("values 'dna', 'rna', 'carbohydrate' not yet supported for 'structure' property");return Na.struct.type.secondaryStructureFlags([e])}}var L7={adpmax:{"@desc":"the maximum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:ip,map:e=>parseFloat(e),level:"atom-test"},adpmin:{"@desc":"the minimum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:ip,map:e=>parseFloat(e),level:"atom-test"},altloc:{"@desc":"PDB alternate location identifier","@examples":["altloc = A"],regex:/[a-zA-Z0-9]/,map:Pr,level:"atom-test",property:Na.ammp("label_alt_id")},altname:{"@desc":"an alternative name given to atoms by some file readers (for example, P2N)","@examples":[""],isUnsupported:!0,regex:/[a-zA-Z0-9]/,map:Pr,level:"atom-test"},atomID:{"@desc":"special atom IDs for PDB atoms assigned by Jmol","@examples":[""],isUnsupported:!0,regex:A_,map:e=>parseInt(e),level:"atom-test"},atomIndex:{"@desc":"atom 0-based index; a unique number for each atom regardless of the number of models loaded","@examples":[""],isUnsupported:!0,regex:A_,map:e=>parseInt(e),level:"atom-test"},atomName:{"@desc":"atom name","@examples":["atomName = CA"],regex:/[a-zA-Z0-9]+/,map:e=>Na.atomName(e),level:"atom-test",property:Na.ammp("label_atom_id")},atomno:{"@desc":'sequential number; you can use "@" instead of "atomno=" -- for example, select @33 or Var x = @33 or @35',"@examples":[""],isUnsupported:!0,regex:A_,map:e=>parseInt(e),level:"atom-test"},atomType:{"@desc":"atom type (mol2, AMBER files) or atom name (other file types)","@examples":["atomType = OH"],regex:/[a-zA-Z0-9]+/,map:e=>Na.atomName(e),level:"atom-test",property:Na.ammp("label_atom_id")},atomX:{"@desc":"Cartesian X coordinate (or just X)","@examples":["x = 4.2"],abbr:["X"],isNumeric:!0,regex:ip,map:e=>parseFloat(e),level:"atom-test",property:Na.acp("x")},atomY:{"@desc":"Cartesian Y coordinate (or just Y)","@examples":["y < 42"],abbr:["Y"],isNumeric:!0,regex:ip,map:e=>parseFloat(e),level:"atom-test",property:Na.acp("y")},atomZ:{"@desc":"Cartesian Z coordinate (or just Z)","@examples":["Z > 10"],abbr:["Z"],isNumeric:!0,regex:ip,map:e=>parseFloat(e),level:"atom-test",property:Na.acp("z")},bondcount:{"@desc":"covalent bond count","@examples":["bondcount = 0"],isNumeric:!0,regex:A_,map:e=>parseInt(e),level:"atom-test",property:Na.acp("bondCount")},bondingRadius:{"@desc":"radius used for auto bonding; synonymous with ionic and ionicRadius","@examples":[""],abbr:["ionic","ionicRadius"],isUnsupported:!0,regex:ip,map:e=>parseFloat(e),level:"atom-test"},cell:{"@desc":'crystallographic unit cell, expressed either in lattice integer notation (111-999) or as a coordinate in ijk space, where {1 1 1} is the same as 555. ANDing two cells, for example select cell=555 and cell=556, selects the atoms on the common face. (Note: in the specifc case of CELL, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},configuration:{"@desc":'Only in the context {configuration=n}, this option selects the set of atoms with either no ALTLOC specified or those atoms having this index into the array of altlocs within its model. So, for example, if the model has altloc "A" and "B", select configuration=1 is equivalent to select altloc="" or altloc="A", and print {configuration=2} is equivalent to print {altloc="" or altloc="B"}. Configuration 0 is "all atoms in a model having configurations", and an invalid configuration number gives no atoms. (Note: in the specifc case of CONFIGURATION, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:A_,map:e=>parseInt(e),level:"atom-test"},chain:{"@desc":'protein chain. For newer CIF files allowing multicharacter chain specifications, use quotations marks: select chain="AA". For these multicharacter desigations, case is not checked unless the CIF file has lower-case chain designations.',"@examples":["chain = A",'chain = "AA"'],regex:/[a-zA-Z0-9]+/,map:Pr,level:"chain-test",property:Na.ammp("auth_asym_id")},chainNo:{"@desc":'chain number; sequentially counted from 1 for each model; chainNo == 0 means"no chain" or PDB chain identifier indicated as a blank (Jmol 14.0).',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},color:{"@desc":"the atom color","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},covalentRadius:{"@desc":"covalent bonding radius, synonymous with covalent. Not used by Jmol, but could be used, for example, in {*}.spacefill={*}.covalentRadius.all.","@examples":[""],abbr:["covalent"],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},cs:{"@desc":"chemical shift calculated using computational results that include magnetic shielding tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},element:{"@desc":'element symbol. The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted element symbol, "H", "He", "Li", etc. or atomic number. In all other contexts, the value is the element symbol. When the atom is a specific isotope, the string will contain the isotope number -- "13C", for example.',"@examples":["element=Fe"],regex:/[a-zA-Z]+/,map:e=>Na.es(e),level:"atom-test",property:Na.acp("elementSymbol")},elemno:{"@desc":"atomic element number","@examples":["elemno=8"],regex:/[0-9\s{}-]+/,map:e=>parseInt(e),level:"atom-test",property:Na.acp("atomicNumber")},eta:{"@desc":`Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' "RNA worm" graph.`,"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},theta:{"@desc":`Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' "RNA worm" graph.`,"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},file:{"@desc":"file number containing this atom","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},formalCharge:{"@desc":"formal charge","@examples":["formalCharge=1"],regex:ip,map:e=>parseFloat(e),level:"atom-test",property:Na.ammp("pdbx_formal_charge")},format:{"@desc":"format (label) of the atom.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},fXyz:{"@desc":"fractional XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},fX:{"@desc":"fractional X coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},fY:{"@desc":"fractional Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},fZ:{"@desc":"fractional Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},fuxyz:{"@desc":"fractional XYZ coordinates in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},fux:{"@desc":"fractional X coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},fuy:{"@desc":"fractional Y coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},fuz:{"@desc":"fractional Z coordinate in the unit cell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},group:{"@desc":"3-letter residue code","@examples":["group = ALA"],regex:/[a-zA-Z0-9]{1,3}/,map:Pr,level:"residue-test",property:Na.ammp("label_comp_id")},group1:{"@desc":"single-letter residue code (amino acids only)","@examples":["group1 = G"],regex:/[a-zA-Z]/,map:Pr,level:"residue-test",property:Na.ammp("label_comp_id")},groupID:{"@desc":"group ID number: A unique ID for each amino acid or nucleic acid residue in a PDB file. 0  noGroup 1-5  ALA, ARG, ASN, ASP, CYS 6-10  GLN, GLU, GLY, HIS, ILE 11-15  LEU, LYS, MET, PHE, PRO 16-20  SER, THR, TRP, TYR, VAL 21-23  ASX, GLX, UNK 24-29  A, +A, G, +G, I, +I 30-35  C, +C, T, +T, U, +U Additional unique numbers are assigned arbitrarily by Jmol and cannot be used reproducibly.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},groupindex:{"@desc":"overall group index","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},hydrophobicity:{"@desc":"Aminoacid residue scale of hydrophobicity based on Rose, G. D., Geselowitz, A. R., Lesser, G. J., Lee, R. H., and Zehfus, M. H. (1985). Hydrophobicity of amino acid residues in globular proteins, Science, 229(4716):834-838.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},identify:{"@desc":"for a PDB/mmCIF file, a label such as [ILE]7^1:A.CD1%A/3 #47, which includes the group ([ILE]), residue number with optional insertion code (7^1), chain (:A), atom name (CD1), alternate location if present (%A), PDB model number (/3, for NMR models when one file is loaded; /file.model such as /2.3 if more than one file is loaded), and atom number (#47). For non-PDB data, the information is shorter -- for example, H15/2.1 #6, indicating atom name (H15), full file.model number (/2.1), and atom number (#6). If only a single model is loaded, %[identify] does not include the model number.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},insertion:{"@desc":"protein residue insertion code","@examples":["insertion=A"],regex:/[a-zA-Z0-9]/,map:Pr,level:"atom-test",property:Na.ammp("pdbx_PDB_ins_code")},label:{"@desc":"current atom label (same as format)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},mass:{"@desc":"atomic mass -- especially useful with appended .max or .sum","@examples":["mass > 13"],regex:ip,map:e=>parseFloat(e),level:"atom-test",property:Na.acp("mass")},model:{"@desc":"model number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},modelindex:{"@desc":"a unique number for each model, starting with 0 and spanning all models in all files","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},modO:{"@desc":"currently calculated occupancy from modulation (0 to 100; NaN if atom has no occupancy modulation)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},modXYZ:{"@desc":"currently calculated displacement modulation (for incommensurately modulated structures). Also modX, modY, modZ for individual components. For atoms without modultion, {xx}.modXYZ is -1 and {xx}.modX is NaN, and in a label %[modXYZ] and %[modX] are blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},molecule:{"@desc":"molecule number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},monomer:{"@desc":"monomer number (group number) in a polymer (usually a chain), starting with 1, or 0 if not part of a biopolymer -- that is, not a connected carbohydrate, amino acid, or nucleic acid (Jmol 14.3.15)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},ms:{"@desc":"magnetic shielding calculated from file-loaded tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},occupancy:{"@desc":'CIF file site occupancy. In SELECT command comparisons ("select occupancy < 90"), an integer n implies measurement on a 0-100 scale; also, in the context %[occupancy] or %q for a label, the reported number is a percentage. In all other cases, such as when %Q is used in a label or when a decimal number is used in a comparison, the scale is 0.0 - 1.0.',"@examples":["occupancy < 1"],regex:ip,map:e=>parseFloat(e),level:"atom-test",property:Na.ammp("occupancy")},partialCharge:{"@desc":"partial charge","@examples":[""],isUnsupported:!0,regex:ip,map:e=>parseFloat(e),level:"atom-test"},phi:{"@desc":"protein group PHI angle for atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},polymer:{"@desc":"sequential polymer number in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},polymerLength:{"@desc":"polymer length","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},property_xx:{"@desc":"a property created using the DATA command","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},psi:{"@desc":"protein group PSI angle for the atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},radius:{"@desc":'currently displayed radius -- In SELECT command comparisons ("select radius=n"), integer n implies Rasmol units 1/250 Angstroms; in all other cases or when a decimal number is used, the units are Angstroms.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},resno:{"@desc":"PDB residue number, not including insertion code (see also seqcode, below)","@examples":["resno = 100"],regex:/-?[0-9]+/,map:e=>parseInt(e),level:"residue-test",property:Na.ammp("auth_seq_id")},selected:{"@desc":"1.0 if atom is selected; 0.0 if not","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},sequence:{"@desc":'PDB one-character sequence code, as a string of characters, with "?" indicated where single-character codes are not available',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},seqcode:{"@desc":'PDB residue number, including insertion code (for example, 234^2; "seqcode" option added in Jmol 14.3.16)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},seqid:{"@desc":"(mmCIF only) the value from _atom_site.label_seq_id; a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category specifying the sequence of monomers in a polymer. Allowance is made for the possibility of microheterogeneity in a sample by allowing a given sequence number to be correlated with more than one monomer id. (Jmol 14.2.3)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},shape:{"@desc":'hybridization geometry such as "tetrahedral"',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},site:{"@desc":"crystallographic site number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},spacefill:{"@desc":"currently displayed radius","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},straightness:{"@desc":'quaternion-derived straightness (second derivative of the quaternion describing the orientation of the residue. This quantity will have different values depending upon the setting of quaternionFrame as "A" (alpha-carbon/phosphorus atom only), "C" (alpha-carbon/pyrimidine or purine base based), "P" (carbonyl-carbon peptide plane/phosphorus tetrahedron based), or "N" (amide-nitrogen based). The default is alpha-carbon based, which corresponds closely to the following combination of Ramachandran angles involving three consecutive residues i-1, i, and i+1: -psii-1 - phii + psii + phii+1.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},strucno:{"@desc":"a unique number for each helix, sheet, or turn in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},structure:{"@desc":'The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", or "carbohydrate" or a respective number 0-6. In the context {*}.structure, the return value is a number; in the context label %[structure], the return is one of the six keywords.',"@examples":['structure="helix"',"structure=3"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|[0-6]/i,map:Pr,level:"residue-test",property:"structure"},substructure:{"@desc":'like structure, the value of this parameter depends upon the context. Used with select substructure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", "carbohydrate", "helix310", "helixalpha", or "helixpi", or the respective number 0-9. In the context {*}.substructure, the return value is a number; in the context label %[substructure], the return is one of the nine keywords.',"@examples":['substructure = "alphahelix"',"substructure =9"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|helix310|helixalpha|helixpi|[0-9]/i,map:Pr,level:"residue-test",property:"structure"},surfacedistance:{"@desc":"A value related to the distance of an atom to a nominal molecular surface. 0 indicates at the surface. Positive numbers are minimum distances in Angstroms from the given atom to the surface.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},symop:{"@desc":'the first symmetry operation code that generated this atom by Jmol; an integer starting with 1. See also symmetry, below. This operator is only present if the file contains space group information and the file was loaded using the {i, j, k} option so as to generate symmetry-based atoms. To select only the original atoms prior to application of symmetry, you can either use "SYMOP=n", where n is the symmetry operator corresponding to "x,y,z", or you can specify instead simply "NOT symmetry" the way you might specify "NOT hydrogen". Note that atoms in special positions will have multiple operator matches. These atoms can be selected using the keyword SPECIALPOSITION. The special form select SYMOP=nijk selects a specific translation of atoms from the given crystallographic symmetry operation. Comparators <, <=, >, >=, and != can be used and only apply to the ijk part of the designation. The ijk are relative, not absolute. Thus, symop=2555 selects for atoms that have been transformed by symop=2 but not subjected to any further translation. select symop=1555 is identical to select not symmetry. All other ijk are relative to these selections for 555. If the model was loaded using load "filename.cif" {444 666 1}, where the 1 indicates that all symmetry-generated atoms are to be packed within cell 555 and then translated to fill the other 26 specified cells, then select symop=3555 is nearly the same as select symop=3 and cell=555. (The difference being that cell=555 selects for all atoms that are on any edge of the cell, while symop=3555 does not.) However, the situation is different if instead the model was loaded using load "filename.cif" {444 666 0}, where the 0 indicates that symmetry-generated atoms are to be placed exactly where their symmetry operator would put them (x,-y,z being different then from x, 1-y, z). In that case, select symop=3555 is for all atoms that have been generated using symmetry operation 3 but have not had any additional translations applied to the x,y,z expression found in the CIF file. If, for example, symmetry operation 3 is -x,-y,-z, then load "filename.cif" {444 666 0} will place an atom originally at {1/2, 1/2, 1/2} at positions {-1/2, -1/2, -1/2} (symop=3555) and {-3/2, -3/2, -3/2} (symop=3444) and 24 other sites.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},symmetry:{"@desc":'as "symmetry" or in a label as lower-case "o" gives list of crystallographic symmetry operators generating this atom with lattice designations,such as 3555; upper-case "%O" in a label gives a list without the lattice designations. See also symop, above.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},temperature:{"@desc":"yes  yes  temperature factor (B-factor)","@examples":["temperature >= 20"],regex:ip,map:e=>parseFloat(e),level:"atom-test",property:Na.ammp("B_iso_or_equiv")},unitXyz:{"@desc":"unit cell XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},uX:{"@desc":"unit cell X coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},uY:{"@desc":"unit cell Y coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},uZ:{"@desc":"unit cell Z coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},valence:{"@desc":"the valence of an atom (sum of bonds, where double bond counts as 2 and triple bond counts as 3","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},vanderwaals:{"@desc":"van der Waals radius","@examples":["vanderwaals >2"],regex:ip,map:e=>parseFloat(e),level:"atom-test",property:Na.acp("vdw")},vectorScale:{"@desc":"vibration vector scale","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},volume:{"@desc":"approximate van der Waals volume for this atom. Note, {*}.volume gives an average; use {*}.volume.sum to get total volume.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},vXyz:{"@desc":"vibration vector, or individual components as %vx %vy %vz. For atoms without vibration vectors, {xx}.vXyz is -1; in a label, %[vxyz] is blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},vX:{"@desc":"vibration vector X coordinate; for atoms without vibration vector, {xx}.vX is NaN (same for vY and vZ)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},vY:{"@desc":"vibration vector Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},vZ:{"@desc":"vibration vector Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"},xyz:{"@desc":"Cartesian XYZ coordinates; select xyz > 1.0 selects atoms more than one Angstrom from the origin.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Pr,level:"atom-test"}};var fbe=ne,F7=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not ARG"],name:"not",type:dl,rule:Ye.alt(Ye.regex(/NOT/i).skip(Ye.whitespace),Ye.string("!").skip(Ye.optWhitespace)),map:(e,t)=>Nl(t)},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["ASP and .CA"],name:"and",type:Ws,rule:op(/AND|&/i),map:(e,t,r)=>fbe.struct.modifier.intersectBy({0:t,by:r})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["ASP or GLU"],name:"or",type:Ws,rule:op(/OR|\||,/i),map:(e,t,r)=>fbe.struct.combinator.merge([t,r])}];var Ne=ne,wi={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],amino:["ALA","ARG","ASN","ASP","CYS","GLN","GLU","GLY","HIS","ILE","LEU","LYS","MET","PHE","PRO","SER","THR","TRP","TYR","VAL","ASX","GLX","UNK"],aromatic:["HIS","PHE","TRP","TYR"],basic:["ARG","HIS","LYS"],buried:["ALA","CYS","ILE","LEU","MET","PHE","TRP","VAL"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","GLY","ILE","LEU","MET","PHE","PRO","TRP","TYR","VAL"],large:["ARG","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","TRP","TYR"],medium:["ASN","ASP","CYS","PRO","THR","VAL"],small:["ALA","GLY","SER"],nucleic:["G","C","A","T","U","I","DG","DC","DA","DT","DU","DI","+G","+C","+A","+T","+U","+I"]},hbe={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],protein:["C","N","CA"]};function T_(){return Ne.struct.combinator.merge([Ne.struct.generator.atomGroups({"residue-test":Ne.core.set.has([Ne.set(...wi.nucleic),Ne.ammp("label_comp_id")])}),Ne.struct.filter.pick({0:Ne.struct.generator.atomGroups({"group-by":Ne.ammp("residueKey")}),test:Ne.core.logic.and([Ne.core.rel.eq([Ne.struct.atomSet.atomCount(),1]),Ne.core.rel.eq([Ne.ammp("label_atom_id"),Ne.atomName("P")])])}),Ne.struct.filter.pick({0:Ne.struct.generator.atomGroups({"group-by":Ne.ammp("residueKey")}),test:Ne.core.logic.or([Ne.core.set.isSubset([nd(["C1'","C2'","O3'","C3'","C4'","C5'","O5'"]),Ne.ammpSet("label_atom_id")]),Ne.core.set.isSubset([nd(["C1*","C2*","O3*","C3*","C4*","C5*","O5*"]),Ne.ammpSet("label_atom_id")])])})])}function ZZe(){return Ne.struct.generator.atomGroups({"residue-test":Ne.core.set.has([Ne.set(...wi.amino),Ne.ammp("label_comp_id")])})}function qZe(){return Ne.struct.combinator.merge([Ne.struct.modifier.intersectBy({0:Ne.struct.generator.atomGroups({"residue-test":Ne.core.set.has([Ne.core.type.set(wi.amino),Ne.ammp("label_comp_id")])}),by:Ne.struct.generator.atomGroups({"atom-test":Ne.core.set.has([Ne.core.type.set(hbe.protein),Ne.ammp("label_atom_id")])})}),Ne.struct.modifier.intersectBy({0:Ne.struct.generator.atomGroups({"residue-test":Ne.core.set.has([Ne.core.type.set(wi.nucleic),Ne.ammp("label_comp_id")])}),by:Ne.struct.generator.atomGroups({"atom-test":Ne.core.set.has([Ne.core.type.set(hbe.nucleic),Ne.ammp("label_atom_id")])})})])}var V7={all:{"@desc":"all atoms; same as *",abbr:["*"],map:()=>Ne.struct.generator.all()},bonded:{"@desc":"covalently bonded",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.core.rel.gr([Ne.struct.atomProperty.core.bondCount({flags:Ne.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})},clickable:{"@desc":"actually visible -- having some visible aspect such as wireframe, spacefill, or a label showing, or the alpha-carbon or phosphorus atom in a biomolecule that is rendered with only cartoon, rocket, or other biomolecule-specific shape."},connected:{"@desc":"bonded in any way, including hydrogen bonds",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.core.rel.gr([Ne.struct.atomProperty.core.bondCount({flags:Ne.struct.type.bondFlags()}),0])})},displayed:{"@desc":"displayed using the display or hide command; not necessarily visible"},hidden:{"@desc":"hidden using the display or hide command"},none:{"@desc":"no atoms",map:()=>Ne.struct.generator.empty()},selected:{"@desc":"atoms that have been selected; defaults to all when a file is first loaded"},thisModel:{"@desc":'atoms in the current frame set, as defined by frame, model, or animation commands. If more than one model is in this set, "thisModel" refers to all of them, regardless of atom displayed/hidden status.'},visible:{"@desc":"visible in any way, including PDB residue atoms for which a cartoon or other such rendering makes their group visible, even if they themselves are not visible."},subset:{"@desc":"the currently defined subset. Note that if a subset is currently defined, then select/display all is the same as select/display subset, restrict none is the same as restrict not subset. In addition, select not subset selects nothing."},specialPosition:{"@desc":"atoms in crystal structures that are at special positions - that is, for which there is more than one operator that leads to them."},unitcell:{"@desc":"atoms within the current unitcell, which may be offset. This includes atoms on the faces and at the vertices of the unitcell."},polyhedra:{"@desc":"all central atoms for which polyhedra have been created. See also polyhera(n), below. (Jmol 14.4)"},nonmetal:{"@desc":"_H,_He,_B,_C,_N,_O,_F,_Ne,_Si,_P,_S,_Cl,_Ar,_As,_Se,_Br,_Kr,_Te,_I,_Xe,_At,_Rn",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.core.set.has([Ne.set(...["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(Ne.es)),Ne.acp("elementSymbol")])})},metal:{"@desc":"!nonmetal",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.core.logic.not([Ne.core.set.has([Ne.set(...["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(Ne.es)),Ne.acp("elementSymbol")])])})},alkaliMetal:{"@desc":"_Li,_Na,_K,_Rb,_Cs,_Fr",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.core.set.has([Ne.set(...["Li","Na","K","Rb","Cs","Fr"].map(Ne.es)),Ne.acp("elementSymbol")])})},alkalineEarth:{"@desc":"_Be,_Mg,_Ca,_Sr,_Ba,_Ra",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.core.set.has([Ne.set(...["Be","Mg","Ca","Sr","Ba","Ra"].map(Ne.es)),Ne.acp("elementSymbol")])})},nobleGas:{"@desc":"_He,_Ne,_Ar,_Kr,_Xe,_Rn",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.core.set.has([Ne.set(...["He","Ne","Ar","Kr","Xe","Rn"].map(Ne.es)),Ne.acp("elementSymbol")])})},metalloid:{"@desc":"_B,_Si,_Ge,_As,_Sb,_Te",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.core.set.has([Ne.set(...["B","Si","Ge","As","Sb","Te"].map(Ne.es)),Ne.acp("elementSymbol")])})},transitionMetal:{"@desc":"(includes La and Ac) elemno>=21 and elemno<=30, elemno=57, elemno=89, elemno>=39 and elemno<=48, elemno>=72 and elemno<=80, elemno>=104 and elemno<=112",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.core.logic.or([Ne.core.rel.inRange([Ne.acp("atomicNumber"),21,30]),Ne.core.rel.inRange([Ne.acp("atomicNumber"),39,48]),Ne.core.rel.inRange([Ne.acp("atomicNumber"),72,80]),Ne.core.rel.inRange([Ne.acp("atomicNumber"),104,112]),Ne.core.set.has([Ne.set(57,89),Ne.acp("atomicNumber")])])})},lanthanide:{"@desc":"(does not include La) elemno>57 and elemno<=71",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.core.rel.inRange([Ne.acp("atomicNumber"),57,71])})},actinide:{"@desc":"(does not include Ac) elemno>89 and elemno<=103",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.core.rel.inRange([Ne.acp("atomicNumber"),89,103])})},isaromatic:{"@desc":"atoms connected with the AROMATIC, AROMATICSINGLE, or AROMATICDOUBLE bond types",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.core.rel.gr([Ne.struct.atomProperty.core.bondCount({flags:Ne.struct.type.bondFlags(["aromatic"])}),0])})},carbohydrate:{"@desc":""},ions:{"@desc":'(specifically the PDB designations "PO4" and "SO4")'},ligand:{"@desc":'(originally "hetero and not solvent"; changed to "!(protein,nucleic,water,UREA)" for Jmol 12.2)'},nucleic:{"@desc":`any group that (a) has one of the following group names: G, C, A, T, U, I, DG, DC, DA, DT, DU, DI, +G, +C, +A, +T, +U, +I; or (b) can be identified as a group that is only one atom, with name "P"; or (c) has all of the following atoms (prime, ', can replace * here): C1*, C2*, C3*, O3*, C4*, C5*, and O5*.`,map:()=>T_()},purine:{"@desc":"any nucleic group that (a) has one of the following group names: A, G, I, DA, DG, DI, +A, +G, or +I; or (b) also has atoms N7, C8, and N9.",map:()=>Ne.struct.modifier.intersectBy({0:T_(),by:Ne.struct.combinator.merge([Ne.struct.generator.atomGroups({"residue-test":Ne.core.set.has([Ne.set("A","G","I","DA","DG","DI","+A","+G","+I"),Ne.ammp("label_comp_id")])}),Ne.struct.filter.pick({0:Ne.struct.generator.atomGroups({"group-by":Ne.ammp("residueKey")}),test:Ne.core.set.isSubset([nd(["N7","C8","N9"]),Ne.ammpSet("label_atom_id")])})])})},pyrimidine:{"@desc":"any nucleic group that (a) has one of the following group names: C, T, U, DC, DT, DU, +C, +T, +U; or (b) also has atom O2.",map:()=>Ne.struct.modifier.intersectBy({0:T_(),by:Ne.struct.combinator.merge([Ne.struct.generator.atomGroups({"residue-test":Ne.core.set.has([Ne.set("C","T","U","DC","DT","DU","+C","+T","+U"),Ne.ammp("label_comp_id")])}),Ne.struct.filter.pick({0:Ne.struct.generator.atomGroups({"group-by":Ne.ammp("residueKey")}),test:Ne.core.logic.or([Ne.core.set.has([Ne.ammpSet("label_atom_id"),Ne.atomName("O2*")]),Ne.core.set.has([Ne.ammpSet("label_atom_id"),Ne.atomName("O2'")])])})])})},dna:{"@desc":"any nucleic group that (a) has one of the following group names: DG, DC, DA, DT, DU, DI, T, +G, +C, +A, +T; or (b) has neither atom O2* or O2'.",map:()=>Ne.struct.modifier.intersectBy({0:T_(),by:Ne.struct.combinator.merge([Ne.struct.generator.atomGroups({"residue-test":Ne.core.set.has([Ne.set("DG","DC","DA","DT","DU","DI","T","+G","+C","+A","+T"),Ne.ammp("label_comp_id")])}),Ne.struct.filter.pick({0:Ne.struct.generator.atomGroups({"group-by":Ne.ammp("residueKey")}),test:Ne.core.logic.not([Ne.core.logic.or([Ne.core.set.has([Ne.ammpSet("label_atom_id"),Ne.atomName("O2*")]),Ne.core.set.has([Ne.ammpSet("label_atom_id"),Ne.atomName("O2'")])])])})])})},rna:{"@desc":"any nucleic group that (a) has one of the following group names: G, C, A, U, I, +U, +I; or (b) has atom O2* or O2'.",map:()=>Ne.struct.modifier.intersectBy({0:T_(),by:Ne.struct.combinator.merge([Ne.struct.generator.atomGroups({"residue-test":Ne.core.set.has([Ne.set("G","C","A","U","I","+U","+I"),Ne.ammp("label_comp_id")])}),Ne.struct.filter.pick({0:Ne.struct.generator.atomGroups({"group-by":Ne.ammp("residueKey")}),test:Ne.core.logic.or([Ne.core.set.has([Ne.ammpSet("label_atom_id"),Ne.atomName("O2*")]),Ne.core.set.has([Ne.ammpSet("label_atom_id"),Ne.atomName("O2'")])])})])})},protein:{"@desc":'defined as a group that (a) has one of the following group names: ALA, ARG, ASN, ASP, CYS, GLN, GLU, GLY, HIS, ILE, LEU, LYS, MET, PHE, PRO, SER, THR, TRP, TYR, VAL, ASX, GLX, or UNK; or (b) contains PDB atom designations [C, O, CA, and N] bonded correctly; or (c) does not contain "O" but contains [C, CA, and N] bonded correctly; or (d) has only one atom, which has name CA and does not have the group name CA (indicating a calcium atom).',map:()=>ZZe()},acidic:{"@desc":"ASP GLU",map:()=>On(wi.acidic)},acyclic:{"@desc":"amino and not cyclic",map:()=>Ne.struct.modifier.intersectBy({0:On(wi.amino),by:Nl(On(wi.cyclic))})},aliphatic:{"@desc":"ALA GLY ILE LEU VAL",map:()=>On(wi.aliphatic)},amino:{"@desc":"all twenty standard amino acids, plus ASX, GLX, UNK",map:()=>On(wi.amino)},aromatic:{"@desc":'HIS PHE TRP TYR (see also "isaromatic" for aromatic bonds)',map:()=>On(wi.aromatic)},basic:{"@desc":"ARG HIS LYS",map:()=>On(wi.basic)},buried:{"@desc":"ALA CYS ILE LEU MET PHE TRP VAL",map:()=>On(wi.buried)},charged:{"@desc":"same as acidic or basic -- ASP GLU, ARG HIS LYS",map:()=>On(wi.acidic.concat(wi.basic))},cyclic:{"@desc":"HIS PHE PRO TRP TYR",map:()=>On(wi.cyclic)},helix:{"@desc":"secondary structure-related.",map:()=>Ne.struct.generator.atomGroups({"residue-test":Ne.core.flags.hasAny([Ne.struct.type.secondaryStructureFlags(["helix"]),Ne.ammp("secondaryStructureFlags")])})},helixalpha:{"@desc":"secondary structure-related.",map:()=>Ne.struct.generator.atomGroups({"residue-test":Ne.core.flags.hasAny([Ne.struct.type.secondaryStructureFlags(["alpha"]),Ne.ammp("secondaryStructureFlags")])})},helix310:{"@desc":"secondary structure-related.",map:()=>Ne.struct.generator.atomGroups({"residue-test":Ne.core.flags.hasAny([Ne.struct.type.secondaryStructureFlags(["3-10"]),Ne.ammp("secondaryStructureFlags")])})},helixpi:{"@desc":"secondary structure-related.",map:()=>Ne.struct.generator.atomGroups({"residue-test":Ne.core.flags.hasAny([Ne.struct.type.secondaryStructureFlags(["pi"]),Ne.ammp("secondaryStructureFlags")])})},hetero:{"@desc":"PDB atoms designated as HETATM",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.ammp("isHet")})},hydrophobic:{"@desc":"ALA GLY ILE LEU MET PHE PRO TRP TYR VAL",map:()=>On(wi.hydrophobic)},large:{"@desc":"ARG GLU GLN HIS ILE LEU LYS MET PHE TRP TYR",map:()=>On(wi.large)},medium:{"@desc":"ASN ASP CYS PRO THR VAL",map:()=>On(wi.medium)},negative:{"@desc":"same as acidic -- ASP GLU",map:()=>On(wi.acidic)},neutral:{"@desc":"amino and not (acidic or basic)",map:()=>Ne.struct.modifier.intersectBy({0:On(wi.amino),by:Nl(On(wi.acidic.concat(wi.basic)))})},polar:{"@desc":"amino and not hydrophobic",map:()=>Ne.struct.modifier.intersectBy({0:On(wi.amino),by:Nl(On(wi.hydrophobic))})},positive:{"@desc":"same as basic -- ARG HIS LYS",map:()=>On(wi.basic)},sheet:{"@desc":"secondary structure-related",map:()=>Ne.struct.generator.atomGroups({"residue-test":Ne.core.flags.hasAny([Ne.struct.type.secondaryStructureFlags(["sheet"]),Ne.ammp("secondaryStructureFlags")])})},small:{"@desc":"ALA GLY SER",map:()=>On(wi.small)},surface:{"@desc":"amino and not buried",map:()=>Ne.struct.modifier.intersectBy({0:On(wi.amino),by:Nl(On(wi.buried))})},turn:{"@desc":"secondary structure-related",map:()=>Ne.struct.generator.atomGroups({"residue-test":Ne.core.flags.hasAny([Ne.struct.type.secondaryStructureFlags(["turn"]),Ne.ammp("secondaryStructureFlags")])})},alpha:{"@desc":"(*.CA)",map:()=>Ne.struct.generator.atomGroups({"atom-test":Ne.core.rel.eq([Ne.atomName("CA"),Ne.ammp("label_atom_id")])})},base:{"@desc":"(nucleic bases)"},backbone:{"@desc":"(*.C, *.CA, *.N, and all nucleic other than the bases themselves)",abbr:["mainchain"],map:()=>qZe()},sidechain:{"@desc":"((protein or nucleic) and not backbone)"},spine:{"@desc":"(*.CA, *.N, *.C for proteins; *.P, *.O3', *.O5', *.C3', *.C4', *.C5 for nucleic acids)"},leadatom:{"@desc":"(*.CA, *.P, and terminal *.O5')"},solvent:{"@desc":'PDB "HOH", water, also the connected set of H-O-H in any model'}};var mn=ne,YZe=[{"@desc":"value comparisons","@examples":[],name:"=",abbr:["=="],type:Ws,rule:Ye.regexp(/\s*(LIKE|>=|<=|=|!=|>|<)\s*/i,1),map:(e,t,r)=>{let n;if(t==="structure"?n=mn.core.flags.hasAny([mn.ammp("secondaryStructureFlags"),k7(r)]):r==="structure"?n=mn.core.flags.hasAny([mn.ammp("secondaryStructureFlags"),k7(t)]):t.head!==void 0?t.head.name==="core.type.regex"&&(n=mn.core.str.match([t,mn.core.type.str([r])])):r.head!==void 0?r.head.name==="core.type.regex"&&(n=mn.core.str.match([r,mn.core.type.str([t])])):e.toUpperCase()==="LIKE"&&(t.head?n=mn.core.str.match([mn.core.type.regex([`^${r}$`,"i"]),mn.core.type.str([t])]):n=mn.core.str.match([mn.core.type.regex([`^${t}$`,"i"]),mn.core.type.str([r])])),!n)switch(t.head&&(r=rS(t,r)),r.head&&(t=rS(r,t)),e){case"=":n=mn.core.rel.eq([t,r]);break;case"!=":n=mn.core.rel.neq([t,r]);break;case">":n=mn.core.rel.gr([t,r]);break;case"<":n=mn.core.rel.lt([t,r]);break;case">=":n=mn.core.rel.gre([t,r]);break;case"<=":n=mn.core.rel.lte([t,r]);break;default:throw new Error(`value operator '${e}' not supported`)}return mn.struct.generator.atomGroups({"atom-test":n})}}];function KZe(e){let[t,r,n,o,i,a,s]=e[1],l={};i&&(l["chain-test"]=mn.core.rel.eq([mn.ammp("auth_asym_id"),i]));let u=[];t&&u.push(mn.core.rel.eq([mn.ammp("label_comp_id"),t])),r&&u.push(mn.core.logic.and([mn.core.rel.gre([mn.ammp("auth_seq_id"),r[0]]),mn.core.rel.lte([mn.ammp("auth_seq_id"),r[1]])])),n&&u.push(mn.core.rel.eq([mn.ammp("auth_seq_id"),n])),o&&u.push(mn.core.rel.eq([mn.ammp("pdbx_PDB_ins_code"),o])),u.length&&(l["residue-test"]=v_(u));let c=[];return a&&c.push(mn.core.rel.eq([mn.ammp("auth_atom_id"),a])),s&&c.push(mn.core.rel.eq([mn.ammp("label_alt_id"),s])),c.length&&(l["atom-test"]=v_(c)),mn.struct.generator.atomGroups(l)}var JZe=Ye.createLanguage({Integer:()=>Ye.regexp(/-?[0-9]+/).map(Number).desc("integer"),Parens:function(e){return Ye.alt(e.Parens,e.Operator,e.Expression).wrap(Ye.regexp(/\(\s*/),Ye.regexp(/\s*\)/))},Expression:function(e){return Ye.alt(e.Keywords,e.AtomExpression.map(KZe),e.Within.map(t=>mn.struct.modifier.includeSurroundings({0:t[1],radius:t[0]})),e.ValueQuery,e.Element.map(t=>mn.struct.generator.atomGroups({"atom-test":mn.core.rel.eq([mn.acp("elementSymbol"),mn.struct.type.elementSymbol(t)])})),e.Resname.map(t=>mn.struct.generator.atomGroups({"residue-test":mn.core.rel.eq([mn.ammp("label_comp_id"),t])})))},Operator:function(e){return Dx(F7,Ye.alt(e.Parens,e.Expression))},AtomExpression:function(e){return Ye.seq(Ye.lookahead(e.AtomPrefix),Ye.seq(e.BracketedResname.or(Ye.of(null)),e.ResnoRange.or(Ye.of(null)),e.Resno.or(Ye.of(null)),e.Inscode.or(Ye.of(null)),e.Chainname.or(Ye.of(null)),e.Atomname.or(Ye.of(null)),e.Altloc.or(Ye.of(null)),e.Model.or(Ye.of(null)))).desc("expression")},AtomPrefix:()=>Ye.regexp(/[\[0-9:^%/.-]/).desc("atom-prefix"),Chainname:()=>Ye.regexp(/:([A-Za-z]{1,3})/,1).desc("chainname"),Model:()=>Ye.regexp(/\/([0-9]+)/,1).map(Number).desc("model"),Element:()=>Ye.regexp(/_([A-Za-z]{1,3})/,1).desc("element"),Atomname:()=>Ye.regexp(/\.([a-zA-Z0-9]{1,4})/,1).map(mn.atomName).desc("atomname"),Resname:()=>Ye.regexp(/[a-zA-Z0-9]{1,4}/).desc("resname"),Resno:e=>e.Integer.desc("resno"),Altloc:()=>Ye.regexp(/%([a-zA-Z0-9])/,1).desc("altloc"),Inscode:()=>Ye.regexp(/\^([a-zA-Z0-9])/,1).desc("inscode"),BracketedResname:()=>Ye.regexp(/\[([a-zA-Z0-9]{1,4})\]/,1).desc("bracketed-resname"),ResnoRange:e=>Ye.seq(e.Integer.skip(Ye.seq(Ye.optWhitespace,Ye.string("-"),Ye.optWhitespace)),e.Integer).desc("resno-range"),Within:e=>Ye.regexp(/within/i).skip(Ye.regexp(/\s*\(\s*/)).then(Ye.seq(e.Integer.skip(Ye.regexp(/\s*,\s*/)),e.Query)).skip(Ye.regexp(/\)/)),Keywords:()=>Ye.alt(...gI(V7)).desc("keyword"),Query:function(e){return Ye.alt(e.Operator,e.Parens,e.Expression).trim(Ye.optWhitespace)},Number:function(){return Ye.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){let e=yI(L7,V7,F7).sort(gm).map(Gg).join("|");return Ye.alt(Ye.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i")),Ye.regexp(/'((?:[^"\\]|\\.)*)'/,1),Ye.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(t=>mn.core.type.regex([`^${t}$`,"i"]))).desc("string")},Value:function(e){return Ye.alt(e.Number,e.String)},ValueParens:function(e){return Ye.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(Ye.string("("),Ye.string(")"))},ValuePropertyNames:function(){return Ye.alt(...I_(L7,/LIKE|>=|<=|=|!=|>|<|\)|\s/i))},ValueOperator:function(e){return Dx(YZe,Ye.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return Ye.alt(e.Value,e.ValuePropertyNames)},ValueQuery:function(e){return Ye.alt(e.ValueOperator.map(t=>{if(t.head){if(t.head.name.startsWith("structure-query.generator"))return t}else if(typeof t=="string"&&t.length<=4)return mn.struct.generator.atomGroups({"residue-test":mn.core.rel.eq([mn.ammp("label_comp_id"),t])});throw new Error(`values must be part of an comparison, value '${t}'`)}))}}),gbe=e=>JZe.Query.tryParse(e);var zl=ne,xk=/[-+]?[0-9]*\.?[0-9]+/;function $Ze(e){return e.split("+").map(zl.atomName)}function bI(e){return e.split("+").map(t=>t.replace(/^["']|["']$/g,""))}function O7(e){if(e.includes("-")&&e.includes("+")){let t=e.split("+").map(n=>n.replace(/^["']|["']$/g,"")),r=[];return t.forEach(n=>{if(n.includes("-")&&!n.startsWith("-")){let[o,i]=n.split("-").map(a=>parseInt(a));for(let a=o;a<=i;a++)r.push(a)}else if(n.includes("-")&&n.startsWith("-")&&n.match(/[0-9]+-[-0-9]+/)){let o=-parseInt(n.split("-")[1]),i;n.includes("--")?i=-parseInt(n.split("-")[3]):i=parseInt(n.split("-")[2]);for(let a=o;a<=i;a++)r.push(a)}else n.includes("-")&&n.startsWith("-")&&n.match(/[0-9]+-[-0-9]+/),r.push(parseInt(n))}),r}else if(e.includes("-")&&!e.includes("+")){let t=[];if(e.startsWith("-"))if(e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/)){let r=-parseInt(e.split("-")[1]),n;e.includes("--")?n=-parseInt(e.split("-")[3]):n=parseInt(e.split("-")[2]);for(let o=r;o<=n;o++)t.push(o)}else e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/),t.push(parseInt(e));else{let[r,n]=e.split("-").map(o=>parseInt(o));for(let o=r;o<=n;o++)t.push(o)}return t}else return!e.includes("-")&&e.includes("+")?bI(e).map(t=>parseInt(t)):[parseInt(e)]}function eqe(e){return e.split("+").map(zl.struct.type.elementSymbol)}var tqe={H:"helix",S:"beta",L:"none"};function rqe(e){return{flags:zl.struct.type.secondaryStructureFlags(e.toUpperCase().split("+").map(t=>tqe[t]||"none"))}}var P_={symbol:{"@desc":"chemical-symbol-list: list of 1- or 2-letter chemical symbols from the periodic table","@examples":["symbol O+N"],abbr:["e."],regex:/[a-zA-Z'"+]+/,map:eqe,level:"atom-test",property:zl.acp("elementSymbol")},name:{"@desc":"atom-name-list: list of up to 4-letter codes for atoms in proteins or nucleic acids","@examples":["name CA+CB+CG+CD"],abbr:["n."],regex:/[a-zA-Z0-9'"+]+/,map:$Ze,level:"atom-test",property:zl.ammp("label_atom_id")},resn:{"@desc":"residue-name-list: list of 3-letter codes for amino acids or list of up to 2-letter codes for nucleic acids","@examples":["resn ASP+GLU+ASN+GLN","resn A+G"],abbr:["resname","r."],regex:/[a-zA-Z0-9'"+]+/,map:bI,level:"residue-test",property:zl.ammp("label_comp_id")},resi:{"@desc":"residue-identifier-list list of up to 4-digit residue numbers or residue-identifier-range","@examples":["resi 1+10+100+1000","resi 1-10"],abbr:["resident","residue","resid","i."],regex:/[0-9+-]+/,map:O7,level:"residue-test",property:zl.ammp("auth_seq_id")},alt:{"@desc":"alternate-conformation-identifier-list list of single letters","@examples":["alt A+B",'alt ""','alt ""+A'],abbr:[],regex:/[a-zA-Z0-9'"+]+/,map:bI,level:"atom-test",property:zl.ammp("label_alt_id")},chain:{"@desc":"chain-identifier-list list of single letters or sometimes numbers","@examples":["chain A"],abbr:["c."],regex:/[a-zA-Z0-9'"+]+/,map:bI,level:"chain-test",property:zl.ammp("auth_asym_id")},segi:{"@desc":"segment-identifier-list list of up to 4 letter identifiers","@examples":["segi lig"],abbr:["segid","s."],regex:/[a-zA-Z0-9'"+]+/,map:bI,level:"chain-test",property:zl.ammp("label_asym_id")},flag:{"@desc":"flag-number a single integer from 0 to 31","@examples":["flag 0"],isUnsupported:!0,abbr:["f."],regex:/[0-9]+/,map:e=>parseInt(e),level:"atom-test"},numeric_type:{"@desc":"type-number a single integer","@examples":["nt. 5"],isUnsupported:!0,abbr:["nt."],regex:/[0-9]+/,map:e=>parseInt(e),level:"atom-test"},text_type:{"@desc":"type-string a list of up to 4 letter codes","@examples":["text_type HA+HC"],isUnsupported:!0,abbr:["tt."],regex:/[a-zA-Z0-9'"+]+/,map:bI,level:"atom-test"},id:{"@desc":"external-index-number a single integer","@examples":["id 23"],regex:/[0-9+-]+/,map:O7,level:"atom-test",property:zl.ammp("id")},index:{"@desc":"internal-index-number a single integer","@examples":["index 11"],regex:/[0-9+-]+/,map:O7,level:"atom-test",property:zl.ammp("id")},ss:{"@desc":"secondary-structure-type list of single letters. Helical regions should be assigned H and sheet regions S. Loop regions can either be assigned L or be blank.","@examples":["ss H+S+L",'ss S+""'],abbr:[],regex:/[a-zA-Z'"+]+/,map:rqe,level:"residue-test",property:zl.ammp("secondaryStructureFlags")},b:{"@desc":"comparison-operator b-factor-value a real number","@examples":["b > 10"],isNumeric:!0,abbr:[],regex:xk,map:e=>parseFloat(e),level:"atom-test",property:zl.ammp("B_iso_or_equiv")},q:{"@desc":"comparison-operator occupancy-value a real number","@examples":["q <0.50"],isNumeric:!0,abbr:[],regex:xk,map:e=>parseFloat(e),level:"atom-test",property:zl.ammp("occupancy")},formal_charge:{"@desc":"comparison-operator formal charge-value an integer","@examples":["fc. = -1"],isNumeric:!0,abbr:["fc."],regex:xk,map:e=>parseFloat(e),level:"atom-test",property:zl.ammp("pdbx_formal_charge")},partial_charge:{"@desc":"comparison-operator partial charge-value a real number","@examples":["pc. > 1"],isUnsupported:!0,isNumeric:!0,abbr:["pc."],regex:xk,map:e=>parseFloat(e),level:"atom-test"},elem:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["elem N"],regex:/[a-zA-Z0-9]{1,3}/,map:e=>zl.es(e),level:"atom-test",property:zl.acp("elementSymbol")}};var Jr=ne,G7=[{"@desc":"Selects atoms that are not included in s1.","@examples":["NOT resn ALA","not (resi 42 or chain A)","!resi 42 or chain A"],name:"not",type:dl,rule:Ye.alt(Ye.regexp(/NOT/i).skip(Ye.whitespace),Ye.string("!").skip(Ye.optWhitespace)),map:(e,t)=>Nl(t)},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["chain A AND name CA"],name:"and",type:Ws,rule:op(/AND|&/i),map:(e,t,r)=>Jr.struct.modifier.intersectBy({0:t,by:r})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["chain A OR chain B"],name:"or",type:Ws,rule:op(/OR|\|/i),map:(e,t,r)=>Jr.struct.combinator.merge([t,r])},{"@desc":"Selects atoms in s1 whose identifiers name, resi, resn, chain and segi all match atoms in s2.","@examples":["chain A IN chain B"],name:"in",type:Ws,rule:op(/IN/i),map:(e,t,r)=>Jr.struct.filter.withSameAtomProperties({0:t,source:r,property:Jr.core.type.compositeKey([Jr.ammp("label_atom_id"),Jr.ammp("label_seq_id"),Jr.ammp("label_comp_id"),Jr.ammp("auth_asym_id"),Jr.ammp("label_asym_id")])})},{"@desc":"Selects atoms in s1 whose identifiers name and resi match atoms in s2.","@examples":["chain A LIKE chain B"],name:"like",type:Ws,rule:op(/LIKE|l\./i),map:(e,t,r)=>Jr.struct.filter.withSameAtomProperties({0:t,source:r,property:Jr.core.type.compositeKey([Jr.ammp("label_atom_id"),Jr.ammp("label_seq_id")])})},{"@desc":"Selects all atoms whose van der Waals radii are separated from the van der Waals radii of s1 by a minimum of X Angstroms.","@examples":["solvent GAP 2"],name:"gap",type:C_,rule:S_(/GAP\s+([-+]?[0-9]*\.?[0-9]+)/i,1).map(e=>parseFloat(e)),map:(e,t)=>Jr.struct.filter.within({0:Jr.struct.generator.all(),target:t,"atom-radius":Jr.acp("vdw"),"max-radius":e,invert:!0})},{"@desc":"Selects atoms with centers within X Angstroms of the center of any atom in s1.","@examples":["resname LIG AROUND 1"],name:"around",abbr:["a."],type:C_,rule:S_(/(AROUND|a\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(e=>parseFloat(e)),map:(e,t)=>Jr.struct.modifier.exceptBy({0:Jr.struct.filter.within({0:Jr.struct.generator.all(),target:t,"max-radius":e}),by:t})},{"@desc":"Expands s1 by all atoms within X Angstroms of the center of any atom in s1.","@examples":["chain A EXPAND 3"],name:"expand",abbr:["x."],type:C_,rule:S_(/(EXPAND|x\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(e=>parseFloat(e)),map:(e,t)=>Jr.struct.modifier.includeSurroundings({0:t,radius:e})},{"@desc":"Selects atoms in s1 that are within X Angstroms of any atom in s2.","@examples":["chain A WITHIN 3 OF chain B"],name:"within",abbr:["w."],type:Ws,rule:yk("WITHIN","w."),map:(e,t,r)=>Jr.struct.filter.within({0:t,target:r,"max-radius":e})},{"@desc":"Same as within, but excludes s2 from the selection (and thus is identical to s1 and s2 around X).","@examples":["chain A NEAR_TO 3 OF chain B"],name:"near_to",abbr:["nto."],type:Ws,rule:yk("NEAR_TO","nto."),map:(e,t,r)=>Jr.struct.modifier.exceptBy({0:Jr.struct.filter.within({0:t,target:r,"max-radius":e}),by:r})},{"@desc":"Selects atoms in s1 that are at least X Anstroms away from s2.","@examples":["solvent BEYOND 2 OF chain A"],name:"beyond",abbr:["be."],type:Ws,rule:yk("BEYOND","be."),map:(e,t,r)=>Jr.struct.modifier.exceptBy({0:Jr.struct.filter.within({0:t,target:r,"max-radius":e,invert:!0}),by:r})},{"@desc":"Expands selection to complete residues.","@examples":["BYRESIDUE name N"],name:"byresidue",abbr:["byresi","byres","br."],type:dl,rule:wc(/BYRESIDUE|byresi|byres|br\./i),map:(e,t)=>od(Jr.struct.modifier.expandProperty({0:Jr.struct.modifier.union({0:t}),property:Jr.ammp("residueKey")}))},{"@desc":"Completely selects all alpha carbons in all residues covered by a selection.","@examples":["BYCALPHA chain A"],name:"bycalpha",abbr:["bca."],type:dl,rule:wc(/BYCALPHA|bca\./i),map:(e,t)=>Jr.struct.generator.queryInSelection({0:Jr.struct.modifier.expandProperty({0:Jr.struct.modifier.union({0:t}),property:Jr.ammp("residueKey")}),query:Jr.struct.generator.atomGroups({"atom-test":Jr.core.rel.eq([Jr.atomName("CA"),Jr.ammp("label_atom_id")])})})},{"@desc":"Expands selection to complete molecules.","@examples":["BYMOLECULE resi 20-30"],name:"bymolecule",isUnsupported:!0,abbr:["bymol","bm."],type:dl,rule:wc(/BYMOLECULE|bymol|bm\./i),map:(e,t)=>od(Jr.struct.modifier.expandProperty({0:Jr.struct.modifier.union({0:t}),property:Jr.atp("connectedComponentKey")}))},{"@desc":"Expands selection to complete fragments.","@examples":["BYFRAGMENT resi 10"],name:"byfragment",abbr:["byfrag","bf."],isUnsupported:!0,type:dl,rule:wc(/BYFRAGMENT|byfrag|bf\./i),map:(e,t)=>[e,t]},{"@desc":"Expands selection to complete segments.","@examples":["BYSEGMENT resn CYS"],name:"bysegment",abbr:["bysegi","byseg","bs."],type:dl,rule:wc(/BYSEGMENT|bysegi|byseg|bs\./i),map:(e,t)=>od(Jr.struct.modifier.expandProperty({0:Jr.struct.modifier.union({0:t}),property:Jr.ammp("chainKey")}))},{"@desc":"Expands selection to complete objects.","@examples":["BYOBJECT chain A"],name:"byobject",abbr:["byobj","bo."],isUnsupported:!0,type:dl,rule:wc(/BYOBJECT|byobj|bo\./i),map:(e,t)=>[e,t]},{"@desc":"Expands selection to unit cell.","@examples":["BYCELL chain A"],name:"bycell",isUnsupported:!0,type:dl,rule:wc(/BYCELL/i),map:(e,t)=>[e,t]},{"@desc":"All rings of size \u2264 7 which have at least one atom in s1.","@examples":["BYRING resn HEM"],name:"byring",type:dl,rule:wc(/BYRING/i),map:(e,t)=>od(Jr.struct.modifier.intersectBy({0:Jr.struct.filter.pick({0:Jr.struct.generator.rings(),test:Jr.core.logic.and([Jr.core.rel.lte([Jr.struct.atomSet.atomCount(),7]),Jr.core.rel.gr([Jr.struct.atomSet.countQuery([t]),1])])}),by:t}))},{"@desc":"Selects atoms directly bonded to s1, excludes s1.","@examples":["NEIGHBOR resn CYS"],name:"neighbor",type:dl,abbr:["nbr."],rule:wc(/NEIGHBOR|nbr\./i),map:(e,t)=>Jr.struct.modifier.exceptBy({0:od(Jr.struct.modifier.includeConnected({0:Jr.struct.modifier.union({0:t}),"bond-test":!0})),by:t})},{"@desc":"Selects atoms directly bonded to s1, may include s1.","@examples":["BOUND_TO name CA"],name:"bound_to",abbr:["bto."],type:dl,rule:wc(/BOUND_TO|bto\./i),map:(e,t)=>od(Jr.struct.modifier.includeConnected({0:Jr.struct.modifier.union({0:t})}))},{"@desc":"Extends s1 by X bonds connected to atoms in s1.","@examples":["resname LIG EXTEND 3"],name:"extend",abbr:["xt."],type:C_,rule:S_(/(EXTEND|xt\.)\s+([0-9]+)/i,2).map(e=>parseInt(e)),map:(e,t)=>od(Jr.struct.modifier.includeConnected({0:Jr.struct.modifier.union({0:t}),"bond-test":!0,"layer-count":e}))}];var Qt=ne,Wu={nucleic:["A","C","T","G","U","DA","DC","DT","DG","DU"],protein:["ALA","ARG","ASN","ASP","CYS","CYX","GLN","GLU","GLY","HIS","HID","HIE","HIP","ILE","LEU","LYS","MET","MSE","PHE","PRO","SER","THR","TRP","TYR","VAL"],solvent:["HOH","WAT","H20","TIP","SOL"]},ybe={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],protein:["C","N","CA","O"]};function bbe(){return Qt.struct.combinator.merge([Qt.struct.modifier.intersectBy({0:Qt.struct.generator.atomGroups({"residue-test":Qt.core.set.has([Qt.core.type.set(Wu.protein),Qt.ammp("label_comp_id")])}),by:Qt.struct.generator.atomGroups({"atom-test":Qt.core.set.has([Qt.core.type.set(ybe.protein),Qt.ammp("label_atom_id")])})}),Qt.struct.modifier.intersectBy({0:Qt.struct.generator.atomGroups({"residue-test":Qt.core.set.has([Qt.core.type.set(Wu.nucleic),Qt.ammp("label_comp_id")])}),by:Qt.struct.generator.atomGroups({"atom-test":Qt.core.set.has([Qt.core.type.set(ybe.nucleic),Qt.ammp("label_atom_id")])})})])}var U7={all:{"@desc":"All atoms currently loaded into PyMOL",abbr:["*"],map:()=>Qt.struct.generator.all()},none:{"@desc":"No atoms (empty selection)",map:()=>Qt.struct.generator.empty()},hydrogens:{"@desc":"All hydrogen atoms currently loaded into PyMOL",abbr:["hydro","h."],map:()=>Qt.struct.generator.atomGroups({"atom-test":Qt.core.rel.eq([Qt.acp("elementSymbol"),Qt.es("H")])})},hetatm:{"@desc":"All atoms loaded from Protein Data Bank HETATM records",abbr:["het"],map:()=>Qt.struct.generator.atomGroups({"atom-test":Qt.core.rel.eq([Qt.ammp("isHet"),!0])})},visible:{"@desc":"All atoms in enabled objects with at least one visible representation",abbr:["v."]},polymer:{"@desc":"All atoms on the polymer (not het). Finds atoms with residue identifiers matching a known polymer, such a peptide and DNA.",abbr:["pol."],map:()=>Qt.struct.generator.atomGroups({"residue-test":Qt.core.set.has([Qt.core.type.set(Wu.nucleic.concat(Wu.protein)),Qt.ammp("label_comp_id")])})},sidechain:{"@desc":"Polymer non-backbone atoms (new in PyMOL 1.6.1)",abbr:["sc."],map:()=>Qt.struct.modifier.exceptBy({0:Qt.struct.generator.atomGroups({"residue-test":Qt.core.set.has([Qt.core.type.set(Wu.nucleic.concat(Wu.protein)),Qt.ammp("label_comp_id")])}),by:bbe()})},present:{"@desc":"All atoms with defined coordinates in the current state (used in creating movies)",abbr:["pr."]},center:{"@desc":"Pseudo-atom at the center of the scene"},origin:{"@desc":"Pseudo-atom at the origin of rotation"},enabled:{"@desc":"All enabled objects or selections from the object list."},masked:{"@desc":"All masked atoms.",abbr:["msk."]},protected:{"@desc":"All protected atoms.",abbr:["pr."]},bonded:{"@desc":"All bonded atoms",map:()=>Qt.struct.generator.atomGroups({"atom-test":Qt.core.rel.gr([Qt.struct.atomProperty.core.bondCount({flags:Qt.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})},donors:{"@desc":"All hydrogen bond donor atoms.",abbr:["don."]},acceptors:{"@desc":"All hydrogen bond acceptor atoms.",abbr:["acc."]},fixed:{"@desc":"All fixed atoms.",abbr:["fxd."]},restrained:{"@desc":"All restrained atoms.",abbr:["rst."]},organic:{"@desc":"All atoms in non-polymer organic compounds (e.g. ligands, buffers). Finds carbon-containing molecules that do not match known polymers.",abbr:["org."],map:()=>od(Qt.struct.modifier.expandProperty({0:Qt.struct.modifier.union([Qt.struct.generator.queryInSelection({0:Qt.struct.generator.atomGroups({"residue-test":Qt.core.logic.not([Qt.core.set.has([Qt.core.type.set(Wu.nucleic.concat(Wu.protein)),Qt.ammp("label_comp_id")])])}),query:Qt.struct.generator.atomGroups({"atom-test":Qt.core.rel.eq([Qt.es("C"),Qt.acp("elementSymbol")])})})]),property:Qt.ammp("residueKey")}))},inorganic:{"@desc":"All non-polymer inorganic atoms/ions. Finds atoms in molecules that do not contain carbon and do not match any known solvent residues.",abbr:["ino."],map:()=>od(Qt.struct.modifier.expandProperty({0:Qt.struct.modifier.union([Qt.struct.filter.pick({0:Qt.struct.generator.atomGroups({"residue-test":Qt.core.logic.not([Qt.core.set.has([Qt.core.type.set(Wu.nucleic.concat(Wu.protein).concat(Wu.solvent)),Qt.ammp("label_comp_id")])]),"group-by":Qt.ammp("residueKey")}),test:Qt.core.logic.not([Qt.core.set.has([Qt.struct.atomSet.propertySet([Qt.acp("elementSymbol")]),Qt.es("C")])])})]),property:Qt.ammp("residueKey")}))},solvent:{"@desc":"All water molecules. The hardcoded solvent residue identifiers are currently: HOH, WAT, H20, TIP, SOL.",abbr:["sol."],map:()=>Qt.struct.generator.atomGroups({"residue-test":Qt.core.set.has([Qt.core.type.set(Wu.solvent),Qt.ammp("label_comp_id")])})},guide:{"@desc":"All protein CA and nucleic acid C4*/C4",map:()=>Qt.struct.combinator.merge([Qt.struct.generator.atomGroups({"atom-test":Qt.core.rel.eq([Qt.atomName("CA"),Qt.ammp("label_atom_id")]),"residue-test":Qt.core.set.has([Qt.core.type.set(Wu.protein),Qt.ammp("label_comp_id")])}),Qt.struct.generator.atomGroups({"atom-test":Qt.core.set.has([nd(["C4*","C4'"]),Qt.ammp("label_atom_id")]),"residue-test":Qt.core.set.has([Qt.core.type.set(Wu.nucleic),Qt.ammp("label_comp_id")])})])},metals:{"@desc":"All metal atoms (new in PyMOL 1.6.1)"},backbone:{"@desc":"Polymer backbone atoms (new in PyMOL 1.6.1)",abbr:["bb."],map:()=>bbe()},"polymer.protein":{"@desc":"Protein (New in PyMOL 2.1)",abbr:["polymer.protein"],map:()=>Qt.struct.generator.atomGroups({"residue-test":Qt.core.set.has([Qt.core.type.set(Wu.protein),Qt.ammp("label_comp_id")])})},"polymer.nucleic":{"@desc":"Nucleic Acid (New in PyMOL 2.1)",abbr:["polymer.nucleic"],map:()=>Qt.struct.generator.atomGroups({"residue-test":Qt.core.set.has([Qt.core.type.set(Wu.nucleic),Qt.ammp("label_comp_id")])})}};var nqe=ne,za=cbe(P_),ss=Ye.string("/");function vi(e){return e.or(Ye.of(null))}function oqe(e){let t={},r={};for(let n in e){let o=P_[n];if(!o)throw new Error(`property '${n}' not supported, value '${e[n]}'`);e[n]!==null&&(r[o.level]||(r[o.level]=[]),r[o.level].push(e[n]))}for(let n in r)t[n]=v_(r[n]);return nqe.struct.generator.atomGroups(t)}var iqe=Ye.createLanguage({Parens:function(e){return Ye.alt(e.Parens,e.Operator,e.Expression).wrap(Ye.string("("),Ye.string(")"))},Expression:function(e){return Ye.alt(e.Keywords,e.AtomSelectionMacro.map(oqe),e.NamedAtomProperties,e.Pepseq,e.Rep,e.Object)},AtomSelectionMacro:function(e){return Ye.alt(ss.then(Ye.alt(Ye.seq(vi(e.ObjectProperty).skip(ss),vi(za.segi).skip(ss),vi(za.chain).skip(ss),vi(za.resi).skip(ss),vi(za.name)).map(t=>({object:t[0],segi:t[1],chain:t[2],resi:t[3],name:t[4]})),Ye.seq(vi(e.ObjectProperty).skip(ss),vi(za.segi).skip(ss),vi(za.chain).skip(ss),vi(za.resi)).map(t=>({object:t[0],segi:t[1],chain:t[2],resi:t[3]})),Ye.seq(vi(e.ObjectProperty).skip(ss),vi(za.segi).skip(ss),vi(za.chain)).map(t=>({object:t[0],segi:t[1],chain:t[2]})),Ye.seq(vi(e.ObjectProperty).skip(ss),vi(za.segi)).map(t=>({object:t[0],segi:t[1]})),Ye.seq(vi(e.ObjectProperty)).map(t=>({object:t[0]})))),Ye.alt(Ye.seq(vi(e.ObjectProperty).skip(ss),vi(za.segi).skip(ss),vi(za.chain).skip(ss),vi(za.resi).skip(ss),vi(za.name)).map(t=>({object:t[0],segi:t[1],chain:t[2],resi:t[3],name:t[4]})),Ye.seq(vi(za.segi).skip(ss),vi(za.chain).skip(ss),vi(za.resi).skip(ss),vi(za.name)).map(t=>({segi:t[0],chain:t[1],resi:t[2],name:t[3]})),Ye.seq(vi(za.chain).skip(ss),vi(za.resi).skip(ss),vi(za.name)).map(t=>({chain:t[0],resi:t[1],name:t[2]})),Ye.seq(vi(za.resi).skip(ss),vi(za.name)).map(t=>({resi:t[0],name:t[1]}))))},NamedAtomProperties:function(){return Ye.alt(...bk(P_))},Keywords:()=>Ye.alt(...gI(U7)),ObjectProperty:()=>{let e=yI(P_,U7,G7).sort(gm).map(Gg).join("|");return Ye.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i"))},Object:e=>e.ObjectProperty.notFollowedBy(ss).map(t=>{throw new Error(`property 'object' not supported, value '${t}'`)}),Pepseq:()=>Ye.regexp(/(PEPSEQ|ps\.)\s+([a-z]+)/i,2).map(xy("operator 'pepseq' not supported")),Rep:()=>Ye.regexp(/REP\s+(lines|spheres|mesh|ribbon|cartoon|sticks|dots|surface|labels|extent|nonbonded|nb_spheres|slice|extent|slice|dashes|angles|dihedrals|cgo|cell|callback|everything)/i,1).map(xy("operator 'rep' not supported")),Operator:function(e){return Dx(G7,Ye.alt(e.Parens,e.Expression,e.Operator))},Query:function(e){return Ye.alt(e.Operator,e.Parens,e.Expression).trim(Ye.optWhitespace)}}),xbe=e=>iqe.Query.tryParse(e);var ba=ne,ym=/[-+]?[0-9]*\.?[0-9]+/,Ck=/[+]?[0-9]+/,__=/[-+]?[0-9]+/;function nS(e){return e}var N7={T:"turn",E:"sheet",B:"strand",H:"alpha",G:"3-10",I:"pi",C:"none"};function Sk(e){return ba.struct.type.secondaryStructureFlags([N7[e.toUpperCase()]||"none"])}var Sy={name:{"@desc":"str    atom name","@examples":["name CA"],regex:/[a-zA-Z0-9]+/,map:ba.atomName,level:"atom-test",property:ba.ammp("label_atom_id")},type:{"@desc":"str    atom type","@examples":["type C3"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:nS,level:"atom-test"},index:{"@desc":"num    the atom number, starting at 0","@examples":["index 10"],isNumeric:!0,regex:Ck,map:e=>parseInt(e)-1,level:"atom-test",property:ba.ammp("id")},serial:{"@desc":"num    the atom number, starting at 1","@examples":["serial 11"],isNumeric:!0,regex:Ck,map:e=>parseInt(e),level:"atom-test",property:ba.ammp("id")},atomicnumber:{"@desc":"num    atomic number (0 if undefined)","@examples":["atomicnumber 13"],isNumeric:!0,regex:Ck,map:e=>parseInt(e),level:"atom-test",property:ba.acp("atomicNumber")},element:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["element N"],regex:/[a-zA-Z0-9]{1,3}/,map:e=>ba.es(e),level:"atom-test",property:ba.acp("elementSymbol")},altloc:{"@desc":"str  alternate location/conformation identifier","@examples":["altloc C"],regex:/[a-zA-Z0-9]+/,map:nS,level:"atom-test",property:ba.ammp("label_alt_id")},chain:{"@desc":"str  the one-character chain identifier","@examples":["chain A"],regex:/[a-zA-Z0-9]+/,map:nS,level:"residue-test",property:ba.ammp("auth_asym_id")},residue:{"@desc":"num  a set of connected atoms with the same residue number","@examples":["residue < 11","residue 11"],isNumeric:!0,regex:__,map:e=>parseInt(e),level:"residue-test",property:ba.ammp("auth_seq_id")},fragment:{"@desc":"num  a set of connected residues","@examples":["fragment 42"],isUnsupported:!0,isNumeric:!0,regex:__,map:e=>parseInt(e),level:"residue-test"},pfrag:{"@desc":"num  a set of connected protein residues","@examples":["pfrag 42"],isUnsupported:!0,isNumeric:!0,regex:__,map:e=>parseInt(e),level:"residue-test"},nfrag:{"@desc":"num  a set of connected nucleic residues","@examples":["nfrag 42"],isUnsupported:!0,isNumeric:!0,regex:__,map:e=>parseInt(e),level:"residue-test"},sequence:{"@desc":"str  a sequence given by one letter names","@examples":["sequence PGATTACA"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:nS,level:"residue-test"},numbonds:{"@desc":"num  number of bonds","@examples":["numbonds = 2","numbonds >= 3"],isNumeric:!0,regex:Ck,map:e=>parseInt(e),level:"atom-test",property:ba.acp("bondCount")},resname:{"@desc":"str  residue name","@examples":["resname ALA"],regex:/[a-zA-Z0-9]+/,map:nS,level:"residue-test",property:ba.ammp("auth_comp_id")},resid:{"@desc":"num  residue id","@examples":["resid 42"],isNumeric:!0,regex:__,map:e=>parseInt(e),level:"residue-test",property:ba.ammp("auth_seq_id")},segname:{"@desc":"str  segment name","@examples":["segname B"],regex:/[a-zA-Z0-9]+/,map:nS,level:"residue-test",property:ba.ammp("label_asym_id")},x:{"@desc":"float  x coordinate","@examples":["x 42"],isNumeric:!0,regex:ym,map:e=>parseFloat(e),level:"atom-test",property:ba.acp("x")},y:{"@desc":"float  y coordinate","@examples":["y > 1.7"],isNumeric:!0,regex:ym,map:e=>parseFloat(e),level:"atom-test",property:ba.acp("y")},z:{"@desc":"float  z coordinate","@examples":["z < 11","z > -21"],isNumeric:!0,regex:ym,map:e=>parseFloat(e),level:"atom-test",property:ba.acp("z")},radius:{"@desc":"float  atomic radius","@examples":["radius > 1.3"],isNumeric:!0,regex:ym,map:e=>parseFloat(e),level:"atom-test",property:ba.acp("vdw")},mass:{"@desc":"float  atomic mass","@examples":["mass > 2"],isNumeric:!0,regex:ym,map:e=>parseFloat(e),level:"atom-test",property:ba.acp("mass")},charge:{"@desc":"float  atomic charge","@examples":["charge > 0","charge 1"],isNumeric:!0,regex:ym,map:e=>parseFloat(e),level:"atom-test",property:ba.ammp("pdbx_formal_charge")},beta:{"@desc":"float  temperature factor","@examples":["beta < 20","beta > 35"],isNumeric:!0,regex:ym,map:e=>parseFloat(e),level:"atom-test",property:ba.ammp("B_iso_or_equiv")},occupancy:{"@desc":"float  occupancy","@examples":["occupancy 1","occupancy < 1"],isNumeric:!0,regex:ym,map:e=>parseFloat(e),level:"atom-test",property:ba.ammp("occupancy")},user:{"@desc":"float  time-varying user-specified value","@examples":["user < 0.1"],isUnsupported:!0,isNumeric:!0,regex:ym,map:e=>parseFloat(e),level:"atom-test"},rasmol:{"@desc":"str  translates Rasmol selection string to VMD","@examples":["rasmol 'all'"],isUnsupported:!0,regex:/[^']*/,map:nS,level:"atom-test"},structure:{"@desc":"str  single letter name for the secondary structure","@examples":["structure H","structure H E"],regex:/T|E|B|H|G|I|C/i,map:Sk,level:"atom-test",property:ba.ammp("secondaryStructureFlags")},phi:{"@desc":"float  phi backbone conformational angles","@examples":["phi < 160"],isUnsupported:!0,isNumeric:!0,regex:ym,map:e=>parseFloat(e),level:"residue-test"},psi:{"@desc":"float  psi backbone conformational angles","@examples":["psi < 160"],isUnsupported:!0,isNumeric:!0,regex:ym,map:e=>parseFloat(e),level:"residue-test"},ufx:{"@desc":"num  force to apply in the x coordinate","@examples":["ufx 1"],isUnsupported:!0,isNumeric:!0,regex:ym,map:e=>parseInt(e),level:"atom-test"},ufy:{"@desc":"num  force to apply in the y coordinate","@examples":["ufy 1"],isUnsupported:!0,isNumeric:!0,regex:ym,map:e=>parseInt(e),level:"atom-test"},ufz:{"@desc":"num  force to apply in the z coordinate","@examples":["ufz 1"],isUnsupported:!0,isNumeric:!0,regex:ym,map:e=>parseInt(e),level:"atom-test"}};var oS=ne,aqe=Object.keys(Sy).sort(gm).filter(e=>!Sy[e].isUnsupported).join("|"),z7=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not protein"],name:"not",type:dl,rule:Ye.regexp(/NOT/i).skip(Ye.whitespace),map:(e,t)=>Nl(t)},{"@desc":"Selects atoms within a specified distance of a selection","@examples":["within 5 of name FE"],name:"within",type:dl,rule:wc(/WITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(e=>parseFloat(e)),map:(e,t)=>oS.struct.modifier.includeSurroundings({0:t,radius:e})},{"@desc":"Exclusive within, equivalent to (within 3 of X) and not X","@examples":["exwithin 10 of resname HEM"],name:"exwithin",type:dl,rule:wc(/EXWITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(e=>parseFloat(e)),map:(e,t)=>oS.struct.modifier.exceptBy({0:oS.struct.modifier.includeSurroundings({0:t,radius:e}),by:t})},{"@desc":"Selects atoms which have the same keyword as the atoms in a given selection","@examples":["same resid as name FE"],name:"same",type:dl,rule:wc(new RegExp(`SAME\\s+(${aqe})\\s+AS`,"i"),1).map(e=>Sy[e].property),map:(e,t)=>oS.struct.filter.withSameAtomProperties({0:oS.struct.generator.all(),source:t,property:e})},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["backbone and protein"],name:"and",type:Ws,rule:Ye.alt(op(/AND/i),Ye.whitespace),map:(e,t,r)=>oS.struct.modifier.intersectBy({0:t,by:r})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["water or protein"],name:"or",type:Ws,rule:op(/OR/i),map:(e,t,r)=>oS.struct.combinator.merge([t,r])}];var hn=ne;function vy(){return hn.struct.filter.pick({0:hn.struct.generator.atomGroups({"group-by":hn.ammp("residueKey")}),test:hn.core.set.isSubset([nd(["C","N","CA","O"]),hn.ammpSet("label_atom_id")])})}function H7(){return hn.struct.filter.pick({0:hn.struct.generator.atomGroups({"group-by":hn.ammp("residueKey")}),test:hn.core.logic.and([hn.core.set.isSubset([nd(["P"]),hn.ammpSet("label_atom_id")]),hn.core.logic.or([hn.core.set.isSubset([nd(["O3'","C3'","C4'","C5'","O5'"]),hn.ammpSet("label_atom_id")]),hn.core.set.isSubset([nd(["O3*","C3*","C4*","C5*","O5*"]),hn.ammpSet("label_atom_id")])])])})}function Cbe(){return hn.struct.combinator.merge([hn.struct.generator.queryInSelection({0:vy(),query:hn.struct.generator.atomGroups({"atom-test":hn.core.set.has([nd(Sbe.protein),hn.ammp("label_atom_id")])})}),hn.struct.generator.queryInSelection({0:H7(),query:hn.struct.generator.atomGroups({"atom-test":hn.core.set.has([nd(Sbe.nucleic),hn.ammp("label_atom_id")])})})])}function Gh(e){return hn.struct.generator.atomGroups({"residue-test":hn.core.flags.hasAll([hn.ammp("secondaryStructureFlags"),hn.struct.type.secondaryStructureFlags(e)])})}var Sbe={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*"],protein:["C","N","CA","O"]},ls={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],aromatic:["HIS","PHE","TRP","TYR"],at:["ADA","A","THY","T"],basic:["ARG","HIS","LYS"],buried:["ALA","LEU","VAL","ILE","PHE","CYS","MET","TRP"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","LEU","VAL","ILE","PRO","PHE","MET","TRP"],medium:["VAL","THR","ASP","ASN","PRO","CYS","ASX","PCA","HYP"],neutral:["VAL","PHE","GLN","TYR","HIS","CYS","MET","TRP","ASX","GLX","PCA","HYP"],purine:["ADE","A","GUA","G"],pyrimidine:["CYT","C","THY","T","URI","U"],small:["ALA","GLY","SER"],water:["H2O","HH0","OHH","HOH","OH2","SOL","WAT","TIP","TIP2","TIP3","TIP4"]},j7={all:{"@desc":"everything",map:()=>hn.struct.generator.all()},none:{"@desc":"nothing",map:()=>hn.struct.generator.empty()},protein:{"@desc":"a residue with atoms named C, N, CA, and O",map:()=>vy()},nucleic:{"@desc":"a residue with atoms named P, O1P, O2P and either O3', C3', C4', C5', O5' or O3*, C3*, C4*, C5*, O5*. This definition assumes that the base is phosphorylated, an assumption which will be corrected in the future.",map:()=>H7()},backbone:{"@desc":"the C, N, CA, and O atoms of a protein and the equivalent atoms in a nucleic acid.",map:()=>Cbe()},sidechain:{"@desc":"non-backbone atoms and bonds",map:()=>Nl(Cbe())},water:{"@desc":"all atoms with the resname H2O, HH0, OHH, HOH, OH2, SOL, WAT, TIP, TIP2, TIP3 or TIP4",abbr:["waters"],map:()=>On(ls.water)},at:{"@desc":"residues named ADA A THY T",map:()=>On(ls.at)},acidic:{"@desc":"residues named ASP GLU",map:()=>On(ls.acidic)},acyclic:{"@desc":'"protein and not cyclic"',map:()=>hn.struct.modifier.intersectBy({0:vy(),by:Nl(On(ls.cyclic))})},aliphatic:{"@desc":"residues named ALA GLY ILE LEU VAL",map:()=>On(ls.aliphatic)},alpha:{"@desc":"atom's residue is an alpha helix",map:()=>Gh(["alpha"])},amino:{"@desc":"a residue with atoms named C, N, CA, and O",map:()=>vy()},aromatic:{"@desc":"residues named HIS PHE TRP TYR",map:()=>On(ls.aromatic)},basic:{"@desc":"residues named ARG HIS LYS",map:()=>On(ls.basic)},bonded:{"@desc":"atoms for which numbonds > 0",map:()=>od(hn.struct.filter.pick({0:hn.struct.modifier.includeConnected({0:hn.struct.generator.all(),"bond-test":hn.core.flags.hasAny([hn.struct.bondProperty.flags(),hn.struct.type.bondFlags(["covalent","metallic","sulfide"])])}),test:hn.core.rel.gr([hn.struct.atomSet.atomCount(),1])}))},buried:{"@desc":"residues named ALA LEU VAL ILE PHE CYS MET TRP",map:()=>On(ls.buried)},cg:{"@desc":"residues named CYT C GUA G",map:()=>On(ls.cg)},charged:{"@desc":'"basic or acidic"',map:()=>On(ls.basic.concat(ls.acidic))},cyclic:{"@desc":"residues named HIS PHE PRO TRP TYR",map:()=>On(ls.cyclic)},hetero:{"@desc":'"not (protein or nucleic)"',map:()=>Nl(hn.struct.combinator.merge([vy(),H7()]))},hydrogen:{"@desc":'name "[0-9]?H.*"',map:()=>hn.struct.generator.atomGroups({"atom-test":hn.core.str.match([hn.core.type.regex(["^[0-9]?[H].*$","i"]),hn.core.type.str([hn.ammp("label_atom_id")])])})},large:{"@desc":'"protein and not (small or medium)"',map:()=>hn.struct.modifier.intersectBy({0:vy(),by:Nl(On(ls.small.concat(ls.medium)))})},medium:{"@desc":"residues named VAL THR ASP ASN PRO CYS ASX PCA HYP",map:()=>On(ls.medium)},neutral:{"@desc":"residues named VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP",map:()=>On(ls.neutral)},hydrophobic:{"@desc":"hydrophobic resname ALA LEU VAL ILE PRO PHE MET TRP",map:()=>On(ls.hydrophobic)},polar:{"@desc":'"protein and not hydrophobic"',map:()=>hn.struct.modifier.intersectBy({0:vy(),by:Nl(On(ls.hydrophobic))})},purine:{"@desc":"residues named ADE A GUA G",map:()=>On(ls.purine)},pyrimidine:{"@desc":"residues named CYT C THY T URI U",map:()=>On(ls.pyrimidine)},small:{"@desc":"residues named ALA GLY SER",map:()=>On(ls.small)},surface:{"@desc":'"protein and not buried"',map:()=>hn.struct.modifier.intersectBy({0:vy(),by:Nl(On(ls.buried))})},alpha_helix:{"@desc":"atom's residue is in an alpha helix",map:()=>Gh(["alpha"])},pi_helix:{"@desc":"atom's residue is in a pi helix",map:()=>Gh(["pi"])},helix_3_10:{"@desc":"atom's residue is in a 3-10 helix",map:()=>Gh(["3-10"])},helix:{"@desc":"atom's residue is in an alpha or pi or 3-10 helix",map:()=>Gh(["helix"])},extended_beta:{"@desc":"atom's residue is a beta sheet",map:()=>Gh(["sheet"])},bridge_beta:{"@desc":"atom's residue is a beta sheet",map:()=>Gh(["strand"])},sheet:{"@desc":"atom's residue is a beta sheet",map:()=>Gh(["beta"])},turn:{"@desc":"atom's residue is in a turn conformation",map:()=>Gh(["turn"])},coil:{"@desc":"atom's residue is in a coil conformation",map:()=>hn.struct.modifier.intersectBy({0:vy(),by:Gh(["none"])})}};var gu=ne,vbe={sqr:{"@desc":"square of x","@examples":["sqr(2)"],map:e=>gu.core.math.pow([e,2])},sqrt:{"@desc":"square root of x","@examples":["sqrt(2)"],map:e=>gu.core.math.sqrt([e])},abs:{"@desc":"absolute value of x","@examples":["abs(2)"],map:e=>gu.core.math.abs([e])},floor:{"@desc":"largest integer not greater than x","@examples":["floor(2)"],map:e=>gu.core.math.floor([e])},ceil:{"@desc":"smallest integer not less than x","@examples":["ceil(2)"],map:e=>gu.core.math.ceil([e])},sin:{"@desc":"sine of x","@examples":["sin(2)"],map:e=>gu.core.math.sin([e])},cos:{"@desc":"cosine of x","@examples":["cos(2)"],map:e=>gu.core.math.cos([e])},tan:{"@desc":"tangent of x","@examples":["tan(2)"],map:e=>gu.core.math.tan([e])},atan:{"@desc":"arctangent of x","@examples":["atan(2)"],map:e=>gu.core.math.atan([e])},asin:{"@desc":"arcsin of x","@examples":["asin(2)"],map:e=>gu.core.math.asin([e])},acos:{"@desc":"arccos of x","@examples":["acos(2)"],map:e=>gu.core.math.acos([e])},sinh:{"@desc":"hyperbolic sine of x","@examples":["sinh(2)"],map:e=>gu.core.math.sinh([e])},cosh:{"@desc":"hyperbolic cosine of x","@examples":["cosh(2)"],map:e=>gu.core.math.cosh([e])},tanh:{"@desc":"hyperbolic tangent of x","@examples":["tanh(2)"],map:e=>gu.core.math.tanh([e])},exp:{"@desc":"e to the power x","@examples":["exp(2)"],map:e=>gu.core.math.exp([e])},log:{"@desc":"natural log of x","@examples":["log(2)"],map:e=>gu.core.math.log([e])},log10:{"@desc":"log base 10 of x","@examples":["log10(2)"],map:e=>gu.core.math.log10([e])}};var Ni=ne,sqe=[{"@desc":"multiplication, division","@examples":[],name:"mul-div",type:Ws,rule:Ye.regexp(/\s*(\*|\/)\s*/,1),map:(e,t,r)=>{switch(e){case"*":return Ni.core.math.mult([t,r]);case"/":return Ni.core.math.div([t,r]);default:throw new Error(`value operator '${e}' not supported`)}}},{"@desc":"addition, substraction","@examples":[],name:"add-sub",type:Ws,rule:Ye.regexp(/\s*(-|\+)\s*/,1),map:(e,t,r)=>{switch(e){case"-":return Ni.core.math.sub([t,r]);case"+":return Ni.core.math.add([t,r]);default:throw new Error(`value operator '${e}' not supported`)}}},{"@desc":"value comparisons","@examples":[],name:"comparison",type:Ws,rule:Ye.alt(Ye.regexp(/\s*(=~|==|>=|<=|=|!=|>|<)\s*/,1),Ye.whitespace.result("=")),map:(e,t,r)=>{let n;if(t.head!==void 0?(t.head.name==="structure-query.atom-property.macromolecular.secondary-structure-flags"&&(n=Ni.core.flags.hasAny([t,Sk(r)])),t.head.name==="core.type.regex"&&(n=Ni.core.str.match([t,Ni.core.type.str([r])]))):r.head!==void 0?(r.head.name==="structure-query.atom-property.macromolecular.secondary-structure-flags"&&(n=Ni.core.flags.hasAny([r,Sk(t)])),r.head.name==="core.type.regex"&&(n=Ni.core.str.match([r,Ni.core.type.str([t])]))):e==="=~"&&(t.head?n=Ni.core.str.match([Ni.core.type.regex([`^${r}$`,"i"]),Ni.core.type.str([t])]):n=Ni.core.str.match([Ni.core.type.regex([`^${t}$`,"i"]),Ni.core.type.str([r])])),!n)switch(t.head&&(r=rS(t,r)),r.head&&(t=rS(r,t)),e){case"=":case"==":n=Ni.core.rel.eq([t,r]);break;case"!=":n=Ni.core.rel.neq([t,r]);break;case">":n=Ni.core.rel.gr([t,r]);break;case"<":n=Ni.core.rel.lt([t,r]);break;case">=":n=Ni.core.rel.gre([t,r]);break;case"<=":n=Ni.core.rel.lte([t,r]);break;default:throw new Error(`value operator '${e}' not supported`)}return Ni.struct.generator.atomGroups({"atom-test":n})}}],lqe=Ye.createLanguage({Parens:function(e){return Ye.alt(e.Parens,e.Operator,e.Expression).wrap(Ye.string("("),Ye.string(")"))},Expression:function(e){return Ye.alt(e.RangeListProperty,e.ValueQuery,e.Keywords)},NamedAtomProperties:function(){return Ye.alt(...bk(Sy))},Keywords:()=>Ye.alt(...gI(j7)),ValueRange:function(e){return Ye.seq(e.Value.skip(Ye.regexp(/\s+TO\s+/i)),e.Value).map(t=>({range:t}))},RangeListProperty:function(e){return Ye.seq(Ye.alt(...I_(Sy,/\s/)).skip(Ye.whitespace),Ye.alt(e.ValueRange,e.Value).sepBy1(Ye.whitespace)).map(t=>{let[r,n]=t,o=[],i=[];n.forEach(u=>{u.range?i.push(Ni.core.rel.inRange([r,u.range[0],u.range[1]])):o.push(rS(r,u,N7))});let a=ube(i),s=pbe(r,o),l;return a&&s?l=Ni.core.logic.or([a,s]):l=a||s,Ni.struct.generator.atomGroups({[dbe(r)]:l})})},Operator:function(e){return Dx(z7,Ye.alt(e.Parens,e.Expression,e.ValueQuery))},Query:function(e){return Ye.alt(e.Operator,e.Parens,e.Expression).trim(Ye.optWhitespace)},Number:function(){return Ye.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){let e=yI(Sy,j7,z7).sort(gm).map(Gg).join("|");return Ye.alt(Ye.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i")),Ye.regexp(/'((?:[^"\\]|\\.)*)'/,1),Ye.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(t=>Ni.core.type.regex([`^${t}$`,"i"]))).desc("string")},Value:function(e){return Ye.alt(e.Number,e.String)},ValueParens:function(e){return Ye.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(Ye.string("("),Ye.string(")"))},ValuePropertyNames:function(){return Ye.alt(...I_(Sy,/=~|==|>=|<=|=|!=|>|<|\)|\s|\+|-|\*|\//i))},ValueOperator:function(e){return Dx(sqe,Ye.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return Ye.alt(e.ValueFunctions,e.Value,e.ValuePropertyNames)},ValueFunctions:function(e){return Ye.alt(...mbe(vbe,e.ValueOperator))},ValueQuery:function(e){return Ye.alt(e.ValueOperator.map(t=>{if(!t.head.name||!t.head.name.startsWith("structure-query.generator"))throw new Error(`values must be part of an comparison, value '${t}'`);return t}))}}),Ibe=e=>lqe.Query.tryParse(e);var Abe={pymol:xbe,vmd:Ibe,jmol:gbe};var uqe=Abe;function Tbe(e,t){try{return uqe[e](t)}catch(r){throw console.error(r.message),r}}function To(e,t){return{expression:e,language:t}}(s=>{s.Info={"mol-script":"Mol-Script",pymol:"PyMOL",vmd:"VMD",jmol:"Jmol"};function t(l){return!!l&&typeof l.expression=="string"&&!!l.language}s.is=t;function r(l,u){return l.language===u.language&&l.expression===u.expression}s.areEqual=r;function n(l){switch(l.language){case"mol-script":let u=abe(l.expression);if(u.length===0)throw new Error("No query");return obe(u[0]);case"pymol":case"jmol":case"vmd":return Tbe(l.language,l.expression);default:Rr(l.language)}}s.toExpression=n;function o(l){let u=n(l);return Ic(u)}s.toQuery=o;function i(l,u){let m=o(l)(new ai(u));return at.toLociWithSourceUnits(m)}s.toLoci=i;function a(l,u,c){let m=typeof l=="function"?l(ne):l;return Ic(m)(new ai(u,c))}s.getStructureSelection=a})(To||={});var xI={dynamicBonds:C.Optional(C.Boolean(!1,{description:"Ensure bonds are recalculated upon model changes. Also enables calculation of inter-unit bonds in water molecules and ions."}))},Iy;(s=>{function e(l,u){let c=l&&wo.Provider.get(l),m=c?c.assemblies.map(g=>[g.id,`${g.id}: ${ta(g.details)}`]):[],d=c?!Yi.isZero(c.spacegroup.cell):!0,p=[];if(c){let{operators:g}=c.spacegroup;for(let x=0,S=g.length;x<S;x++)p.push([x,`${x+1}: ${Ns.getOperatorXyz(g[x])}`])}let h=[];l&&l.properties.structAsymMap.forEach(g=>{let x=g.id===g.auth_id?g.id:`${g.id} [auth ${g.auth_id}]`;h.push([g.id,x])});let f={auto:C.Group(xI),model:C.Group(xI),assembly:C.Group({id:C.Optional(l?C.Select(m.length?m[0][0]:"",m,{label:"Asm Id",description:"Assembly Id"}):C.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"})),...xI},{isFlat:!0}),"symmetry-mates":C.Group({radius:C.Numeric(5,{min:0,max:50,step:1}),...xI},{isFlat:!0}),symmetry:C.Group({ijkMin:C.Vec3(b.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:C.Vec3(b.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),...xI},{isFlat:!0}),"symmetry-assembly":C.Group({generators:C.ObjectList({operators:C.ObjectList({index:C.Select(0,p),shift:C.Vec3(b(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},g=>`${g.index+1}_${g.shift.map(x=>x+5).join("")}`,{defaultValue:[]}),asymIds:C.MultiSelect([],h)},g=>`${g.asymIds.length} asym ids, ${g.operators.length} operators`,{defaultValue:[]}),...xI},{isFlat:!0})},y=[];return u==="auto"&&y.push(["auto","Auto"]),y.push(["model","Model"]),m.length>0&&y.push(["assembly","Assembly"]),d&&(y.push(["symmetry-mates","Symmetry Mates"]),y.push(["symmetry","Symmetry (indices)"]),y.push(["symmetry-assembly","Symmetry (assembly)"])),{type:C.MappedStatic(u||"model",f,{options:y})}}s.getParams=e;function t(l,u){return!(u.name==="symmetry-assembly"||u.name==="symmetry"&&l.name==="symmetry")}s.canAutoUpdate=t;async function r(l,u,c,m,d){let p,h=wo.Provider.get(c);!m&&h&&h.assemblies.length!==0&&(m=h.assemblies[0].id),!h||h.assemblies.length===0?l.log.warn(`Model '${c.entryId}' has no assembly, returning model structure.`):(p=ux.findAssembly(c,m||""),p||l.log.warn(`Model '${c.entryId}' has no assembly called '${m}', returning model structure.`));let f=De.ofModel(c,d);if(!p){let x={label:"Model",description:De.elementDescription(f)};return new re.Molecule.Structure(f,x)}m=p.id;let y=await im.buildAssembly(f,m).runInContext(u),g={label:`Assembly ${m}`,description:De.elementDescription(y)};return new re.Molecule.Structure(y,g)}async function n(l,u,c,m,d){let p=De.ofModel(u,d),h=await im.buildSymmetryRange(p,c,m).runInContext(l),f={label:`Symmetry [${c}] to [${m}]`,description:De.elementDescription(h)};return new re.Molecule.Structure(h,f)}async function o(l,u,c,m){let d=De.ofModel(u,m),p=await im.builderSymmetryMates(d,c).runInContext(l),h={label:"Symmetry Mates",description:De.elementDescription(p)};return new re.Molecule.Structure(p,h)}async function i(l,u,c,m,d){let p=De.ofModel(u,d),h=await im.buildSymmetryAssembly(p,c,m).runInContext(l),f={label:"Symmetry Assembly",description:De.elementDescription(h)};return new re.Molecule.Structure(h,f)}async function a(l,u,c,m){let d=m?.params,p=wo.Provider.get(c);if(!p||!m||m.name==="model"){let h=De.ofModel(c,d);return new re.Molecule.Structure(h,{label:"Model",description:De.elementDescription(h)})}if(m.name==="auto")if(p.assemblies.length===0){let h=De.ofModel(c,d);return new re.Molecule.Structure(h,{label:"Model",description:De.elementDescription(h)})}else return r(l,u,c,void 0,d);if(m.name==="assembly")return r(l,u,c,m.params.id,d);if(m.name==="symmetry")return n(u,c,m.params.ijkMin,m.params.ijkMax,d);if(m.name==="symmetry-mates")return o(u,c,m.params.radius,d);if(m.name==="symmetry-assembly")return i(u,c,m.params.generators,p,d);Rr(m)}s.create=a})(Iy||={});var Ps;(a=>{function e(s,l,u){return s.currentStructure!==u?!1:To.is(l)?!!s.script&&To.areEqual(s.script,l):s.expression===l}a.isUnchanged=e;function t(s,l){let u=To.is(l)?l:void 0,c=To.is(l)?To.toExpression(l):l,m=Ic(c);return{script:u,expression:c,compiled:m,originalStructure:s,currentStructure:s}}a.create=t;function r(s,l){return s.compiled(new ai(l))}a.run=r;function n(s,l){let u=t(s,l);return{entry:u,selection:r(u,s)}}a.createAndRun=n;function o(s,l){return s.currentStructure=l,s.compiled(new ai(l))}a.updateStructure=o;function i(s,l,u){let c=at.unionStructure(l);s.label=`${u||"Selection"}`,s.description=De.elementDescription(c),s.data=c}a.updateStructureObject=i})(Ps||={});var Pbe=["all","polymer","protein","nucleic","water","ion","lipid","branched","ligand","non-standard","coarse"],_be=()=>({type:C.MappedStatic("static",{static:C.Text("polymer"),expression:C.Value(ne.struct.generator.all),bundle:C.Value(K.Bundle.Empty),script:C.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:C.Optional(C.Boolean(!0,{isHidden:!0})),label:C.Text("",{isHidden:!0})});function CI(e,t,r){r.source=e;let n=De.Empty,o;switch(t.type.name){case"static":{let a;switch(t.type.params){case"all":a=li.all.query,o="All";break;case"polymer":a=li.polymer.query,o="Polymer";break;case"protein":a=li.protein.query,o="Protein";break;case"nucleic":a=li.nucleic.query,o="Nucleic";break;case"water":a=Fn.internal.water(),o="Water";break;case"ion":a=li.ion.query,o="Ion";break;case"lipid":a=li.lipid.query,o="Lipid";break;case"branched":a=li.branchedPlusConnected.query,o="Branched";break;case"ligand":a=li.ligandPlusConnected.query,o="Ligand";break;case"non-standard":a=li.nonStandardPolymer.query,o="Non-standard";break;case"coarse":a=li.coarse.query,o="Coarse";break;default:Rr(t.type)}let s=a(new ai(e));n=at.unionStructure(s);break}case"script":case"expression":{let{selection:a,entry:s}=Ps.createAndRun(e,t.type.params);r.entry=s,n=at.unionStructure(a);break}case"bundle":{if(t.type.params.hash!==e.hashCode)break;n=K.Bundle.toStructure(t.type.params,e);break}}if(t.nullIfEmpty&&n.elementCount===0)return An.Null;let i={label:`${t.label||o||"Component"}`,description:De.elementDescription(n)};return new re.Molecule.Structure(n,i)}function Rbe(e,t,r,n,o){if(r.type.name!==n.type.name)return Je.UpdateResult.Recreate;let i=!1;switch(n.type.name){case"static":return r.type.params!==n.type.params?Je.UpdateResult.Recreate:De.areEquivalent(e,o.source)?t.data.model===e.model?Je.UpdateResult.Unchanged:Ft.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),Je.UpdateResult.Updated):Je.UpdateResult.Recreate:Je.UpdateResult.Recreate;case"script":if(!To.areEqual(r.type.params,n.type.params))return Je.UpdateResult.Recreate;case"expression":{if(r.type.params!==n.type.params)return Je.UpdateResult.Recreate;if(e===o.source)break;let a=o.entry,s=Ps.updateStructure(a,e);o.source=e,t.data=at.unionStructure(s),Ps.updateStructureObject(t,s,n.label),i=!0;break}case"bundle":{if(e===o.source&&K.Bundle.areEqual(r.type.params,n.type.params))break;o.source=e,n.type.params.hash!==e.hashCode?(i=t.data.elementCount!==0,t.data=t.data.elementCount===0?t.data:De.Empty):(i=!0,t.data=K.Bundle.toStructure(n.type.params,e));break}}if(i){if(n.nullIfEmpty&&t.data.elementCount===0)return Je.UpdateResult.Null;t.description=De.elementDescription(t.data)}return r.label!==n.label&&(i=!0,t.label=`${n.label||t.label}`),i?Je.UpdateResult.Updated:Je.UpdateResult.Unchanged}function Dbe(e){switch(e){case 7:return-3;case 6:return-2;case 5:return-1;case 0:return 0;case 3:return 1;case 2:return 2;case 1:return 3;case 4:return 0;default:return console.error(`Value ${e} is outside the 0-7 range, defaulting to 0.`),0}}function W7(e,t){let r=je.create(e.data,t*2),n=je.create(e.data,t*2),o=je.create(e.data,t*2),i=je.create(e.data,t*2),a=je.create(e.data,t*2);for(let s=0;s<t;++s){yt.markLine(e);let{tokenStart:l,position:u}=e;yt.trim(e,l,l+10),je.addUnchecked(r,e.tokenStart,e.tokenEnd),yt.trim(e,l+10,l+20),je.addUnchecked(n,e.tokenStart,e.tokenEnd),yt.trim(e,l+20,l+30),je.addUnchecked(o,e.tokenStart,e.tokenEnd),yt.trim(e,l+31,l+34),je.addUnchecked(i,e.tokenStart,e.tokenEnd),yt.trim(e,l+36,l+39),je.addUnchecked(a,e.tokenStart,e.tokenEnd),e.position=u}return{count:t,x:Gt(r)(H.Schema.float),y:Gt(n)(H.Schema.float),z:Gt(o)(H.Schema.float),type_symbol:Gt(i)(H.Schema.str),formal_charge:Gt(a)(H.Schema.int)}}function X7(e,t){let r=je.create(e.data,t*2),n=je.create(e.data,t*2),o=je.create(e.data,t*2);for(let i=0;i<t;++i){yt.markLine(e);let{tokenStart:a,position:s}=e;yt.trim(e,a,a+3),je.addUnchecked(r,e.tokenStart,e.tokenEnd),yt.trim(e,a+3,a+6),je.addUnchecked(n,e.tokenStart,e.tokenEnd),yt.trim(e,a+6,a+9),je.addUnchecked(o,e.tokenStart,e.tokenEnd),e.position=s}return{count:t,atomIdxA:Gt(r)(H.Schema.int),atomIdxB:Gt(n)(H.Schema.int),order:Gt(o)(H.Schema.int)}}function cqe(e,t,r){yt.trim(e,t+6,t+9);let n=parseInt(yt.getTokenString(e));for(let o=0;o<n;++o){let i=9+o*8;yt.trim(e,t+i,t+i+4);let a=yt.getTokenString(e);r.atomIdx.push(+a),yt.trim(e,t+i+4,t+i+8);let s=yt.getTokenString(e);r.charge.push(+s)}yt.eatLine(e)}function mqe(e){let t=e.trim().split(/\s+/g),r=[];for(let n=1;n<t.length;n+=2){let o=+t[n],i=+t[n+1]||0;r.push({atomIdx:o,kind:i})}return r}function Q7(e){let n={atomIdx:[],charge:[]},o;for(;e.position<e.length;){let{position:a}=e;yt.trim(e,a+3,a+6);let s=yt.getTokenString(e);if(s==="END")break;switch(yt.eatLine(e),s){case"CHG":cqe(e,a,n);break;case"APO":o=mqe(yt.getTokenString(e).substring(3));break;default:break}}return{formalCharges:{atomIdx:H.ofIntArray(n.atomIdx),charge:H.ofIntArray(n.charge)},attachmentPoints:o}}function dqe(e){let t=yt(e),r=yt.readLine(t).trim(),n=yt.readLine(t).trim(),o=yt.readLine(t).trim(),i=yt.readLine(t),a=+i.substr(0,3),s=+i.substr(3,3),l=W7(t,a),u=X7(t,s),c={title:r,program:n,comment:o,atoms:l,bonds:u,...Q7(t)};return jr.success(c)}function wbe(e){return Pe.create("Parse Mol",async()=>dqe(e))}async function Z7(e,t,r){let{atoms:n,bonds:o,formalCharges:i}=e,a=H.ofConst("MOL",e.atoms.count,H.Schema.str),s=H.ofConst("A",e.atoms.count,H.Schema.str),l=H.asArrayColumn(n.type_symbol),u=H.ofConst(1,n.count,H.Schema.int),c=new Int32Array(e.atoms.count);if(i.atomIdx.rowCount>0)for(let y=0;y<i.atomIdx.rowCount;y++)c[i.atomIdx.value(y)-1]=i.charge.value(y);else for(let y=0;y<e.atoms.count;y++)c[y]=Dbe(n.formal_charge.value(y));let m=Cr.ofPartialColumns(Co.atom_site,{auth_asym_id:s,auth_atom_id:l,auth_comp_id:a,auth_seq_id:u,Cartn_x:H.asArrayColumn(n.x,Float32Array),Cartn_y:H.asArrayColumn(n.y,Float32Array),Cartn_z:H.asArrayColumn(n.z,Float32Array),id:H.range(1,n.count),label_asym_id:s,label_atom_id:l,label_comp_id:a,label_seq_id:u,label_entity_id:H.ofConst("1",n.count,H.Schema.str),occupancy:H.ofConst(1,n.count,H.Schema.float),type_symbol:l,pdbx_PDB_model_num:H.ofConst(1,n.count,H.Schema.int),pdbx_formal_charge:H.ofIntArray(c)},n.count),d=new _i;d.setNames([["MOL","Unknown Entity"]]),d.getEntityId("MOL",0,"A");let p=new Ri(u,l);p.setNames([["MOL","Unknown Molecule"]]),p.add("MOL",0);let h=Gi({entity:d.getEntityTable(),chem_comp:p.getChemCompTable(),atom_site:m}),f=await Fa(h,t??Ebe.create(e),r);if(f.frameCount>0){let y=H.ofIntArray(H.mapToArray(o.atomIdxA,I=>I-1,Int32Array)),g=H.ofIntArray(H.mapToArray(o.atomIdxB,I=>I-1,Int32Array)),x=H.asArrayColumn(o.order,Int32Array),S=Do.fromData({pairs:{indexA:y,indexB:g,order:x},count:n.count},{maxDistance:1/0});Do.Provider.set(f.representative,S)}return f}var Ebe;(r=>{function e(n){return n?.kind==="mol"}r.is=e;function t(n){return{kind:"mol",name:n.title,data:n}}r.create=t})(Ebe||={});function Mbe(e){return Pe.create("Parse MOL",t=>Z7(e,void 0,t))}function pqe(e){let t=e.it_number.value(0),r=e["name_h-m_full"].value(0).replace("-"," ");return e.it_number.isDefined?(e["name_h-m_full"].isDefined,t):r}function fqe(e){let{cell:t,space_group:r}=e,n=pqe(r),o=Yi.create(n,b.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),b.scale(b(),b.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:Ns.create(o),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}async function hqe(e,t,r){let n=e.atom_site._rowCount,o=H.ofConst("MOL",n,H.Schema.str),i=H.ofConst("A",n,H.Schema.str),a=H.ofConst(1,n,H.Schema.int),s=fqe(e),l=s.spacegroup.cell.fromFractional,{fract_x:u,fract_y:c,fract_z:m}=e.atom_site,d=new Float32Array(n),p=new Float32Array(n),h=new Float32Array(n),f=b();for(let D=0;D<n;++D)b.set(f,u.value(D),c.value(D),m.value(D)),b.transformMat4(f,f,l),d[D]=f[0],p[D]=f[1],h[D]=f[2];let{type_symbol:y,label:g}=e.atom_site,x,S;if(y.isDefined){let D=new Array(n),M=new Int8Array(n);for(let E=0;E<n;++E){let R=y.value(E),k=R.length;R[k-1]==="+"?(D[E]=R.substring(0,k-2),M[E]=parseInt(R[k-2])):R[k-2]==="+"?(D[E]=R.substring(0,k-2),M[E]=parseInt(R[k-1])):R[k-1]==="-"?(D[E]=R.substring(0,k-2),M[E]=-parseInt(R[k-2])):R[k-2]==="-"?(D[E]=R.substring(0,k-2),M[E]=-parseInt(R[k-1])):(D[E]=R,M[E]=0)}x=H.ofStringArray(D),S=H.ofIntArray(M)}else{let D=new Array(n);for(let M=0;M<n;++M)D[M]=rp(g.value(M),"");x=H.ofStringArray(D),S=H.Undefined(n,H.Schema.int)}let I=Cr.ofPartialColumns(Co.atom_site,{auth_asym_id:i,auth_atom_id:g,auth_comp_id:o,auth_seq_id:a,Cartn_x:H.ofFloatArray(d),Cartn_y:H.ofFloatArray(p),Cartn_z:H.ofFloatArray(h),id:H.range(0,n-1),label_asym_id:i,label_atom_id:g,label_comp_id:o,label_seq_id:a,label_entity_id:H.ofConst("1",n,H.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:H.ofConst(1,n,H.Schema.float),type_symbol:x,pdbx_formal_charge:S,pdbx_PDB_model_num:H.ofConst(1,n,H.Schema.int),B_iso_or_equiv:e.atom_site.u_iso_or_equiv},n),v=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),A=new _i;A.setNames([["MOL",v||"Unknown Entity"]]),A.getEntityId("MOL",0,"A");let _=new Ri(a,e.atom_site.type_symbol);_.setNames([["MOL",v||"Unknown Molecule"]]),_.add("MOL",0);let T=Gi({entity:A.getEntityTable(),chem_comp:_.getChemCompTable(),atom_site:I}),w=await Fa(T,t,r);if(w.frameCount>0){let D=w.representative;wo.Provider.set(D,s);let M=e.geom_bond._rowCount;if(M>0){let E={},{label:R}=e.atom_site;for(let ce=0,ie=R.rowCount;ce<ie;++ce)E[R.value(ce)]=ce;let k=t.data.frame.categories.ccdc_geom_bond_type?.getField(""),B=[],L=[],V=[],U=[],Q=[],O=new Set,q=0,{atom_site_label_1:X,atom_site_label_2:F,valence:Y,distance:$}=e.geom_bond;for(let ce=0;ce<M;++ce){let ie=E[X.value(ce)],oe=E[F.value(ce)],W=ie<oe?Xi(ie,oe):Xi(oe,ie);if(!O.has(W)){if(O.add(W),B[q]=ie,L[q]=oe,U[q]=$.value(ce)||-1,k){let N=k.str(ce);N==="D"?(V[q]=2,Q[q]=ht.Flag.Covalent):N==="A"?(V[q]=1,Q[q]=ht.Flag.Covalent|ht.Flag.Aromatic):N==="S"?(V[q]=1,Q[q]=ht.Flag.Covalent):(V[q]=1,Q[q]=ht.Flag.Covalent)}else Q[q]=ht.Flag.Covalent,V[q]=Y.isDefined?Y.value(ce):1;q+=1}}Do.Provider.set(D,Do.fromData({pairs:{indexA:H.ofIntArray(B),indexB:H.ofIntArray(L),order:H.ofIntArray(V),distance:H.ofFloatArray(U),flag:H.ofIntArray(Q)},count:n}))}}return w}function gqe(e){if(!vk.is(e.sourceData))return;let{atom_site:t,atom_site_aniso:r}=e.sourceData.data.db,n=Cr.ofPartialColumns(am.Schema,{U:r.u},r._rowCount),o=am.getElementToAnsiotropFromLabel(t.label,r.label);return{data:n,elementToAnsiotrop:o}}function yqe(e){return vk.is(e.sourceData)?e.sourceData.data.db.atom_site_aniso.u.isDefined:!1}am.Provider.formatRegistry.add("cifCore",gqe,yqe);var vk;(r=>{function e(n){return n?.kind==="cifCore"}r.is=e;function t(n,o){return o||(o=mu.schema.cifCore(n)),{kind:"cifCore",name:o.database_code.depnum_ccdc_archive.value(0)||o.database_code.depnum_ccdc_fiz.value(0)||o.database_code.icsd.value(0)||o.database_code.mdf.value(0)||o.database_code.nbs.value(0)||o.database_code.csd.value(0)||o.database_code.cod.value(0)||o._name,data:{db:o,frame:n}}}r.fromFrame=t})(vk||={});function Bbe(e){let t=vk.fromFrame(e);return Pe.create("Parse CIF Core",r=>hqe(t.data.db,t,r))}async function bqe(e,t){let{atoms:r}=e,n=H.ofConst("MOL",e.atoms.count,H.Schema.str),o=H.ofConst("A",e.atoms.count,H.Schema.str),i=H.ofArray({array:H.mapToArray(r.number,m=>bse(m)),schema:H.Schema.Aliased(H.Schema.str)}),a=H.ofConst(1,r.count,H.Schema.int),s=Cr.ofPartialColumns(Co.atom_site,{auth_asym_id:o,auth_atom_id:i,auth_comp_id:n,auth_seq_id:a,Cartn_x:H.asArrayColumn(r.x,Float32Array),Cartn_y:H.asArrayColumn(r.y,Float32Array),Cartn_z:H.asArrayColumn(r.z,Float32Array),id:H.range(0,r.count-1),label_asym_id:o,label_atom_id:i,label_comp_id:n,label_seq_id:a,label_entity_id:H.ofConst("1",r.count,H.Schema.str),occupancy:H.ofConst(1,r.count,H.Schema.float),type_symbol:i,pdbx_PDB_model_num:H.ofConst(1,r.count,H.Schema.int)},r.count),l=new _i;l.setNames([["MOL","Unknown Entity"]]),l.getEntityId("MOL",0,"A");let u=new Ri(a,i);u.setNames([["MOL","Unknown Molecule"]]),u.add("MOL",0);let c=Gi({entity:l.getEntityTable(),chem_comp:u.getChemCompTable(),atom_site:s});return await Fa(c,kbe.create(e),t)}var kbe;(r=>{function e(n){return n?.kind==="cube"}r.is=e;function t(n){return{kind:"cube",name:n.header.comment1,data:n}}r.create=t})(kbe||={});function Lbe(e){return Pe.create("Parse Cube",t=>bqe(e,t))}var{skipWhitespace:Fbe,eatValue:xqe,markLine:id,getTokenString:ad,skipStrictWhitespace:Cqe}=yt;function Sqe(){return{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""}}function vqe(e,t){return{tokenizer:e,molecule:Sqe(),runtimeCtx:t}}var Vbe=/\s+/g;function Iqe(e){let{tokenizer:t,molecule:r}=e;for(;ad(t)!=="@<TRIPOS>MOLECULE"&&t.position<t.data.length;)id(t);id(t),r.mol_name=ad(t),id(t);let n=ad(t).trim().split(Vbe);r.num_atoms=parseInt(n[0]),r.num_bonds=parseInt(n[1]),r.num_subst=parseInt(n[2]),r.num_feat=parseInt(n[3]),r.num_sets=parseInt(n[4]),id(t);let o=ad(t);if(o.startsWith("@<TRIPOS>"))return;r.mol_type=o,id(t);let i=ad(t);if(i.startsWith("@<TRIPOS>"))return;r.charge_type=i,id(t);let a=ad(t);if(a.startsWith("@<TRIPOS>"))return;r.status_bits=a,id(t);let s=ad(t);s.startsWith("@<TRIPOS>")||(r.mol_comment=s)}function q7(e,t,r){let n=0;for(let o=0;o<e;o++){let i=0;for(Fbe(r);Cqe(r),r.tokenStart=r.position,xqe(r),r.tokenStart!==r.tokenEnd;){let a=t[i++];a&&je.addUnchecked(a,r.tokenStart,r.tokenEnd)}i>n&&(n=i);for(let a=i;a<t.length;a++)je.addUnchecked(t[a],0,0)}return n+1}async function Aqe(e){let{tokenizer:t,molecule:r}=e;for(;ad(t)!=="@<TRIPOS>ATOM"&&t.position<t.data.length;)id(t);let n=t.position,o=t.lineNumber,i=je.create(t.data,r.num_atoms*2),a=je.create(t.data,r.num_atoms*2),s=je.create(t.data,r.num_atoms*2),l=je.create(t.data,r.num_atoms*2),u=je.create(t.data,r.num_atoms*2),c=je.create(t.data,r.num_atoms*2),m=je.create(t.data,r.num_atoms*2),d=je.create(t.data,r.num_atoms*2),p=je.create(t.data,r.num_atoms*2),h=je.create(t.data,r.num_atoms*2),f=H.Undefined(r.num_atoms,H.Schema.float),y=H.Undefined(r.num_atoms,H.Schema.int),g=H.Undefined(r.num_atoms,H.Schema.str);t.position=n,t.lineNumber=o;let x=0,S=[i,a,s,l,u,c,m,d,p,h],{length:I}=t,v=0;return await ts(e.runtimeCtx,1e5,void 0,_=>{let T=Math.min(r.num_atoms-v,_);return x=Math.max(x,q7(T,S,t)),v+=T,T},_=>_.update({message:"Parsing...",current:t.position,max:I})),{count:r.num_atoms,atom_id:Gt(i)(H.Schema.int),atom_name:Gt(a)(H.Schema.str),x:Gt(s)(H.Schema.float),y:Gt(l)(H.Schema.float),z:Gt(u)(H.Schema.float),atom_type:x>5?Gt(c)(H.Schema.str):g,subst_id:x>6?Gt(m)(H.Schema.int):y,subst_name:x>7?Gt(d)(H.Schema.str):g,charge:x>8?Gt(p)(H.Schema.float):f,status_bits:x>9?Gt(h)(H.Schema.str):g}}async function Tqe(e){let{tokenizer:t,molecule:r}=e;for(;ad(t)!=="@<TRIPOS>BOND"&&t.position<t.data.length;)id(t);let n=t.position,o=t.lineNumber,i=je.create(t.data,r.num_bonds*2),a=je.create(t.data,r.num_bonds*2),s=je.create(t.data,r.num_bonds*2),l=je.create(t.data,r.num_bonds*2),u=je.create(t.data,r.num_bonds*2),c=H.Undefined(r.num_bonds,H.Schema.str);t.position=n,t.lineNumber=o;let m=0,d=[i,a,s,l,u],{length:p}=t,h=0;return await ts(e.runtimeCtx,1e5,void 0,y=>{let g=Math.min(r.num_bonds-h,y);return m=Math.max(m,q7(g,d,t)),h+=g,g},y=>y.update({message:"Parsing...",current:t.position,max:p})),{count:r.num_bonds,bond_id:Gt(i)(H.Schema.int),origin_atom_id:Gt(a)(H.Schema.int),target_atom_id:Gt(s)(H.Schema.int),bond_type:Gt(l)(H.Schema.str),status_bits:m>4?Gt(u)(H.Schema.str):c}}async function Pqe(e){let{tokenizer:t,molecule:r}=e;if(r.num_subst===0)return;for(;ad(t)!=="@<TRIPOS>SUBSTRUCTURE"&&t.position<t.data.length;)id(t);let n=t.position,o=t.lineNumber,i=je.create(t.data,r.num_subst*2),a=je.create(t.data,r.num_subst*2),s=je.create(t.data,r.num_subst*2),l=je.create(t.data,r.num_subst*2),u=je.create(t.data,r.num_subst*2),c=je.create(t.data,r.num_subst*2),m=je.create(t.data,r.num_subst*2),d=je.create(t.data,r.num_subst*2),p=je.create(t.data,r.num_subst*2),h=H.Undefined(r.num_subst,H.Schema.int),f=H.Undefined(r.num_subst,H.Schema.str);t.position=n,t.lineNumber=o;let y=0,g=[i,a,s,l,u,c,m,d,p],{length:x}=t,S=0;return await ts(e.runtimeCtx,1e5,void 0,v=>{let A=Math.min(r.num_subst-S,v);return y=Math.max(y,q7(A,g,t)),S+=A,A},v=>v.update({message:"Parsing...",current:t.position,max:x})),{count:r.num_subst,subst_id:Gt(i)(H.Schema.int),subst_name:Gt(a)(H.Schema.str),root_atom:Gt(s)(H.Schema.int),subst_type:y>3?Gt(l)(H.Schema.str):f,dict_type:y>4?Gt(u)(H.Schema.str):f,chain:y>5?Gt(c)(H.Schema.str):f,sub_type:y>6?Gt(m)(H.Schema.str):f,inter_bonds:y>7?Gt(d)(H.Schema.int):h,status_bits:y>8?Gt(p)(H.Schema.str):f}}function _qe(e){let{tokenizer:t}=e;for(;t.position<t.data.length;){let n=ad(t);if(n==="@<TRIPOS>MOLECULE")return;if(n==="@<TRIPOS>CRYSIN")break;id(t)}if(t.position>=t.data.length)return;id(t);let r=ad(t).trim().split(Vbe);return{a:parseFloat(r[0]),b:parseFloat(r[1]),c:parseFloat(r[2]),alpha:parseFloat(r[3]),beta:parseFloat(r[4]),gamma:parseFloat(r[5]),spaceGroup:parseInt(r[6],10),setting:parseInt(r[7],10)}}async function Rqe(e,t,r){let n=yt(t);e.update({message:"Parsing...",current:0,max:t.length});let o=[];for(;n.position<t.length;){let a=vqe(n,e);Iqe(a);let s=await Aqe(a),l=await Tqe(a),u=await Pqe(a),c=_qe(a);for(o.push({molecule:a.molecule,atoms:s,bonds:l,substructures:u,crysin:c}),Fbe(n);ad(n)!=="@<TRIPOS>MOLECULE"&&n.position<n.data.length;)id(n)}let i={name:r,structures:o};return jr.success(i)}function Obe(e,t){return Pe.create("Parse MOL2",async r=>await Rqe(r,e,t))}async function Dqe(e,t){let r=[];for(let n=0,o=e.structures.length;n<o;++n){let{molecule:i,atoms:a,bonds:s,substructures:l,crysin:u}=e.structures[n],c=new Array(a.count),m=new Array(a.count),d=new Array(a.count),p=new Array(a.count),h=new Array(a.count),f=!1;for(let U=0;U<a.count;++U)if(a.atom_type.value(U).includes(".")){f=!0;break}let y=new Map;if(l)for(let U=0;U<l.count;++U){let Q=l.root_atom.value(U),O=l.chain.value(U),q=l.sub_type.value(U);y.set(Q,{chain:O,subType:q})}let g=new _i,x=new Ri(a.subst_id,a.atom_name),S,I="",v=0,A="",_=0,T=-1;for(let U=0;U<a.count;++U){let Q=a.subst_name.value(U),O=a.subst_id.value(U),q=Q.replace(/\d+$/,"")||"MOL",X=Q.match(/(\d+)$/);h[U]=X?parseInt(X[1]):O;let F=y.get(a.atom_id.value(U));if(F&&(S=F),S&&S.subType&&S.subType!=="UNK"&&(q=S.subType),d[U]=f?a.atom_type.value(U).split(".")[0].toUpperCase():rp(a.atom_name.value(U),q),p[U]=q,O!==T){let Y=Tl(x.add(q,U).type,q);S?.chain?A=S.chain:(Y!==_||O!==T+1)&&(A=yf(v),v+=1),I=g.getEntityId(q,Y,A),T=O,_=Y}c[U]=I,m[U]=A}let w=H.ofStringArray(d),D=H.ofStringArray(p),M=H.ofStringArray(c),E=H.ofStringArray(m),R=H.asArrayColumn(a.atom_name),k=H.ofIntArray(h),B=Cr.ofPartialColumns(Co.atom_site,{auth_asym_id:E,auth_atom_id:R,auth_comp_id:D,auth_seq_id:k,Cartn_x:H.asArrayColumn(a.x,Float32Array),Cartn_y:H.asArrayColumn(a.y,Float32Array),Cartn_z:H.asArrayColumn(a.z,Float32Array),id:H.asArrayColumn(a.atom_id),label_asym_id:E,label_atom_id:R,label_comp_id:D,label_seq_id:a.subst_id,label_entity_id:M,occupancy:H.ofConst(1,a.count,H.Schema.float),type_symbol:w,pdbx_PDB_model_num:H.ofConst(n,a.count,H.Schema.int)},a.count),L=Gi({entity:g.getEntityTable(),chem_comp:x.getChemCompTable(),atom_site:B}),V=await Fa(L,Gbe.create(e),t);if(V.frameCount>0){let U=H.ofIntArray(H.mapToArray(s.origin_atom_id,$=>$-1,Int32Array)),Q=H.ofIntArray(H.mapToArray(s.target_atom_id,$=>$-1,Int32Array)),O=s.bond_id,q=H.ofIntArray(H.mapToArray(s.bond_type,$=>{switch($){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt($)}},Int8Array)),X=H.ofIntArray(H.mapToArray(s.bond_type,$=>{switch($){case"ar":case"am":return ht.Flag.Aromatic|ht.Flag.Covalent;case"du":case"nc":return ht.Flag.None;case"un":default:return ht.Flag.Covalent}},Int8Array)),F=Do.fromData({pairs:{key:O,indexA:U,indexB:Q,order:q,flag:X},count:a.count},{maxDistance:u?-1:1/0}),Y=V.representative;if(Do.Provider.set(Y,F),kh.Provider.set(Y,{data:a.charge,type:i.charge_type}),u){let $=wqe(u);$&&wo.Provider.set(Y,$)}r.push(Y)}}return new cl(r)}function wqe(e){if(e.setting!==1)return;let t=Yi.create(e.spaceGroup,b.create(e.a,e.b,e.c),b.scale(b(),b.create(e.alpha,e.beta,e.gamma),Math.PI/180));return{spacegroup:Ns.create(t),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}var Gbe;(r=>{function e(n){return n?.kind==="mol2"}r.is=e;function t(n){return{kind:"mol2",name:n.name,data:n}}r.create=t})(Gbe||={});function Ube(e){return Pe.create("Parse MOL2",t=>Dqe(e,t))}var SI=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),Y7=9,sd;(c=>{function e(m){let d=1,p=0;for(;m>=d&&p<32;)p++,d<<=1;return p}c.sizeOfInt=e;let t=new Uint8Array(32);function r(m,d){let p=1,h=0;t[0]=1;for(let y=0;y<m;y++){let g,x=0;for(g=0;g<p;g++)x+=t[g]*d[y],t[g]=x&255,x>>=8;for(;x!==0;)t[g++]=x&255,x>>=8;p=g}let f=1;for(p--;t[p]>=f;)h++,f*=2;return h+p*8}c.sizeOfInts=r;let n=new ArrayBuffer(8*3);c.buf=new Int32Array(n);let i=new Uint32Array(n);function a(m,d,p){let h=p,f=(1<<h)-1,y=i[1],g=i[2],x=c.buf[0],S=0;for(;h>=8;)g=g<<8|m[d+x++],S|=g>>y<<h-8,h-=8;return h>0&&(y<h&&(y+=8,g=g<<8|m[d+x++]),y-=h,S|=g>>y&(1<<h)-1),S&=f,c.buf[0]=x,c.buf[1]=y,c.buf[2]=g,S}c.decodeBits=a;function s(m,d){let p=i[2],h=c.buf[0];return p=p<<8|m[d+h],c.buf[0]=h+1,c.buf[2]=p,p>>i[1]&255}let l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function u(m,d,p,h,f){let y=p,g=0;for(l[0]=0,l[1]=0,l[2]=0,l[3]=0;y>8;)l[g++]=s(m,d),y-=8;y>0&&(l[g++]=a(m,d,y));for(let x=2;x>0;x--){let S=0,I=h[x];for(let v=g-1;v>=0;v--){S=S<<8|l[v];let A=S/I|0;l[v]=A,S=S-A*I}f[x]=S}f[0]=l[0]|l[1]<<8|l[2]<<16|l[3]<<24}c.decodeInts=u})(sd||={});function Eqe(){throw new Error("(xdrfile error) Undefined error.")}async function Mqe(e,t){let r=new DataView(t.buffer,t.byteOffset),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},o=n.frames,i=n.boxes,a=n.times,s=[0,0,0,0,0,0],l=[0,0,0],u=[0,0,0],c=[0,0,0],m=[.1,.1,.1],d=[.1,.1,.1],p=0,h=sd.buf;for(;;){let f,y=r.getInt32(p+4);p+=12,a.push(r.getFloat32(p)),p+=4;let g=new Float32Array(9);for(let x=0;x<9;++x)g[x]=r.getFloat32(p)*10,p+=4;if(i.push(g),y<=9){f={count:y,x:new Float32Array(y),y:new Float32Array(y),z:new Float32Array(y)},p+=4;for(let x=0;x<y;++x)f.x[x]=r.getFloat32(p),f.y[x]=r.getFloat32(p+4),f.z[x]=r.getFloat32(p+8),p+=12}else{h[0]=h[1]=h[2]=0,l[0]=l[1]=l[2]=0,c[0]=c[1]=c[2]=0,u[0]=u[1]=u[2]=0,m[0]=m[1]=m[2]=0,d[0]=d[1]=d[2]=0,f={count:y,x:new Float32Array(y),y:new Float32Array(y),z:new Float32Array(y)};let x=0,S=r.getInt32(p);p+=4;let I=r.getFloat32(p);p+=4,s[0]=r.getInt32(p),s[1]=r.getInt32(p+4),s[2]=r.getInt32(p+8),s[3]=r.getInt32(p+12),s[4]=r.getInt32(p+16),s[5]=r.getInt32(p+20),l[0]=s[3]-s[0]+1,l[1]=s[4]-s[1]+1,l[2]=s[5]-s[2]+1,p+=24;let v;(l[0]|l[1]|l[2])>16777215?(u[0]=sd.sizeOfInt(l[0]),u[1]=sd.sizeOfInt(l[1]),u[2]=sd.sizeOfInt(l[2]),v=0):v=sd.sizeOfInts(3,l);let A=r.getInt32(p);p+=4;let _=A-1;_=Y7>_?Y7:_;let T=SI[_]/2|0,w=SI[A]/2|0;c[0]=c[1]=c[2]=SI[A];let D=Math.ceil(r.getInt32(p)/4)*4;p+=4;let M=1/I,E=0,R=0;for(m[0]=m[1]=m[2]=0;R<S;){v===0?(m[0]=sd.decodeBits(t,p,u[0]),m[1]=sd.decodeBits(t,p,u[1]),m[2]=sd.decodeBits(t,p,u[2])):sd.decodeInts(t,p,v,l,m),R++,m[0]+=s[0],m[1]+=s[1],m[2]+=s[2],d[0]=m[0],d[1]=m[1],d[2]=m[2];let k=sd.decodeBits(t,p,1),B=0;if(k===1&&(E=sd.decodeBits(t,p,5),B=E%3,E-=B,B--),E>0){m[0]=m[1]=m[2]=0;for(let L=0;L<E;L+=3){if(sd.decodeInts(t,p,A,c,m),R++,m[0]+=d[0]-w,m[1]+=d[1]-w,m[2]+=d[2]-w,L===0){let V=m[0];m[0]=d[0],d[0]=V,V=m[1],m[1]=d[1],d[1]=V,V=m[2],m[2]=d[2],d[2]=V,f.x[x]=d[0]*M,f.y[x]=d[1]*M,f.z[x]=d[2]*M,x++}else d[0]=m[0],d[1]=m[1],d[2]=m[2];f.x[x]=m[0]*M,f.y[x]=m[1]*M,f.z[x]=m[2]*M,x++}}else f.x[x]=m[0]*M,f.y[x]=m[1]*M,f.z[x]=m[2]*M,x++;A+=B,B<0?(w=T,A>Y7?T=SI[A-1]/2|0:T=0):B>0&&(T=w,w=SI[A]/2|0),c[0]=c[1]=c[2]=SI[A],(c[0]===0||c[1]===0||c[2]===0)&&Eqe()}p+=D}for(let x=0;x<y;x++)f.x[x]*=10,f.y[x]*=10,f.z[x]*=10;if(o.push(f),e.shouldUpdate&&await e.update({current:p,max:t.length}),p>=t.length)break}return a.length>=1&&(n.timeOffset=a[0]),a.length>=2&&(n.deltaTime=a[1]-a[0]),n}function Nbe(e){return Pe.create("Parse XTC",async t=>{try{t.update({canAbort:!0,message:"Parsing trajectory..."});let r=await Mqe(t,e);return jr.success(r)}catch(r){return jr.error(""+r)}})}function zbe(e){return Pe.create("Parse XTC",async t=>{await t.update("Converting to coordinates");let r=rs(e.deltaTime,"step"),n=rs(e.timeOffset,r.unit),o=[];for(let i=0,a=e.frames.length;i<a;++i){let s=e.boxes[i],l=b.fromArray(b(),s,0),u=b.fromArray(b(),s,3),c=b.fromArray(b(),s,6);o.push({elementCount:e.frames[i].count,cell:rd.fromBasis(l,u,c),x:e.frames[i].x,y:e.frames[i].y,z:e.frames[i].z,xyzOrdering:{isIdentity:!0},time:rs(n.value+r.value*i,r.unit)})}return qm.create(o,r,n)})}function Bqe(e){let t=e.position>=e.data.length-1?0:+yt.readLine(e);isNaN(t)&&(t=0);let r=yt.readLine(e),n=new Float64Array(t),o=new Float64Array(t),i=new Float64Array(t),a=new Array(t);for(let s=0;s<t;++s){let u=yt.readLineTrim(e).split(/\s+/g);a[s]=u[0],n[s]=+u[1],o[s]=+u[2],i[s]=+u[3]}return{count:t,comment:r,x:H.ofFloatArray(n),y:H.ofFloatArray(o),z:H.ofFloatArray(i),type_symbol:H.ofStringArray(a)}}function kqe(e){let t=yt(e),r=[];for(;;){let o=Bqe(t);if(o.count===0)break;r.push(o)}let n={molecules:r};return jr.success(n)}function Hbe(e){return Pe.create("Parse Mol",async()=>kqe(e))}function Lqe(e,t){let{molecules:r}=e,n=0;for(let S of r)n+=S.count;let o=new Array(n),i=new Int32Array(n),a=new Float32Array(n),s=new Float32Array(n),l=new Float32Array(n),u=new Int32Array(n),c=0;for(let S=0;S<r.length;S++){let I=r[S];for(let v=0;v<I.count;v++)o[c]=I.type_symbol.value(v),a[c]=I.x.value(v),s[c]=I.y.value(v),l[c]=I.z.value(v),i[c]=v,u[c]=S,c++}let m=H.ofConst("MOL",n,H.Schema.str),d=H.ofConst("A",n,H.Schema.str),p=H.ofConst(1,n,H.Schema.int),h=H.ofStringArray(o),f=Cr.ofPartialColumns(Co.atom_site,{auth_asym_id:d,auth_atom_id:h,auth_comp_id:m,auth_seq_id:p,Cartn_x:H.ofFloatArray(a),Cartn_y:H.ofFloatArray(s),Cartn_z:H.ofFloatArray(l),id:H.ofIntArray(i),label_asym_id:d,label_atom_id:h,label_comp_id:m,label_seq_id:p,label_entity_id:H.ofConst("1",n,H.Schema.str),occupancy:H.ofConst(1,n,H.Schema.float),type_symbol:h,pdbx_PDB_model_num:H.ofIntArray(u)},n),y=new _i;y.setNames([["MOL","Unknown Entity"]]),y.getEntityId("MOL",0,"A");let g=new Ri(p,h);g.setNames([["MOL","Unknown Molecule"]]),g.add("MOL",0);let x=Gi({entity:y.getEntityTable(),chem_comp:g.getChemCompTable(),atom_site:f});return Fa(x,jbe.create(e),t)}var jbe;(r=>{function e(n){return n?.kind==="xyz"}r.is=e;function t(n){return{kind:"xyz",name:"xyz",data:n}}r.create=t})(jbe||={});function Wbe(e){return Pe.create("Parse XYZ",t=>Lqe(e,t))}var R_={lj:{mass:"unitless",distance:"unitless",time:"unitless",energy:"unitless",velocity:"unitless",force:"unitless",torque:"unitless",temperature:"unitless",pressure:"unitless",viscosity:"unitless",charge:"unitless",density:"unitless",scale:1},real:{mass:"grams/mole",distance:"Angstroms",time:"femtoseconds",energy:"Kcal/mol",velocity:"Angstroms/femtosecond",force:"Kcal/mol-Angstrom",torque:"Kcal/mol",temperature:"Kelvin",pressure:"atmospheres",viscosity:"Poise",charge:"multiple of electron charge",dipole:"charge*Angstroms",electricField:"volts/Angstrom",density:"g/cm^3",scale:1},metal:{mass:"grams/mole",distance:"Angstroms",time:"picoseconds",energy:"eV",velocity:"Angstroms/picosecond",force:"eV/Angstrom",torque:"eV",temperature:"Kelvin",pressure:"bars",viscosity:"Poise",charge:"multiple of electron charge",dipole:"charge*Angstroms",electricField:"volts/Angstrom",density:"g/cm^3",scale:1},si:{mass:"kilograms",distance:"meters",time:"seconds",energy:"Joules",velocity:"meters/second",force:"Newtons",torque:"Newton-meters",temperature:"Kelvin",pressure:"Pascals",viscosity:"Pascal*second",charge:"Coulombs",dipole:"Coulombs*meters",electricField:"volts/meter",density:"kg/m^3",scale:1},cgs:{mass:"grams",distance:"centimeters",time:"seconds",energy:"ergs",velocity:"centimeters/second",force:"dynes",torque:"dyne-centimeters",temperature:"Kelvin",pressure:"dyne/cm^2",viscosity:"Poise",charge:"statcoulombs",dipole:"statcoul-cm",electricField:"statvolt/cm",density:"g/cm^3",scale:1},electron:{mass:"atomic mass units",distance:"Bohr",time:"femtoseconds",energy:"Hartrees",velocity:"Bohr/atomic time units",force:"Hartrees/Bohr",temperature:"Kelvin",pressure:"Pascals",charge:"multiple of electron charge",dipole:"Debye",electricField:"volts/cm",density:"unitless",torque:"",viscosity:"",scale:.529177},micro:{mass:"picograms",distance:"micrometers",time:"microseconds",energy:"picogram-micrometer^2/microsecond^2",velocity:"micrometers/microsecond",force:"picogram-micrometer/microsecond^2",torque:"picogram-micrometer^2/microsecond^2",temperature:"Kelvin",pressure:"picogram/(micrometer-microsecond^2)",viscosity:"picogram/(micrometer-microsecond)",charge:"picocoulombs",dipole:"picocoulomb-micrometer",electricField:"volt/micrometer",density:"pg/\u03BCm^3",scale:1},nano:{mass:"attograms",distance:"nanometers",time:"nanoseconds",energy:"attogram-nanometer^2/nanosecond^2",velocity:"nanometers/nanosecond",force:"attogram-nanometer/nanosecond^2",torque:"attogram-nanometer^2/nanosecond^2",temperature:"Kelvin",pressure:"attogram/(nanometer-nanosecond^2)",viscosity:"attogram/(nanometer-nanosecond)",charge:"multiple of electron charge",dipole:"charge-nanometer",electricField:"volt/nanometer",density:"ag/nm^3",scale:10}},K7=["real","metal","si","cgs","electron","micro","nano","lj"];var{readLine:Qbe,skipWhitespace:Zbe,eatValue:qbe,eatLine:Fqe,markStart:J7}=yt,Xbe=/\s+/;function Vqe(e,t){return{tokenizer:e,runtimeCtx:t}}async function Oqe(e,t,r){let{tokenizer:n}=e,o=je.create(n.data,t*2),i=je.create(n.data,t*2),a=je.create(n.data,t*2),s=je.create(n.data,t*2),l=je.create(n.data,t*2),u=je.create(n.data,t*2),c=je.create(n.data,t*2),m={full:[o,i,a,s,l,u,c],atomic:[o,a,l,u,c],bond:[o,i,a,l,u,c]},d=m[r].length,{position:p}=n;Qbe(n).trim(),n.position=p;let{length:h}=n,f=0;return await ts(e.runtimeCtx,1e5,void 0,y=>{let g=Math.min(t-f,y);for(let x=0;x<g;++x){for(let S=0;S<d;++S){Zbe(n),J7(n),qbe(n);let I=m[r][S];I&&je.addUnchecked(I,n.tokenStart,n.tokenEnd)}Fqe(n),J7(n)}return f+=g,g},y=>y.update({message:"Parsing...",current:n.position,max:h})),{count:t,atomId:Gt(o)(H.Schema.int),moleculeId:Gt(i)(H.Schema.int),atomType:Gt(a)(H.Schema.int),charge:Gt(s)(H.Schema.float),x:Gt(l)(H.Schema.float),y:Gt(u)(H.Schema.float),z:Gt(c)(H.Schema.float)}}async function Gqe(e,t){let{tokenizer:r}=e,n=je.create(r.data,t*2),o=je.create(r.data,t*2),i=je.create(r.data,t*2),a=je.create(r.data,t*2),{length:s}=r,l=0;return await ts(e.runtimeCtx,10,void 0,u=>{let c=Math.min(t-l,u);for(let m=0;m<c;++m)for(let d=0;d<4;++d)switch(Zbe(r),J7(r),qbe(r),d){case 0:je.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:je.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 2:je.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 3:je.addUnchecked(a,r.tokenStart,r.tokenEnd);break}return l+=c,c},u=>u.update({message:"Parsing...",current:r.position,max:s})),{count:t,bondId:Gt(n)(H.Schema.int),bondType:Gt(o)(H.Schema.int),atomIdA:Gt(i)(H.Schema.int),atomIdB:Gt(a)(H.Schema.int)}}var Uqe=["full","atomic","bond"];async function Nqe(e,t){let r=yt(e),n=Vqe(r,t),o,i,a=0,s=0,l="full";for(;r.tokenEnd<r.length;){let c=Qbe(n.tokenizer).trim();if(c.includes("atoms"))a=parseInt(c.split(Xbe)[0]);else if(c.includes("bonds"))s=parseInt(c.split(Xbe)[0]);else if(!c.includes("Masses"))if(c.includes("Atoms")){let m=c.split("#");if(m.length>1){let d=m[1].trim();Uqe.includes(d)?l=d:console.warn(`Unknown atom style: ${d}`)}o=await Oqe(n,a,l)}else c.includes("Bonds")&&(i=await Gqe(n,s))}if(o===void 0)return jr.error("no atoms data");i===void 0&&(i={count:0,bondId:H.ofIntArray([]),bondType:H.ofIntArray([]),atomIdA:H.ofIntArray([]),atomIdB:H.ofIntArray([])});let u={atoms:o,bonds:i};return jr.success(u)}function Ybe(e){return Pe.create("Parse LammpsData",async t=>await Nqe(e,t))}async function zqe(e,t,r="real"){let{atoms:n,bonds:o}=e,i=[],a=n.count,s=R_[r].scale,l=new Array(a),u=new Int32Array(a),c=new Float32Array(a),m=new Float32Array(a),d=new Float32Array(a),p=new Int32Array(a),h=0;for(let T=0;T<a;T++)l[h]=n.atomType.value(T).toString(),c[h]=n.x.value(T)*s,m[h]=n.y.value(T)*s,d[h]=n.z.value(T)*s,u[h]=n.atomId.value(T)-1,p[h]=0,h++;let f=H.ofConst("MOL",a,H.Schema.str),y=H.ofLambda({value:T=>n.moleculeId.value(T).toString(),rowCount:a,schema:H.Schema.str}),g=H.ofConst(1,a,H.Schema.int),x=H.ofStringArray(l),S=Cr.ofPartialColumns(Co.atom_site,{auth_asym_id:y,auth_atom_id:x,auth_comp_id:f,auth_seq_id:g,Cartn_x:H.ofFloatArray(c),Cartn_y:H.ofFloatArray(m),Cartn_z:H.ofFloatArray(d),id:H.ofIntArray(u),label_asym_id:y,label_atom_id:x,label_comp_id:f,label_seq_id:g,label_entity_id:H.ofConst("1",a,H.Schema.str),occupancy:H.ofConst(1,a,H.Schema.float),type_symbol:x,pdbx_PDB_model_num:H.ofIntArray(p)},a),I=new _i;I.setNames([["MOL","Unknown Entity"]]),I.getEntityId("MOL",0,"A");let v=new Ri(g,x);v.setNames([["MOL","Unknown Molecule"]]),v.add("MOL",0);let A=Gi({entity:I.getEntityTable(),chem_comp:v.getChemCompTable(),atom_site:S}),_=await Fa(A,Kbe.create(e),t);if(_.frameCount>0){let T=_.representative;if(o.count!==0){let w=H.ofIntArray(H.mapToArray(o.atomIdA,B=>B-1,Int32Array)),D=H.ofIntArray(H.mapToArray(o.atomIdB,B=>B-1,Int32Array)),M=o.bondId,E=H.ofConst(1,o.count,H.Schema.int),R=H.ofConst(ht.Flag.Covalent,o.count,H.Schema.int),k=Do.fromData({pairs:{key:M,indexA:w,indexB:D,order:E,flag:R},count:n.count},{maxDistance:1/0});Do.Provider.set(T,k)}kh.Provider.set(T,{data:n.charge,type:"NO_CHARGES"}),i.push(T)}return new cl(i)}var Kbe;(r=>{function e(n){return n?.kind==="data"}r.is=e;function t(n){return{kind:"data",name:"data",data:n}}r.create=t})(Kbe||={});function Jbe(e,t){return t===void 0&&(t="real"),Pe.create("Parse Lammps Data",r=>zqe(e,r,t))}var{readLine:vI,skipWhitespace:Hqe,eatValue:jqe,eatLine:Wqe,markStart:$be}=yt;function Xqe(e,t){return{tokenizer:e,runtimeCtx:t}}async function Qqe(e,t,r){let{tokenizer:n}=e,o=Object.fromEntries(r.map((S,I)=>[S,I])),i=r.findIndex(S=>S[0]==="x"),a=r.findIndex(S=>S[0]==="y"),s=r.findIndex(S=>S[0]==="z"),l=r[i],u=je.create(n.data,t*2),c=je.create(n.data,t*2),m=je.create(n.data,t*2),d=je.create(n.data,t*2),p=je.create(n.data,t*2),h=je.create(n.data,t*2),{position:f}=n;n.position=f;let y=r.length,{length:g}=n,x=0;return await ts(e.runtimeCtx,1e5,void 0,S=>{let I=Math.min(t-x,S);for(let v=0;v<I;++v){for(let A=0;A<y;++A)switch(Hqe(n),$be(n),jqe(n),A){case o.id:je.addUnchecked(u,n.tokenStart,n.tokenEnd);break;case o.mol:je.addUnchecked(c,n.tokenStart,n.tokenEnd);break;case o.type:je.addUnchecked(m,n.tokenStart,n.tokenEnd);break;case i:je.addUnchecked(d,n.tokenStart,n.tokenEnd);break;case a:je.addUnchecked(p,n.tokenStart,n.tokenEnd);break;case s:je.addUnchecked(h,n.tokenStart,n.tokenEnd);break}Wqe(n),$be(n)}return x+=I,I},S=>S.update({message:"Parsing...",current:n.position,max:g})),{count:t,atomMode:l,atomId:Gt(u)(H.Schema.int),moleculeId:Gt(c)(H.Schema.int),atomType:Gt(m)(H.Schema.int),x:Gt(d)(H.Schema.float),y:Gt(p)(H.Schema.float),z:Gt(h)(H.Schema.float)}}async function Zqe(e,t){let r=yt(e),n=Xqe(r,t),o={frames:[],times:[],bounds:[],timeOffset:0,deltaTime:0},i=o.frames,a=0,s=0;for(;r.tokenEnd<r.length;){let l=vI(n.tokenizer).trim();if(l.includes("ITEM: TIMESTEP"))s=parseInt(vI(n.tokenizer).trim()),o.times.push(s);else if(l.includes("ITEM: NUMBER OF ATOMS"))a=parseInt(vI(n.tokenizer).trim());else if(l.includes("ITEM: ATOMS")){let u=l.split(" ").slice(2),c=await Qqe(n,a,u);i.push(c)}else if(l.includes("ITEM: BOX BOUNDS")){let u=l.split("ITEM: BOX BOUNDS ")[1].split(" "),c=u[0],m=u[1],d=u[2],p=vI(n.tokenizer).trim().split(" "),h=vI(n.tokenizer).trim().split(" "),f=vI(n.tokenizer).trim().split(" "),y=parseFloat(p[0]),g=parseFloat(p[1]),x=parseFloat(h[0]),S=parseFloat(h[1]),I=parseFloat(f[0]),v=parseFloat(f[1]);o.bounds.push({lower:[y,x,I],length:[g-y,S-x,v-I],periodicity:[c,m,d]})}}return o.times.length>=1&&(o.timeOffset=o.times[0]),o.times.length>=2&&(o.deltaTime=o.times[1]-o.times[0]),jr.success(o)}function $7(e){return Pe.create("Parse Lammp Trajectory",async t=>await Zqe(e,t))}function ej(e,t="real"){return Pe.create("Parse Lammps Trajectory",async r=>{await r.update("Converting to coordinates");let n=R_[t].scale,o=rs(e.deltaTime,"step"),i=rs(e.timeOffset,o.unit),a={x:0,y:0,z:0},s={x:1,y:1,z:1},u=e.frames[0].atomMode.includes("s"),c=[];for(let m=0,d=e.frames.length;m<d;++m){let p=e.bounds[m];u&&(s.x=p.length[0],s.y=p.length[1],s.z=p.length[2],a.x=p.lower[0],a.y=p.lower[1],a.z=p.lower[2]);let h=e.frames[m].count,f=new Float32Array(h),y=new Float32Array(h),g=new Float32Array(h),x=0;for(let S=0;S<h;S++)f[x]=(e.frames[m].x.value(S)*s.x+a.x)*n,y[x]=(e.frames[m].y.value(S)*s.y+a.y)*n,g[x]=(e.frames[m].z.value(S)*s.z+a.z)*n,x++;c.push({elementCount:e.frames[m].count,x:f,y,z:g,xyzOrdering:{isIdentity:!0},time:rs(i.value+o.value*m,o.unit)})}return qm.create(c,o,i)})}async function qqe(e,t,r="real"){let n=e.frames[0],o=n.count,i=n.atomMode,a=e.bounds[0],s={x:0,y:0,z:0},l={x:1,y:1,z:1},u=R_[r].scale;i.includes("s")&&(l.x=a.length[0],l.y=a.length[1],l.z=a.length[2],s.x=a.lower[0],s.y=a.lower[1],s.z=a.lower[2]);let c=new Array(o),m=new Int32Array(o),d=new Float32Array(o),p=new Float32Array(o),h=new Float32Array(o),f=new Int32Array(o),y=0;for(let E=0;E<o;E++)c[y]=n.atomType.value(E).toString(),d[y]=(n.x.value(E)*l.x+s.x)*u,p[y]=(n.y.value(E)*l.y+s.y)*u,h[y]=(n.z.value(E)*l.z+s.z)*u,m[y]=n.atomId.value(E),f[y]=0,y++;let g=H.ofConst("MOL",o,H.Schema.str),x=H.ofLambda({value:E=>n.moleculeId.value(E).toString(),rowCount:o,schema:H.Schema.str}),S=H.ofConst(1,o,H.Schema.int),I=H.ofStringArray(c),v=Cr.ofPartialColumns(Co.atom_site,{auth_asym_id:x,auth_atom_id:I,auth_comp_id:g,auth_seq_id:S,Cartn_x:H.ofFloatArray(d),Cartn_y:H.ofFloatArray(p),Cartn_z:H.ofFloatArray(h),id:H.ofIntArray(m),label_asym_id:x,label_atom_id:I,label_comp_id:g,label_seq_id:S,label_entity_id:H.ofConst("1",o,H.Schema.str),occupancy:H.ofConst(1,o,H.Schema.float),type_symbol:I,pdbx_PDB_model_num:H.ofIntArray(f)},o),A=new _i;A.setNames([["MOL","Unknown Entity"]]),A.getEntityId("MOL",0,"A");let _=new Ri(S,I);_.setNames([["MOL","Unknown Molecule"]]),_.add("MOL",0);let T=Gi({entity:A.getEntityTable(),chem_comp:_.getChemCompTable(),atom_site:v}),D=(await Fa(T,exe.create(e),t)).representative,M=await ej(e,r).runInContext(t);return Ft.trajectoryFromModelAndCoordinates(D,M)}var exe;(r=>{function e(n){return n?.kind==="lammpstrj"}r.is=e;function t(n){return{kind:"lammpstrj",name:"lammpstrj",data:n}}r.create=t})(exe||={});function txe(e,t){return t===void 0&&(t="real"),Pe.create("Parse Lammps Traj Data",r=>qqe(e,r,t))}function rxe(e){return e.trim().endsWith("V3000")}function nxe(e){let t=je.create(e.data,1),r=je.create(e.data,1);return yt.eatLine(e),Ty(e),Ty(e),Ty(e),Ay(e,t),Ay(e,r),yt.eatLine(e),{atomCount:Gt(t)(H.Schema.int).value(0),bondCount:Gt(r)(H.Schema.int).value(0)}}function oxe(e,t){let r=je.create(e.data,t*2),n=je.create(e.data,t*2),o=je.create(e.data,t*2),i=je.create(e.data,t*2);for(let a=0;a<t;++a){yt.markLine(e),Ty(e),Ty(e),Ty(e);let{position:s}=e;Ay(e,i),Ay(e,r),Ay(e,n),Ay(e,o),e.position=s}return yt.eatLine(e),yt.eatLine(e),{count:t,x:Gt(r)(H.Schema.float),y:Gt(n)(H.Schema.float),z:Gt(o)(H.Schema.float),type_symbol:Gt(i)(H.Schema.str),formal_charge:H.ofConst(0,t,H.Schema.int)}}function ixe(e,t){let r=je.create(e.data,t*2),n=je.create(e.data,t*2),o=je.create(e.data,t*2);for(let i=0;i<t;++i){yt.markLine(e),Ty(e),Ty(e),Ty(e);let{position:a}=e;Ay(e,o),Ay(e,r),Ay(e,n),e.position=a}return yt.eatLine(e),yt.eatLine(e),{count:t,atomIdxA:Gt(r)(H.Schema.float),atomIdxB:Gt(n)(H.Schema.float),order:Gt(o)(H.Schema.float)}}function Ty(e){yt.skipWhitespace(e),yt.eatValue(e)}function Ay(e,t){let{position:r}=e;yt.skipWhitespace(e),yt.eatValue(e),yt.trim(e,r,e.position),je.addUnchecked(t,e.tokenStart,e.tokenEnd)}var tj="$$$$";function Yqe(e){let t=je.create(e.data,32),r=je.create(e.data,32);for(;e.position<e.length;){let n=yt.readLine(e);if(n.startsWith(tj))break;if(n&&n.startsWith("> ")){je.add(t,e.tokenStart+2,e.tokenEnd),yt.markLine(e);let o=e.tokenStart,i=e.tokenEnd,a=!1;for(;e.position<e.length;){let s=yt.readLine(e);if(!s||s.startsWith(tj)||s.startsWith("> ")){je.add(r,o,i),a=!0;break}i=e.tokenEnd}a||je.add(r,o,i)}}return{dataHeader:Gt(t)(H.Schema.str),data:Gt(r)(H.Schema.str)}}function Kqe(e){return{atomCount:+e.substr(0,3),bondCount:+e.substr(3,3)}}function Jqe(e){let t=yt.readLine(e).trim(),r=yt.readLine(e).trim(),n=yt.readLine(e).trim(),o=yt.readLine(e),i=rxe(o),{atomCount:a,bondCount:s}=i?nxe(e):Kqe(o);if(Number.isNaN(a)||Number.isNaN(s)){for(;e.position<e.length&&!yt.readLine(e).startsWith(tj););return}let l={atomIdx:H.ofConst(0,a,H.Schema.int),charge:H.ofConst(0,a,H.Schema.int)},u=i?oxe(e,a):W7(e,a),c=i?ixe(e,s):X7(e,s),m=i?{formalCharges:l}:Q7(e),d=Yqe(e);return{molFile:{title:t,program:r,comment:n,atoms:u,bonds:c,...m},dataItems:d}}function $qe(e){let t=yt(e),r=[];for(;t.position<t.length;){let n=Jqe(t);n&&r.push(n)}return jr.success({compounds:r})}function axe(e){return Pe.create("Parse Sdf",async()=>$qe(e))}var sxe;(r=>{function e(n){return n?.kind==="sdf"}r.is=e;function t(n){return{kind:"sdf",name:n.molFile.title,data:n}}r.create=t})(sxe||={});function lxe(e){return Pe.create("Parse SDF",t=>Z7(e.molFile,sxe.create(e),t))}async function eYe(e){let t=new DataView(e.buffer),r={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},n=r.frames,o=r.boxes,i=r.times,a=0;for(;;){a+=8;let s=t.getInt32(a);a+=4,a+=s;let l=t.getInt32(a+8),u=t.getInt32(a+12),c=t.getInt32(a+16),m=t.getInt32(a+28),d=t.getInt32(a+32),p=t.getInt32(a+36),h=t.getInt32(a+40);a+=52;let f=l/9,y=h*3;if(f===8?i.push(t.getFloat64(a)):i.push(t.getFloat32(a)),a+=2*f,l){let g=new Float32Array(9);if(f===8)for(let x=0;x<9;++x)g[x]=t.getFloat64(a)*10,a+=8;else for(let x=0;x<9;++x)g[x]=t.getFloat32(a)*10,a+=4;o.push(g)}if(a+=u,a+=c,m){let g=new Float32Array(h),x=new Float32Array(h),S=new Float32Array(h);if(f===8)for(let I=0;I<h;++I)g[I]=t.getFloat64(a)*10,x[I]=t.getFloat64(a+8)*10,S[I]=t.getFloat64(a+16)*10,a+=24;else{let I=new Uint32Array(e.buffer,a,y);for(let A=0;A<y;++A){let _=I[A];I[A]=(_&255)<<24|(_&65280)<<8|_>>8&65280|_>>24&255}let v=new Float32Array(e.buffer,a,y);for(let A=0;A<h;++A)g[A]=v[A*3]*10,x[A]=v[A*3+1]*10,S[A]=v[A*3+2]*10,a+=12}n.push({count:h,x:g,y:x,z:S})}if(a+=d,a+=p,a>=e.byteLength)break}return i.length>=1&&(r.timeOffset=i[0]),i.length>=2&&(r.deltaTime=i[1]-i[0]),r}function uxe(e){return Pe.create("Parse TRR",async t=>{try{t.update({canAbort:!0,message:"Parsing trajectory..."});let r=await eYe(e);return jr.success(r)}catch(r){return jr.error(""+r)}})}function cxe(e){return Pe.create("Parse TRR",async t=>{await t.update("Converting to coordinates");let r=rs(e.deltaTime,"step"),n=rs(e.timeOffset,r.unit),o=[];for(let i=0,a=e.frames.length;i<a;++i){let s=e.boxes[i],l=b.fromArray(b(),s,0),u=b.fromArray(b(),s,3),c=b.fromArray(b(),s,6);o.push({elementCount:e.frames[i].count,cell:rd.fromBasis(l,u,c),x:e.frames[i].x,y:e.frames[i].y,z:e.frames[i].z,xyzOrdering:{isIdentity:!0},time:rs(n.value+r.value*i,r.unit)})}return qm.create(o,r,n)})}var tYe=1024*8,rj=[],Ik=class{constructor(t,r={}){this._mark=0;this._marks=[];this.offset=0;this.littleEndian=!0;let n=!1;t===void 0&&(t=tYe),typeof t=="number"?t=new ArrayBuffer(t):n=!0;let o=r.offset?r.offset>>>0:0,i=t.byteLength-o,a=o;t instanceof ArrayBuffer||(t.byteLength!==t.buffer.byteLength&&(a=t.byteOffset+o),t=t.buffer),n?this._lastWrittenByte=i:this._lastWrittenByte=0,this.buffer=t,this.length=i,this.byteLength=i,this.byteOffset=a,this._data=new DataView(this.buffer,a,i)}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t){return t===void 0&&(t=1),this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){let t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t){if(t===void 0&&(t=1),!this.available(t)){let n=(this.offset+t)*2,o=new Uint8Array(n);o.set(new Uint8Array(this.buffer)),this.buffer=o.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){t===void 0&&(t=1);let r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=this.readByte();return r}readInt16(){let t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){let t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){let t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){let t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){let t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){let t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){rj.length=t;for(let r=0;r<t;r++)rj[r]=this.readChar();return rj.join("")}writeBoolean(t=!1){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}};function ap(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)}function mxe(e){e.offset%4!==0&&e.skip(4-e.offset%4)}function nj(e){let t=e.readUint32(),r=e.readChars(t);return mxe(e),r}var xa={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function dxe(e){switch(Number(e)){case xa.BYTE:return"byte";case xa.CHAR:return"char";case xa.SHORT:return"short";case xa.INT:return"int";case xa.FLOAT:return"float";case xa.DOUBLE:return"double";default:return"undefined"}}function pxe(e){switch(Number(e)){case xa.BYTE:return 1;case xa.CHAR:return 1;case xa.SHORT:return 2;case xa.INT:return 4;case xa.FLOAT:return 4;case xa.DOUBLE:return 8;default:return-1}}function fxe(e){switch(String(e)){case"byte":return xa.BYTE;case"char":return xa.CHAR;case"short":return xa.SHORT;case"int":return xa.INT;case"float":return xa.FLOAT;case"double":return xa.DOUBLE;default:return-1}}function Ak(e,t){if(e!==1){let r=new Array(e);for(let n=0;n<e;n++)r[n]=t();return r}else return t()}function oj(e,t,r){switch(t){case xa.BYTE:return e.readBytes(r);case xa.CHAR:return rYe(e.readChars(r));case xa.SHORT:return Ak(r,e.readInt16.bind(e));case xa.INT:return Ak(r,e.readInt32.bind(e));case xa.FLOAT:return Ak(r,e.readFloat32.bind(e));case xa.DOUBLE:return Ak(r,e.readFloat64.bind(e));default:ap(!0,"non valid type "+t);return}}function rYe(e){return e.charCodeAt(e.length-1)===0?e.substring(0,e.length-1):e}function nYe(e,t){let r=fxe(t.type),n=t.size/pxe(r),o=new Array(n);for(let i=0;i<n;i++)o[i]=oj(e,r,1);return o}function oYe(e,t,r){let n=fxe(t.type),o=t.size?t.size/pxe(n):1,i=r.length,a=new Array(i),s=r.recordStep;for(let l=0;l<i;l++){let u=e.offset;a[l]=oj(e,n,o),e.seek(u+s)}return a}var II=0,iYe=10,aYe=11,sYe=12;function lYe(e,t){let r={recordDimension:{length:e.readUint32()}};r.version=t;let n=uYe(e);r.recordDimension.id=n.recordId,r.recordDimension.name=n.recordName,r.dimensions=n.dimensions,r.globalAttributes=hxe(e);let o=cYe(e,n.recordId,t);return r.variables=o.variables,r.recordDimension.recordStep=o.recordStep,r}function uYe(e){let t,r,n,o=e.readUint32();if(o===II)return ap(e.readUint32()!==II,"wrong empty tag for list of dimensions"),[];{ap(o!==iYe,"wrong tag for list of dimensions");let i=e.readUint32();t=new Array(i);for(let a=0;a<i;a++){let s=nj(e),l=e.readUint32();l===0&&(r=a,n=s),t[a]={name:s,size:l}}return{dimensions:t,recordId:r,recordName:n}}}function hxe(e){let t,r=e.readUint32();if(r===II)return ap(e.readUint32()!==II,"wrong empty tag for list of attributes"),[];{ap(r!==sYe,"wrong tag for list of attributes");let n=e.readUint32();t=new Array(n);for(let o=0;o<n;o++){let i=nj(e),a=e.readUint32();ap(a<1||a>6,"non valid type "+a);let s=e.readUint32(),l=oj(e,a,s);mxe(e),t[o]={name:i,type:dxe(a),value:l}}}return t}function cYe(e,t,r){let n=e.readUint32(),o=0,i;if(n===II)return ap(e.readUint32()!==II,"wrong empty tag for list of variables"),[];{ap(n!==aYe,"wrong tag for list of variables");let a=e.readUint32();i=new Array(a);for(let s=0;s<a;s++){let l=nj(e),u=e.readUint32(),c=new Array(u);for(let f=0;f<u;f++)c[f]=e.readUint32();let m=hxe(e),d=e.readUint32();ap(d<1&&d>6,"non valid type "+d);let p=e.readUint32(),h=e.readUint32();r===2&&(ap(h>0,"offsets larger than 4GB not supported"),h=e.readUint32()),c[0]===t&&(o+=p),i[s]={name:l,dimensions:c,attributes:m,type:dxe(d),size:p,offset:h,record:c[0]===t}}}return{variables:i,recordStep:o}}var Tk=class{constructor(t){let r=new Ik(t);r.setBigEndian(),ap(r.readChars(3)!=="CDF","should start with CDF");let n=r.readByte();ap(n>2,"unknown version"),this.header=lYe(r,n),this.buffer=r}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(t){return this.header.variables&&this.header.variables.findIndex(r=>r.name===t)!==-1}getDataVariable(t){let r;if(typeof t=="string"?r=this.header.variables?.find(n=>n.name===t):r=t,r===void 0)throw new Error("variable not found");return this.buffer.seek(r.offset),r.record?oYe(this.buffer,r,this.header.recordDimension):nYe(this.buffer,r)}};async function mYe(e){let t=new Tk(e),r={coordinates:[],time:[],timeOffset:0,deltaTime:1};for(let n of t.getDataVariable("coordinates"))r.coordinates.push(n);if(t.hasDataVariable("velocities")){let n=[];for(let o of t.getDataVariable("velocities"))n.push(o);r.velocities=n}if(t.hasDataVariable("forces")){let n=[];for(let o of t.getDataVariable("forces"))n.push(o);r.forces=n}if(t.hasDataVariable("cell_lengths")){let n=[];for(let o of t.getDataVariable("cell_lengths"))n.push(o);r.cell_lengths=n}if(t.hasDataVariable("cell_angles")){let n=[];for(let o of t.getDataVariable("cell_angles"))n.push(o);r.cell_angles=n}if(t.hasDataVariable("time")){let n=[];for(let o of t.getDataVariable("time"))n.push(o);r.time=n}return r.time&&(r.time.length>=1&&(r.timeOffset=r.time[0]),r.time.length>=2&&(r.deltaTime=r.time[1]-r.time[0])),r}function gxe(e){return Pe.create("Parse NCTRAJ",async t=>{try{t.update({canAbort:!0,message:"Parsing trajectory..."});let r=await mYe(e);return jr.success(r)}catch(r){return jr.error(""+r)}})}function yxe(e){return Pe.create("Parse NCTRAJ",async t=>{await t.update("Converting to coordinates");let r=rs(e.deltaTime,"step"),n=rs(e.timeOffset,r.unit),o=[];for(let i=0,a=e.coordinates.length;i<a;++i){let s=e.coordinates[i],l=s.length/3,u=new Float32Array(l),c=new Float32Array(l),m=new Float32Array(l);for(let p=0,h=s.length;p<h;p+=3)u[p/3]=s[p],c[p/3]=s[p+1],m[p/3]=s[p+2];let d={elementCount:l,x:u,y:c,z:m,xyzOrdering:{isIdentity:!0},time:rs(n.value+r.value*i,r.unit)};if(e.cell_lengths){let p=e.cell_lengths[i],h=b.scale(b(),b.unitX,p[0]),f=b.scale(b(),b.unitY,p[1]),y=b.scale(b(),b.unitZ,p[2]);d.cell=rd.fromBasis(h,f,y)}o.push(d)}return qm.create(o,r,n)})}function dYe(e){let{pointers:t,residuePointer:r,residueLabel:n,atomName:o}=e,i=t.NATOM,a=t.NRES,s=new Uint32Array(i),l=[],u=(R,k,B)=>{let L=n.value(R);for(let V=k,U=B;V<U;++V)s[V]=R+1,l[V]=L};for(let R=0,k=a-1;R<k;++R)u(R,r.value(R)-1,r.value(R+1)-1);u(a-1,r.value(a-1)-1,i);let c=H.ofIntArray(s),m=H.ofStringArray(l),d=new Array(i),p=new Array(i),h=new Uint32Array(i),f=new Uint32Array(i),y=new _i,g=new Ri(c,o),x="",S=0,I="",v=0,A=0,_=-1;for(let R=0,k=i;R<k;++R){let B=c.value(R);if(B!==_){let L=m.value(R),V=Tl(g.add(L,R).type,L);V!==A&&(I=yf(S),S+=1,v=0),x=y.getEntityId(L,V,I),v+=1,_=B,A=V}d[R]=x,p[R]=I,h[R]=v,f[R]=R}let T=H.ofIntArray(f),w=H.ofStringArray(p),D=new Array(i);for(let R=0;R<i;++R)D[R]=rp(o.value(R),m.value(R));let M=Cr.ofPartialColumns(Co.atom_site,{auth_asym_id:w,auth_atom_id:H.asArrayColumn(o),auth_comp_id:m,auth_seq_id:c,id:H.asArrayColumn(T),label_asym_id:w,label_atom_id:H.asArrayColumn(o),label_comp_id:m,label_seq_id:H.ofIntArray(h),label_entity_id:H.ofStringArray(d),occupancy:H.ofConst(1,i,H.Schema.float),type_symbol:H.ofStringArray(D),pdbx_PDB_model_num:H.ofConst(1,i,H.Schema.int)},i);return Gi({entity:y.getEntityTable(),chem_comp:g.getChemCompTable(),atom_site:M})}var bxe;(r=>{function e(n){return n?.kind==="prmtop"}r.is=e;function t(n){return{kind:"prmtop",name:n.title.join(" ")||"PRMTOP",data:n}}r.fromPrmtop=t})(bxe||={});function xxe(e){return Pe.create("Parse PRMTOP",async t=>{let r=bxe.fromPrmtop(e),n=dYe(e),{pointers:{NBONH:o,NBONA:i},bondsIncHydrogen:a,bondsWithoutHydrogen:s}=e,l=o+i,u={indexA:H.ofLambda({value:c=>c<o?a.value(c*3)/3:s.value((c-o)*3)/3,rowCount:l,schema:H.Schema.int}),indexB:H.ofLambda({value:c=>c<o?a.value(c*3+1)/3:s.value((c-o)*3+1)/3,rowCount:l,schema:H.Schema.int}),order:H.ofConst(1,l,H.Schema.int)};return B0.create(e.title.join(" ")||"PRMTOP",n,u,r)})}function pYe(e){let{molecules:t,compounds:r}=e,n={},o=0;for(let R=0,k=t._rowCount;R<k;++R){let B=t.compound.value(R),L=t.molCount.value(R),{atoms:V}=r[B];H.asArrayColumn(V.atom),H.asArrayColumn(V.resnr),H.asArrayColumn(V.residu),o+=L*V._rowCount;let U=V.resnr.value(0);n[B]=!0;for(let Q=1,O=V._rowCount;Q<O;++Q){let q=V.resnr.value(Q);if(q!==U){n[B]=!1;break}U=q}}let i=new Array(o),a=new Uint32Array(o),s=new Array(o),l=0;for(let R=0,k=t._rowCount;R<k;++R){let B=t.compound.value(R),L=t.molCount.value(R),{atoms:V}=r[B],U=n[B];for(let Q=0;Q<L;++Q)for(let O=0,q=V._rowCount;O<q;++O)i[l]=V.atom.value(O),a[l]=V.resnr.value(O),s[l]=V.residu.value(O),U&&(a[l]+=Q),l+=1}let u=H.ofStringArray(i),c=H.ofIntArray(a),m=H.ofStringArray(s),d=new Array(o),p=new Array(o),h=new Uint32Array(o),f=new Uint32Array(o),y=new _i,g=new Ri(c,u),x="",S=0,I="",v=0,A=0,_=-1;for(let R=0,k=o;R<k;++R){let B=c.value(R);if(B!==_){let L=m.value(R),V=Tl(g.add(L,R).type,L);V!==A&&(I=yf(S),S+=1,v=0),x=y.getEntityId(L,V,I),v+=1,_=B,A=V}d[R]=x,p[R]=I,h[R]=v,f[R]=R}let T=H.ofIntArray(f),w=H.ofStringArray(p),D=new Array(o);for(let R=0;R<o;++R)D[R]=rp(u.value(R),m.value(R));let M=Cr.ofPartialColumns(Co.atom_site,{auth_asym_id:w,auth_atom_id:H.asArrayColumn(u),auth_comp_id:m,auth_seq_id:c,id:H.asArrayColumn(T),label_asym_id:w,label_atom_id:H.asArrayColumn(u),label_comp_id:m,label_seq_id:H.ofIntArray(h),label_entity_id:H.ofStringArray(d),occupancy:H.ofConst(1,o,H.Schema.float),type_symbol:H.ofStringArray(D),pdbx_PDB_model_num:H.ofConst(1,o,H.Schema.int)},o);return Gi({entity:y.getEntityTable(),chem_comp:g.getChemCompTable(),atom_site:M})}function fYe(e){let{molecules:t,compounds:r}=e,n=[],o=[],i=0;for(let a=0,s=t._rowCount;a<s;++a){let l=t.compound.value(a),u=t.molCount.value(a),{atoms:c,bonds:m}=r[l];if(m)for(let d=0;d<u;++d){for(let p=0,h=m._rowCount;p<h;++p)n.push(m.ai.value(p)-1+i),o.push(m.aj.value(p)-1+i);i+=c._rowCount}else if(l==="TIP3")for(let d=0;d<u;++d)n.push(0+i),o.push(1+i),n.push(0+i),o.push(2+i),i+=c._rowCount;else i+=u*c._rowCount}return{indexA:H.ofIntArray(n),indexB:H.ofIntArray(o),order:H.ofConst(1,n.length,H.Schema.int)}}var Cxe;(r=>{function e(n){return n?.kind==="top"}r.is=e;function t(n){return{kind:"top",name:n.system||"TOP",data:n}}r.fromTop=t})(Cxe||={});function Sxe(e){return Pe.create("Parse TOP",async t=>{let r=Cxe.fromTop(e),n=pYe(e),o=fYe(e);return B0.create(e.system||"TOP",n,o,r)})}function ij(e){let t=e[0].loci,r=e[1].loci;return{pairs:[{loci:[t,r]}]}}function aj(e){let t=e[0].loci,r=e[1].loci,n=e[2].loci;return{triples:[{loci:[t,r,n]}]}}function sj(e){let t=e[0].loci,r=e[1].loci,n=e[2].loci,o=e[3].loci;return{quads:[{loci:[t,r,n,o]}]}}function lj(e){return{infos:[{loci:e[0].loci}]}}function uj(e){return{locis:e.map(t=>t.loci)}}function cj(e){return{locis:e.map(t=>t.loci)}}function AI(e){if(e.name==="matrix"){let t=Z();return Z.copy(t,e.params.data),e.params.transpose&&Z.transpose(t,t),t}else{let t=Z.fromRotation(Z(),e.params.angle*Math.PI/180,e.params.axis);return Z.setTranslation(t,e.params.translation),t}}var TI=C.MappedStatic("matrix",{matrix:C.Group({data:C.Mat4(Z.identity()),transpose:C.Boolean(!1)},{isFlat:!0}),components:C.Group({translation:C.Vec3(b.create(0,0,0)),axis:C.Vec3(b.create(1,0,0)),angle:C.Numeric(0,{min:-360,max:360,step:1},{description:"Angle in Degrees"})},{isFlat:!0})},{label:"Kind"});var hYe=Bt.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[re.Data.Binary],to:re.Molecule.Coordinates})({apply({a:e}){return Pe.create("Parse DCD",async t=>{let r=await eye(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await Mye(r.result).runInContext(t);return new re.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),gYe=Bt.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[re.Data.Binary],to:re.Molecule.Coordinates})({apply({a:e}){return Pe.create("Parse XTC",async t=>{let r=await Nbe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await zbe(r.result).runInContext(t);return new re.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),yYe=Bt.BuiltIn({name:"coordinates-from-trr",display:{name:"Parse TRR",description:"Parse TRR binary data."},from:[re.Data.Binary],to:re.Molecule.Coordinates})({apply({a:e}){return Pe.create("Parse TRR",async t=>{let r=await uxe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await cxe(r.result).runInContext(t);return new re.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),bYe=Bt.BuiltIn({name:"coordinates-from-nctraj",display:{name:"Parse NCTRAJ",description:"Parse NCTRAJ binary data."},from:[re.Data.Binary],to:re.Molecule.Coordinates})({apply({a:e}){return Pe.create("Parse NCTRAJ",async t=>{let r=await gxe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await yxe(r.result).runInContext(t);return new re.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),xYe=Bt.BuiltIn({name:"coordinates-from-lammpstraj",display:{name:"Parse LAMMPSTRAJ",description:"Parse LAMMPSTRAJ data."},from:[re.Data.String],to:re.Molecule.Coordinates})({apply({a:e}){return Pe.create("Parse LAMMPSTRAJ",async t=>{let r=await $7(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await ej(r.result).runInContext(t);return new re.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),CYe=Bt.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Create topology from PSF."},from:[re.Format.Psf],to:re.Molecule.Topology})({apply({a:e}){return Pe.create("Create Topology",async t=>{let r=await ebe(e.data).runInContext(t);return new re.Molecule.Topology(r,{label:r.label||e.label,description:"Topology"})})}}),SYe=Bt.BuiltIn({name:"topology-from-prmtop",display:{name:"PRMTOP Topology",description:"Create topology from PRMTOP."},from:[re.Format.Prmtop],to:re.Molecule.Topology})({apply({a:e}){return Pe.create("Create Topology",async t=>{let r=await xxe(e.data).runInContext(t);return new re.Molecule.Topology(r,{label:r.label||e.label,description:"Topology"})})}}),vYe=Bt.BuiltIn({name:"topology-from-top",display:{name:"TOP Topology",description:"Create topology from TOP."},from:[re.Format.Top],to:re.Molecule.Topology})({apply({a:e}){return Pe.create("Create Topology",async t=>{let r=await Sxe(e.data).runInContext(t);return new re.Molecule.Topology(r,{label:r.label||e.label,description:"Topology"})})}});async function IYe(e,t,r){if(t.type===re.Molecule.Topology.type){let n=t.data;return await Ft.trajectoryFromTopologyAndCoordinates(n,r).runInContext(e)}else if(t.type===re.Molecule.Model.type){let n=t.data;return Ft.trajectoryFromModelAndCoordinates(n,r)}throw new Error("no model/topology found")}var Pk=Bt.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:re.Root,to:re.Molecule.Trajectory,params:{modelRef:C.Text("",{isHidden:!0}),coordinatesRef:C.Text("",{isHidden:!0})}})({apply({params:e,dependencies:t}){return Pe.create("Create trajectory from model/topology and coordinates",async r=>{let n=t[e.coordinatesRef].data,o=await IYe(r,t[e.modelRef],n),i={label:"Trajectory",description:`${o.frameCount} model${o.frameCount===1?"":"s"}`};return new re.Molecule.Trajectory(o,i)})}}),AYe=Bt.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:re.Format.Blob,to:re.Molecule.Trajectory})({apply({a:e}){return Pe.create("Parse Format Blob",async t=>{let r=[];for(let o of e.data){if(o.kind!=="cif")continue;let i=o.data.blocks[0],a=await JM(i).runInContext(t);if(a.frameCount===0)throw new Error("No models found.");for(let s=0;s<a.frameCount;s++){let l=await Pe.resolveInContext(a.getFrameAtIndex(s),t);r.push(l)}}for(let o=0;o<r.length;o++)Ft.TrajectoryInfo.set(r[o],{index:o,size:r.length});let n={label:"Trajectory",description:`${r.length} model${r.length===1?"":"s"}`};return new re.Molecule.Trajectory(new cl(r),n)})}});function bf(e){return{label:`${e.representative.entry}`,description:`${e.frameCount} model${e.frameCount===1?"":"s"}`}}var mj=Bt.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:re.Format.Cif,to:re.Molecule.Trajectory,params(e){if(!e)return{loadAllBlocks:C.Optional(C.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all datablocks into a single trajectory."})),blockHeader:C.Optional(C.Text(void 0,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:n=>n.loadAllBlocks===!0})),blockIndex:C.Optional(C.Numeric(0,{min:0,step:1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:n=>n.loadAllBlocks===!0||n.blockHeader}))};let{blocks:t}=e.data,r=t.map(n=>[n.header,n.header]);return r.push(["","[Use Block Index]"]),{loadAllBlocks:C.Optional(C.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all data blocks into a single trajectory."})),blockHeader:C.Optional(C.Select(t[0]&&t[0].header,r,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:n=>n.loadAllBlocks===!0})),blockIndex:C.Optional(C.Numeric(0,{min:0,step:1,max:t.length-1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:n=>n.loadAllBlocks===!0||n.blockHeader}))}}})({isApplicable:e=>e.data.blocks.length>0,apply({a:e,params:t}){return Pe.create("Parse mmCIF",async r=>{let n;if(t.loadAllBlocks){let i=[];for(let a of e.data.blocks){r.shouldUpdate&&await r.update(`Parsing ${a.header}...`);let s=await JM(a).runInContext(r);for(let l=0;l<s.frameCount;l++)i.push(await Pe.resolveInContext(s.getFrameAtIndex(l),r))}n=new cl(i)}else{let i=t.blockHeader||e.data.blocks[t.blockIndex??0].header,a=e.data.blocks.find(l=>l.header===i);if(!a)throw new Error(`Data block '${[i]}' not found.`);n=a.categoryNames.includes("chem_comp_atom")&&!a.categoryNames.includes("atom_site")&&!a.categoryNames.includes("ihm_sphere_obj_site")&&!a.categoryNames.includes("ihm_gaussian_obj_site")?await fce(a).runInContext(r):await JM(a,e.data).runInContext(r)}if(n.frameCount===0)throw new Error("No models found.");let o=bf(n);return new re.Molecule.Trajectory(n,o)})}}),dj=Bt.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[re.Data.String],to:re.Molecule.Trajectory,params:{isPdbqt:C.Boolean(!1)}})({apply({a:e,params:t}){return Pe.create("Parse PDB",async r=>{let n=await nye(e.data,e.label,t.isPdbqt).runInContext(r);if(n.isError)throw new Error(n.message);let o=await Jye(n.result).runInContext(r),i=bf(o);return new re.Molecule.Trajectory(o,i)})}}),TYe=Bt.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[re.Data.String],to:re.Molecule.Trajectory})({apply({a:e}){return Pe.create("Parse GRO",async t=>{let r=await rye(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await kye(r.result).runInContext(t),o=bf(n);return new re.Molecule.Trajectory(n,o)})}}),PYe=Bt.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[re.Data.String],to:re.Molecule.Trajectory})({apply({a:e}){return Pe.create("Parse XYZ",async t=>{let r=await Hbe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await Wbe(r.result).runInContext(t),o=bf(n);return new re.Molecule.Trajectory(n,o)})}}),_Ye=Bt.BuiltIn({name:"trajectory-from-lammps-data",display:{name:"Parse Lammps Data",description:"Parse Lammps Data from string and create trajectory."},from:[re.Data.String],to:re.Molecule.Trajectory,params:{unitsStyle:C.Select("real",C.arrayToOptions(K7))}})({apply({a:e,params:t}){return Pe.create("Parse Lammps Data",async r=>{let n=await Ybe(e.data).runInContext(r);if(n.isError)throw new Error(n.message);let o=await Jbe(n.result,t.unitsStyle).runInContext(r),i=bf(o);return new re.Molecule.Trajectory(o,i)})}}),RYe=Bt.BuiltIn({name:"trajectory-from-lammps-traj-data",display:{name:"Parse Lammps traj Data",description:"Parse Lammps Traj Data string and create trajectory."},from:[re.Data.String],to:re.Molecule.Trajectory,params:{unitsStyle:C.Select("real",C.arrayToOptions(K7))}})({apply({a:e,params:t}){return Pe.create("Parse Lammps Data",async r=>{let n=await $7(e.data).runInContext(r);if(n.isError)throw new Error(n.message);let o=await txe(n.result,t.unitsStyle).runInContext(r),i=bf(o);return new re.Molecule.Trajectory(o,i)})}}),DYe=Bt.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[re.Data.String],to:re.Molecule.Trajectory})({apply({a:e}){return Pe.create("Parse MOL",async t=>{let r=await wbe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await Mbe(r.result).runInContext(t),o=bf(n);return new re.Molecule.Trajectory(n,o)})}}),wYe=Bt.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[re.Data.String],to:re.Molecule.Trajectory})({apply({a:e}){return Pe.create("Parse SDF",async t=>{let r=await axe(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=[];for(let a of r.result.compounds){let s=await lxe(a).runInContext(t);for(let l=0;l<s.frameCount;l++)n.push(await Pe.resolveInContext(s.getFrameAtIndex(l),t))}let o=new cl(n),i=bf(o);return new re.Molecule.Trajectory(o,i)})}}),EYe=Bt.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[re.Data.String],to:re.Molecule.Trajectory})({apply({a:e}){return Pe.create("Parse MOL2",async t=>{let r=await Obe(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);let n=await Ube(r.result).runInContext(t),o=bf(n);return new re.Molecule.Trajectory(n,o)})}}),MYe=Bt.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:re.Format.Cube,to:re.Molecule.Trajectory})({apply({a:e}){return Pe.create("Parse MOL",async t=>{let r=await Lbe(e.data).runInContext(t),n=bf(r);return new re.Molecule.Trajectory(r,n)})}}),BYe=Bt.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:re.Format.Cif,to:re.Molecule.Trajectory,params(e){if(!e)return{blockHeader:C.Optional(C.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};let{blocks:t}=e.data;return{blockHeader:C.Optional(C.Select(t[0]&&t[0].header,t.map(r=>[r.header,r.header]),{description:"Header of the block to parse"}))}}})({apply({a:e,params:t}){return Pe.create("Parse CIF Core",async r=>{let n=t.blockHeader||e.data.blocks[0].header,o=e.data.blocks.find(s=>s.header===n);if(!o)throw new Error(`Data block '${[n]}' not found.`);let i=await Bbe(o).runInContext(r);if(i.frameCount===0)throw new Error("No models found.");let a=bf(i);return new re.Molecule.Trajectory(i,a)})}}),kYe=e=>e+1,LYe=e=>e-1,D_=Bt.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:re.Molecule.Trajectory,to:re.Molecule.Model,params:e=>e?{modelIndex:C.Converted(kYe,LYe,C.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:C.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}})({isApplicable:e=>e.data.frameCount>0,apply({a:e,params:t}){return Pe.create("Model from Trajectory",async r=>{let n=t.modelIndex%e.data.frameCount;n<0&&(n+=e.data.frameCount);let o=await Pe.resolveInContext(e.data.getFrameAtIndex(n),r),i=`Model ${n+1}`,a=e.data.frameCount===1?void 0:`of ${e.data.frameCount}`;return new re.Molecule.Model(o,{label:i,description:a})})},interpolate(e,t,r){return{modelIndex:r>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*r)}},dispose({b:e}){e?.data.customProperties.dispose()}}),FYe=Bt.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:re.Molecule.Trajectory,to:re.Molecule.Structure})({apply({a:e}){return Pe.create("Build Structure",async t=>{let r=await De.ofTrajectory(e.data,t),n={label:"Ensemble",description:De.elementDescription(r)};return new re.Molecule.Structure(r,n)})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),pj=Bt.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:re.Molecule.Model,to:re.Molecule.Structure,params(e){return Iy.getParams(e&&e.data)}})({canAutoUpdate({oldParams:e,newParams:t}){return Iy.canAutoUpdate(e.type,t.type)},apply({a:e,params:t},r){return Pe.create("Build Structure",async n=>Iy.create(r,n,e.data,t&&t.type))},update:({a:e,b:t,oldParams:r,newParams:n})=>oa(r,n)?t.data.model===e.data?Je.UpdateResult.Unchanged:Ft.areHierarchiesEqual(e.data,t.data.model)?(t.data=t.data.remapModel(e.data),Je.UpdateResult.Updated):Je.UpdateResult.Recreate:Je.UpdateResult.Recreate,dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),vxe=b(),Ixe=Z(),Axe=Z(),fj=Bt.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:re.Molecule.Structure,to:re.Molecule.Structure,params:{transform:TI}})({canAutoUpdate({newParams:e}){return e.transform.name!=="matrix"},apply({a:e,params:t}){let r=Z();if(t.transform.name==="components"){let{axis:o,angle:i,translation:a}=t.transform.params,s=e.data.boundary.sphere.center;Z.fromTranslation(Ixe,b.negate(vxe,s)),Z.fromTranslation(Axe,b.add(vxe,s,a));let l=Z.fromRotation(Z(),Math.PI/180*i,b.normalize(b(),o));Z.mul3(r,Axe,l,Ixe)}else t.transform.name==="matrix"&&(Z.copy(r,t.transform.params.data),t.transform.params.transpose&&Z.transpose(r,r));let n=De.transform(e.data,r);return new re.Molecule.Structure(n,{label:e.label,description:`${e.description} [Transformed]`})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),hj=Bt.BuiltIn({name:"structure-instances",display:{name:"Structure Instances"},isDecorator:!0,from:re.Molecule.Structure,to:re.Molecule.Structure,params:{transforms:C.ObjectList({transform:TI},()=>"Transform")}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=t.transforms.map(o=>AI(o.transform));if(!r.length)return e;let n=De.instances(e.data,r);return new re.Molecule.Structure(n,{label:e.label,description:`${e.description} [Instanced]`})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),VYe=Bt.BuiltIn({name:"model-with-coordinates",display:{name:"Model With Coordinates",description:"Updates the current model with provided coordinate frame"},from:re.Molecule.Model,to:re.Molecule.Model,params:{frameIndex:C.Optional(C.Numeric(0,void 0,{isHidden:!0})),frameCount:C.Optional(C.Numeric(1,void 0,{isHidden:!0})),atomicCoordinateFrame:C.Optional(C.Value(void 0,{isHidden:!0}))},isDecorator:!0})({apply({a:e,params:t}){if(!t.atomicCoordinateFrame)return e;let r={...e.data,atomicConformation:Ft.getAtomicConformationFromFrame(e.data,t.atomicCoordinateFrame)};return Ft.TrajectoryInfo.set(r,{index:t.frameIndex??0,size:t.frameCount??1}),new re.Molecule.Model(r,{label:e.label,description:e.description})},update:({a:e,b:t,oldParams:r,newParams:n})=>r.atomicCoordinateFrame===n.atomicCoordinateFrame?Je.UpdateResult.Unchanged:(n.atomicCoordinateFrame?t.data={...t.data,atomicConformation:Ft.getAtomicConformationFromFrame(t.data,n.atomicCoordinateFrame)}:t.data=e.data,Ft.TrajectoryInfo.set(t.data,{index:n.frameIndex??0,size:n.frameCount??1}),Je.UpdateResult.Updated)}),OYe=Bt.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:re.Molecule.Structure,to:re.Molecule.Structure,params:()=>({expression:C.Value(ne.struct.generator.all,{isHidden:!0}),label:C.Optional(C.Text("",{isHidden:!0}))})})({apply({a:e,params:t,cache:r}){let{selection:n,entry:o}=Ps.createAndRun(e.data,t.expression);if(r.entry=o,at.isEmpty(n))return An.Null;let i=at.unionStructure(n),a={label:`${t.label||"Selection"}`,description:De.elementDescription(i)};return new re.Molecule.Structure(i,a)},update:({a:e,b:t,oldParams:r,newParams:n,cache:o})=>{if(r.expression!==n.expression)return Je.UpdateResult.Recreate;let i=o.entry;if(i.currentStructure===e.data)return Je.UpdateResult.Unchanged;let a=Ps.updateStructure(i,e.data);return at.isEmpty(a)?Je.UpdateResult.Null:(Ps.updateStructureObject(t,a,n.label),Je.UpdateResult.Updated)},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),GYe=Bt.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:re.Root,to:re.Molecule.Structure.Selections,params:()=>({selections:C.ObjectList({key:C.Text(void 0,{description:"A unique key."}),ref:C.Text(),groupId:C.Optional(C.Text()),expression:C.Value(ne.struct.generator.empty)},e=>e.ref,{isHidden:!0}),isTransitive:C.Optional(C.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:C.Optional(C.Text("",{isHidden:!0}))})})({apply({params:e,cache:t,dependencies:r}){let n=new Map,o=[],i=0;for(let s of e.selections){let{selection:l,entry:u}=Ps.createAndRun(r[s.ref].data,s.expression);n.set(s.key,u);let c=at.toLociWithSourceUnits(l);o.push({key:s.key,structureRef:s.ref,loci:c,groupId:s.groupId}),i+=K.Loci.size(c)}t.entries=n;let a={label:`${e.label||"Multi-selection"}`,description:`${e.selections.length} source(s), ${i} element(s) total`};return new re.Molecule.Structure.Selections(o,a)},update:({b:e,oldParams:t,newParams:r,cache:n,dependencies:o})=>{if(!!t.isTransitive!=!!r.isTransitive)return Je.UpdateResult.Recreate;let i=n.entries,a=new Map,s=new Map;for(let m of e.data)s.set(m.key,m);let l=!1,u=0,c=[];for(let m of r.selections){let d=o[m.ref].data,p=!1;if(i.has(m.key)){let h=i.get(m.key);if(Ps.isUnchanged(h,m.expression,d)&&s.has(m.key)){let f=s.get(m.key);f.groupId!==m.groupId&&(f.groupId=m.groupId,l=!0),a.set(m.key,h),c.push(f),u+=K.Loci.size(f.loci);continue}if(h.expression!==m.expression)p=!0;else{let f=!1;if(r.isTransitive)if(De.areUnitIdsAndIndicesEqual(h.originalStructure,d)){let y=Ps.run(h,h.originalStructure);h.currentStructure=d,a.set(m.key,h);let g=K.Loci.remap(at.toLociWithSourceUnits(y),d);c.push({key:m.key,structureRef:m.ref,loci:g,groupId:m.groupId}),u+=K.Loci.size(g),l=!0}else f=!0;else f=!0;if(f){l=!0;let y=Ps.updateStructure(h,d);a.set(m.key,h);let g=at.toLociWithSourceUnits(y);c.push({key:m.key,structureRef:m.ref,loci:g,groupId:m.groupId}),u+=K.Loci.size(g)}}}else p=!0;if(p){l=!0;let{selection:h,entry:f}=Ps.createAndRun(d,m.expression);a.set(m.key,f);let y=at.toLociWithSourceUnits(h);c.push({key:m.key,structureRef:m.ref,loci:y,groupId:m.groupId}),u+=K.Loci.size(y)}}return l?(n.entries=a,e.data=c,e.label=`${r.label||"Multi-selection"}`,e.description=`${c.length} source(s), ${u} element(s) total`,Je.UpdateResult.Updated):Je.UpdateResult.Unchanged}}),UYe=Bt.BuiltIn({name:"structure-multi-selection-from-bundle",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:re.Root,to:re.Molecule.Structure.Selections,params:()=>({selections:C.ObjectList({key:C.Text(void 0,{description:"A unique key."}),ref:C.Text(),groupId:C.Optional(C.Text()),bundle:C.Value(K.Bundle.Empty)},e=>e.ref,{isHidden:!0}),isTransitive:C.Optional(C.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:C.Optional(C.Text("",{isHidden:!0}))})})({apply({params:e,cache:t,dependencies:r}){let n=new Map,o=[],i=0;for(let s of e.selections){let l=r[s.ref].data,u=K.Bundle.toLoci(s.bundle,l);o.push({key:s.key,structureRef:s.ref,loci:u,groupId:s.groupId}),i+=K.Loci.size(u),n.set(s.key,{source:l})}t.entries=n;let a={label:`${e.label||"Multi-selection"}`,description:`${e.selections.length} source(s), ${i} element(s) total`};return new re.Molecule.Structure.Selections(o,a)},update:({b:e,oldParams:t,newParams:r,cache:n,dependencies:o})=>{if(!!t.isTransitive!=!!r.isTransitive)return Je.UpdateResult.Recreate;let i=n.entries,a=new Map,s=new Map;for(let d of t.selections)s.set(d.key,d.bundle);let l=new Map;for(let d of e.data)l.set(d.key,d);let u=!1,c=0,m=[];for(let d of r.selections){let p=!1;if(i.has(d.key)){let h=o[d.ref].data,f=i.get(d.key),y=s.get(d.key);if(y&&h===f.source&&d.bundle.hash===f.source.hashCode&&K.Bundle.areEqual(d.bundle,y)){let g=l.get(d.key);g.groupId!==d.groupId&&(g.groupId=d.groupId,u=!0),a.set(d.key,f),m.push(g),c+=K.Loci.size(g.loci);continue}p=!0}else p=!0;if(p){u=!0;let h=o[d.ref].data,f=K.Bundle.toLoci(d.bundle,h);m.push({key:d.key,structureRef:d.ref,loci:f,groupId:d.groupId}),c+=K.Loci.size(f),a.set(d.key,{source:h})}}return u?(n.entries=a,e.data=m,e.label=`${r.label||"Multi-selection"}`,e.description=`${m.length} source(s), ${c} element(s) total`,Je.UpdateResult.Updated):Je.UpdateResult.Unchanged}}),NYe=Bt.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:re.Molecule.Structure,to:re.Molecule.Structure,params:()=>({script:C.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:C.Optional(C.Text(""))})})({apply({a:e,params:t,cache:r}){let{selection:n,entry:o}=Ps.createAndRun(e.data,t.script);r.entry=o;let i=at.unionStructure(n),a={label:`${t.label||"Selection"}`,description:De.elementDescription(i)};return new re.Molecule.Structure(i,a)},update:({a:e,b:t,oldParams:r,newParams:n,cache:o})=>{if(!To.areEqual(r.script,n.script))return Je.UpdateResult.Recreate;let i=o.entry;if(i.currentStructure===e.data)return Je.UpdateResult.Unchanged;let a=Ps.updateStructure(i,e.data);return Ps.updateStructureObject(t,a,n.label),Je.UpdateResult.Updated},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),zYe=Bt.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:re.Molecule.Structure,to:re.Molecule.Structure,params:()=>({bundle:C.Value(K.Bundle.Empty,{isHidden:!0}),label:C.Optional(C.Text("",{isHidden:!0}))})})({apply({a:e,params:t,cache:r}){if(t.bundle.hash!==e.data.hashCode)return An.Null;r.source=e.data;let n=K.Bundle.toStructure(t.bundle,e.data);if(n.elementCount===0)return An.Null;let o={label:`${t.label||"Selection"}`,description:De.elementDescription(n)};return new re.Molecule.Structure(n,o)},update:({a:e,b:t,oldParams:r,newParams:n,cache:o})=>{if(!K.Bundle.areEqual(r.bundle,n.bundle))return Je.UpdateResult.Recreate;if(n.bundle.hash!==e.data.hashCode)return Je.UpdateResult.Null;if(o.source===e.data)return Je.UpdateResult.Unchanged;o.source=e.data;let i=K.Bundle.toStructure(n.bundle,e.data);return i.elementCount===0?Je.UpdateResult.Null:(t.label=`${n.label||"Selection"}`,t.description=De.elementDescription(i),t.data=i,Je.UpdateResult.Updated)},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),_xe={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},HYe=C.objectToOptions(_xe),jYe=Bt.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:re.Molecule.Structure,to:re.Molecule.Structure,params:{type:C.Select("atomic-sequence",HYe,{isHidden:!0})}})({apply({a:e,params:t}){let r,n;switch(t.type){case"polymer":r=li.polymer.query,n="Polymer";break;case"protein":r=li.protein.query,n="Protein";break;case"nucleic":r=li.nucleic.query,n="Nucleic";break;case"water":r=Fn.internal.water(),n="Water";break;case"branched":r=li.branchedPlusConnected.query,n="Branched";break;case"ligand":r=li.ligandPlusConnected.query,n="Ligand";break;case"non-standard":r=li.nonStandardPolymer.query,n="Non-standard";break;case"coarse":r=li.coarse.query,n="Coarse";break;case"atomic-sequence":r=Fn.internal.atomicSequence(),n="Sequence";break;case"atomic-het":r=Fn.internal.atomicHet(),n="HET Groups/Ligands";break;case"spheres":r=Fn.internal.spheres(),n="Coarse Spheres";break;default:Rr(t.type)}let o=r(new ai(e.data)),i=at.unionStructure(o);return i.elementCount===0?An.Null:new re.Molecule.Structure(i,{label:n,description:De.elementDescription(i)})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),gj=Bt.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:re.Molecule.Structure,to:re.Molecule.Structure,params:_be})({apply({a:e,params:t,cache:r}){return CI(e.data,t,r)},update:({a:e,b:t,oldParams:r,newParams:n,cache:o})=>Rbe(e.data,t,r,n,o),dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),w_=Bt.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:re.Molecule.Model,to:re.Molecule.Model,params:(e,t)=>t.customModelProperties.getParams(e?.data)})({apply({a:e,params:t},r){return Pe.create("Custom Props",async n=>(await Txe(e.data,r,n,t),new re.Molecule.Model(e.data,{label:e.label,description:e.description})))},update({a:e,b:t,oldParams:r,newParams:n},o){return Pe.create("Custom Props",async i=>{t.data=e.data,t.label=e.label,t.description=e.description;for(let a of r.autoAttach){let s=o.customModelProperties.get(a);s&&e.data.customProperties.reference(s.descriptor,!1)}return await Txe(e.data,o,i,n),Je.UpdateResult.Updated})},dispose({b:e}){e?.data.customProperties.dispose()}});async function Txe(e,t,r,n){let o={runtime:r,assetManager:t.managers.asset,errorContext:t.errorContext},{autoAttach:i,properties:a}=n;for(let s of Object.keys(a)){let l=t.customModelProperties.get(s),u=a[s];if(i.includes(s)||l.isHidden)try{await l.attach(o,e,u,!0)}catch(c){t.log.warn(`Error attaching model prop '${s}': ${c}`)}else l.set(e,u)}}var E_=Bt.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:re.Molecule.Structure,to:re.Molecule.Structure,params:(e,t)=>t.customStructureProperties.getParams(e?.data.root)})({apply({a:e,params:t},r){return Pe.create("Custom Props",async n=>(await Pxe(e.data.root,r,n,t),new re.Molecule.Structure(e.data,{label:e.label,description:e.description})))},update({a:e,b:t,oldParams:r,newParams:n},o){return e.data!==t.data?Je.UpdateResult.Recreate:Pe.create("Custom Props",async i=>{t.data=e.data,t.label=e.label,t.description=e.description;for(let a of r.autoAttach){let s=o.customStructureProperties.get(a);s&&e.data.customPropertyDescriptors.reference(s.descriptor,!1)}return await Pxe(e.data.root,o,i,n),Je.UpdateResult.Updated})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}});async function Pxe(e,t,r,n){let o={runtime:r,assetManager:t.managers.asset,errorContext:t.errorContext},{autoAttach:i,properties:a}=n;for(let s of Object.keys(a)){let l=t.customStructureProperties.get(s),u=a[s];if(i.includes(s)||l.isHidden)try{await l.attach(o,e,u,!0)}catch(c){t.log.warn(`Error attaching structure prop '${s}': ${c}`)}else l.set(e,u)}}var WYe=Bt.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:re.Format.Ply,to:re.Shape.Provider,params(e){return{transforms:C.Optional(C.Value([],{isHidden:!0})),label:C.Optional(C.Text("",{isHidden:!0}))}}})({apply({a:e,params:t}){return Pe.create("Create shape from PLY",async r=>{let n=await Eye(e.data,t).runInContext(r),o={label:t.label||"Shape"};return new re.Shape.Provider(n,o)})}});var vj={};Bi(vj,{AssignColorVolume:()=>JYe,VolumeFromCcp4:()=>bj,VolumeFromCube:()=>qYe,VolumeFromDensityServerCif:()=>xj,VolumeFromDsn6:()=>ZYe,VolumeFromDx:()=>YYe,VolumeFromSegmentationCif:()=>KYe,VolumeInstances:()=>Sj,VolumeTransform:()=>Cj});function XYe(e){return e.originX===0&&e.originY===0&&e.originZ===0?b.create(e.NCSTART,e.NRSTART,e.NSSTART):b.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}function QYe(e){let t=u7(e);switch(t){case Ul.Float32:return Float32Array;case Ul.Int8:return Int8Array;case Ul.Int16:return Int16Array;case Ul.Uint16:return Uint16Array}throw Error(`${t} is not a supported value format.`)}function Rxe(e,t){return Pe.create("Create Volume",async r=>{let{header:n,values:o}=e,i=b.create(n.xLength,n.yLength,n.zLength);t&&t.voxelSize&&b.mul(i,i,t.voxelSize);let a=b.create(vr(n.alpha),vr(n.beta),vr(n.gamma)),s=n.ISPG>65536?0:n.ISPG,l=Yi.create(s||"P 1",i,a),u=b.create(n.MAPC-1,n.MAPR-1,n.MAPS-1),c=xr.convertToCanonicalAxisIndicesFastToSlow(u),m=[n.NX,n.NY,n.NZ],d=c([n.NC,n.NR,n.NS]),p=XYe(n);t?.offset&&b.add(p,p,t.offset);let h=c(p),f=b.create(h[0]/m[0],h[1]/m[1],h[2]/m[2]),y=b.create(d[0]/m[0],d[1]/m[1],d[2]/m[2]),g=xr.Space(d,xr.invertAxisOrder(u),QYe(n)),x=xr.create(g,xr.Data1(o)),S=n.AMIN===0&&n.AMAX===0&&n.AMEAN===0&&n.ARMS===0;return{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:l,fractionalBox:ut.create(f,b.add(b.zero(),f,y))},cells:x,stats:{min:isNaN(n.AMIN)||S?tb(o):n.AMIN,max:isNaN(n.AMAX)||S?ol(o):n.AMAX,mean:isNaN(n.AMEAN)||S?rb(o):n.AMEAN,sigma:isNaN(n.ARMS)||n.ARMS===0?nb(o):n.ARMS}},instances:[{transform:Z.identity()}],sourceData:Dxe.create(e),customProperties:new ka,_propertyData:Object.create(null)}})}var Dxe;(r=>{function e(n){return n?.kind==="ccp4"}r.is=e;function t(n){return{kind:"ccp4",name:n.name,data:n}}r.create=t})(Dxe||={});function wxe(e,t){return Pe.create("Create Volume",async r=>{let{header:n,values:o}=e,i=b.create(n.xlen,n.ylen,n.zlen);t&&t.voxelSize&&b.mul(i,i,t.voxelSize);let a=b.create(vr(n.alpha),vr(n.beta),vr(n.gamma)),s=Yi.create("P 1",i,a),l=[n.xRate,n.yRate,n.zRate],u=[n.xExtent,n.yExtent,n.zExtent],c=[n.xStart,n.yStart,n.zStart],m=b.create(c[0]/l[0],c[1]/l[1],c[2]/l[2]),d=b.create(u[0]/l[0],u[1]/l[1],u[2]/l[2]),p=xr.Space(u,[0,1,2],Float32Array),h=xr.create(p,xr.Data1(o));return{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:s,fractionalBox:ut.create(m,b.add(b.zero(),m,d))},cells:h,stats:{min:tb(o),max:ol(o),mean:rb(o),sigma:n.sigma!==void 0?n.sigma:nb(o)}},instances:[{transform:Z.identity()}],sourceData:Exe.create(e),customProperties:new ka,_propertyData:Object.create(null)}})}var Exe;(r=>{function e(n){return n?.kind==="dsn6"}r.is=e;function t(n){return{kind:"dsn6",name:n.name,data:n}}r.create=t})(Exe||={});function Mxe(e,t){return Pe.create("Create Volume",async()=>{let{header:r,values:n}=e,o=xr.Space(r.dim,[0,1,2],Float64Array),i=xr.create(o,xr.Data1(n)),a=Z.fromTranslation(Z(),r.min),s=Z.fromScaling(Z(),r.h);return Z.mul(a,a,s),{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:a},cells:i,stats:{min:tb(n),max:ol(n),mean:rb(n),sigma:nb(n)}},instances:[{transform:Z.identity()}],sourceData:Bxe.create(e),customProperties:new ka,_propertyData:Object.create(null)}})}var Bxe;(r=>{function e(n){return n?.kind==="dx"}r.is=e;function t(n){return{kind:"dx",name:n.name,data:n}}r.create=t})(Bxe||={});function kxe(e,t){return Pe.create("Create Segmentation Volume",async r=>{let{volume_data_3d_info:n,segmentation_data_3d:o}=e,i=Yi.create(n.spacegroup_number.value(0),b.ofArray(n.spacegroup_cell_size.value(0)),b.scale(b(),b.ofArray(n.spacegroup_cell_angles.value(0)),Math.PI/180)),a=n.axis_order.value(0),s=xr.convertToCanonicalAxisIndicesFastToSlow(a),l=s(n.sample_count.value(0)),u=xr.Space(l,xr.invertAxisOrder(a),Float32Array),c=xr.create(u,xr.Data1(o.values.toArray({array:Float32Array}))),m=b.ofArray(s(n.origin.value(0))),d=b.ofArray(s(n.dimensions.value(0))),p={label:t?.label,entryId:void 0,grid:{transform:{kind:"spacegroup",cell:i,fractionalBox:ut.create(m,b.add(b(),m,d))},cells:c,stats:{min:0,max:1,mean:0,sigma:1}},instances:[{transform:Z.identity()}],sourceData:Lxe.create(e),customProperties:new ka,_propertyData:{ownerId:t?.ownerId}};Ve.PickingGranularity.set(p,"object");let h=new Map,f=new Map,{segment_id:y,set_id:g}=e.segmentation_data_table;for(let R=0,k=y.rowCount;R<k;++R){let B=y.value(R),L=g.value(R);L===0||B===0||(f.has(L)||f.set(L,new Set),f.get(L).add(B))}f.forEach((R,k)=>{R.forEach(B=>{h.has(B)||h.set(B,new Set),h.get(B).add(k)})});let x=[0,0,0],S=c.space.getCoords,I=c.data,[v,A,_]=p.grid.cells.space.dimensions,T=v-1,w=A-1,D=_-1,M={};f.forEach((R,k)=>{M[k]=[T,w,D,-1,-1,-1]});for(let R=0,k=I.length;R<k;++R){let B=I[R];if(B===0)continue;S(R,x);let L=M[B];x[0]<L[0]&&(L[0]=x[0]),x[1]<L[1]&&(L[1]=x[1]),x[2]<L[2]&&(L[2]=x[2]),x[0]>L[3]&&(L[3]=x[0]),x[1]>L[4]&&(L[4]=x[1]),x[2]>L[5]&&(L[5]=x[2])}let E={};return h.forEach((R,k)=>{E[k]=ut.create(b.create(T,w,D),b.create(-1,-1,-1))}),gi(M,(R,k)=>{f.get(parseInt(k)).forEach(B=>{let L=E[B];R[0]<L.min[0]&&(L.min[0]=R[0]),R[1]<L.min[1]&&(L.min[1]=R[1]),R[2]<L.min[2]&&(L.min[2]=R[2]),R[3]>L.max[0]&&(L.max[0]=R[3]),R[4]>L.max[1]&&(L.max[1]=R[4]),R[5]>L.max[2]&&(L.max[2]=R[5])})}),Ve.Segmentation.set(p,{segments:h,sets:f,bounds:E,labels:t?.segmentLabels??{}}),p})}var Lxe;(r=>{function e(n){return n?.kind==="segcif"}r.is=e;function t(n){return{kind:"segcif",name:n._name,data:n}}r.create=t})(Lxe||={});var bj=Bt.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:re.Format.Ccp4,to:re.Volume.Data,params(e){return{voxelSize:C.Vec3(b.create(1,1,1)),offset:C.Vec3(b.create(0,0,0)),entryId:C.Text("")}}})({apply({a:e,params:t}){return Pe.create("Create volume from CCP4/MRC/MAP",async r=>{let n=await Rxe(e.data,{...t,label:e.data.name||e.label}).runInContext(r),o={label:n.label||"Volume",description:`Volume ${e.data.header.NX}\xD7${e.data.header.NX}\xD7${e.data.header.NX}`};return new re.Volume.Data(n,o)})},dispose({b:e}){e?.data.customProperties.dispose()}}),ZYe=Bt.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:re.Format.Dsn6,to:re.Volume.Data,params(e){return{voxelSize:C.Vec3(b.create(1,1,1)),entryId:C.Text("")}}})({apply({a:e,params:t}){return Pe.create("Create volume from DSN6/BRIX",async r=>{let n=await wxe(e.data,{...t,label:e.data.name||e.label}).runInContext(r),o={label:n.label||"Volume",description:`Volume ${e.data.header.xExtent}\xD7${e.data.header.yExtent}\xD7${e.data.header.zExtent}`};return new re.Volume.Data(n,o)})},dispose({b:e}){e?.data.customProperties.dispose()}}),qYe=Bt.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:re.Format.Cube,to:re.Volume.Data,params(e){return{dataIndex:e?C.Select(0,e.data.header.dataSetIds.map((r,n)=>[n,`${r}`])):C.Numeric(0),entryId:C.Text("")}}})({apply({a:e,params:t}){return Pe.create("Create volume from Cube",async r=>{let n=await Phe(e.data,{...t,label:e.data.name||e.label}).runInContext(r),o={label:n.label||"Volume",description:`Volume ${e.data.header.dim[0]}\xD7${e.data.header.dim[1]}\xD7${e.data.header.dim[2]}`};return new re.Volume.Data(n,o)})},dispose({b:e}){e?.data.customProperties.dispose()}}),YYe=Bt.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:re.Format.Dx,to:re.Volume.Data})({apply({a:e}){return Pe.create("Parse DX",async t=>{let r=await Mxe(e.data,{label:e.data.name||e.label}).runInContext(t),n={label:r.label||"Volume",description:`Volume ${e.data.header.dim[0]}\xD7${e.data.header.dim[1]}\xD7${e.data.header.dim[2]}`};return new re.Volume.Data(r,n)})},dispose({b:e}){e?.data.customProperties.dispose()}}),xj=Bt.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:re.Format.Cif,to:re.Volume.Data,params(e){if(!e)return{blockHeader:C.Optional(C.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:C.Text("")};let t=e.data.blocks.slice(1);return{blockHeader:C.Optional(C.Select(t[0]&&t[0].header,t.map(r=>[r.header,r.header]),{description:"Header of the block to parse"})),entryId:C.Text("")}}})({isApplicable:e=>e.data.blocks.length>0,apply({a:e,params:t}){return Pe.create("Parse density-server CIF",async r=>{let n=t.blockHeader||e.data.blocks[1].header,o=e.data.blocks.find(m=>m.header===n);if(!o)throw new Error(`Data block '${[n]}' not found.`);let i=mu.schema.densityServer(o),a=await zB(i,{entryId:t.entryId}).runInContext(r),[s,l,u]=a.grid.cells.space.dimensions,c={label:t.entryId??i.volume_data_3d_info.name.value(0),description:`Volume ${s}\xD7${l}\xD7${u}`};return new re.Volume.Data(a,c)})},dispose({b:e}){e?.data.customProperties.dispose()}}),KYe=Bt.BuiltIn({name:"volume-from-segmentation-cif",display:{name:"Volume from Segmentation CIF"},from:re.Format.Cif,to:re.Volume.Data,params(e){let t=e?.data.blocks.slice(1);return{blockHeader:t?C.Optional(C.Select(t[0]&&t[0].header,t.map(n=>[n.header,n.header]),{description:"Header of the block to parse"})):C.Optional(C.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),segmentLabels:C.ObjectList({id:C.Numeric(-1),label:C.Text("")},n=>`${n.id} = ${n.label}`,{description:"Mapping of segment IDs to segment labels"}),ownerId:C.Text("",{isHidden:!0,description:"Reference to the object which manages this volume"})}}})({isApplicable:e=>e.data.blocks.length>0,apply({a:e,params:t}){return Pe.create("Parse segmentation CIF",async r=>{let n=t.blockHeader||e.data.blocks[1].header,o=e.data.blocks.find(d=>d.header===n);if(!o)throw new Error(`Data block '${[n]}' not found.`);let i=mu.schema.segmentation(o),a={};for(let d of t.segmentLabels)a[d.id]=d.label;let s=await kxe(i,{segmentLabels:a,ownerId:t.ownerId}).runInContext(r),[l,u,c]=s.grid.cells.space.dimensions,m={label:i.volume_data_3d_info.name.value(0),description:`Segmentation ${l}\xD7${u}\xD7${c}`};return new re.Volume.Data(s,m)})},dispose({b:e}){e?.data.customProperties.dispose()}}),JYe=Bt.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:re.Volume.Data,to:re.Volume.Data,isDecorator:!0,params(e,t){if(!e)return{ref:C.Text()};let r=t.state.data.select(er.Generators.root.subtree().ofType(re.Volume.Data).filter(n=>!!n.obj&&!n.obj?.data.colorVolume&&n.obj!==e));return r.length===0?{ref:C.Text("",{isHidden:!0})}:{ref:C.Select(r[0].transform.ref,r.map(n=>[n.transform.ref,n.obj.label]))}}})({apply({a:e,params:t,dependencies:r}){return Pe.create("Assign Color Volume",async n=>{if(!r||!r[t.ref])throw new Error("Dependency not available.");let o=r[t.ref].data,i={...e.data,colorVolume:o},a={label:e.label,description:"Volume + Colors"};return new re.Volume.Data(i,a)})}}),Cj=Bt.BuiltIn({name:"volume-transform",display:{name:"Transform Volume"},isDecorator:!0,from:re.Volume.Data,to:re.Volume.Data,params:{transform:TI}})({canAutoUpdate(){return!1},apply({a:e,params:t}){let r=AI(t.transform),n={kind:"matrix",matrix:Z.mul(Z(),r,Xn.getGridToCartesianTransform(e.data.grid))};return new re.Volume.Data({...e.data,grid:{...e.data.grid,transform:n}},{label:e.label,description:`${e.description} [Transformed]`})}}),Sj=Bt.BuiltIn({name:"volume-instances",display:{name:"Volume Instances"},isDecorator:!0,from:re.Volume.Data,to:re.Volume.Data,params:{transforms:C.ObjectList({transform:TI},()=>"Transform")}})({canAutoUpdate(){return!0},apply({a:e,params:t}){return t.transforms.map(n=>({transform:AI(n.transform)})).length?new re.Volume.Data({...e.data,instances:t.transforms.map(n=>({transform:AI(n.transform)}))},{label:e.label,description:`${e.description} [Instanced]`}):e}});var Wj={};Bi(Wj,{ClippingStructureRepresentation3DFromBundle:()=>p$e,ClippingStructureRepresentation3DFromScript:()=>d$e,EmissiveStructureRepresentation3DFromBundle:()=>u$e,EmissiveStructureRepresentation3DFromScript:()=>l$e,ExplodeStructureRepresentation3D:()=>r$e,ModelUnitcell3D:()=>g$e,OverpaintStructureRepresentation3DFromBundle:()=>i$e,OverpaintStructureRepresentation3DFromScript:()=>o$e,ShapeRepresentation3D:()=>h$e,SpinStructureRepresentation3D:()=>n$e,StructureBoundingBox3D:()=>y$e,StructureRepresentation3D:()=>dd,StructureSelectionsAngle3D:()=>x$e,StructureSelectionsDihedral3D:()=>C$e,StructureSelectionsDistance3D:()=>b$e,StructureSelectionsLabel3D:()=>S$e,StructureSelectionsOrientation3D:()=>v$e,StructureSelectionsPlane3D:()=>I$e,SubstanceStructureRepresentation3DFromBundle:()=>m$e,SubstanceStructureRepresentation3DFromScript:()=>c$e,ThemeStrengthRepresentation3D:()=>f$e,TransparencyStructureRepresentation3DFromBundle:()=>s$e,TransparencyStructureRepresentation3DFromScript:()=>a$e,UnwindStructureAssemblyRepresentation3D:()=>t$e,VolumeRepresentation3D:()=>jj,VolumeRepresentation3DHelpers:()=>Cf});var ld;(r=>{function e(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}}r.create=e;function t(n){n.updateTransform=!1,n.updateMatrix=!1,n.updateColor=!1,n.updateSize=!1,n.createGeometry=!1,n.createNew=!1}r.reset=t})(ld||={});var $Ye={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function Ij(e,t={}){let r={...$Ye,...t},n=e.elementCount*r.elementCountFactor;return(e.isCoarseGrained||e.isCoarse)&&(n*=r.coarseGrainedFactor),n>r.lowestElementCount?"lowest":n>r.lowerElementCount?"lower":n>r.lowElementCount?"low":n>r.mediumElementCount?"medium":n>r.highElementCount?"high":"higher"}function eKe(e){if(e.root.models.length===1){let t=wo.Provider.get(e.root.model);if(t&&t.spacegroup.name==="P 1"&&!Yi.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return ut.volume(e.root.boundary.box)}function M_(e,t){let r=Wi(e.quality,"auto"),n=Wi(e.detail,1),o=Wi(e.radialSegments,12),i=Wi(e.linearSegments,8),a=Wi(e.resolution,2),s=Wi(e.imageResolution,1),l=Wi(e.probePositions,12),u=Wi(e.doubleSided,!0),c=0;if(r==="auto"){if(t instanceof De)r=Ij(t.root),c=eKe(t);else if(Ve.is(t)){let[m,d,p]=t.grid.cells.space.dimensions;c=m*d*p,r=c<1e7?"medium":"low"}}switch(r){case"highest":n=3,o=36,i=18,a=.1,s=.01,l=72,u=!0;break;case"higher":n=3,o=28,i=14,a=.3,s=.05,l=48,u=!0;break;case"high":n=2,o=20,i=10,a=.5,s=.1,l=36,u=!0;break;case"medium":n=1,o=12,i=8,a=.8,s=.2,l=24,u=!0;break;case"low":n=0,o=8,i=3,a=1.3,s=.4,l=24,u=!1;break;case"lower":n=0,o=4,i=2,a=3,s=.7,l=12,u=!1;break;case"lowest":n=0,o=2,i=1,a=8,s=1,l=12,u=!1;break;case"custom":break}return c>0&&(a=Math.max(a,c/3e8),a=Math.min(a,20)),e.transparentBackfaces==="off"&&(e.alpha!==void 0&&e.alpha<1||e.xrayShaded)&&(u=!1),{detail:n,radialSegments:o,linearSegments:i,resolution:a,imageResolution:s,probePositions:l,doubleSided:u}}var Wo;(i=>{i.is=na.has,i.All=63,i.Highlighting=35,i.Selecting=60;function o(a,s){return a===1&&s===2||a===2&&s===1||a===4&&s===8||a===8&&s===4||a===16&&s===16}i.isReverse=o})(Wo||={});function Fxe(e,t,r){e.fill(t,0,r)}function Aj(e,t,r){switch(r){case 1:e[t]|=1;break;case 2:e[t]&=-2;break;case 4:e[t]|=2;break;case 8:e[t]&=-3;break;case 16:e[t]^=2;break;case 32:e[t]=0;break}}function wx(e,t,r){if(r===0)return!1;if(xe.is(t)){let n=xe.start(t),o=xe.end(t),i=n+3>>2,a=i+(o-4*i>>2);if(a<=i){for(let d=n;d<o;++d)Aj(e,d,r);return!0}let s=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),l=n,u=Math.min(4*i,o),c=Math.max(n,4*a),m=o;switch(r){case 1:for(let d=i;d<a;++d)s[d]|=16843009;break;case 2:for(let d=i;d<a;++d)s[d]&=-16843010;break;case 4:for(let d=i;d<a;++d)s[d]|=33686018;break;case 8:for(let d=i;d<a;++d)s[d]&=-33686019;break;case 16:for(let d=i;d<a;++d)s[d]^=33686018;break;case 32:for(let d=i;d<a;++d)s[d]=0;break;default:Rr(r)}for(let d=l;d<u;++d)Aj(e,d,r);for(let d=c;d<m;++d)Aj(e,d,r)}else switch(r){case 1:for(let n=0,o=t.length;n<o;++n)e[t[n]]|=1;break;case 2:for(let n=0,o=t.length;n<o;++n)e[t[n]]&=-2;break;case 4:for(let n=0,o=t.length;n<o;++n)e[t[n]]|=2;break;case 8:for(let n=0,o=t.length;n<o;++n)e[t[n]]&=-3;break;case 16:for(let n=0,o=t.length;n<o;++n)e[t[n]]^=2;break;case 32:for(let n=0,o=t.length;n<o;++n)e[t[n]]=0;break;default:Rr(r)}return!0}function Vxe(e,t){let r=-1,n=-1;switch(e){case 1:t===0||t===1?(r=1,n=1):t===2||t===3?(r=1,n=3):r=1;break;case 2:t===0||t===1?(r=0,n=0):(t===2||t===3)&&(r=1,n=2);break;case 4:t===1||t===3?(r=1,n=3):t===0||t===2?(r=1,n=2):r=1;break;case 8:t===1||t===3?(r=1,n=1):(t===0||t===2)&&(r=0,n=0);break;case 16:t===1?(r=1,n=3):t===2?(r=0,n=0):t===3?(r=1,n=1):t===0&&(r=1,n=2);break;case 32:r=0,n=0;break}return{average:r,status:n}}function Oxe(e,t){switch(e){case 1:return .5;case 2:return t===0?0:t===2||t===3?.5:-1;case 4:return .5;case 8:return t===1||t===3?.5:t===0?0:-1;case 16:return t===-1?-1:.5;case 32:return t===-1?-1:t===0?0:.5;case 0:return-1;default:Rr(e)}}var Uh={kind:"every-loci"};function Ji(e){return!!e&&e.kind==="every-loci"}var dr={kind:"empty-loci"};function Ii(e){return!!e&&e.kind==="empty-loci"}function iS(e){return!!e&&e.kind==="data-loci"}function tKe(e,t){if(!Ng(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(let r=0,n=e.elements.length;r<n;++r)if(!Ng(e.elements[r],t.elements[r]))return!1;return!0}function rKe(e){return e.elements.length===0}function Ex(e,t,r,n,o){return{kind:"data-loci",tag:e,data:t,elements:r,getBoundingSphere:n,getLabel:o}}var Jt;(f=>{let e=new Ci("98");function t(y){let g=y.loci.map(x=>a(x)).filter(x=>!!x);e.reset();for(let x of g)e.includePositionRadius(x.center,x.radius);e.finishedIncludeStep();for(let x of g)e.radiusPositionRadius(x.center,x.radius);return e.getSphere()}f.getBundleBoundingSphere=t;function r(y,g){return Ji(y)&&Ji(g)||Ii(y)&&Ii(g)?!0:iS(y)&&iS(g)?tKe(y,g):De.isLoci(y)&&De.isLoci(g)?De.areLociEqual(y,g):K.Loci.is(y)&&K.Loci.is(g)?K.Loci.areEqual(y,g):Ct.isLoci(y)&&Ct.isLoci(g)?Ct.areLociEqual(y,g):Gr.isLoci(y)&&Gr.isLoci(g)?Gr.areLociEqual(y,g):js.isLoci(y)&&js.isLoci(g)?js.areLociEqual(y,g):Ve.isLoci(y)&&Ve.isLoci(g)?Ve.areLociEqual(y,g):Ve.Isosurface.isLoci(y)&&Ve.Isosurface.isLoci(g)?Ve.Isosurface.areLociEqual(y,g):Ve.Cell.isLoci(y)&&Ve.Cell.isLoci(g)?Ve.Cell.areLociEqual(y,g):Ve.Segment.isLoci(y)&&Ve.Segment.isLoci(g)?Ve.Segment.areLociEqual(y,g):!1}f.areEqual=r;function n(y){return!!y&&y.kind==="every-loci"}f.isEvery=n;function o(y){return Ji(y)?!1:Ii(y)?!0:iS(y)?rKe(y):De.isLoci(y)?De.isLociEmpty(y):K.Loci.is(y)?K.Loci.isEmpty(y):Ct.isLoci(y)?Ct.isLociEmpty(y):Gr.isLoci(y)?Gr.isLociEmpty(y):js.isLoci(y)?js.isLociEmpty(y):Ve.isLoci(y)?Ve.isLociEmpty(y):Ve.Isosurface.isLoci(y)?Ve.Isosurface.isLociEmpty(y):Ve.Cell.isLoci(y)?Ve.Cell.isLociEmpty(y):Ve.Segment.isLoci(y)?Ve.Segment.isLociEmpty(y):!1}f.isEmpty=o;function i(y,g){return g instanceof De&&(K.Loci.is(y)?y=K.Loci.remap(y,g):De.isLoci(y)?y=De.remapLoci(y,g):Ct.isLoci(y)&&(y=Ct.remapLoci(y,g))),y}f.remap=i;function a(y,g){if(!(y.kind==="every-loci"||y.kind==="empty-loci")){if(g||(g=ye()),y.kind==="structure-loci")return ye.copy(g,y.structure.boundary.sphere);if(y.kind==="element-loci")return ye.copy(g,K.Loci.getBoundary(y).sphere);if(y.kind==="bond-loci")return Ct.getBoundingSphere(y,g);if(y.kind==="shape-loci")return ye.copy(g,y.shape.geometry.boundingSphere);if(y.kind==="group-loci")return js.getBoundingSphere(y,g);if(y.kind==="data-loci")return y.getBoundingSphere?.(g);if(y.kind==="volume-loci")return Ve.getBoundingSphere(y.volume,g);if(y.kind==="isosurface-loci")return Ve.Isosurface.getBoundingSphere(y.volume,y.isoValue,g);if(y.kind==="cell-loci")return Ve.Cell.getBoundingSphere(y.volume,y.elements,g);if(y.kind==="segment-loci")return Ve.Segment.getBoundingSphere(y.volume,y.elements,g)}}f.getBoundingSphere=a;let s=ye.zero();function l(y,g){let x=a(y,s);return x?b.copy(g||b(),x.center):void 0}f.getCenter=l;function u(y){if(!(y.kind==="every-loci"||y.kind==="empty-loci")){if(y.kind==="structure-loci")return K.Loci.getPrincipalAxes(De.toStructureElementLoci(y.structure));if(y.kind==="element-loci")return K.Loci.getPrincipalAxes(y);if(y.kind==="bond-loci")return;if(y.kind==="shape-loci")return;if(y.kind==="group-loci")return;if(y.kind==="data-loci")return;if(y.kind==="volume-loci")return;if(y.kind==="isosurface-loci")return;if(y.kind==="cell-loci")return;if(y.kind==="segment-loci")return}}f.getPrincipalAxes=u;let c={element:y=>y,residue:y=>K.Loci.is(y)?K.Loci.extendToWholeResidues(y,!0):y,chain:y=>K.Loci.is(y)?K.Loci.extendToWholeChains(y):y,entity:y=>K.Loci.is(y)?K.Loci.extendToWholeEntities(y):y,model:y=>K.Loci.is(y)?K.Loci.extendToWholeModels(y):y,operator:y=>K.Loci.is(y)?K.Loci.extendToWholeOperators(y):y,structure:y=>K.Loci.is(y)?De.toStructureElementLoci(y.structure):js.isLoci(y)?Gr.Loci(y.shape):Ve.Cell.isLoci(y)?Ve.Loci(y.volume,xe.ofLength(y.volume.instances.length)):Ve.Isosurface.isLoci(y)?Ve.Loci(y.volume,xe.ofLength(y.volume.instances.length)):y,elementInstances:y=>K.Loci.is(y)?K.Loci.extendToAllInstances(y):y,residueInstances:y=>K.Loci.is(y)?K.Loci.extendToAllInstances(K.Loci.extendToWholeResidues(y,!0)):y,chainInstances:y=>K.Loci.is(y)?K.Loci.extendToAllInstances(K.Loci.extendToWholeChains(y)):y};f.GranularityOptions=C.objectToOptions(c,y=>{switch(y){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return y.indexOf("Instances")?[ta(y),"With Symmetry"]:ta(y)}});function d(y){return y.replace("Instances","")}f.simpleGranularity=d;function p(y,g){return c[g](y)}f.applyGranularity=p;function h(y,g,x=!1){return(g!=="element"||x)&&Ct.isLoci(y)&&(y=Ct.toStructureElementLoci(y)),De.isLoci(y)&&(y=De.toStructureElementLoci(y.structure)),K.Loci.is(y)&&(y=K.Loci.remap(y,y.structure.root)),g&&(y=p(y,g)),y}f.normalize=h})(Jt||={});var _k=nKe();function nKe(){let e=new ArrayBuffer(4),t=new Float32Array(e),r=new Uint32Array(e),n=new Uint32Array(512),o=new Uint32Array(512);for(let l=0;l<256;++l){let u=l-127;u<-27?(n[l]=0,n[l|256]=32768,o[l]=24,o[l|256]=24):u<-14?(n[l]=1024>>-u-14,n[l|256]=1024>>-u-14|32768,o[l]=-u-1,o[l|256]=-u-1):u<=15?(n[l]=u+15<<10,n[l|256]=u+15<<10|32768,o[l]=13,o[l|256]=13):u<128?(n[l]=31744,n[l|256]=64512,o[l]=24,o[l|256]=24):(n[l]=31744,n[l|256]=64512,o[l]=13,o[l|256]=13)}let i=new Uint32Array(2048),a=new Uint32Array(64),s=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,c=0;for(;(u&8388608)===0;)u<<=1,c-=8388608;u&=-8388609,c+=947912704,i[l]=u|c}for(let l=1024;l<2048;++l)i[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(s[l]=1024);return{floatView:t,uint32View:r,baseTable:n,shiftTable:o,mantissaTable:i,exponentTable:a,offsetTable:s}}function sp(e){e=Br(e,-65504,65504),_k.floatView[0]=e;let t=_k.uint32View[0],r=t>>23&511;return _k.baseTable[r]+((t&8388607)>>_k.shiftTable[r])}var Rk=b.set,Gxe=b.normalize,Uxe=b.sub,Nxe=b.addScalar,Dk=b.scale,wk=b.toArray;function Nh(e,t,r,n){let o=!1,i=t.grid.cells.data.length;if(Ve.isLoci(e)){if(!Ve.areEquivalent(e.volume,t))return!1;if(xe.is(e.instances)){let a=xe.start(e.instances)*i,s=xe.end(e.instances)*i;n(xe.ofBounds(a,s))&&(o=!0)}else for(let a=0,s=e.instances.length;a<s;++a){let l=e.instances[a]*i;n(xe.ofBounds(l,l+i))&&(o=!0)}}else if(Ve.Isosurface.isLoci(e)){if(!Ve.areEquivalent(e.volume,t))return!1;if(r?.isoValue){if(!Ve.IsoValue.areSame(e.isoValue,r.isoValue,t.grid.stats))return!1;if(xe.is(e.instances)){let a=xe.start(e.instances)*i,s=xe.end(e.instances)*i;n(xe.ofBounds(a,s))&&(o=!0)}else for(let a=0,s=e.instances.length;a<s;++a){let l=e.instances[a]*i;n(xe.ofBounds(l,l+i))&&(o=!0)}}else{let{stats:a,cells:{data:s}}=t.grid,l=a.sigma,u=Ve.IsoValue.toAbsolute(e.isoValue,a).absoluteValue;for(let c=0,m=s.length;c<m;++c)eo(u,s[c],l)&&Se.forEach(e.instances,d=>{let p=d*i;n(xe.ofSingleton(p+c))&&(o=!0)})}}else if(Ve.Cell.isLoci(e)){if(!Ve.areEquivalent(e.volume,t))return!1;for(let{indices:a,instances:s}of e.elements)xe.is(a)?Se.forEach(s,l=>{let u=l*i;n(xe.offset(a,u))&&(o=!0)}):Se.forEach(a,l=>{Se.forEach(s,u=>{let c=u*i;n(xe.ofSingleton(c+l))&&(o=!0)})})}else if(Ve.Segment.isLoci(e)){if(!Ve.areEquivalent(e.volume,t))return!1;if(r?.segments)for(let{segments:a,instances:s}of e.elements)Se.areIntersecting(a,r.segments)&&Se.forEach(s,l=>{let u=l*i;n(xe.ofBounds(u,u+i))&&(o=!0)});else{let a=Ve.Segmentation.get(t);if(a){let s=new Set;for(let{segments:l,instances:u}of e.elements){for(let d=0,p=Se.size(l);d<p;d++){let h=Se.getAt(l,d);no.add(s,a.segments.get(h))}let c=Array.from(s.values()),m=t.grid.cells.data;for(let d=0,p=m.length;d<p;++d)if(c.includes(m[d]))for(let h=0,f=Se.size(u);h<f;h++){let y=h*i;n(xe.ofSingleton(d+y))&&(o=!0)}}}}}return o}function lp(e){let[t,r,n]=e.grid.cells.space.dimensions,o=t*r*n,i=e.instances.length,a=Ve.Cell.Location(e);return Kr(o,i,1,(l,u)=>(a.cell=l,a.instance=u,a))}function up(e,t=0){let r=e[0]*e[1]*e[2],n=Math.sqrt(r),o=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))),i=e[0]+t,a=e[1]+t,s=1,l=i;return o<i*e[2]?(l=Math.floor(o/i),s=Math.ceil(e[2]/l),i*=l,a*=s):i*=e[2],{width:i,height:a,columns:l,rows:s,powerOfTwoSize:a<o?o:o*2}}function Ek(e,t,r=0,n="byte"){let{cells:{space:o,data:i},stats:{max:a,min:s}}=e.grid,l=o.dimensions,{dataOffset:u}=o,{width:c,height:m}=up(l,r),d=t==="data"?1:4,p=n==="byte"?new Uint8Array(c*m*d):n==="halfFloat"?new Uint16Array(c*m*d):new Float32Array(c*m*d),h={array:p,width:c,height:m},f=a-s,[y,g,x]=l,S=y+r,I=g+r,v=b(),A=b(),_=y-1,T=g-1,w=x-1;for(let D=0;D<x;++D)for(let M=0;M<g;++M)for(let E=0;E<y;++E){let R=Math.floor(D*S%c/S),k=Math.floor(D*S/c),B=R*S+E,L=d*(k*I*c+M*c+B),V=u(E,M,D),U;if(n==="byte"?U=Math.round((i[V]-s)/f*255):n==="halfFloat"?U=sp((i[V]-s)/f):U=(i[V]-s)/f,t==="data")p[L]=U;else{if(t==="groups")if(n==="halfFloat"){let Q=Br(Math.round(V),0,16777215)+1;p[L+2]=sp(Q%256),Q=Math.floor(Q/256),p[L+1]=sp(Q%256),Q=Math.floor(Q/256),p[L]=sp(Q%256)}else df(V,p,L);else Rk(v,i[u(Math.max(0,E-1),M,D)],i[u(E,Math.max(0,M-1),D)],i[u(E,M,Math.max(0,D-1))]),Rk(A,i[u(Math.min(_,E+1),M,D)],i[u(E,Math.min(T,M+1),D)],i[u(E,M,Math.min(w,D+1))]),Gxe(v,Uxe(v,v,A)),Nxe(v,Dk(v,v,.5),.5),n==="byte"?wk(Dk(v,v,255),p,L):n==="halfFloat"?(p[L]=sp(v[0]),p[L+1]=sp(v[1]),p[L+2]=sp(v[2])):wk(v,p,L);p[L+3]=U}}return h}function zxe(e,t="byte"){let{cells:{space:r,data:n},stats:{max:o,min:i}}=e.grid,[a,s,l]=r.dimensions,{dataOffset:u}=r,c=t==="byte"?new Uint8Array(a*s*l*4):t==="halfFloat"?new Uint16Array(a*s*l*4):new Float32Array(a*s*l*4),m={array:c,width:a,height:s,depth:l},d=o-i,p=b(),h=b(),f=a-1,y=s-1,g=l-1,x=0;for(let S=0;S<l;++S)for(let I=0;I<s;++I)for(let v=0;v<a;++v){let A=u(v,I,S);Rk(p,n[u(Math.max(0,v-1),I,S)],n[u(v,Math.max(0,I-1),S)],n[u(v,I,Math.max(0,S-1))]),Rk(h,n[u(Math.min(f,v+1),I,S)],n[u(v,Math.min(y,I+1),S)],n[u(v,I,Math.min(g,S+1))]),Gxe(p,Uxe(p,p,h)),Nxe(p,Dk(p,p,.5),.5),t==="byte"?(wk(Dk(p,p,255),c,x),c[x+3]=Math.round((n[A]-i)/d*255)):t==="halfFloat"?(c[x]=sp(p[0]),c[x+1]=sp(p[1]),c[x+2]=sp(p[2]),c[x+3]=sp((n[A]-i)/d)):(wk(p,c,x),c[x+3]=(n[A]-i)/d),x+=4}return m}function Hxe(e,t,r,n=0){let o=e.grid.cells.data,i=ut.size(b(),r),a=e.grid.cells.space.dataOffset,{width:s,height:l}=up(i,n),u=1,c=new Uint8Array(s*l*u),m={array:c,width:s,height:l},[d,p,h]=i,f=d-1,y=p-1,g=h-1,x=d+n,S=p+n,[I,v,A]=r.min,[_,T,w]=r.max;for(let D=0;D<h;++D)for(let M=0;M<p;++M)for(let E=0;E<d;++E){let R=Math.floor(D*x%s/x),k=Math.floor(D*x/s),B=R*x+E,L=u*(k*S*s+M*s+B),V=t.includes(o[a(E+I,M+v,D+A)])?255:0,U=t.includes(o[a(Math.min(f+_,E+1+I),M+v,D+A)])?255:0,Q=t.includes(o[a(Math.max(0,E-1+I),M+v,D+A)])?255:0,O=t.includes(o[a(E+I,Math.min(y+T,M+1+v),D+A)])?255:0,q=t.includes(o[a(E+I,Math.max(0,M-1+v),D+A)])?255:0,X=t.includes(o[a(E+I,M+v,Math.min(g+w,D+1+A))])?255:0,F=t.includes(o[a(E+I,M+v,Math.max(0,D-1+A))])?255:0;c[L]=Math.round((V+V+U+Q+O+q+X+F)/8)}return m}function B_(e,t,r,n,o){let{colorType:i,vertexCount:a,groupCount:s,positionBuffer:l,instanceBuffer:u,transformBuffer:c,groupBuffer:m,itemSize:d}=e,p=i.endsWith("Instance"),h=ut.fromSphere3D(ut(),p?e.boundingSphere:e.invariantBoundingSphere),f=1+t,y=ut.expand(ut(),h,b.create(f,f,f)),g=1/t,x=ut.scale(ut(),y,g),S=ut.size(b(),x);b.ceil(S,S),b.add(S,S,b.create(2,2,2));let{min:I}=y,[v,A]=S,{width:_,height:T}=up(S),w=new Float32Array(_*T*d),D=new Float32Array(_*T),M=new Uint8Array(_*T*d),E={array:M,width:_,height:T,filter:"linear"},R=p?e.instanceCount:1,k=e.colorData.array;function B(Y,$,ce){let ie=Math.floor(ce*v%_/v),oe=Math.floor(ce*v/_),W=ie*v+Y;return d*(oe*A*_+$*_+W)}let L=2,[V,U,Q]=S,O=b();for(let Y=0;Y<R;++Y){let $=n?u[Y]:Y;for(let ce=0;ce<a;ce+=r){b.fromArray(O,l,ce*3),p&&b.transformMat4Offset(O,O,c,0,0,Y*16),b.sub(O,O,I),b.scale(O,O,g);let[ie,oe,W]=O,N=Math.floor(ie),j=Math.floor(oe),ue=Math.floor(W),be=($*s+m[ce])*d,ee=Math.max(0,N-L),le=Math.max(0,j-L),Ae=Math.max(0,ue-L),Ce=Math.min(V,N+L+2),J=Math.min(U,j+L+2),z=Math.min(Q,ue+L+2);for(let ae=ee;ae<Ce;++ae){let ge=ae-ie;for(let ve=le;ve<J;++ve){let Oe=ve-oe;for(let ze=Ae;ze<z;++ze){let Re=ze-W,Ke=Math.sqrt(ge*ge+Oe*Oe+Re*Re);if(Ke>L)continue;let tt=L-Ke,bt=B(ae,ve,ze);for(let Pt=0;Pt<d;++Pt)w[bt+Pt]+=k[be+Pt]*tt;D[bt/d]+=tt}}}}}for(let Y=0,$=D.length;Y<$;++Y){let ce=Y*d,ie=D[Y];for(let oe=0;oe<d;++oe)M[ce+oe]=Math.round(w[ce+oe]/ie)}let q=Ie.create(_,T),X=Ut.create(I[0],I[1],I[2],g),F=p?"volumeInstance":"volume";if(n){if(!o){let Y=d===4?"rgba":d===3?"rgb":"alpha";o=n.resources.texture("image-uint8",Y,"ubyte","linear")}return o.load(E),{kind:"volume",texture:o,gridTexDim:q,gridDim:S,gridTransform:X,type:F}}else{let Y=oKe({vertexCount:a,instanceCount:R,transformBuffer:c,positionBuffer:l,colorType:F,grid:M,gridDim:S,gridTexDim:q,gridTransform:X,vertexStride:3,colorStride:d,outputStride:d});return{kind:"vertex",texture:Y,texDim:Ie.create(Y.width,Y.height),type:p?"vertexInstance":"vertex"}}}function oKe(e){let{vertexCount:t,positionBuffer:r,transformBuffer:n,grid:o,gridDim:i,gridTexDim:a,gridTransform:s,vertexStride:l,colorStride:u}=e,c=e.itemOffset||0,m=e.outputStride;if(m+c>u)throw new Error("outputStride + itemOffset must NOT be larger than colorStride");let d=e.colorType.endsWith("Instance"),p=d?e.instanceCount:1,h=so(Math.max(1,p*t),m,Uint8Array),{array:f}=h,[y,g]=i,x=a[0],S=b.fromArray(b(),s,0),I=s[3];function v(D,M,E){let R=Math.floor(E*y%x/y),k=Math.floor(E*y/x),B=R*y+D;return u*(k*g*x+M*x+B)}let A=b(),_=b(),T=b(),w=b();for(let D=0;D<p;++D)for(let M=0;M<t;++M){b.fromArray(A,r,M*l),d&&b.transformMat4Offset(A,A,n,0,0,D*16),b.sub(A,A,S),b.scale(A,A,I),b.floor(_,A),b.ceil(T,A),b.sub(w,A,_),b.sub(A,T,_),b.div(w,w,A);let[E,R,k]=_,[B,L,V]=T,[U,Q,O]=w,q=v(E,R,k)+c,X=v(B,R,k)+c,F=v(E,R,V)+c,Y=v(B,R,V)+c,$=v(E,L,k)+c,ce=v(B,L,k)+c,ie=v(E,L,V)+c,oe=v(B,L,V)+c,W=(D*t+M)*m;for(let N=0;N<m;++N){let j=o[q+N],ue=o[X+N],be=o[F+N],ee=o[Y+N],le=o[$+N],Ae=o[ce+N],Ce=o[ie+N],J=o[oe+N],z=$n(j,ue,U),ae=$n(be,ee,U),ge=$n(le,Ae,U),ve=$n(Ce,J,U),Oe=$n(z,ge,Q),ze=$n(ae,ve,Q);f[W+N]=$n(Oe,ze,O)}}return h}function iKe(e){return e==="group"||e==="groupInstance"}function PI(e,t,r,n,o){if(!iKe(e.dColorType.ref.value))return;let i=B_({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:3},t,r,n,o);i.kind==="volume"?(P.updateIfChanged(e.dColorType,i.type),P.update(e.tColorGrid,i.texture),P.update(e.uColorTexDim,i.gridTexDim),P.update(e.uColorGridDim,i.gridDim),P.update(e.uColorGridTransform,i.gridTransform)):i.kind==="vertex"&&(P.updateIfChanged(e.dColorType,i.type),P.update(e.tColor,i.texture),P.update(e.uColorTexDim,i.texDim))}function aKe(e){return e==="groupInstance"}function jxe(e,t,r,n,o){if(!aKe(e.dOverpaintType.ref.value))return;let i=B_({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tOverpaint.ref.value,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,o);i.kind==="volume"?(P.updateIfChanged(e.dOverpaintType,i.type),P.update(e.tOverpaintGrid,i.texture),P.update(e.uOverpaintTexDim,i.gridTexDim),P.update(e.uOverpaintGridDim,i.gridDim),P.update(e.uOverpaintGridTransform,i.gridTransform)):i.kind==="vertex"&&(P.updateIfChanged(e.dOverpaintType,i.type),P.update(e.tOverpaint,i.texture),P.update(e.uOverpaintTexDim,i.texDim))}function sKe(e){return e==="groupInstance"}function Wxe(e,t,r,n,o){if(!sKe(e.dTransparencyType.ref.value))return;let i=B_({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tTransparency.ref.value,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,r,n,o);i.kind==="volume"?(P.updateIfChanged(e.dTransparencyType,i.type),P.update(e.tTransparencyGrid,i.texture),P.update(e.uTransparencyTexDim,i.gridTexDim),P.update(e.uTransparencyGridDim,i.gridDim),P.update(e.uTransparencyGridTransform,i.gridTransform)):i.kind==="vertex"&&(P.updateIfChanged(e.dTransparencyType,i.type),P.update(e.tTransparency,i.texture),P.update(e.uTransparencyTexDim,i.texDim))}function lKe(e){return e==="groupInstance"}function Xxe(e,t,r,n,o){if(!lKe(e.dEmissiveType.ref.value))return;let i=B_({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tEmissive.ref.value,colorType:e.dEmissiveType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,r,n,o);i.kind==="volume"?(P.updateIfChanged(e.dEmissiveType,i.type),P.update(e.tEmissiveGrid,i.texture),P.update(e.uEmissiveTexDim,i.gridTexDim),P.update(e.uEmissiveGridDim,i.gridDim),P.update(e.uEmissiveGridTransform,i.gridTransform)):i.kind==="vertex"&&(P.updateIfChanged(e.dEmissiveType,i.type),P.update(e.tEmissive,i.texture),P.update(e.uEmissiveTexDim,i.texDim))}function uKe(e){return e==="groupInstance"}function Qxe(e,t,r,n,o){if(!uKe(e.dSubstanceType.ref.value))return;let i=B_({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tSubstance.ref.value,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,o);i.kind==="volume"?(P.updateIfChanged(e.dSubstanceType,i.type),P.update(e.tSubstanceGrid,i.texture),P.update(e.uSubstanceTexDim,i.gridTexDim),P.update(e.uSubstanceGridDim,i.gridDim),P.update(e.uSubstanceGridTransform,i.gridTransform)):i.kind==="vertex"&&(P.updateIfChanged(e.dSubstanceType,i.type),P.update(e.tSubstance,i.texture),P.update(e.uSubstanceTexDim,i.texDim))}var Zxe=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform sampler2D tCount;
uniform vec2 uTexSize;

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);
    float count = texture2D(tCount, coords).r;

    gl_FragColor = color / count;
}
`;var qxe=`
precision highp float;

varying vec3 vPosition;
varying vec4 vColor;

uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uResolution;

const float p = 2.0;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition);
    if (dist > p) discard;

    float f = p - dist;
    gl_FragColor = vColor * f;
    gl_FragData[1] = vec4(f);
}
`;var Yxe=`
precision highp float;

#include common
#include read_from_texture

uniform int uGroupCount;

attribute float aSample;
#define SampleID int(aSample)

attribute mat4 aTransform;
attribute float aInstance;

uniform vec2 uGeoTexDim;
uniform sampler2D tPosition;
uniform sampler2D tGroup;

uniform vec2 uColorTexDim;
uniform sampler2D tColor;

varying vec3 vPosition;
varying vec4 vColor;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;
    float group = unpackRGBToInt(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);

    position = (aTransform * vec4(position, 1.0)).xyz;
    gl_PointSize = 7.0;
    vPosition = (position - uBboxMin) / uResolution;
    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);

    #if defined(dColorType_group)
        vColor = readFromTexture(tColor, group, uColorTexDim);
    #elif defined(dColorType_groupInstance)
        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim);
    #endif
}
`;var cKe={drawCount:Vn("number"),instanceCount:Vn("number"),stride:Vn("number"),uGroupCount:he("i","material"),aTransform:Sn("float32",16,1),aInstance:Sn("float32",1,1),aSample:Sn("float32",1,0),uGeoTexDim:he("v2","material"),tPosition:pt("texture","rgba","float","nearest","material"),tGroup:pt("texture","rgba","float","nearest","material"),uColorTexDim:he("v2","material"),tColor:pt("texture","rgba","ubyte","nearest","material"),dColorType:ct("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:he("f"),uCurrentX:he("f"),uCurrentY:he("f"),uBboxMin:he("v3","material"),uBboxSize:he("v3","material"),uResolution:he("f","material")},ud="color-accumulate",k_="color-count";function Kxe(e,t){let r=new Float32Array(e);for(let n=0;n<e;++n)r[n]=n*t;return r}function mKe(e,t,r,n,o){if(e.namedComputeRenderables[ud]){let i=b.sub(b(),r.max,r.min),a=e.namedComputeRenderables[ud].values,s=Math.round(t.vertexCount/o);(s>a.drawCount.ref.value||o!==a.stride.ref.value)&&P.update(a.aSample,Kxe(s,o)),P.updateIfChanged(a.drawCount,s),P.updateIfChanged(a.instanceCount,t.instanceCount),P.updateIfChanged(a.stride,o),P.updateIfChanged(a.uGroupCount,t.groupCount),P.update(a.aTransform,t.transformBuffer),P.update(a.aInstance,t.instanceBuffer),P.update(a.uGeoTexDim,Ie.set(a.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),P.update(a.tPosition,t.positionTexture),P.update(a.tGroup,t.groupTexture),P.update(a.uColorTexDim,Ie.set(a.uColorTexDim.ref.value,t.colorData.getWidth(),t.colorData.getHeight())),P.update(a.tColor,t.colorData),P.updateIfChanged(a.dColorType,t.colorType),P.updateIfChanged(a.uCurrentSlice,0),P.updateIfChanged(a.uCurrentX,0),P.updateIfChanged(a.uCurrentY,0),P.update(a.uBboxMin,r.min),P.update(a.uBboxSize,i),P.updateIfChanged(a.uResolution,n),e.namedComputeRenderables[ud].update()}else e.namedComputeRenderables[ud]=dKe(e,t,r,n,o);return e.namedComputeRenderables[ud]}function dKe(e,t,r,n,o){let i=b.sub(b(),r.max,r.min),a=Math.round(t.vertexCount/o),s={drawCount:P.create(a),instanceCount:P.create(t.instanceCount),stride:P.create(o),uGroupCount:P.create(t.groupCount),aTransform:P.create(t.transformBuffer),aInstance:P.create(t.instanceBuffer),aSample:P.create(Kxe(a,o)),uGeoTexDim:P.create(Ie.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:P.create(t.positionTexture),tGroup:P.create(t.groupTexture),uColorTexDim:P.create(Ie.create(t.colorData.getWidth(),t.colorData.getHeight())),tColor:P.create(t.colorData),dColorType:P.create(t.colorType),uCurrentSlice:P.create(0),uCurrentX:P.create(0),uCurrentY:P.create(0),uBboxMin:P.create(r.min),uBboxSize:P.create(i),uResolution:P.create(n)},l={...cKe},u=Dr("accumulate",Yxe,qxe,{drawBuffers:"required"}),c=Wr(e,"points",u,l,s);return Xr(c,s)}function pKe(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}var fKe={...un,tColor:pt("texture","rgba","float","nearest"),tCount:pt("texture","alpha","float","nearest"),uTexSize:he("v2")},L_="color-normalize";function hKe(e,t,r){if(e.namedComputeRenderables[L_]){let n=e.namedComputeRenderables[L_].values;P.update(n.tColor,t),P.update(n.tCount,r),P.update(n.uTexSize,Ie.set(n.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[L_].update()}else e.namedComputeRenderables[L_]=gKe(e,t,r);return e.namedComputeRenderables[L_]}function gKe(e,t,r){let n={...cn,tColor:P.create(t),tCount:P.create(r),uTexSize:P.create(Ie.create(t.getWidth(),t.getHeight()))},o={...fKe},i=Dr("normalize",bn,Zxe),a=Wr(e,"triangles",i,o,n);return Xr(a,n)}function yKe(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}function bKe(e){let t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),o=0,i=e[1],a=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),a=Math.ceil(e[2]/s),o=s*e[0],i*=a):o=e[0]*e[2],{texDimX:o,texDimY:i,texRows:a,texCols:s,powerOfTwoSize:i<n?n:n*2}}function F_(e,t,r,n,o){let{drawBuffers:i}=n.extensions;if(!i)throw new Error("need WebGL draw buffers");He&&n.timer.mark("calcTextureMeshColorSmoothing");let{gl:a,resources:s,state:l,extensions:{colorBufferHalfFloat:u,textureHalfFloat:c}}=n,m=e.colorType.endsWith("Instance"),d=ut.fromSphere3D(ut(),m?e.boundingSphere:e.invariantBoundingSphere),p=1+t,h=ut.expand(ut(),d,b.create(p,p,p)),f=1/t,y=ut.scale(ut(),h,f),g=ut.size(b(),y);b.ceil(g,g),b.add(g,g,b.create(2,2,2));let{min:x}=h,[S,I,v]=g,{texDimX:A,texDimY:_,texCols:T}=bKe(g);n.namedFramebuffers[ud]||(n.namedFramebuffers[ud]=n.resources.framebuffer());let w=n.namedFramebuffers[ud];Ht(a)?(n.namedTextures[ud]||(n.namedTextures[ud]=u&&c?s.texture("image-float16","rgba","fp16","nearest"):s.texture("image-float32","rgba","float","nearest")),n.namedTextures[k_]||(n.namedTextures[k_]=s.texture("image-float32","alpha","float","nearest"))):(n.namedTextures[ud]||(n.namedTextures[ud]=s.texture("image-float32","rgba","float","nearest")),n.namedTextures[k_]||(n.namedTextures[k_]=s.texture("image-float32","rgba","float","nearest")));let D=n.namedTextures[ud],M=n.namedTextures[k_];D.define(A,_),M.define(A,_),D.attachFramebuffer(w,0),M.attachFramebuffer(w,1);let E=mKe(n,e,h,t,r);l.currentRenderItemId=-1,w.bind(),i.drawBuffers([i.COLOR_ATTACHMENT0,i.COLOR_ATTACHMENT1]);let{uCurrentSlice:R,uCurrentX:k,uCurrentY:B}=E.values;He&&n.timer.mark("ColorAccumulate.render"),pKe(n),l.viewport(0,0,A,_),l.scissor(0,0,A,_),a.clear(a.COLOR_BUFFER_BIT),P.update(B,0);let L=0,V=0,U=0;for(let X=0;X<v;++X)L>=T&&(L-=T,V+=I,U=0,P.update(B,V)),P.update(k,U),P.update(R,X),l.viewport(U,V,S,I),l.scissor(U,V,S,I),E.render(),++L,U+=S;D.detachFramebuffer(w,0),M.detachFramebuffer(w,1),i.drawBuffers([a.COLOR_ATTACHMENT0,a.NONE]),He&&n.timer.markEnd("ColorAccumulate.render"),He&&n.timer.mark("ColorNormalize.render"),(!o||Gfe(o))&&(o=s.texture("image-uint8","rgba","ubyte","linear")),o.define(A,_);let Q=hKe(n,D,M);l.currentRenderItemId=-1,yKe(n),o.attachFramebuffer(w,0),l.viewport(0,0,A,_),l.scissor(0,0,A,_),a.clear(a.COLOR_BUFFER_BIT),Q.render(),He&&n.timer.markEnd("ColorNormalize.render");let O=Ut.create(x[0],x[1],x[2],f),q=m?"volumeInstance":"volume";return He&&n.timer.markEnd("calcTextureMeshColorSmoothing"),{texture:o,gridDim:g,gridTexDim:Ie.create(A,_),gridTransform:O,type:q}}var Tj="color-smoothing-rgb",_I="color-smoothing-rgba",RI="color-smoothing-alpha";function xKe(e){return e==="group"||e==="groupInstance"}function Pj(e,t,r,n,o){if(!xKe(e.dColorType.ref.value))return;r*=3,n.namedTextures[Tj]||(n.namedTextures[Tj]=n.resources.texture("image-uint8","rgb","ubyte","nearest"));let i=n.namedTextures[Tj];i.load(e.tColor.ref.value);let a=F_({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);P.updateIfChanged(e.dColorType,a.type),P.update(e.tColorGrid,a.texture),P.update(e.uColorTexDim,a.gridTexDim),P.update(e.uColorGridDim,a.gridDim),P.update(e.uColorGridTransform,a.gridTransform)}function CKe(e){return e==="groupInstance"}function Jxe(e,t,r,n,o){if(!CKe(e.dOverpaintType.ref.value))return;r*=3,n.namedTextures[_I]||(n.namedTextures[_I]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));let i=n.namedTextures[_I];i.load(e.tOverpaint.ref.value);let a=F_({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);P.updateIfChanged(e.dOverpaintType,a.type),P.update(e.tOverpaintGrid,a.texture),P.update(e.uOverpaintTexDim,a.gridTexDim),P.update(e.uOverpaintGridDim,a.gridDim),P.update(e.uOverpaintGridTransform,a.gridTransform)}function SKe(e){return e==="groupInstance"}function $xe(e,t,r,n,o){if(!SKe(e.dTransparencyType.ref.value))return;r*=3,n.namedTextures[RI]||(n.namedTextures[RI]=n.resources.texture("image-uint8","alpha","ubyte","nearest"));let i=n.namedTextures[RI];i.load(e.tTransparency.ref.value);let a=F_({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);P.updateIfChanged(e.dTransparencyType,a.type),P.update(e.tTransparencyGrid,a.texture),P.update(e.uTransparencyTexDim,a.gridTexDim),P.update(e.uTransparencyGridDim,a.gridDim),P.update(e.uTransparencyGridTransform,a.gridTransform)}function vKe(e){return e==="groupInstance"}function eCe(e,t,r,n,o){if(!vKe(e.dEmissiveType.ref.value))return;r*=3,n.namedTextures[RI]||(n.namedTextures[RI]=n.resources.texture("image-uint8","alpha","ubyte","nearest"));let i=n.namedTextures[RI];i.load(e.tEmissive.ref.value);let a=F_({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dEmissiveType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);P.updateIfChanged(e.dEmissiveType,a.type),P.update(e.tEmissiveGrid,a.texture),P.update(e.uEmissiveTexDim,a.gridTexDim),P.update(e.uEmissiveGridDim,a.gridDim),P.update(e.uEmissiveGridTransform,a.gridTransform)}function IKe(e){return e==="groupInstance"}function tCe(e,t,r,n,o){if(!IKe(e.dSubstanceType.ref.value))return;r*=3,n.namedTextures[_I]||(n.namedTextures[_I]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));let i=n.namedTextures[_I];i.load(e.tSubstance.ref.value);let a=F_({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);P.updateIfChanged(e.dSubstanceType,a.type),P.update(e.tSubstanceGrid,a.texture),P.update(e.uSubstanceTexDim,a.gridTexDim),P.update(e.uSubstanceGridDim,a.gridDim),P.update(e.uSubstanceGridTransform,a.gridTransform)}var Fr;(d=>{function e(p,h){p&&(p.state.visible=h)}d.setVisibility=e;function t(p,h){p&&(p.state.alphaFactor=h)}d.setAlphaFactor=t;function r(p,h){p&&(p.state.pickable=h)}d.setPickable=r;function n(p,h){p&&(p.state.colorOnly=h)}d.setColorOnly=n;function o(p,h,f,y,g){if(!p||Ii(h))return!1;let{tMarker:x,uMarker:S,markerAverage:I,markerStatus:v,uGroupCount:A,instanceCount:_,instanceGranularity:T}=p.values,w=T.ref.value?_.ref.value:A.ref.value*_.ref.value,{array:D}=x.ref.value,M=v.ref.value;if(!Ji(h)){let B=0;if(y(h,L=>(B+=xe.size(L),!0),!0),B===0)return!1;B===w&&(h=Uh)}let E=!1,R=-1,k=-1;if(Ji(h)){let B=Vxe(f,M);B.status!==-1?(E=M!==B.status,E&&Fxe(D,B.status,w)):E=wx(D,xe.ofLength(w),f),R=B.average,k=B.status}else E=y(h,B=>wx(D,B,f),!0),E&&(R=Oxe(f,M),g&&g.status!==-1&&R===-1&&Wo.isReverse(g.action,f)&&Jt.areEqual(h,g.loci)&&(k=g.status,R=k===0?0:.5));return E&&(R===-1&&(R=C6(D,w),R===0&&(k=0)),g&&(g.action=f,g.loci=h,g.status=M),P.updateIfChanged(S,k),k===-1&&P.update(x,x.ref.value),P.updateIfChanged(I,R),P.updateIfChanged(v,k)),E}d.mark=o;function i(p,h,f,y,g){if(!p)return;let{tOverpaint:x,dOverpaintType:S,dOverpaint:I,uGroupCount:v,instanceCount:A,instanceGranularity:_}=p.values,T=_.ref.value?A.ref.value:v.ref.value*A.ref.value,w=_.ref.value?"instance":"groupInstance";qfe(h.layers.length?T:0,w,p.values);let{array:D}=x.ref.value;y&&M6(D,0,T);for(let M=0,E=h.layers.length;M<E;++M){let{loci:R,color:k,clear:B}=h.layers[M];f(R,V=>{let U=xe.start(V),Q=xe.end(V);return B?M6(D,U,Q):Zfe(D,U,Q,k)},!1)}if(P.update(x,x.ref.value),P.updateIfChanged(S,w),P.updateIfChanged(I,h.layers.length>0),h.layers.length!==0&&w!=="instance"&&g&&cm(g.props)){let{geometry:M,props:E,webgl:R}=g;if(M.kind==="mesh"){let{resolution:k,overpaintTexture:B}=M.meta,L=fu(E.smoothColors,!0,k);L&&(jxe(p.values,L.resolution,L.stride,R,B),M.meta.overpaintTexture=p.values.tOverpaintGrid.ref.value)}else if(R&&M.kind==="texture-mesh"){let{resolution:k,overpaintTexture:B}=M.meta,L=fu(E.smoothColors,!0,k);L&&(Jxe(p.values,L.resolution,L.stride,R,B),M.meta.overpaintTexture=p.values.tOverpaintGrid.ref.value)}}}d.setOverpaint=i;function a(p,h,f,y,g){if(!p)return;let{tTransparency:x,dTransparencyType:S,transparencyAverage:I,transparencyMin:v,dTransparency:A,uGroupCount:_,instanceCount:T,instanceGranularity:w}=p.values,D=w.ref.value?T.ref.value:_.ref.value*T.ref.value,M=w.ref.value?"instance":"groupInstance";$fe(h.layers.length?D:0,M,p.values);let{array:E}=x.ref.value;y&&Jfe(E,0,D);for(let R=0,k=h.layers.length;R<k;++R){let{loci:B,value:L}=h.layers[R];f(B,U=>{let Q=xe.start(U),O=xe.end(U);return Kfe(E,Q,O,L)},!1)}if(P.update(x,x.ref.value),P.updateIfChanged(I,B6(E,D)),P.updateIfChanged(v,k6(E,D)),P.updateIfChanged(S,M),P.updateIfChanged(A,h.layers.length>0),h.layers.length!==0&&M!=="instance"&&g&&cm(g.props)){let{geometry:R,props:k,webgl:B}=g;if(R.kind==="mesh"){let{resolution:L,transparencyTexture:V}=R.meta,U=fu(k.smoothColors,!0,L);U&&(Wxe(p.values,U.resolution,U.stride,B,V),R.meta.transparencyTexture=p.values.tTransparencyGrid.ref.value)}else if(B&&R.kind==="texture-mesh"){let{resolution:L,transparencyTexture:V}=R.meta,U=fu(k.smoothColors,!0,L);U&&($xe(p.values,U.resolution,U.stride,B,V),R.meta.transparencyTexture=p.values.tTransparencyGrid.ref.value)}}}d.setTransparency=a;function s(p,h,f,y,g){if(!p)return;let{tEmissive:x,dEmissiveType:S,emissiveAverage:I,dEmissive:v,uGroupCount:A,instanceCount:_,instanceGranularity:T}=p.values,w=T.ref.value?_.ref.value:A.ref.value*_.ref.value,D=T.ref.value?"instance":"groupInstance";che(h.layers.length?w:0,D,p.values);let{array:M}=x.ref.value;y&&uhe(M,0,w);for(let E=0,R=h.layers.length;E<R;++E){let{loci:k,value:B}=h.layers[E];f(k,V=>{let U=xe.start(V),Q=xe.end(V);return lhe(M,U,Q,B)},!1)}if(P.update(x,x.ref.value),P.updateIfChanged(I,F6(M,w)),P.updateIfChanged(S,D),P.updateIfChanged(v,h.layers.length>0),h.layers.length!==0&&D!=="instance"&&g&&cm(g.props)){let{geometry:E,props:R,webgl:k}=g;if(E.kind==="mesh"){let{resolution:B,emissiveTexture:L}=E.meta,V=fu(R.smoothColors,!0,B);V&&(Xxe(p.values,V.resolution,V.stride,k,L),E.meta.emissiveTexture=p.values.tEmissiveGrid.ref.value)}else if(k&&E.kind==="texture-mesh"){let{resolution:B,emissiveTexture:L}=E.meta,V=fu(R.smoothColors,!0,B);V&&(eCe(p.values,V.resolution,V.stride,k,L),E.meta.emissiveTexture=p.values.tEmissiveGrid.ref.value)}}}d.setEmissive=s;function l(p,h,f,y,g){if(!p)return;let{tSubstance:x,dSubstanceType:S,dSubstance:I,uGroupCount:v,instanceCount:A,instanceGranularity:_}=p.values,T=_.ref.value?A.ref.value:v.ref.value*A.ref.value,w=_.ref.value?"instance":"groupInstance";ahe(h.layers.length?T:0,w,p.values);let{array:D}=x.ref.value;y&&L6(D,0,T);for(let M=0,E=h.layers.length;M<E;++M){let{loci:R,material:k,clear:B}=h.layers[M];f(R,V=>{let U=xe.start(V),Q=xe.end(V);return B?L6(D,U,Q):ihe(D,U,Q,k)},!1)}if(P.update(x,x.ref.value),P.updateIfChanged(S,w),P.updateIfChanged(I,h.layers.length>0),h.layers.length!==0&&w!=="instance"&&g&&cm(g.props)){let{geometry:M,props:E,webgl:R}=g;if(M.kind==="mesh"){let{resolution:k,substanceTexture:B}=M.meta,L=fu(E.smoothColors,!0,k);L&&(Qxe(p.values,L.resolution,L.stride,R,B),M.meta.substanceTexture=p.values.tSubstanceGrid.ref.value)}else if(R&&M.kind==="texture-mesh"){let{resolution:k,substanceTexture:B}=M.meta,L=fu(E.smoothColors,!0,k);L&&(tCe(p.values,L.resolution,L.stride,R,B),M.meta.substanceTexture=p.values.tSubstanceGrid.ref.value)}}}d.setSubstance=l;function u(p,h,f,y){if(!p)return;let{tClipping:g,dClippingType:x,dClipping:S,uGroupCount:I,instanceCount:v,instanceGranularity:A}=p.values,_=A.ref.value?v.ref.value:I.ref.value*v.ref.value,{layers:T}=h,w=A.ref.value?"instance":"groupInstance";nhe(T.length?_:0,w,p.values);let{array:D}=g.ref.value;y&&rhe(D,0,_);for(let M=0,E=h.layers.length;M<E;++M){let{loci:R,groups:k}=h.layers[M];f(R,L=>{let V=xe.start(L),U=xe.end(L);return the(D,V,U,k)},!1)}P.update(g,g.ref.value),P.updateIfChanged(x,w),P.updateIfChanged(S,h.layers.length>0)}d.setClipping=u;function c(p,h){p&&(P.updateIfChanged(p.values.uOverpaintStrength,h.overpaint),P.updateIfChanged(p.values.uTransparencyStrength,h.transparency),P.updateIfChanged(p.values.uEmissiveStrength,h.emissive),P.updateIfChanged(p.values.uSubstanceStrength,h.substance))}d.setThemeStrength=c;function m(p,h,f){if(!p||!h&&!f)return;let{values:y}=p;h&&(Z.copy(y.matrix.ref.value,h),P.update(y.matrix,y.matrix.ref.value)),f?(y.extraTransform.ref.value.set(f),P.update(y.extraTransform,y.extraTransform.ref.value)):f===null&&(uI(y.extraTransform.ref.value,y.instanceCount.ref.value),P.update(y.extraTransform,y.extraTransform.ref.value)),E6(y,y.invariantBoundingSphere.ref.value,y.instanceGrid.ref.value.cellSize,y.instanceGrid.ref.value.batchSize);let g=Si(y.invariantBoundingSphere.ref.value,y.transform.ref.value,y.instanceCount.ref.value,0);P.update(y.boundingSphere,g)}d.setTransform=m})(Fr||={});function ui(e,t,r={}){let n=0,o=new En,i=Vt.createState(),a=Dc(),s=[],l,u,c=-1,m=pi.createEmpty(),d=t.Params,p=C.getDefaultValues(d),h,f;r.modifyState&&Vt.updateState(i,r.modifyState(i));let y=ld.create();function g(v={},A){ld.reset(y),!(!A&&!u)&&(A&&!u?y.createNew=!0:A&&u&&A.id===u.id||(A&&u&&A.id!==u.id?(y.updateTransform=!0,y.createGeometry=!0):A&&console.warn("unexpected state")),v.instanceGranularity!==p.instanceGranularity&&(y.updateTransform=!0),y.updateTransform&&(y.updateColor=!0,y.updateSize=!0,y.updateMatrix=!0),y.createGeometry&&(y.updateColor=!0,y.updateSize=!0))}function x(v={},A){return r.modifyProps&&(v=r.modifyProps(v)),Pe.create("ShapeRepresentation.create",async _=>{let T=Object.assign(p,v),w=A?await e(_,A,T,u):void 0;if(g(v,w),w&&(u=w,Object.assign(m,Gr.getTheme(u))),y.createNew){s.length=0,h=Gr.groupIterator(u);let D=Gr.createTransform(u.transforms,u.geometry.boundingSphere,T.cellSize,T.batchSize),M=t.createValues(u.geometry,D,h,m,T),E=t.createRenderableState(T);r.modifyState&&Object.assign(E,r.modifyState(E)),Vt.updateState(i,E),l=Kd(u.geometry.kind,M,E,a),l&&s.push(l),f=t.createPositionIterator(u.geometry,l.values)}else{if(!l)throw new Error("expected renderObject to be available");if(y.updateTransform){h=Gr.groupIterator(u);let{instanceCount:D,groupCount:M}=h;v.instanceGranularity?oo(D,"instance",l.values):oo(D*M,"groupInstance",l.values)}y.updateMatrix&&(Gr.createTransform(u.transforms,u.geometry.boundingSphere,T.cellSize,T.batchSize,l.values),"lodLevels"in l.values&&P.update(l.values.lodLevels,l.values.lodLevels.ref.value)),y.createGeometry&&(P.updateIfChanged(l.values.drawCount,Ga.getDrawCount(u.geometry)),P.updateIfChanged(l.values.uVertexCount,Ga.getVertexCount(u.geometry)),P.updateIfChanged(l.values.uGroupCount,h.groupCount)),(y.updateTransform||y.createGeometry)&&(t.updateBoundingSphere(l.values,u.geometry),f=t.createPositionIterator(u.geometry,l.values)),y.updateColor&&Ki(h,f,m.color,l.values),y.updateSize&&"uSize"in l.values&&Ml(h,m.size,l.values),t.updateValues(l.values,T),t.updateRenderableState(l.state,T)}p=T,(y.createGeometry||y.createNew)&&(c+=1),o.next(n++)})}function S(v,A,_){let T=!1;if(!js.isLoci(v)||js.isLociEmpty(v)||v.shape!==A)return!1;for(let w of v.groups)_(xe.ofSingleton(w.instance))&&(T=!0);return T}function I(v,A){return Ji(v)||Gr.isLoci(v)&&v.shape===u?p.instanceGranularity?A(xe.ofBounds(0,u.transforms.length)):A(xe.ofBounds(0,u.groupCount*u.transforms.length)):p.instanceGranularity?S(v,u,A):AKe(v,u,A)}return{label:"Shape geometry",get groupCount(){return h?h.count:0},get props(){return p},get params(){return d},get state(){return i},get theme(){return m},renderObjects:s,get geometryVersion(){return c},updated:o,createOrUpdate:x,getLoci(v){let{objectId:A,groupId:_,instanceId:T}=v;return l&&l.id===A?js.Loci(u,[{ids:Se.ofSingleton(_),instance:T}]):dr},getAllLoci(){return[Gr.Loci(u)]},eachLocation:v=>{for(h.reset();h.hasNext;){let{location:A,isSecondary:_}=h.move();v(A,_)}},mark(v,A){if(!Wo.is(i.markerActions,A))return!1;if(js.isLoci(v)||Gr.isLoci(v)){if(v.shape!==u)return!1}else if(!Ji(v))return!1;return Fr.mark(l,v,A,I)},setState(v){r.modifyState&&(v=r.modifyState(v)),l&&(v.visible!==void 0&&Fr.setVisibility(l,v.visible),v.alphaFactor!==void 0&&Fr.setAlphaFactor(l,v.alphaFactor),v.pickable!==void 0&&Fr.setPickable(l,v.pickable),v.colorOnly!==void 0&&Fr.setColorOnly(l,v.colorOnly),v.overpaint!==void 0&&Fr.setOverpaint(l,v.overpaint,I,!0),v.transparency!==void 0&&Fr.setTransparency(l,v.transparency,I,!0),v.substance!==void 0&&Fr.setSubstance(l,v.substance,I,!0),v.transform!==void 0&&Fr.setTransform(l,v.transform)),Vt.updateState(i,v)},setTheme(v){$t&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy(){s.length=0,l&&(l.state.disposed=!0,l=void 0)}}}function AKe(e,t,r){if(!js.isLoci(e)||e.shape!==t)return!1;let n=!1,{groupCount:o}=t,{groups:i}=e;for(let{ids:a,instance:s}of i)if(xe.is(a)){let l=s*o+xe.start(a),u=s*o+xe.end(a);r(xe.ofBounds(l,u))&&(n=!0)}else for(let l=0,u=a.length;l<u;l++){let c=s*o+a[l];r(xe.ofSingleton(c))&&(n=!0)}return n}var rCe=Z(),Py=class{constructor(t){this.structure=t;this.groupUnitTransforms=[];this.unitOffsetMap=xl.Mutable();this.groupIndexMap=xl.Mutable();this._isIdentity=void 0;this.version=0;this.unitTransforms=new Float32Array(t.units.length*16),this.size=t.units.length,this.reset();let r=0;for(let n=0,o=t.unitSymmetryGroups.length;n<o;++n){let i=t.unitSymmetryGroups[n];this.groupIndexMap.set(i.hashCode,n);let a=this.unitTransforms.subarray(r,r+i.units.length*16);this.groupUnitTransforms.push(a);for(let s=0,l=i.units.length;s<l;++s)this.unitOffsetMap.set(i.units[s].id,r+s*16);r+=i.units.length*16}}reset(){this.version=0,uI(this.unitTransforms,this.size),this._isIdentity=!0}get isIdentity(){if(this._isIdentity===void 0){this._isIdentity=!0;for(let t=0,r=this.size*16;t<r;t+=16)if(Z.fromArray(rCe,this.unitTransforms,t),!Z.isIdentity(rCe)){this._isIdentity=!1;break}}return this._isIdentity}setTransform(t,r){this.version=(this.version+1)%2147483647,Z.toArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id)),this._isIdentity=void 0}getTransform(t,r){return Z.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id))}getSymmetryGroupTransforms(t){return this.groupUnitTransforms[this.groupIndexMap.get(t.hashCode)]}};var nCe=Z();function _j(e,t,r){for(let n=0,o=e.units.length;n<o;n++){let i=e.units[n];jn.lerpFromIdentity(nCe,i.conformation.operator,r),t.setTransform(nCe,i)}}var oCe=b(),DI=b(),Bk=Z();function Rj(e,t,r,n){let o=n.radius*r;for(let i=0,a=e.units.length;i<a;i++){let s=e.units[i];b.transformMat4(oCe,s.lookup3d.boundary.sphere.center,s.conformation.operator.matrix),b.sub(DI,oCe,n.center),b.setMagnitude(DI,DI,o),Z.fromTranslation(Bk,DI),t.setTransform(Bk,s)}}var sCe={axis:C.MappedStatic("custom",{structure:C.Group({principalAxis:C.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:C.Group({vector:C.Vec3(b.create(0,0,1))})}),origin:C.MappedStatic("structure",{structure:C.Group({}),custom:C.Group({vector:C.Vec3(b.create(0,0,0))})})};function Dj(e,t){let r,n;return t.axis.name==="custom"?r=t.axis.params.vector:r=De.getPrincipalAxes(e).momentsAxes[t.axis.params.principalAxis],t.origin.name==="custom"?n=t.origin.params.vector:n=De.getPrincipalAxes(e).momentsAxes.origin,{axis:r,origin:n}}var iCe=Z(),aCe=Z(),Mk=Z();function wj(e,t,r,n,o){for(let i=0,a=e.units.length;i<a;i++){let s=e.units[i];b.negate(DI,o),Z.fromTranslation(Bk,DI),Z.fromRotation(iCe,Math.PI*r*2,n),Z.fromTranslation(aCe,o),Z.mul(Mk,iCe,Bk),Z.mul(Mk,aCe,Mk),t.setTransform(Mk,s)}}function Ha(e,t){return{kind:e,layers:t}}(u=>{u.Empty={kind:"empty-loci",layers:[]};function t(c,m){if(c.layers.length===0&&m.layers.length===0)return!0;if(c.layers.length!==m.layers.length)return!1;for(let d=0,p=c.layers.length;d<p;++d)if(c.layers[d].clear!==m.layers[d].clear||c.layers[d].color!==m.layers[d].color||!Jt.areEqual(c.layers[d].loci,m.layers[d].loci))return!1;return!0}u.areEqual=t;function r(c){return c.layers.length===0}u.isEmpty=r;function n(c,m){if(c.kind==="element-loci"){let d=[];for(let p of c.layers){let{loci:h,color:f,clear:y}=p;h=K.Loci.remap(h,m),K.Loci.isEmpty(h)||d.push({loci:h,color:f,clear:y})}return{kind:"element-loci",layers:d}}else return c}u.remap=n;function o(c){if(r(c))return c;if(c.kind==="element-loci"){let{structure:m}=c.layers[0].loci,d=new Map,p=K.Loci.none(m);for(let f=0,y=c.layers.length;f<y;++f){let{loci:g,color:x,clear:S}=c.layers[y-f-1];if(g=K.Loci.subtract(g,p),p=K.Loci.union(g,p),!K.Loci.isEmpty(g)){let I=S?-1:x;d.has(I)&&(g=K.Loci.union(g,d.get(I))),d.set(I,g)}}let h=[];return d.forEach((f,y)=>{let g=y===-1,x=g?0:y;h.push({loci:f,color:x,clear:g})}),{kind:"element-loci",layers:h}}else return c}u.merge=o;function i(c,m){if(r(c))return c;if(c.kind==="element-loci"){let{structure:d}=c.layers[0].loci,p=[];for(let h of c.layers){let{loci:f,color:y,clear:g}=h,x=K.Loci.remap(f,m);f=K.Loci.remap(x,d),K.Loci.isEmpty(f)||p.push({loci:f,color:y,clear:g})}return{kind:"element-loci",layers:p}}else return c}u.filter=i;function a(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{script:f,color:y,clear:g}=c[p],x=To.toLoci(f,m);K.Loci.isEmpty(x)||d.push({loci:x,color:y,clear:g})}return{kind:"element-loci",layers:d}}u.ofScript=a;function s(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{bundle:f,color:y,clear:g}=c[p],x=K.Bundle.toLoci(f,m.root);d.push({loci:x,color:y,clear:g})}return{kind:"element-loci",layers:d}}u.ofBundle=s;function l(c){let m=[];for(let d=0,p=c.layers.length;d<p;++d){let{loci:h,color:f,clear:y}=c.layers[d],g=K.Bundle.fromLoci(h);m.push({bundle:g,color:f,clear:y})}return{kind:"element-loci",layers:m}}u.toBundle=l})(Ha||={});function ja(e,t){return{kind:e,layers:t}}(u=>{u.Empty={kind:"empty-loci",layers:[]};function t(c,m){if(c.layers.length===0&&m.layers.length===0)return!0;if(c.layers.length!==m.layers.length)return!1;for(let d=0,p=c.layers.length;d<p;++d)if(c.layers[d].value!==m.layers[d].value||!Jt.areEqual(c.layers[d].loci,m.layers[d].loci))return!1;return!0}u.areEqual=t;function r(c){return c.layers.length===0}u.isEmpty=r;function n(c,m){if(c.kind==="element-loci"){let d=[];for(let p of c.layers){let h=K.Loci.remap(p.loci,m);K.Loci.isEmpty(h)||d.push({loci:h,value:p.value})}return{kind:"element-loci",layers:d}}else return c}u.remap=n;function o(c){if(r(c))return c;if(c.kind==="element-loci"){let{structure:m}=c.layers[0].loci,d=new Map,p=K.Loci.none(m);for(let f=0,y=c.layers.length;f<y;++f){let{loci:g,value:x}=c.layers[y-f-1];g=K.Loci.subtract(g,p),p=K.Loci.union(g,p),K.Loci.isEmpty(g)||(d.has(x)&&(g=K.Loci.union(g,d.get(x))),d.set(x,g))}let h=[];return d.forEach((f,y)=>{h.push({loci:f,value:y})}),{kind:"element-loci",layers:h}}else return c}u.merge=o;function i(c,m){if(r(c))return c;if(c.kind==="element-loci"){let{structure:d}=c.layers[0].loci,p=[];for(let h of c.layers){let{loci:f,value:y}=h,g=K.Loci.remap(f,m);f=K.Loci.remap(g,d),K.Loci.isEmpty(f)||p.push({loci:f,value:y})}return{kind:"element-loci",layers:p}}else return c}u.filter=i;function a(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{script:f,value:y}=c[p],g=To.toLoci(f,m);K.Loci.isEmpty(g)||d.push({loci:g,value:y})}return{kind:"element-loci",layers:d}}u.ofScript=a;function s(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{bundle:f,value:y}=c[p],g=K.Bundle.toLoci(f,m.root);d.push({loci:g,value:y})}return{kind:"element-loci",layers:d}}u.ofBundle=s;function l(c){let m=[];for(let d=0,p=c.layers.length;d<p;++d){let{loci:h,value:f}=c.layers[d],y=K.Bundle.fromLoci(h);m.push({bundle:y,value:f})}return{kind:"element-loci",layers:m}}u.toBundle=l})(ja||={});var TKe=Z.fromTranslation(Z(),b.create(.5,.5,.5)),PKe=W6(j6(J0()),TKe),xf=b(),lCe=Z(),_Ke={origin:"Origin",model:"Model"},RKe={corner:"Corner",center:"Center"},DKe={...ft.Params,cellColor:C.Color(Lt.orange),cellScale:C.Numeric(2,{min:.1,max:5,step:.1}),ref:C.Select("model",C.objectToOptions(_Ke),{isEssential:!0}),attachment:C.Select("corner",C.objectToOptions(RKe),{isEssential:!0})},wKe={mesh:(e,t)=>ui(MKe,ft.Utils)},Ej={...DKe};function EKe(e,t,r){let n=et.createState(256,128,r),{fromFractional:o}=e.symmetry.spacegroup.cell;b.copy(xf,e.ref),t.attachment==="center"?(b.trunc(xf,xf),b.subScalar(xf,xf,.5)):b.floor(xf,xf),Z.fromTranslation(lCe,xf);let i=W6(j6(PKe),lCe),a=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;n.currentGroup=1,et.addCage(n,o,i,a,2,20);let s=ye.fromDimensionsAndTransform(ye(),b.unit,o);b.transformMat4(xf,xf,o),ye.translate(s,s,xf),ye.expand(s,s,a);let l=et.getMesh(n);return l.setBoundingSphere(s),l}function MKe(e,t,r,n){let o=EKe(t,r,n&&n.geometry),i=ux.getUnitcellLabel(t.symmetry);return Gr.create(i,t,o,()=>r.cellColor,()=>1,()=>i)}function Mj(e,t,r){let n=b();return r.ref==="model"&&b.transformMat4(n,Ft.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:n}}function uCe(e,t){return Vt.createMulti("Unit Cell",e,t,Vt.StateBuilder,wKe)}var cp=new Uint16Array([0,1,2,1,3,2]),aS=Qe.add3,Hl=Qe.add2,cCe=Qe.add,_s;(t=>{function e(r={},n=2048,o=1024,i){n*=2,o*=2;let a=Qe.create(Float32Array,3,o,i?i.centerBuffer.ref.value:n),s=Qe.create(Float32Array,2,o,i?i.mappingBuffer.ref.value:n),l=Qe.create(Float32Array,1,o,i?i.depthBuffer.ref.value:n),u=Qe.create(Uint32Array,3,o,i?i.indexBuffer.ref.value:n),c=Qe.create(Float32Array,1,o,i?i.groupBuffer.ref.value:n),m=Qe.create(Float32Array,2,o,i?i.tcoordBuffer.ref.value:n),d={...C.getDefaultValues(Ui.Params),...r},{attachment:p,background:h,backgroundMargin:f,tether:y,tetherLength:g,tetherBaseWidth:x}=d,S=ghe(d),I=1/2.5*f,v=S.buffer/S.lineHeight,A=(_,T,w,D,M)=>{aS(a,_,T,w),cCe(l,D),cCe(c,M)};return{add:(_,T,w,D,M,E,R)=>{let k=0,B=_.length;for(let Y=0;Y<B;++Y){let $=S.get(_[Y]);k+=$.nw-2*v}let L=1/1.25,V,U;if(p.startsWith("top")?V=L:p.startsWith("middle")?V=L/2:V=0,p.endsWith("right")?U=k:p.endsWith("center")?U=k/2:U=0,y)switch(p){case"bottom-left":U-=g/2+I+.1,V-=g/2+I;break;case"bottom-center":V-=g+I;break;case"bottom-right":U+=g/2+I+.1,V-=g/2+I;break;case"middle-left":U-=g+I+.1;break;case"middle-center":break;case"middle-right":U+=g+I+.1;break;case"top-left":U-=g/2+I+.1,V+=g/2+I;break;case"top-center":V+=g+I;break;case"top-right":U+=g/2+I+.1,V+=g/2+I;break}let Q=(-U-I-.1)*E,O=(k-U+I+.1)*E,q=(L-V+I)*E,X=(-V-I)*E;if(h){Hl(s,Q,q),Hl(s,Q,X),Hl(s,O,q),Hl(s,O,X);let Y=a.elementCount;for(let $=0;$<4;++$)Hl(m,10,10),A(T,w,D,M,R);aS(u,Y+cp[0],Y+cp[1],Y+cp[2]),aS(u,Y+cp[3],Y+cp[4],Y+cp[5])}if(y){let Y,$,ce,ie,oe,W,N,j,ue=g*E,be=x*E;switch(p){case"bottom-left":Y=Q-ue/2,ce=Q+be/2,oe=Q,N=Q,$=X-ue/2,ie=X,W=X+be/2,j=X;break;case"bottom-center":Y=0,ce=be/2,oe=-be/2,N=0,$=X-ue,ie=X,W=X,j=X;break;case"bottom-right":Y=O+ue/2,ce=O,oe=O-be/2,N=O,$=X-ue/2,ie=X+be/2,W=X,j=X;break;case"middle-left":Y=Q-ue,ce=Q,oe=Q,N=Q,$=0,ie=-be/2,W=be/2,j=0;break;case"middle-center":Y=0,ce=0,oe=0,N=0,$=0,ie=0,W=0,j=0;break;case"middle-right":Y=O+ue,ce=O,oe=O,N=O,$=0,ie=be/2,W=-be/2,j=0;break;case"top-left":Y=Q-ue/2,ce=Q+be/2,oe=Q,N=Q,$=q+ue/2,ie=q,W=q-be/2,j=q;break;case"top-center":Y=0,ce=be/2,oe=-be/2,N=0,$=q+ue,ie=q,W=q,j=q;break;case"top-right":Y=O+ue/2,ce=O,oe=O-be/2,N=O,$=q+ue/2,ie=q-be/2,W=q,j=q;break;default:Rr(p)}Hl(s,Y,$),Hl(s,ce,ie),Hl(s,oe,W),Hl(s,N,j);let ee=a.elementCount;for(let le=0;le<4;++le)Hl(m,10,10),A(T,w,D,M,R);aS(u,ee,ee+1,ee+3),aS(u,ee,ee+3,ee+2)}U+=v,V+=v;let F=0;for(let Y=0;Y<B;++Y){let $=S.get(_[Y]),ce=(F-U)*E,ie=(F+$.nw-U)*E,oe=($.nh-V)*E,W=-V*E;Hl(s,ce,oe),Hl(s,ce,W),Hl(s,ie,oe),Hl(s,ie,W);let N=S.texture.width,j=S.texture.height;Hl(m,$.x/N,$.y/j),Hl(m,$.x/N,($.y+$.h)/j),Hl(m,($.x+$.w)/N,$.y/j),Hl(m,($.x+$.w)/N,($.y+$.h)/j),F+=$.nw-2*v;let ue=a.elementCount;for(let be=0;be<4;++be)A(T,w,D,M,R);aS(u,ue+cp[0],ue+cp[1],ue+cp[2]),aS(u,ue+cp[3],ue+cp[4],ue+cp[5])}},getText:()=>{let _=S.texture,T=Qe.compact(a,!0),w=Qe.compact(s,!0),D=Qe.compact(l,!0),M=Qe.compact(u,!0),E=Qe.compact(c,!0),R=Qe.compact(m,!0);return Ui.create(_,T,w,D,M,E,R,u.elementCount/2,i)}}}t.create=e})(_s||={});var EI={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function mp(e,t={}){switch(e.kind){case"structure-loci":return e.structure.models.map(d=>d.entry).filter(d=>!!d).join(", ");case"element-loci":return sS(K.Stats.ofLoci(e),t);case"bond-loci":let r=e.bonds[0];return r?O_(r,t):"";case"shape-loci":return e.shape.name;case"group-loci":let n=e.groups[0];return n?e.shape.getLabel(Se.start(n.ids),n.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return[`${e.volume.label||"Volume"}`,`Isosurface at ${Ve.IsoValue.toString(e.isoValue)}`].join(" | ");case"cell-loci":let o=Ve.Cell.getLociSize(e),i=Se.start(e.elements[0].indices),a=Ve.IsoValue.absolute(e.volume.grid.cells.data[i]),s=Ve.IsoValue.toRelative(a,e.volume.grid.stats),l=[`${e.volume.label||"Volume"}`,`${o===1?`Cell #${i}`:`${o} Cells`}`];return o===1&&(e.volume.instances.length>1&&l.push(`Instance #${Se.start(e.elements[0].instances)+1}`),l.push(`${Ve.IsoValue.toString(a)} (${Ve.IsoValue.toString(s)})`)),l.join(" | ");case"segment-loci":let u=Ve.Segment.getLociSize(e),c=Ve.Segmentation.get(e.volume)?.labels,m=Se.start(e.elements[0].segments);if(c&&u===1){let d=c[m];if(d)return d}return[`${e.volume.label||"Volume"}`,`${u===1?`Segment ${m}`:`${u} Segments`}`].join(" | ")}}function wI(e,t){return e===1?`1 ${t}`:`${e} ${t}s`}function V_(e,t,r,n,o,i){return`${cd(t,{granularity:r,hidePrefix:n,reverse:o,condensed:i})} <small>[+ ${wI(e-1,`other ${Kc(r)}`)}]</small>`}function BKe(e){let{elements:t,model:r}=e,{chainAtomSegments:n,residueAtomSegments:o}=r.atomicHierarchy,i=n.offsets[n.index[t[0]]],a=n.offsets[n.index[t[t.length-1]]+1]-1;return o.index[a]-o.index[i]+1}function sS(e,t={}){let r={...EI,...t},n=kKe(e,r.countsOnly,r.hidePrefix,r.condensed,r.reverse);return r.htmlStyling?n:Zp(n)}function Mx(e,t={}){let r=K.Stats.create();for(let n of e)K.Stats.add(r,r,K.Stats.ofLoci(n));return sS(r,t)}function kKe(e,t=!1,r=!1,n=!1,o=!1){let{structureCount:i,chainCount:a,residueCount:s,conformationCount:l,elementCount:u}=e;if(!t&&u===1&&s===0&&a===0)return cd(e.firstElementLoc,{hidePrefix:r,condensed:n,granularity:"element",reverse:o});if(!t&&u===0&&s===1&&a===0)return cd(e.firstResidueLoc,{hidePrefix:r,condensed:n,granularity:"residue",reverse:o});if(!t&&u===0&&s===0&&a===1){let{unit:c}=e.firstChainLoc,m=me.isAtomic(c)&&BKe(c)===1||me.Traits.is(c.traits,me.Trait.MultiChain)?"residue":"chain";return cd(e.firstChainLoc,{hidePrefix:r,condensed:n,granularity:m,reverse:o})}else if(t){let c=[];return i>0&&c.push(wI(i,"Structure")),a>0&&c.push(wI(a,"Chain")),s>0&&c.push(wI(s,"Residue")),l>0&&c.push(wI(l,"Conformation")),u>0&&c.push(wI(u,"Element")),c.join("<small> + </small>")}else{let c=[];return i>0&&c.push(i===1?cd(e.firstStructureLoc,{hidePrefix:r,condensed:n,granularity:"structure",reverse:o}):V_(i,e.firstStructureLoc,"structure",r,o,n)),a>0&&(c.push(a===1?cd(e.firstChainLoc,{condensed:n,granularity:"chain",hidePrefix:r,reverse:o}):V_(a,e.firstChainLoc,"chain",r,o,n)),r=!0),s>0&&(c.push(s===1?cd(e.firstResidueLoc,{condensed:n,granularity:"residue",hidePrefix:r,reverse:o}):V_(s,e.firstResidueLoc,"residue",r,o,n)),r=!0),l>0&&(c.push(l===1?cd(e.firstConformationLoc,{condensed:n,granularity:"conformation",hidePrefix:r,reverse:o}):V_(l,e.firstConformationLoc,"conformation",r,o,n)),r=!0),u>0&&c.push(u===1?cd(e.firstElementLoc,{condensed:n,granularity:"element",hidePrefix:r,reverse:o}):V_(u,e.firstElementLoc,"element",r,o,n)),c.join("<small> + </small>")}}function O_(e,t={}){return kk({loci:[K.Loci(e.aStructure,[{unit:e.aUnit,indices:Se.ofSingleton(e.aIndex)}]),K.Loci(e.bStructure,[{unit:e.bUnit,indices:Se.ofSingleton(e.bIndex)}])]},t)}function kk(e,t={}){let r={...EI,...t},n=LKe(e,r);return r.htmlStyling?n:Zp(n)}function LKe(e,t){let{granularity:r,hidePrefix:n,reverse:o,condensed:i}=t,a=!0;for(let s of e.loci)if(!K.Loci.is(s)||K.Loci.size(s)!==1){a=!1;break}if(a){let l=e.loci.map(c=>{let{unit:m,indices:d}=c.elements[0];return K.Location.create(c.structure,m,m.elements[Se.start(d)])}).map(c=>mCe(c,r,n,o||i));if(i)return l.map(c=>c[0].replace(/\[.*\]/g,"").trim()).filter(c=>!!c).join(" \u2014 ");let u=0;for(let c=0,m=Math.min(...l.map(d=>d.length))-1;c<m;++c){let d=!0;for(let p=1,h=l.length;p<h;++p)if(l[0][c]!==l[p][c]){d=!1;break}if(d)u+=1;else break}if(u>0){let c=[l[0].join(" | ")];for(let m=1,d=l.length;m<d;++m)c.push(l[m].slice(u).filter(p=>!!p).join(" | "));return c.join(" \u2014 ")}else return l.map(c=>c.filter(m=>!!m).join(" | ")).filter(c=>!!c).join("</br>")}else return e.loci.map(l=>mp(l,t)).filter(l=>!!l).join(i?" \u2014 ":"</br>")}function cd(e,t={}){let r={...EI,...t},n=mCe(e,r.granularity,r.hidePrefix,r.reverse||r.condensed),o=r.condensed?n[0]?.replace(/\[.*\]/g,"").trim()??"":n.filter(i=>!!i).join(" | ");return r.htmlStyling?o:Zp(o)}function mCe(e,t="element",r=!1,n=!1){let o=[];if(!r){let i=e.unit.model.entry;i.length>30&&(i=i.substr(0,27)+"\u2026"),o.push(`<small>${i}</small>`),t!=="structure"&&(o.push(`<small>Model ${e.unit.model.modelNum}</small>`),o.push(`<small>Instance ${e.unit.conformation.operator.instanceId}</small>`))}return me.isAtomic(e.unit)?o.push(...FKe(e,t,n)):me.isCoarse(e.unit)?o.push(...VKe(e,t)):o.push("Unknown"),n?o.reverse():o}function FKe(e,t,r=!1){let n=K.Location.residueIndex(e),o=qe.chain.label_asym_id(e),i=qe.chain.auth_asym_id(e),a=e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(n)===H.ValueKinds.Present,s=qe.residue.label_seq_id(e),l=qe.residue.auth_seq_id(e),u=qe.residue.pdbx_PDB_ins_code(e),c=qe.atom.label_comp_id(e),m=qe.atom.label_atom_id(e),d=qe.atom.label_alt_id(e),p=qe.atom.occupancy(e),h=qe.atom.sourceIndex(e),f=qe.residue.microheterogeneityCompIds(e),y=t==="residue"&&f.length>1?`(${f.join("|")})`:c,g=[];switch(t){case"element":{let S=`<b>${m}</b>${d?`%${d}`:""}`,I=`<small style='margin-left: 4px'>[idx <b>${h+1}</b>]</small>`;g.push(`${S}${I}`)}case"conformation":t==="conformation"&&d&&g.push(`<small>Conformation</small> <b>${d}</b>`);case"residue":let x=s===l||!a?l:s;g.push(`<b>${y} ${x}</b>${x!==l?` <small>[auth</small> <b>${l}</b><small>]</small>`:""}<b>${u||""}</b>`);case"chain":o===i?g.push(`<b>${o}</b>`):t==="chain"&&me.Traits.is(e.unit.traits,me.Trait.MultiChain)?g.push(`<small>[auth</small> <b>${i}</b><small>]</small>`):g.push(`<b>${o}</b> <small>[auth</small> <b>${i}</b><small>]</small>`)}return g.length>0&&p!==1&&!r&&(g[0]=`${g[0]} <small>[occupancy</small> <b>${Math.round(100*p)/100}</b><small>]</small>`),g.reverse()}function VKe(e,t){let r=qe.coarse.asym_id(e),n=qe.coarse.seq_id_begin(e),o=qe.coarse.seq_id_end(e),i=[];switch(t){case"element":case"conformation":case"residue":if(n===o){let a=qe.coarse.entityKey(e),l=e.unit.model.sequence.byEntityKey[a].sequence.compId.value(n-1);i.push(`<b>${l} ${n}</b>`)}else i.push(`<b>${n}-${o}</b>`);case"chain":i.push(`<b>${r}</b>`)}return i.reverse()}function MI(e,t={}){let r={...EI,measureOnly:!1,unitLabel:"\u212B",...t},[n,o]=e.loci.map(s=>Jt.getCenter(s)),i=`${b.distance(n,o).toFixed(2)} ${r.unitLabel}`;if(r.measureOnly)return i;let a=kk(e,r);return r.condensed?`${i} | ${a}`:`Distance ${i}</br>${a}`}function BI(e,t={}){let r={...EI,measureOnly:!1,...t},[n,o,i]=e.loci.map(c=>Jt.getCenter(c)),a=b.sub(b(),n,o),s=b.sub(b(),i,o),l=`${Ea(b.angle(a,s)).toFixed(2)}\xB0`;if(r.measureOnly)return l;let u=kk(e,r);return r.condensed?`${l} | ${u}`:`Angle ${l}</br>${u}`}function kI(e,t={}){let r={...EI,measureOnly:!1,...t},[n,o,i,a]=e.loci.map(u=>Jt.getCenter(u)),s=`${Ea(b.dihedralAngle(n,o,i,a)).toFixed(2)}\xB0`;if(r.measureOnly)return s;let l=kk(e,r);return r.condensed?`${s} | ${l}`:`Dihedral ${s}</br>${l}`}var Bj={customText:C.Text("",{label:"Text",description:"Override the label with custom value.",isEssential:!0}),textColor:C.Color(Lt.black,{isEssential:!0}),textSize:C.Numeric(.5,{min:.1,max:10,step:.1},{isEssential:!0})},Bx={...Ui.Params,...Bj,borderWidth:C.Numeric(.2,{min:0,max:.5,step:.01})};var dCe={unitLabel:C.Text("\u212B",{isEssential:!0})},OKe={...ln.Params,...dCe,lineSizeAttenuation:C.Boolean(!0),linesColor:C.Color(Lt.lightgreen,{isEssential:!0}),linesSize:C.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:C.Numeric(.2,{min:.01,max:.2,step:.01})},GKe={...Bx,...dCe},pCe={lines:(e,t)=>ui(zKe,ln.Utils,{modifyState:r=>({...r,markerActions:Wo.Highlighting})}),text:(e,t)=>ui(jKe,Ui.Utils,{modifyState:r=>({...r,markerActions:0})})},kj={...OKe,...GKe,visuals:C.MultiSelect(["lines","text"],C.objectToOptions(pCe))};function UKe(){return{sphereA:ye(),sphereB:ye(),center:b(),distance:0}}function fCe(e,t){let{sphereA:r,sphereB:n,center:o}=t,[i,a]=e.loci;return Jt.getBoundingSphere(i,r),Jt.getBoundingSphere(a,n),b.add(o,r.center,n.center),b.scale(o,o,.5),t.distance=b.distance(r.center,n.center),t}var G_=UKe();function hCe(e,t){return e.pairs.length===1?`Distance ${MI(e.pairs[0],{unitLabel:t,measureOnly:!0})}`:`${e.pairs.length} Distances`}function NKe(e,t,r){let n=Ua.create(128,64,r);for(let o=0,i=e.pairs.length;o<i;++o)fCe(e.pairs[o],G_),n.addFixedLengthDashes(G_.sphereA.center,G_.sphereB.center,t.dashLength,o);return n.getLines()}function zKe(e,t,r,n){let o=NKe(t,r,n&&n.geometry),i=hCe(t,r.unitLabel),a=s=>MI(t.pairs[s],r);return Gr.create(i,t,o,()=>r.linesColor,()=>r.linesSize,a)}function HKe(e,t,r){let n=_s.create(t,128,64,r);for(let o=0,i=e.pairs.length;o<i;++o){fCe(e.pairs[o],G_);let{center:a,distance:s,sphereA:l,sphereB:u}=G_,c=t.customText||`${s.toFixed(2)} ${t.unitLabel}`,d=Math.max(2,l.radius,u.radius)/2;n.add(c,a[0],a[1],a[2],1,d,o)}return n.getText()}function jKe(e,t,r,n){let o=HKe(t,r,n&&n.geometry),i=hCe(t,r.unitLabel),a=s=>MI(t.pairs[s],r);return Gr.create(i,t,o,()=>r.textColor,()=>r.textSize,a)}function gCe(e,t){return Vt.createMulti("Distance",e,t,Vt.StateBuilder,pCe)}var WKe={...Bx},yCe={text:(e,t)=>ui(qKe,Ui.Utils)},Lj={...WKe,scaleByRadius:C.Boolean(!0),visuals:C.MultiSelect(["text"],C.objectToOptions(yCe)),snapshotKey:C.Text("",{isEssential:!0,disableInteractiveUpdates:!0,description:"Activate the snapshot with the provided key when clicking on the label"}),tooltip:C.Text("",{isEssential:!0,multiline:!0,disableInteractiveUpdates:!0,placeholder:"Tooltip",description:"Tooltip text to be displayed when hovering over the label"})},XKe=ye();function Fj(e,t=!1){return e.label||mp(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function QKe(e){return e.infos.length===1?Fj(e.infos[0]):`${e.infos.length} Labels`}function ZKe(e,t,r){let n=_s.create(t,128,64,r),o=t.customText.trim();for(let i=0,a=e.infos.length;i<a;++i){let s=e.infos[i],l=Jt.getBoundingSphere(s.loci,XKe);if(!l)continue;let{center:u,radius:c}=l,m=o||Fj(s,!0);n.add(m,u[0],u[1],u[2],t.scaleByRadius?c/.9:0,t.scaleByRadius?Math.max(1,c):1,i)}return n.getText()}function qKe(e,t,r,n){let o=ZKe(t,r,n&&n.geometry),i=QKe(t),a=r.tooltip?.trim()??"",s=r.customText.trim(),l;return a?l=u=>a:s?l=u=>s:l=u=>Fj(t.infos[u]),Gr.create(i,t,o,()=>r.textColor,()=>r.textSize,l)}function bCe(e,t){return Vt.createMulti("Label",e,t,Vt.StateBuilder,yCe)}var lS=b(),YKe=Z.identity(),uS=new Float32Array(6*3),KKe=new Uint8Array([0,1,2,3,4,5]);function xCe(e,t,r,n,o){let{origin:i,dirA:a,dirB:s,dirC:l}=t;b.add(lS,i,a),b.toArray(b.add(lS,i,a),uS,0),b.toArray(b.sub(lS,i,a),uS,3),b.toArray(b.add(lS,i,s),uS,6),b.toArray(b.sub(lS,i,s),uS,9),b.toArray(b.add(lS,i,l),uS,12),b.toArray(b.sub(lS,i,l),uS,15);let u=Eh(uS,KKe),c=Vi.volume(t),m=Math.cbrt(c)/300*r;et.addCage(e,YKe,u,m,n,o)}var h3r=b.zero(),g3r=b.zero();var kx=b(),JKe=b(),$Ke=b(),eJe=b(),tJe=Z.identity(),CCe=new Float32Array(8*3),rJe=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]);function SCe(e,t,r,n,o){let{origin:i,dirA:a,dirB:s,dirC:l}=t,u=b.negate(JKe,a),c=b.negate($Ke,s),m=b.negate(eJe,l),d=0,p=function(g,x,S){b.copy(kx,i),b.add(kx,kx,g),b.add(kx,kx,x),b.add(kx,kx,S),b.toArray(kx,CCe,d),d+=3};p(a,s,l),p(a,s,m),p(a,c,m),p(a,c,l),p(u,c,m),p(u,c,l),p(u,s,l),p(u,s,m);let h=Eh(CCe,rJe),f=Vi.volume(t),y=Math.cbrt(f)/300*r;et.addCage(e,tJe,h,y,n,o)}var nJe=Z.identity(),vCe=b();function oJe(e,t,r,n,o){return b.add(vCe,t,r),Z.targetTo(e,t,vCe,n),Z.setTranslation(e,t),Z.scale(e,e,o)}function _y(e,t,r,n,o,i){et.addPrimitive(e,oJe(nJe,t,r,n,o),v7(i))}var Vj={color:C.Color(Lt.orange),scaleFactor:C.Numeric(1,{min:.1,max:10,step:.1}),radiusScale:C.Numeric(2,{min:.1,max:10,step:.1})},iJe={...ft.Params,...Vj},aJe={...ft.Params,...Vj},sJe={...ft.Params,...Vj},ICe={axes:(e,t)=>ui(cJe,ft.Utils),box:(e,t)=>ui(pJe,ft.Utils),ellipsoid:(e,t)=>ui(gJe,ft.Utils)},Oj={...iJe,...aJe,...sJe,visuals:C.MultiSelect(["box"],C.objectToOptions(ICe))};function lJe(e){return`Principal Axes of ${Mx(e,{countsOnly:!0})}`}function uJe(e,t,r){let n=et.createState(256,128,r),o=K.Loci.getPrincipalAxesMany(e.locis);return Vi.scale(o.momentsAxes,o.momentsAxes,t.scaleFactor),n.currentGroup=0,xCe(n,o.momentsAxes,t.radiusScale,2,20),et.getMesh(n)}function cJe(e,t,r,n){let o=uJe(t,r,n&&n.geometry),i=lJe(t.locis);return Gr.create(i,t,o,()=>r.color,()=>1,()=>i)}function mJe(e){return`Oriented Box of ${Mx(e,{countsOnly:!0})}`}function dJe(e,t,r){let n=et.createState(256,128,r),o=K.Loci.getPrincipalAxesMany(e.locis);return Vi.scale(o.boxAxes,o.boxAxes,t.scaleFactor),n.currentGroup=0,SCe(n,o.boxAxes,t.radiusScale,2,20),et.getMesh(n)}function pJe(e,t,r,n){let o=dJe(t,r,n&&n.geometry),i=mJe(t.locis);return Gr.create(i,t,o,()=>r.color,()=>1,()=>i)}function fJe(e){return`Oriented Ellipsoid of ${Mx(e,{countsOnly:!0})}`}function hJe(e,t,r){let n=et.createState(256,128,r),i=K.Loci.getPrincipalAxesMany(e.locis).boxAxes,{origin:a,dirA:s,dirB:l}=i,u=Vi.size(b(),i);b.scale(u,u,.5*t.scaleFactor);let c=b.create(u[2],u[1],u[0]);return n.currentGroup=0,_y(n,a,s,l,c,2),et.getMesh(n)}function gJe(e,t,r,n){let o=hJe(t,r,n&&n.geometry),i=fJe(t.locis);return Gr.create(i,t,o,()=>r.color,()=>1,()=>i)}function ACe(e,t){let r=Vt.createMulti("Orientation",e,t,Vt.StateBuilder,ICe);return r.setState({markerActions:Wo.Highlighting}),r}var yJe={radius:1,segments:36,thetaStart:0,thetaLength:Math.PI*2};function LI(e){let{radius:t,segments:r,thetaStart:n,thetaLength:o}={...yJe,...e},i=o===Math.PI*2,a=i?r+1:r+2,s=new Float32Array(a*3),l=new Float32Array(a*3),u=new Uint32Array(r*3);s[0]=0,s[1]=0,s[2]=0,l[0]=0,l[1]=1,l[2]=0;for(let c=0,m=3;c<r;++c,m+=3){let d=n+c/r*o;s[m]=t*Math.sin(d),s[m+1]=0,s[m+2]=t*Math.cos(d),l[m]=0,l[m+1]=1,l[m+2]=0}for(let c=1,m=0;c<r;++c,m+=3)u[m]=c,u[m+1]=c+1,u[m+2]=0;if(i){let c=(r-1)*3;u[c]=r,u[c+1]=1,u[c+2]=0}else{let c=n+o,m=(r+1)*3;s[m]=t*Math.sin(c),s[m+1]=0,s[m+2]=t*Math.cos(c),l[m]=0,l[m+1]=1,l[m+2]=0;let d=(r-1)*3;u[d]=r,u[d+1]=r+1,u[d+2]=0}return{vertices:s,normals:l,indices:u}}var TCe={color:C.Color(Lt.lightgreen),arcScale:C.Numeric(.7,{min:.01,max:1,step:.01})},PCe={...ln.Params,...TCe,lineSizeAttenuation:C.Boolean(!0),linesSize:C.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:C.Numeric(.04,{min:.01,max:.2,step:.01})},bJe={...PCe},xJe={...PCe},CJe={...ft.Params,...TCe,ignoreLight:C.Boolean(!0),sectorOpacity:C.Numeric(.75,{min:0,max:1,step:.01})},_Ce={vectors:(e,t)=>ui(IJe,ln.Utils,{modifyState:r=>({...r,pickable:!1})}),arc:(e,t)=>ui(TJe,ln.Utils,{modifyState:r=>({...r,pickable:!1})}),sector:(e,t)=>ui(_Je,ft.Utils,{modifyProps:r=>({...r,alpha:r.sectorOpacity}),modifyState:r=>({...r,markerActions:Wo.Highlighting})}),text:(e,t)=>ui(DJe,Ui.Utils,{modifyState:r=>({...r,markerActions:0})})},Gj={...bJe,...xJe,...CJe,...Bx,visuals:C.MultiSelect(["vectors","sector","text"],C.objectToOptions(_Ce))};function SJe(){return{sphereA:ye(),sphereB:ye(),sphereC:ye(),arcDirA:b(),arcDirC:b(),arcNormal:b(),radius:0,angle:0}}var Lx=b(),U_=Z();function Lk(e,t,r){let{sphereA:n,sphereB:o,sphereC:i}=t,{arcDirA:a,arcDirC:s,arcNormal:l}=t,[u,c,m]=e.loci;Jt.getBoundingSphere(u,n),Jt.getBoundingSphere(c,o),Jt.getBoundingSphere(m,i),b.sub(a,n.center,o.center),b.sub(s,i.center,o.center),b.cross(l,a,s);let p=Math.min(b.magnitude(a),b.magnitude(s))*r;return t.radius=p,t.angle=b.angle(a,s),t}function RCe(e,t){let{radius:r,angle:n}=e,o=t?nw(n,r)/t:32;Z.targetTo(U_,e.sphereB.center,e.sphereA.center,e.arcNormal),Z.setTranslation(U_,e.sphereB.center),Z.mul(U_,U_,Z.rotY180);let i=LI({radius:r,thetaLength:n,segments:o});return mI(i,U_)}var jl=SJe();function Fk(e){return e.triples.length===1?`Angle ${BI(e.triples[0],{measureOnly:!0})}`:`${e.triples.length} Angles`}function vJe(e,t,r){let n=Ua.create(128,64,r);for(let o=0,i=e.triples.length;o<i;++o)Lk(e.triples[o],jl,t.arcScale),n.addFixedLengthDashes(jl.sphereB.center,jl.sphereA.center,t.dashLength,o),n.addFixedLengthDashes(jl.sphereB.center,jl.sphereC.center,t.dashLength,o);return n.getLines()}function IJe(e,t,r,n){let o=vJe(t,r,n&&n.geometry),i=Fk(t);return Gr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function AJe(e,t,r){let n=Ua.create(128,64,r);for(let o=0,i=e.triples.length;o<i;++o){Lk(e.triples[o],jl,t.arcScale);let a=RCe(jl,t.dashLength),{indices:s,vertices:l}=a;for(let u=0,c=s.length;u<c;u+=3){if(u%2===1)continue;let m=s[u]*3,d=s[u+1]*3,p=l[m],h=l[m+1],f=l[m+2],y=l[d],g=l[d+1],x=l[d+2];n.add(p,h,f,y,g,x,o)}}return n.getLines()}function TJe(e,t,r,n){let o=AJe(t,r,n&&n.geometry),i=Fk(t);return Gr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function PJe(e,t,r){let n=et.createState(128,64,r);for(let o=0,i=e.triples.length;o<i;++o){Lk(e.triples[o],jl,t.arcScale);let a=RCe(jl);n.currentGroup=o,et.addPrimitive(n,Z.id,a),et.addPrimitiveFlipped(n,Z.id,a)}return et.getMesh(n)}function _Je(e,t,r,n){let o=PJe(t,r,n&&n.geometry),i=Fk(t),a=s=>BI(t.triples[s]);return Gr.create(i,t,o,()=>r.color,()=>1,a)}function RJe(e,t,r){let n=_s.create(t,128,64,r);for(let o=0,i=e.triples.length;o<i;++o){Lk(e.triples[o],jl,t.arcScale),b.add(Lx,jl.arcDirA,jl.arcDirC),b.setMagnitude(Lx,Lx,jl.radius),b.add(Lx,jl.sphereB.center,Lx);let a=Ea(jl.angle).toFixed(2),s=t.customText||`${a}\xB0`,u=Math.max(2,jl.sphereA.radius,jl.sphereB.radius,jl.sphereC.radius)/2;n.add(s,Lx[0],Lx[1],Lx[2],.1,u,o)}return n.getText()}function DJe(e,t,r,n){let o=RJe(t,r,n&&n.geometry),i=Fk(t),a=s=>BI(t.triples[s]);return Gr.create(i,t,o,()=>r.textColor,()=>r.textSize,a)}function DCe(e,t){return Vt.createMulti("Angle",e,t,Vt.StateBuilder,_Ce)}var wCe={color:C.Color(Lt.lightgreen),arcScale:C.Numeric(.7,{min:.01,max:1,step:.01})},Vk={...ln.Params,...wCe,lineSizeAttenuation:C.Boolean(!0),linesSize:C.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:C.Numeric(.04,{min:.01,max:.2,step:.01})},wJe={...Vk},EJe={...Vk},MJe={...Vk},BJe={...Vk},kJe={...ft.Params,...wCe,ignoreLight:C.Boolean(!0),sectorOpacity:C.Numeric(.75,{min:0,max:1,step:.01})},ECe={vectors:(e,t)=>ui(VJe,ln.Utils,{modifyState:r=>({...r,pickable:!1})}),extenders:(e,t)=>ui(HJe,ln.Utils,{modifyState:r=>({...r,pickable:!1})}),connector:(e,t)=>ui(GJe,ln.Utils,{modifyState:r=>({...r,pickable:!1})}),arms:(e,t)=>ui(NJe,ln.Utils,{modifyState:r=>({...r,pickable:!1})}),arc:(e,t)=>ui(WJe,ln.Utils,{modifyState:r=>({...r,pickable:!1})}),sector:(e,t)=>ui(QJe,ft.Utils,{modifyProps:r=>({...r,alpha:r.sectorOpacity}),modifyState:r=>({...r,markerActions:Wo.Highlighting})}),text:(e,t)=>ui(qJe,Ui.Utils,{modifyState:r=>({...r,markerActions:0})})},Uj={...wJe,...EJe,...MJe,...BJe,...kJe,...Bx,visuals:C.MultiSelect(["extenders","arms","sector","text"],C.objectToOptions(ECe))};function LJe(){return{sphereA:ye(),sphereB:ye(),sphereC:ye(),sphereD:ye(),dirBA:b(),dirCD:b(),projA:b(),projD:b(),arcPointA:b(),arcPointD:b(),arcDirA:b(),arcDirD:b(),arcCenter:b(),arcNormal:b(),radius:0,angle:0}}var Xu=b(),N_=Z();function cS(e,t,r){let{sphereA:n,sphereB:o,sphereC:i,sphereD:a,dirBA:s,dirCD:l,projA:u,projD:c}=t,{arcPointA:m,arcPointD:d,arcDirA:p,arcDirD:h,arcCenter:f,arcNormal:y}=t,[g,x,S,I]=e.loci;Jt.getBoundingSphere(g,n),Jt.getBoundingSphere(x,o),Jt.getBoundingSphere(S,i),Jt.getBoundingSphere(I,a),b.add(f,o.center,i.center),b.scale(f,f,.5),b.sub(s,n.center,o.center),b.sub(l,a.center,i.center),b.add(m,f,s),b.add(d,f,l),b.sub(y,i.center,o.center),b.orthogonalize(p,y,s),b.orthogonalize(h,y,l),b.projectPointOnVector(u,m,p,f),b.projectPointOnVector(c,d,h,f);let A=Math.min(b.distance(u,f),b.distance(c,f))*r;b.setMagnitude(p,p,A),b.setMagnitude(h,h,A),b.add(m,f,p),b.add(d,f,h),t.radius=A,t.angle=b.dihedralAngle(n.center,o.center,i.center,a.center),b.matchDirection(Xu,y,b.sub(Xu,m,n.center));let _=b.angle(s,Xu),T=A/Math.cos(_-YC);b.add(u,o.center,b.setMagnitude(Xu,s,T)),b.matchDirection(Xu,y,b.sub(Xu,d,a.center));let w=b.angle(l,Xu),D=A/Math.cos(w-YC);return b.add(c,i.center,b.setMagnitude(Xu,l,D)),t}function MCe(e,t){let{radius:r,angle:n}=e,o=t?nw(n,r)/t:32;Z.targetTo(N_,e.arcCenter,n<0?e.arcPointD:e.arcPointA,e.arcNormal),Z.setTranslation(N_,e.arcCenter),Z.mul(N_,N_,Z.rotY180);let i=LI({radius:r,thetaLength:Math.abs(n),segments:o});return mI(i,N_)}var ei=LJe();function mS(e){return e.quads.length===1?`Dihedral ${kI(e.quads[0],{measureOnly:!0})}`:`${e.quads.length} Dihedrals`}function FJe(e,t,r){let n=Ua.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o)cS(e.quads[o],ei,t.arcScale),n.addFixedLengthDashes(ei.arcCenter,ei.arcPointA,t.dashLength,o),n.addFixedLengthDashes(ei.arcCenter,ei.arcPointD,t.dashLength,o);return n.getLines()}function VJe(e,t,r,n){let o=FJe(t,r,n&&n.geometry),i=mS(t);return Gr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function OJe(e,t,r){let n=Ua.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o)cS(e.quads[o],ei,t.arcScale),n.addFixedLengthDashes(ei.sphereB.center,ei.sphereC.center,t.dashLength,o);return n.getLines()}function GJe(e,t,r,n){let o=OJe(t,r,n&&n.geometry),i=mS(t);return Gr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function UJe(e,t,r){let n=Ua.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o)cS(e.quads[o],ei,t.arcScale),n.addFixedLengthDashes(ei.sphereB.center,ei.sphereA.center,t.dashLength,o),n.addFixedLengthDashes(ei.sphereC.center,ei.sphereD.center,t.dashLength,o);return n.getLines()}function NJe(e,t,r,n){let o=UJe(t,r,n&&n.geometry),i=mS(t);return Gr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function zJe(e,t,r){let n=Ua.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o)cS(e.quads[o],ei,t.arcScale),n.addFixedLengthDashes(ei.arcPointA,ei.projA,t.dashLength,o),n.addFixedLengthDashes(ei.arcPointD,ei.projD,t.dashLength,o);return n.getLines()}function HJe(e,t,r,n){let o=zJe(t,r,n&&n.geometry),i=mS(t);return Gr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function jJe(e,t,r){let n=Ua.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o){cS(e.quads[o],ei,t.arcScale);let a=MCe(ei,t.dashLength),{indices:s,vertices:l}=a;for(let u=0,c=s.length;u<c;u+=3){if(u%2===1)continue;let m=s[u]*3,d=s[u+1]*3,p=l[m],h=l[m+1],f=l[m+2],y=l[d],g=l[d+1],x=l[d+2];n.add(p,h,f,y,g,x,o)}}return n.getLines()}function WJe(e,t,r,n){let o=jJe(t,r,n&&n.geometry),i=mS(t);return Gr.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function XJe(e,t,r){let n=et.createState(128,64,r);for(let o=0,i=e.quads.length;o<i;++o){cS(e.quads[o],ei,t.arcScale);let a=MCe(ei);n.currentGroup=o,et.addPrimitive(n,Z.id,a),et.addPrimitiveFlipped(n,Z.id,a)}return et.getMesh(n)}function QJe(e,t,r,n){let o=XJe(t,r,n&&n.geometry),i=mS(t),a=s=>kI(t.quads[s]);return Gr.create(i,t,o,()=>r.color,()=>1,a)}function ZJe(e,t,r){let n=_s.create(t,128,64,r);for(let o=0,i=e.quads.length;o<i;++o){cS(e.quads[o],ei,t.arcScale),b.add(Xu,ei.arcDirA,ei.arcDirD),b.setMagnitude(Xu,Xu,ei.radius),b.add(Xu,ei.arcCenter,Xu);let a=Ea(ei.angle).toFixed(2);a==="-0.00"&&(a="0.00");let s=t.customText||`${a}\xB0`,u=Math.max(2,ei.sphereA.radius,ei.sphereB.radius,ei.sphereC.radius,ei.sphereD.radius)/2;n.add(s,Xu[0],Xu[1],Xu[2],.1,u,o)}return n.getText()}function qJe(e,t,r,n){let o=ZJe(t,r,n&&n.geometry),i=mS(t),a=s=>kI(t.quads[s]);return Gr.create(i,t,o,()=>r.textColor,()=>r.textSize,a)}function BCe(e,t){return Vt.createMulti("Dihedral",e,t,Vt.StateBuilder,ECe)}function lo(e,t){return{kind:e,layers:t}}(c=>{c.Empty={kind:"empty-loci",layers:[]};let t;(S=>{S.is=na.has;let d;(M=>(M[M.None=0]="None",M[M.One=1]="One",M[M.Two=2]="Two",M[M.Three=4]="Three",M[M.Four=8]="Four",M[M.Five=16]="Five",M[M.Six=32]="Six"))(d=S.Flag||={});function p(I){return na.create(I)}S.create=p,S.Names={one:1,two:2,three:4,four:8,five:16,six:32};function f(I){return I in S.Names}S.isName=f;function y(I){switch(I){case"one":return 1;case"two":return 2;case"three":return 4;case"four":return 8;case"five":return 16;case"six":return 32}}S.fromName=y;function g(I){let v=0;for(let A=0,_=I.length;A<_;++A)v|=y(I[A]);return v}S.fromNames=g;function x(I){let v=[];return(0,S.is)(I,1)&&v.push("one"),(0,S.is)(I,2)&&v.push("two"),(0,S.is)(I,4)&&v.push("three"),(0,S.is)(I,8)&&v.push("four"),(0,S.is)(I,16)&&v.push("five"),(0,S.is)(I,32)&&v.push("six"),v}S.toNames=x})(t=c.Groups||={});function r(m,d){if(m.layers.length!==d.layers.length)return!1;for(let p=0,h=m.layers.length;p<h;++p)if(m.layers[p].groups!==d.layers[p].groups||!Jt.areEqual(m.layers[p].loci,d.layers[p].loci))return!1;return!0}c.areEqual=r;function n(m){return m.layers.length===0}c.isEmpty=n;function o(m,d){if(m.kind==="element-loci"){let p=[];for(let h of m.layers){let{loci:f,groups:y}=h;f=K.Loci.remap(f,d),K.Loci.isEmpty(f)||p.push({loci:f,groups:y})}return{kind:"element-loci",layers:p}}else return m}c.remap=o;function i(m){if(n(m))return m;if(m.kind==="element-loci"){let{structure:d}=m.layers[0].loci,p=new Map,h=K.Loci.none(d);for(let y=0,g=m.layers.length;y<g;++y){let{loci:x,groups:S}=m.layers[g-y-1];x=K.Loci.subtract(x,h),h=K.Loci.union(x,h),K.Loci.isEmpty(x)||(p.has(S)&&(x=K.Loci.union(x,p.get(S))),p.set(S,x))}let f=[];return p.forEach((y,g)=>{f.push({loci:y,groups:g})}),{kind:"element-loci",layers:f}}else return m}c.merge=i;function a(m,d){if(n(m))return m;if(m.kind==="element-loci"){let{structure:p}=m.layers[0].loci,h=[];for(let f of m.layers){let{loci:y,groups:g}=f,x=K.Loci.remap(y,d);y=K.Loci.remap(x,p),K.Loci.isEmpty(y)||h.push({loci:y,groups:g})}return{kind:"element-loci",layers:h}}else return m}c.filter=a;function s(m,d){let p=[];for(let h=0,f=m.length;h<f;++h){let{script:y,groups:g}=m[h],x=To.toLoci(y,d);K.Loci.isEmpty(x)||p.push({loci:x,groups:g})}return{kind:"element-loci",layers:p}}c.ofScript=s;function l(m,d){let p=[];for(let h=0,f=m.length;h<f;++h){let{bundle:y,groups:g}=m[h],x=K.Bundle.toLoci(y,d.root);p.push({loci:x,groups:g})}return{kind:"element-loci",layers:p}}c.ofBundle=l;function u(m){let d=[];for(let p=0,h=m.layers.length;p<h;++p){let{loci:f,groups:y}=m.layers[p],g=K.Bundle.fromLoci(f);d.push({bundle:g,groups:y})}return{kind:"element-loci",layers:d}}c.toBundle=u})(lo||={});var Nj={};Bi(Nj,{BoxShape3D:()=>YJe,getBoxMesh:()=>Ok});var YJe=Bt.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:re.Root,to:re.Shape.Provider,params:{bottomLeft:C.Vec3(b()),topRight:C.Vec3(b.create(1,1,1)),radius:C.Numeric(.15,{min:.01,max:4,step:.01}),color:C.Color(Lt.red)}})({canAutoUpdate(){return!0},apply({params:e}){return Pe.create("Shape Representation",async t=>new re.Shape.Provider({label:"Box",data:e,params:ft.Params,getShape:(r,n)=>{let o=Ok(ut.create(e.bottomLeft,e.topRight),e.radius);return Gr.create("Box",n,o,()=>n.color,()=>1,()=>"Box")},geometryUtils:ft.Utils},{label:"Box"}))}});function Ok(e,t,r){let n=b.sub(b(),e.max,e.min),o=Z.fromTranslation(Z(),b.create(.5,.5,.5)),i=Z.fromScaling(Z(),n),a=Z.fromTranslation(Z(),e.min),s=Z.mul3(Z(),a,i,o),l=et.createState(256,128,r);l.currentGroup=1,et.addCage(l,s,J0(),t,2,20);let u=et.getMesh(l),c=b.scaleAndAdd(b(),e.min,n,.5),m=b.distance(e.min,c);return u.setBoundingSphere(ye.create(c,m)),u}var kCe={vertices:new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),indices:new Uint32Array([0,2,1,1,2,3])},qwr={vertices:kCe.vertices,edges:new Uint32Array([0,1,2,3,3,1,2,0])};function LCe(){return kCe}var KJe={...ft.Params,color:C.Color(Lt.orange),scaleFactor:C.Numeric(1,{min:.1,max:10,step:.1})},FCe={plane:(e,t)=>ui(e$e,ft.Utils)},Hj={...KJe,visuals:C.MultiSelect(["plane"],C.objectToOptions(FCe))};function JJe(e){return`Best Fit Plane of ${Mx(e,{countsOnly:!0})}`}var Fx=Z(),zj=b();function $Je(e,t,r){let n=et.createState(256,128,r),i=K.Loci.getPrincipalAxesMany(e.locis).boxAxes,a=LCe();return b.add(zj,i.origin,i.dirC),Z.targetTo(Fx,zj,i.origin,i.dirB),Z.scale(Fx,Fx,Vi.size(zj,i)),Z.scaleUniformly(Fx,Fx,t.scaleFactor),Z.setTranslation(Fx,i.origin),n.currentGroup=0,et.addPrimitive(n,Fx,a),et.addPrimitiveFlipped(n,Fx,a),et.getMesh(n)}function e$e(e,t,r,n){let o=$Je(t,r,n&&n.geometry),i=JJe(t.locis);return Gr.create(i,t,o,()=>r.color,()=>1,()=>i)}function VCe(e,t){let r=Vt.createMulti("Plane",e,t,Vt.StateBuilder,FCe);return r.setState({markerActions:Wo.Highlighting}),r}function Wa(e,t){return{kind:e,layers:t}}(u=>{u.Empty={kind:"empty-loci",layers:[]};function t(c,m){if(c.layers.length===0&&m.layers.length===0)return!0;if(c.layers.length!==m.layers.length)return!1;for(let d=0,p=c.layers.length;d<p;++d)if(c.layers[d].clear!==m.layers[d].clear||!eb(c.layers[d].material,m.layers[d].material)||!Jt.areEqual(c.layers[d].loci,m.layers[d].loci))return!1;return!0}u.areEqual=t;function r(c){return c.layers.length===0}u.isEmpty=r;function n(c,m){if(c.kind==="element-loci"){let d=[];for(let p of c.layers){let{loci:h,material:f,clear:y}=p;h=K.Loci.remap(h,m),K.Loci.isEmpty(h)||d.push({loci:h,material:f,clear:y})}return{kind:"element-loci",layers:d}}else return c}u.remap=n;function o(c){if(r(c))return c;if(c.kind==="element-loci"){let{structure:m}=c.layers[0].loci,d,p=new Map,h=K.Loci.none(m);for(let y=0,g=c.layers.length;y<g;++y){let{loci:x,material:S,clear:I}=c.layers[g-y-1];x=K.Loci.subtract(x,h),h=K.Loci.union(x,h),K.Loci.isEmpty(x)||(I?d=d?K.Loci.union(x,d):x:(p.has(S)&&(x=K.Loci.union(x,p.get(S))),p.set(S,x)))}let f=[];return d&&f.push({loci:d,material:Oa(),clear:!0}),p.forEach((y,g)=>{f.push({loci:y,material:g,clear:!1})}),{kind:"element-loci",layers:f}}else return c}u.merge=o;function i(c,m){if(r(c))return c;if(c.kind==="element-loci"){let{structure:d}=c.layers[0].loci,p=[];for(let h of c.layers){let{loci:f,material:y,clear:g}=h,x=K.Loci.remap(f,m);f=K.Loci.remap(x,d),K.Loci.isEmpty(f)||p.push({loci:f,material:y,clear:g})}return{kind:"element-loci",layers:p}}else return c}u.filter=i;function a(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{script:f,material:y,clear:g}=c[p],x=To.toLoci(f,m);K.Loci.isEmpty(x)||d.push({loci:x,material:y,clear:g})}return{kind:"element-loci",layers:d}}u.ofScript=a;function s(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{bundle:f,material:y,clear:g}=c[p],x=K.Bundle.toLoci(f,m.root);d.push({loci:x,material:y,clear:g})}return{kind:"element-loci",layers:d}}u.ofBundle=s;function l(c){let m=[];for(let d=0,p=c.layers.length;d<p;++d){let{loci:h,material:f,clear:y}=c.layers[d],g=K.Bundle.fromLoci(h);m.push({bundle:g,material:f,clear:y})}return{kind:"element-loci",layers:m}}u.toBundle=l})(Wa||={});function Xa(e,t){return{kind:e,layers:t}}(u=>{u.Empty={kind:"empty-loci",layers:[]};function t(c,m){if(c.layers.length===0&&m.layers.length===0)return!0;if(c.layers.length!==m.layers.length)return!1;for(let d=0,p=c.layers.length;d<p;++d)if(c.layers[d].value!==m.layers[d].value||!Jt.areEqual(c.layers[d].loci,m.layers[d].loci))return!1;return!0}u.areEqual=t;function r(c){return c.layers.length===0}u.isEmpty=r;function n(c,m){if(c.kind==="element-loci"){let d=[];for(let p of c.layers){let{loci:h,value:f}=p;h=K.Loci.remap(h,m),K.Loci.isEmpty(h)||d.push({loci:h,value:f})}return{kind:"element-loci",layers:d}}else return c}u.remap=n;function o(c){if(r(c))return c;if(c.kind==="element-loci"){let{structure:m}=c.layers[0].loci,d=new Map,p=K.Loci.none(m);for(let f=0,y=c.layers.length;f<y;++f){let{loci:g,value:x}=c.layers[y-f-1];g=K.Loci.subtract(g,p),p=K.Loci.union(g,p),K.Loci.isEmpty(g)||(d.has(x)&&(g=K.Loci.union(g,d.get(x))),d.set(x,g))}let h=[];return d.forEach((f,y)=>{h.push({loci:f,value:y})}),{kind:"element-loci",layers:h}}else return c}u.merge=o;function i(c,m){if(r(c))return c;if(c.kind==="element-loci"){let{structure:d}=c.layers[0].loci,p=[];for(let h of c.layers){let{loci:f,value:y}=h,g=K.Loci.remap(f,m);f=K.Loci.remap(g,d),K.Loci.isEmpty(f)||p.push({loci:f,value:y})}return{kind:"element-loci",layers:p}}else return c}u.filter=i;function a(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{script:f,value:y}=c[p],g=To.toLoci(f,m);K.Loci.isEmpty(g)||d.push({loci:g,value:y})}return{kind:"element-loci",layers:d}}u.ofScript=a;function s(c,m){let d=[];for(let p=0,h=c.length;p<h;++p){let{bundle:f,value:y}=c[p],g=K.Bundle.toLoci(f,m.root);d.push({loci:g,value:y})}return{kind:"element-loci",layers:d}}u.ofBundle=s;function l(c){let m=[];for(let d=0,p=c.layers.length;d<p;++d){let{loci:h,value:f}=c.layers[d],y=K.Bundle.fromLoci(h);m.push({bundle:y,value:f})}return{kind:"element-loci",layers:m}}u.toBundle=l})(Xa||={});var dd=Bt.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:re.Molecule.Structure,to:re.Molecule.Structure.Representation3D,params:(e,t)=>{let{registry:r,themes:n}=t.representation.structure,o=r.get(r.default.name);if(!e){let s={help:l=>{let{name:u,params:c}=l,d=n.colorThemeRegistry.get(u).factory({},c);return{description:d.description,legend:d.legend}}};return{type:C.Mapped(r.default.name,r.types,l=>C.Group(r.get(l).getParams(n,De.Empty))),colorTheme:C.Mapped(o.defaultColorTheme.name,n.colorThemeRegistry.types,l=>C.Group(n.colorThemeRegistry.get(l).getParams({structure:De.Empty})),s),sizeTheme:C.Mapped(o.defaultSizeTheme.name,n.sizeThemeRegistry.types,l=>C.Group(n.sizeThemeRegistry.get(l).getParams({structure:De.Empty})))}}let i={structure:e.data},a={help:s=>{let{name:l,params:u}=s,m=n.colorThemeRegistry.get(l).factory(i,u);return{description:m.description,legend:m.legend}}};return{type:C.Mapped(r.default.name,r.getApplicableTypes(e.data),s=>C.Group(r.get(s).getParams(n,e.data))),colorTheme:C.Mapped(o.defaultColorTheme.name,n.colorThemeRegistry.getApplicableTypes(i),s=>C.Group(n.colorThemeRegistry.get(s).getParams(i)),a),sizeTheme:C.Mapped(o.defaultSizeTheme.name,n.sizeThemeRegistry.getApplicableTypes(i),s=>C.Group(n.sizeThemeRegistry.get(s).getParams(i)))}}})({canAutoUpdate({a:e,oldParams:t,newParams:r}){return e.data.elementCount<1e4||t.type.name===r.type.name&&r.type.params.quality!=="custom"},apply({a:e,params:t,cache:r},n){return Pe.create("Structure Representation",async o=>{let i={runtime:o,assetManager:n.managers.asset,errorContext:n.errorContext},a=n.representation.structure.registry.get(t.type.name),s=a.getData?.(e.data,t.type.params)||e.data;a.ensureCustomProperties&&await a.ensureCustomProperties.attach(i,s);let l=a.factory({webgl:n.canvas3d?.webgl,...n.representation.structure.themes},a.getParams);await pi.ensureDependencies(i,n.representation.structure.themes,{structure:s},t),l.setTheme(pi.create(n.representation.structure.themes,{structure:s},t));let u=t.type.params||{};return await l.createOrUpdate(u,s).runInContext(o),new re.Molecule.Structure.Representation3D({repr:l,sourceData:e.data},{label:a.label})})},update({a:e,b:t,oldParams:r,newParams:n,cache:o},i){return Pe.create("Structure Representation",async a=>{if(n.type.name!==r.type.name)return Je.UpdateResult.Recreate;let s=i.representation.structure.registry.get(n.type.name);if(s.mustRecreate?.(r.type.params,n.type.params))return Je.UpdateResult.Recreate;let l=s.getData?.(e.data,n.type.params)||e.data,u={runtime:a,assetManager:i.managers.asset,errorContext:i.errorContext};s.ensureCustomProperties&&await s.ensureCustomProperties.attach(u,l),pi.releaseDependencies(i.representation.structure.themes,{structure:t.data.sourceData},r),await pi.ensureDependencies(u,i.representation.structure.themes,{structure:l},n),t.data.repr.setTheme(pi.create(i.representation.structure.themes,{structure:l},n));let c={...t.data.repr.props,...n.type.params};return await t.data.repr.createOrUpdate(c,l).runInContext(a),t.data.sourceData=e.data,Je.UpdateResult.Updated})},dispose({b:e,params:t},r){if(!e||!t)return;let n=e.data.sourceData,o=r.representation.structure.registry.get(t.type.name);o.ensureCustomProperties&&o.ensureCustomProperties.detach(n),pi.releaseDependencies(r.representation.structure.themes,{structure:n},t)},interpolate(e,t,r){if(e.colorTheme.name!=="uniform"||t.colorTheme.name!=="uniform")return r<=.5?e:t;let n=e.colorTheme.params.value,o=t.colorTheme.params.value,i=Fe.interpolate(n,o,r);return{type:r<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:i}},sizeTheme:r<=.5?e.sizeTheme:t.sizeTheme}}}),t$e=Bt.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:{t:C.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=new Py(r);return _j(r,n,t.t),new re.Molecule.Structure.Representation3DState({state:{unitTransforms:n},initialState:{unitTransforms:new Py(r)},info:r,repr:e.data.repr},{label:`Unwind T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info;if(e.data.sourceData!==o)return Je.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return Je.UpdateResult.Recreate;if(n.t===r.t)return Je.UpdateResult.Unchanged;let i=t.data.state.unitTransforms;return _j(o,i,r.t),t.label=`Unwind T = ${r.t.toFixed(2)}`,t.data.repr=e.data.repr,Je.UpdateResult.Updated}}),r$e=Bt.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:{t:C.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=new Py(r);return Rj(r,n,t.t,r.root.boundary.sphere),new re.Molecule.Structure.Representation3DState({state:{unitTransforms:n},initialState:{unitTransforms:new Py(r)},info:r,repr:e.data.repr},{label:`Explode T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=e.data.sourceData;if(t.data.info!==o)return Je.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return Je.UpdateResult.Recreate;if(n.t===r.t)return Je.UpdateResult.Unchanged;let i=t.data.state.unitTransforms;return Rj(o,i,r.t,o.root.boundary.sphere),t.label=`Explode T = ${r.t.toFixed(2)}`,t.data.repr=e.data.repr,Je.UpdateResult.Updated}}),n$e=Bt.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:{t:C.Numeric(0,{min:0,max:1,step:.01}),...sCe}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=new Py(r),{axis:o,origin:i}=Dj(r.root,t);return wj(r,n,t.t,o,i),new re.Molecule.Structure.Representation3DState({state:{unitTransforms:n},initialState:{unitTransforms:new Py(r)},info:r,repr:e.data.repr},{label:`Spin T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=e.data.sourceData;if(t.data.info!==o)return Je.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return Je.UpdateResult.Recreate;if(n.t===r.t&&n.axis===r.axis&&n.origin===r.origin)return Je.UpdateResult.Unchanged;let i=t.data.state.unitTransforms,{axis:a,origin:s}=Dj(o.root,r);return wj(o,i,r.t,a,s),t.label=`Spin T = ${r.t.toFixed(2)}`,t.data.repr=e.data.repr,Je.UpdateResult.Updated}}),o$e=Bt.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({script:C.Script(To("(sel.atom.all)","mol-script")),color:C.Color(Lt.blueviolet),clear:C.Boolean(!1)},e=>`${e.clear?"Clear":Fe.toRgbString(e.color)}`,{defaultValue:[{script:To("(sel.atom.all)","mol-script"),color:Lt.blueviolet,clear:!1}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=Ha.ofScript(t.layers,r);return new re.Molecule.Structure.Representation3DState({state:{overpaint:o},initialState:{overpaint:Ha.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Overpaint (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return Je.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return Je.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&cm(e.data.repr.props))return Je.UpdateResult.Recreate;let s=t.data.state.overpaint,l=Ha.ofScript(r.layers,i);return Ha.areEqual(s,l)?Je.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.overpaint=l,t.data.repr=e.data.repr,t.label=`Overpaint (${l.layers.length} Layers)`,Je.UpdateResult.Updated)}}),i$e=Bt.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({bundle:C.Value(K.Bundle.Empty),color:C.Color(Lt.blueviolet),clear:C.Boolean(!1)},e=>`${e.clear?"Clear":Fe.toRgbString(e.color)}`,{defaultValue:[{bundle:K.Bundle.Empty,color:Lt.blueviolet,clear:!1}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=Ha.ofBundle(t.layers,r);return new re.Molecule.Structure.Representation3DState({state:{overpaint:o},initialState:{overpaint:Ha.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Overpaint (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return Je.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return Je.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&cm(e.data.repr.props))return Je.UpdateResult.Recreate;let s=t.data.state.overpaint,l=Ha.ofBundle(r.layers,i);return Ha.areEqual(s,l)?Je.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.overpaint=l,t.data.repr=e.data.repr,t.label=`Overpaint (${l.layers.length} Layers)`,Je.UpdateResult.Updated)}}),a$e=Bt.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({script:C.Script(To("(sel.atom.all)","mol-script")),value:C.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},e=>`Transparency (${e.value})`,{defaultValue:[{script:To("(sel.atom.all)","mol-script"),value:.5}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=ja.ofScript(t.layers,r);return new re.Molecule.Structure.Representation3DState({state:{transparency:o},initialState:{transparency:ja.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Transparency (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return Je.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return Je.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&cm(e.data.repr.props))return Je.UpdateResult.Recreate;let s=t.data.state.transparency,l=ja.ofScript(r.layers,i);return ja.areEqual(s,l)?Je.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.transparency=l,t.data.repr=e.data.repr,t.label=`Transparency (${l.layers.length} Layers)`,Je.UpdateResult.Updated)}}),s$e=Bt.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({bundle:C.Value(K.Bundle.Empty),value:C.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},e=>`Transparency (${e.value})`,{defaultValue:[{bundle:K.Bundle.Empty,value:.5}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=ja.ofBundle(t.layers,r);return new re.Molecule.Structure.Representation3DState({state:{transparency:o},initialState:{transparency:ja.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Transparency (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return Je.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return Je.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&cm(e.data.repr.props))return Je.UpdateResult.Recreate;let s=t.data.state.transparency,l=ja.ofBundle(r.layers,i);return ja.areEqual(s,l)?Je.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.transparency=l,t.data.repr=e.data.repr,t.label=`Transparency (${l.layers.length} Layers)`,Je.UpdateResult.Updated)}}),l$e=Bt.BuiltIn({name:"emissive-structure-representation-3d-from-script",display:"Emissive 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({script:C.Script(To("(sel.atom.all)","mol-script")),value:C.Numeric(.5,{min:0,max:1,step:.01},{label:"Emissive"})},e=>`Emissive (${e.value})`,{defaultValue:[{script:To("(sel.atom.all)","mol-script"),value:.5}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=Xa.ofScript(t.layers,r);return new re.Molecule.Structure.Representation3DState({state:{emissive:o},initialState:{emissive:Xa.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Emissive (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return Je.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return Je.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&cm(e.data.repr.props))return Je.UpdateResult.Recreate;let s=t.data.state.emissive,l=Xa.ofScript(r.layers,i);return Xa.areEqual(s,l)?Je.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.emissive=l,t.data.repr=e.data.repr,t.label=`Emissive (${l.layers.length} Layers)`,Je.UpdateResult.Updated)}}),u$e=Bt.BuiltIn({name:"emissive-structure-representation-3d-from-bundle",display:"Emissive 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({bundle:C.Value(K.Bundle.Empty),value:C.Numeric(.5,{min:0,max:1,step:.01},{label:"Emissive"})},e=>`Emissive (${e.value})`,{defaultValue:[{bundle:K.Bundle.Empty,value:.5}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=Xa.ofBundle(t.layers,r);return new re.Molecule.Structure.Representation3DState({state:{emissive:o},initialState:{emissive:Xa.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Emissive (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return Je.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return Je.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&cm(e.data.repr.props))return Je.UpdateResult.Recreate;let s=t.data.state.emissive,l=Xa.ofBundle(r.layers,i);return Xa.areEqual(s,l)?Je.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.emissive=l,t.data.repr=e.data.repr,t.label=`Emissive (${l.layers.length} Layers)`,Je.UpdateResult.Updated)}}),c$e=Bt.BuiltIn({name:"substance-structure-representation-3d-from-script",display:"Substance 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({script:C.Script(To("(sel.atom.all)","mol-script")),material:Oa.getParam(),clear:C.Boolean(!1)},e=>`${e.clear?"Clear":Oa.toString(e.material)}`,{defaultValue:[{script:To("(sel.atom.all)","mol-script"),material:Oa({roughness:1}),clear:!1}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=Wa.ofScript(t.layers,r);return new re.Molecule.Structure.Representation3DState({state:{substance:o},initialState:{substance:Wa.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Substance (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return Je.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return Je.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&cm(e.data.repr.props))return Je.UpdateResult.Recreate;let s=t.data.state.substance,l=Wa.ofScript(r.layers,i);return Wa.areEqual(s,l)?Je.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.substance=l,t.data.repr=e.data.repr,t.label=`Substance (${l.layers.length} Layers)`,Je.UpdateResult.Updated)}}),m$e=Bt.BuiltIn({name:"substance-structure-representation-3d-from-bundle",display:"Substance 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({bundle:C.Value(K.Bundle.Empty),material:Oa.getParam(),clear:C.Boolean(!1)},e=>`${e.clear?"Clear":Oa.toString(e.material)}`,{defaultValue:[{bundle:K.Bundle.Empty,material:Oa({roughness:1}),clear:!1}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=Wa.ofBundle(t.layers,r);return new re.Molecule.Structure.Representation3DState({state:{substance:o},initialState:{substance:Wa.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Substance (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return Je.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return Je.UpdateResult.Recreate;let a=e.data.repr.geometryVersion;if(a!==o.geometryVersion&&cm(e.data.repr.props))return Je.UpdateResult.Recreate;let s=t.data.state.substance,l=Wa.ofBundle(r.layers,i);return Wa.areEqual(s,l)?Je.UpdateResult.Unchanged:(o.geometryVersion=a,t.data.state.substance=l,t.data.repr=e.data.repr,t.label=`Substance (${l.layers.length} Layers)`,Je.UpdateResult.Updated)}}),d$e=Bt.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({script:C.Script(To("(sel.atom.all)","mol-script")),groups:C.Converted(e=>lo.Groups.toNames(e),e=>lo.Groups.fromNames(e),C.MultiSelect($C(lo.Groups.Names),C.objectToOptions(lo.Groups.Names)))},e=>`${lo.Groups.toNames(e.groups).length} group(s)`,{defaultValue:[{script:To("(sel.atom.all)","mol-script"),groups:lo.Groups.Flag.None}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=lo.ofScript(t.layers,r);return new re.Molecule.Structure.Representation3DState({state:{clipping:n},initialState:{clipping:lo.Empty},info:r,repr:e.data.repr},{label:`Clipping (${n.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info;if(e.data.sourceData!==o)return Je.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return Je.UpdateResult.Recreate;let i=t.data.state.clipping,a=lo.ofScript(r.layers,o);return lo.areEqual(i,a)?Je.UpdateResult.Unchanged:(t.data.state.clipping=a,t.data.repr=e.data.repr,t.label=`Clipping (${a.layers.length} Layers)`,Je.UpdateResult.Updated)}}),p$e=Bt.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:()=>({layers:C.ObjectList({bundle:C.Value(K.Bundle.Empty),groups:C.Converted(e=>lo.Groups.toNames(e),e=>lo.Groups.fromNames(e),C.MultiSelect($C(lo.Groups.Names),C.objectToOptions(lo.Groups.Names)))},e=>`${lo.Groups.toNames(e.groups).length} group(s)`,{defaultValue:[{bundle:K.Bundle.Empty,groups:lo.Groups.Flag.None}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=lo.ofBundle(t.layers,r);return new re.Molecule.Structure.Representation3DState({state:{clipping:n},initialState:{clipping:lo.Empty},info:r,repr:e.data.repr},{label:`Clipping (${n.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info;if(e.data.sourceData!==o)return Je.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return Je.UpdateResult.Recreate;let i=t.data.state.clipping,a=lo.ofBundle(r.layers,o);return lo.areEqual(i,a)?Je.UpdateResult.Unchanged:(t.data.state.clipping=a,t.data.repr=e.data.repr,t.label=`Clipping (${a.layers.length} Layers)`,Je.UpdateResult.Updated)}}),f$e=Bt.BuiltIn({name:"theme-strength-representation-3d",display:"Theme Strength 3D Representation",from:re.Molecule.Structure.Representation3D,to:re.Molecule.Structure.Representation3DState,params:()=>({overpaintStrength:C.Numeric(1,{min:0,max:1,step:.01}),transparencyStrength:C.Numeric(1,{min:0,max:1,step:.01}),emissiveStrength:C.Numeric(1,{min:0,max:1,step:.01}),substanceStrength:C.Numeric(1,{min:0,max:1,step:.01})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){return new re.Molecule.Structure.Representation3DState({state:{themeStrength:{overpaint:t.overpaintStrength,transparency:t.transparencyStrength,emissive:t.emissiveStrength,substance:t.substanceStrength}},initialState:{themeStrength:{overpaint:1,transparency:1,emissive:1,substance:1}},info:{},repr:e.data.repr},{label:"Theme Strength",description:`${t.overpaintStrength.toFixed(2)}, ${t.transparencyStrength.toFixed(2)}, ${t.emissiveStrength.toFixed(2)}, ${t.substanceStrength.toFixed(2)}`})},update({a:e,b:t,newParams:r,oldParams:n}){return r.overpaintStrength===t.data.state.themeStrength?.overpaint&&r.transparencyStrength===t.data.state.themeStrength?.transparency&&r.emissiveStrength===t.data.state.themeStrength?.emissive&&r.substanceStrength===t.data.state.themeStrength?.substance?Je.UpdateResult.Unchanged:(t.data.state.themeStrength={overpaint:r.overpaintStrength,transparency:r.transparencyStrength,emissive:r.emissiveStrength,substance:r.substanceStrength},t.data.repr=e.data.repr,t.label="Theme Strength",t.description=`${r.overpaintStrength.toFixed(2)}, ${r.transparencyStrength.toFixed(2)}, ${r.emissiveStrength.toFixed(2)}, ${r.substanceStrength.toFixed(2)}`,Je.UpdateResult.Updated)},interpolate(e,t,r){return{overpaintStrength:$n(e.overpaintStrength,t.overpaintStrength,r),transparencyStrength:$n(e.transparencyStrength,t.transparencyStrength,r),emissiveStrength:$n(e.emissiveStrength,t.emissiveStrength,r),substanceStrength:$n(e.substanceStrength,t.substanceStrength,r)}}}),Cf;(n=>{function e(o,i,a,s,l,u,c,m){let d=o.representation.volume.registry.get(i),p=o.representation.volume.themes.colorThemeRegistry.get(l||d.defaultColorTheme.name),h=o.representation.volume.themes.sizeThemeRegistry.get(c||d.defaultSizeTheme.name),f=C.getDefaultValues(d.getParams(o.representation.volume.themes,a));return{type:{name:i,params:s?{...f,...s}:f},colorTheme:{name:p.name,params:u?{...p.defaultValues,...u}:p.defaultValues},sizeTheme:{name:h.name,params:m?{...h.defaultValues,...m}:h.defaultValues}}}n.getDefaultParams=e;function t(o,i,a,s,l,u,c){let m=o.representation.volume.registry.get(i),d=o.representation.volume.themes.colorThemeRegistry.get(s||m.defaultColorTheme.name),p=o.representation.volume.themes.sizeThemeRegistry.get(u||m.defaultSizeTheme.name);return{type:{name:i,params:a?{...m.defaultValues,...a}:m.defaultValues},colorTheme:{name:m.defaultColorTheme.name,params:l?{...d.defaultValues,...l}:d.defaultValues},sizeTheme:{name:m.defaultSizeTheme.name,params:c?{...p.defaultValues,...c}:p.defaultValues}}}n.getDefaultParamsStatic=t;function r(o){if(o.isoValue)return Ve.IsoValue.toString(o.isoValue);if(o.renderMode?.params?.isoValue)return Ve.IsoValue.toString(o.renderMode?.params?.isoValue)}n.getDescription=r})(Cf||={});var jj=Bt.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:re.Volume.Data,to:re.Volume.Representation3D,params:(e,t)=>{let{registry:r,themes:n}=t.representation.volume,o=r.get(r.default.name);if(!e)return{type:C.Mapped(r.default.name,r.types,a=>C.Group(r.get(a).getParams(n,Ve.One))),colorTheme:C.Mapped(o.defaultColorTheme.name,n.colorThemeRegistry.types,a=>C.Group(n.colorThemeRegistry.get(a).getParams({volume:Ve.One}))),sizeTheme:C.Mapped(o.defaultSizeTheme.name,n.sizeThemeRegistry.types,a=>C.Group(n.sizeThemeRegistry.get(a).getParams({volume:Ve.One})))};let i={volume:e.data};return{type:C.Mapped(r.default.name,r.types,a=>C.Group(r.get(a).getParams(n,e.data))),colorTheme:C.Mapped(o.defaultColorTheme.name,n.colorThemeRegistry.getApplicableTypes(i),a=>C.Group(n.colorThemeRegistry.get(a).getParams(i))),sizeTheme:C.Mapped(o.defaultSizeTheme.name,n.sizeThemeRegistry.getApplicableTypes(i),a=>C.Group(n.sizeThemeRegistry.get(a).getParams(i)))}}})({canAutoUpdate({oldParams:e,newParams:t}){return e.type.name===t.type.name},apply({a:e,params:t},r){return Pe.create("Volume Representation",async n=>{let o={runtime:n,assetManager:r.managers.asset,errorContext:r.errorContext},i=r.representation.volume.registry.get(t.type.name);i.ensureCustomProperties&&await i.ensureCustomProperties.attach(o,e.data);let a=i.factory({webgl:r.canvas3d?.webgl,...r.representation.volume.themes},i.getParams);a.setTheme(pi.create(r.representation.volume.themes,{volume:e.data,locationKinds:i.locationKinds},t));let s=t.type.params||{};return await a.createOrUpdate(s,e.data).runInContext(n),new re.Volume.Representation3D({repr:a,sourceData:e.data},{label:i.label,description:Cf.getDescription(s)})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Pe.create("Volume Representation",async i=>{let a=o.representation.volume.registry.get(r.type.name);if(n.type.name!==r.type.name)return a.ensureCustomProperties?.detach(e.data),Je.UpdateResult.Recreate;let s={...t.data.repr.props,...n.type.params};return t.data.repr.setTheme(pi.create(o.representation.volume.themes,{volume:e.data,locationKinds:a.locationKinds},n)),await t.data.repr.createOrUpdate(s,e.data).runInContext(i),t.data.sourceData=e.data,t.description=Cf.getDescription(s),Je.UpdateResult.Updated})}});var h$e=Bt.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:re.Shape.Provider,to:re.Shape.Representation3D,params:(e,t)=>e?e.data.params:We.Params})({canAutoUpdate(){return!0},apply({a:e,params:t}){return Pe.create("Shape Representation",async r=>{let n={...C.getDefaultValues(e.data.params),...t},o=ui(e.data.getShape,e.data.geometryUtils);return await o.createOrUpdate(n,e.data.data).runInContext(r),new re.Shape.Representation3D({repr:o,sourceData:e.data},{label:e.data.label})})},update({a:e,b:t,newParams:r}){return Pe.create("Shape Representation",async n=>{let o={...t.data.repr.props,...r};return await t.data.repr.createOrUpdate(o,e.data.data).runInContext(n),t.data.sourceData=e.data,Je.UpdateResult.Updated})}});var g$e=Bt.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:re.Molecule.Model,to:re.Shape.Representation3D,params:()=>({...Ej})})({isApplicable:e=>!!wo.Provider.get(e.data),canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Pe.create("Model Unit Cell",async n=>{let o=wo.Provider.get(e.data);if(!o)return An.Null;let i=Mj(e.data,o,t),a=uCe({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>Ej);return await a.createOrUpdate(t,i).runInContext(n),new re.Shape.Representation3D({repr:a,sourceData:i},{label:"Unit Cell",description:o.spacegroup.name})})},update({a:e,b:t,newParams:r}){return Pe.create("Model Unit Cell",async n=>{let o=wo.Provider.get(e.data);if(!o)return Je.UpdateResult.Null;let i={...t.data.repr.props,...r},a=Mj(e.data,o,i);return await t.data.repr.createOrUpdate(i,a).runInContext(n),t.data.sourceData=a,Je.UpdateResult.Updated})}});var y$e=Bt.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:re.Molecule.Structure,to:re.Shape.Representation3D,params:{radius:C.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:C.Color(Lt.red,{isEssential:!0}),...ft.Params}})({canAutoUpdate(){return!0},apply({a:e,params:t},r){return Pe.create("Bounding Box",async n=>{let o=ui((i,a,s,l)=>{let u=Ok(a.box,a.radius,l?.geometry);return Gr.create("Bouding Box",a,u,()=>a.color,()=>1,()=>"Bounding Box")},ft.Utils);return await o.createOrUpdate(t,{box:e.data.boundary.box,radius:t.radius,color:t.color}).runInContext(n),new re.Shape.Representation3D({repr:o,sourceData:e.data},{label:"Bounding Box"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Pe.create("Bounding Box",async i=>(await t.data.repr.createOrUpdate(n,{box:e.data.boundary.box,radius:n.radius,color:n.color}).runInContext(i),t.data.sourceData=e.data,Je.UpdateResult.Updated))}});var b$e=Bt.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:re.Molecule.Structure.Selections,to:re.Shape.Representation3D,params:()=>({...kj})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Pe.create("Structure Distance",async n=>{let o=ij(e.data),i=gCe({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>kj);return await i.createOrUpdate(t,o).runInContext(n),new re.Shape.Representation3D({repr:i,sourceData:o},{label:"Distance"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Pe.create("Structure Distance",async i=>{let a={...t.data.repr.props,...n},s=ij(e.data);return await t.data.repr.createOrUpdate(a,s).runInContext(i),t.data.sourceData=s,Je.UpdateResult.Updated})}});var x$e=Bt.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:re.Molecule.Structure.Selections,to:re.Shape.Representation3D,params:()=>({...Gj})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Pe.create("Structure Angle",async n=>{let o=aj(e.data),i=DCe({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>Gj);return await i.createOrUpdate(t,o).runInContext(n),new re.Shape.Representation3D({repr:i,sourceData:o},{label:"Angle"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Pe.create("Structure Angle",async i=>{let a={...t.data.repr.props,...n},s=aj(e.data);return await t.data.repr.createOrUpdate(a,s).runInContext(i),t.data.sourceData=s,Je.UpdateResult.Updated})}});var C$e=Bt.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:re.Molecule.Structure.Selections,to:re.Shape.Representation3D,params:()=>({...Uj})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Pe.create("Structure Dihedral",async n=>{let o=sj(e.data),i=BCe({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>Uj);return await i.createOrUpdate(t,o).runInContext(n),new re.Shape.Representation3D({repr:i,sourceData:o},{label:"Dihedral"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Pe.create("Structure Dihedral",async i=>{let a={...t.data.repr.props,...n},s=sj(e.data);return await t.data.repr.createOrUpdate(a,s).runInContext(i),t.data.sourceData=s,Je.UpdateResult.Updated})}});var S$e=Bt.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:re.Molecule.Structure.Selections,to:re.Shape.Representation3D,params:()=>({...Lj})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Pe.create("Structure Label",async n=>{let o=lj(e.data),i=bCe({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>Lj);await i.createOrUpdate(t,o).runInContext(n);let a=!!(t.snapshotKey?.trim()||t.tooltip?.trim());return i.setState({pickable:a,markerActions:a?Wo.Highlighting:0}),new re.Shape.Representation3D({repr:i,sourceData:o},{label:"Label"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Pe.create("Structure Label",async i=>{let a={...t.data.repr.props,...n},s=lj(e.data);await t.data.repr.createOrUpdate(a,s).runInContext(i),t.data.sourceData=s;let l=!!(n.snapshotKey?.trim()||n.tooltip?.trim());return t.data.repr.setState({pickable:l,markerActions:l?Wo.Highlighting:0}),Je.UpdateResult.Updated})}});var v$e=Bt.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:re.Molecule.Structure.Selections,to:re.Shape.Representation3D,params:()=>({...Oj})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Pe.create("Structure Orientation",async n=>{let o=uj(e.data),i=ACe({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>Oj);return await i.createOrUpdate(t,o).runInContext(n),new re.Shape.Representation3D({repr:i,sourceData:o},{label:"Orientation"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Pe.create("Structure Orientation",async i=>{let a={...t.data.repr.props,...n},s=uj(e.data);return await t.data.repr.createOrUpdate(a,s).runInContext(i),t.data.sourceData=s,Je.UpdateResult.Updated})}});var I$e=Bt.BuiltIn({name:"structure-selections-plane-3d",display:"3D Plane",from:re.Molecule.Structure.Selections,to:re.Shape.Representation3D,params:()=>({...Hj})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return Pe.create("Structure Plane",async n=>{let o=cj(e.data),i=VCe({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},()=>Hj);return await i.createOrUpdate(t,o).runInContext(n),new re.Shape.Representation3D({repr:i,sourceData:o},{label:"Plane"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return Pe.create("Structure Plane",async i=>{let a={...t.data.repr.props,...n},s=cj(e.data);return await t.data.repr.createOrUpdate(a,s).runInContext(i),t.data.sourceData=s,Je.UpdateResult.Updated})}});var Xe={Data:x7,Misc:C7,Model:yj,Volume:vj,Representation:Wj,Shape:Nj};function Yn(e,t,r={}){let n;return{label:e,expression:t,description:r.description||"",category:r.category??"Miscellaneous",isHidden:!!r.isHidden,priority:r.priority||0,referencesCurrent:!!r.referencesCurrent,get query(){return n||(n=Ic(t)),n},ensureCustomProperties:r.ensureCustomProperties,async getSelection(o,i,a){let s=o.managers.structure.selection.getStructure(a),l=s?at.Sequence(a,[s]):at.Empty(a);return r.ensureCustomProperties&&await r.ensureCustomProperties({runtime:i,assetManager:o.managers.asset},a),n||(n=Ic(t)),n(new ai(a,{currentSelection:l}))}}}var A$e=Yn("All",ne.struct.generator.all(),{category:"",priority:1e3}),T$e=Yn("Current Selection",ne.internal.generator.current(),{category:"",referencesCurrent:!0}),P$e=Yn("Polymer",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.logic.and([ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),ne.core.str.match([ne.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),ne.ammp("entitySubtype")])])})]),{category:"Type"}),_$e=Yn("Trace",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.set.has([ne.set("sphere","gaussian"),ne.ammp("objectPrimitive")])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"atom-test":ne.core.set.has([ne.set("CA","P"),ne.ammp("label_atom_id")])})])])]),{category:"Structure Property"}),FI=ne.core.logic.and([ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),ne.core.str.match([ne.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),ne.ammp("entitySubtype")])]),Uk=ne.core.logic.and([ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),ne.core.str.match([ne.re("(nucleotide|peptide nucleic acid)","i"),ne.ammp("entitySubtype")])]),dS=ne.core.str.match([ne.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),ne.ammp("chemCompType")]),R$e=Yn("Backbone",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":FI,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([dS]),"atom-test":ne.core.set.has([ne.set(...no.toArray(Ym)),ne.ammp("label_atom_id")])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":Uk,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([dS]),"atom-test":ne.core.set.has([ne.set(...no.toArray(Pv)),ne.ammp("label_atom_id")])})])])]),{category:"Structure Property"}),D$e=Yn("Sidechain",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":FI,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([dS]),"atom-test":ne.core.logic.or([ne.core.logic.not([ne.core.set.has([ne.set(...no.toArray(Ym)),ne.ammp("label_atom_id")])])])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":Uk,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([dS]),"atom-test":ne.core.logic.or([ne.core.logic.not([ne.core.set.has([ne.set(...no.toArray(Pv)),ne.ammp("label_atom_id")])])])})])])]),{category:"Structure Property"}),w$e=Yn("Sidechain with Trace",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":FI,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([dS]),"atom-test":ne.core.logic.or([ne.core.logic.not([ne.core.set.has([ne.set(...no.toArray(Ym)),ne.ammp("label_atom_id")])]),ne.core.rel.eq([ne.ammp("label_atom_id"),"CA"]),ne.core.logic.and([ne.core.rel.eq([ne.ammp("auth_comp_id"),"PRO"]),ne.core.rel.eq([ne.ammp("label_atom_id"),"N"])])])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":Uk,"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([dS]),"atom-test":ne.core.logic.or([ne.core.logic.not([ne.core.set.has([ne.set(...no.toArray(Pv)),ne.ammp("label_atom_id")])]),ne.core.rel.eq([ne.ammp("label_atom_id"),"P"])])})])])]),{category:"Structure Property"}),E$e=Yn("Protein",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":FI})]),{category:"Type"}),M$e=Yn("Nucleic",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":Uk})]),{category:"Type"}),B$e=Yn("Helix",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":FI,"residue-test":ne.core.flags.hasAny([ne.ammp("secondaryStructureFlags"),ne.core.type.bitflags([Kt.Flag.Helix])])})]),{category:"Structure Property",ensureCustomProperties:(e,t)=>zs.attach(e,t)}),k$e=Yn("Beta Strand/Sheet",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":FI,"residue-test":ne.core.flags.hasAny([ne.ammp("secondaryStructureFlags"),ne.core.type.bitflags([Kt.Flag.Beta])])})]),{category:"Structure Property",ensureCustomProperties:(e,t)=>zs.attach(e,t)}),L$e=Yn("Water",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"water"])})]),{category:"Type"}),F$e=Yn("Ion",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entitySubtype"),"ion"])})]),{category:"Type"}),V$e=Yn("Lipid",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entitySubtype"),"lipid"])})]),{category:"Type"}),Nk=Yn("Carbohydrate",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.logic.or([ne.core.rel.eq([ne.ammp("entityType"),"branched"]),ne.core.logic.and([ne.core.rel.eq([ne.ammp("entityType"),"non-polymer"]),ne.core.str.match([ne.re("oligosaccharide","i"),ne.ammp("entitySubtype")])])])})]),{category:"Type"}),OCe=Yn("Carbohydrate with Connected",ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:Nk.expression,"layer-count":1,"as-whole-residues":!0})]),{category:"Internal",isHidden:!0}),GCe=Yn("Connected to Carbohydrate",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:OCe.expression,by:Nk.expression})]),{category:"Internal",isHidden:!0}),Qj=Yn("Ligand",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.logic.and([ne.core.logic.or([ne.core.rel.eq([ne.ammp("entityType"),"non-polymer"]),ne.core.rel.neq([ne.ammp("entityPrdId"),""])]),ne.core.logic.not([ne.core.str.match([ne.re("(oligosaccharide|lipid|ion)","i"),ne.ammp("entitySubtype")])])]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.logic.not([ne.core.str.match([ne.re("saccharide","i"),ne.ammp("chemCompType")])])})]),ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":dS})])])]),by:ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.set.has([ne.set(...no.toArray(ey)),ne.ammp("label_comp_id")])})]),ne.struct.generator.atomGroups({"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.core.set.has([ne.set(...no.toArray(_se)),ne.ammp("label_comp_id")])})])})]),{category:"Type"}),UCe=Yn("Ligand with Connected",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:Qj.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":ne.core.flags.hasAny([ne.struct.bondProperty.flags(),ne.core.type.bitflags([ht.Flag.Covalent|ht.Flag.MetallicCoordination])])})]),by:Nk.expression})]),{category:"Internal",isHidden:!0}),NCe=Yn("Connected to Ligand",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:UCe.expression,by:Qj.expression})]),{category:"Internal",isHidden:!0}),O$e=Yn("Connected to Ligand or Carbohydrate",ne.struct.modifier.union([ne.struct.combinator.merge([GCe.expression,NCe.expression])]),{category:"Internal",isHidden:!0}),G$e=Yn("Disulfide Bridges",ne.struct.modifier.union([ne.struct.combinator.merge([ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.filter.isConnectedTo({0:ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set("CYS"),ne.ammp("auth_comp_id")]),"atom-test":ne.core.set.has([ne.set("SG"),ne.ammp("label_atom_id")])}),target:ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set("CYS"),ne.ammp("auth_comp_id")]),"atom-test":ne.core.set.has([ne.set("SG"),ne.ammp("label_atom_id")])}),"bond-test":!0})])]),ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.modifier.union([ne.struct.generator.bondedAtomicPairs({0:ne.core.flags.hasAny([ne.struct.bondProperty.flags(),ne.core.type.bitflags([ht.Flag.Disulfide])])})])])])])]),{category:"Bond Property"}),U$e=Yn("NOS Bridges",ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.filter.isConnectedTo({0:ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set("CSO","LYS"),ne.ammp("auth_comp_id")]),"atom-test":ne.core.set.has([ne.set("OD","NZ"),ne.ammp("label_atom_id")])}),target:ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set("CSO","LYS"),ne.ammp("auth_comp_id")]),"atom-test":ne.core.set.has([ne.set("OD","NZ"),ne.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:"Bond Property"}),N$e=Yn("Non-standard Residues in Polymers",ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.rel.eq([ne.ammp("entityType"),"polymer"]),"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":ne.ammp("isNonStandard")})]),{category:"Residue Property"}),z$e=Yn("Coarse Elements",ne.struct.modifier.union([ne.struct.generator.atomGroups({"chain-test":ne.core.set.has([ne.set("sphere","gaussian"),ne.ammp("objectPrimitive")])})]),{category:"Type"}),H$e=Yn("Rings in Residues",ne.struct.modifier.union([ne.struct.generator.rings()]),{category:"Residue Property"}),j$e=Yn("Aromatic Rings in Residues",ne.struct.modifier.union([ne.struct.generator.rings({"only-aromatic":!0})]),{category:"Residue Property"}),W$e=Yn("Surrounding Residues (5 \u212B) of Selection",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.modifier.includeSurroundings({0:ne.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:ne.internal.generator.current()})]),{description:"Select residues within 5 \u212B of the current selection.",category:"Manipulate Selection",referencesCurrent:!0}),X$e=Yn("Surrounding Ligands (5 \u212B) of Selection",ne.struct.modifier.union([ne.struct.modifier.surroundingLigands({0:ne.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5 \u212B of the current selection.",category:"Manipulate Selection",referencesCurrent:!0}),Q$e=Yn("Surrounding Atoms (5 \u212B) of Selection",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.modifier.includeSurroundings({0:ne.internal.generator.current(),radius:5,"as-whole-residues":!1}),by:ne.internal.generator.current()})]),{description:"Select atoms within 5 \u212B of the current selection.",category:"Manipulate Selection",referencesCurrent:!0}),Z$e=Yn("Inverse / Complement of Selection",ne.struct.modifier.union([ne.struct.modifier.exceptBy({0:ne.struct.generator.all(),by:ne.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:"Manipulate Selection",referencesCurrent:!0}),q$e=Yn("Residues Covalently Bonded to Selection",ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:ne.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:"Manipulate Selection",referencesCurrent:!0}),Y$e=Yn("Covalently Bonded Component",ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:ne.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:"Manipulate Selection",referencesCurrent:!0}),K$e=Yn("Residues with Cov. or Metallic Bond to Selection",ne.struct.modifier.union([ne.struct.modifier.includeConnected({0:ne.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":ne.core.flags.hasAny([ne.struct.bondProperty.flags(),ne.core.type.bitflags([ht.Flag.Covalent|ht.Flag.MetallicCoordination])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:"Manipulate Selection",referencesCurrent:!0}),J$e=Yn("Whole Residues of Selection",ne.struct.modifier.union([ne.struct.modifier.wholeResidues({0:ne.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:"Manipulate Selection",referencesCurrent:!0}),$$e=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort((e,t)=>e[1]<t[1]?-1:e[1]>t[1]?1:0),eet=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort((e,t)=>e[1]<t[1]?-1:e[1]>t[1]?1:0);function Xj([e,t],r,n=0){let o=e.length===1&&!zCe.has(e[0])?`[${e[0]}] ${t}`:`${t} (${e.join(", ")})`;return Yn(o,ne.struct.modifier.union([ne.struct.generator.atomGroups({"residue-test":ne.core.set.has([ne.set(...e),ne.ammp("auth_comp_id")])})]),{category:r,priority:n,description:o})}function tet([e,t],r,n){let o=`${t} (${e.join(", ")})`;return Yn(o,ne.struct.modifier.union([ne.struct.generator.atomGroups({"atom-test":ne.core.set.has([ne.set(...e),ne.acp("elementSymbol")])})]),{category:r,priority:n,description:o})}function ret([e,t],r,n){let o=`${t}`;return Yn(`${t}`,ne.struct.modifier.union([ne.struct.generator.atomGroups({"entity-test":ne.core.list.equal([ne.list(...e),ne.ammp("entityDescription")])})]),{category:r,priority:n,description:o})}var zCe=no.unionMany(iM,Rv,Dv,_v);function HCe(e){let t=new Set;for(let n of e)n.uniqueElementSymbols.forEach(o=>t.add(o));let r=[];return t.forEach(n=>{let o=Lle[n]||n;r.push(tet([[n],o],"Element Symbol",0))}),r}function jCe(e){let t=new Map,r=new Set;for(let o of e){o.uniqueResidueNames.forEach(i=>r.add(i));for(let i of o.models)o.uniqueResidueNames.forEach(a=>{let s=i.properties.chemicalComponentMap.get(a);s&&t.set(a,s.name)})}let n=[];return no.difference(r,zCe).forEach(o=>{let i=t.get(o)||o;n.push(Xj([[o],i],"Ligand/Non-standard Residue",200))}),n}function WCe(e){let t=new Map,r=K.Location.create();for(let o of e){r.structure=o;for(let i of o.unitSymmetryGroups){r.unit=i.units[0],r.element=i.elements[0];let a=qe.entity.type(r);if(a==="polymer"||a==="branched"){let s=qe.entity.pdbx_description(r);t.set(s.join(", "),s)}}}let n=[];return t.forEach((o,i)=>{n.push(ret([o,i],"Polymer/Carbohydrate Entities",300))}),n}var li={all:A$e,current:T$e,polymer:P$e,trace:_$e,backbone:R$e,sidechain:D$e,sidechainWithTrace:w$e,protein:E$e,nucleic:M$e,helix:B$e,beta:k$e,water:L$e,ion:F$e,lipid:V$e,branched:Nk,branchedPlusConnected:OCe,branchedConnectedOnly:GCe,ligand:Qj,ligandPlusConnected:UCe,ligandConnectedOnly:NCe,connectedOnly:O$e,disulfideBridges:G$e,nosBridges:U$e,nonStandardPolymer:N$e,coarse:z$e,ring:H$e,aromaticRing:j$e,surroundings:W$e,surroundingLigands:X$e,surroundingAtoms:Q$e,complement:Z$e,covalentlyBonded:q$e,covalentlyOrMetallicBonded:K$e,covalentlyBondedComponent:Y$e,wholeResidues:J$e},Gk=class{constructor(){this.list=[];this.options=[];this.version=1;this.list.push(...Object.values(li),...$$e.map(t=>Xj(t,"Amino Acid")),...eet.map(t=>Xj(t,"Nucleic Base"))),this.options.push(...this.list.map(t=>[t,t.label,t.category]))}add(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1}remove(t){let r=this.list.indexOf(t);r!==-1&&(this.list.splice(r,1),this.options.splice(r,1),this.version+=1)}};var net="Assigns a color based on structure property at a given vertex.",XCe={structure:C.ValueRef(e=>e.state.data.select(er.Generators.rootsOfType(re.Molecule.Structure)).filter(r=>r.obj?.data).map(r=>[r.transform.ref,r.obj?.label??"<unknown>"]),(e,t)=>t(e)),style:C.MappedStatic("chain-id",{"chain-id":C.Group(Ch),"entity-id":C.Group(vh),"entity-source":C.Group(Ah),"molecule-type":C.Group(Sx),"model-index":C.Group(Ph),"structure-index":C.Group(Rh)}),defaultColor:C.Color(13421772),maxDistance:C.Numeric(8,{min:.1,max:24,step:.1},{description:"Maximum distance to search for the nearest structure element. This is done only if the approximate search fails."}),approxMaxDistance:C.Numeric(4,{min:0,max:12,step:.1},{description:"Maximum distance to search for an approximately nearest structure element. This is done before the extact search."}),normalOffset:C.Numeric(0,{min:-10,max:20,step:.1},{description:"Offset vertex position along its normal by given amount."}),backboneOnly:C.Boolean(!1)};function oet(e,t){switch(t.name){case"chain-id":return Sh(e,t.params);case"entity-id":return Ih(e,t.params);case"entity-source":return Th(e,t.params);case"molecule-type":return vx(e,t.params);case"model-index":return _h(e,t.params);case"structure-index":return Dh(e,t.params);default:Rr(t)}}function QCe(e,t){let r;try{r=t.structure.getValue()}catch{}let n,o,i,{maxDistance:a,approxMaxDistance:s,normalOffset:l,defaultColor:u,backboneOnly:c}=t;if(r){let m=oet({...e,structure:r},t.style),d=Gv(),p=Gv(),h=r;c&&(h=at.unionStructure(li.backbone.query(new ai(r))));let f=b(),y=K.Location.create(h);n=(g,x)=>{if(!iI(g))return u;l!==0?b.scaleAndAdd(f,g.position,g.normal,l):b.copy(f,g.position);let[S,I,v]=f;if(s>0){let _=h.lookup3d.approxNearest(S,I,v,s,d);if(_.count>0)return y.unit=_.units[0],y.element=y.unit.elements[_.indices[0]],m.color(y,x)}let A=h.lookup3d.find(S,I,v,a,p);if(A.count>0){let _=0,T=A.squaredDistances[0];for(let w=1;w<A.count;++w)A.squaredDistances[w]<T&&(T=A.squaredDistances[w],_=w);return y.unit=A.units[_],y.element=y.unit.elements[A.indices[_]],m.color(y,x)}return u},o=m.contextHash,i=m.legend}else n=()=>u;return{factory:QCe,granularity:"vertex",preferSmoothing:!0,color:n,props:t,contextHash:o,description:net,legend:i}}var ZCe={name:"external-structure",label:"External Structure",category:ur.Misc,factory:QCe,getParams:()=>XCe,defaultValues:C.getDefaultValues(XCe),isApplicable:e=>!0};var Zj="dark-2",qCe=13421772,iet="Gives every volume instance a unique color based on the position (index) of the instance in the list of instances of the volume.",YCe={...Ho({type:"colors",colorList:Zj})};function aet(e){let t=C.clone(YCe);return e.volume&&e.volume.instances.length>lr[Zj].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:Ma(Zj).list}}),t}function KCe(e,t){let r,n;if(e.volume){let o=Jo(e.volume.instances.length,t);n=o.legend;let i=Ve.Cell.isLocation;r=a=>i(a)?o.color(a.instance):qCe}else r=()=>qCe;return{factory:KCe,granularity:"instance",color:r,props:t,description:iet,legend:n}}var JCe={name:"volume-instance",label:"Volume Instance",category:ur.Misc,factory:KCe,getParams:aet,defaultValues:C.getDefaultValues(YCe),isApplicable:e=>!!e.volume};var as;(c=>{c.Category=ur;function t(m,d,p,h){let f=[];if(m.every(g=>Array.isArray(g))){let g=0;for(let T of m)if(Array.isArray(T)){let w=U0(T[1]);w>g&&(g=w)}let x=Math.pow(10,g),S=[...m];S.sort((T,w)=>T[1]-w[1]);let I=S.map(T=>T[0]),v=Be.ofSortedArray(S.map(T=>T[1])),A=[];for(let T=0,w=v.length-1;T<w;++T)A.push(v[T]+(v[T+1]-v[T])/2);A.push(v[v.length-1]);let _=Be.ofSortedArray(A);for(let T=0,w=Math.max(x,m.length);T<w;++T){let D=Qp(T,0,x-1),M=Be.findPredecessorIndex(_,D);f[T]=I[M]}}else for(let g of m)Array.isArray(g)?f.push(g[0]):f.push(g);return{colors:f,filter:d==="set"?"nearest":"linear",domain:p,defaultColor:h}}c.Palette=t,c.PaletteScale=(1<<24)-2,c.EmptyFactory=()=>c.Empty;let o=13421772;c.Empty={factory:c.EmptyFactory,granularity:"uniform",color:()=>o,props:{}};function a(m,d){return m.contextHash===d.contextHash&&m.factory===d.factory&&oa(m.props,d.props)}c.areEqual=a,c.EmptyProvider={name:"",label:"",category:"",factory:c.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0};function l(){return new VI(c.BuiltIn,c.EmptyProvider)}c.createRegistry=l,c.BuiltIn={"atom-id":fge,"carbohydrate-symbol":tme,cartoon:Pge,"chain-id":sB,"element-index":fme,"element-symbol":Dme,"entity-id":gme,"entity-source":xme,"external-structure":ZCe,"external-volume":Ige,"formal-charge":wge,hydrophobicity:tge,illustrative:Jhe,"model-index":Sme,"molecule-type":Mme,occupancy:nge,"operator-hkl":lge,"operator-name":oI,"partial-charge":cge,"polymer-id":Ome,"polymer-index":Hme,"residue-name":Xme,"secondary-structure":Zme,"sequence-id":Kme,"shape-group":Qhe,"structure-index":Ime,"trajectory-index":_me,uncertainty:qhe,"unit-index":Tme,uniform:nme,"volume-instance":JCe,"volume-segment":Cge,"volume-value":gge}})(as||={});var set=1,uet="Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres.",$Ce={scale:C.Numeric(1,{min:.1,max:5,step:.1})};function cet(e){return $Ce}function qj(e,t){return me.isAtomic(e)?hh(e.model.atomicHierarchy.atoms.type_symbol.value(t)):me.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}function e0e(e,t){let r=t.scale===void 0?1:t.scale;function n(o){let i;return K.Location.is(o)?i=r*qj(o.unit,o.element):Ct.isLocation(o)?i=r*Math.min(qj(o.aUnit,o.aUnit.elements[o.aIndex]),qj(o.bUnit,o.bUnit.elements[o.bIndex])):i=r*set,i}return{factory:e0e,granularity:"group",size:n,props:t,description:uet}}var t0e={name:"physical",label:"Physical",category:"",factory:e0e,getParams:cet,defaultValues:C.getDefaultValues($Ce),isApplicable:e=>!!e.structure};var met="Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",n0e={bfactorFactor:C.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:C.Numeric(.05,{min:0,max:1,step:.01}),baseSize:C.Numeric(.2,{min:0,max:2,step:.1})};function det(e){return n0e}function r0e(e,t,r){return me.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*r.bfactorFactor:me.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*r.rmsfFactor:0}function o0e(e,t){function r(n){let o=t.baseSize;return K.Location.is(n)?o+=r0e(n.unit,n.element,t):Ct.isLocation(n)&&(o+=r0e(n.aUnit,n.aUnit.elements[n.aIndex],t)),o}return{factory:o0e,granularity:"group",size:r,props:t,description:met}}var i0e={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:o0e,getParams:det,defaultValues:C.getDefaultValues(n0e),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined)};var a0e="Assign size based on the given value of a volume cell.",s0e={scale:C.Numeric(1,{min:.1,max:5,step:.1})};function pet(e){return s0e}function Yj(e,t){if(e.volume){let{data:r}=e.volume.grid.cells,n=Ve.Cell.isLocation;return{factory:Yj,granularity:"group",size:i=>n(i)?r[i.cell]*t.scale:0,props:t,description:a0e}}else return{factory:Yj,granularity:"uniform",size:()=>t.scale,props:t,description:a0e}}var l0e={name:"volume-value",label:"Volume Value",category:"",factory:Yj,getParams:pet,defaultValues:C.getDefaultValues(s0e),isApplicable:e=>!!e.volume&&!Ve.Segmentation.get(e.volume)};var yo;(a=>{a.EmptyFactory=()=>a.Empty,a.Empty={factory:a.EmptyFactory,granularity:"uniform",size:()=>1,props:{}};function r(s,l){return s.contextHash===l.contextHash&&s.factory===l.factory&&oa(s.props,l.props)}a.areEqual=r,a.EmptyProvider={name:"",label:"",category:"",factory:a.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0};function o(){return new VI(a.BuiltIn,a.EmptyProvider)}a.createRegistry=o,a.BuiltIn={physical:t0e,"shape-group":Lhe,uncertainty:i0e,uniform:Xfe,"volume-value":l0e}})(yo||={});var pi;(o=>{function e(i,a,s,l){l=l||t();let u=s.colorTheme,c=s.sizeTheme;return l.color=i.colorThemeRegistry.create(u.name,a,u.params),l.size=i.sizeThemeRegistry.create(c.name,a,c.params),l}o.create=e;function t(){return{color:as.Empty,size:yo.Empty}}o.createEmpty=t;async function r(i,a,s,l){await a.colorThemeRegistry.get(l.colorTheme.name).ensureCustomProperties?.attach(i,s),await a.sizeThemeRegistry.get(l.sizeTheme.name).ensureCustomProperties?.attach(i,s)}o.ensureDependencies=r;function n(i,a,s){i.colorThemeRegistry.get(s.colorTheme.name).ensureCustomProperties?.detach(a),i.sizeThemeRegistry.get(s.sizeTheme.name).ensureCustomProperties?.detach(a)}o.releaseDependencies=n})(pi||={});function u0e(e){return e.map(t=>[t.name,t.provider.label,t.provider.category])}var VI=class{constructor(t,r){this.emptyProvider=r;this._list=[];this._map=new Map;this._name=new Map;gi(t,(n,o)=>{if(n.name!==o)throw new Error(`Fix build in themes to have matching names. ${n.name} ${o}`);this.add(n)})}get default(){return this._list[0]}get list(){return this._list}get types(){return u0e(this._list)}sort(){this._list.sort((t,r)=>t.provider.category===r.provider.category?t.provider.label<r.provider.label?-1:t.provider.label>r.provider.label?1:0:t.provider.category<r.provider.category?-1:1)}add(t){if(this._map.has(t.name))throw new Error(`${t.name} already registered.`);let r=t.name;this._list.push({name:r,provider:t}),this._map.set(r,t),this._name.set(t,r),this.sort()}remove(t){this._list.splice(this._list.findIndex(n=>n.name===t.name),1);let r=this._map.get(t.name);r&&(this._map.delete(t.name),this._name.delete(r))}has(t){return this._map.has(t.name)}get(t){return this._map.get(t)||this.emptyProvider}getName(t){if(!this._name.has(t))throw new Error(`'${t.label}' is not a registered theme provider.`);return this._name.get(t)}create(t,r,n={}){let o=this.get(t);return o.factory(r,{...C.getDefaultValues(o.getParams(r)),...n})}getApplicableList(t){return this._list.filter(r=>r.provider.isApplicable(t))}getApplicableTypes(t){return u0e(this.getApplicableList(t))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}};var fet;(t=>{function e(r,n,o){return C.getDefaultValues(r.getParams(n,o))}t.getDefaultParams=e})(fet||={});var het={name:"",label:"",description:"",factory:()=>Vt.Empty,getParams:()=>({}),defaultValues:{},defaultColorTheme:{name:""},defaultSizeTheme:{name:""},isApplicable:()=>!0};function c0e(e){return e.map(t=>[t.name,t.provider.label])}var OI=class{constructor(){this._list=[];this._map=new Map;this._name=new Map}get default(){return this._list[0]}get types(){return c0e(this._list)}add(t){if(this._map.has(t.name))throw new Error(`${t.name} already registered.`);this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)}getName(t){if(!this._name.has(t))throw new Error(`'${t.label}' is not a registered represenatation provider.`);return this._name.get(t)}remove(t){let r=t.name;this._list.splice(this._list.findIndex(o=>o.name===r),1);let n=this._map.get(r);n&&(this._map.delete(r),this._name.delete(n))}get(t){return this._map.get(t)||het}get list(){return this._list}getApplicableList(t){return this._list.filter(r=>r.provider.isApplicable(t))}getApplicableTypes(t){return c0e(this.getApplicableList(t))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}};var Vt;(u=>{let e;(p=>{function c(h,f){return h.repr===f.repr&&Jt.areEqual(h.loci,f.loci)}p.areEqual=c;function m(h){return Jt.isEmpty(h.loci)}p.isEmpty=m,p.Empty={loci:dr}})(e=u.Loci||={});function t(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:Z.identity(),overpaint:Ha.Empty,transparency:ja.Empty,emissive:Xa.Empty,substance:Wa.Empty,clipping:lo.Empty,themeStrength:{overpaint:1,transparency:1,emissive:1,substance:1},markerActions:Wo.All}}u.createState=t;function r(c,m){m.visible!==void 0&&(c.visible=m.visible),m.alphaFactor!==void 0&&(c.alphaFactor=m.alphaFactor),m.pickable!==void 0&&(c.pickable=m.pickable),m.colorOnly!==void 0&&(c.colorOnly=m.colorOnly),m.overpaint!==void 0&&(c.overpaint=m.overpaint),m.transparency!==void 0&&(c.transparency=m.transparency),m.emissive!==void 0&&(c.emissive=m.emissive),m.substance!==void 0&&(c.substance=m.substance),m.clipping!==void 0&&(c.clipping=m.clipping),m.themeStrength!==void 0&&(c.themeStrength=m.themeStrength),m.syncManually!==void 0&&(c.syncManually=m.syncManually),m.transform!==void 0&&Z.copy(c.transform,m.transform),m.markerActions!==void 0&&(c.markerActions=m.markerActions)}u.updateState=r,u.StateBuilder={create:t,update:r};function i(){return{label:"",groupCount:0,renderObjects:[],geometryVersion:-1,props:{},params:{},updated:new En,state:t(),theme:pi.createEmpty(),createOrUpdate:()=>Pe.constant("",void 0),setState:()=>{},setTheme:()=>{},getLoci:()=>dr,getAllLoci:()=>[],eachLocation:()=>{},mark:()=>!1,destroy:()=>{}}}u.createEmpty=i;class a{constructor(){this.curr=new Set;this.next=new Set;this._version=-1}get version(){return this._version}add(m,d){this.next.add(Xi(m,d))}snapshot(){no.areEqual(this.curr,this.next)||(this._version+=1),[this.curr,this.next]=[this.next,this.curr],this.next.clear()}}u.GeometryState=a;function s(c,m,d,p,h){let f=0,y=new En,g=new a,x=p.create(),S=pi.createEmpty(),I,v,A,_={},T=Object.keys(h).map((w,D)=>{_[D]=w;let M=h[w](m,d);return M.setState(x),M});return{label:c,updated:y,get groupCount(){let w=0;if(v){let{visuals:D}=v;for(let M=0,E=T.length;M<E;++M)(!D||D.includes(_[M]))&&(w+=T[M].groupCount)}return w},get renderObjects(){let w=[];if(v){let{visuals:D}=v;for(let M=0,E=T.length;M<E;++M)(!D||D.includes(_[M]))&&w.push(...T[M].renderObjects)}return w},get geometryVersion(){return g.version},get props(){return v},get params(){return I},createOrUpdate:(w={},D)=>{D&&D!==A&&(I=d(m,D),A=D,v||(v=C.getDefaultValues(I)));let M=M_(Object.assign({},v,w),A);Object.assign(v,w,M);let{visuals:E}=v;return Pe.create(`Creating or updating '${c}' representation`,async R=>{for(let k=0,B=T.length;k<B;++k)(!E||E.includes(_[k]))&&await T[k].createOrUpdate(v,A).runInContext(R),g.add(k,T[k].geometryVersion);g.snapshot(),y.next(f++)})},get state(){return x},get theme(){return S},getLoci:w=>{let{visuals:D}=v;for(let M=0,E=T.length;M<E;++M)if(!D||D.includes(_[M])){let R=T[M].getLoci(w);if(!Ii(R))return R}return dr},getAllLoci:()=>{let w=[],{visuals:D}=v;for(let M=0,E=T.length;M<E;++M)(!D||D.includes(_[M]))&&w.push(...T[M].getAllLoci());return w},eachLocation:w=>{let{visuals:D}=v;for(let M=0,E=T.length;M<E;++M)(!D||D.includes(_[M]))&&T[M].eachLocation(w)},mark:(w,D)=>{let M=!1;for(let E=0,R=T.length;E<R;++E)M=T[E].mark(w,D)||M;return M},setState:w=>{p.update(x,w);for(let D=0,M=T.length;D<M;++D)T[D].setState(w)},setTheme:w=>{S=w;for(let D=0,M=T.length;D<M;++D)T[D].setTheme(w)},destroy(){for(let w=0,D=T.length;w<D;++w)T[w].destroy()}}}u.createMulti=s;function l(c,m){let d=0,p=new En,h=new a,f=u.createState(),y=pi.createEmpty(),g=C.clone(We.Params),x=C.getDefaultValues(We.Params);return{label:c,updated:p,get groupCount(){return m.values.uGroupCount.ref.value},get renderObjects(){return[m]},get geometryVersion(){return h.version},get props(){return x},get params(){return g},createOrUpdate:(S={})=>{let I=M_(Object.assign({},x,S));return Object.assign(x,S,I),Pe.create(`Updating '${c}' representation`,async v=>{h.add(0,m.id),h.snapshot(),p.next(d++)})},get state(){return f},get theme(){return y},getLoci:()=>dr,getAllLoci:()=>[],eachLocation:()=>{},mark:(S,I)=>!1,setState:S=>{S.visible!==void 0&&Fr.setVisibility(m,S.visible),S.alphaFactor!==void 0&&Fr.setAlphaFactor(m,S.alphaFactor),S.pickable!==void 0&&Fr.setPickable(m,S.pickable),S.colorOnly!==void 0&&Fr.setColorOnly(m,S.colorOnly),S.overpaint,S.transparency,S.emissive,S.substance,S.clipping,S.themeStrength!==void 0&&Fr.setThemeStrength(m,S.themeStrength),S.transform!==void 0&&Fr.setTransform(m,S.transform),u.updateState(f,S)},setTheme:()=>{},destroy(){}}}u.fromRenderObject=l})(Vt||={});var get;Object.defineProperty(Vt,"Empty",{get:()=>get??=Vt.createEmpty()});function to(e,t,r,n){let o=0,{webgl:i}=t,a=new En,s=new Vt.GeometryState,l=Dc(),u=[],c=Gn.create(),m,d,p,h,f=pi.createEmpty();function y(T={},w){return w&&w!==d&&(p=r(t,w),d=w,h||(h=C.getDefaultValues(p))),h=Object.assign({},h,T),Pe.create("Creating or updating ComplexRepresentation",async D=>{let M=!1;m?m.mustRecreate?.(d,h,i)&&(m.destroy(),m=n(l,d,h,i),M=!0):(m=n(l,d,h,i),M=!0);let E=m.createOrUpdate({webgl:i,runtime:D},f,h,w);E&&await E,M&&v(c),u.length=0,m&&m.renderObject&&(u.push(m.renderObject),s.add(m.renderObject.id,m.geometryVersion)),s.snapshot(),o+=1,a.next(o)})}function g(T){return m?m.getLoci(T):dr}function x(){return[De.Loci(d.child??d)]}function S(T){m?.eachLocation(T)}function I(T,w){if(!d||!Wo.is(c.markerActions,w))return!1;if(De.isLoci(T)||K.Loci.is(T)||Ct.isLoci(T)){if(!De.areRootsEquivalent(T.structure,d))return!1;T=Jt.remap(T,d),(De.isLoci(T)||K.Loci.is(T)&&K.Loci.isWholeStructure(T))&&(T=Uh)}else if(!Ji(T)&&!iS(T))return!1;return Jt.isEmpty(T)?!1:m?m.mark(T,w):!1}function v(T){if(Gn.update(c,T),T.visible!==void 0&&m&&m.setVisibility(T.visible&&(c.unitTransforms===null||c.unitTransforms.isIdentity)),T.alphaFactor!==void 0&&m&&m.setAlphaFactor(T.alphaFactor),T.pickable!==void 0&&m&&m.setPickable(T.pickable),T.overpaint!==void 0&&m){let w=Ha.remap(T.overpaint,d);m.setOverpaint(w,i)}if(T.transparency!==void 0&&m){let w=ja.remap(T.transparency,d);m.setTransparency(w,i)}if(T.emissive!==void 0&&m){let w=Xa.remap(T.emissive,d);m.setEmissive(w,i)}if(T.substance!==void 0&&m){let w=Wa.remap(T.substance,d);m.setSubstance(w,i)}if(T.clipping!==void 0&&m){let w=lo.remap(T.clipping,d);m.setClipping(w)}T.themeStrength!==void 0&&m&&m.setThemeStrength(T.themeStrength),T.transform!==void 0&&m&&m.setTransform(T.transform),T.unitTransforms!==void 0&&m&&m.setVisibility(c.visible&&(T.unitTransforms===null||T.unitTransforms.isIdentity))}function A(T){f=T}function _(){m&&m.destroy()}return{label:e,get groupCount(){return m?m.groupCount:0},get props(){return h},get params(){return p},get state(){return c},get theme(){return f},get geometryVersion(){return s.version},renderObjects:u,updated:a,createOrUpdate:y,setState:v,setTheme:A,getLoci:g,getAllLoci:x,eachLocation:S,mark:I,destroy:_}}function dn(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function zk(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function Vx(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function z_(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function H_(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function yet(e,t,r){let n=0,o=e.interUnitBonds.getEdgeIndices(r,t.id);for(let i=0,a=o.length;i<a;++i){let s=e.interUnitBonds.edges[o[i]];ht.isCovalent(s.props.flag)&&(n+=1)}return n}function bet(e,t){let r=0,{offset:n,edgeProps:{flags:o}}=e.bonds;for(let i=n[t],a=n[t+1];i<a;++i)ht.isCovalent(o[i])&&(r+=1);return r}function Ec(e,t,r){return yet(e,t,r)+bet(t,r)}function Wl(e,t,r,n){let o=0;return us(e,t,r,(i,a)=>{dn(i,a)===n&&(o+=1)}),o}function xet(e,t,r){let{offset:n,b:o,edgeProps:{flags:i}}=e.bonds;ht.is;for(let a=n[t],s=n[t+1];a<s;++a)if(o[a]===r&&ht.isCovalent(i[a]))return!0;return!1}function Cet(e,t,r,n,o){let i=e.interUnitBonds.getEdge(r,t.id,o,n.id);return i&&ht.isCovalent(i.props.flag)}function m0e(e,t,r,n,o){return t===n?xet(t,r,o):Cet(e,t,r,n,o)}function vet(e,t,r,n){let o=e.interUnitBonds.getEdgeIndices(r,t.id);for(let i=0,a=o.length;i<a;++i){let s=e.interUnitBonds.edges[o[i]],l=e.unitMap.get(s.unitB);ht.isCovalent(s.props.flag)&&n(l,s.indexB)}}function Hk(e,t,r){let{offset:n,b:o,edgeProps:{flags:i}}=e.bonds;for(let a=n[t],s=n[t+1];a<s;++a)ht.isCovalent(i[a])&&r(e,o[a])}function us(e,t,r,n){vet(e,t,r,n),Hk(t,r,n)}function d0e(e,t,r){return dn(t,r)==="S"&&Wl(e,t,r,"O")===3}function p0e(e,t,r){return dn(t,r)==="S"&&Wl(e,t,r,"O")===4}function Kj(e,t,r){return dn(t,r)==="P"&&Wl(e,t,r,"O")===Ec(e,t,r)}function f0e(e,t,r){let n=0;return dn(t,r)==="C"&&Wl(e,t,r,"O")===2&&Wl(e,t,r,"C")===1&&us(e,t,r,(o,i)=>{dn(o,i)==="O"&&Ec(e,o,i)-Wl(e,o,i,"H")===1&&(n+=1)}),n===2}function h0e(e,t,r){let n=0;return dn(t,r)==="C"&&Ec(e,t,r)===3&&Wl(e,t,r,"N")===3&&us(e,t,r,(o,i)=>{Ec(e,o,i)-Wl(e,o,i,"H")===1&&(n+=1)}),n===2}function g0e(e,t,r){let n=0;return dn(t,r)==="C"&&Ec(e,t,r)===3&&Wl(e,t,r,"N")===2&&Wl(e,t,r,"C")===1&&us(e,t,r,(o,i)=>{Ec(e,o,i)-Wl(e,o,i,"H")===1&&(n+=1)}),n===2}var Iet=new Set(["N","O","S","F","CL","BR","I"]);function Aet(e){return Iet.has(e)}function y0e(e,t,r){let n=!1;return us(e,t,r,(o,i)=>{Aet(dn(o,i))&&(n=!0)}),n}var Tet=Z.toArray,jk=!1;function GI(e){if(!e)$t&&!jk&&(console.warn('WebGL required for "sphere impostors". Falling back to "sphere mesh".'),jk=!0);else if(!e.extensions.fragDepth||!e.extensions.textureFloat){if($t&&!jk){let t=[];e.extensions.fragDepth||t.push("fragDepth"),e.extensions.textureFloat||t.push("textureFloat"),console.warn(`Missing "${t.join('", "')}" extensions required for "sphere impostors". Falling back to "sphere mesh".`),jk=!0}}else return!0;return!1}var Wk=!1;function Ox(e){if(!e)$t&&!Wk&&(console.warn('WebGL required for "cylinder impostors". Falling back to "cylinder mesh".'),Wk=!0);else{if(e.extensions.fragDepth)return!0;if($t&&!Wk){let t=[];e.extensions.fragDepth||t.push("fragDepth"),console.warn(`Missing "${t.join('", "')}" extensions required for "cylinder impostors". Falling back to "cylinder mesh".`),Wk=!0}}return!1}function Xk(e,t,r){let{elements:n,model:o}=t;if(Se.indexOf(n,r)!==-1){let{index:i,offsets:a}=o.atomicHierarchy.residueAtomSegments,s=i[r],l=[];for(let c=a[s],m=a[s+1];c<m;++c){let d=Se.indexOf(n,c);d!==-1&&l.push(d)}let u=Se.ofSortedArray(Be.ofSortedArray(l));return K.Loci(e,[{unit:t,indices:u}])}return dr}function b0e(e,t,r){let{elements:n,model:o}=t,{label_alt_id:i}=o.atomicHierarchy.atoms,a=i.value(r);if(Se.indexOf(n,r)!==-1){let{index:s}=o.atomicHierarchy.residueAtomSegments,l=s[r];return Gx(e,t,l,a)}return K.Loci(e,[])}function Gx(e,t,r,n){let{elements:o,model:i}=t,{label_alt_id:a}=i.atomicHierarchy.atoms,{offsets:s}=i.atomicHierarchy.residueAtomSegments,l=[];for(let c=s[r],m=s[r+1];c<m;++c){let d=Se.indexOf(o,c);if(d!==-1){let p=a.value(c);(n===p||p==="")&&l.push(d)}}let u=Se.ofSortedArray(Be.ofSortedArray(l));return K.Loci(e,[{unit:t,indices:u}])}function Jj(e,t,r,n,o,i){let{child:a}=e.structure,s=t&&a?e.group.units.filter(m=>a.unitMap.has(m.id)):e.group.units,l=s.length,u=l*16,c=i&&i.aTransform.ref.value.length>=u?i.aTransform.ref.value:new Float32Array(u);for(let m=0;m<l;m++)Tet(s[m].conformation.operator.matrix,c,m*16);return Y0(c,l,r,n,o,i)}var Pet={atomic:{},spheres:{},gaussians:{}},x0e=C.objectToOptions(Pet);function C0e(e,t){for(let r=0,n=e.length;r<n;++r)if(me.isAtomic(t)&&e[r]==="atomic"||me.isSpheres(t)&&e[r]==="spheres"||me.isGaussians(t)&&e[r]==="gaussians")return!0;return!1}var S0e=5e8;function $j(e,t,r=S0e){let n=ut.size(b(),e);b.ceil(n,n),n.sort((s,l)=>l-s);let o=Math.floor(Math.cbrt(r)*Math.cbrt(r)),i=n[0]*n[1],a=Math.ceil(i/(t*t));return{area:i,areaCells:a,maxAreaCells:o}}function zh(e,t,r=S0e){let{area:n,areaCells:o,maxAreaCells:i}=$j(e,t.resolution,r),a=o>i?Math.sqrt(n/i):t.resolution;return{...t,resolution:a}}function _et(e){switch(e.kind){case me.Kind.Atomic:return e.model.atomicConformation;case me.Kind.Spheres:return e.model.coarseConformation.spheres;case me.Kind.Gaussians:return e.model.coarseConformation.gaussians}}var pS={ignoreHydrogens:C.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:C.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})},ILr=C.getDefaultValues(pS),Ret=b();function v0e(e,t,r,n){return b.squaredDistance(b.set(Ret,e,t,r),n)}function Det(e,t,r){let n=0,o=t.length;for(let i=0,a=r.length;i<a;++i){let s=Be.indexOfInRange(t,r[i],n,o);s===-1?e[i]=-2:(e[i]=s,n=s)}}function UI(e,t,r,n){let{ignoreHydrogens:o,ignoreHydrogensVariant:i,traceOnly:a,includeParent:s}=n,l=s?e.root.unitMap.get(t.id):t,u=s&&l!==t,{x:c,y:m,z:d}=_et(l),{elements:p}=l,{center:h,radius:f}=t.boundary.sphere,y=(4+1.5)*2,g=(f+y)*(f+y),x,S;if(o||a||u){let T=[],w=[];for(let D=0,M=p.length;D<M;++D){let E=p[D];o&&Mc(e,l,E,i)||a&&!Qk(l,E)||u&&v0e(c[E],m[E],d[E],h)>g||(T.push(E),w.push(D))}x=Be.ofSortedArray(T),S=w}else x=p,S=_a(new Int32Array(x.length));s&&l!==t&&Det(S,t.elements,x);let I={indices:x,x:c,y:m,z:d,id:S},v=u?lf(I):t.boundary,A=K.Location.create(e,l);return{position:I,boundary:v,radius:T=>(A.element=T,r.size(A))}}function NI(e,t,r){let{ignoreHydrogens:n,ignoreHydrogensVariant:o,traceOnly:i,includeParent:a}=r,s=a&&!!e.parent,l=K.Location.create(e.root),{center:u,radius:c}=e.boundary.sphere,m=(4+1.5)*2,d=(c+m)*(c+m),p,h,f,y,g,x;if(n||i||s){let{getSerialIndex:A}=e.serialMapping,_=s?e.root.units:e.units,T=[],w=[],D=[],M=[],E=[];for(let R=0,k=_.length;R<k;++R){let B=_[R],{elements:L,conformation:V}=B,U=e.unitMap.get(B.id);l.unit=B;for(let Q=0,O=L.length;Q<O;++Q){let q=L[Q];if(n&&Mc(e,B,q,o)||i&&!Qk(B,q))continue;let X=V.x(q),F=V.y(q),Y=V.z(q);s&&v0e(X,F,Y,u)>d||(T.push(X),w.push(F),D.push(Y),l.element=q,M.push(t.size(l)),s?(U?Be.indexOf(U.elements,q):-1)===-1?E.push(-2):E.push(A(U,q)):E.push(A(B,q)))}}p=T,h=w,f=D,y=M,g=E,x=Se.ofRange(0,g.length)}else{let{elementCount:A}=e,_=new Float32Array(A),T=new Float32Array(A),w=new Float32Array(A),D=new Float32Array(A);for(let M=0,E=0,R=e.units.length;M<R;++M){let k=e.units[M],{elements:B,conformation:L}=k;l.unit=k;for(let V=0,U=B.length;V<U;++V){let Q=B[V],O=E+V;_[O]=L.x(Q),T[O]=L.y(Q),w[O]=L.z(Q),l.element=Q,D[O]=t.size(l)}E+=B.length}p=_,h=T,f=w,y=D,g=_a(new Uint32Array(A)),x=Se.ofRange(0,g.length)}let S={indices:x,x:p,y:h,z:f,id:g},I=s?lf(S):e.boundary;return{position:S,boundary:I,radius:A=>y[A]}}var wet=W2.H;function Mc(e,t,r,n){if(me.isCoarse(t)||t.model.atomicHierarchy.derived.atom.atomicNumber[r]!==wet)return!1;if(n==="all")return!0;let o=y0e(e,t,Be.indexOf(t.elements,r));return!!(o&&n==="polar"||!o&&n==="non-polar")}function Qk(e,t){if(me.isCoarse(e))return!0;let r=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return r==="CA"||r==="BB"||r==="P"}function Ry(e){return C.MultiSelect(e,x0e,{description:"For which kinds of units/chains to show the representation visuals."})}var Xs={unitKinds:Ry(["atomic","spheres"]),includeParent:C.Boolean(!1,{isHidden:!0})},Zk={...ft.Params},qk={...Ts.Params},Yk={...Di.Params},Kk={...ml.Params},Jk={...ln.Params},$k={...Ui.Params},eL={...Bl.Params},tL={...is.Params},rL={...hu.Params};function Eet(e,t,r,n,o,i){let{createValues:a,createRenderableState:s}=Ga.getUtils(t),l=kB(),u=a(t,l,r,n,o),c=s(o);return Kd(t.kind,u,c,i)}function Hh(e,t){let{defaultProps:r,createGeometry:n,createLocationIterator:o,getLoci:i,eachLocation:a,setUpdateState:s,mustRecreate:l,processValues:u,dispose:c}=e,{updateValues:m,updateBoundingSphere:d,updateRenderableState:p,createPositionIterator:h}=e.geometryUtils,f=ld.create(),y={loci:dr,action:0,status:-1},g,x,S,I,v=Object.assign({},r),A=pi.createEmpty(),_,T,w=-1,D,M;function E(U,Q,O){if(!O&&!_)throw new Error("missing structure");if(x=Object.assign({},v,Q),S=U,I=O,ld.reset(f),!g||!_){f.createNew=!0,f.createGeometry=!0;return}s(f,x,v,S,A,I,_),De.areEquivalent(I,_)||(f.createGeometry=!0),De.areHierarchiesEqual(I,_)||(f.updateTransform=!0,f.createGeometry=!0),as.areEqual(U.color,A.color)||(f.updateColor=!0),yo.areEqual(U.size,A.size)||(f.updateSize=!0),oa(x.unitKinds,v.unitKinds)||(f.createGeometry=!0),_.child!==I.child&&(f.createGeometry=!0,f.updateTransform=!0),x.instanceGranularity!==v.instanceGranularity&&(f.updateTransform=!0),f.updateSize&&!("uSize"in g.values)&&(f.createGeometry=!0),f.createGeometry&&(f.updateColor=!0,f.updateSize=!0)}function R(U){if(f.createNew)if(D=o(I,x),U)g=Eet(I,U,D,S,x,t),M=h(U,g.values);else throw new Error("expected geometry to be given");else{if(!g)throw new Error("expected renderObject to be available");if((f.updateColor||f.updateSize||f.updateTransform)&&(D=o(I,x)),f.updateTransform){let{instanceCount:Q,groupCount:O}=D;x.instanceGranularity?oo(Q,"instance",g.values):oo(Q*O,"groupInstance",g.values)}if(f.createGeometry)if(U)P.updateIfChanged(g.values.drawCount,Ga.getDrawCount(U)),P.updateIfChanged(g.values.uVertexCount,Ga.getVertexCount(U)),P.updateIfChanged(g.values.uGroupCount,D.groupCount);else throw new Error("expected geometry to be given");(f.updateTransform||f.createGeometry)&&(d(g.values,U||T),M=h(T,g.values)),f.updateSize&&"uSize"in g.values&&Ml(D,S.size,g.values),f.updateColor&&Ki(D,M,S.color,g.values),m(g.values,x),p(g.state,x)}v=x,A=S,_=I,U&&(T=U,w+=1)}function k(U){return!!(Ji(U)||De.isLoci(U)&&De.areRootsEquivalent(U.structure,_)||K.Loci.is(U)&&De.areRootsEquivalent(U.structure,_)&&K.Loci.isWholeStructure(U))}function B(U,Q,O){let q=!1;return!K.Loci.is(U)&&!Ct.isLoci(U)||!De.areEquivalent(U.structure,Q)?!1:(O(xe.ofSingleton(0))&&(q=!0),q)}function L(U,Q,O){return k(U)?v.instanceGranularity?Q(xe.ofBounds(0,D.instanceCount)):Q(xe.ofBounds(0,D.groupCount*D.instanceCount)):v.instanceGranularity?B(U,_,Q):a(U,_,Q,O)}function V(U){g&&u?.(g.values,T,v,A,U.webgl)}return{get groupCount(){return D?D.count:0},get renderObject(){return D&&D.count?g:void 0},get geometryVersion(){return w},createOrUpdate(U,Q,O={},q){if(E(Q,O,q||_),f.createGeometry){let X=n(U,I,S,x,T);if(Eb(X))return X.then(F=>{R(F),V(U)});R(X)}else R();V(U)},getLoci(U){return g?i(U,_,g.id):dr},eachLocation(U){for(D.reset();D.hasNext;){let{location:Q,isSecondary:O}=D.move();U(Q,O)}},mark(U,Q){return Fr.mark(g,U,Q,L,y)},setVisibility(U){Fr.setVisibility(g,U)},setAlphaFactor(U){Fr.setAlphaFactor(g,U)},setPickable(U){Fr.setPickable(g,U)},setColorOnly(U){Fr.setColorOnly(g,U)},setTransform(U,Q){Fr.setTransform(g,U,Q)},setOverpaint(U,Q){let O={geometry:T,props:v,webgl:Q};Fr.setOverpaint(g,U,L,!0,O)},setTransparency(U,Q){let O={geometry:T,props:v,webgl:Q};Fr.setTransparency(g,U,L,!0,O)},setEmissive(U,Q){let O={geometry:T,props:v,webgl:Q};Fr.setEmissive(g,U,L,!0,O)},setSubstance(U,Q){let O={geometry:T,props:v,webgl:Q};Fr.setSubstance(g,U,L,!0,O)},setClipping(U){Fr.setClipping(g,U,L,!0)},setThemeStrength(U){Fr.setThemeStrength(g,U)},destroy(){c?.(T),g&&(g.state.disposed=!0,g=void 0)},mustRecreate:l}}var Qu={...Zk,...Xs};function cs(e,t){return Hh({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:ft.Utils},t)}var I0e={...qk,...Xs};function A0e(e,t){return Hh({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:Ts.Utils},t)}var nL={...Yk,...Xs};function oL(e,t){return Hh({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:Di.Utils},t)}var T0e={...Kk,...Xs};function P0e(e,t){return Hh({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:ml.Utils},t)}var zI={...Jk,...Xs};function HI(e,t){return Hh({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:ln.Utils},t)}var _0e={...$k,...Xs};function jI(e,t){return Hh({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.updateSize=!0),n.background!==o.background&&(r.createGeometry=!0),n.backgroundMargin!==o.backgroundMargin&&(r.createGeometry=!0),n.tether!==o.tether&&(r.createGeometry=!0),n.tetherLength!==o.tetherLength&&(r.createGeometry=!0),n.tetherBaseWidth!==o.tetherBaseWidth&&(r.createGeometry=!0),n.attachment!==o.attachment&&(r.createGeometry=!0),n.fontFamily!==o.fontFamily&&(r.createGeometry=!0),n.fontQuality!==o.fontQuality&&(r.createGeometry=!0),n.fontStyle!==o.fontStyle&&(r.createGeometry=!0),n.fontVariant!==o.fontVariant&&(r.createGeometry=!0),n.fontWeight!==o.fontWeight&&(r.createGeometry=!0)},geometryUtils:Ui.Utils},t)}var R0e={...eL,...Xs};function D0e(e,t){return Hh({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:Bl.Utils},t)}var w0e={...tL,...Xs};function E0e(e,t){return Hh({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:is.Utils},t)}var M0e={...rL,...Xs};function B0e(e,t){return Hh({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:hu.Utils},t)}function Qn(e,t,r,n){let o=0,{webgl:i}=t,a=new En,s=Dc(),l=[],u=new Vt.GeometryState,c=Gn.create(),m=new Map,d,p,h,f,y=pi.createEmpty();function g(D={},M){return M&&M!==d&&(h=r(t,M),f||(f=C.getDefaultValues(h))),f=Object.assign({},f,D),Pe.create("Creating or updating UnitsRepresentation",async E=>{if(!d&&!M)throw new Error("missing structure");if(M&&!d){p=M.unitSymmetryGroups;for(let R=0;R<p.length;R++){let k=p[R],B=n(s,M,f,i),L=B.createOrUpdate({webgl:i,runtime:E},y,f,{group:k,structure:M});L&&await L,A(B,k,c),m.set(k.hashCode,{visual:B,group:k}),E.shouldUpdate&&await E.update({message:"Creating or updating UnitsVisual",current:R,max:p.length})}}else if(M&&(!De.areUnitIdsAndIndicesEqual(M,d)||M.child!==d.child)){p=M.unitSymmetryGroups;let R=m;m=new Map;for(let k=0;k<p.length;k++){let B=p[k],L=R.get(B.hashCode);if(L){let{visual:V}=L;if(V.mustRecreate?.({group:B,structure:M},f,i)){V.destroy(),V=n(s,M,f,i);let U=V.createOrUpdate({webgl:i,runtime:E},y,f,{group:B,structure:M});U&&await U,A(V,B,c)}else{let U=V.createOrUpdate({webgl:i,runtime:E},y,f,{group:B,structure:M});U&&await U}if(m.set(B.hashCode,{visual:V,group:B}),R.delete(B.hashCode),V.renderObject){let U=V.renderObject.values.tMarker.ref.value.array;wx(U,xe.ofBounds(0,U.length),2)}}else{let V=n(s,M,f,i),U=V.createOrUpdate({webgl:i,runtime:E},y,f,{group:B,structure:M});U&&await U,A(V,B,c),m.set(B.hashCode,{visual:V,group:B})}E.shouldUpdate&&await E.update({message:"Creating or updating UnitsVisual",current:k,max:p.length})}R.forEach(({visual:k})=>{k.destroy()})}else if(M&&M!==d&&De.areUnitIdsAndIndicesEqual(M,d)){p=M.unitSymmetryGroups;for(let R=0;R<p.length;R++){let k=p[R],B=m.get(k.hashCode);if(B){let{visual:L}=B;if(L.mustRecreate?.({group:k,structure:M},f,t.webgl)){L.destroy(),L=n(s,M,f,t.webgl),B.visual=L;let V=L.createOrUpdate({webgl:i,runtime:E},y,f,{group:k,structure:M});V&&await V,A(L,k,c)}else{let V=L.createOrUpdate({webgl:i,runtime:E},y,f,{group:k,structure:M});V&&await V}B.group=k}else throw new Error(`expected to find visual for hashCode ${k.hashCode}`);E.shouldUpdate&&await E.update({message:"Creating or updating UnitsVisual",current:R,max:p.length})}}else{let R=[];m.forEach(k=>R.push(k));for(let k=0,B=R.length;k<B;++k){let{visual:L,group:V}=R[k];if(L.mustRecreate?.({group:V,structure:d},f,t.webgl)){L.destroy(),L=n(s,d,f,i),R[k].visual=L;let U=L.createOrUpdate({webgl:i,runtime:E},y,f,{group:V,structure:d});U&&await U,A(L,V,c)}else{let U=L.createOrUpdate({webgl:i,runtime:E},y,f);U&&await U}E.shouldUpdate&&await E.update({message:"Creating or updating UnitsVisual",current:k,max:B})}}l.length=0,m.forEach(({visual:R})=>{R.renderObject&&(l.push(R.renderObject),u.add(R.renderObject.id,R.geometryVersion))}),u.snapshot(),M&&(d=M),a.next(o++)})}function x(D){let M=dr;return m.forEach(({visual:E})=>{let R=E.getLoci(D);Ii(R)||(M=R)}),M}function S(D){m.forEach(({visual:M})=>{M.eachLocation(D)})}function I(){return[De.Loci(d.child??d)]}function v(D,M){if(!d||!Wo.is(c.markerActions,M))return!1;if(De.isLoci(D)||K.Loci.is(D)||Ct.isLoci(D)){if(!De.areRootsEquivalent(D.structure,d))return!1;D=Jt.remap(D,d),(De.isLoci(D)||K.Loci.is(D)&&K.Loci.isWholeStructure(D))&&(D=Uh)}else if(!Ji(D)&&!iS(D))return!1;if(Jt.isEmpty(D))return!1;let E=!1;return m.forEach(({visual:R})=>{E=R.mark(D,M)||E}),E}function A(D,M,E){let{visible:R,alphaFactor:k,pickable:B,overpaint:L,transparency:V,emissive:U,substance:Q,clipping:O,themeStrength:q,transform:X,unitTransforms:F}=E;R!==void 0&&D.setVisibility(R),k!==void 0&&D.setAlphaFactor(k),B!==void 0&&D.setPickable(B),L!==void 0&&D.setOverpaint(L,i),V!==void 0&&D.setTransparency(V,i),U!==void 0&&D.setEmissive(U,i),Q!==void 0&&D.setSubstance(Q,i),O!==void 0&&D.setClipping(O),q!==void 0&&D.setThemeStrength(q),X!==void 0&&(X!==c.transform||!Z.areEqual(X,c.transform,1e-6))&&D.setTransform(X),F!==void 0&&(F?D.setTransform(void 0,F.getSymmetryGroupTransforms(M)):F!==c.unitTransforms&&D.setTransform(void 0,null))}function _(D){let{visible:M,alphaFactor:E,pickable:R,overpaint:k,transparency:B,emissive:L,substance:V,clipping:U,themeStrength:Q,transform:O,unitTransforms:q,syncManually:X,markerActions:F}=D,Y={};M!==void 0&&(Y.visible=M),E!==void 0&&(Y.alphaFactor=E),R!==void 0&&(Y.pickable=R),k!==void 0&&d&&(Y.overpaint=Ha.remap(k,d)),B!==void 0&&d&&(Y.transparency=ja.remap(B,d)),L!==void 0&&d&&(Y.emissive=Xa.remap(L,d)),V!==void 0&&d&&(Y.substance=Wa.remap(V,d)),U!==void 0&&d&&(Y.clipping=lo.remap(U,d)),Q!==void 0&&(Y.themeStrength=Q),O!==void 0&&!Z.areEqual(O,c.transform,1e-6)&&(Y.transform=O),(q!==c.unitTransforms||q?.version!==c.unitTransformsVersion)&&(Y.unitTransforms=q,c.unitTransformsVersion=q?q?.version:-1),X!==void 0&&(Y.syncManually=X),F!==void 0&&(Y.markerActions=F),m.forEach(({visual:$,group:ce})=>A($,ce,Y)),Gn.update(c,Y)}function T(D){y=D}function w(){m.forEach(({visual:D})=>D.destroy()),m.clear()}return{label:e,get groupCount(){let D=0;return m.forEach(({visual:M})=>{M.renderObject&&(D+=M.groupCount)}),D},get geometryVersion(){return u.version},get props(){return f},get params(){return h},get state(){return c},get theme(){return y},renderObjects:l,updated:a,createOrUpdate:g,setState:_,setTheme:T,getLoci:x,getAllLoci:I,eachLocation:S,mark:v,destroy:w}}function Met(e,t,r,n,o,i){let{createValues:a,createRenderableState:s}=Ga.getUtils(t),l=Jj(e,o.includeParent,t.boundingSphere,o.cellSize,o.batchSize),u=a(t,l,r,n,o),c=s(o);return Kd(t.kind,u,c,i)}function Ux(e,t){let{defaultProps:r,createGeometry:n,createLocationIterator:o,getLoci:i,eachLocation:a,setUpdateState:s,initUpdateState:l,mustRecreate:u,processValues:c,dispose:m}=e,{createEmpty:d,updateValues:p,updateBoundingSphere:h,updateRenderableState:f,createPositionIterator:y}=e.geometryUtils,g=ld.create(),x={loci:dr,action:0,status:-1},S,I=Object.assign({},r),v=pi.createEmpty(),A,_,T,w,D,M=-1,E,R;function k(q,X,F){if(!F&&!w)throw new Error("missing structureGroup");if(I=X,v=q,A=F,ld.reset(g),!S||!w){l?.(g,I,v,A),g.createNew=!0,g.createGeometry=!0;return}s(g,I,_,v,T,A,w),De.areHierarchiesEqual(w.structure,A.structure)||(g.updateTransform=!0,g.updateColor=!0,g.updateSize=!0),as.areEqual(v.color,T.color)||(g.updateColor=!0),yo.areEqual(v.size,T.size)||(g.updateSize=!0),w.structure.child!==A.structure.child&&(g.createGeometry=!0,g.updateTransform=!0),(I.instanceGranularity!==_.instanceGranularity||I.cellSize!==_.cellSize||I.batchSize!==_.batchSize)&&(g.updateTransform=!0),oa(I.unitKinds,_.unitKinds)||(g.createGeometry=!0),A.group.transformHash!==w.group.transformHash&&(A.group.units.length!==w.group.units.length||g.updateColor?g.updateTransform=!0:g.updateMatrix=!0);let Y=A.group.units[0],$=w.group.units[0];me.areOperatorsEqual(Y,$)||(g.updateTransform=!0),me.areConformationsEqual(Y,$)||(g.createGeometry=!0),g.updateTransform&&(g.updateMatrix=!0),g.updateSize&&!("uSize"in S.values)&&(g.createGeometry=!0),(g.createGeometry||g.updateTransform)&&(w.structure.hashCode!==A.structure.hashCode&&(g.updateColor=!0,g.updateSize=!0),(v.color.granularity.startsWith("vertex")||S.values.dColorType.ref.value.startsWith("vertex")||v.color.granularity.startsWith("volume")||S.values.dColorType.ref.value.startsWith("volume"))&&(g.updateColor=!0))}function B(q){if(g.createNew)if(E=o(A,I),q)S=Met(A,q,E,v,I,t),R=y(q,S.values);else throw new Error("expected geometry to be given");else{if(!S)throw new Error("expected renderObject to be available");if((g.updateColor||g.updateSize||g.updateTransform)&&(E=o(A,I)),g.updateTransform){let{instanceCount:X,groupCount:F}=E;I.instanceGranularity?oo(X,"instance",S.values):oo(X*F,"groupInstance",S.values)}if(g.updateMatrix&&(Jj(A,I.includeParent,q?.boundingSphere||S.values.invariantBoundingSphere.ref.value,I.cellSize,I.batchSize,S.values),"lodLevels"in S.values&&P.update(S.values.lodLevels,S.values.lodLevels.ref.value)),g.createGeometry)if(q)P.updateIfChanged(S.values.drawCount,Ga.getDrawCount(q)),P.updateIfChanged(S.values.uVertexCount,Ga.getVertexCount(q)),P.updateIfChanged(S.values.uGroupCount,E.groupCount);else throw new Error("expected geometry to be given");(g.updateTransform||g.createGeometry)&&(h(S.values,q||D),R=y(q||D,S.values)),g.updateSize&&"uSize"in S.values&&Ml(E,v.size,S.values),g.updateColor&&Ki(E,R,v.color,S.values),p(S.values,I),f(S.state,I)}_=I,T=v,w=A,q&&(D=q,M+=1)}function L(q,X,F,Y,$,ce){return C0e($.unitKinds,X)?n(q,X,F,Y,$,ce):d(ce)}function V(q){return!!(Ji(q)||De.isLoci(q)&&De.areRootsEquivalent(q.structure,w.structure)||K.Loci.is(q)&&De.areRootsEquivalent(q.structure,w.structure)&&K.Loci.isWholeStructure(q))}function U(q,X,F){let Y=!1;if(Ct.isLoci(q)){let{structure:$,group:ce}=X;if(!De.areEquivalent(q.structure,$))return!1;for(let ie of q.bonds){if(ie.aUnit!==ie.bUnit)continue;let oe=ce.unitIndexMap.get(ie.aUnit.id);oe!==void 0&&F(xe.ofSingleton(oe))&&(Y=!0)}}else if(K.Loci.is(q)){let{structure:$,group:ce}=X;if(!De.areEquivalent(q.structure,$))return!1;for(let ie of q.elements){let oe=ce.unitIndexMap.get(ie.unit.id);oe!==void 0&&F(xe.ofSingleton(oe))&&(Y=!0)}}return Y}function Q(q,X,F){return V(q)?_.instanceGranularity?X(xe.ofBounds(0,E.instanceCount)):X(xe.ofBounds(0,E.groupCount*E.instanceCount)):_.instanceGranularity?U(q,w,X):a(q,w,X,F)}function O(q){S&&c?.(S.values,D,_,T,q.webgl)}return{get groupCount(){return E?E.count:0},get renderObject(){return E&&E.count?S:void 0},get geometryVersion(){return M},createOrUpdate(q,X,F,Y){if(k(X,F,Y||w),g.createGeometry){let $=L(q,A.group.units[0],A.structure,v,I,D);if(Eb($))return $.then(ce=>{B(ce),O(q)});B($)}else B();O(q)},getLoci(q){return S?i(q,w,S.id):dr},eachLocation(q){for(E.reset();E.hasNext;){let{location:X,isSecondary:F}=E.move();q(X,F)}},mark(q,X){let F=!0;if(K.Loci.is(q)){F=!1;let{invariantId:Y}=w.group.units[0];for(let $ of q.elements)if($.unit.invariantId===Y){F=!0;break}}return F?Fr.mark(S,q,X,Q,x):!1},setVisibility(q){Fr.setVisibility(S,q)},setAlphaFactor(q){Fr.setAlphaFactor(S,q)},setPickable(q){Fr.setPickable(S,q)},setColorOnly(q){Fr.setColorOnly(S,q)},setTransform(q,X){Fr.setTransform(S,q,X)},setOverpaint(q,X){let F={geometry:D,props:_,webgl:X};Fr.setOverpaint(S,q,Q,!0,F)},setTransparency(q,X){let F={geometry:D,props:_,webgl:X};Fr.setTransparency(S,q,Q,!0,F)},setEmissive(q,X){let F={geometry:D,props:_,webgl:X};Fr.setEmissive(S,q,Q,!0,F)},setSubstance(q,X){let F={geometry:D,props:_,webgl:X};Fr.setSubstance(S,q,Q,!0,F)},setClipping(q){Fr.setClipping(S,q,Q,!0)},setThemeStrength(q){Fr.setThemeStrength(S,q)},destroy(){m?.(D),S&&(S.state.disposed=!0,S=void 0)},mustRecreate:u}}var ro={...Zk,...Xs};function So(e,t){return Ux({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:ft.Utils},t)}var WI={...qk,...Xs};function XI(e,t){return Ux({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:Ts.Utils},t)}var QI={...Yk,...Xs};function ZI(e,t){return Ux({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:Di.Utils},t)}var k0e={...Kk,...Xs};function L0e(e,t){return Ux({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:ml.Utils},t)}var Nx={...Jk,...Xs};function zx(e,t){return Ux({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.updateSize=!0)},geometryUtils:ln.Utils},t)}var IVr={...$k,...Xs};var F0e={...eL,...Xs};function V0e(e,t){return Ux({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:Bl.Utils},t)}var O0e={...tL,...Xs};function G0e(e,t){return Ux({...e,setUpdateState:(r,n,o,i,a,s,l)=>{e.setUpdateState(r,n,o,i,a,s,l),yo.areEqual(i.size,a.size)||(r.createGeometry=!0)},geometryUtils:is.Utils},t)}var AVr={...rL,...Xs};var Gn={create:()=>({...Vt.createState(),unitTransforms:null,unitTransformsVersion:-1}),update:(e,t)=>{Vt.updateState(e,t),t.unitTransforms!==void 0&&(e.unitTransforms=t.unitTransforms)}};var Bet=Qe.add3,ket=Qe.add,jh;(t=>{function e(r=2048,n=1024,o){let i=Qe.create(Float32Array,3,n,o?o.centerBuffer.ref.value:r),a=Qe.create(Float32Array,1,n,o?o.groupBuffer.ref.value:r);return{add:(s,l,u,c)=>{Bet(i,s,l,u),ket(a,c)},getSpheres:()=>{let s=Qe.compact(i,!0),l=Qe.compact(a,!0);return Ts.create(s,l,i.elementCount,o)}}}t.create=e})(jh||={});var qI=b.add;function Bc(e,t,r){let{ignoreHydrogens:n,ignoreHydrogensVariant:o,traceOnly:i}=r,a=me.isCoarse(t),{child:s}=e,l=s?.unitMap.get(t.id);if(s&&!l)throw new Error("expected childUnit to exist if child exists");if(!(!s&&!n&&!i))return u=>!!l&&!Be.has(l.elements,u)||!a&&n&&Mc(e,t,u,o)||i&&!Qk(t,u)}function U0e(e,t,r,n,o,i){let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return ft.createEmpty(i);let{detail:l,sizeFactor:u,stride:c}=o,{elements:m,conformation:d}=t,p=m.length,h=p*pm(l),f=et.createState(h,h/2,i),y=b(),g=Bc(r,t,o),x=K.Location.create(r,t),S=n.size.size,I=b(),v=0,A=0;for(let D=0;D<p;D++){if(c&&D%c!==0||g&&g(m[D]))continue;d.invariantPosition(m[D],y),qI(I,I,y),A+=1,x.element=m[D];let M=S(x);M>v&&(v=M),f.currentGroup=D,Nr(f,y,M*u,l)}let _=et.getMesh(f);if(A===0)return _;let T;b.scale(I,I,1/A);let w=i?ye.clone(i.boundingSphere):void 0;return w&&b.distance(I,w.center)/w.radius<.1?T=w:T=ye.expand(ye(),(s??t).boundary.sphere,v*u+.05),_.setBoundingSphere(T),_}function N0e(e,t,r,n,o,i){let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return Ts.createEmpty(i);let{sizeFactor:l,stride:u}=o,{elements:c,conformation:m}=t,d=c.length,p=jh.create(d,d/2,i),h=b(),f=Bc(r,t,o),y=K.Location.create(r,t),g=n.size.size,x=b(),S=0,I=0;if(u&&u>1||f||n.size.granularity!=="uniform")for(let T=0;T<d;T++){if(u&&T%u!==0||f&&f(c[T]))continue;m.invariantPosition(c[T],h),p.add(h[0],h[1],h[2],T),qI(x,x,h),I+=1,y.element=c[T];let w=g(y);w>S&&(S=w)}else{for(let T=0;T<d;T++)m.invariantPosition(c[T],h),p.add(h[0],h[1],h[2],T),qI(x,x,h);I=d,S=g(y)}let v=p.getSpheres();if(I===0)return v;let A;b.scale(x,x,1/I);let _=i?ye.clone(i.boundingSphere):void 0;return _&&b.distance(x,_.center)/_.radius<.1?A=_:A=ye.expand(ye(),(s??t).boundary.sphere,S*l+.05),v.setBoundingSphere(A),v}function Qs(e,t,r){let n=!1;if(!K.Loci.is(e))return!1;let{structure:o,group:i}=t;if(!De.areEquivalent(e.structure,o))return!1;let a=i.elements.length,{unitIndexMap:s}=i;for(let l of e.elements){let u=s.get(l.unit.id);if(u!==void 0){let c=u*a;if(xe.is(l.indices)){let m=c+xe.start(l.indices),d=c+xe.end(l.indices);r(xe.ofBounds(m,d))&&(n=!0)}else for(let m=0,d=l.indices.length;m<d;m++){let p=l.indices[m],h=m+1;for(;h<d&&l.indices[h]===p;)h++;m=h-1;let f=l.indices[m];n=r(xe.ofRange(c+p,c+f))||n}}}return n}function Zs(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:a,group:s}=t,l=s.units[o],u=Se.ofSingleton(i);return K.Loci(a.target,[{unit:l,indices:u}])}return dr}function z0e(e,t,r,n,o){let{child:i}=t,{detail:a,sizeFactor:s,stride:l}=n,{getSerialIndex:u}=t.serialMapping,m=t.elementCount*pm(a),d=et.createState(m,m/2,o),p=r.size.size,h=b(),f=0,y=0;for(let I of t.units){let v=i?.unitMap.get(I.id);if(i&&!v)continue;let{elements:A,conformation:_}=I,T=A.length,w=b(),D=Bc(t,I,n),M=K.Location.create(t,I);for(let E=0;E<T;E++){let R=A[E];if(l&&E%l!==0||D&&D(R))continue;_.position(R,w),qI(h,h,w),y+=1,M.element=R;let k=p(M);k>f&&(f=k),d.currentGroup=u(I,R),Nr(d,w,k*s,a)}}let g=et.getMesh(d);if(y===0)return g;let x;b.scale(h,h,1/y);let S=o?ye.clone(o.boundingSphere):void 0;return S&&b.distance(h,S.center)/S.radius<1?x=S:x=ye.expand(ye(),(i??t).boundary.sphere,f*s+.05),g.setBoundingSphere(x),g}function H0e(e,t,r,n,o){let{child:i}=t,{sizeFactor:a,stride:s}=n,{getSerialIndex:l}=t.serialMapping,u=t.elementCount,c=jh.create(u,u/2,o),m=r.size.size,d=b(),p=0,h=0;for(let x of t.units){let S=i?.unitMap.get(x.id);if(i&&!S)continue;let{elements:I,conformation:v}=x,A=I.length,_=b(),T=Bc(t,x,n),w=K.Location.create(t,x);if(s&&s>1||T||r.size.granularity!=="uniform")for(let D=0;D<A;D++){let M=I[D];if(s&&D%s!==0||T&&T(M))continue;v.position(M,_),c.add(_[0],_[1],_[2],l(x,M)),qI(d,d,_),h+=1,w.element=M;let E=m(w);E>p&&(p=E)}else{for(let D=0;D<A;D++){let M=I[D];v.position(M,_),c.add(_[0],_[1],_[2],l(x,M)),qI(d,d,_)}h+=A,p=m(w)}}let f=c.getSpheres();if(h===0)return f;let y;b.scale(d,d,1/h);let g=o?ye.clone(o.boundingSphere):void 0;return g&&b.distance(d,g.center)/g.radius<1?y=g:y=ye.expand(ye(),(i??t).boundary.sphere,p*a+.05),f.setBoundingSphere(y),f}function Ca(e,t,r){let n=!1;if(!K.Loci.is(e)||!De.areEquivalent(e.structure,t))return!1;let{cumulativeUnitElementCount:o}=t.serialMapping;for(let i of e.elements){let a=t.unitIndexMap.get(i.unit.id);if(a!==void 0)if(xe.is(i.indices)){let s=o[a]+xe.start(i.indices),l=o[a]+xe.end(i.indices);r(xe.ofBounds(s,l))&&(n=!0)}else for(let s=0,l=i.indices.length;s<l;s++){let u=o[a]+i.indices[s];r(xe.ofSingleton(u))&&(n=!0)}}return n}function Sa(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let{unitIndices:i,cumulativeUnitElementCount:a}=t.serialMapping,s=i[o],l=t.units[s],u=o-a[s],c=Se.ofSingleton(u);return K.Loci(t,[{unit:l,indices:c}])}return dr}var uo;(r=>{function e(n){let{group:o,structure:i}=n,a=o.elements.length,s=o.units.length,l=K.Location.create(i);return Kr(a,s,1,(c,m)=>{let d=o.units[m];return l.unit=d,l.element=d.elements[c],l})}r.fromGroup=e;function t(n){let{units:o,elementCount:i}=n,a=i,s=1,{unitIndices:l,elementIndices:u}=n.serialMapping,c=K.Location.create(n);return Kr(a,s,1,d=>(c.unit=o[l[d]],c.element=u[d],c),!0)}r.fromStructure=t})(uo||={});var Dy={..._0e,background:C.Boolean(!1),backgroundMargin:C.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:C.Color(Lt.black),backgroundOpacity:C.Numeric(.5,{min:0,max:1,step:.01}),borderWidth:C.Numeric(.25,{min:0,max:.5,step:.01}),level:C.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]],{isEssential:!0}),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),chainScale:C.Numeric(10,{min:0,max:20,step:.1}),residueScale:C.Numeric(1,{min:0,max:20,step:.1}),elementScale:C.Numeric(.5,{min:0,max:20,step:.1})};function j0e(e){return jI({defaultProps:C.getDefaultValues(Dy),createGeometry:Let,createLocationIterator:uo.fromStructure,getLoci:Sa,eachLocation:Ca,setUpdateState:(t,r,n)=>{t.createGeometry=r.level!==n.level||r.level==="chain"&&r.chainScale!==n.chainScale||r.level==="residue"&&r.residueScale!==n.residueScale||r.level==="element"&&r.elementScale!==n.elementScale||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant}},e)}function Let(e,t,r,n,o){switch(n.level){case"chain":return Fet(e,t,r,n,o);case"residue":return Vet(e,t,r,n,o);case"element":return Oet(e,t,r,n,o)}}var dp=b(),j_=new Ci("98");function Fet(e,t,r,n,o){let i=K.Location.create(t),{units:a,serialMapping:s}=t,{auth_asym_id:l,label_asym_id:u}=qe.chain,{cumulativeUnitElementCount:c}=s,m=a.length,{chainScale:d}=n,p=_s.create(n,m,m/2,o);for(let h=0,f=a.length;h<f;++h){let y=a[h];i.unit=y,i.element=y.elements[0];let{center:g,radius:x}=y.lookup3d.boundary.sphere;b.transformMat4(dp,g,y.conformation.operator.matrix);let S=l(i),I=u(i),v=S===I?I:`${I} [${S}]`;p.add(v,dp[0],dp[1],dp[2],x,d,c[h])}return p.getText()}function Vet(e,t,r,n,o){let i=K.Location.create(t),{units:a,serialMapping:s}=t,{label_comp_id:l}=qe.atom,{auth_seq_id:u}=qe.residue,{cumulativeUnitElementCount:c}=s,m=t.polymerResidueCount*2,{residueScale:d}=n,p=_s.create(n,m,m/2,o);for(let h=0,f=a.length;h<f;++h){let y=a[h],g=y.conformation,{elements:x}=y;i.unit=y,i.element=y.elements[0];let S=y.model.atomicHierarchy.residueAtomSegments.index,I=c[h],v=0,A=x.length;for(;v<A;){let _=v,T=S[x[v]];for(v++;v<A&&S[x[v]]===T;)v++;j_.reset();for(let k=_;k<v;k++)g.position(x[k],dp),j_.includePosition(dp);j_.finishedIncludeStep();for(let k=_;k<v;k++)g.position(x[k],dp),j_.radiusPosition(dp);i.element=x[_];let{center:w,radius:D}=j_.getSphere(),M=u(i),R=`${l(i)} ${M}`;p.add(R,w[0],w[1],w[2],D,d,I+_)}}return p.getText()}function Oet(e,t,r,n,o){let i=K.Location.create(t),{units:a,serialMapping:s}=t,{label_atom_id:l,label_alt_id:u}=qe.atom,{cumulativeUnitElementCount:c}=s,m=r.size,d=t.elementCount,{elementScale:p}=n,h=_s.create(n,d,d/2,o);for(let f=0,y=a.length;f<y;++f){let g=a[f],x=g.conformation,{elements:S}=g;i.unit=g;let I=c[f],v=Bc(t,g,{...n,traceOnly:!1});for(let A=0,_=S.length;A<_;A++){if(v&&v(S[A]))continue;i.element=S[A],x.position(i.element,dp);let T=l(i),w=u(i),D=w?`${T}%${w}`:T;h.add(D,dp[0],dp[1],dp[2],m.size(i),p,I+A)}}return h.getText()}var YI=b(),iL=[],W_=new Ci("98"),X0e=[],Q0e={},e8=class{constructor(t){this.rows=t;this.cache={};this.hasOperators=t.some(r=>rn(r.instance_id))}get(t){let r=t.conformation.operator.instanceId,n=this.hasOperators?`${t.model.id}:${r}`:t.model.id;return this.cache[n]??=Wce(this.rows,t.model,r,i_.get(t.model))}};function aL(e,t,r,n){let o=K.Location.create(e),{units:i}=e,{type_symbol:a}=qe.atom;iL.length=0;let s=0,l=0,u,c,m=new e8(r);for(let d=0,p=i.length;d<p;d++){let h=i[d];if(n&&h.model.id!==n.id)continue;let f=m.get(h);o.unit=h,Va.selectAtomsInRanges(h.elements,f,X0e,Q0e);for(let y of X0e)o.element=y,h.conformation.position(y,YI),ib(iL,YI),u??=e.serialMapping.cumulativeUnitElementCount[d]+Q0e.value,c??=t(o),s++,a(o)!=="H"&&l++}if(s>0){let{center:d,radius:p}=s>1?Get(iL):{center:b.fromArray(b(),iL,0),radius:1.1*c},h=(l||s)**(1/3);return{center:d,depth:p,scale:h,group:u}}}function Get(e){let t=e.length;W_.reset();for(let r=0;r<t;r+=3)b.fromArray(YI,e,r),W_.includePosition(YI);W_.finishedIncludeStep();for(let r=0;r<t;r+=3)b.fromArray(YI,e,r),W_.radiusPosition(YI);return W_.getSphere()}var t8={annotationId:C.Text("",{description:'Reference to "Annotation" custom model property',isEssential:!0}),fieldName:C.Text("label",{description:"Annotation field (column) from which to take label contents",isEssential:!0}),...nc(Dy,["level","chainScale","residueScale","elementScale"]),borderColor:{...Dy.borderColor,defaultValue:Lt.black}};function Z0e(e){return jI({defaultProps:C.getDefaultValues(t8),createGeometry:Uet,createLocationIterator:uo.fromStructure,getLoci:Sa,eachLocation:Ca,setUpdateState:(t,r,n)=>{t.createGeometry=r.annotationId!==n.annotationId||r.fieldName!==n.fieldName}},e)}function Uet(e,t,r,n,o){let{annotation:i,model:a}=tI(t,n.annotationId),s=i?.getRows()??[],{count:l,offsets:u,grouped:c}=Xce(s),m=_s.create(n,l,l/2,o);for(let d=0;d<l;d++){let p=c[u[d]],h=i.getValueForRow(p,n.fieldName);if(!h)continue;let f=c.slice(u[d],u[d+1]).map(g=>s[g]),y=aL(t,r.size.size,f,a);y&&m.add(h,y.center[0],y.center[1],y.center[2],y.depth,y.scale,y.group)}return m.getText()}var Y0e={"label-text":(e,t)=>to("Label text",e,t,Z0e)},q0e={...t8,visuals:C.MultiSelect(["label-text"],C.objectToOptions(Y0e))};function Net(e,t){let r=Vt.createMulti("Label",e,t,Gn,Y0e);return r.setState({pickable:!1,markerActions:0}),r}var sL={name:"mvs-annotation-label",label:"MVS Annotation Label",description:"Displays labels based on annotation custom model property",factory:Net,getParams:()=>q0e,defaultValues:C.getDefaultValues(q0e),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0&&yx(e)};var r8={tooltips:C.ObjectList({annotationId:C.Text("",{description:'Reference to "MVS Annotation" custom model property'}),fieldName:C.Text("tooltip",{description:"Annotation field (column) from which to take color values"})},e=>`${e.annotationId}:${e.fieldName}`)},fS=Pl.createProvider({label:"MVS Annotation Tooltips",descriptor:{name:"mvs-annotation-tooltips"},type:"local",defaultParams:r8,getParams:e=>r8,isApplicable:e=>e.root===e,obtain:async(e,t,r)=>({value:{...C.getDefaultValues(r8),...r}})}),K0e={label:e=>{switch(e.kind){case"element-loci":if(!e.structure.customPropertyDescriptors.hasReference(fS.descriptor))return;let t=K.Loci.getFirstLocation(e);if(!t)return;let r=fS.get(t.structure).value;if(!r||r.tooltips.length===0)return;let n=cy.get(t.unit.model).value,o=r.tooltips.map(i=>n?.getAnnotation(i.annotationId)?.getValueForLocation(t,i.fieldName));return tB(o).join(" | ");default:return}}};var n8={annotationId:C.Text("",{description:'Reference to "Annotation" custom model property'}),fieldName:C.Text("component",{description:"Annotation field (column) from which to take component identifier"}),fieldValues:C.MappedStatic("all",{all:C.EmptyGroup(),selected:C.ObjectList({value:C.Text()},e=>e.value)}),nullIfEmpty:C.Optional(C.Boolean(!0,{isHidden:!1})),label:C.Text("",{isHidden:!1})},wy=Je.builderFactory("mvs"),o8=wy({name:"mvs-structure-component-from-annotation",display:{name:"MVS Annotation Component",description:"A molecular structure component defined by MVS annotation data."},from:re.Molecule.Structure,to:re.Molecule.Structure,params:n8})({apply({a:e,params:t}){return i8(e.data,t)},update:({a:e,b:t,oldParams:r,newParams:n})=>Het(e.data,t,r,n),dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}});function zet(e,t){let{annotation:r}=tI(e,t.annotationId);if(r){let n=r.getRows();if(t.fieldValues.name==="selected"){let a=new Set(t.fieldValues.params.map(s=>s.value));n=n.filter((s,l)=>a.has(r.getValueForRow(l,t.fieldName)))}let o=eI(n),{selection:i}=Ps.createAndRun(e,o);return at.unionStructure(i)}else return De.Empty}function i8(e,t){let r=zet(e,t);if(t.nullIfEmpty&&r.elementCount===0)return An.Null;let n=t.label;if(n===void 0||n==="")if(t.fieldValues.name==="selected"&&t.fieldValues.params.length>0){let i=t.fieldValues.params,a=`"${i[0].value}"`;i.length===2?a+=` + "${i[1].value}"`:i.length>2&&(a+=` + ${i.length-1} more values`),n=`MVS Annotation Component (${t.fieldName}: ${a})`}else n="MVS Annotation Component";let o={label:n,description:De.elementDescription(r)};return new re.Molecule.Structure(r,o)}function Het(e,t,r,n){let o=!oa(n,r),i=!oa(nc(n,["label"]),nc(r,["label"]));return o?i?Je.UpdateResult.Recreate:(t.label=n.label||t.label,Je.UpdateResult.Updated):Je.UpdateResult.Unchanged}var jet=new fx(xY(Pbe,e=>Kc(e)),"all"),KI=C.MappedStatic("static",{static:jet.PDSelect(),expression:C.Value(ne.struct.generator.all),bundle:C.Value(K.Bundle.Empty),script:C.Script({language:"mol-script",expression:"(sel.atom.all)"}),annotation:C.Group(rc(n8,["annotationId","fieldName","fieldValues"]))},{description:"Define a part of the structure where this layer applies (use Static:all to apply to the whole structure)"}),J0e={name:"static",params:"all"};function $0e(e){return e.name==="static"&&e.params==="all"}var JI={fromStructure(e){if(!e)return{};let t={};for(let r of e.units)t[r.id]=r.elements;return t},fromSelector(e,t){if(!e)return{};let r=X_(e,t);return this.fromStructure(r)},has(e,t){let r=e[t.unit.id];return r?Be.has(r,t.element):!1}};function X_(e,t){let r=t.name==="annotation"?i8(e,{...t.params,label:"",nullIfEmpty:!1}):CI(e,{type:t,label:"",nullIfEmpty:!1},{source:e});return re.Molecule.Structure.is(r)?r.data:De.Empty}var a8={items:C.ObjectList({text:C.Text("\xAF\\_(\u30C4)_/\xAF"),position:C.MappedStatic("selection",{x_y_z:C.Group({x:C.Numeric(0),y:C.Numeric(0),z:C.Numeric(0),scale:C.Numeric(1,{min:0,max:20,step:.1})}),selection:C.Group({selector:KI})})},e=>e.text,{isEssential:!0}),...nc(Dy,["level","chainScale","residueScale","elementScale"]),borderColor:{...Dy.borderColor,defaultValue:Lt.black}};function eSe(e){return jI({defaultProps:C.getDefaultValues(a8),createGeometry:Wet,createLocationIterator:uo.fromStructure,getLoci:Sa,eachLocation:Ca,setUpdateState:(t,r,n)=>{t.createGeometry=!oa(r.items,n.items)}},e)}function Wet(e,t,r,n,o){let i=n.items.length,a=_s.create(n,i,i/2,o);for(let s of n.items)switch(s.position.name){case"x_y_z":let l=s.position.params.scale;a.add(s.text,s.position.params.x,s.position.params.y,s.position.params.z,l,l,0);break;case"selection":let u=X_(t,s.position.params.selector),c=aL(u,r.size.size,[{}]),m=Xet(t,u)??0;c&&a.add(s.text,c.center[0],c.center[1],c.center[2],c.depth,c.scale,m);break}return a.getText()}function Xet(e,t){if(t.isEmpty)return;let r=t.units[0],n=r.elements[0];for(let o of e.units)if(o.model.id===r.model.id&&Be.has(o.elements,n))return e.serialMapping.getSerialIndex(o,n)}var rSe={"label-text":(e,t)=>to("Label text",e,t,eSe)},tSe={...a8,visuals:C.MultiSelect(["label-text"],C.objectToOptions(rSe))};function Qet(e,t){let r=Vt.createMulti("Label",e,t,Gn,rSe);return r.setState({pickable:!1,markerActions:0}),r}var lL={name:"mvs-custom-label",label:"MVS Custom Label",description:"Displays labels with custom text",factory:Qet,getParams:()=>tSe,defaultValues:C.getDefaultValues(tSe),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0&&yx(e)};var s8={tooltips:C.ObjectList({text:C.Text("",{description:"Text of the tooltip"}),selector:KI},e=>e.text)},hS=Pl.createProvider({label:"MVS Custom Tooltips",descriptor:{name:"mvs-custom-tooltips"},type:"local",defaultParams:s8,getParams:e=>s8,isApplicable:e=>e.root===e,obtain:async(e,t,r)=>({value:{...C.getDefaultValues(s8),...r}.tooltips.map(i=>({selector:i.selector,text:i.text}))})}),nSe={label:e=>{switch(e.kind){case"element-loci":if(!e.structure.customPropertyDescriptors.hasReference(hS.descriptor))return;let t=K.Loci.getFirstLocation(e);if(!t)return;let r=hS.get(t.structure).value;if(!r||r.length===0)return;let n=[];for(let o of r){let i=o.elementSet??=JI.fromSelector(t.structure,o.selector);JI.has(i,t)&&n.push(o.text)}return tB(n).join(" | ");default:return}}};function $I(e,t){if(e.ext==="bcif")try{let{encoder:r}=XM(t);if(r.startsWith("VolumeServer"))return"dscif";if(r.startsWith("volseg-volume-server"))return"segcif"}catch(r){console.error(r)}else if(e.ext==="cif"){let r=t;if(r.startsWith(`data_SERVER
#
_density_server_result`))return"dscif";if(r.startsWith(`data_SERVER
#
data_SEGMENTATION_DATA`))return"segcif";if(r.includes("atom_site_fract_x")||r.includes("atom_site.fract_x"))return"coreCif"}return-1}var Q_="5.0.0-dev.0",oSe=new Date(1753461817093);function Zet(e,t,r,n=1){e.width=Math.round(window.devicePixelRatio*n*t),e.height=Math.round(window.devicePixelRatio*n*r),Object.assign(e.style,{width:`${t}px`,height:`${r}px`})}function iSe(e,t,r=1){let n=window.innerWidth,o=window.innerHeight;t!==document.body&&(n=t.offsetWidth,o=t.offsetHeight),Zet(e,n,o,r)}function qet(e,t,r,n){let o=atob(e.toDataURL(r,n).split(",")[1]),i=o.length,a=i>>2,s=new Uint8Array(i),l=new Uint32Array(s.buffer,0,a),u=0;for(let m=0;m<a;++m)l[m]=o.charCodeAt(u++)|o.charCodeAt(u++)<<8|o.charCodeAt(u++)<<16|o.charCodeAt(u++)<<24;let c=i&3;for(;c--;)s[u]=o.charCodeAt(u++);t(new Blob([s],{type:r||"image/png"}))}async function Z_(e,t,r){return new Promise((n,o)=>{let i=a=>{a?n(a):o("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(i,t,r):qet(e,i,t,r)})}var pp=class e extends Bs{constructor(r){super({current:void 0,entries:ah(),isPlaying:!1,nextSnapshotDelayInMs:e.DefaultNextSnapshotDelayInMs});this.plugin=r;this.entryMap=new Map;this.defaultSnapshotId=void 0;this.events={changed:this.ev(),opened:this.ev()};this.timeoutHandle=void 0;this.next=async()=>{this.timeoutHandle=void 0;let r=this.getNextId(this.state.current,1);if(!r||r===this.state.current){this.stop();return}let n=this.setCurrent(r);await this.plugin.state.setSnapshot(n);let o=typeof n.durationInMs<"u"?n.durationInMs:this.state.nextSnapshotDelayInMs;this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o))}}static{this.DefaultNextSnapshotDelayInMs=1500}get current(){let r=this.state.current;return this.state.entries.find(n=>n.snapshot.id===r)}getIndex(r){return this.state.entries.indexOf(r)}getEntry(r){if(r)return this.entryMap.get(r)}remove(r){let n=this.entryMap.get(r);n&&(n?.image&&this.plugin.managers.asset.delete(n.image),this.entryMap.delete(r),this.updateState({current:this.state.current===r?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(n))}),this.events.changed.next(void 0))}add(r){this.entryMap.set(r.snapshot.id,r),this.updateState({current:r.snapshot.id,entries:this.state.entries.push(r)}),this.events.changed.next(void 0)}replace(r,n,o){let i=this.getEntry(r);if(!i)return;this.defaultSnapshotId=void 0,i?.image&&this.plugin.managers.asset.delete(i.image);let a=this.getIndex(i),s=e.Entry(n,{key:o?.key??i.key,name:o?.name??i.name,description:o?.description??i.description,descriptionFormat:o?.descriptionFormat??i.descriptionFormat,image:o?.image});this.entryMap.set(n.id,s),this.updateState({current:s.snapshot.id,entries:this.state.entries.set(a,s)}),this.events.changed.next(void 0)}move(r,n){let o=this.state.entries.size;if(o<2)return;let i=this.getEntry(r);if(!i)return;let a=this.getIndex(i),s=(a+n)%o;s<0&&(s+=o);let l=this.state.entries.get(s),u=this.state.entries.asMutable();u.set(s,i),u.set(a,l),this.updateState({current:i.snapshot.id,entries:u.asImmutable()}),this.events.changed.next(void 0)}update(r,n){let o=this.getIndex(r);if(o<0)return;let i=this.state.entries.set(o,{...r,key:n.key?.trim()||void 0,name:n.name?.trim()||void 0,description:n.description?.trim()||void 0,descriptionFormat:n.descriptionFormat});this.updateState({entries:i}),this.entryMap.set(r.snapshot.id,this.state.entries.get(o)),this.events.changed.next(void 0)}clear(){this.state.entries.size!==0&&(this.entryMap.forEach(r=>{r?.image&&this.plugin.managers.asset.delete(r.image)}),this.entryMap.clear(),this.updateState({current:void 0,entries:ah()}),this.events.changed.next(void 0))}applyKey(r){let n=this.state.entries.find(o=>o.key===r);n&&(this.updateState({current:n.snapshot.id}),this.events.changed.next(void 0),this.plugin.state.setSnapshot(n.snapshot))}setCurrent(r){let n=this.getEntry(r);return n&&(this.updateState({current:r}),this.events.changed.next(void 0)),n&&n.snapshot}getNextId(r,n){let o=this.state.entries.size;if(!r){if(o===0)return;let s=n===-1?o-1:0;return this.state.entries.get(s).snapshot.id}let i=this.getEntry(r);if(!i)return;let a=this.getIndex(i);if(!(a<0))return a=(a+n)%o,a<0&&(a+=o),this.state.entries.get(a).snapshot.id}applyNext(r){let n=this.getNextId(this.state.current,r);if(n){let o=this.setCurrent(n);if(o)return this.plugin.state.setSnapshot(o)}}async setStateSnapshot(r){r.version,Q_,this.clear();let n=ah().asMutable();for(let s of r.entries)this.entryMap.set(s.snapshot.id,s),n.push(s);let o=r.current?r.current:r.entries.length>0?r.entries[0].snapshot.id:void 0;if(this.updateState({current:o,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:r.playback?r.playback.nextSnapshotDelayInMs:e.DefaultNextSnapshotDelayInMs}),this.events.changed.next(void 0),!o)return;let i=this.getEntry(o),a=i&&i.snapshot;if(a)return await this.plugin.state.setSnapshot(a),r.playback&&r.playback.isPlaying&&this.play(!0),a}async syncCurrent(r){let n=this.state.entries.size===0,o=this.state.entries.size===1&&this.state.current&&(!this.defaultSnapshotId||this.state.current===this.defaultSnapshotId);if(!n&&!o)return;let i=this.plugin.state.getSnapshot(r?.params),a=r?.params?.image??this.plugin.state.snapshotParams.value.image?await e.getCanvasImageAsset(this.plugin,`${i.id}-image.png`):void 0;if(n)this.add(e.Entry(i,{name:r?.name,description:r?.description,descriptionFormat:r?.descriptionFormat,image:a}));else if(o){let s=this.getEntry(this.state.current);s?.image&&this.plugin.managers.asset.delete(s.image),this.replace(this.state.current,i,{image:a})}this.defaultSnapshotId=i.id}async getStateSnapshot(r){return await this.syncCurrent(r),{timestamp:+new Date,version:Q_,name:r&&r.name,description:r&&r.description,current:this.state.current,playback:{isPlaying:!!(r&&r.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:this.state.entries.valueSeq().toArray()}}async serialize(r){let n=JSON.stringify(await this.getStateSnapshot({params:r?.params}),null,2);if(!r?.type||r.type==="json"||r.type==="molj")return new Blob([n],{type:"application/json;charset=utf-8"});{let o=new Uint8Array(bv(n));qb(o,0,n);let i={"state.json":o},a=[];for(let{asset:l,file:u}of this.plugin.managers.asset.assets)a.push([l.id,l]),i[`assets/${l.id}`]=new Uint8Array(await u.arrayBuffer());if(a.length>0){let l=JSON.stringify(a,null,2),u=new Uint8Array(bv(l));qb(u,0,l),i["assets.json"]=u}let s=await this.plugin.runTask(Bae(i));return new Blob([s],{type:"application/zip"})}}async open(r){try{let n=r.name.toLowerCase();if(n.endsWith("json")||n.endsWith("molj")){let o=await this.plugin.runTask(mh(r,"string")),i=JSON.parse(tm.toString(o));e.isStateSnapshot(i)?await this.setStateSnapshot(i):e.isStateSnapshot(i.data)?await this.setStateSnapshot(i.data):await this.plugin.state.setSnapshot(i)}else{let o=await this.plugin.runTask(mh(r,"zip")),i=Object.create(null);gi(o,(l,u)=>{if(u==="state.json"||u==="assets.json")return;let c=u.substring(u.indexOf("/")+1);i[c]=l});let a=new File([o["state.json"]],"state.json"),s=await this.plugin.runTask(mh(a,"json"));if(o["assets.json"]){let l=new File([o["assets.json"]],"assets.json"),u=await this.plugin.runTask(mh(l,"json"));for(let[c,m]of u)this.plugin.managers.asset.set(m,new File([i[c]],m.name))}await this.setStateSnapshot(s)}this.events.opened.next(void 0)}catch(n){console.error(n),this.plugin.log.error("Error reading state")}}play(r=!1){if(this.updateState({isPlaying:!0}),r){let n=this.getEntry(this.state.current);if(!n){this.next();return}this.events.changed.next(void 0);let o=n.snapshot,i=typeof o.durationInMs<"u"?o.durationInMs:this.state.nextSnapshotDelayInMs;this.timeoutHandle=setTimeout(this.next,i)}else this.next()}stop(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle<"u"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next(void 0)}togglePlay(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()}dispose(){super.dispose(),this.entryMap.clear()}};(n=>{function e(o,i){return{timestamp:+new Date,snapshot:o,...i}}n.Entry=e;function t(o){let i=o;return!!i&&!!i.timestamp&&!!i.entries}n.isStateSnapshot=t;async function r(o,i){let a=Pe.create("Render Screenshot",async s=>{if(!o.helpers.viewportScreenshot)return;let l=await o.helpers.viewportScreenshot.getPreview(s,512);if(!l)return;let u=await Z_(l.canvas,"png"),c=new File([u],i),m={kind:"file",id:en.create22(),name:i};return o.managers.asset.set(m,c),m});return o.runTask(a)}n.getCanvasImageAsset=r})(pp||={});function Xo(){let e=(t,r)=>t.commands.dispatch(e,r||{});return e.subscribe=(t,r)=>t.commands.subscribe(e,r),e.id=en.create22(),e}var uL=class{constructor(){this.subs=new Map;this.disposing=!1}subscribe(t,r){let n=this.subs.get(t.id);return n||(n=[],this.subs.set(t.id,n)),n.push(r),{unsubscribe:()=>{let o=this.subs.get(t.id);if(!o)return;let i=o.indexOf(r);if(!(i<0)){for(let a=i+1;a<o.length;a++)o[a-1]=o[a];o.pop()}}}}dispatch(t,r){return new Promise((n,o)=>{if(this.disposing){o("disposed");return}if(!this.subs.get(t.id)){n();return}this.resolve({cmd:t,params:r,resolve:n,reject:o})})}dispose(){this.subs.clear()}async resolve(t){let r=this.subs.get(t.cmd.id);if(!r){t.resolve();return}try{for(let n of r)await n(t.params);t.resolve()}catch(n){t.reject(n)}}};var st={State:{SetCurrentObject:Xo(),ApplyAction:Xo(),Update:Xo(),RemoveObject:Xo(),ToggleExpanded:Xo(),ToggleVisibility:Xo(),Snapshots:{Add:Xo(),Replace:Xo(),Move:Xo(),Remove:Xo(),Apply:Xo(),Clear:Xo(),Upload:Xo(),Fetch:Xo(),DownloadToFile:Xo(),OpenFile:Xo(),OpenUrl:Xo()}},Interactivity:{Object:{Highlight:Xo()},Structure:{Highlight:Xo(),Select:Xo()},ClearHighlights:Xo()},Layout:{Update:Xo()},Toast:{Show:Xo(),Hide:Xo()},Camera:{Reset:Xo(),SetSnapshot:Xo(),Focus:Xo(),FocusObject:Xo(),OrientAxes:Xo(),ResetAxes:Xo()},Canvas3D:{SetSettings:Xo(),ResetSettings:Xo()}};function co(){return co.zero()}(s=>{function e(){return{x:0,y:0,width:0,height:0}}s.zero=e;function t(l,u,c,m){return{x:l,y:u,width:c,height:m}}s.create=t;function r(l){return{...l}}s.clone=r;function n(l,u){return Object.assign(l,u)}s.copy=n;function o(l,u,c,m,d){return l.x=u,l.y=c,l.width=m,l.height=d,l}s.set=o;function i(l,u){return l[0]=u.x,l[1]=u.y,l[2]=u.width,l[3]=u.height,l}s.toVec4=i;function a(l,u){return l.x===u.x&&l.y===u.y&&l.width===u.width&&l.height===u.height}s.equals=a})(co||={});var Wh=Ut();function aSe(e,t,r,n){let{x:o,y:i,width:a,height:s}=r;Ut.set(Wh,t[0],t[1],t[2],1),Ut.transformMat4(Wh,Wh,n);let l=Wh[3];return l!==0&&(Wh[0]/=l,Wh[1]/=l,Wh[2]/=l),e[0]=(Wh[0]+1)*a*.5+o,e[1]=(Wh[1]+1)*s*.5+i,e[2]=(Wh[2]+1)*.5,e[3]=l===0?0:1/l,e}function Hx(e,t,r,n){let{x:o,y:i,width:a,height:s}=r,l=t[0]-o,u=t[1]-i,c=t[2];return e[0]=2*l/a-1,e[1]=2*u/s-1,e[2]=2*c-1,b.transformMat4(e,e,n)}function gS(e){if(typeof e=="object"){if("buttons"in e)return e.buttons;if("which"in e){let t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}}return 0}function eA(e){if(typeof e=="object"&&"button"in e){let t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}return 0}function cL(e){return{alt:"altKey"in e?e.altKey:!1,shift:"shiftKey"in e?e.shiftKey:!1,control:"ctrlKey"in e?e.ctrlKey:!1,meta:"metaKey"in e?e.metaKey:!1}}var sSe={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,preventGestures:!1,mask:(e,t)=>!0,pixelScale:1},Ql;(i=>{i.None=o();function t(a,s){return a.shift===s.shift&&a.alt===s.alt&&a.control===s.control&&a.meta===s.meta}i.areEqual=t;function r(a){return t(a,i.None)}i.areNone=r;function n(a){if(!a)return 0;let s=0;return a.shift&&s++,a.alt&&s++,a.control&&s++,a.meta&&s++,s}i.size=n;function o(a={}){return{shift:!!a.shift,alt:!!a.alt,control:!!a.control,meta:!!a.meta}}i.create=o})(Ql||={});var yu;(n=>{n.has=na.has,n.create=na.create;let r;(c=>(c[c.None=0]="None",c[c.Primary=1]="Primary",c[c.Secondary=2]="Secondary",c[c.Auxilary=4]="Auxilary",c[c.Forth=8]="Forth",c[c.Five=16]="Five"))(r=n.Flag||={})})(yu||={});var l8={key:"",code:"",modifiers:Ql.None,x:-1,y:-1,pageX:-1,pageY:-1,preventDefault:iu};function lSe(){return{drag:new En,interactionEnd:new En,click:new En,move:new En,wheel:new En,pinch:new En,gesture:new En,resize:new En,leave:new En,enter:new En,modifiers:new En,key:new En,keyUp:new En,keyDown:new En,lock:new En}}var Yet=["Backspace","Delete"],u8;(r=>{function e(n={}){let{noScroll:o,noContextMenu:i}={...sSe,...n};return{noScroll:o,noContextMenu:i,pointerLock:!1,width:0,height:0,pixelRatio:1,...lSe(),setPixelScale:iu,requestPointerLock:iu,exitPointerLock:iu,dispose:iu}}r.create=e;function t(n,o={}){let{noScroll:i,noMiddleClickScroll:a,noContextMenu:s,noPinchZoom:l,noTextSelect:u,mask:c,pixelScale:m,preventGestures:d}={...sSe,...o},p=n.clientWidth*T(),h=n.clientHeight*T(),f=!1,y=co(),g=Ie(),x=Ie(),S=Ie(),I=Ie(),v=Ie(),A={shift:!1,alt:!1,control:!1,meta:!1},_={x:-1,y:-1,pageX:-1,pageY:-1};function T(){return window.devicePixelRatio*m}function w(){return{...A}}function D(fe){return fe.target===document.body||fe.target===n}let M=0,E=!1,R=yu.create(0),k=0,B=!1,L=!1,V;typeof window.ResizeObserver<"u"&&(V=new window.ResizeObserver(Ue));let U=lSe(),{drag:Q,interactionEnd:O,wheel:q,pinch:X,gesture:F,click:Y,move:$,leave:ce,enter:ie,resize:oe,modifiers:W,key:N,keyUp:j,keyDown:ue,lock:be}=U;ee();function ee(){n.addEventListener("contextmenu",J,!1),n.addEventListener("wheel",lt,!1),n.addEventListener("mousedown",hi,!1),window.addEventListener("mousemove",nl,!1),window.addEventListener("mouseup",fo,!1),n.addEventListener("touchstart",xn,!1),n.addEventListener("touchmove",zn,!1),n.addEventListener("touchend",In,!1),n.addEventListener("gesturechange",ke,!1),n.addEventListener("gesturestart",Mt,!1),n.addEventListener("gestureend",nt,!1),window.addEventListener("blur",ae),window.addEventListener("keyup",ve,!1),window.addEventListener("keydown",ge,!1),window.addEventListener("keypress",Oe,!1),document.addEventListener("pointerlockchange",Ae,!1),document.addEventListener("pointerlockerror",Ce,!1),V!=null?V.observe(n.parentElement):window.addEventListener("resize",Ue,!1)}function le(){E||(E=!0,n.removeEventListener("contextmenu",J,!1),n.removeEventListener("wheel",lt,!1),n.removeEventListener("mousedown",hi,!1),window.removeEventListener("mousemove",nl,!1),window.removeEventListener("mouseup",fo,!1),n.removeEventListener("touchstart",xn,!1),n.removeEventListener("touchmove",zn,!1),n.removeEventListener("touchend",In,!1),n.removeEventListener("gesturechange",ke,!1),n.removeEventListener("gesturestart",Mt,!1),n.removeEventListener("gestureend",nt,!1),window.removeEventListener("blur",ae),window.removeEventListener("keyup",ve,!1),window.removeEventListener("keydown",ge,!1),window.removeEventListener("keypress",Oe,!1),document.removeEventListener("pointerlockchange",Ae,!1),document.removeEventListener("pointerlockerror",Ce,!1),_e.remove(),V!=null?(V.unobserve(n.parentElement),V.disconnect()):window.removeEventListener("resize",Ue,!1))}function Ae(){n.ownerDocument.pointerLockElement===n?f=!0:f=!1,Me(f),be.next(f)}function Ce(){console.error("Unable to use Pointer Lock API"),f=!1,Me(f),be.next(f)}function J(fe){c(fe.clientX,fe.clientY)&&s&&fe.preventDefault()}function z(fe){A.alt=fe.altKey,A.shift=fe.shiftKey,A.control=fe.ctrlKey,A.meta=fe.metaKey}function ae(){(R||A.shift||A.alt||A.meta||A.control)&&(R=0,A.shift=A.alt=A.control=A.meta=!1)}function ge(fe){let Le=!1;!A.alt&&fe.altKey&&(Le=!0,A.alt=!0),!A.shift&&fe.shiftKey&&(Le=!0,A.shift=!0),!A.control&&fe.ctrlKey&&(Le=!0,A.control=!0),!A.meta&&fe.metaKey&&(Le=!0,A.meta=!0),Le&&B&&W.next(w()),D(fe)&&B&&ue.next({key:fe.key,code:fe.code,modifiers:w(),..._,preventDefault:()=>fe.preventDefault()})}function ve(fe){let Le=!1;A.alt&&!fe.altKey&&(Le=!0,A.alt=!1),A.shift&&!fe.shiftKey&&(Le=!0,A.shift=!1),A.control&&!fe.ctrlKey&&(Le=!0,A.control=!1),A.meta&&!fe.metaKey&&(Le=!0,A.meta=!1),Le&&B&&W.next(w()),Yet.includes(fe.key)&&Oe(fe),D(fe)&&B&&j.next({key:fe.key,code:fe.code,modifiers:w(),..._,preventDefault:()=>fe.preventDefault()})}function Oe(fe){!D(fe)||!B||N.next({key:fe.key,code:fe.code,modifiers:w(),..._,preventDefault:()=>fe.preventDefault()})}function ze(fe){let Le=fe.touches[0],vt=fe.touches[1];return{clientX:(Le.clientX+vt.clientX)/2,clientY:(Le.clientY+vt.clientY)/2,pageX:(Le.pageX+vt.pageX)/2,pageY:(Le.pageY+vt.pageY)/2,target:fe.target}}function Re(fe){let Le=fe.touches[0].pageX-fe.touches[1].pageX,vt=fe.touches[0].pageY-fe.touches[1].pageY;return Math.sqrt(Le*Le+vt*vt)}let Ke=-1,tt,bt=Ie(),Pt=Ie();function fr(fe){Ke<0||(Ie.set(Pt,fe.touches[0].pageX,fe.touches[0].pageY),Ke+=Ie.distance(bt,Pt),Ie.copy(bt,Pt))}let gt=Ie(),Sr=!1,zr=0,Nn=1;function xn(fe){if(fe.preventDefault(),tt=void 0,Ke=-1,fe.touches.length===1)R=k=1,Ke=0,Ie.set(bt,fe.touches[0].pageX,fe.touches[0].pageY),tt=fe.touches[0],te(fe.touches[0]),Ie.copy(gt,x),Sr=!0;else if(fe.touches.length===2){R=6,k=2,z(fe),Nn=1,zr=Re(fe);let{pageX:Le,pageY:vt}=qt(ze(fe));Sr||(kt(gt,ze(fe)),Sr=!0),X.next({isStart:!0,distance:zr,delta:0,fraction:Nn,fractionDelta:0,startX:gt[0],startY:gt[1],centerPageX:Le,centerPageY:vt,buttons:R,button:k,modifiers:w()})}else fe.touches.length===3&&(R=k=8,te(ze(fe)))}function In(fe){if(G(),tt&&Ke<=4){let Le=tt;if(!c(Le.clientX,Le.clientY))return;kt(Pt,Le);let{pageX:vt,pageY:zt}=qt(Le),[jt,mr]=Pt;Y.next({x:jt,y:mr,pageX:vt,pageY:zt,buttons:R,button:k,modifiers:w()})}tt=void 0,Sr=!1}function zn(fe){if(k=0,l&&(fe.preventDefault(),fe.stopPropagation(),fe.originalEvent&&(fe.originalEvent.preventDefault(),fe.originalEvent.stopPropagation())),tt=void 0,fe.touches.length===1)R=1,tt=fe.touches[0],fr(fe),Ze(fe.touches[0]);else if(fe.touches.length===2){R=6,k=2,z(fe);let{pageX:Le,pageY:vt}=qt(ze(fe)),zt=Re(fe),jt=zr-zt,mr=zr/zt,Io=mr-Nn;Nn=mr,X.next({isStart:!1,distance:zt,delta:jt,fraction:mr,fractionDelta:Io,startX:gt[0],startY:gt[1],centerPageX:Le,centerPageY:vt,buttons:R,button:k,modifiers:w()})}else fe.touches.length===3&&(R=8,Ze(ze(fe)))}function hi(fe){z(fe),R=gS(fe),k=eA(fe),a&&R===4&&fe.preventDefault,te(fe)}function nl(fe){z(fe),R=gS(fe),k=0,Ze(fe)}function fo(fe){z(fe),R=gS(fe),k=eA(fe),Ge(fe),G()}function G(){O.next(void 0)}function te(fe){c(fe.clientX,fe.clientY)&&(kt(x,fe),Ie.copy(g,x),ot(x)&&(M=1))}function Ge(fe){if(M=0,!!c(fe.clientX,fe.clientY)){if(kt(S,fe),!L&&Ie.distance(S,g)<4){let{pageX:Le,pageY:vt}=qt(fe),[zt,jt]=S;Y.next({x:zt,y:jt,pageX:Le,pageY:vt,buttons:R,button:k,modifiers:w()})}L=!1}}function Ze(fe){kt(S,fe);let{pageX:Le,pageY:vt}=qt(fe),[zt,jt]=S,{movementX:mr,movementY:Io}=fe,ni=ot(S)&&c(fe.clientX,fe.clientY);if(B&&!ni?ce.next(void 0):!B&&ni&&ie.next(void 0),B=ni,_.x=zt,_.y=jt,_.pageX=Le,_.pageY=vt,$.next({x:zt,y:jt,pageX:Le,pageY:vt,movementX:mr,movementY:Io,buttons:R,button:k,modifiers:w(),inside:ni,onElement:fe.target===n}),M===0||(u&&fe.preventDefault?.(),Ie.div(I,Ie.sub(I,S,x),Tt(v)),Ie.magnitude(I)<1e-6))return;let ua=M===1;if(ua&&!c(fe.clientX,fe.clientY))return;Ie.distance(S,g)>=4&&(L=!0);let[Go,vg]=I;Q.next({x:zt,y:jt,dx:Go,dy:vg,pageX:Le,pageY:vt,buttons:R,button:k,modifiers:w(),isStart:ua}),Ie.copy(x,S),M=2}function lt(fe){if(!c(fe.clientX,fe.clientY))return;kt(S,fe);let{pageX:Le,pageY:vt}=qt(fe),[zt,jt]=S;i&&fe.preventDefault();let mr=c8(fe);R=k=4,(mr.dx||mr.dy||mr.dz)&&q.next({x:zt,y:jt,pageX:Le,pageY:vt,...mr,buttons:R,button:k,modifiers:w()})}function xt(fe){d&&(fe.preventDefault(),fe.stopImmediatePropagation?.(),fe.stopPropagation?.())}let At=0,Dt=0;function Mt(fe){xt(fe),At=fe.scale,Dt=fe.rotation,F.next({scale:fe.scale,rotation:fe.rotation,deltaRotation:0,deltaScale:0,isStart:!0})}function wt(fe,Le){F.next({scale:fe.scale,rotation:fe.rotation,deltaRotation:Dt-fe.rotation,deltaScale:At-fe.scale,isEnd:Le}),Dt=fe.rotation,At=fe.scale}function ke(fe){xt(fe),wt(fe)}function nt(fe){xt(fe),wt(fe,!0)}function Ue(){p=n.clientWidth*T(),h=n.clientHeight*T(),oe.next({})}function ot(fe){if(n instanceof Window||n instanceof Document||n===document.body)return!0;{let Le=n.getBoundingClientRect();return fe[0]>=0&&fe[1]>=0&&fe[0]<Le.width&&fe[1]<Le.height}}function Tt(fe){return fe[0]=n.clientWidth,fe[1]=n.clientHeight,fe}function kt(fe,Le){if(p=n.clientWidth*T(),h=n.clientHeight*T(),f){let vt=T();fe[0]=(y.x+y.width/2)/vt,fe[1]=(h-(y.y+y.height/2))/vt}else{let vt=n.getBoundingClientRect();fe[0]=(Le.clientX||0)-vt.left,fe[1]=(Le.clientY||0)-vt.top}return fe}function qt(fe){return f?{pageX:Math.round(window.innerWidth/2)+y.x,pageY:Math.round(window.innerHeight/2)+y.y}:{pageX:fe.pageX,pageY:fe.pageY}}let pe=30,_e=de();function de(){let fe=document.createElement("div"),Le="30%",vt="10%",zt=`#000 ${Le}, #0000 0 calc(100% - ${Le}), #000 0`,jt=`linear-gradient(0deg, ${zt}) 50%/${vt} 100% no-repeat`,mr=`linear-gradient(90deg, ${zt}) 50%/100% ${vt} no-repeat`;return Object.assign(fe.style,{width:`${pe}px`,aspectRatio:1,background:`${jt}, ${mr}, radial-gradient(circle at 50%, #000 5%, #0000 5%)`,display:"none",zIndex:1e3,position:"absolute",mixBlendMode:"difference",filter:"invert(1)"}),n.parentElement?.appendChild(fe),fe}function Me(fe){if(_e.style.display=fe?"block":"none",fe){let Le=T(),vt=(y.x+y.width/2)/Le,zt=(y.y+y.height/2)/Le;_e.style.width=`${pe}px`,_e.style.left=`calc(${vt}px - ${pe/2}px)`,_e.style.bottom=`calc(${zt}px - ${pe/2}px)`}}return{get noScroll(){return i},set noScroll(fe){i=fe},get noContextMenu(){return s},set noContextMenu(fe){s=fe},get width(){return p},get height(){return h},get pixelRatio(){return T()},get pointerLock(){return f},...U,setPixelScale:fe=>{m=fe,p=n.clientWidth*T(),h=n.clientHeight*T()},requestPointerLock:fe=>{y=fe,f||n.requestPointerLock()},exitPointerLock:()=>{f&&n.ownerDocument.exitPointerLock()},dispose:le}}r.fromElement=t})(u8||={});function c8(e){let o=0,i=0,a=0,s=0,l=0;return"detail"in e&&(i=e.detail),"wheelDelta"in e&&(i=-e.wheelDelta/120),"wheelDeltaY"in e&&(i=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(o=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(o=i,i=0),a=o*10,s=i*10,"deltaY"in e&&(s=e.deltaY),"deltaX"in e&&(a=e.deltaX),"deltaZ"in e&&(l=e.deltaZ),(a||s||l)&&e.deltaMode&&(e.deltaMode===1?(a*=40,s*=40,l*=40):(a*=800,s*=800,l*=800)),a&&!o&&(o=a<1?-1:1),s&&!i&&(i=s<1?-1:1),{spinX:o,spinY:i,dx:a,dy:s,dz:l}}var rA={backgroundColor:C.Color(0,{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:C.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:C.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:C.Boolean(!0,{label:"Use Interior Color"}),interiorColor:C.Color(Fe.fromNormalizedRgb(.3,.3,.3)),colorMarker:C.Boolean(!0,{description:"Enable color marker"}),highlightColor:C.Color(Fe.fromNormalizedRgb(1,.4,.6)),selectColor:C.Color(Fe.fromNormalizedRgb(.2,1,.1)),dimColor:C.Color(Fe.fromNormalizedRgb(1,1,1)),highlightStrength:C.Numeric(.3,{min:0,max:1,step:.1}),selectStrength:C.Numeric(.3,{min:0,max:1,step:.1}),dimStrength:C.Numeric(0,{min:0,max:1,step:.1}),markerPriority:C.Select(1,[[1,"Highlight"],[2,"Select"]]),xrayEdgeFalloff:C.Numeric(1,{min:0,max:3,step:.1}),celSteps:C.Numeric(5,{min:2,max:16,step:1}),exposure:C.Numeric(1,{min:0,max:3,step:.01}),light:C.ObjectList({inclination:C.Numeric(150,{min:0,max:180,step:1}),azimuth:C.Numeric(320,{min:0,max:360,step:1}),color:C.Color(Fe.fromNormalizedRgb(1,1,1)),intensity:C.Numeric(.6,{min:0,max:5,step:.01})},e=>Fe.toHexString(e.color),{defaultValue:[{inclination:150,azimuth:320,color:Fe.fromNormalizedRgb(1,1,1),intensity:.6}]}),ambientColor:C.Color(Fe.fromNormalizedRgb(1,1,1)),ambientIntensity:C.Numeric(.4,{min:0,max:2,step:.01})},tA=b(),m8=b();function uSe(e,t){let r=e.length,{direction:n,color:o}=t||{direction:new Array(r*3).fill(0),color:new Array(r*3).fill(0)};for(let i=0;i<r;++i){let a=e[i];b.directionFromSpherical(tA,vr(a.inclination),vr(a.azimuth),1),b.toArray(tA,n,i*3),b.scale(m8,Fe.toVec3Normalized(m8,a.color),a.intensity),b.toArray(m8,o,i*3)}return{count:r,direction:n,color:o}}function Ket(e,t){let r=new Array(e.count*3);for(let n=0,o=e.count;n<o;++n)b.fromArray(tA,e.direction,n*3),b.transformDirection(tA,tA,t),b.toArray(tA,r,n*3);return r}var d8;(n=>{let e;(s=>(s[s.None=0]="None",s[s.BlendedFront=1]="BlendedFront",s[s.BlendedBack=2]="BlendedBack"))(e||={});let t;(s=>(s[s.All=0]="All",s[s.Opaque=1]="Opaque",s[s.Transparent=2]="Transparent"))(t||={});function r(o,i={}){let{gl:a,state:s,stats:l}=o,u=C.merge(rA,C.getDefaultValues(rA),i),c=uSe(u.light),m=co(),d=Ie.create(a.drawingBufferWidth,a.drawingBufferHeight),p=Fe.toVec3Normalized(b(),u.backgroundColor),h=!1,f=null,y=o.resources.texture("image-uint8","rgba","ubyte","nearest");y.define(1,1),y.load({array:new Uint8Array([255,255,255,255]),width:1,height:1});let g=[["tDepth",y]],x=Z(),S=Z(),I=Z(),v=Z(),A=Z(),_=Z(),T=Z(),w=Z(),D=b(),M=b(),E=jo(),R=Ie(),k=Bh(),B=b();b.scale(B,Fe.toArrayNormalized(u.ambientColor,B,0),u.ambientIntensity);let L={uDrawId:P.create(0),uModel:P.create(Z.identity()),uView:P.create(x),uInvView:P.create(S),uModelView:P.create(I),uInvModelView:P.create(v),uInvProjection:P.create(A),uProjection:P.create(Z()),uModelViewProjection:P.create(_),uInvModelViewProjection:P.create(T),uHasHeadRotation:P.create(!1),uInvHeadRotation:P.create(w),uIsOrtho:P.create(1),uViewOffset:P.create(R),uPixelRatio:P.create(o.pixelRatio),uViewport:P.create(co.toVec4(Ut(),m)),uDrawingBufferSize:P.create(d),uCameraPosition:P.create(M),uCameraDir:P.create(D),uCameraPlane:P.create(jo.toArray(E,Ut(),0)),uNear:P.create(1),uFar:P.create(1e4),uFog:P.create(!0),uFogNear:P.create(1),uFogFar:P.create(1e4),uFogColor:P.create(p),uRenderMask:P.create(0),uMarkingDepthTest:P.create(!1),uPickType:P.create(0),uMarkingType:P.create(0),uTransparentBackground:P.create(!1),uLightDirection:P.create(c.direction),uLightColor:P.create(c.color),uAmbientColor:P.create(B),uPickingAlphaThreshold:P.create(u.pickingAlphaThreshold),uInteriorDarkening:P.create(u.interiorDarkening),uInteriorColorFlag:P.create(u.interiorColorFlag),uInteriorColor:P.create(Fe.toVec3Normalized(b(),u.interiorColor)),uHighlightColor:P.create(Fe.toVec3Normalized(b(),u.highlightColor)),uSelectColor:P.create(Fe.toVec3Normalized(b(),u.selectColor)),uDimColor:P.create(Fe.toVec3Normalized(b(),u.dimColor)),uHighlightStrength:P.create(u.highlightStrength),uSelectStrength:P.create(u.selectStrength),uDimStrength:P.create(u.dimStrength),uMarkerPriority:P.create(u.markerPriority),uMarkerAverage:P.create(0),uXrayEdgeFalloff:P.create(u.xrayEdgeFalloff),uCelSteps:P.create(u.celSteps),uExposure:P.create(u.exposure)},V=Object.entries(L),U=!0,Q=(z,ae,ge)=>{if(z.state.disposed||!z.state.visible||!z.state.pickable&&ae==="pick"||!z.values.drawCount.ref.value||!Bh.intersectsSphere3D(k,z.values.boundingSphere.ref.value))return;let[ve,Oe]=z.values.uLod.ref.value;if(ve!==0||Oe!==0){let{center:bt,radius:Pt}=z.values.boundingSphere.ref.value,fr=jo.distanceToPoint(E,bt);if(fr+Pt<ve||fr-Pt>Oe)return}if(f!==null&&f(z.values.boundingSphere.ref.value))return;let ze=z.values.instanceGrid.ref.value.cellSize>0,Re=z.values.uInstanceCount.ref.value>1;ze&&(Re||z.values.lodLevels)?z.cull(E,k,f,o.stats):z.uncull();let Ke=!1;z.values.dLightCount.ref.value!==c.count&&(P.update(z.values.dLightCount,c.count),Ke=!0),z.values.dColorMarker.ref.value!==u.colorMarker&&(P.update(z.values.dColorMarker,u.colorMarker),Ke=!0),Ke&&z.update();let tt=z.getProgram(ae);if(s.currentProgramId!==tt.id&&(U=!0,tt.use()),U&&(tt.setUniforms(V),tt.bindTextures(g,0),U=!1),z.values.dGeometryType.ref.value==="directVolume"){if(ae!=="color")return;s.disable(a.CULL_FACE),s.frontFace(a.CCW)}else ge===1?(s.enable(a.CULL_FACE),z.values.dFlipSided?.ref.value?(s.frontFace(a.CW),s.cullFace(a.FRONT)):(s.frontFace(a.CCW),s.cullFace(a.BACK))):ge===2?(s.enable(a.CULL_FACE),z.values.dFlipSided?.ref.value?(s.frontFace(a.CW),s.cullFace(a.BACK)):(s.frontFace(a.CCW),s.cullFace(a.FRONT))):(z.values.uDoubleSided?z.values.uDoubleSided.ref.value||z.values.hasReflection.ref.value?s.disable(a.CULL_FACE):s.enable(a.CULL_FACE):s.disable(a.CULL_FACE),z.values.dFlipSided?.ref.value?(s.frontFace(a.CW),s.cullFace(a.FRONT)):(s.frontFace(a.CCW),s.cullFace(a.BACK)));z.render(ae,g.length)},O=(z,ae)=>{P.update(L.uView,z.view),P.update(L.uInvView,Z.invert(S,z.view)),P.update(L.uProjection,z.projection),P.update(L.uInvProjection,Z.invert(A,z.projection)),P.updateIfChanged(L.uIsOrtho,z.state.mode==="orthographic"?1:0),P.update(L.uViewOffset,z.viewOffset.enabled?Ie.set(R,z.viewOffset.offsetX*16,z.viewOffset.offsetY*16):Ie.set(R,0,0)),P.update(L.uCameraPosition,b.copy(M,z.state.position)),P.update(L.uCameraDir,b.normalize(D,b.sub(D,z.state.target,z.state.position))),P.updateIfChanged(L.uFar,z.far),P.updateIfChanged(L.uNear,z.near),P.updateIfChanged(L.uFog,z.state.fog>0),P.updateIfChanged(L.uFogFar,z.fogFar),P.updateIfChanged(L.uFogNear,z.fogNear),P.updateIfChanged(L.uTransparentBackground,h),Bh.fromProjectionMatrix(k,z.projectionView),jo.copy(E,k[Bh.PlaneIndex.Near]),E.constant-=jo.distanceToPoint(E,M),P.update(L.uCameraPlane,jo.toArray(E,L.uCameraPlane.ref.value,0)),P.updateIfChanged(L.uMarkerAverage,ae.markerAverage);let ge=!Z.isZero(z.headRotation);ge?(P.updateIfChanged(L.uHasHeadRotation,ge),P.update(L.uInvHeadRotation,Z.invert(w,z.headRotation)),P.update(L.uLightDirection,Ket(c,w))):(P.update(L.uHasHeadRotation,!1),P.update(L.uInvHeadRotation,Z.id),P.update(L.uLightDirection,c.direction))},q=(z,ae,ge,ve,Oe)=>{UT(g,"tDepth",ge||y),P.update(L.uModel,z.view),P.update(L.uModelView,Z.mul(I,ae.view,z.view)),P.update(L.uInvModelView,Z.invert(v,I)),P.update(L.uModelViewProjection,Z.mul(_,I,ae.projection)),P.update(L.uInvModelViewProjection,Z.invert(T,_)),P.updateIfChanged(L.uRenderMask,ve),P.updateIfChanged(L.uMarkingDepthTest,Oe),s.enable(a.SCISSOR_TEST),s.colorMask(!0,!0,!0,!0);let{x:ze,y:Re,width:Ke,height:tt}=m;s.viewport(ze,Re,Ke,tt),s.scissor(ze,Re,Ke,tt),U=!0,s.currentRenderItemId=-1},X=function(z){let ae=Br(z.values.alpha.ref.value*z.state.alphaFactor,0,1),ge=z.values.dXrayShaded?.ref.value==="on"||z.values.dXrayShaded?.ref.value==="inverted";return ae===1&&z.values.transparencyAverage.ref.value!==1&&z.values.dGeometryType.ref.value!=="directVolume"&&z.values.dPointStyle?.ref.value!=="fuzzy"&&!ge||z.values.dTransparentBackfaces?.ref.value==="opaque"},F=function(z){let ae=Br(z.values.alpha.ref.value*z.state.alphaFactor,0,1),ge=z.values.dXrayShaded?.ref.value==="on"||z.values.dXrayShaded?.ref.value==="inverted";return ae<1&&ae!==0||z.values.transparencyAverage.ref.value>0||z.values.dGeometryType.ref.value==="directVolume"||z.values.dPointStyle?.ref.value==="fuzzy"||z.values.dGeometryType.ref.value==="text"||z.values.dGeometryType.ref.value==="image"||ge},Y=(z,ae,ge,ve)=>{He&&o.timer.mark("Renderer.renderPick"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),q(z,ae,null,0,!1),P.updateIfChanged(L.uPickType,ve);let{renderables:Oe}=z;for(let ze=0,Re=Oe.length;ze<Re;++ze)Oe[ze].state.colorOnly||Q(Oe[ze],ge,0);He&&o.timer.markEnd("Renderer.renderPick")},$=(z,ae)=>{He&&o.timer.mark("Renderer.renderDepth"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),q(z,ae,null,0,!1);let{renderables:ge}=z;for(let ve=0,Oe=ge.length;ve<Oe;++ve)Q(ge[ve],"depth",0);He&&o.timer.markEnd("Renderer.renderDepth")},ce=(z,ae)=>{He&&o.timer.mark("Renderer.renderDepthOpaque"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),q(z,ae,null,1,!1);let{renderables:ge}=z;for(let ve=0,Oe=ge.length;ve<Oe;++ve){let ze=ge[ve];X(ze)&&Q(ze,"depth",0)}He&&o.timer.markEnd("Renderer.renderDepthOpaque")},ie=(z,ae)=>{He&&o.timer.mark("Renderer.renderDepthOpaqueBack"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),s.depthFunc(a.GREATER),q(z,ae,null,1,!1);let{renderables:ge}=z;for(let ve=0,Oe=ge.length;ve<Oe;++ve){let ze=ge[ve];X(ze)&&Q(ze,"depth",2)}s.depthFunc(a.LESS),He&&o.timer.markEnd("Renderer.renderDepthOpaqueBack")},oe=(z,ae,ge)=>{He&&o.timer.mark("Renderer.renderDepthTransparent"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),q(z,ae,ge,2,!1);let{renderables:ve}=z;for(let Oe=0,ze=ve.length;Oe<ze;++Oe){let Re=ve[Oe];F(Re)&&Q(Re,"depth",0)}He&&o.timer.markEnd("Renderer.renderDepthTransparent")},W=(z,ae)=>{He&&o.timer.mark("Renderer.renderMarkingDepth"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),q(z,ae,null,0,!1),P.updateIfChanged(L.uMarkingType,1);let{renderables:ge}=z;for(let ve=0,Oe=ge.length;ve<Oe;++ve){let ze=ge[ve];Br(ze.values.alpha.ref.value*ze.state.alphaFactor,0,1)!==0&&ze.values.transparencyAverage.ref.value!==1&&ze.values.markerAverage.ref.value!==1&&Q(ge[ve],"marking",0)}He&&o.timer.markEnd("Renderer.renderMarkingDepth")},N=(z,ae,ge)=>{He&&o.timer.mark("Renderer.renderMarkingMask"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),q(z,ae,ge,0,!!ge),P.updateIfChanged(L.uMarkingType,2);let{renderables:ve}=z;for(let Oe=0,ze=ve.length;Oe<ze;++Oe)ve[Oe].values.markerAverage.ref.value>0&&Q(ve[Oe],"marking",0);He&&o.timer.markEnd("Renderer.renderMarkingMask")},j=(z,ae)=>{He&&o.timer.mark("Renderer.renderEmissive"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),q(z,ae,null,1,!1);let{renderables:ge}=z;for(let ve=0,Oe=ge.length;ve<Oe;++ve){let ze=ge[ve];X(ze)&&Q(ze,"emissive",0)}He&&o.timer.markEnd("Renderer.renderEmissive")},ue=(z,ae)=>{He&&o.timer.mark("Renderer.renderTracing"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),q(z,ae,null,1,!1);let{renderables:ge}=z;for(let ve=0,Oe=ge.length;ve<Oe;++ve){let ze=ge[ve];X(ze)&&Q(ze,"tracing",0)}He&&o.timer.markEnd("Renderer.renderTracing")},be=(z,ae)=>{z.hasOpaque&&ee(z,ae),z.opacityAverage<1&&le(z,ae)},ee=(z,ae)=>{He&&o.timer.mark("Renderer.renderOpaque"),s.disable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!0),q(z,ae,null,1,!1);let{renderables:ge}=z;for(let ve=0,Oe=ge.length;ve<Oe;++ve){let ze=ge[ve];X(ze)&&Q(ze,"color",0)}He&&o.timer.markEnd("Renderer.renderOpaque")},le=(z,ae)=>{He&&o.timer.mark("Renderer.renderBlendedTransparent"),h?s.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA):s.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),s.enable(a.BLEND),s.enable(a.DEPTH_TEST),s.depthMask(!1),q(z,ae,null,2,!1);let{renderables:ge}=z;for(let ve=0,Oe=ge.length;ve<Oe;++ve){let ze=ge[ve];F(ze)&&(ze.values.uDoubleSided?.ref.value?(ze.values.dTransparentBackfaces?.ref.value!=="opaque"&&Q(ze,"color",2),Q(ze,"color",1)):Q(ze,"color",0))}He&&o.timer.markEnd("Renderer.renderBlendedTransparent")};return{clear:(z,ae,ge)=>{s.enable(a.SCISSOR_TEST),s.enable(a.DEPTH_TEST),s.colorMask(!0,!0,!0,!0),s.depthMask(!0),ge||h&&!ae?s.clearColor(0,0,0,0):z?s.clearColor(p[0],p[1],p[2],1):s.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},clearDepth:(z=!1)=>{s.enable(a.SCISSOR_TEST),s.enable(a.DEPTH_TEST),s.depthMask(!0),z?(s.colorMask(!0,!0,!0,!0),s.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)):a.clear(a.DEPTH_BUFFER_BIT)},update:O,renderPick:Y,renderDepth:$,renderDepthOpaque:ce,renderDepthOpaqueBack:ie,renderDepthTransparent:oe,renderMarkingDepth:W,renderMarkingMask:N,renderEmissive:j,renderTracing:ue,renderBlended:be,renderOpaque:ee,renderBlendedTransparent:le,renderVolume:(z,ae,ge)=>{He&&o.timer.mark("Renderer.renderVolume"),s.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),s.enable(a.BLEND),s.disable(a.DEPTH_TEST),s.depthMask(!1),q(z,ae,ge,2,!1);let{renderables:ve}=z;for(let Oe=0,ze=ve.length;Oe<ze;++Oe){let Re=ve[Oe];Re.values.dGeometryType.ref.value==="directVolume"&&Q(Re,"color",0)}He&&o.timer.markEnd("Renderer.renderVolume")},renderWboitTransparent:(z,ae,ge)=>{He&&o.timer.mark("Renderer.renderWboitTransparent"),q(z,ae,ge,2,!1);let{renderables:ve}=z;for(let Oe=0,ze=ve.length;Oe<ze;++Oe){let Re=ve[Oe];F(Re)&&Q(Re,"color",0)}He&&o.timer.markEnd("Renderer.renderWboitTransparent")},renderDpoitTransparent:(z,ae,ge,ve)=>{He&&o.timer.mark("Renderer.renderDpoitTransparent"),s.enable(a.BLEND),UT(g,"tDpoitDepth",ve.depth),UT(g,"tDpoitFrontColor",ve.frontColor),UT(g,"tDpoitBackColor",ve.backColor),q(z,ae,ge,2,!1);let{renderables:Oe}=z;for(let ze=0,Re=Oe.length;ze<Re;++ze){let Ke=Oe[ze];F(Ke)&&Q(Ke,"color",0)}He&&o.timer.markEnd("Renderer.renderDpoitTransparent")},setProps:z=>{z.backgroundColor!==void 0&&z.backgroundColor!==u.backgroundColor&&(u.backgroundColor=z.backgroundColor,Fe.toVec3Normalized(p,u.backgroundColor),P.update(L.uFogColor,b.copy(L.uFogColor.ref.value,p))),z.pickingAlphaThreshold!==void 0&&z.pickingAlphaThreshold!==u.pickingAlphaThreshold&&(u.pickingAlphaThreshold=z.pickingAlphaThreshold,P.update(L.uPickingAlphaThreshold,u.pickingAlphaThreshold)),z.interiorDarkening!==void 0&&z.interiorDarkening!==u.interiorDarkening&&(u.interiorDarkening=z.interiorDarkening,P.update(L.uInteriorDarkening,u.interiorDarkening)),z.interiorColorFlag!==void 0&&z.interiorColorFlag!==u.interiorColorFlag&&(u.interiorColorFlag=z.interiorColorFlag,P.update(L.uInteriorColorFlag,u.interiorColorFlag)),z.interiorColor!==void 0&&z.interiorColor!==u.interiorColor&&(u.interiorColor=z.interiorColor,P.update(L.uInteriorColor,Fe.toVec3Normalized(L.uInteriorColor.ref.value,u.interiorColor))),z.colorMarker!==void 0&&z.colorMarker!==u.colorMarker&&(u.colorMarker=z.colorMarker),z.highlightColor!==void 0&&z.highlightColor!==u.highlightColor&&(u.highlightColor=z.highlightColor,P.update(L.uHighlightColor,Fe.toVec3Normalized(L.uHighlightColor.ref.value,u.highlightColor))),z.selectColor!==void 0&&z.selectColor!==u.selectColor&&(u.selectColor=z.selectColor,P.update(L.uSelectColor,Fe.toVec3Normalized(L.uSelectColor.ref.value,u.selectColor))),z.dimColor!==void 0&&z.dimColor!==u.dimColor&&(u.dimColor=z.dimColor,P.update(L.uDimColor,Fe.toVec3Normalized(L.uDimColor.ref.value,u.dimColor))),z.highlightStrength!==void 0&&z.highlightStrength!==u.highlightStrength&&(u.highlightStrength=z.highlightStrength,P.update(L.uHighlightStrength,u.highlightStrength)),z.selectStrength!==void 0&&z.selectStrength!==u.selectStrength&&(u.selectStrength=z.selectStrength,P.update(L.uSelectStrength,u.selectStrength)),z.dimStrength!==void 0&&z.dimStrength!==u.dimStrength&&(u.dimStrength=z.dimStrength,P.update(L.uDimStrength,u.dimStrength)),z.markerPriority!==void 0&&z.markerPriority!==u.markerPriority&&(u.markerPriority=z.markerPriority,P.update(L.uMarkerPriority,u.markerPriority)),z.xrayEdgeFalloff!==void 0&&z.xrayEdgeFalloff!==u.xrayEdgeFalloff&&(u.xrayEdgeFalloff=z.xrayEdgeFalloff,P.update(L.uXrayEdgeFalloff,u.xrayEdgeFalloff)),z.celSteps!==void 0&&z.celSteps!==u.celSteps&&(u.celSteps=z.celSteps,P.update(L.uCelSteps,u.celSteps)),z.exposure!==void 0&&z.exposure!==u.exposure&&(u.exposure=z.exposure,P.update(L.uExposure,u.exposure)),z.light!==void 0&&!oa(z.light,u.light)&&(u.light=z.light,Object.assign(c,uSe(z.light,c)),P.update(L.uLightDirection,c.direction),P.update(L.uLightColor,c.color)),z.ambientColor!==void 0&&z.ambientColor!==u.ambientColor&&(u.ambientColor=z.ambientColor,b.scale(B,Fe.toArrayNormalized(u.ambientColor,B,0),u.ambientIntensity),P.update(L.uAmbientColor,B)),z.ambientIntensity!==void 0&&z.ambientIntensity!==u.ambientIntensity&&(u.ambientIntensity=z.ambientIntensity,b.scale(B,Fe.toArrayNormalized(u.ambientColor,B,0),u.ambientIntensity),P.update(L.uAmbientColor,B))},setViewport:(z,ae,ge,ve)=>{s.viewport(z,ae,ge,ve),s.scissor(z,ae,ge,ve),(z!==m.x||ae!==m.y||ge!==m.width||ve!==m.height)&&(co.set(m,z,ae,ge,ve),P.update(L.uViewport,Ut.set(L.uViewport.ref.value,z,ae,ge,ve)))},setTransparentBackground:z=>{h=z},setDrawingBufferSize:(z,ae)=>{(z!==d[0]||ae!==d[1])&&P.update(L.uDrawingBufferSize,Ie.set(d,z,ae))},setPixelRatio:z=>{P.update(L.uPixelRatio,z)},setOcclusionTest:z=>{f=z},props:u,get stats(){return{programCount:o.stats.resourceCounts.program,shaderCount:o.stats.resourceCounts.shader,attributeCount:o.stats.resourceCounts.attribute,elementsCount:o.stats.resourceCounts.elements,framebufferCount:o.stats.resourceCounts.framebuffer,renderbufferCount:o.stats.resourceCounts.renderbuffer,textureCount:o.stats.resourceCounts.texture,vertexArrayCount:o.stats.resourceCounts.vertexArray,drawCount:l.drawCount,instanceCount:l.instanceCount,instancedDrawCount:l.instancedDrawCount}},get light(){return c},get ambientColor(){return L.uAmbientColor.ref.value},dispose:()=>{}}}n.create=r})(d8||={});function _t(e,t="",r=""){return _t.create(e,t,r)}(c=>{function e(m,d="",p=""){return{triggers:m,action:d,description:p}}c.create=e;function t(m){return!!m&&Array.isArray(m.triggers)&&typeof m.action=="string"}c.isBinding=t,c.Empty={triggers:[],action:"",description:""};function n(m){return m.triggers.length===0||m.triggers.every(d=>d.buttons===void 0&&d.modifiers===void 0&&!d.code)}c.isEmpty=n;function o(m,d,p){return m.triggers.some(h=>l.match(h,d,p))}c.match=o;function i(m,d,p,h){return m.triggers.some(f=>l.matchKey(f,d,p,h))}c.matchKey=i;function a(m){return m.triggers.map(l.format).join(" or ")}c.formatTriggers=a;function s(m,d=""){let p=m.description||ta(d);return see(p,{triggers:"<i>"+a(m)+"</i>"})}c.format=s;function l(m,d){return l.create(m,d)}c.Trigger=l;function u(m,d){return l.create(void 0,d,m)}c.TriggerKey=u,(y=>{function m(g,x,S){return{buttons:g,modifiers:x,code:S}}y.create=m,y.Empty={};function p(g,x,S){let{buttons:I,modifiers:v}=g;return I!==void 0&&(I===x||yu.has(I,x))&&(!v||Ql.areEqual(v,S))}y.match=p;function h(g,x,S,I){let{modifiers:v,code:A}=g;return A!==void 0&&(A===x||A.length===1&&x.length===4&&x.startsWith("Key")&&!!I&&I.length===1&&I.toUpperCase()===A.toUpperCase())&&(!v||Ql.areEqual(v,S))}y.matchKey=h;function f(g){let x=[],S=Jet(g.buttons,g.code);S&&x.push(S);let I=ett(g.code);I&&x.push(I);let v=$et(g.modifiers);return v&&x.push(v),x.join(" + ")}y.format=f})(l=c.Trigger||={})})(_t||={});var jx=yu;function Jet(e,t){let r=[];return e===void 0&&!t?r.push("any mouse button"):e===0?r.push("mouse hover"):e!==void 0&&(jx.has(e,jx.Flag.Primary)&&r.push("left mouse button"),jx.has(e,jx.Flag.Secondary)&&r.push("right mouse button"),jx.has(e,jx.Flag.Auxilary)&&r.push("wheel/middle mouse button"),jx.has(e,jx.Flag.Forth)&&r.push("three fingers")),r.join(" + ")}function $et(e,t){let r=[];return e?(e.alt&&r.push("alt key"),e.control&&r.push("control key"),e.meta&&r.push("meta/command key"),e.shift&&r.push("shift key"),t&&r.length===0&&r.push("no key")):t&&r.push("any key"),r.join(" + ")}function ett(e){return e?.startsWith("Key")&&(e=e.substring(3)),e&&Ls(e).toLowerCase()}var Wx=yu,pd=Ql,Xx=_t.Trigger,bm=_t.TriggerKey,cSe={dragRotate:_t([Xx(Wx.Flag.Primary,pd.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:_t([Xx(Wx.Flag.Primary,pd.create({shift:!0,control:!0}))],"Rotate around z-axis (roll)","Drag using ${triggers}"),dragPan:_t([Xx(Wx.Flag.Secondary,pd.create()),Xx(Wx.Flag.Primary,pd.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:_t.Empty,dragFocus:_t([Xx(Wx.Flag.Forth,pd.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:_t([Xx(Wx.Flag.Auxilary,pd.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:_t([Xx(Wx.Flag.Auxilary,pd.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:_t([Xx(Wx.Flag.Auxilary,pd.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:_t.Empty,keyMoveForward:_t([bm("KeyW")],"Move forward","Press ${triggers}"),keyMoveBack:_t([bm("KeyS")],"Move back","Press ${triggers}"),keyMoveLeft:_t([bm("KeyA")],"Move left","Press ${triggers}"),keyMoveRight:_t([bm("KeyD")],"Move right","Press ${triggers}"),keyMoveUp:_t([bm("KeyR")],"Move up","Press ${triggers}"),keyMoveDown:_t([bm("KeyF")],"Move down","Press ${triggers}"),keyRollLeft:_t([bm("KeyQ")],"Roll left","Press ${triggers}"),keyRollRight:_t([bm("KeyE")],"Roll right","Press ${triggers}"),keyPitchUp:_t([bm("ArrowUp",pd.create({shift:!0}))],"Pitch up","Press ${triggers}"),keyPitchDown:_t([bm("ArrowDown",pd.create({shift:!0}))],"Pitch down","Press ${triggers}"),keyYawLeft:_t([bm("ArrowLeft",pd.create({shift:!0}))],"Yaw left","Press ${triggers}"),keyYawRight:_t([bm("ArrowRight",pd.create({shift:!0}))],"Yaw right","Press ${triggers}"),boostMove:_t([bm("ShiftLeft")],"Boost move","Press ${triggers}"),enablePointerLock:_t([bm("Space",pd.create({control:!0}))],"Enable pointer lock","Press ${triggers}")},p8={noScroll:C.Boolean(!0,{isHidden:!0}),rotateSpeed:C.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:C.Numeric(7,{min:1,max:15,step:1}),panSpeed:C.Numeric(1,{min:.1,max:5,step:.1}),moveSpeed:C.Numeric(.75,{min:.1,max:3,step:.1}),boostMoveFactor:C.Numeric(5,{min:.1,max:10,step:.1}),flyMode:C.Boolean(!1),animate:C.MappedStatic("off",{off:C.EmptyGroup(),spin:C.Group({speed:C.Numeric(1,{min:-20,max:20,step:1},{description:"Rotation speed in radians per second"})},{description:"Spin the 3D scene around the x-axis in view space"}),rock:C.Group({speed:C.Numeric(.3,{min:-5,max:5,step:.1}),angle:C.Numeric(10,{min:0,max:90,step:1},{description:"How many degrees to rotate in each direction."})},{description:"Rock the 3D scene around the x-axis in view space"})}),staticMoving:C.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:C.Numeric(.2,{},{isHidden:!0}),minDistance:C.Numeric(.01,{},{isHidden:!0}),maxDistance:C.Numeric(1e150,{},{isHidden:!0}),gestureScaleFactor:C.Numeric(1,{},{isHidden:!0}),maxWheelDelta:C.Numeric(.02,{},{isHidden:!0}),bindings:C.Value(cSe,{isHidden:!0}),autoAdjustMinMaxDistance:C.MappedStatic("on",{off:C.EmptyGroup(),on:C.Group({minDistanceFactor:C.Numeric(0),minDistancePadding:C.Numeric(5),maxDistanceFactor:C.Numeric(10),maxDistanceMin:C.Numeric(20)})},{isHidden:!0})};var f8;(t=>{function e(r,n,o,i={}){let a={...C.getDefaultValues(p8),...i,bindings:{...cSe,...i.bindings}},s=a.bindings,l=co.clone(n.viewport),u=!1,c=r.drag.subscribe(fo),m=r.interactionEnd.subscribe(G),d=r.wheel.subscribe(te),p=r.pinch.subscribe(Ge),h=r.keyDown.subscribe(lt),f=r.keyUp.subscribe(xt),y=r.move.subscribe(Ze),g=r.lock.subscribe(Mt),x=r.leave.subscribe(ke),S=!1,I=b(),v=b(),A=Ie(),_=Ie(),T=b(),w=0,D=Ie(),M=Ie(),E=0,R=0,k=0,B=Ie(),L=Ie(),V=Ie(),U=Ie(),Q=Ie(),O=Ie(),q=b.clone(n.target),X=b.clone(n.position),F=b.clone(n.up),Y=Ie();function $(de,Me){return Ie.set(Y,(de-l.x)/l.width,(Me-l.y)/l.height)}let ce=Ie();function ie(de,Me){return Ie.set(ce,(de-l.width*.5-l.x)/(l.width*.5),(l.height+2*(l.y-Me))/l.width)}function oe(){let de=r.width/r.height||1;return a.rotateSpeed*r.pixelRatio*de}let W=b(),N=Tr(),j=b(),ue=b(),be=b(),ee=b();function le(){let de=_[0]-A[0],Me=_[1]-A[1];b.set(ee,de,Me,0);let fe=b.magnitude(ee)*oe();fe?(b.sub(v,n.position,n.target),b.normalize(j,v),b.normalize(ue,n.up),b.normalize(be,b.cross(be,ue,j)),b.setMagnitude(ue,ue,Me),b.setMagnitude(be,be,de),b.add(ee,ue,be),b.normalize(W,b.cross(W,ee,v)),Tr.setAxisAngle(N,W,fe),b.transformQuat(v,v,N),b.transformQuat(n.up,n.up,N),b.copy(T,W),w=fe):!a.staticMoving&&w&&(w*=Math.sqrt(1-a.dynamicDampingFactor),b.sub(v,n.position,n.target),Tr.setAxisAngle(N,T,w),b.transformQuat(v,v,N),b.transformQuat(n.up,n.up,N)),Ie.copy(A,_)}let Ae=Tr(),Ce=b();function J(){let de=(gt.rollRight-gt.rollLeft)/45,Me=(M[0]-D[0])*-Math.sign(M[1]),fe=(M[1]-D[1])*-Math.sign(M[0]),Le=-a.rotateSpeed*(-Me+fe)+de;Le?(b.normalize(Ce,v),Tr.setAxisAngle(Ae,Ce,Le),b.transformQuat(n.up,n.up,Ae),E=Le):!a.staticMoving&&E&&(E*=Math.sqrt(1-a.dynamicDampingFactor),b.normalize(Ce,v),Tr.setAxisAngle(Ae,Ce,E),b.transformQuat(n.up,n.up,Ae)),Ie.copy(D,M)}let z=Tr(),ae=b();function ge(){let de=(gt.pitchUp-gt.pitchDown)/(a.flyMode?360:90),Me=-a.rotateSpeed*de;Me?(b.cross(ae,v,n.up),b.normalize(ae,ae),Tr.setAxisAngle(z,ae,Me),b.transformQuat(v,v,z),b.transformQuat(n.up,n.up,z),R=Me):!a.staticMoving&&R&&(R*=Math.sqrt(1-a.dynamicDampingFactor),b.cross(ae,v,n.up),b.normalize(ae,ae),Tr.setAxisAngle(z,ae,R),b.transformQuat(v,v,z),b.transformQuat(n.up,n.up,z))}let ve=Tr(),Oe=b();function ze(){let de=(gt.yawRight-gt.yawLeft)/(a.flyMode?360:90),Me=-a.rotateSpeed*de;Me?(b.normalize(Oe,n.up),Tr.setAxisAngle(ve,Oe,Me),b.transformQuat(v,v,ve),b.transformQuat(n.up,n.up,ve),k=Me):!a.staticMoving&&k&&(k*=Math.sqrt(1-a.dynamicDampingFactor),b.normalize(Oe,n.up),Tr.setAxisAngle(ve,Oe,k),b.transformQuat(v,v,ve),b.transformQuat(n.up,n.up,ve))}function Re(){let de=1+(L[1]-B[1])*a.zoomSpeed;de!==1&&de>0&&b.scale(v,v,de),a.staticMoving?Ie.copy(B,L):B[1]+=(L[1]-B[1])*a.dynamicDampingFactor}function Ke(){let de=(U[1]-V[1])*a.zoomSpeed;if(de!==0){let Me=Math.max(1,n.state.radius+n.state.radius*de);n.setState({radius:Me})}a.staticMoving?Ie.copy(V,U):V[1]+=(U[1]-V[1])*a.dynamicDampingFactor}let tt=Ie(),bt=b(),Pt=b();function fr(){if(Ie.sub(tt,Ie.copy(tt,O),Q),Ie.squaredMagnitude(tt)){let de=r.pixelRatio*a.panSpeed;tt[0]*=1/n.zoom*n.viewport.width*de,tt[1]*=1/n.zoom*n.viewport.height*de,b.cross(Pt,b.copy(Pt,v),n.up),b.setMagnitude(Pt,Pt,tt[0]),b.setMagnitude(bt,n.up,tt[1]),b.add(Pt,Pt,bt),b.add(n.position,n.position,Pt),b.add(n.target,n.target,Pt),a.staticMoving?Ie.copy(Q,O):(Ie.sub(tt,O,Q),Ie.scale(tt,tt,a.dynamicDampingFactor),Ie.add(Q,Q,tt))}}let gt={moveUp:0,moveDown:0,moveLeft:0,moveRight:0,moveForward:0,moveBack:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0,boostMove:0},Sr=b(),zr=b();function Nn(de){b.sub(zr,n.position,n.target);let Me=Math.max(n.state.minNear,a.minDistance);b.setMagnitude(zr,zr,Me);let fe=de*(60/1e3)*a.moveSpeed*(gt.boostMove===1?a.boostMoveFactor:1);if(gt.moveForward===1&&(b.normalize(Sr,zr),b.scaleAndSub(n.position,n.position,Sr,fe),(a.flyMode||r.pointerLock)&&b.sub(n.target,n.position,zr)),gt.moveBack===1&&(b.normalize(Sr,zr),b.scaleAndAdd(n.position,n.position,Sr,fe),(a.flyMode||r.pointerLock)&&b.sub(n.target,n.position,zr)),gt.moveLeft===1&&(b.cross(Sr,zr,n.up),b.normalize(Sr,Sr),a.flyMode||r.pointerLock?(b.scaleAndAdd(n.position,n.position,Sr,fe),b.sub(n.target,n.position,zr)):(b.scaleAndSub(n.position,n.position,Sr,fe),b.sub(n.target,n.position,v))),gt.moveRight===1&&(b.cross(Sr,zr,n.up),b.normalize(Sr,Sr),a.flyMode||r.pointerLock?(b.scaleAndSub(n.position,n.position,Sr,fe),b.sub(n.target,n.position,zr)):(b.scaleAndAdd(n.position,n.position,Sr,fe),b.sub(n.target,n.position,v))),gt.moveUp===1&&(b.normalize(Sr,n.up),a.flyMode||r.pointerLock?(b.scaleAndAdd(n.position,n.position,Sr,fe),b.sub(n.target,n.position,zr)):(b.scaleAndSub(n.position,n.position,Sr,fe),b.sub(n.target,n.position,v))),gt.moveDown===1&&(b.normalize(Sr,n.up),a.flyMode||r.pointerLock?(b.scaleAndSub(n.position,n.position,Sr,fe),b.sub(n.target,n.position,zr)):(b.scaleAndAdd(n.position,n.position,Sr,fe),b.sub(n.target,n.position,v))),a.flyMode||r.pointerLock){let Le=b.distance(n.position,o.boundingSphereVisible.center);n.setState({minFar:Le+o.boundingSphereVisible.radius})}}function xn(){let de=Math.min(Math.max(n.state.radiusMax*1e3,.01),a.maxDistance);b.squaredMagnitude(v)>de*de&&(b.setMagnitude(v,v,de),b.add(n.position,n.target,v),Ie.copy(B,L),Ie.copy(V,U)),b.squaredMagnitude(v)<a.minDistance*a.minDistance&&(b.setMagnitude(v,v,a.minDistance),b.add(n.position,n.target,v),Ie.copy(B,L),Ie.copy(V,U))}function In(de,Me){return de*=r.pixelRatio,Me*=r.pixelRatio,de>l.x+l.width||r.height-Me>l.y+l.height||de<l.x||r.height-Me<l.y}let zn=-1;function hi(de){if(zn===de)return;let Me=de-zn;zn>0&&(a.animate.name==="spin"?ot(Me):a.animate.name==="rock"&&qt(Me)),b.sub(v,n.position,n.target),le(),J(),ge(),ze(),Re(),Ke(),fr(),b.add(n.position,n.target,v),xn(),zn>0&&Nn(Math.min(Me,15*1e3/60)),b.sub(v,n.position,n.target),xn(),b.squaredDistance(I,n.position)>1e-6&&b.copy(I,n.position),zn=de}function nl(){b.copy(n.target,q),b.copy(n.position,X),b.copy(n.up,F),b.sub(v,n.position,n.target),b.copy(I,n.position)}function fo({x:de,y:Me,pageX:fe,pageY:Le,buttons:vt,modifiers:zt,isStart:jt}){let mr=In(de,Me);if(jt&&mr||!jt&&!S)return;S=!0,pe();let Io=_t.match(s.dragRotate,vt,zt),ni=_t.match(s.dragRotateZ,vt,zt),ua=_t.match(s.dragPan,vt,zt),Go=_t.match(s.dragZoom,vt,zt),vg=_t.match(s.dragFocus,vt,zt),dG=_t.match(s.dragFocusZoom,vt,zt);ie(fe,Le),$(fe,Le);let Lq=r.pixelRatio,Fq=(de*Lq-l.width/2-l.x)/l.width,Vq=-(r.height-Me*Lq-l.height/2-l.y)/l.height;if(jt&&(Io&&(Ie.copy(_,ce),Ie.copy(A,_)),ni&&(Ie.set(M,Fq,Vq),Ie.copy(D,M)),(Go||dG)&&(Ie.copy(B,Y),Ie.copy(L,B)),vg&&(Ie.copy(V,Y),Ie.copy(U,V)),ua&&(Ie.copy(Q,Y),Ie.copy(O,Q))),Io&&Ie.copy(_,ce),ni&&Ie.set(M,Fq,Vq),(Go||dG)&&Ie.copy(L,Y),vg&&Ie.copy(U,Y),dG){let I3e=b.distance(n.state.position,n.state.target);n.setState({radius:I3e/5})}ua&&Ie.copy(O,Y)}function G(){S=!1}function te({x:de,y:Me,spinX:fe,spinY:Le,dz:vt,buttons:zt,modifiers:jt}){if(In(de,Me))return;let mr=oee(fe*.075,Le*.075,vt*1e-4);mr<-a.maxWheelDelta?mr=-a.maxWheelDelta:mr>a.maxWheelDelta&&(mr=a.maxWheelDelta),_t.match(s.scrollZoom,zt,jt)&&(L[1]+=mr),_t.match(s.scrollFocus,zt,jt)&&(U[1]+=mr)}function Ge({isStart:de,startX:Me,startY:fe,centerPageX:Le,centerPageY:vt,fractionDelta:zt,buttons:jt,modifiers:mr}){if(In(Me,fe))return;let Io=_t.match(s.dragPan,jt,mr),ni=_t.match(s.scrollZoom,jt,mr);S=Io||ni,Io&&($(Le,vt),de?(Ie.copy(Q,Y),Ie.copy(O,Q)):Ie.copy(O,Y)),ni&&(L[1]+=a.gestureScaleFactor*zt)}function Ze({movementX:de,movementY:Me}){if(!r.pointerLock||de===void 0||Me===void 0)return;let fe=l.width*.5-l.x,Le=l.height*.5-l.y;Ie.copy(A,ie(fe,Le)),Ie.copy(_,ie(de+fe,Me+Le))}function lt({modifiers:de,code:Me,key:fe,x:Le,y:vt}){In(Le,vt)||(_t.matchKey(s.keyMoveForward,Me,de,fe)?gt.moveForward=1:_t.matchKey(s.keyMoveBack,Me,de,fe)?gt.moveBack=1:_t.matchKey(s.keyMoveLeft,Me,de,fe)?gt.moveLeft=1:_t.matchKey(s.keyMoveRight,Me,de,fe)?gt.moveRight=1:_t.matchKey(s.keyMoveUp,Me,de,fe)?gt.moveUp=1:_t.matchKey(s.keyMoveDown,Me,de,fe)?gt.moveDown=1:_t.matchKey(s.keyRollLeft,Me,de,fe)?gt.rollLeft=1:_t.matchKey(s.keyRollRight,Me,de,fe)?gt.rollRight=1:_t.matchKey(s.keyPitchUp,Me,de,fe)?gt.pitchUp=1:_t.matchKey(s.keyPitchDown,Me,de,fe)?gt.pitchDown=1:_t.matchKey(s.keyYawLeft,Me,de,fe)?gt.yawLeft=1:_t.matchKey(s.keyYawRight,Me,de,fe)&&(gt.yawRight=1),_t.matchKey(s.boostMove,Me,de,fe)&&(gt.boostMove=1),_t.matchKey(s.enablePointerLock,Me,de,fe)&&r.requestPointerLock(l))}function xt({modifiers:de,code:Me,key:fe,x:Le,y:vt}){if(In(Le,vt))return;let zt=!1;Me.startsWith("Alt")?(zt=!0,de.alt=!0):Me.startsWith("Shift")?(zt=!0,de.shift=!0):Me.startsWith("Control")?(zt=!0,de.control=!0):Me.startsWith("Meta")&&(zt=!0,de.meta=!0);let jt=[];zt?(gt.moveForward&&jt.push(s.keyMoveForward.triggers[0]?.code||""),gt.moveBack&&jt.push(s.keyMoveBack.triggers[0]?.code||""),gt.moveLeft&&jt.push(s.keyMoveLeft.triggers[0]?.code||""),gt.moveRight&&jt.push(s.keyMoveRight.triggers[0]?.code||""),gt.moveUp&&jt.push(s.keyMoveUp.triggers[0]?.code||""),gt.moveDown&&jt.push(s.keyMoveDown.triggers[0]?.code||""),gt.rollLeft&&jt.push(s.keyRollLeft.triggers[0]?.code||""),gt.rollRight&&jt.push(s.keyRollRight.triggers[0]?.code||""),gt.pitchUp&&jt.push(s.keyPitchUp.triggers[0]?.code||""),gt.pitchDown&&jt.push(s.keyPitchDown.triggers[0]?.code||""),gt.yawLeft&&jt.push(s.keyYawLeft.triggers[0]?.code||""),gt.yawRight&&jt.push(s.keyYawRight.triggers[0]?.code||"")):jt.push(Me);for(let mr of jt)_t.matchKey(s.keyMoveForward,mr,de,fe)?gt.moveForward=0:_t.matchKey(s.keyMoveBack,mr,de,fe)?gt.moveBack=0:_t.matchKey(s.keyMoveLeft,mr,de,fe)?gt.moveLeft=0:_t.matchKey(s.keyMoveRight,mr,de,fe)?gt.moveRight=0:_t.matchKey(s.keyMoveUp,mr,de,fe)?gt.moveUp=0:_t.matchKey(s.keyMoveDown,mr,de,fe)?gt.moveDown=0:_t.matchKey(s.keyRollLeft,mr,de,fe)?gt.rollLeft=0:_t.matchKey(s.keyRollRight,mr,de,fe)?gt.rollRight=0:_t.matchKey(s.keyPitchUp,mr,de,fe)?gt.pitchUp=0:_t.matchKey(s.keyPitchDown,mr,de,fe)?gt.pitchDown=0:_t.matchKey(s.keyYawLeft,mr,de,fe)?gt.yawLeft=0:_t.matchKey(s.keyYawRight,mr,de,fe)&&(gt.yawRight=0);_t.matchKey(s.boostMove,Me,de,fe)&&(gt.boostMove=0)}function At(){b.sub(zr,n.position,n.target);let de=Math.max(n.state.minNear,a.minDistance);b.setMagnitude(zr,zr,de),b.sub(n.target,n.position,zr);let Me=b.distance(n.position,o.boundingSphereVisible.center);n.setState({minFar:Me+o.boundingSphereVisible.radius})}function Dt(){let{center:de,radius:Me}=o.boundingSphereVisible;if(b.distance(n.position,de)>Me){let Le=n.getFocus(de,Me);n.setState({...Le,minFar:0})}else n.setState({minFar:0,radius:o.boundingSphereVisible.radius})}function Mt(de){de?At():Dt()}function wt(){gt.moveForward=0,gt.moveBack=0,gt.moveLeft=0,gt.moveRight=0,gt.moveUp=0,gt.moveDown=0,gt.rollLeft=0,gt.rollRight=0,gt.pitchUp=0,gt.pitchDown=0,gt.yawLeft=0,gt.yawRight=0,gt.boostMove=0}function ke(){wt()}function nt(){u||(u=!0,c.unsubscribe(),d.unsubscribe(),p.unsubscribe(),m.unsubscribe(),h.unsubscribe(),f.unsubscribe(),y.unsubscribe(),g.unsubscribe(),x.unsubscribe())}let Ue=Ie.create(.005,0);function ot(de){if(a.animate.name!=="spin"||a.animate.params.speed===0||S)return;let Me=a.animate.params.speed/1e3;Ue[0]=de*Me/oe(),Ie.add(_,A,Ue)}let Tt=0,kt=Ie.create(.005,0);function qt(de){if(a.animate.name!=="rock"||a.animate.params.speed===0||S)return;let Me=de/1e3*a.animate.params.speed,fe=vr(a.animate.params.angle)/oe(),Le=Math.sin(Tt*Math.PI*2)*fe,vt=Math.sin((Tt+Me)*Math.PI*2)*fe;kt[0]=vt-Le,Ie.add(_,A,kt),Tt+=Me,Tt>=1&&(Tt=0)}function pe(){Tt=0}function _e(de){zn=-1,hi(de)}return{viewport:l,get isAnimating(){return a.animate.name!=="off"},get isMoving(){return gt.moveForward===1||gt.moveBack===1||gt.moveLeft===1||gt.moveRight===1||gt.moveUp===1||gt.moveDown===1||gt.rollLeft===1||gt.rollRight===1||gt.pitchUp===1||gt.pitchDown===1||gt.yawLeft===1||gt.yawRight===1},get props(){return a},setProps:de=>{de.animate?.name==="rock"&&a.animate.name!=="rock"&&pe(),de.flyMode!==void 0&&de.flyMode!==a.flyMode&&(de.flyMode?At():Dt()),Object.assign(a,de),Object.assign(s,de.bindings)},start:_e,update:hi,reset:nl,dispose:nt}}t.create=e})(f8||={});var mL;(n=>{function e(){return{view:Z.identity(),position:b.create(0,0,0),direction:b.create(0,0,-1),up:b.create(0,1,0)}}n.create=e;let t=b.zero();function r(o){b.add(t,o.position,o.direction),Z.lookAt(o.view,o.position,t,o.up)}n.update=r})(mL||={});var dL=class{constructor(){this.removeList=L2();this.removeMap=new Map;this.addList=L2();this.addMap=new Map}get isEmpty(){return this.removeList.count===0&&this.addList.count===0}get size(){return this.removeMap.size+this.addMap.size}add(t){if(this.removeMap.has(t)){let n=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(n)}if(this.addMap.has(t))return;let r=this.addList.addLast(t);this.addMap.set(t,r)}remove(t){if(this.addMap.has(t)){let n=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(n)}if(this.removeMap.has(t))return;let r=this.removeList.addLast(t);this.removeMap.set(t,r)}tryGetRemove(){let t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t}tryGetAdd(){let t=this.addList.removeFirst();return t&&this.addMap.delete(t),t}};var q_=new Ci("98");function mSe(e,t,r){q_.reset();for(let n=0,o=e.length;n<o;++n){if(r&&!e[n].state.visible||!e[n].values.drawCount.ref.value)continue;let i=e[n].values.boundingSphere.ref.value;i.radius&&q_.includeSphere(i)}q_.finishedIncludeStep();for(let n=0,o=e.length;n<o;++n){if(r&&!e[n].state.visible||!e[n].values.drawCount.ref.value)continue;let i=e[n].values.boundingSphere.ref.value;i.radius&&q_.radiusSphere(i)}return q_.getSphere(t)}function ttt(e,t){let r=e.getProgram("color").id,n=t.getProgram("color").id,o=e.materialId,i=t.materialId;return r!==n?r-n:o!==i?o-i:e.id-t.id}var Ey;(t=>{function e(r,n="blended"){let o=new Map,i=[],a=ye(),s=ye(),l=[],u=[],c=!0,m=!0,d=!0,p=!0,h=!0,f=!0,y=!0,g=0,x=0,S=0,I=0,v=!1,A=mL.create(),{view:_,position:T,direction:w,up:D}=A;function M(Y){if(o.has(Y))console.warn(`RenderObject with id '${Y.id}' already present`);else{let $=Whe(r,Y,n);i.push($),Y.type==="direct-volume"?u.push($):l.push($),o.set(Y,$),c=!0,m=!0}}function E(Y){let $=o.get(Y);$&&($.dispose(),Pd(i,$),Pd(l,$),Pd(u,$),o.delete(Y),c=!0,m=!0)}let R=100;function k(Y){let $=Mn(),ce=0;for(;;){let ie=B.tryGetRemove();if(!ie)break;if(E(ie),++ce%R===0&&Mn()-$>Y)return!1}for(;;){let ie=B.tryGetAdd();if(!ie)break;if(M(ie),++ce%R===0&&Mn()-$>Y)return!1}return i.sort(ttt),d=!0,p=!0,h=!0,f=!0,y=!0,!0}let B=new dL,L=-1;function V(){let Y=23;for(let $=0,ce=i.length;$<ce;++$)i[$].state.visible&&(Y=31*Y+i[$].id|0);return Y=pw(Y),Y===-1&&(Y=0),Y}function U(){let Y=V();return Y!==L?(m=!0,d=!0,p=!0,h=!0,f=!0,y=!0,L=Y,!0):!1}function Q(){if(l.length===0)return 0;let Y=0,$=0;for(let ce=0,ie=l.length;ce<ie;++ce)l[ce].state.visible&&($+=l[ce].values.markerAverage.ref.value,Y+=1);return Y>0?$/Y:0}function O(){if(l.length===0)return 0;let Y=0,$=0;for(let ce=0,ie=l.length;ce<ie;++ce)l[ce].state.visible&&($+=l[ce].values.emissiveAverage.ref.value+l[ce].values.uEmissive.ref.value,Y+=1);return Y>0?$/Y:0}function q(){if(l.length===0)return 0;let Y=0,$=0;for(let ce=0,ie=l.length;ce<ie;++ce){let oe=l[ce];if(!oe.state.visible)continue;let W=Br(oe.values.alpha.ref.value*oe.state.alphaFactor,0,1),N=oe.values.dXrayShaded?.ref.value==="on"||oe.values.dXrayShaded?.ref.value==="inverted"?.5:1,j=oe.values.dPointStyle?.ref.value==="fuzzy"?.5:1,ue=oe.values.dGeometryType.ref.value==="text"?.5:1,be=oe.values.dGeometryType.ref.value==="image"?.5:1;$+=(1-oe.values.transparencyAverage.ref.value)*W*N*j*ue*be,Y+=1}return Y>0?$/Y:0}function X(){if(l.length===0)return 1;let Y=1,$=[];for(let ce=0,ie=l.length;ce<ie;++ce){let oe=l[ce];if(!oe.state.visible)continue;$.length=0;let W=Br(oe.values.alpha.ref.value*oe.state.alphaFactor,0,1);W<1&&$.push(1-W),(oe.values.dXrayShaded?.ref.value==="on"||oe.values.dXrayShaded?.ref.value==="inverted"||oe.values.dPointStyle?.ref.value==="fuzzy"||oe.values.dGeometryType.ref.value==="text"||oe.values.dGeometryType.ref.value==="image")&&$.push(.5),oe.values.transparencyMin.ref.value>0&&$.push(oe.values.transparencyMin.ref.value),Y=Math.min(Y,...$)}return Y}function F(){if(l.length===0)return!1;for(let Y=0,$=l.length;Y<$;++Y){let ce=l[Y];if(ce.state.visible&&(ce.state.opaque||ce.state.alphaFactor===1&&ce.values.alpha.ref.value===1&&ce.values.transparencyAverage.ref.value!==1||ce.values.dTransparentBackfaces?.ref.value==="opaque"))return!0}return!1}return{view:_,position:T,direction:w,up:D,renderables:i,primitives:{view:_,position:T,direction:w,up:D,renderables:l},volumes:{view:_,position:T,direction:w,up:D,renderables:u},syncVisibility:U,setTransparency:Y=>{n=Y;for(let $=0,ce=i.length;$<ce;++$)i[$].setTransparency(Y)},update(Y,$){if(mL.update(A),Y)for(let ce=0,ie=Y.length;ce<ie;++ce)o.get(Y[ce])?.update();else for(let ce=0,ie=i.length;ce<ie;++ce)i[ce].update();$?U():(c=!0,m=!0),d=!0,p=!0,h=!0,f=!0,y=!0},add:Y=>B.add(Y),remove:Y=>B.remove(Y),commit:(Y=Number.MAX_VALUE)=>k(Y),get commitQueueSize(){return B.size},get needsCommit(){return!B.isEmpty},has:Y=>o.has(Y),clear:()=>{for(let Y=0,$=i.length;Y<$;++Y)i[Y].dispose();i.length=0,l.length=0,u.length=0,o.clear(),c=!0,m=!0},forEach:Y=>{o.forEach(Y)},get count(){return i.length},get boundingSphere(){return c&&(mSe(i,a,!1),c=!1),a},get boundingSphereVisible(){return m&&(mSe(i,s,!0),m=!1),s},get markerAverage(){return d&&(g=Q(),d=!1),g},get emissiveAverage(){return p&&(x=O(),p=!1),x},get opacityAverage(){return h&&(S=q(),h=!1),S},get transparencyMin(){return f&&(I=X(),f=!1),I},get hasOpaque(){return y&&(v=F(),y=!1),v}}}t.create=e})(Ey||={});var nA=class e{constructor(t){this.camera=t;this.t=0;this.func=e.defaultTransition;this.start=0;this.inTransition=!1;this.durationMs=0;this._source=mo.createDefaultSnapshot();this._target=mo.createDefaultSnapshot();this._current=mo.createDefaultSnapshot()}get source(){return this._source}get target(){return this._target}apply(t,r=0,n){if((!this.inTransition||r>0)&&mo.copySnapshot(this._source,this.camera.state),this.inTransition||mo.copySnapshot(this._target,this.camera.state),mo.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&r<=0||typeof t.mode<"u"&&t.mode!==this.camera.state.mode){this.finish(this._target);return}this.inTransition=!0,this.func=n||e.defaultTransition,(!this.inTransition||r>0)&&(this.start=this.t,this.durationMs=r)}tick(t){this.t=t,this.update()}finish(t){mo.copySnapshot(this.camera.state,t),this.inTransition=!1}update(){if(!this.inTransition)return;let t=Math.min((this.t-this.start)/this.durationMs,1);if(t===1){this.finish(this._target);return}this.func(this._current,t,this._source,this._target),mo.copySnapshot(this.camera.state,this._current)}};(i=>{let e=Tr.identity(),t=Tr.identity(),r=b(),n=b();function o(a,s,l,u){mo.copySnapshot(a,u),Tr.slerp(e,Tr.Identity,Tr.rotationTo(e,l.up,u.up),s),b.transformQuat(a.up,l.up,e),b.lerp(a.target,l.target,u.target,s);let c=b.distance(l.target,l.position),m=b.distance(u.target,u.position),d=$n(c,m,s);b.sub(r,l.position,l.target),b.normalize(r,r),b.sub(n,u.position,u.target),b.normalize(n,n),Tr.rotationTo(t,r,n),Tr.slerp(t,Tr.Identity,t,s),b.transformQuat(r,r,t),b.scale(r,r,d),b.add(a.position,a.target,r),a.radius=$n(l.radius,u.radius,s),a.radiusMax=$n(l.radiusMax,u.radiusMax,s),a.fov=$n(l.fov,u.fov,s),a.fog=$n(l.fog,u.fog,s)}i.defaultTransition=o})(nA||={});var dSe=Ut(),mo=class e{constructor(t,r=co.create(0,0,128,128)){this.view=Z.identity();this.projection=Z.identity();this.projectionView=Z.identity();this.inverseProjectionView=Z.identity();this.headRotation=Z.zero();this.state=e.createDefaultSnapshot();this.viewOffset=e.ViewOffset();this.near=1;this.far=1e4;this.fogNear=5e3;this.fogFar=1e4;this.zoom=1;this.transition=new nA(this);this.stateChanged=new Pa(this.state);this.prevProjection=Z.identity();this.prevView=Z.identity();this.deltaDirection=b();this.newPosition=b();this.viewport=r,e.copySnapshot(this.state,t)}get position(){return this.state.position}set position(t){b.copy(this.state.position,t)}get up(){return this.state.up}set up(t){b.copy(this.state.up,t)}get target(){return this.state.target}set target(t){b.copy(this.state.target,t)}update(){let t=this.state;if(t.radiusMax===0)return!1;let r=2*Math.tan(t.fov/2)*b.distance(t.position,t.target);switch(this.zoom=this.viewport.height/r,ott(this),this.state.mode){case"orthographic":rtt(this);break;case"perspective":ntt(this);break;default:Rr(this.state.mode)}let n=!Z.areEqual(this.projection,this.prevProjection,1e-6)||!Z.areEqual(this.view,this.prevView,1e-6);if(n){if(Z.mul(this.projectionView,this.projection,this.view),!Z.tryInvert(this.inverseProjectionView,this.projectionView))return Z.copy(this.view,this.prevView),Z.copy(this.projection,this.prevProjection),Z.mul(this.projectionView,this.projection,this.view),!1;Z.copy(this.prevView,this.view),Z.copy(this.prevProjection,this.projection)}return n}setState(t,r){this.transition.apply(t,r),this.stateChanged.next(t)}getSnapshot(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)}getTargetDistance(t){return e.targetDistance(t,this.state.mode,this.state.fov,this.viewport.width,this.viewport.height)}getFocus(t,r,n,o,i){let a=Math.max(r,.01),s=this.getTargetDistance(a);b.sub(this.deltaDirection,i?.target??this.target,i?.position??this.position),o&&b.matchDirection(this.deltaDirection,o,this.deltaDirection),b.setMagnitude(this.deltaDirection,this.deltaDirection,s),b.sub(this.newPosition,t,this.deltaDirection);let l=e.copySnapshot(e.createDefaultSnapshot(),this.state);return l.target=b.clone(t),l.radius=a,l.position=b.clone(this.newPosition),n&&b.matchDirection(l.up,n,l.up),l}getCenter(t,r){b.sub(this.deltaDirection,this.target,this.position),b.sub(this.newPosition,t,this.deltaDirection);let n=e.copySnapshot(e.createDefaultSnapshot(),this.state);return n.target=b.clone(t),n.position=b.clone(this.newPosition),r&&(n.radius=Math.max(r,.01)),n}getInvariantFocus(t,r,n,o){let i=Math.max(r,.01),a=this.getTargetDistance(i);b.copy(this.deltaDirection,o),b.setMagnitude(this.deltaDirection,this.deltaDirection,a),b.sub(this.newPosition,t,this.deltaDirection);let s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=b.clone(t),s.radius=i,s.position=b.clone(this.newPosition),b.copy(s.up,n),s}focus(t,r,n,o,i){r>0&&this.setState(this.getFocus(t,r,o,i),n)}center(t,r){this.setState(this.getCenter(t),r)}project(t,r){return aSe(t,r,this.viewport,this.projectionView)}unproject(t,r){return Hx(t,r,this.viewport,this.inverseProjectionView)}getPixelSize(t){this.project(dSe,t);let r=dSe[3],n=this.viewport.width,o=this.projection[0];return 2/r/(n*Math.abs(o))}getRay(t,r,n){return this.state.mode==="orthographic"?(b.set(t.origin,r,n,0),this.unproject(t.origin,t.origin),b.normalize(t.direction,b.sub(t.direction,this.target,this.position)),b.scaleAndAdd(t.origin,t.origin,t.direction,-this.near)):(b.copy(t.origin,this.state.position),b.set(t.direction,r,n,.5),this.unproject(t.direction,t.direction),b.normalize(t.direction,b.sub(t.direction,t.direction,t.origin))),t}};(s=>{function e(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}s.ViewOffset=e;function t(l,u,c,m,d,p,h){l.fullWidth=u,l.fullHeight=c,l.offsetX=m,l.offsetY=d,l.width=p,l.height=h}s.setViewOffset=t;function r(l,u){l.enabled=u.enabled,l.fullWidth=u.fullWidth,l.fullHeight=u.fullHeight,l.offsetX=u.offsetX,l.offsetY=u.offsetY,l.width=u.width,l.height=u.height}s.copyViewOffset=r;function n(l,u,c,m,d){let p=Math.max(l,.01),h=m/d,f=d<m?1:h;return Math.abs(u==="orthographic"?p/f/Math.tan(c/2):p/f/Math.sin(c/2))}s.targetDistance=n;function o(){return{mode:"perspective",fov:Math.PI/4,position:b.create(0,0,100),up:b.create(0,1,0),target:b.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0,minNear:5,minFar:0}}s.createDefaultSnapshot=o;function i(l,u){return u&&(typeof u.mode<"u"&&(l.mode=u.mode),typeof u.fov<"u"&&(l.fov=u.fov),typeof u.position<"u"&&b.copy(l.position,u.position),typeof u.up<"u"&&b.copy(l.up,u.up),typeof u.target<"u"&&b.copy(l.target,u.target),typeof u.radius<"u"&&(l.radius=u.radius),typeof u.radiusMax<"u"&&(l.radiusMax=u.radiusMax),typeof u.fog<"u"&&(l.fog=u.fog),typeof u.clipFar<"u"&&(l.clipFar=u.clipFar),typeof u.minNear<"u"&&(l.minNear=u.minNear),typeof u.minFar<"u"&&(l.minFar=u.minFar)),l}s.copySnapshot=i;function a(l,u){return l.mode===u.mode&&l.fov===u.fov&&l.radius===u.radius&&l.radiusMax===u.radiusMax&&l.fog===u.fog&&l.clipFar===u.clipFar&&l.minNear===u.minNear&&l.minFar===u.minFar&&b.exactEquals(l.position,u.position)&&b.exactEquals(l.up,u.up)&&b.exactEquals(l.target,u.target)}s.areSnapshotsEqual=a})(mo||={});function rtt(e){let{viewport:t,zoom:r,near:n,far:o,viewOffset:i}=e,a=-t.width/2,s=t.width/2,l=t.height/2,u=-t.height/2,c=(s-a)/(2*r),m=(l-u)/(2*r),d=(s+a)/2,p=(l+u)/2,h=d-c,f=d+c,y=p+m,g=p-m;if(i.enabled){let x=r/(i.width/i.fullWidth),S=r/(i.height/i.fullHeight),I=(s-a)/i.width,v=(l-u)/i.height;h+=I*(i.offsetX/x),f=h+I*(i.width/x),y-=v*(i.offsetY/S),g=y-v*(i.height/S)}Z.ortho(e.projection,h,f,y,g,n,o),Z.lookAt(e.view,e.position,e.target,e.up)}function ntt(e){let t=e.viewport.width/e.viewport.height,{near:r,far:n,viewOffset:o}=e,i=r*Math.tan(.5*e.state.fov),a=2*i,s=t*a,l=-.5*s;o.enabled&&(l+=o.offsetX*s/o.fullWidth,i-=o.offsetY*a/o.fullHeight,s*=o.width/o.fullWidth,a*=o.height/o.fullHeight),Z.perspective(e.projection,l,l+s,i,i-a,r,n),Z.lookAt(e.view,e.position,e.target,e.up)}function ott(e){let{radius:t,radiusMax:r,mode:n,fog:o,clipFar:i,minNear:a,minFar:s}=e.state;t<.01&&(t=.01);let l=Math.max(i?t:r,s),u=b.distance(e.position,e.target),c=u-t,m=u+l;c=Math.max(Math.min(r,a),c),m=Math.max(a,m),c===m&&(m=c+.01);let d=-(50-o)/50,p=u-l*d,h=m;e.near=c,e.far=m,e.fogNear=p,e.fogFar=h}var Y_={sceneBoundingSpheres:C.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:C.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:C.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:C.Boolean(!1,{description:"Show bounding spheres of visible instances."})},fL=class{constructor(t,r,n){this.objectsData=new Map;this.instancesData=new Map;this.scene=Ey.create(t,"blended"),this.parent=r,this._props={...C.getDefaultValues(Y_),...n}}update(){let t=pL(this.scene,this.parent.boundingSphere,this.sceneData,Lt.lightgrey,att);t&&(this.sceneData=t);let r=pL(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,Lt.black,stt);r&&(this.visibleSceneData=r),this.parent.forEach((n,o)=>{let i=this.objectsData.get(o),a=pL(this.scene,n.values.boundingSphere.ref.value,i,Lt.tomato,ltt);a&&this.objectsData.set(o,a);let s=this.instancesData.get(o),l=pL(this.scene,n.values.invariantBoundingSphere.ref.value,s,Lt.skyblue,utt,{aTransform:o.values.aTransform,matrix:o.values.matrix,transform:o.values.transform,extraTransform:o.values.extraTransform,uInstanceCount:o.values.uInstanceCount,instanceCount:o.values.instanceCount,aInstance:o.values.aInstance,hasReflection:o.values.hasReflection,instanceGrid:o.values.instanceGrid});l&&this.instancesData.set(o,l)}),this.objectsData.forEach((n,o)=>{this.parent.has(o)||(this.scene.remove(n.renderObject),this.objectsData.delete(o))}),this.instancesData.forEach((n,o)=>{this.parent.has(o)||(this.scene.remove(n.renderObject),this.instancesData.delete(o))}),this.scene.update(void 0,!1),this.scene.commit()}syncVisibility(){this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach((t,r)=>{let n=this.objectsData.get(r);n&&(n.renderObject.state.visible=r.state.visible&&this._props.objectBoundingSpheres);let o=this.instancesData.get(r);o&&(o.renderObject.state.visible=r.state.visible&&this._props.instanceBoundingSpheres)})}clear(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()}get isEnabled(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres}get props(){return this._props}setProps(t){Object.assign(this._props,t),this.isEnabled&&this.update()}};function pL(e,t,r,n,o,i){if(!r||!ye.equals(r.boundingSphere,t)){let a=itt(t,r&&r.mesh),s=r?r.renderObject:ctt(a,n,o,i);return r?P.updateIfChanged(s.values.drawCount,Ga.getDrawCount(a)):e.add(s),{boundingSphere:ye.clone(t),renderObject:s,mesh:a}}}function itt(e,t){let n=pm(2),o=et.createState(n,n/2,t);if(e.radius&&(Nr(o,e.center,e.radius,2),ye.hasExtrema(e)))for(let i of e.extrema)Nr(o,i,1,0);return et.getMesh(o)}var att=Dc(),stt=Dc(),ltt=Dc(),utt=Dc();function ctt(e,t,r,n){let o=ft.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1,cellSize:0,batchSize:0},t,1,n);return Kd("mesh",o,{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1},r)}var h8=b(),g8=b(),pSe=b(),y8={maxFps:C.Numeric(30,{min:10,max:60,step:10}),preferAtomPixelPadding:C.Numeric(3,{min:0,max:20,step:1},{description:"Number of extra pixels at which to prefer atoms over bonds."}),convertCoordsToRay:C.Boolean(!1,{description:"Convert screen coordinates to ray for picking."})},hL=class{constructor(t,r,n,o,i,a,s={}){this.canvasIdentify=t;this.canvasAsyncIdentify=r;this.lociGetter=n;this.input=o;this.camera=i;this.controls=a;this.ev=oc.create();this.events={hover:this.ev(),drag:this.ev(),click:this.ev()};this.startX=-1;this.startY=-1;this.endX=-1;this.endY=-1;this.ray=void 0;this.pickData=void 0;this.position=void 0;this.isInteracting=!1;this.prevLoci=Vt.Loci.Empty;this.prevT=0;this.inside=!1;this.buttons=yu.create(0);this.button=yu.create(0);this.modifiers=Ql.None;this.props={...C.getDefaultValues(y8),...s},o.drag.subscribe(({x:l,y:u,buttons:c,button:m,modifiers:d})=>{this.isInteracting=!0,this.drag(l,u,c,m,d)}),o.move.subscribe(({x:l,y:u,inside:c,buttons:m,button:d,modifiers:p,onElement:h,ray:f})=>{if(!(!c||this.isInteracting)){if(!h){this.leave();return}this.move(l,u,m,d,p,f)}}),o.leave.subscribe(()=>{this.leave()}),o.click.subscribe(({x:l,y:u,buttons:c,button:m,modifiers:d,ray:p})=>{this.outsideViewport(l,u,p)||this.click(l,u,c,m,d,p)}),o.interactionEnd.subscribe(()=>{this.isInteracting=!1}),o.modifiers.subscribe(l=>{this.modify(l)})}setProps(t){Object.assign(this.props,t)}getTarget(){return this.ray?this.ray:this.props.convertCoordsToRay?this.camera.getRay(sf(),this.endX,this.input.height-this.endY):Ie.create(this.endX,this.endY)}handleMove(){(this.startX!==this.endX||this.startY!==this.endY||this.input.pointerLock&&!this.controls.isMoving)&&(this.pickData=this.canvasAsyncIdentify(this.getTarget()),this.startX=this.endX,this.startY=this.endY)}handleClick(){let t=this.canvasIdentify(this.getTarget()),r=this.getLoci(t?.id,t?.position);this.events.click.next({current:r,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ie.create(this.endX,this.endY),position:t?.position}),this.prevLoci=r}handleDrag(){(this.startX!==this.endX||this.startY!==this.endY||this.input.pointerLock&&!this.controls.isMoving)&&!this.outsideViewport(this.startX,this.startY,this.ray)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:Ie.create(this.startX,this.startY),pageEnd:Ie.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY)}tick(t){if(this.inside&&t-this.prevT>1e3/this.props.maxFps){if(this.pickData){let r=this.pickData.tryGet();if(r==="expired")this.pickData=void 0;else if(r!=="pending"){if(this.position=r?.position,this.inside){let n=this.getLoci(r?.id,r?.position);this.events.hover.next({current:n,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ie.create(this.endX,this.endY),position:r?.position}),this.prevLoci=n}this.pickData=void 0}}this.prevT=t,this.isInteracting?this.handleDrag():this.handleMove()}}leave(){this.inside=!1,Vt.Loci.isEmpty(this.prevLoci)||(this.prevLoci=Vt.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))}move(t,r,n,o,i,a){this.inside=!0,this.buttons=n,this.button=o,this.modifiers=i,this.ray=a,this.endX=t,this.endY=r}click(t,r,n,o,i,a){this.endX=t,this.endY=r,this.buttons=n,this.button=o,this.modifiers=i,this.ray=a,this.handleClick()}drag(t,r,n,o,i){this.endX=t,this.endY=r,this.buttons=n,this.button=o,this.modifiers=i,this.handleDrag()}modify(t){Ql.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ie.create(this.endX,this.endY),position:this.position}))}outsideViewport(t,r,n){if(n)return!1;let{input:o,camera:{viewport:i}}=this;return t*=o.pixelRatio,r*=o.pixelRatio,t>i.x+i.width||o.height-r>i.y+i.height||t<i.x||o.height-r<i.y}getLoci(t,r){let{repr:n,loci:o}=this.lociGetter(t);if(r&&n&&Ct.isLoci(o)&&o.bonds.length===2){let{aUnit:i,aIndex:a}=o.bonds[0];i.conformation.position(i.elements[a],h8),b.sub(pSe,this.camera.state.position,this.camera.state.target),b.projectPointOnPlane(g8,r,pSe,h8);let s=this.camera.getPixelSize(g8),l=n.theme.size.size(o.bonds[0])*(n.props.sizeFactor??1);if(n.props.lineSizeAttenuation===!1&&(l*=s/2),l+=this.props.preferAtomPixelPadding*s,b.distance(g8,h8)<l)return{repr:n,loci:Ct.toFirstStructureElementLoci(o)}}return{repr:n,loci:o}}dispose(){this.ev.dispose()}};var fSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform sampler2D tSsaoDepthTransparent;
uniform sampler2D tColor;
uniform sampler2D tTransparentColor;
uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;
uniform sampler2D tShadows;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform vec3 uOutlineColor;
uniform vec3 uOcclusionColor;
uniform bool uTransparentBackground;
uniform vec2 uOcclusionOffset;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

float getDepthTransparent(const in vec2 coords) {
    return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords)).x;
}

bool isBackground(const in float depth) {
    return depth > 0.999; // handle depth packing precision issues
}

int squaredOutlineScale = dOutlineScale * dOutlineScale;
float getOutline(const in vec2 coords, const in float opaqueDepth, const in float transparentDepth, out float closestTexel, out float isTransparent) {
    vec2 invTexSize = 1.0 / uTexSize;

    float outline = 1.0;
    closestTexel = 1.0;
    isTransparent = 0.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > squaredOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOutline = sampleOutlineCombined.r;
            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);

            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel) {
                outline = 0.0;
                closestTexel = sampleOutlineDepth;
                isTransparent = sampleOutlineCombined.a;
            }
        }
    }
    return isTransparent == 0.0 ? outline : (closestTexel > opaqueDepth && closestTexel < transparentDepth) ? 1.0 : outline;
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

float getSsaoTransparent(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepthTransparent, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    float opaqueDepth = getDepthOpaque(coords);
    float transparentDepth = 1.0;
    #ifdef dBlendTransparency
        bool blendTransparency = true;
        vec4 transparentColor = texture2D(tTransparentColor, coords);

        #if defined(dOutlineEnable) || defined(dOcclusionEnable) && defined(dOcclusionIncludeTransparency)
            transparentDepth = getDepthTransparent(coords);
        #endif
    #endif

    #if defined(dOcclusionEnable) || defined(dShadowEnable)
        bool isOpaqueBackground = isBackground(opaqueDepth);
        float viewDist = abs(getViewZ(opaqueDepth));
        float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
    #endif

    #if defined(dOcclusionEnable)
        if (!isOpaqueBackground) {
            float occlusionFactor = getSsao(coords + uOcclusionOffset);

            if (!uTransparentBackground) {
                color.rgb = mix(mix(uOcclusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(uOcclusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
        #if defined(dBlendTransparency) && defined(dOcclusionIncludeTransparency)
            if (!isBackground(transparentDepth)) {
                float viewDist = abs(getViewZ(transparentDepth));
                float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
                float occlusionFactor = getSsaoTransparent(coords + uOcclusionOffset);
                transparentColor.rgb = mix(uOcclusionColor * (1.0 - fogFactor), transparentColor.rgb, occlusionFactor);
            }
        #endif
    #endif

    #ifdef dShadowEnable
        if (!isOpaqueBackground) {
            vec4 shadow = texture2D(tShadows, coords);
            if (!uTransparentBackground) {
                color.rgb = mix(mix(vec3(0), uFogColor, fogFactor), color.rgb, shadow.a);
            } else {
                color.rgb = mix(vec3(0) * (1.0 - fogFactor), color.rgb, shadow.a);
            }
        }
    #endif

    // outline needs to be handled after occlusion and shadow to keep them clean
    #ifdef dOutlineEnable
        float closestTexel;
        float isTransparentOutline;
        float outline = getOutline(coords, opaqueDepth, transparentDepth, closestTexel, isTransparentOutline);
        if (outline == 0.0) {
            float viewDist = abs(getViewZ(closestTexel));
            float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {
                    color.rgb = mix(uOutlineColor, uFogColor, fogFactor);
            } else {
                color.a = 1.0 - fogFactor;
                color.rgb = mix(uOutlineColor, vec3(0.0), fogFactor);
            }
            #ifdef dBlendTransparency
                if (isTransparentOutline == 1.0 || transparentDepth > closestTexel) {
                    blendTransparency = false;
                }
            #endif
        }
    #endif

    #ifdef dBlendTransparency
        if (blendTransparency) {
            float alpha = transparentColor.a;
            if (alpha != 0.0) {
                // blending
                color = transparentColor + color * (1.0 - alpha);
            }
        }
    #endif

    gl_FragColor = color;
}
`;var hSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += uTexSizeInv * vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec2 inverseScreenSize = uTexSizeInv;

    vec4 colorCenter = texture2D(tColor, coords);

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -1.0);
    float lumaUp = sampleLuma(coords, 0.0, 1.0);
    float lumaLeft = sampleLuma(coords, -1.0, 0.0);
    float lumaRight = sampleLuma(coords, 1.0, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);
    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);
    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);
    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}
`;var gSe={edgeThresholdMin:C.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:C.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:C.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:C.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})},gL=class{constructor(t,r){this.webgl=t;this.renderable=ptt(t,r)}updateState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:a,height:s}=t;n.viewport(o,i,a,s),n.scissor(o,i,a,s),n.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT)}setSize(t,r){P.update(this.renderable.values.uTexSizeInv,Ie.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))}update(t,r){let{values:n}=this.renderable,{edgeThresholdMin:o,edgeThresholdMax:i,iterations:a,subpixelQuality:s}=r,l=!1;n.tColor.ref.value!==t&&(P.update(this.renderable.values.tColor,t),l=!0),n.dEdgeThresholdMin.ref.value!==o&&(l=!0),P.updateIfChanged(n.dEdgeThresholdMin,o),n.dEdgeThresholdMax.ref.value!==i&&(l=!0),P.updateIfChanged(n.dEdgeThresholdMax,i),n.dIterations.ref.value!==a&&(l=!0),P.updateIfChanged(n.dIterations,a),n.dSubpixelQuality.ref.value!==s&&(l=!0),P.updateIfChanged(n.dSubpixelQuality,s),l&&this.renderable.update()}render(t,r){He&&this.webgl.timer.mark("FxaaPass.render"),r?r.bind():this.webgl.bindDrawingBuffer(),this.updateState(t),this.renderable.render(),He&&this.webgl.timer.markEnd("FxaaPass.render")}},mtt={...un,tColor:pt("texture","rgba","ubyte","linear"),uTexSizeInv:he("v2"),dEdgeThresholdMin:ct("number"),dEdgeThresholdMax:ct("number"),dIterations:ct("number"),dSubpixelQuality:ct("number")},dtt=Dr("fxaa",bn,hSe);function ptt(e,t){let r=t.getWidth(),n=t.getHeight(),o={...cn,tColor:P.create(t),uTexSizeInv:P.create(Ie.create(1/r,1/n)),dEdgeThresholdMin:P.create(.0312),dEdgeThresholdMax:P.create(.125),dIterations:P.create(12),dSubpixelQuality:P.create(.3)},i={...mtt},a=Wr(e,"triangles",dtt,i,o);return Xr(a,o)}var ySe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[2];

void SMAANeighborhoodBlendingVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAANeighborhoodBlendingVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`;var bSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tWeights;
uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[2];

vec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {
    // Fetch the blending weights for current pixel:
    vec4 a;
    a.xz = texture2D(blendTex, texCoord).xz;
    a.y = texture2D(blendTex, offset[1].zw).g;
    a.w = texture2D(blendTex, offset[1].xy).a;

    // Is there any blending weight with a value greater than 0.0?
    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {
        return texture2D(colorTex, texCoord, 0.0);
    } else {
        // Up to 4 lines can be crossing a pixel (one through each edge). We
        // favor blending by choosing the line with the maximum weight for each
        // direction:
        vec2 offset;
        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

        // Then we go in the direction that has the maximum weight:
        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical
            offset.y = 0.0;
        } else {
            offset.x = 0.0;
        }

        // Fetch the opposite color and lerp by hand:
        vec4 C = texture2D(colorTex, texCoord, 0.0);
        texCoord += sign(offset) * uTexSizeInv;
        vec4 Cop = texture2D(colorTex, texCoord, 0.0);
        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);

        // WebGL port note: Added gamma correction
        C.xyz = pow(C.xyz, vec3(2.2));
        Cop.xyz = pow(Cop.xyz, vec3(2.2));
        vec4 mixed = mix(C, Cop, s);
        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

        return mixed;
    }
}

void main() {
    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);
}
`;var xSe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

void SMAABlendingWeightCalculationVS(vec2 texCoord) {
    vPixCoord = texCoord / uTexSizeInv;

    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components

    // And these for the searches, they indicate the ends of the loops:
    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAABlendingWeightCalculationVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`;var CSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)

#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

uniform sampler2D tEdges;
uniform sampler2D tArea;
uniform sampler2D tSearch;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

#if __VERSION__ == 100
    vec2 round(vec2 x) {
        return sign(x) * floor(abs(x) + 0.5);
    }
#endif

float SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
    // Not required if searchTex accesses are set to point:
    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
    e.r = bias + e.r * scale;
    return 255.0 * texture2D(searchTex, e, 0.0).r;
}

float SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    /**
     * @PSEUDO_GATHER4
     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to
     * sample between edge, thus fetching four edges in a row.
     * Sampling with different offsets in each direction allows to disambiguate
     * which edges are active from the four fetched ones.
     */
    vec2 e = vec2(0.0, 1.0);

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D( edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    // We correct the previous (-0.25, -0.125) offset we applied:
    texCoord.x += 0.25 * uTexSizeInv.x;

    // The searches are bias by 1, so adjust the coords accordingly:
    texCoord.x += uTexSizeInv.x;

    // Disambiguate the length added by the last step:
    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step
    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

    return texCoord.x;
}

float SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 0.0, 1.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    texCoord.x -= 0.25 * uTexSizeInv.x;
    texCoord.x -= uTexSizeInv.x;
    texCoord.x -= 2.0 * uTexSizeInv.x;
    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

    return texCoord.x;
}

float SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

float SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

vec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
    // Rounding prevents precision errors of bilinear filtering:
    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;

    // We do a scale and bias for mapping to texel space:
    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);

    // Move to proper place, according to the subpixel offset:
    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

    return texture2D(areaTex, texCoord, 0.0).rg;
}

vec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {
    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);

    vec2 e = texture2D(edgesTex, texCoord).rg;

    if (e.g > 0.0) { // Edge at north
        vec2 d;

        // Find the distance to the left:
        vec2 coords;
        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );
        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)
        d.x = coords.x;

        // Now fetch the left crossing edges, two at a time using bilinear
        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
        // discern what value each edge has:
        float e1 = texture2D(edgesTex, coords, 0.0).r;

        // Find the distance to the right:
        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);
        d.y = coords.x;

        // We want the distances to be in pixel units (doing this here allow to
        // better interleave arithmetic and memory accesses):
        d = d / uTexSizeInv.x - pixCoord.x;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the right crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;

        // Ok, we know how this pattern looks like, now it is time for getting
        // the actual area:
        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));
    }

    if (e.r > 0.0) { // Edge at west
        vec2 d;

        // Find the distance to the top:
        vec2 coords;

        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );
        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;
        d.x = coords.y;

        // Fetch the top crossing edges:
        float e1 = texture2D(edgesTex, coords, 0.0).g;

        // Find the distance to the bottom:
        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);
        d.y = coords.y;

        // We want the distances to be in pixel units:
        d = d / uTexSizeInv.y - pixCoord.y;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the bottom crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;

        // Get the area for this direction:
        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));
    }

    return weights;
}

void main() {
    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));
}
`;var SSe=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];

void SMAAEdgeDetectionVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAAEdgeDetectionVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`;var vSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];

vec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);

    // Calculate color deltas:
    vec4 delta;
    vec3 C = texture2D(colorTex, texcoord).rgb;

    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;
    vec3 t = abs(C - Cleft);
    delta.x = max(max(t.r, t.g), t.b);

    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;
    t = abs(C - Ctop);
    delta.y = max(max(t.r, t.g), t.b);

    // We do the usual threshold:
    vec2 edges = step(threshold, delta.xy);

    // Then discard if there is no edge:
    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)
        discard;

    // Calculate right and bottom deltas:
    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;
    t = abs( C - Cright );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;
    t = abs(C - Cbottom);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the maximum delta in the direct neighborhood:
    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );

    // Calculate left-left and top-top deltas:
    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;
    t = abs( C - Cleftleft );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;
    t = abs(C - Ctoptop);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the final maximum delta:
    maxDelta = max(max(maxDelta, delta.z), delta.w);

    // Local contrast adaptation in action:
    edges.xy *= step(0.5 * maxDelta, delta.xy);

    return vec4(edges, 0.0, 0.0);
}

void main() {
    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);
}
`;var ISe={edgeThreshold:C.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:C.Numeric(16,{min:0,max:32,step:1})},yL=class{constructor(t,r){this.webgl=t;this._supported=!1;if(typeof HTMLImageElement>"u"){$t&&console.log('Missing "HTMLImageElement" required for "SMAA"');return}let n=r.getWidth(),o=r.getHeight();this.edgesTarget=t.createRenderTarget(n,o,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(n,o,!1,"uint8","linear"),this.edgesRenderable=gtt(t,r),this.weightsRenderable=xtt(t,this.edgesTarget.texture),this.blendRenderable=vtt(t,r,this.weightsTarget.texture),this._supported=!0}get supported(){return this._supported}updateState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:a,height:s}=t;n.viewport(o,i,a,s),n.scissor(o,i,a,s),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),P.update(this.edgesRenderable.values.uViewport,co.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),P.update(this.weightsRenderable.values.uViewport,co.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),P.update(this.blendRenderable.values.uViewport,co.toVec4(this.blendRenderable.values.uViewport.ref.value,t))}setSize(t,r){let n=this.edgesTarget.getWidth(),o=this.edgesTarget.getHeight();(t!==n||r!==o)&&(this.edgesTarget.setSize(t,r),this.weightsTarget.setSize(t,r),P.update(this.edgesRenderable.values.uTexSizeInv,Ie.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),P.update(this.weightsRenderable.values.uTexSizeInv,Ie.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),P.update(this.blendRenderable.values.uTexSizeInv,Ie.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/r)))}update(t,r){let n=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(P.update(this.edgesRenderable.values.tColor,t),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==r.edgeThreshold&&(P.update(this.edgesRenderable.values.dEdgeThreshold,r.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==r.maxSearchSteps&&(P.update(this.weightsRenderable.values.dMaxSearchSteps,r.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(P.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())}render(t,r){He&&this.webgl.timer.mark("SmaaPass.render"),this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),r?r.bind():this.webgl.bindDrawingBuffer(),this.updateState(t),this.blendRenderable.render(),He&&this.webgl.timer.markEnd("SmaaPass.render")}},ftt={...un,tColor:pt("texture","rgba","ubyte","linear"),uTexSizeInv:he("v2"),uViewport:he("v4"),dEdgeThreshold:ct("number")},htt=Dr("smaa-edges",SSe,vSe);function gtt(e,t){let r=t.getWidth(),n=t.getHeight(),o={...cn,tColor:P.create(t),uTexSizeInv:P.create(Ie.create(1/r,1/n)),uViewport:P.create(Ut()),dEdgeThreshold:P.create(.1)},i={...ftt},a=Wr(e,"triangles",htt,i,o);return Xr(a,o)}var ytt={...un,tEdges:pt("texture","rgba","ubyte","linear"),tArea:pt("texture","rgb","ubyte","linear"),tSearch:pt("texture","rgba","ubyte","nearest"),uTexSizeInv:he("v2"),uViewport:he("v4"),dMaxSearchSteps:ct("number")},btt=Dr("smaa-weights",xSe,CSe);function xtt(e,t){let r=t.getWidth(),n=t.getHeight(),o=e.resources.texture("image-uint8","rgb","ubyte","linear"),i=e.resources.texture("image-uint8","rgba","ubyte","nearest"),a={...cn,tEdges:P.create(t),tArea:P.create(o),tSearch:P.create(i),uTexSizeInv:P.create(Ie.create(1/r,1/n)),uViewport:P.create(Ut()),dMaxSearchSteps:P.create(16)};R6(Itt(),a.tArea,o),R6(Att(),a.tSearch,i);let s={...ytt},l=Wr(e,"triangles",btt,s,a);return Xr(l,a)}var Ctt={...un,tColor:pt("texture","rgba","ubyte","linear"),tWeights:pt("texture","rgba","ubyte","linear"),uTexSizeInv:he("v2"),uViewport:he("v4")},Stt=Dr("smaa-blend",ySe,bSe);function vtt(e,t,r){let n=t.getWidth(),o=t.getHeight(),i={...cn,tColor:P.create(t),tWeights:P.create(r),uTexSizeInv:P.create(Ie.create(1/n,1/o)),uViewport:P.create(Ut())},a={...Ctt},s=Wr(e,"triangles",Stt,a,i);return Xr(s,i)}function Itt(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}function Att(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}var ASe=`
precision mediump float;
precision mediump samplerCube;
precision mediump sampler2D;

#if defined(dVariant_skybox)
    uniform samplerCube tSkybox;
    uniform mat4 uViewDirectionProjectionInverse;
    uniform float uBlur;
    uniform float uOpacity;
    uniform float uSaturation;
    uniform float uLightness;
    uniform mat3 uRotation;
#elif defined(dVariant_image)
    uniform sampler2D tImage;
    uniform vec2 uImageScale;
    uniform vec2 uImageOffset;
    uniform float uBlur;
    uniform float uOpacity;
    uniform float uSaturation;
    uniform float uLightness;
#elif defined(dVariant_horizontalGradient) || defined(dVariant_radialGradient)
    uniform vec3 uGradientColorA;
    uniform vec3 uGradientColorB;
    uniform float uGradientRatio;
#endif

uniform vec2 uTexSize;
uniform vec4 uViewport;
uniform bool uViewportAdjusted;
varying vec4 vPosition;

// TODO: add as general pp option to remove banding?
// Iestyn's RGB dither from http://alex.vlachos.com/graphics/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf
vec3 ScreenSpaceDither(vec2 vScreenPos) {
    vec3 vDither = vec3(dot(vec2(171.0, 231.0), vScreenPos.xy));
    vDither.rgb = fract(vDither.rgb / vec3(103.0, 71.0, 97.0));
    return vDither.rgb / 255.0;
}

vec3 saturateColor(vec3 c, float amount) {
    // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance
    const vec3 W = vec3(0.2125, 0.7154, 0.0721);
    vec3 intensity = vec3(dot(c, W));
    return mix(intensity, c, 1.0 + amount);
}

vec3 lightenColor(vec3 c, float amount) {
    return c + amount;
}

void main() {
    #if defined(dVariant_skybox)
        vec4 t = uViewDirectionProjectionInverse * vPosition;
        #ifdef enabledShaderTextureLod
            gl_FragColor = textureCubeLodEXT(tSkybox, uRotation * normalize(t.xyz / t.w), uBlur * 8.0);
        #else
            gl_FragColor = textureCube(tSkybox, uRotation * normalize(t.xyz / t.w));
        #endif
        gl_FragColor.a = uOpacity;
        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);
    #elif defined(dVariant_image)
        vec2 coords;
        if (uViewportAdjusted) {
            coords = ((gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uImageScale) + uImageOffset;
        } else {
            coords = (gl_FragCoord.xy / uImageScale) + uImageOffset;
        }
        #ifdef enabledShaderTextureLod
            gl_FragColor = texture2DLodEXT(tImage, vec2(coords.x, 1.0 - coords.y), uBlur * 8.0);
        #else
            gl_FragColor = texture2D(tImage, vec2(coords.x, 1.0 - coords.y));
        #endif
        gl_FragColor.a = uOpacity;
        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);
    #elif defined(dVariant_horizontalGradient)
        float d;
        if (uViewportAdjusted) {
            d = ((gl_FragCoord.y - uViewport.y) * (uTexSize.y / uViewport.w) / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);
        } else {
            d = (gl_FragCoord.y / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);
        }
        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, clamp(d, 0.0, 1.0)), 1.0);
        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);
    #elif defined(dVariant_radialGradient)
        float d;
        if (uViewportAdjusted) {
            d = distance(vec2(0.5), (gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uTexSize) + uGradientRatio - 0.5;
        } else {
            d = distance(vec2(0.5), gl_FragCoord.xy / uTexSize) + uGradientRatio - 0.5;
        }
        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, 1.0 - clamp(d, 0.0, 1.0)), 1.0);
        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);
    #endif
}
`;var TSe=`
precision mediump float;

attribute vec2 aPosition;

varying vec4 vPosition;

void main() {
    vPosition = vec4(aPosition, 1.0, 1.0);
    gl_Position = vec4(aPosition, 1.0, 1.0);
}
`;function K_(){return K_.zero()}(d=>{function e(){let p=[.1,0,0];return p[0]=0,p}d.zero=e;function t(p,h,f){let y=e();return y[0]=p,y[1]=h,y[2]=f,y}d.create=t;function r(p,h,f,y){return p[0]=h,p[0]=f,p[0]=y,p}d.set=r;function n(p){let h=e();return h[0]=p[0],h[1]=p[1],h[2]=p[2],h}d.clone=n;function o(p,h){return p[0]=h[0],p[1]=h[1],p[2]=h[2],p}d.copy=o;function i(p,h,f){let y=h[0],g=h[4],x=h[8],S=h[1],I=h[5],v=h[9],A=h[2],_=h[6],T=h[10];switch(f){case"XYZ":p[1]=Math.asin(Br(x,-1,1)),Math.abs(x)<.9999999?(p[0]=Math.atan2(-v,T),p[2]=Math.atan2(-g,y)):(p[0]=Math.atan2(_,I),p[2]=0);break;case"YXZ":p[0]=Math.asin(-Br(v,-1,1)),Math.abs(v)<.9999999?(p[1]=Math.atan2(x,T),p[2]=Math.atan2(S,I)):(p[1]=Math.atan2(-A,y),p[2]=0);break;case"ZXY":p[0]=Math.asin(Br(_,-1,1)),Math.abs(_)<.9999999?(p[1]=Math.atan2(-A,T),p[2]=Math.atan2(-g,I)):(p[1]=0,p[2]=Math.atan2(S,y));break;case"ZYX":p[1]=Math.asin(-Br(A,-1,1)),Math.abs(A)<.9999999?(p[0]=Math.atan2(_,T),p[2]=Math.atan2(S,y)):(p[0]=0,p[2]=Math.atan2(-g,I));break;case"YZX":p[2]=Math.asin(Br(S,-1,1)),Math.abs(S)<.9999999?(p[0]=Math.atan2(-v,I),p[1]=Math.atan2(-A,y)):(p[0]=0,p[1]=Math.atan2(x,T));break;case"XZY":p[2]=Math.asin(-Br(g,-1,1)),Math.abs(g)<.9999999?(p[0]=Math.atan2(_,I),p[1]=Math.atan2(x,y)):(p[0]=Math.atan2(-v,T),p[1]=0);break;default:Rr(f)}return p}d.fromMat4=i;let a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function s(p,h,f){return Z.fromQuat(a,h),i(p,a,f)}d.fromQuat=s;function l(p,h){return r(p,h[0],h[1],h[2])}d.fromVec3=l;function u(p,h){return p[0]===h[0]&&p[1]===h[1]&&p[2]===h[2]}d.exactEquals=u;function c(p,h,f){return p[0]=h[f+0],p[1]=h[f+1],p[2]=h[f+2],p}d.fromArray=c;function m(p,h,f){return h[f+0]=p[0],h[f+1]=p[1],h[f+2]=p[2],h}d.toArray=m})(K_||={});var wSe={opacity:C.Numeric(1,{min:0,max:1,step:.01}),saturation:C.Numeric(0,{min:-1,max:1,step:.01}),lightness:C.Numeric(0,{min:-1,max:1,step:.01})},Ttt={faces:C.MappedStatic("urls",{urls:C.Group({nx:C.Text("",{label:"Negative X / Left"}),ny:C.Text("",{label:"Negative Y / Bottom"}),nz:C.Text("",{label:"Negative Z / Back"}),px:C.Text("",{label:"Positive X / Right"}),py:C.Text("",{label:"Positive Y / Top"}),pz:C.Text("",{label:"Positive Z / Front"})},{isExpanded:!0,label:"URLs"}),files:C.Group({nx:C.File({label:"Negative X / Left",accept:"image/*"}),ny:C.File({label:"Negative Y / Bottom",accept:"image/*"}),nz:C.File({label:"Negative Z / Back",accept:"image/*"}),px:C.File({label:"Positive X / Right",accept:"image/*"}),py:C.File({label:"Positive Y / Top",accept:"image/*"}),pz:C.File({label:"Positive Z / Front",accept:"image/*"})},{isExpanded:!0,label:"Files"})}),blur:C.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or when "EXT_shader_texture_lod" is available.'}),rotation:C.Group({x:C.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0}),y:C.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0}),z:C.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0})}),...wSe},Ptt={source:C.MappedStatic("url",{url:C.Text(""),file:C.File({accept:"image/*"})}),blur:C.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or with power-of-two images and when "EXT_shader_texture_lod" is available.'}),...wSe,coverage:C.Select("viewport",C.arrayToOptions(["viewport","canvas"]))},_tt={topColor:C.Color(14540253),bottomColor:C.Color(15658734),ratio:C.Numeric(.5,{min:0,max:1,step:.01}),coverage:C.Select("viewport",C.arrayToOptions(["viewport","canvas"]))},Rtt={centerColor:C.Color(14540253),edgeColor:C.Color(15658734),ratio:C.Numeric(.5,{min:0,max:1,step:.01}),coverage:C.Select("viewport",C.arrayToOptions(["viewport","canvas"]))},ESe={variant:C.MappedStatic("off",{off:C.EmptyGroup(),skybox:C.Group(Ttt,{isExpanded:!0}),image:C.Group(Ptt,{isExpanded:!0}),horizontalGradient:C.Group(_tt,{isExpanded:!0}),radialGradient:C.Group(Rtt,{isExpanded:!0})},{label:"Environment"})},bL=class{constructor(t,r,n,o){this.webgl=t;this.assetManager=r;this.camera=new mo;this.target=b();this.position=b();this.dir=b();this.bgColor=b();this.renderable=Vtt(t,n,o)}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;(t!==n||r!==o)&&P.update(this.renderable.values.uTexSize,Ie.set(this.renderable.values.uTexSize.ref.value,t,r))}clearSkybox(){this.skybox!==void 0&&(this.skybox.texture.destroy(),this.skybox.assets.forEach(t=>this.assetManager.release(t)),this.skybox=void 0)}updateSkybox(t,r,n){let o=this.skybox?.props.faces,i=r.faces.params;if(!i.nx||!i.ny||!i.nz||!i.px||!i.py||!i.pz){this.clearSkybox(),n?.(!1);return}if(!this.skybox||!o||!Ett(r.faces,this.skybox.props.faces)){this.clearSkybox();let{texture:u,assets:c}=Mtt(this.webgl,this.assetManager,r.faces,m=>{this.skybox&&(this.skybox.loaded=!m),n?.(!0)});this.skybox={texture:u,props:{...r},assets:c,loaded:!1},P.update(this.renderable.values.tSkybox,u),this.renderable.update()}else n?.(!1);if(!this.skybox)return;let a=t;t.state.mode==="orthographic"&&(this.camera.setState({...t.state,mode:"perspective"}),this.camera.update(),a=this.camera);let s=this.renderable.values.uViewDirectionProjectionInverse.ref.value;Z.isZero(t.headRotation)?(b.sub(this.dir,a.state.position,a.state.target),b.setMagnitude(this.dir,this.dir,.1),b.copy(this.position,this.dir),Z.lookAt(s,this.position,this.target,a.state.up)):Z.invert(s,t.headRotation),Z.mul(s,a.projection,s),Z.invert(s,s),P.update(this.renderable.values.uViewDirectionProjectionInverse,s);let l=this.renderable.values.uRotation.ref.value;Ot.fromEuler(l,K_.create(vr(r.rotation.x),vr(r.rotation.y),vr(r.rotation.z)),"XYZ"),P.update(this.renderable.values.uRotation,l),P.updateIfChanged(this.renderable.values.uBlur,r.blur),P.updateIfChanged(this.renderable.values.uOpacity,r.opacity),P.updateIfChanged(this.renderable.values.uSaturation,r.saturation),P.updateIfChanged(this.renderable.values.uLightness,r.lightness),P.updateIfChanged(this.renderable.values.dVariant,"skybox"),this.renderable.update()}clearImage(){this.image!==void 0&&(this.image.texture.destroy(),this.assetManager.release(this.image.asset),this.image=void 0)}updateImage(t,r){if(!t.source.params){this.clearImage(),r?.(!1);return}if(!this.image||!this.image.props.source.params||!Btt(t.source,this.image.props.source)){this.clearImage();let{texture:n,asset:o}=ktt(this.webgl,this.assetManager,t.source,i=>{this.image&&(this.image.loaded=!i),r?.(!0)});this.image={texture:n,props:{...t},asset:o,loaded:!1},P.update(this.renderable.values.tImage,n),this.renderable.update()}else r?.(!1);this.image&&(P.updateIfChanged(this.renderable.values.uBlur,t.blur),P.updateIfChanged(this.renderable.values.uOpacity,t.opacity),P.updateIfChanged(this.renderable.values.uSaturation,t.saturation),P.updateIfChanged(this.renderable.values.uLightness,t.lightness),P.updateIfChanged(this.renderable.values.uViewportAdjusted,t.coverage==="viewport"),P.updateIfChanged(this.renderable.values.dVariant,"image"),this.renderable.update())}updateImageScaling(){let t=this.renderable.values,[r,n]=t.uTexSize.ref.value,o=this.image?.texture.getWidth()||0,i=this.image?.texture.getHeight()||0,a=r/n,s=o/i;a<s?P.update(t.uImageScale,Ie.set(t.uImageScale.ref.value,o*n/i,n)):P.update(t.uImageScale,Ie.set(t.uImageScale.ref.value,r,i*r/o));let[l,u]=t.uImageScale.ref.value,c=l/u;c>a?P.update(t.uImageOffset,Ie.set(t.uImageOffset.ref.value,(1-a/c)/2,0)):P.update(t.uImageOffset,Ie.set(t.uImageOffset.ref.value,0,(1-c/a)/2))}updateGradient(t,r,n,o,i){P.update(this.renderable.values.uGradientColorA,Fe.toVec3Normalized(this.renderable.values.uGradientColorA.ref.value,t)),P.update(this.renderable.values.uGradientColorB,Fe.toVec3Normalized(this.renderable.values.uGradientColorB.ref.value,r)),P.updateIfChanged(this.renderable.values.uGradientRatio,n),P.updateIfChanged(this.renderable.values.uViewportAdjusted,i),P.updateIfChanged(this.renderable.values.dVariant,o),this.renderable.update()}update(t,r,n){if(r.variant.name==="off"){this.clearSkybox(),this.clearImage(),n?.(!1);return}else r.variant.name==="skybox"?(this.clearImage(),this.updateSkybox(t,r.variant.params,n)):r.variant.name==="image"?(this.clearSkybox(),this.updateImage(r.variant.params,n)):r.variant.name==="horizontalGradient"?(this.clearSkybox(),this.clearImage(),this.updateGradient(r.variant.params.topColor,r.variant.params.bottomColor,r.variant.params.ratio,r.variant.name,r.variant.params.coverage==="viewport"),n?.(!1)):r.variant.name==="radialGradient"&&(this.clearSkybox(),this.clearImage(),this.updateGradient(r.variant.params.centerColor,r.variant.params.edgeColor,r.variant.params.ratio,r.variant.name,r.variant.params.coverage==="viewport"),n?.(!1));let{x:o,y:i,width:a,height:s}=t.viewport;P.update(this.renderable.values.uViewport,Ut.set(this.renderable.values.uViewport.ref.value,o,i,a,s))}isEnabled(t){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||t.variant.name==="horizontalGradient"||t.variant.name==="radialGradient")}isReady(){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||this.renderable.values.dVariant.ref.value==="horizontalGradient"||this.renderable.values.dVariant.ref.value==="radialGradient")}clear(t,r,n){let{gl:o,state:i}=this.webgl;this.isEnabled(t)?(r?i.clearColor(0,0,0,0):(Fe.toVec3Normalized(this.bgColor,n),i.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],1)),o.clear(o.COLOR_BUFFER_BIT),i.enable(o.BLEND),i.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)):(i.clearColor(0,0,0,1),o.clear(o.COLOR_BUFFER_BIT))}render(t){!this.isEnabled(t)||!this.isReady()||(this.renderable.values.dVariant.ref.value==="image"&&this.updateImageScaling(),He&&this.webgl.timer.mark("BackgroundPass.render"),this.renderable.render(),He&&this.webgl.timer.markEnd("BackgroundPass.render"))}dispose(){this.clearSkybox(),this.clearImage()}},PSe="background-skybox";function Dtt(e,t){return t.name==="urls"?{nx:Zr.getUrlAsset(e,t.params.nx),ny:Zr.getUrlAsset(e,t.params.ny),nz:Zr.getUrlAsset(e,t.params.nz),px:Zr.getUrlAsset(e,t.params.px),py:Zr.getUrlAsset(e,t.params.py),pz:Zr.getUrlAsset(e,t.params.pz)}:{nx:t.params.nx,ny:t.params.ny,nz:t.params.nz,px:t.params.px,py:t.params.py,pz:t.params.pz}}function wtt(e,t){let r=n=>e.resolve(n,"binary").run().then(o=>new Blob([o.data]));return{nx:r(t.nx),ny:r(t.ny),nz:r(t.nz),px:r(t.px),py:r(t.py),pz:r(t.pz)}}function _Se(e){return e.name==="urls"?`${PSe}_${e.params.nx}|${e.params.ny}|${e.params.nz}|${e.params.px}|${e.params.py}|${e.params.pz}`:`${PSe}_${e.params.nx?.id}|${e.params.ny?.id}|${e.params.nz?.id}|${e.params.px?.id}|${e.params.py?.id}|${e.params.pz?.id}`}function Ett(e,t){return _Se(e)===_Se(t)}function Mtt(e,t,r,n){let o=Dtt(t,r),i=wtt(t,o),a=[o.nx,o.ny,o.nz,o.px,o.py,o.pz];return typeof HTMLImageElement>"u"?(console.error('Missing "HTMLImageElement" required for background skybox'),n?.(!0),{texture:Mo(),assets:a}):{texture:e.resources.cubeTexture(i,!0,n),assets:a}}var RSe="background-image";function DSe(e){return e.name==="url"?`${RSe}_${e.params}`:`${RSe}_${e.params?.id}`}function Btt(e,t){return DSe(e)===DSe(t)}function ktt(e,t,r,n){let o=r.name==="url"?Zr.getUrlAsset(t,r.params):r.params;if(typeof HTMLImageElement>"u")return console.error('Missing "HTMLImageElement" required for background image'),n?.(!0),{texture:Mo(),asset:o};let i=e.resources.texture("image-uint8","rgba","ubyte","linear"),a=new Image;return a.onload=()=>{i.load(a),(e.isWebGL2||Rb(a.width)&&Rb(a.height))&&i.mipmap(),n?.()},a.onerror=()=>{n?.(!0)},t.resolve(o,"binary").run().then(s=>{let l=new Blob([s.data]);a.src=URL.createObjectURL(l)}),{texture:i,asset:o}}var Ltt={drawCount:Vn("number"),instanceCount:Vn("number"),aPosition:Sn("float32",2,0),tSkybox:pt("texture","rgba","ubyte","linear"),tImage:pt("texture","rgba","ubyte","linear"),uImageScale:he("v2"),uImageOffset:he("v2"),uTexSize:he("v2"),uViewport:he("v4"),uViewportAdjusted:he("b"),uViewDirectionProjectionInverse:he("m4"),uGradientColorA:he("v3"),uGradientColorB:he("v3"),uGradientRatio:he("f"),uBlur:he("f"),uOpacity:he("f"),uSaturation:he("f"),uLightness:he("f"),uRotation:he("m3"),dVariant:ct("string",["skybox","image","verticalGradient","horizontalGradient","radialGradient"])},Ftt=Dr("background",TSe,ASe,{shaderTextureLod:"optional"});function Vtt(e,t,r){let n={drawCount:P.create(6),instanceCount:P.create(1),aPosition:P.create(d_),tSkybox:P.create(Mo()),tImage:P.create(Mo()),uImageScale:P.create(Ie()),uImageOffset:P.create(Ie()),uTexSize:P.create(Ie.create(t,r)),uViewport:P.create(Ut()),uViewportAdjusted:P.create(!0),uViewDirectionProjectionInverse:P.create(Z()),uGradientColorA:P.create(b()),uGradientColorB:P.create(b()),uGradientRatio:P.create(.5),uBlur:P.create(0),uOpacity:P.create(1),uSaturation:P.create(0),uLightness:P.create(0),uRotation:P.create(Ot.identity()),dVariant:P.create("skybox")},o={...Ltt},i=Wr(e,"triangles",Ftt,o,n);return Xr(i,n)}var MSe=`
precision mediump float;
precision mediump sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

uniform float uSharpness;

// adapted from https://www.shadertoy.com/view/stXSWB

/*
* FidelityFX Super Resolution scales up a low resolution
* image, while adding fine detail.
*
* MIT Open License
*
* https://gpuopen.com/fsr
*
* Left: FSR processed
* Right: Original texture, bilinear interpolation
*
* Mouse at top: Sharpness 0 stops (maximum)
* Mouse at bottom: Sharpness 2 stops (minimum)
*
* It works in two passes-
*   EASU upsamples the image with a clamped Lanczos kernel.
*   RCAS sharpens the image at the target resolution.
*
* I needed to make a few changes to improve readability and
* WebGL compatibility in an algorithm I don't fully understand.
* Expect bugs.
*
* Shader not currently running for WebGL1 targets (eg. mobile Safari)
*
* There is kind of no point to using FSR in Shadertoy, as it renders buffers
* at full target resolution. But this might be useful for WebGL based demos
* running smaller-than-target render buffers.
*
* For sharpening with a full resolution render buffer,
* FidelityFX CAS is a better option.
* https://www.shadertoy.com/view/ftsXzM
*
* For readability and compatibility, these optimisations have been removed:
*   * Fast approximate inverse and inversesqrt
*   * textureGather fetches (not WebGL compatible)
*   * Multiplying by reciprocal instead of division
*
* Apologies to AMD for the numerous slowdowns and errors I have introduced.
*
*/

/***** RCAS *****/
#define FSR_RCAS_LIMIT (0.25-(1.0/16.0))

// Input callback prototypes that need to be implemented by calling shader
vec4 FsrRcasLoadF(vec2 p);
//------------------------------------------------------------------------------------------------------------------------------
void FsrRcasCon(
    out float con,
    // The scale is {0.0 := maximum, to N>0, where N is the number of stops (halving) of the reduction of sharpness}.
    float sharpness
) {
    // Transform from stops to linear value.
    con = exp2(-sharpness);
}

vec3 FsrRcasF(
    vec2 ip, // Integer pixel position in output.
    float con
) {
    // Constant generated by RcasSetup().
    // Algorithm uses minimal 3x3 pixel neighborhood.
    //    b
    //  d e f
    //    h
    vec2 sp = vec2(ip);
    vec3 b = FsrRcasLoadF(sp + vec2( 0,-1)).rgb;
    vec3 d = FsrRcasLoadF(sp + vec2(-1, 0)).rgb;
    vec3 e = FsrRcasLoadF(sp).rgb;
    vec3 f = FsrRcasLoadF(sp + vec2( 1, 0)).rgb;
    vec3 h = FsrRcasLoadF(sp + vec2( 0, 1)).rgb;

    // Luma times 2.
    float bL = b.g + .5 * (b.b + b.r);
    float dL = d.g + .5 * (d.b + d.r);
    float eL = e.g + .5 * (e.b + e.r);
    float fL = f.g + .5 * (f.b + f.r);
    float hL = h.g + .5 * (h.b + h.r);

    // Noise detection.
    #ifdef dDenoise
        float nz = .25 * (bL + dL + fL + hL) - eL;
        nz=clamp(
            abs(nz)
            /(
                max(max(bL,dL),max(eL,max(fL,hL)))
                -min(min(bL,dL),min(eL,min(fL,hL)))
            ),
            0., 1.
        );
        nz=1.-.5*nz;
    #endif

    // Min and max of ring.
    vec3 mn4 = min(b, min(f, h));
    vec3 mx4 = max(b, max(f, h));

    // Immediate constants for peak range.
    vec2 peakC = vec2(1., -4.);

    // Limiters, these need to be high precision RCPs.
    vec3 hitMin = mn4 / (4. * mx4);
    vec3 hitMax = (peakC.x - mx4) / (4.* mn4 + peakC.y);
    vec3 lobeRGB = max(-hitMin, hitMax);
    float lobe = max(
        -FSR_RCAS_LIMIT,
        min(max(lobeRGB.r, max(lobeRGB.g, lobeRGB.b)), 0.)
    )*con;

    // Apply noise removal.
    #ifdef dDenoise
        lobe *= nz;
    #endif

    // Resolve, which needs the medium precision rcp approximation to avoid visible tonality changes.
    return (lobe * (b + d + h + f) + e) / (4. * lobe + 1.);
}


vec4 FsrRcasLoadF(vec2 p) {
    return texture2D(tColor, p * uTexSizeInv);
}

void main() {
    // Set up constants
    float con;
    FsrRcasCon(con, uSharpness);

    // Perform RCAS pass
    vec3 col = FsrRcasF(gl_FragCoord.xy, con);

    gl_FragColor = vec4(col, FsrRcasLoadF(gl_FragCoord.xy).a);
}
`;var BSe={sharpness:C.Numeric(.5,{min:0,max:1,step:.05}),denoise:C.Boolean(!0)},xL=class{constructor(t,r){this.webgl=t;this.renderable=Utt(t,r)}updateState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:a,height:s}=t;n.viewport(o,i,a,s),n.scissor(o,i,a,s),n.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT)}setSize(t,r){P.update(this.renderable.values.uTexSizeInv,Ie.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))}update(t,r){let{values:n}=this.renderable,{sharpness:o,denoise:i}=r,a=!1;n.tColor.ref.value!==t&&(P.update(this.renderable.values.tColor,t),a=!0),P.updateIfChanged(n.uSharpness,2-2*Math.pow(o,.25)),n.dDenoise.ref.value!==i&&(a=!0),P.updateIfChanged(n.dDenoise,i),a&&this.renderable.update()}render(t,r){He&&this.webgl.timer.mark("CasPass.render"),r?r.bind():this.webgl.bindDrawingBuffer(),this.updateState(t),this.renderable.render(),He&&this.webgl.timer.markEnd("CasPass.render")}},Ott={...un,tColor:pt("texture","rgba","ubyte","linear"),uTexSizeInv:he("v2"),uSharpness:he("f"),dDenoise:ct("boolean")},Gtt=Dr("cas",bn,MSe);function Utt(e,t){let r=t.getWidth(),n=t.getHeight(),o={...cn,tColor:P.create(t),uTexSizeInv:P.create(Ie.create(1/r,1/n)),uSharpness:P.create(.5),dDenoise:P.create(!0)},i={...Ott},a=Wr(e,"triangles",Gtt,i,o);return Xr(a,o)}var kSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tColor;
uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;

uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uBlurSpread;
uniform float uInFocus;
uniform float uPPM;

uniform float uNear; // Near plane
uniform float uFar;  // Far plane

uniform mat4 uInvProjection; // Inverse projection
uniform mat4 uProjection; // projection

uniform int uMode; // 0-planar, 1-spherical
uniform vec3 uCenter; // Center of focus sphere in view space

// Function to convert depth value from depth buffer to view space Z
float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

// Retrieve depth from opaque depth texture
float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

// Retrieve depth from transparent depth texture
float getDepthTransparent(const in vec2 coords) {
    return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords)).x;
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getDepth(const in vec2 coords) {
    return min(getDepthOpaque(coords), getDepthTransparent(coords));
}

float getCOC(vec2 uv) {
    float depth = getDepth(uv);
    float viewDist = getViewZ(depth);
    vec3 aposition = screenSpaceToViewSpace(vec3(uv.xy, depth), uInvProjection);
    float focusDist = length(aposition - uCenter);
    float coc = 0.0;  // Circle of Confusion
    if (uMode == 0) { // planar Depth of field
        coc = (abs(viewDist) - uInFocus) / uPPM;  //focus distance, focus range
    } else if(uMode == 1) { // spherical Depth of field
        coc = focusDist / uPPM ;
    }
    coc = clamp(coc, -1.0, 1.0);
    return coc;
}

// Simple box blur for blurring the image
vec3 getBlurredImage(vec2 coords) {
    vec4 blurColor = vec4(0);
    vec2 texelSize = vec2(1.0 / uTexSize.x, 1.0 / uTexSize.y);
    float count = 0.0;
    for (int x = 0; x < int(dBlurSize); x++) {
        for (int y = 0; y < int(dBlurSize); y++) {
            vec2 offset = vec2(float(x) - float(dBlurSize) / 2.0, float(y) - float(dBlurSize) / 2.0);
            vec2 uvPixel = coords.xy + offset * texelSize * uBlurSpread;
            float coc = getCOC(uvPixel);
            coc = smoothstep(0.0, 1.0, abs(coc));
            // mix blurColor with new color with weight coc
            blurColor.rgb = blurColor.rgb + texture2D(tColor, uvPixel).xyz * coc;
            count+=coc;
        }
    }
    blurColor = blurColor / count;
    return blurColor.rgb;
}

// simplification from https://catlikecoding.com/unity/tutorials/advanced-rendering/depth-of-field/
void main() {
    vec2 uv = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, uv);
    float depth = getDepth(uv);

    float viewDist = getViewZ(depth);

    vec3 aposition = screenSpaceToViewSpace(vec3(uv.xy, depth), uInvProjection);
    float focusDist = length(aposition - uCenter);
    vec3 blurColor = getBlurredImage(uv);

    float coc = getCOC(uv); // Circle of Confusion

    // for debugging the coc
    // color.rgb = (coc < 0.0) ? (1.0 - abs(coc)) * vec3(1.0,0.0,0.0) : vec3(0.0, 1.0 - coc, 0.0) ;//mix(color.rgb, blurColor.rgb, abs(coc));
    color.rgb = mix(color.rgb, blurColor, smoothstep(0.0, 1.0, abs(coc))); // Smooth blending based on CoC
    gl_FragColor = color;
}
`;var LSe={blurSize:C.Numeric(9,{min:1,max:32,step:1}),blurSpread:C.Numeric(1,{min:0,max:10,step:.1}),inFocus:C.Numeric(0,{min:-5e3,max:5e3,step:1},{description:"Distance from the scene center that will be in focus"}),PPM:C.Numeric(20,{min:0,max:5e3,step:.1},{description:"Size of the area that will be in focus"}),center:C.Select("camera-target",C.arrayToOptions(["scene-center","camera-target"])),mode:C.Select("plane",C.arrayToOptions(["plane","sphere"]))},Sf=class{constructor(t,r,n){this.webgl=t;this.target=t.createRenderTarget(r,n,!1);let o=Mo();this.renderable=Htt(t,o,o,o)}static isEnabled(t){return t.dof.name!=="off"}updateState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:a,height:s}=t;n.viewport(o,i,a,s),n.scissor(o,i,a,s),n.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT)}setSize(t,r){let n=this.target.texture.getWidth(),o=this.target.texture.getHeight();(t!==n||r!==o)&&(this.target.setSize(t,r),P.update(this.renderable.values.uTexSize,Ie.set(this.renderable.values.uTexSize.ref.value,t,r)))}update(t,r,n,o,i,a){let s=!1;this.renderable.values.tColor.ref.value!==r&&(P.update(this.renderable.values.tColor,r),s=!0),this.renderable.values.tDepthOpaque.ref.value!==n&&(P.update(this.renderable.values.tDepthOpaque,n),s=!0),this.renderable.values.tDepthTransparent.ref.value!==o&&(P.update(this.renderable.values.tDepthTransparent,o),s=!0);let l=t.state.mode==="orthographic"?1:0,u=this.renderable.values.uInvProjection.ref.value;Z.invert(u,t.projection);let[c,m]=this.renderable.values.uTexSize.ref.value,d=t.viewport;P.update(this.renderable.values.uProjection,t.projection),P.update(this.renderable.values.uInvProjection,u),P.update(this.renderable.values.uMode,i.mode==="sphere"?1:0),Ut.set(this.renderable.values.uBounds.ref.value,d.x/c,d.y/m,(d.x+d.width)/c,(d.y+d.height)/m),P.update(this.renderable.values.uBounds,this.renderable.values.uBounds.ref.value),P.updateIfChanged(this.renderable.values.uNear,t.near),P.updateIfChanged(this.renderable.values.uFar,t.far),P.updateIfChanged(this.renderable.values.dOrthographic,l);let p=Math.round(i.blurSize*this.webgl.pixelRatio);this.renderable.values.dBlurSize.ref.value!==p&&(P.update(this.renderable.values.dBlurSize,p),s=!0);let h=i.center==="scene-center"?a.center:t.state.target,y=b.distance(t.state.position,h)+i.inFocus;P.updateIfChanged(this.renderable.values.uInFocus,y);let g=this.renderable.values.uCenter.ref.value;b.transformMat4(g,h,t.view),P.update(this.renderable.values.uCenter,g),P.updateIfChanged(this.renderable.values.uBlurSpread,i.blurSpread),P.updateIfChanged(this.renderable.values.uPPM,i.PPM),s&&this.renderable.update()}render(t,r){He&&this.webgl.timer.mark("DofPass.render"),r?r.bind():this.webgl.bindDrawingBuffer(),this.updateState(t),this.renderable.render(),He&&this.webgl.timer.markEnd("DofPass.render")}},Ntt={...un,tDepthOpaque:pt("texture","rgba","ubyte","nearest"),tDepthTransparent:pt("texture","rgba","ubyte","nearest"),tColor:pt("texture","rgba","ubyte","nearest"),uTexSize:he("v2"),uProjection:he("m4"),uInvProjection:he("m4"),uBounds:he("v4"),uCenter:he("v3"),uMode:he("i"),dOrthographic:ct("number"),uNear:he("f"),uFar:he("f"),dBlurSize:ct("number"),uBlurSpread:he("f"),uInFocus:he("f"),uPPM:he("f")},ztt=Dr("dof",bn,kSe);function Htt(e,t,r,n){let o=t.getWidth(),i=t.getHeight(),a={...cn,tDepthOpaque:P.create(r),tDepthTransparent:P.create(n),tColor:P.create(t),uTexSize:P.create(Ie.create(o,i)),uProjection:P.create(Z.identity()),uInvProjection:P.create(Z.identity()),uBounds:P.create(Ut()),uCenter:P.create(b()),uMode:P.create(0),dOrthographic:P.create(0),uNear:P.create(1),uFar:P.create(1e4),dBlurSize:P.create(5),uBlurSpread:P.create(300),uInFocus:P.create(20),uPPM:P.create(20)},s={...Ntt},l=Wr(e,"triangles",ztt,s,a);return Xr(l,a)}var FSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform vec2 uTexSizeInv;

uniform sampler2D tBlur1;
uniform sampler2D tBlur2;
uniform sampler2D tBlur3;
uniform sampler2D tBlur4;
uniform sampler2D tBlur5;
uniform float uBloomStrength;
uniform float uBloomRadius;
uniform float uBloomFactors[5];
uniform vec3 uBloomTints[5];

float lerpBloomFactor(const in float factor) {
    float mirrorFactor = 1.2 - factor;
    return mix(factor, mirrorFactor, uBloomRadius);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;

    gl_FragColor = uBloomStrength * (
        lerpBloomFactor(uBloomFactors[0]) * vec4(uBloomTints[0], 1.0) * texture2D(tBlur1, coords) +
        lerpBloomFactor(uBloomFactors[1]) * vec4(uBloomTints[1], 1.0) * texture2D(tBlur2, coords) +
        lerpBloomFactor(uBloomFactors[2]) * vec4(uBloomTints[2], 1.0) * texture2D(tBlur3, coords) +
        lerpBloomFactor(uBloomFactors[3]) * vec4(uBloomTints[3], 1.0) * texture2D(tBlur4, coords) +
        lerpBloomFactor(uBloomFactors[4]) * vec4(uBloomTints[4], 1.0) * texture2D(tBlur5, coords)
    );
}
`;var VSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform sampler2D tEmissive;
uniform sampler2D tDepth;
uniform vec2 uTexSizeInv;

uniform vec3 uDefaultColor;
uniform float uDefaultOpacity;
uniform float uLuminosityThreshold;
uniform float uSmoothWidth;

#include common

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 texel = texture2D(tColor, coords);
    float emissive = texture2D(tEmissive, coords).a;
    float depth = getDepth(coords);

    if (isBackground(depth)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
    }

    vec4 outputColor = vec4(uDefaultColor.rgb, uDefaultOpacity);

    #if defined(dMode_luminosity)
        vec3 luma = vec3(0.299, 0.587, 0.114);
        float v = dot(texel.xyz, luma);
        float alpha = smoothstep(uLuminosityThreshold, uLuminosityThreshold + uSmoothWidth, v);

        gl_FragColor = mix(outputColor, texel, alpha);
    #elif defined(dMode_emissive)
        gl_FragColor = mix(outputColor, texel, emissive);
    #endif
}
`;var OSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInput;
uniform vec2 uTexSizeInv;

uniform vec2 uDirection;
uniform float uGaussianCoefficients[dKernelRadius];

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    float weightSum = uGaussianCoefficients[0];
    vec4 diffuseSum = texture2D(tInput, coords) * weightSum;

    for(int i = 1; i < dKernelRadius; ++i) {
        float x = float(i);
        float w = uGaussianCoefficients[i];
        vec2 offset = uDirection * uTexSizeInv * x;
        vec4 sample1 = texture2D(tInput, coords + offset);
        vec4 sample2 = texture2D(tInput, coords - offset);
        diffuseSum += (sample1 + sample2) * w;
        weightSum += 2.0 * w;
    }

    gl_FragColor = diffuseSum / weightSum;
}
`;var b8=5,GSe={strength:C.Numeric(1,{min:0,max:3,step:.1}),radius:C.Numeric(0,{min:0,max:1,step:.01}),threshold:C.Numeric(0,{min:0,max:1,step:.01},{description:"Luminosity threshold",hideIf:e=>e.mode==="emissive"}),mode:C.Select("emissive",[["luminosity","Luminosity"],["emissive","Emissive"]])},CL=class{constructor(t,r,n){this.webgl=t;this.horizontalBlurTargets=[];this.verticalBlurTargets=[];this.emissiveTarget=t.createRenderTarget(r,n,!0,"uint8","linear","rgba"),this.luminosityTarget=t.createRenderTarget(r,n,!1,"uint8","linear"),this.compositeTarget=t.createRenderTarget(r,n,!1,"uint8","linear");let o=Math.round(r/2),i=Math.round(n/2);for(let s=0;s<b8;++s)this.horizontalBlurTargets[s]=t.createRenderTarget(o,i,!1,"uint8","linear"),this.verticalBlurTargets[s]=t.createRenderTarget(o,i,!1,"uint8","linear"),o=Math.round(o/2),i=Math.round(i/2);let a=Mo();this.luminosityRenderable=Xtt(t,a,a,a),this.blurRenderable=$tt(t,a),this.compositeRenderable=rrt(t,r,n,this.verticalBlurTargets[0].texture,this.verticalBlurTargets[1].texture,this.verticalBlurTargets[2].texture,this.verticalBlurTargets[3].texture,this.verticalBlurTargets[4].texture),this.copyRenderable=mm(t,this.compositeTarget.texture)}static isEnabled(t){return t.bloom.name==="on"}setSize(t,r){let n=this.luminosityTarget.getWidth(),o=this.luminosityTarget.getHeight();if(t!==n||r!==o){this.emissiveTarget.setSize(t,r),this.luminosityTarget.setSize(t,r),this.compositeTarget.setSize(t,r);let i=Math.round(t/2),a=Math.round(r/2);for(let s=0;s<b8;++s)this.horizontalBlurTargets[s].setSize(i,a),this.verticalBlurTargets[s].setSize(i,a),i=Math.round(i/2),a=Math.round(a/2);P.update(this.luminosityRenderable.values.uTexSizeInv,Ie.set(this.compositeRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),P.update(this.compositeRenderable.values.uTexSizeInv,Ie.set(this.compositeRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),P.update(this.copyRenderable.values.uTexSize,Ie.set(this.copyRenderable.values.uTexSize.ref.value,t,r))}}update(t,r,n,o){let i=!1;this.luminosityRenderable.values.tColor.ref.value!==t&&(P.update(this.luminosityRenderable.values.tColor,t),i=!0),this.luminosityRenderable.values.tEmissive.ref.value!==r&&(P.update(this.luminosityRenderable.values.tEmissive,r),i=!0),this.luminosityRenderable.values.tDepth.ref.value!==n&&(P.update(this.luminosityRenderable.values.tDepth,n),i=!0),this.luminosityRenderable.values.dMode.ref.value!==o.mode&&(P.update(this.luminosityRenderable.values.dMode,o.mode),i=!0),P.updateIfChanged(this.luminosityRenderable.values.uLuminosityThreshold,o.threshold),i&&this.luminosityRenderable.update();let a=!1;this.blurRenderable.values.tInput.ref.value!==t&&(P.update(this.blurRenderable.values.tInput,t),a=!0),a&&this.blurRenderable.update(),P.update(this.compositeRenderable.values.uBloomRadius,o.radius),P.update(this.compositeRenderable.values.uBloomStrength,o.strength)}render(t,r){He&&this.webgl.timer.mark("BloomPass.render");let{gl:n,state:o}=this.webgl,{x:i,y:a,width:s,height:l}=t;o.viewport(i,a,s,l),o.scissor(i,a,s,l),o.enable(n.SCISSOR_TEST),o.disable(n.BLEND),o.disable(n.DEPTH_TEST),o.depthMask(!1),this.luminosityTarget.bind(),this.luminosityRenderable.render();for(let u=0;u<b8;++u){let c=this.horizontalBlurTargets[u].getWidth(),m=this.horizontalBlurTargets[u].getHeight();o.viewport(0,0,c,m),o.scissor(0,0,c,m),P.update(this.blurRenderable.values.dKernelRadius,x8[u]),P.update(this.blurRenderable.values.uGaussianCoefficients,Ztt(x8[u])),P.update(this.blurRenderable.values.uTexSizeInv,Ie.set(this.blurRenderable.values.uTexSizeInv.ref.value,1/c,1/m)),this.horizontalBlurTargets[u].bind(),P.update(this.blurRenderable.values.tInput,u===0?this.luminosityTarget.texture:this.verticalBlurTargets[u-1].texture),P.update(this.blurRenderable.values.uDirection,qtt),this.blurRenderable.update(),this.blurRenderable.render(),this.verticalBlurTargets[u].bind(),P.update(this.blurRenderable.values.tInput,this.horizontalBlurTargets[u].texture),P.update(this.blurRenderable.values.uDirection,Ytt),this.blurRenderable.update(),this.blurRenderable.render()}o.viewport(i,a,s,l),o.scissor(i,a,s,l),this.compositeTarget.bind(),this.compositeRenderable.update(),this.compositeRenderable.render(),r?r.bind():this.webgl.bindDrawingBuffer(),o.enable(n.BLEND),o.blendFunc(n.ONE,n.ONE),this.copyRenderable.render(),He&&this.webgl.timer.markEnd("BloomPass.render")}},jtt={...un,tColor:pt("texture","rgba","ubyte","linear"),tEmissive:pt("texture","rgba","ubyte","linear"),tDepth:pt("texture","rgba","ubyte","nearest"),uTexSizeInv:he("v2"),uDefaultColor:he("v3"),uDefaultOpacity:he("f"),uLuminosityThreshold:he("f"),uSmoothWidth:he("f"),dMode:ct("string",["luminosity","emissive"])},Wtt=Dr("Bloom Luminosity",bn,VSe);function Xtt(e,t,r,n){let o=t.getWidth(),i=t.getHeight(),a={...cn,tColor:P.create(t),tEmissive:P.create(r),tDepth:P.create(n),uTexSizeInv:P.create(Ie.create(1/o,1/i)),uDefaultColor:P.create(b()),uDefaultOpacity:P.create(0),uLuminosityThreshold:P.create(0),uSmoothWidth:P.create(1),dMode:P.create("emissive")},s={...jtt},l=Wr(e,"triangles",Wtt,s,a);return Xr(l,a)}function Qtt(e){let t=[];for(let r=0;r<e;++r)t.push(.39894*Math.exp(-.5*r*r/(e*e))/e);return t}var Ztt=af(Qtt),x8=[3,5,7,9,11],qtt=Ie.create(1,0),Ytt=Ie.create(0,1),Ktt={...un,tInput:pt("texture","rgba","ubyte","linear"),uTexSizeInv:he("v2"),uDirection:he("v2"),uGaussianCoefficients:he("f[]"),dKernelRadius:ct("number")},Jtt=Dr("Bloom Blur",bn,OSe);function $tt(e,t){let r=t.getWidth(),n=t.getHeight(),o={...cn,tInput:P.create(t),uTexSizeInv:P.create(Ie.create(1/r,1/n)),uDirection:P.create(Ie()),uGaussianCoefficients:P.create([]),dKernelRadius:P.create(x8[0])},i={...Ktt},a=Wr(e,"triangles",Jtt,i,o);return Xr(a,o)}var ert={...un,tBlur1:pt("texture","rgba","ubyte","linear"),tBlur2:pt("texture","rgba","ubyte","linear"),tBlur3:pt("texture","rgba","ubyte","linear"),tBlur4:pt("texture","rgba","ubyte","linear"),tBlur5:pt("texture","rgba","ubyte","linear"),uTexSizeInv:he("v2"),uBloomStrength:he("f"),uBloomRadius:he("f"),uBloomFactors:he("f[]"),uBloomTints:he("v3[]")},trt=Dr("Bloom Composite",bn,FSe);function rrt(e,t,r,n,o,i,a,s){let l={...cn,uTexSizeInv:P.create(Ie.create(t,r)),tBlur1:P.create(n),tBlur2:P.create(o),tBlur3:P.create(i),tBlur4:P.create(a),tBlur5:P.create(s),uBloomStrength:P.create(1),uBloomRadius:P.create(0),uBloomFactors:P.create([1,.8,.6,.4,.2]),uBloomTints:P.create(new Array(15).fill(1))},u={...ert},c=Wr(e,"triangles",trt,u,l);return Xr(c,l)}var USe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform mat4 uInvProjection;

uniform float uOutlineThreshold;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

float getDepthTransparent(const in vec2 coords) {
    #ifdef dTransparentOutline
        return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords)).x;
    #else
        return 1.0;
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getPixelSize(const in vec2 coords, const in float depth) {
    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);
    return distance(viewPos0, viewPos1);
}

void main(void) {
    float backgroundViewZ = 2.0 * uFar;

    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepthOpaque = getDepthOpaque(coords);
    float selfViewZOpaque = isBackground(selfDepthOpaque) ? backgroundViewZ : getViewZ(selfDepthOpaque);
    float pixelSizeOpaque = getPixelSize(coords, selfDepthOpaque) * uOutlineThreshold;

    float selfDepthTransparent = getDepthTransparent(coords);
    float selfViewZTransparent = isBackground(selfDepthTransparent) ? backgroundViewZ : getViewZ(selfDepthTransparent);
    float pixelSizeTransparent = getPixelSize(coords, selfDepthTransparent) * uOutlineThreshold;

    float outline = 1.0;
    float bestDepth = 1.0;
    float transparentFlag = 0.0;

    for (int y = -1; y <= 1; y++) {
        for (int x = -1; x <= 1; x++) {
            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            float sampleDepthOpaque = getDepthOpaque(sampleCoords);
            float sampleDepthTransparent = getDepthTransparent(sampleCoords);

            float sampleViewZOpaque = isBackground(sampleDepthOpaque) ? backgroundViewZ : getViewZ(sampleDepthOpaque);
            if (abs(selfViewZOpaque - sampleViewZOpaque) > pixelSizeOpaque && selfDepthOpaque > sampleDepthOpaque && sampleDepthOpaque <= bestDepth) {
                outline = 0.0;
                bestDepth = sampleDepthOpaque;
            }

            if (sampleDepthTransparent < sampleDepthOpaque) {
                float sampleViewZTransparent = isBackground(sampleDepthTransparent) ? backgroundViewZ : getViewZ(sampleDepthTransparent);
                if (abs(selfViewZTransparent - sampleViewZTransparent) > pixelSizeTransparent && selfDepthTransparent > sampleDepthTransparent && sampleDepthTransparent <= bestDepth) {
                    outline = 0.0;
                    bestDepth = sampleDepthTransparent;
                    transparentFlag = 1.0;
                }
            }
        }
    }

    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), transparentFlag);
}
`;var SL={scale:C.Numeric(1,{min:1,max:5,step:1}),threshold:C.Numeric(.33,{min:.01,max:1,step:.01}),color:C.Color(0),includeTransparent:C.Boolean(!0,{description:"Whether to show outline for transparent objects"})},Qx=class{constructor(t,r,n,o,i){this.webgl=t;this.target=t.createRenderTarget(r,n,!1),this.renderable=ort(t,i,o,!0)}static isEnabled(t){return t.outline.name!=="off"}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;(t!==n||r!==o)&&(this.target.setSize(t,r),P.update(this.renderable.values.uTexSize,Ie.set(this.renderable.values.uTexSize.ref.value,t,r)))}update(t,r,n,o){let i=!1,a=t.state.mode==="orthographic"?1:0,s=this.renderable.values.uInvProjection.ref.value;Z.invert(s,t.projection);let l=r.includeTransparent??!0,u=Math.max(1,Math.round(r.scale*this.webgl.pixelRatio))-1,c=50*r.threshold*this.webgl.pixelRatio;return P.updateIfChanged(this.renderable.values.uNear,t.near),P.updateIfChanged(this.renderable.values.uFar,t.far),P.update(this.renderable.values.uInvProjection,s),this.renderable.values.dTransparentOutline.ref.value!==l&&(i=!0,P.update(this.renderable.values.dTransparentOutline,l)),this.renderable.values.dOrthographic.ref.value!==a&&(i=!0,P.update(this.renderable.values.dOrthographic,a)),P.updateIfChanged(this.renderable.values.uOutlineThreshold,c),this.renderable.values.tDepthTransparent.ref.value!==n&&(i=!0,P.update(this.renderable.values.tDepthTransparent,n)),this.renderable.values.tDepthOpaque.ref.value!==o&&(i=!0,P.update(this.renderable.values.tDepthOpaque,o)),i&&this.renderable.update(),{transparentOutline:l,outlineScale:u}}render(){He&&this.webgl.timer.mark("OutlinePass.render"),this.target.bind(),this.renderable.render(),He&&this.webgl.timer.markEnd("OutlinePass.render")}},nrt={...un,tDepthOpaque:pt("texture","rgba","ubyte","nearest"),tDepthTransparent:pt("texture","rgba","ubyte","nearest"),uTexSize:he("v2"),dOrthographic:ct("number"),uNear:he("f"),uFar:he("f"),uInvProjection:he("m4"),uOutlineThreshold:he("f"),dTransparentOutline:ct("boolean")};function ort(e,t,r,n){let o=t.getWidth(),i=t.getHeight(),a={...cn,tDepthOpaque:P.create(t),tDepthTransparent:P.create(r),uTexSize:P.create(Ie.create(o,i)),dOrthographic:P.create(0),uNear:P.create(1),uFar:P.create(1e4),uInvProjection:P.create(Z.identity()),uOutlineThreshold:P.create(.33),dTransparentOutline:P.create(n)},s={...nrt},l=Dr("outlines",bn,USe),u=Wr(e,"triangles",l,s,a);return Xr(u,a)}var NSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uNear;
uniform float uFar;

#if dLightCount != 0
    uniform vec3 uLightDirection[dLightCount];
    uniform vec3 uLightColor[dLightCount];
#endif
uniform vec3 uAmbientColor;

uniform mat4 uProjection;
uniform mat4 uInvProjection;

uniform float uMaxDistance;
uniform float uTolerance;

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

float screenFade(const in vec2 coords) {
    vec2 c = (coords - uBounds.xy) / (uBounds.zw - uBounds.xy);
    vec2 fade = max(12.0 * abs(c - 0.5) - 5.0, vec2(0.0));
    return saturate(1.0 - dot(fade, fade));
}

// based on https://panoskarabelas.com/posts/screen_space_shadows/
vec3 screenSpaceShadow(const in vec3 position, const in vec3 lightDirection, const in vec3 lightColor, const in float stepLength) {
    // Ray position and direction (in view-space)
    vec3 rayPos = position;
    vec3 rayDir = -lightDirection;

    // Compute ray step
    vec3 rayStep = rayDir * stepLength;

    // Ray march towards the light
    vec4 rayCoords = vec4(0.0);
    for (int i = 0; i < dSteps; ++i) {
        // Step the ray
        rayPos += rayStep;

        rayCoords = uProjection * vec4(rayPos, 1.0);
        rayCoords.xyz = (rayCoords.xyz / rayCoords.w) * 0.5 + 0.5;

        if (outsideBounds(rayCoords.xy)) {
            return lightColor;
        }

        // Compute the difference between the ray's and the camera's depth
        float depth = getDepth(rayCoords.xy);
        float viewZ = getViewZ(depth);
        float zDelta = rayPos.z - viewZ;

        if (zDelta < uTolerance) {
            // Fade out as we approach the edges of the screen
            return mix(vec3(0.0), lightColor, 1.0 - screenFade(rayCoords.xy));
        }
    }

    return lightColor;
}

void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;

    float selfDepth = getDepth(selfCoords);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(0.0);
        return;
    }

    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);
    float stepLength = uMaxDistance / float(dSteps);

    float l = length(uAmbientColor);
    float a = l;
    #if dLightCount != 0
        vec3 s;
        #pragma unroll_loop_start
        for (int i = 0; i < dLightCount; ++i) {
            s = screenSpaceShadow(selfViewPos, uLightDirection[i], uLightColor[i], stepLength);
            l += length(s);
            a += length(uLightColor[i]);
        }
        #pragma unroll_loop_end
    #endif

    gl_FragColor = vec4(l / a);
}
`;var vL={steps:C.Numeric(1,{min:1,max:64,step:1}),maxDistance:C.Numeric(3,{min:0,max:256,step:1}),tolerance:C.Numeric(1,{min:0,max:10,step:.1})},oA=class{constructor(t,r,n,o){this.webgl=t;this.target=t.createRenderTarget(r,n,!1),this.renderable=art(t,o)}static isEnabled(t){return t.shadow.name!=="off"}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;(t!==n||r!==o)&&(this.target.setSize(t,r),P.update(this.renderable.values.uTexSize,Ie.set(this.renderable.values.uTexSize.ref.value,t,r)))}update(t,r,n,o){let i=!1,a=t.state.mode==="orthographic"?1:0,s=Z.identity();Z.invert(s,t.projection);let[l,u]=this.renderable.values.uTexSize.ref.value,c=t.viewport;P.update(this.renderable.values.uProjection,t.projection),P.update(this.renderable.values.uInvProjection,s),Ut.set(this.renderable.values.uBounds.ref.value,c.x/l,c.y/u,(c.x+c.width)/l,(c.y+c.height)/u),P.update(this.renderable.values.uBounds,this.renderable.values.uBounds.ref.value),P.updateIfChanged(this.renderable.values.uNear,t.near),P.updateIfChanged(this.renderable.values.uFar,t.far),this.renderable.values.dOrthographic.ref.value!==a&&(P.update(this.renderable.values.dOrthographic,a),i=!0),P.updateIfChanged(this.renderable.values.uMaxDistance,o.maxDistance),P.updateIfChanged(this.renderable.values.uTolerance,o.tolerance),this.renderable.values.dSteps.ref.value!==o.steps&&(P.update(this.renderable.values.dSteps,o.steps),i=!0),P.update(this.renderable.values.uLightDirection,r.direction),P.update(this.renderable.values.uLightColor,r.color),this.renderable.values.dLightCount.ref.value!==r.count&&(P.update(this.renderable.values.dLightCount,r.count),i=!0),P.update(this.renderable.values.uAmbientColor,n),i&&this.renderable.update()}render(){He&&this.webgl.timer.mark("ShadowPass.render"),this.target.bind(),this.renderable.render(),He&&this.webgl.timer.markEnd("ShadowPass.render")}},irt={...un,tDepth:pt("texture","rgba","ubyte","nearest"),uTexSize:he("v2"),uProjection:he("m4"),uInvProjection:he("m4"),uBounds:he("v4"),dOrthographic:ct("number"),uNear:he("f"),uFar:he("f"),dSteps:ct("number"),uMaxDistance:he("f"),uTolerance:he("f"),uLightDirection:he("v3[]"),uLightColor:he("v3[]"),dLightCount:ct("number"),uAmbientColor:he("v3")};function art(e,t){let r=t.getWidth(),n=t.getHeight(),o={...cn,tDepth:P.create(t),uTexSize:P.create(Ie.create(r,n)),uProjection:P.create(Z.identity()),uInvProjection:P.create(Z.identity()),uBounds:P.create(Ut()),dOrthographic:P.create(0),uNear:P.create(1),uFar:P.create(1e4),dSteps:P.create(1),uMaxDistance:P.create(3),uTolerance:P.create(1),uLightDirection:P.create([]),uLightColor:P.create([]),dLightCount:P.create(0),uAmbientColor:P.create(b())},i={...irt},a=Dr("shadows",bn,NSe),s=Wr(e,"triangles",a,i,o);return Xr(s,o)}var zSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common


uniform sampler2D tDepth;
uniform sampler2D tDepthHalf;
uniform sampler2D tDepthQuarter;

#if defined(dIncludeTransparent)
    uniform sampler2D tDepthTransparent;
    uniform sampler2D tDepthHalfTransparent;
    uniform sampler2D tDepthQuarterTransparent;
#endif

uniform int uTransparencyFlag;

uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform vec3 uSamples[dNSamples];

uniform mat4 uProjection;
uniform mat4 uInvProjection;

#ifdef dMultiScale
    uniform float uLevelRadius[dLevels];
    uniform float uLevelBias[dLevels];
    uniform float uNearThreshold;
    uniform float uFarThreshold;
#else
    uniform float uRadius;
#endif
uniform float uBias;

float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}

float noise(const in vec2 coords) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(coords, vec2(a,b));
    float sn = mod(dt, PI);
    return abs(fract(sin(sn) * c)); // is abs necessary?
}

vec2 getNoiseVec2(const in vec2 coords) {
    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));
}

bool isBackground(const in float depth) {
    return depth > 0.999; // handle precision issues with packed depth
}

float getDepth(const in vec2 coords, const in int transparentFlag) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    if (transparentFlag == 1){
        #if defined(dIncludeTransparent)
            return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, c)).x;
        #else
            return 1.0;
        #endif
    } else {
        #ifdef depthTextureSupport
            return texture2D(tDepth, c).r;
        #else
            return unpackRGBAToDepth(texture2D(tDepth, c));
        #endif
    }
}

#if defined(dIncludeTransparent)
    vec2 getDepthTransparentWithAlpha(const in vec2 coords){
        vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
        return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, c));
    }
#endif

#define dQuarterThreshold 0.1
#define dHalfThreshold 0.05

float getMappedDepth(const in vec2 coords, const in vec2 selfCoords) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    float d = distance(coords, selfCoords);
    #ifdef depthTextureSupport
        if (d > dQuarterThreshold) {
            return texture2D(tDepthQuarter, c).r;
        } else if (d > dHalfThreshold) {
            return texture2D(tDepthHalf, c).r;
        } else {
            return texture2D(tDepth, c).r;
        }
    #else
        if (d > dQuarterThreshold) {
            return unpackRGBAToDepth(texture2D(tDepthQuarter, c));
        } else if (d > dHalfThreshold) {
            return unpackRGBAToDepth(texture2D(tDepthHalf, c));
        } else {
            return unpackRGBAToDepth(texture2D(tDepth, c));
        }
    #endif
}

#if defined(dIncludeTransparent)
    vec2 getMappedDepthTransparentWithAlpha(const in vec2 coords, const in vec2 selfCoords) {
        vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
        float d = distance(coords, selfCoords);
        if (d > dQuarterThreshold) {
            return unpackRGBAToDepthWithAlpha(texture2D(tDepthQuarterTransparent, c));
        } else if (d > dHalfThreshold) {
            return unpackRGBAToDepthWithAlpha(texture2D(tDepthHalfTransparent, c));
        } else {
            return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, c));
        }
    }
#endif

// adapted from https://gist.github.com/bgolus/a07ed65602c009d5e2f753826e8078a0
vec3 viewNormalAtPixelPositionAccurate(const in vec2 vpos, const in int transparentFlag) {
    // current pixel's depth
    float c = getDepth(vpos, transparentFlag);

    // get current pixel's view space position
    vec3 viewSpacePos_c = screenSpaceToViewSpace(vec3(vpos, c), uInvProjection);

    // get view space position at 1 pixel offsets in each major direction
    vec3 viewSpacePos_l = screenSpaceToViewSpace(vec3(vpos + vec2(-1.0, 0.0) / uTexSize, getDepth(vpos + vec2(-1.0, 0.0) / uTexSize, transparentFlag)), uInvProjection);
    vec3 viewSpacePos_r = screenSpaceToViewSpace(vec3(vpos + vec2( 1.0, 0.0) / uTexSize, getDepth(vpos + vec2( 1.0, 0.0) / uTexSize, transparentFlag)), uInvProjection);
    vec3 viewSpacePos_d = screenSpaceToViewSpace(vec3(vpos + vec2( 0.0,-1.0) / uTexSize, getDepth(vpos + vec2( 0.0,-1.0) / uTexSize, transparentFlag)), uInvProjection);
    vec3 viewSpacePos_u = screenSpaceToViewSpace(vec3(vpos + vec2( 0.0, 1.0) / uTexSize, getDepth(vpos + vec2( 0.0, 1.0) / uTexSize, transparentFlag)), uInvProjection);

    // get the difference between the current and each offset position
    vec3 l = viewSpacePos_c - viewSpacePos_l;
    vec3 r = viewSpacePos_r - viewSpacePos_c;
    vec3 d = viewSpacePos_c - viewSpacePos_d;
    vec3 u = viewSpacePos_u - viewSpacePos_c;

    // get depth values at 1 & 2 pixels offsets from current along the horizontal axis
    vec4 H = vec4(
        getDepth(vpos + vec2(-1.0, 0.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2( 1.0, 0.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2(-2.0, 0.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2( 2.0, 0.0) / uTexSize, transparentFlag)
    );

    // get depth values at 1 & 2 pixels offsets from current along the vertical axis
    vec4 V = vec4(
        getDepth(vpos + vec2(0.0,-1.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2(0.0, 1.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2(0.0,-2.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2(0.0, 2.0) / uTexSize, transparentFlag)
    );

    // current pixel's depth difference from slope of offset depth samples
    // differs from original article because we're using non-linear depth values
    // see article's comments
    vec2 he = abs((2.0 * H.xy - H.zw) - c);
    vec2 ve = abs((2.0 * V.xy - V.zw) - c);

    // pick horizontal and vertical diff with the smallest depth difference from slopes
    vec3 hDeriv = he.x < he.y ? l : r;
    vec3 vDeriv = ve.x < ve.y ? d : u;

    // get view space normal from the cross product of the best derivatives
    vec3 viewNormal = normalize(cross(hDeriv, vDeriv));

    return viewNormal;
}

float getPixelSize(const in vec2 coords, const in float depth) {
    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);
    return distance(viewPos0, viewPos1);
}

// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]
void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;
    float selfDepth = getDepth(selfCoords, uTransparencyFlag);
    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), selfPackedDepth);
        return;
    }

    vec3 selfViewNormal = viewNormalAtPixelPositionAccurate(selfCoords, uTransparencyFlag);
    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);

    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));
    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));
    vec3 bitangent = cross(selfViewNormal, tangent);
    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);

    float occlusion = 0.0;
    #ifdef dMultiScale
        float pixelSize = getPixelSize(selfCoords, selfDepth);

        for(int l = 0; l < dLevels; l++) {
            // TODO: smooth transition
            if (pixelSize * uNearThreshold > uLevelRadius[l]) continue;
            if (pixelSize * uFarThreshold < uLevelRadius[l]) continue;

            float levelOcclusion = 0.0;
            for(int i = 0; i < dNSamples; i++) {
                // get sample position:
                vec3 sampleViewPos = TBN * uSamples[i];
                sampleViewPos = selfViewPos + sampleViewPos * uLevelRadius[l];

                // project sample position:
                vec4 offset = vec4(sampleViewPos, 1.0);
                offset = uProjection * offset;
                offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

                // get sample depth:
                float sampleOcc = 0.0;
                #ifdef dIllumination
                    if (uTransparencyFlag == 1) {
                #endif
                    float sampleDepth = getMappedDepth(offset.xy, selfCoords);
                    float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;

                    sampleOcc = step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uLevelRadius[l] / abs(selfViewPos.z - sampleViewZ)) * uLevelBias[l];
                #ifdef dIllumination
                    }
                #endif
                #if defined(dIncludeTransparent)
                    vec2 sampleDepthWithAlpha = getMappedDepthTransparentWithAlpha(offset.xy, selfCoords);
                    if (!isBackground(sampleDepthWithAlpha.x)) {
                        float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepthWithAlpha.x), uInvProjection).z;
                        sampleOcc = max(sampleOcc, step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uLevelRadius[l] / abs(selfViewPos.z - sampleViewZ)) * uLevelBias[l] * sampleDepthWithAlpha.y);
                    }
                #endif

                levelOcclusion += sampleOcc;
            }
            occlusion = max(occlusion, levelOcclusion);
        }
    #else
        for(int i = 0; i < dNSamples; i++) {
            vec3 sampleViewPos = TBN * uSamples[i];
            sampleViewPos = selfViewPos + sampleViewPos * uRadius;

            vec4 offset = vec4(sampleViewPos, 1.0);
            offset = uProjection * offset;
            offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

            float sampleOcc = 0.0;
            #ifdef dIllumination
                if (uTransparencyFlag == 1) {
            #endif
                    // NOTE: using getMappedDepth here causes issues on some mobile devices
                    float sampleDepth = getDepth(offset.xy, 0);
                    float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;

                    sampleOcc = step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));
            #ifdef dIllumination
                }
            #endif
            #if defined(dIncludeTransparent)
                vec2 sampleDepthWithAlpha = getDepthTransparentWithAlpha(offset.xy);
                if (!isBackground(sampleDepthWithAlpha.x)) {
                    float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepthWithAlpha.x), uInvProjection).z;
                    sampleOcc = max(sampleOcc, step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ)) * sampleDepthWithAlpha.y);
                }
            #endif

            occlusion += sampleOcc;
        }
    #endif
    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));

    vec2 packedOcclusion = packUnitIntervalToRG(clamp(occlusion, 0.01, 1.0));

    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);
}
`;var HSe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uKernel[dOcclusionKernelSize];
uniform float uBlurDepthBias;

uniform float uBlurDirectionX;
uniform float uBlurDirectionY;

uniform mat4 uInvProjection;
uniform float uNear;
uniform float uFar;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

bool isBackground(const in float depth) {
    // checking for 1.0 is not enough, because of precision issues
    return depth >= 0.999;
}

bool isNearClip(const in float depth) {
    return depth == 0.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getPixelSize(const in vec2 coords, const in float depth) {
    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);
    return distance(viewPos0, viewPos1);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;

    if (outsideBounds(coords)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfDepth = unpackRGToUnitInterval(packedDepth);
    // (if background and if second pass) or if near clip
    if ((isBackground(selfDepth) && uBlurDirectionY != 0.0) || isNearClip(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfViewZ = getViewZ(selfDepth);
    float pixelSize = getPixelSize(coords, selfDepth);

    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;

    float sum = 0.0;
    float kernelSum = 0.0;
    // only if kernelSize is odd
    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {
        if (abs(float(i)) > 1.0 && abs(float(i)) * pixelSize > 0.8) continue;

        vec2 sampleCoords = coords + float(i) * offset;
        if (outsideBounds(sampleCoords)) {
            continue;
        }

        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);

        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);
        if (isBackground(sampleDepth) || isNearClip(sampleDepth)) {
            continue;
        }

        float sampleViewZ = getViewZ(sampleDepth);
        if (abs(selfViewZ - sampleViewZ) >= uBlurDepthBias) {
            continue;
        }

        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1
        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);

        sum += kernel * sampleValue;
        kernelSum += kernel;
    }
    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);
}
`;var AL={samples:C.Numeric(32,{min:1,max:256,step:1}),multiScale:C.MappedStatic("off",{on:C.Group({levels:C.ObjectList({radius:C.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x"}),bias:C.Numeric(1,{min:0,max:3,step:.1})},e=>`${e.radius}, ${e.bias}`,{defaultValue:[{radius:2,bias:1},{radius:5,bias:1},{radius:8,bias:1},{radius:11,bias:1}]}),nearThreshold:C.Numeric(10,{min:0,max:50,step:1}),farThreshold:C.Numeric(1500,{min:0,max:1e4,step:100})}),off:C.Group({})},{cycle:!0}),radius:C.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x",hideIf:e=>e?.multiScale.name==="on"}),bias:C.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:C.Numeric(15,{min:1,max:25,step:2}),blurDepthBias:C.Numeric(.5,{min:0,max:1,step:.01}),resolutionScale:C.Numeric(1,{min:.1,max:1,step:.05},{description:"Adjust resolution of occlusion calculation"}),color:C.Color(0),transparentThreshold:C.Numeric(.4,{min:0,max:1,step:.05})};function srt(e,t){let r=e.length,{radius:n,bias:o}=t||{radius:new Array(r*3).fill(0),bias:new Array(r*3).fill(0)};e=e.slice().sort((i,a)=>i.radius-a.radius);for(let i=0;i<r;++i){let a=e[i];n[i]=Math.pow(2,a.radius),o[i]=a.bias}return{count:r,radius:n,bias:o}}var vf=class e{constructor(t,r,n,o,i,a){this.webgl=t;let{textureFloatLinear:s}=t.extensions;this.depthTextureOpaque=i,this.depthTextureTransparent=a,this.nSamples=1,this.blurKernelSize=1,this.ssaoScale=this.calcSsaoScale(1),this.texSize=[r,n],this.levels=[],this.framebuffer=t.resources.framebuffer(),this.blurFirstPassFramebuffer=t.resources.framebuffer(),this.blurSecondPassFramebuffer=t.resources.framebuffer();let l=Math.floor(r*this.ssaoScale),u=Math.floor(n*this.ssaoScale),c=Math.max(1,Math.floor(l*.5)),m=Math.max(1,Math.floor(u*.5)),d=Math.max(1,Math.floor(l*.25)),p=Math.max(1,Math.floor(u*.25)),h=s?"linear":"nearest";this.downsampledDepthTargetOpaque=o?t.createRenderTarget(l,u,!1,"uint8","linear","rgba"):t.createRenderTarget(l,u,!1,"float32",h,t.isWebGL2?"alpha":"rgba"),this.downsampleDepthRenderableOpaque=mm(t,i);let f=this.getDepthTexture();this.depthHalfTargetOpaque=o?t.createRenderTarget(c,m,!1,"uint8","linear","rgba"):t.createRenderTarget(c,m,!1,"float32",h,t.isWebGL2?"alpha":"rgba"),this.depthHalfRenderableOpaque=mm(t,f),this.depthQuarterTargetOpaque=o?t.createRenderTarget(d,p,!1,"uint8","linear","rgba"):t.createRenderTarget(d,p,!1,"float32",h,t.isWebGL2?"alpha":"rgba"),this.depthQuarterRenderableOpaque=mm(t,this.depthHalfTargetOpaque.texture),this.downsampledDepthTargetTransparent=t.createRenderTarget(l,u,!1,"uint8","linear","rgba"),this.downsampleDepthRenderableTransparent=mm(t,a);let y=this.getTransparentDepthTexture();this.depthHalfTargetTransparent=t.createRenderTarget(c,m,!1,"uint8","linear","rgba"),this.depthHalfRenderableTransparent=mm(t,y),this.depthQuarterTargetTransparent=t.createRenderTarget(d,p,!1,"uint8","linear","rgba"),this.depthQuarterRenderableTransparent=mm(t,this.depthHalfTargetTransparent.texture),this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","linear"),this.ssaoDepthTexture.define(l,u),this.ssaoDepthTexture.attachFramebuffer(this.framebuffer,"color0"),this.ssaoDepthTransparentTexture=t.resources.texture("image-uint8","rgba","ubyte","linear"),this.ssaoDepthTransparentTexture.define(l,u),this.depthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","linear"),this.depthBlurProxyTexture.define(l,u),this.depthBlurProxyTexture.attachFramebuffer(this.blurFirstPassFramebuffer,"color0"),this.renderable=urt(t,f,this.depthHalfTargetOpaque.texture,this.depthQuarterTargetOpaque.texture,y,this.depthHalfTargetTransparent.texture,this.depthQuarterTargetTransparent.texture),this.blurFirstPassRenderable=jSe(t,this.ssaoDepthTransparentTexture,"horizontal"),this.blurSecondPassRenderable=jSe(t,this.depthBlurProxyTexture,"vertical")}static isEnabled(t){return t.occlusion.name!=="off"}static isTransparentEnabled(t,r){return t.opacityAverage<1&&t.transparencyMin<r.transparentThreshold}calcSsaoScale(t){return Math.min(1,1/this.webgl.pixelRatio)*t}getDepthTexture(){return this.ssaoScale===1?this.depthTextureOpaque:this.downsampledDepthTargetOpaque.texture}getTransparentDepthTexture(){return this.ssaoScale===1?this.depthTextureTransparent:this.downsampledDepthTargetTransparent.texture}setSize(t,r){let[n,o]=this.texSize,i=this.calcSsaoScale(1);if(t!==n||r!==o||this.ssaoScale!==i){this.texSize.splice(0,2,t,r);let a=Math.floor(t*this.ssaoScale),s=Math.floor(r*this.ssaoScale);this.ssaoDepthTexture.define(a,s),this.ssaoDepthTransparentTexture.define(a,s),this.depthBlurProxyTexture.define(a,s);let l=Math.max(1,Math.floor(a*.5)),u=Math.max(1,Math.floor(s*.5)),c=Math.max(1,Math.floor(a*.25)),m=Math.max(1,Math.floor(s*.25));this.downsampledDepthTargetOpaque.setSize(a,s),this.depthHalfTargetOpaque.setSize(l,u),this.depthQuarterTargetOpaque.setSize(c,m),P.update(this.downsampleDepthRenderableOpaque.values.uTexSize,Ie.set(this.downsampleDepthRenderableOpaque.values.uTexSize.ref.value,a,s)),P.update(this.depthHalfRenderableOpaque.values.uTexSize,Ie.set(this.depthHalfRenderableOpaque.values.uTexSize.ref.value,l,u)),P.update(this.depthQuarterRenderableOpaque.values.uTexSize,Ie.set(this.depthQuarterRenderableOpaque.values.uTexSize.ref.value,c,m)),this.downsampledDepthTargetTransparent.setSize(a,s),this.depthHalfTargetTransparent.setSize(l,u),this.depthQuarterTargetTransparent.setSize(c,m),P.update(this.downsampleDepthRenderableTransparent.values.uTexSize,Ie.set(this.downsampleDepthRenderableTransparent.values.uTexSize.ref.value,a,s)),P.update(this.depthHalfRenderableTransparent.values.uTexSize,Ie.set(this.depthHalfRenderableTransparent.values.uTexSize.ref.value,l,u)),P.update(this.depthQuarterRenderableTransparent.values.uTexSize,Ie.set(this.depthQuarterRenderableTransparent.values.uTexSize.ref.value,c,m)),P.update(this.renderable.values.uTexSize,Ie.set(this.renderable.values.uTexSize.ref.value,a,s)),P.update(this.blurFirstPassRenderable.values.uTexSize,Ie.set(this.blurFirstPassRenderable.values.uTexSize.ref.value,a,s)),P.update(this.blurSecondPassRenderable.values.uTexSize,Ie.set(this.blurSecondPassRenderable.values.uTexSize.ref.value,a,s));let d=this.getDepthTexture(),p=this.getTransparentDepthTexture();P.update(this.depthHalfRenderableOpaque.values.tColor,d),P.update(this.depthHalfRenderableTransparent.values.tColor,p),P.update(this.renderable.values.tDepth,d),P.update(this.renderable.values.tDepthTransparent,p),this.depthHalfRenderableOpaque.update(),this.depthHalfRenderableTransparent.update(),this.renderable.update()}}reset(){this.ssaoDepthTexture.attachFramebuffer(this.framebuffer,"color0"),this.depthBlurProxyTexture.attachFramebuffer(this.blurFirstPassFramebuffer,"color0")}update(t,r,n,o=!1){let i=!1,a=!1,s=!1,l=t.state.mode==="orthographic"?1:0,u=Z.identity();Z.invert(u,t.projection);let[c,m]=this.texSize,d=t.viewport;P.update(this.renderable.values.uProjection,t.projection),P.update(this.renderable.values.uInvProjection,u);let p=this.renderable.values.uBounds,h=this.ssaoScale;Ut.set(p.ref.value,Math.floor(d.x*h)/(c*h),Math.floor(d.y*h)/(m*h),Math.ceil((d.x+d.width)*h)/(c*h),Math.ceil((d.y+d.height)*h)/(m*h)),P.update(p,p.ref.value),P.update(this.blurFirstPassRenderable.values.uBounds,p.ref.value),P.update(this.blurSecondPassRenderable.values.uBounds,p.ref.value),P.updateIfChanged(this.blurFirstPassRenderable.values.uNear,t.near),P.updateIfChanged(this.blurSecondPassRenderable.values.uNear,t.near),P.updateIfChanged(this.blurFirstPassRenderable.values.uFar,t.far),P.updateIfChanged(this.blurSecondPassRenderable.values.uFar,t.far),P.update(this.blurFirstPassRenderable.values.uInvProjection,u),P.update(this.blurSecondPassRenderable.values.uInvProjection,u),P.update(this.blurFirstPassRenderable.values.uBlurDepthBias,n.blurDepthBias),P.update(this.blurSecondPassRenderable.values.uBlurDepthBias,n.blurDepthBias),this.blurFirstPassRenderable.values.dOrthographic.ref.value!==l&&(a=!0,P.update(this.blurFirstPassRenderable.values.dOrthographic,l),P.update(this.blurSecondPassRenderable.values.dOrthographic,l));let f=e.isTransparentEnabled(r,n);this.renderable.values.dIncludeTransparent.ref.value!==f&&(i=!0,P.update(this.renderable.values.dIncludeTransparent,f)),this.renderable.values.dIllumination.ref.value!==o&&(i=!0,P.update(this.renderable.values.dIllumination,o)),this.nSamples!==n.samples&&(i=!0,this.nSamples=n.samples,P.update(this.renderable.values.uSamples,XSe(this.nSamples)),P.updateIfChanged(this.renderable.values.dNSamples,this.nSamples));let y=n.multiScale.name==="on";if(this.renderable.values.dMultiScale.ref.value!==y&&(i=!0,P.update(this.renderable.values.dMultiScale,y)),n.multiScale.name==="on"){let x=n.multiScale.params;if(!oa(this.levels,x.levels)){i=!0,this.levels=x.levels;let S=srt(x.levels);P.updateIfChanged(this.renderable.values.dLevels,S.count),P.update(this.renderable.values.uLevelRadius,S.radius),P.update(this.renderable.values.uLevelBias,S.bias)}P.updateIfChanged(this.renderable.values.uNearThreshold,x.nearThreshold),P.updateIfChanged(this.renderable.values.uFarThreshold,x.farThreshold)}else P.updateIfChanged(this.renderable.values.uRadius,Math.pow(2,n.radius));if(P.updateIfChanged(this.renderable.values.uBias,n.bias),this.blurKernelSize!==n.blurKernelSize){a=!0,this.blurKernelSize=n.blurKernelSize;let x=WSe(this.blurKernelSize);P.update(this.blurFirstPassRenderable.values.uKernel,x),P.update(this.blurSecondPassRenderable.values.uKernel,x),P.update(this.blurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),P.update(this.blurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}let g=this.calcSsaoScale(n.resolutionScale);if(this.ssaoScale!==g){i=!0,s=!0,this.ssaoScale=g;let x=Math.floor(c*this.ssaoScale),S=Math.floor(m*this.ssaoScale);this.ssaoDepthTexture.define(x,S),this.ssaoDepthTransparentTexture.define(x,S),this.depthBlurProxyTexture.define(x,S);let I=Math.floor(x*.5),v=Math.floor(S*.5),A=Math.floor(x*.25),_=Math.floor(S*.25);this.downsampledDepthTargetOpaque.setSize(x,S),this.depthHalfTargetOpaque.setSize(I,v),this.depthQuarterTargetOpaque.setSize(A,_);let T=this.getDepthTexture();P.update(this.depthHalfRenderableOpaque.values.tColor,T),P.update(this.renderable.values.tDepth,T),P.update(this.renderable.values.tDepthHalf,this.depthHalfTargetOpaque.texture),P.update(this.renderable.values.tDepthQuarter,this.depthQuarterTargetOpaque.texture),P.update(this.downsampleDepthRenderableOpaque.values.uTexSize,Ie.set(this.downsampleDepthRenderableOpaque.values.uTexSize.ref.value,x,S)),P.update(this.depthHalfRenderableOpaque.values.uTexSize,Ie.set(this.depthHalfRenderableOpaque.values.uTexSize.ref.value,I,v)),P.update(this.depthQuarterRenderableOpaque.values.uTexSize,Ie.set(this.depthQuarterRenderableOpaque.values.uTexSize.ref.value,A,_)),this.downsampledDepthTargetTransparent.setSize(x,S),this.depthHalfTargetTransparent.setSize(I,v),this.depthQuarterTargetTransparent.setSize(A,_);let w=this.getTransparentDepthTexture();P.update(this.depthHalfRenderableTransparent.values.tColor,w),P.update(this.renderable.values.tDepthTransparent,w),P.update(this.renderable.values.tDepthHalfTransparent,this.depthHalfTargetTransparent.texture),P.update(this.renderable.values.tDepthQuarterTransparent,this.depthQuarterTargetTransparent.texture),P.update(this.downsampleDepthRenderableTransparent.values.uTexSize,Ie.set(this.downsampleDepthRenderableTransparent.values.uTexSize.ref.value,x,S)),P.update(this.depthHalfRenderableTransparent.values.uTexSize,Ie.set(this.depthHalfRenderableTransparent.values.uTexSize.ref.value,I,v)),P.update(this.depthQuarterRenderableTransparent.values.uTexSize,Ie.set(this.depthQuarterRenderableTransparent.values.uTexSize.ref.value,A,_)),P.update(this.renderable.values.uTexSize,Ie.set(this.renderable.values.uTexSize.ref.value,x,S)),P.update(this.blurFirstPassRenderable.values.uTexSize,Ie.set(this.blurFirstPassRenderable.values.uTexSize.ref.value,x,S)),P.update(this.blurSecondPassRenderable.values.uTexSize,Ie.set(this.blurSecondPassRenderable.values.uTexSize.ref.value,x,S))}i&&this.renderable.update(),a&&(this.blurFirstPassRenderable.update(),this.blurSecondPassRenderable.update()),s&&(this.depthHalfRenderableOpaque.update(),this.depthHalfRenderableTransparent.update())}render(t){He&&this.webgl.timer.mark("SSAO.render");let{state:r}=this.webgl,{x:n,y:o,width:i,height:a}=t.viewport,s=this.renderable.values.dIncludeTransparent.ref.value,l=this.renderable.values.dMultiScale.ref.value,u=Math.floor(n*this.ssaoScale),c=Math.floor(o*this.ssaoScale),m=Math.ceil(i*this.ssaoScale),d=Math.ceil(a*this.ssaoScale);r.viewport(u,c,m,d),r.scissor(u,c,m,d),this.ssaoScale<1&&(He&&this.webgl.timer.mark("SSAO.downsample"),this.downsampledDepthTargetOpaque.bind(),this.downsampleDepthRenderableOpaque.render(),s&&(this.downsampledDepthTargetTransparent.bind(),this.downsampleDepthRenderableTransparent.render()),He&&this.webgl.timer.markEnd("SSAO.downsample")),He&&this.webgl.timer.mark("SSAO.half"),l&&(this.depthHalfTargetOpaque.bind(),this.depthHalfRenderableOpaque.render()),l&&s&&(this.depthHalfTargetTransparent.bind(),this.depthHalfRenderableTransparent.render()),He&&this.webgl.timer.markEnd("SSAO.half"),He&&this.webgl.timer.mark("SSAO.quarter"),l&&(this.depthQuarterTargetOpaque.bind(),this.depthQuarterRenderableOpaque.render()),l&&s&&(this.depthQuarterTargetTransparent.bind(),this.depthQuarterRenderableTransparent.render()),He&&this.webgl.timer.markEnd("SSAO.quarter"),He&&this.webgl.timer.mark("SSAO.opaque"),this.ssaoDepthTexture.attachFramebuffer(this.framebuffer,"color0"),P.update(this.renderable.values.uTransparencyFlag,0),this.framebuffer.bind(),this.renderable.render(),He&&this.webgl.timer.markEnd("SSAO.opaque"),He&&this.webgl.timer.mark("SSAO.blurOpaque"),P.update(this.blurFirstPassRenderable.values.tSsaoDepth,this.ssaoDepthTexture),this.blurFirstPassRenderable.update(),this.blurFirstPassFramebuffer.bind(),this.blurFirstPassRenderable.render(),this.ssaoDepthTexture.attachFramebuffer(this.blurSecondPassFramebuffer,"color0"),this.blurSecondPassFramebuffer.bind(),this.blurSecondPassRenderable.render(),He&&this.webgl.timer.markEnd("SSAO.blurOpaque"),s&&(He&&this.webgl.timer.mark("SSAO.transparent "),this.ssaoDepthTransparentTexture.attachFramebuffer(this.framebuffer,"color0"),P.update(this.renderable.values.uTransparencyFlag,1),this.framebuffer.bind(),this.renderable.render(),He&&this.webgl.timer.markEnd("SSAO.transparent "),He&&this.webgl.timer.mark("SSAO.blurTransparent "),P.update(this.blurFirstPassRenderable.values.tSsaoDepth,this.ssaoDepthTransparentTexture),this.blurFirstPassRenderable.update(),this.blurFirstPassFramebuffer.bind(),this.blurFirstPassRenderable.render(),this.ssaoDepthTransparentTexture.attachFramebuffer(this.blurSecondPassFramebuffer,"color0"),this.blurSecondPassFramebuffer.bind(),this.blurSecondPassRenderable.render(),He&&this.webgl.timer.markEnd("SSAO.blurTransparent ")),He&&this.webgl.timer.markEnd("SSAO.render")}},lrt={...un,tDepth:pt("texture","rgba","ubyte","linear"),tDepthHalf:pt("texture","rgba","ubyte","linear"),tDepthQuarter:pt("texture","rgba","ubyte","linear"),dIllumination:ct("boolean"),uTransparencyFlag:he("i"),dIncludeTransparent:ct("boolean"),tDepthTransparent:pt("texture","rgba","ubyte","linear"),tDepthHalfTransparent:pt("texture","rgba","ubyte","linear"),tDepthQuarterTransparent:pt("texture","rgba","ubyte","linear"),uSamples:he("v3[]"),dNSamples:ct("number"),uProjection:he("m4"),uInvProjection:he("m4"),uBounds:he("v4"),uTexSize:he("v2"),uRadius:he("f"),uBias:he("f"),dMultiScale:ct("boolean"),dLevels:ct("number"),uLevelRadius:he("f[]"),uLevelBias:he("f[]"),uNearThreshold:he("f"),uFarThreshold:he("f")};function urt(e,t,r,n,o,i,a){let s={...cn,tDepth:P.create(t),tDepthHalf:P.create(r),tDepthQuarter:P.create(n),dIllumination:P.create(!1),dIncludeTransparent:P.create(!0),uTransparencyFlag:P.create(0),tDepthTransparent:P.create(o),tDepthHalfTransparent:P.create(i),tDepthQuarterTransparent:P.create(a),uSamples:P.create(XSe(32)),dNSamples:P.create(32),uProjection:P.create(Z.identity()),uInvProjection:P.create(Z.identity()),uBounds:P.create(Ut()),uTexSize:P.create(Ie.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:P.create(Math.pow(2,5)),uBias:P.create(.8),dMultiScale:P.create(!1),dLevels:P.create(3),uLevelRadius:P.create([Math.pow(2,2),Math.pow(2,5),Math.pow(2,8)]),uLevelBias:P.create([.8,.8,.8]),uNearThreshold:P.create(10),uFarThreshold:P.create(1500)},l={...lrt},u=Dr("ssao",bn,zSe),c=Wr(e,"triangles",u,l,s);return Xr(c,s)}var crt={...un,tSsaoDepth:pt("texture","rgba","ubyte","nearest"),uTexSize:he("v2"),uKernel:he("f[]"),dOcclusionKernelSize:ct("number"),uBlurDepthBias:he("f"),uBlurDirectionX:he("f"),uBlurDirectionY:he("f"),uInvProjection:he("m4"),uNear:he("f"),uFar:he("f"),uBounds:he("v4"),dOrthographic:ct("number")};function jSe(e,t,r){let n={...cn,tSsaoDepth:P.create(t),uTexSize:P.create(Ie.create(t.getWidth(),t.getHeight())),uKernel:P.create(WSe(15)),dOcclusionKernelSize:P.create(15),uBlurDepthBias:P.create(.5),uBlurDirectionX:P.create(r==="horizontal"?1:0),uBlurDirectionY:P.create(r==="vertical"?1:0),uInvProjection:P.create(Z.identity()),uNear:P.create(0),uFar:P.create(1e4),uBounds:P.create(Ut()),dOrthographic:P.create(0)},o={...crt},i=Dr("ssao_blur",bn,HSe),a=Wr(e,"triangles",i,o,n);return Xr(a,n)}function WSe(e){let t=e/3,r=Math.floor((e+1)/2),n=[];for(let o=0;o<r;o++)n.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-o*o/(2*t*t)));return n}var IL=[];for(let e=0;e<256;e++){let t=b();t[0]=Math.random()*2-1,t[1]=Math.random()*2-1,t[2]=Math.random(),b.normalize(t,t),b.scale(t,t,Math.random()),IL.push(t)}function XSe(e){let t=[];for(let r=0;r<e;r++){let n=(r*r+2*r+1)/(e*e);n=.1+n*(1-.1),t.push(IL[r][0]*n),t.push(IL[r][1]*n),t.push(IL[r][2]*n)}return t}var mrt={...un,tSsaoDepth:pt("texture","rgba","ubyte","nearest"),tSsaoDepthTransparent:pt("texture","rgba","ubyte","nearest"),tColor:pt("texture","rgba","ubyte","nearest"),tTransparentColor:pt("texture","rgba","ubyte","nearest"),dBlendTransparency:ct("boolean"),tDepthOpaque:pt("texture","rgba","ubyte","nearest"),tDepthTransparent:pt("texture","rgba","ubyte","nearest"),tShadows:pt("texture","rgba","ubyte","nearest"),tOutlines:pt("texture","rgba","ubyte","nearest"),uTexSize:he("v2"),dOrthographic:ct("number"),uNear:he("f"),uFar:he("f"),uFogNear:he("f"),uFogFar:he("f"),uFogColor:he("v3"),uOutlineColor:he("v3"),uOcclusionColor:he("v3"),uTransparentBackground:he("b"),dOcclusionEnable:ct("boolean"),dOcclusionSingleDepth:ct("boolean"),dOcclusionIncludeOpacity:ct("boolean"),dOcclusionIncludeTransparency:ct("boolean"),uOcclusionOffset:he("v2"),dShadowEnable:ct("boolean"),dOutlineEnable:ct("boolean"),dOutlineScale:ct("number"),dTransparentOutline:ct("boolean")};function drt(e,t,r,n,o,i,a,s,l,u){let c={...cn,tSsaoDepth:P.create(s),tSsaoDepthTransparent:P.create(l),tColor:P.create(t),tTransparentColor:P.create(r),dBlendTransparency:P.create(!0),tDepthOpaque:P.create(n),tDepthTransparent:P.create(o),tShadows:P.create(i),tOutlines:P.create(a),uTexSize:P.create(Ie.create(t.getWidth(),t.getHeight())),dOrthographic:P.create(0),uNear:P.create(1),uFar:P.create(1e4),uFogNear:P.create(1e4),uFogFar:P.create(1e4),uFogColor:P.create(b.create(1,1,1)),uOutlineColor:P.create(b.create(0,0,0)),uOcclusionColor:P.create(b.create(0,0,0)),uTransparentBackground:P.create(!1),dOcclusionEnable:P.create(!0),dOcclusionSingleDepth:P.create(!1),dOcclusionIncludeOpacity:P.create(!0),dOcclusionIncludeTransparency:P.create(!1),uOcclusionOffset:P.create(Ie.create(0,0)),dShadowEnable:P.create(!1),dOutlineEnable:P.create(!1),dOutlineScale:P.create(1),dTransparentOutline:P.create(u)},m={...mrt},d=Dr("postprocessing",bn,fSe),p=Wr(e,"triangles",d,m,c);return Xr(p,c)}var iA={occlusion:C.MappedStatic("on",{on:C.Group(AL),off:C.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),shadow:C.MappedStatic("off",{on:C.Group(vL),off:C.Group({})},{cycle:!0,description:"Simplistic shadows"}),outline:C.MappedStatic("off",{on:C.Group(SL),off:C.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),dof:C.MappedStatic("off",{on:C.Group(LSe),off:C.Group({})},{cycle:!0,description:"DOF"}),antialiasing:C.MappedStatic("smaa",{fxaa:C.Group(gSe),smaa:C.Group(ISe),off:C.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"}),sharpening:C.MappedStatic("off",{on:C.Group(BSe),off:C.Group({})},{cycle:!0,description:"Contrast Adaptive Sharpening"}),background:C.Group(ESe,{isFlat:!0}),bloom:C.MappedStatic("on",{on:C.Group(GSe),off:C.Group({})},{cycle:!0,description:"Bloom"})},Rs=class e{constructor(t,r,n){this.webgl=t;this.drawPass=n;this.occlusionOffset=[0,0];this.transparentBackground=!1;let{colorTarget:o,transparentColorTarget:i,depthTextureOpaque:a,depthTextureTransparent:s,packedDepth:l}=n,u=o.getWidth(),c=o.getHeight();this.target=t.createRenderTarget(u,c,!1,"uint8","linear"),this.ssao=new vf(t,u,c,l,a,s),this.shadow=new oA(t,u,c,a),this.outline=new Qx(t,u,c,s,a),this.renderable=drt(t,o.texture,i.texture,a,s,this.shadow.target.texture,this.outline.target.texture,this.ssao.ssaoDepthTexture,this.ssao.ssaoDepthTransparentTexture,!0),this.background=new bL(t,r,u,c)}static isEnabled(t){return vf.isEnabled(t)||oA.isEnabled(t)||Qx.isEnabled(t)||t.background.variant.name!=="off"}static isTransparentDepthRequired(t,r){return Sf.isEnabled(r)||Qx.isEnabled(r)&&e.isTransparentOutlineEnabled(r)||vf.isEnabled(r)&&e.isTransparentSsaoEnabled(t,r)}static isTransparentOutlineEnabled(t){return Qx.isEnabled(t)&&(t.outline.params.includeTransparent??!0)}static isTransparentSsaoEnabled(t,r){return vf.isEnabled(r)&&vf.isTransparentEnabled(t,r.occlusion.params)}static isSsaoEnabled(t){return vf.isEnabled(t)}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;(t!==n||r!==o)&&(this.target.setSize(t,r),P.update(this.renderable.values.uTexSize,Ie.set(this.renderable.values.uTexSize.ref.value,t,r))),this.ssao.setSize(t,r),this.shadow.setSize(t,r),this.outline.setSize(t,r),this.background.setSize(t,r)}reset(){this.ssao.reset()}updateState(t,r,n,o,i,a,s){let l=!1,u=t.state.mode==="orthographic"?1:0,c=Qx.isEnabled(i),m=oA.isEnabled(i),d=vf.isEnabled(i);if(d){let y=i.occlusion.params;this.ssao.update(t,r,y);let g=vf.isTransparentEnabled(r,y);this.renderable.values.dOcclusionIncludeTransparency.ref.value!==g&&(l=!0,P.update(this.renderable.values.dOcclusionIncludeTransparency,g)),P.update(this.renderable.values.uOcclusionColor,Fe.toVec3Normalized(this.renderable.values.uOcclusionColor.ref.value,y.color))}if(m&&this.shadow.update(t,a,s,i.shadow.params),c){let y=i.outline.params,{transparentOutline:g,outlineScale:x}=this.outline.update(t,y,this.drawPass.depthTextureTransparent,this.drawPass.depthTextureOpaque);P.update(this.renderable.values.uOutlineColor,Fe.toVec3Normalized(this.renderable.values.uOutlineColor.ref.value,y.color)),this.renderable.values.dOutlineScale.ref.value!==x&&(l=!0,P.update(this.renderable.values.dOutlineScale,x)),this.renderable.values.dTransparentOutline.ref.value!==g&&(l=!0,P.update(this.renderable.values.dTransparentOutline,g))}P.updateIfChanged(this.renderable.values.uFar,t.far),P.updateIfChanged(this.renderable.values.uNear,t.near),P.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),P.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),P.update(this.renderable.values.uFogColor,Fe.toVec3Normalized(this.renderable.values.uFogColor.ref.value,o)),P.updateIfChanged(this.renderable.values.uTransparentBackground,n),this.renderable.values.dOrthographic.ref.value!==u&&(l=!0,P.update(this.renderable.values.dOrthographic,u)),this.renderable.values.dOutlineEnable.ref.value!==c&&(l=!0,P.update(this.renderable.values.dOutlineEnable,c)),this.renderable.values.dShadowEnable.ref.value!==m&&(l=!0,P.update(this.renderable.values.dShadowEnable,m)),this.renderable.values.dOcclusionEnable.ref.value!==d&&(l=!0,P.update(this.renderable.values.dOcclusionEnable,d));let p=r.opacityAverage<1;this.renderable.values.dBlendTransparency.ref.value!==p&&(l=!0,P.update(this.renderable.values.dBlendTransparency,p)),l&&this.renderable.update();let{gl:h,state:f}=this.webgl;f.enable(h.SCISSOR_TEST),f.disable(h.BLEND),f.disable(h.DEPTH_TEST),f.depthMask(!1)}setOcclusionOffset(t,r){this.occlusionOffset[0]=t,this.occlusionOffset[1]=r,P.update(this.renderable.values.uOcclusionOffset,Ie.set(this.renderable.values.uOcclusionOffset.ref.value,t,r))}setTransparentBackground(t){this.transparentBackground=t}render(t,r,n,o,i,a,s,l){He&&this.webgl.timer.mark("PostprocessingPass.render"),this.updateState(t,r,o,i,a,s,l);let{state:u}=this.webgl,{x:c,y:m,width:d,height:p}=t.viewport;a.occlusion.name==="on"&&this.occlusionOffset[0]===0&&this.occlusionOffset[1]===0&&this.ssao.render(t),u.viewport(c,m,d,p),u.scissor(c,m,d,p),a.outline.name==="on"&&this.outline.render(),a.shadow.name==="on"&&this.shadow.render(),n?this.webgl.bindDrawingBuffer():this.target.bind(),this.background.update(t,a.background),this.background.clear(a.background,this.transparentBackground,i),this.background.render(a.background),this.renderable.render(),He&&this.webgl.timer.markEnd("PostprocessingPass.render")}},If=class{static isEnabled(t){return t.antialiasing.name!=="off"}constructor(t,r,n){this.target=t.createRenderTarget(r,n,!1),this.internalTarget=t.createRenderTarget(r,n,!1),this.fxaa=new gL(t,this.target.texture),this.smaa=new yL(t,this.target.texture),this.cas=new xL(t,this.target.texture)}setSize(t,r){let n=this.target.texture.getWidth(),o=this.target.texture.getHeight();(t!==n||r!==o)&&(this.target.setSize(t,r),this.internalTarget.setSize(t,r),this.fxaa.setSize(t,r),this.smaa.supported&&this.smaa.setSize(t,r),this.cas.setSize(t,r))}_renderFxaa(t,r,n,o){o.antialiasing.name==="fxaa"&&(this.fxaa.update(r,o.antialiasing.params),this.fxaa.render(t.viewport,n))}_renderSmaa(t,r,n,o){o.antialiasing.name==="smaa"&&(this.smaa.update(r,o.antialiasing.params),this.smaa.render(t.viewport,n))}_renderAntialiasing(t,r,n,o){o.antialiasing.name==="fxaa"?this._renderFxaa(t,r,n,o):o.antialiasing.name==="smaa"&&this._renderSmaa(t,r,n,o)}_renderCas(t,r,n,o){o.sharpening.name==="on"&&(o.antialiasing.name!=="off"&&(r=this.internalTarget.texture),this.cas.update(r,o.sharpening.params),this.cas.render(t.viewport,n))}render(t,r,n,o){if(o.antialiasing.name==="off"&&o.sharpening.name==="off")return;if(o.antialiasing.name==="smaa"&&!this.smaa.supported){console.error('SMAA not supported, missing "HTMLImageElement"');return}let i=n===!0?void 0:n===!1?this.target:n;o.sharpening.name==="off"?this._renderAntialiasing(t,r,i,o):o.antialiasing.name==="off"?this._renderCas(t,r,i,o):(this._renderAntialiasing(t,r,this.internalTarget,o),this._renderCas(t,r,i,o))}};var TL=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`;var prt={...un,tColor:pt("texture","rgba","ubyte","nearest"),uTexSize:he("v2"),uWeight:he("f")},frt=Dr("compose",bn,TL);function hrt(e,t){let r={...cn,tColor:P.create(t),uTexSize:P.create(Ie.create(t.getWidth(),t.getHeight())),uWeight:P.create(1)},n={...prt},o=Wr(e,"triangles",frt,n,r);return Xr(o,r)}var PL={mode:C.Select("temporal",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:C.Numeric(2,{min:0,max:5,step:1},{description:"Take level^2 samples."}),reduceFlicker:C.Boolean(!0,{description:'Reduce flicker in "temporal" mode.'}),reuseOcclusion:C.Boolean(!0,{description:"Reuse occlusion data. It is faster but has some artefacts."})},My=class{constructor(t,r){this.webgl=t;this.drawPass=r;let{colorBufferFloat:n,textureFloat:o,colorBufferHalfFloat:i,textureHalfFloat:a}=t.extensions,s=r.colorTarget.getWidth(),l=r.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(s,l,!1);let u=i&&a?"fp16":n&&o?"float32":"uint8";this.composeTarget=t.createRenderTarget(s,l,!1,u),this.holdTarget=t.createRenderTarget(s,l,!1),this.compose=hrt(t,r.colorTarget.texture)}static isEnabled(t){return t.mode!=="off"}syncSize(){let t=this.drawPass.colorTarget.getWidth(),r=this.drawPass.colorTarget.getHeight(),[n,o]=this.compose.values.uTexSize.ref.value;(t!==n||r!==o)&&(this.colorTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.holdTarget.setSize(t,r),P.update(this.compose.values.uTexSize,Ie.set(this.compose.values.uTexSize.ref.value,t,r)))}render(t,r,n,o,i){return n.multiSample.mode==="temporal"&&!i?this.renderTemporalMultiSample(t,r,n,o):(this.renderMultiSample(r,o,n),-2)}bindOutputTarget(t){t?this.webgl.bindDrawingBuffer():this.colorTarget.bind()}renderMultiSample(t,r,n){let{camera:o}=t,{compose:i,composeTarget:a,drawPass:s,webgl:l}=this,{gl:u,state:c}=l;He&&l.timer.mark("MultiSamplePass.renderMultiSample");let m=J_[Math.max(0,Math.min(n.multiSample.sampleLevel,5))],{x:d,y:p,width:h,height:f}=o.viewport,y=1/m.length,g=1/32;o.viewOffset.enabled=!0,P.update(i.values.tColor,s.getColorTarget(n.postprocessing).texture),i.update();for(let x=0;x<m.length;++x){let S=m[x];mo.setViewOffset(o.viewOffset,h,f,S[0],S[1],h,f),o.update();let I=-.5+(x+.5)/m.length,v=y+g*I;P.update(i.values.uWeight,v),x===0||!n.multiSample.reuseOcclusion?s.postprocessing.setOcclusionOffset(0,0):s.postprocessing.setOcclusionOffset(S[0]/h,S[1]/f),s.render(t,n,!1),a.bind(),c.enable(u.BLEND),c.blendEquationSeparate(u.FUNC_ADD,u.FUNC_ADD),c.blendFuncSeparate(u.ONE,u.ONE,u.ONE,u.ONE),c.disable(u.DEPTH_TEST),c.depthMask(!1),c.viewport(d,p,h,f),c.scissor(d,p,h,f),x===0&&(c.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT)),i.render()}s.postprocessing.setOcclusionOffset(0,0),P.update(i.values.uWeight,1),P.update(i.values.tColor,a.texture),i.update(),this.bindOutputTarget(r),c.viewport(d,p,h,f),c.scissor(d,p,h,f),c.disable(u.BLEND),i.render(),o.viewOffset.enabled=!1,o.update(),He&&l.timer.markEnd("MultiSamplePass.renderMultiSample")}renderTemporalMultiSample(t,r,n,o){let{camera:i}=r,{compose:a,composeTarget:s,holdTarget:l,drawPass:u,webgl:c}=this,{gl:m,state:d}=c;He&&c.timer.mark("MultiSamplePass.renderTemporalMultiSample");let p=J_[Math.max(0,Math.min(n.multiSample.sampleLevel,5))];if(t===-2||t>=p.length)return-2;let{x:h,y:f,width:y,height:g}=i.viewport,x=1/p.length;if(t===-1)u.render(r,n,!1),P.update(a.values.uWeight,1),P.update(a.values.tColor,u.getColorTarget(n.postprocessing).texture),a.update(),l.bind(),d.disable(m.BLEND),d.disable(m.DEPTH_TEST),d.depthMask(!1),d.viewport(h,f,y,g),d.scissor(h,f,y,g),a.render(),t+=1;else{i.viewOffset.enabled=!0,P.update(a.values.tColor,u.getColorTarget(n.postprocessing).texture),P.update(a.values.uWeight,x),a.update();let I=Math.pow(2,Math.max(0,n.multiSample.sampleLevel-2));for(let v=0;v<I;++v){let A=p[t];if(mo.setViewOffset(i.viewOffset,y,g,A[0],A[1],y,g),i.update(),t===0||!n.multiSample.reuseOcclusion?u.postprocessing.setOcclusionOffset(0,0):u.postprocessing.setOcclusionOffset(A[0]/y,A[1]/g),u.render(r,n,!1),s.bind(),d.enable(m.BLEND),d.blendEquationSeparate(m.FUNC_ADD,m.FUNC_ADD),d.blendFuncSeparate(m.ONE,m.ONE,m.ONE,m.ONE),d.disable(m.DEPTH_TEST),d.depthMask(!1),d.viewport(h,f,y,g),d.scissor(h,f,y,g),t===0&&(d.clearColor(0,0,0,0),m.clear(m.COLOR_BUFFER_BIT)),a.render(),t+=1,t>=p.length)break}}u.postprocessing.setOcclusionOffset(0,0),this.bindOutputTarget(o),d.viewport(h,f,y,g),d.scissor(h,f,y,g);let S=t*x;return S>0&&(P.update(a.values.uWeight,1),P.update(a.values.tColor,s.texture),a.update(),d.disable(m.BLEND),a.render()),S<1&&(P.update(a.values.uWeight,1-S),P.update(a.values.tColor,l.texture),a.update(),S===0?d.disable(m.BLEND):d.enable(m.BLEND),a.render()),i.viewOffset.enabled=!1,i.update(),He&&c.timer.markEnd("MultiSamplePass.renderTemporalMultiSample"),t>=p.length?-2:t}},J_=[[[0,0]],[[0,0],[-4,-4]],[[0,0],[6,-2],[-6,2],[2,6]],[[0,0],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[0,0],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[0,0],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];J_.forEach(e=>{e.forEach(t=>{t[0]*=.0625,t[1]*=.0625})});var aA=class{constructor(t){this.multiSamplePass=t;this.sampleIndex=-2}update(t,r){return t&&(this.sampleIndex=-1),r.mode==="temporal"?this.sampleIndex!==-2:!1}render(t,r,n,o){return this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,r,n,!!o),this.sampleIndex<0}};var C8=Math.pow(2,24)-2,ZSe={pickPadding:1,maxAsyncReadLag:5},sA=class{constructor(t,r,n,o){this.webgl=t;this.width=r;this.height=n;this.pickScale=o;let i=o/t.pixelRatio;this.pickWidth=Math.ceil(r*i),this.pickHeight=Math.ceil(n*i);let{resources:a,extensions:{drawBuffers:s},gl:l}=t;s?(this.objectPickTexture=a.texture("image-uint8","rgba","ubyte","nearest"),this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture=a.texture("image-uint8","rgba","ubyte","nearest"),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture=a.texture("image-uint8","rgba","ubyte","nearest"),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture=a.texture("image-uint8","rgba","ubyte","nearest"),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.framebuffer=a.framebuffer(),this.objectPickFramebuffer=a.framebuffer(),this.instancePickFramebuffer=a.framebuffer(),this.groupPickFramebuffer=a.framebuffer(),this.depthPickFramebuffer=a.framebuffer(),this.framebuffer.bind(),s.drawBuffers([s.COLOR_ATTACHMENT0,s.COLOR_ATTACHMENT1,s.COLOR_ATTACHMENT2,s.COLOR_ATTACHMENT3]),this.objectPickTexture.attachFramebuffer(this.framebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.framebuffer,"color1"),this.groupPickTexture.attachFramebuffer(this.framebuffer,"color2"),this.depthPickTexture.attachFramebuffer(this.framebuffer,"color3"),this.depthRenderbuffer=Ht(l)?a.renderbuffer("depth32f","depth",this.pickWidth,this.pickHeight):a.renderbuffer("depth16","depth",this.pickWidth,this.pickHeight),this.depthRenderbuffer.attachFramebuffer(this.framebuffer),this.objectPickTexture.attachFramebuffer(this.objectPickFramebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.instancePickFramebuffer,"color0"),this.groupPickTexture.attachFramebuffer(this.groupPickFramebuffer,"color0"),this.depthPickTexture.attachFramebuffer(this.depthPickFramebuffer,"color0")):(this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight))}get pickRatio(){return this.pickScale/this.webgl.pixelRatio}setPickScale(t){this.pickScale=t,this.setSize(this.width,this.height)}bindObject(){this.webgl.extensions.drawBuffers?this.objectPickFramebuffer.bind():this.objectPickTarget.bind()}bindInstance(){this.webgl.extensions.drawBuffers?this.instancePickFramebuffer.bind():this.instancePickTarget.bind()}bindGroup(){this.webgl.extensions.drawBuffers?this.groupPickFramebuffer.bind():this.groupPickTarget.bind()}bindDepth(){this.webgl.extensions.drawBuffers?this.depthPickFramebuffer.bind():this.depthPickTarget.bind()}get drawingBufferHeight(){return this.height}setSize(t,r){this.width=t,this.height=r;let n=this.pickScale/this.webgl.pixelRatio,o=Math.ceil(this.width*n),i=Math.ceil(this.height*n);(o!==this.pickWidth||i!==this.pickHeight)&&(this.pickWidth=o,this.pickHeight=i,this.webgl.extensions.drawBuffers?(this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.depthRenderbuffer.setSize(this.pickWidth,this.pickHeight)):(this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight)))}reset(){let{drawBuffers:t}=this.webgl.extensions;t&&(this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2,t.COLOR_ATTACHMENT3]),this.objectPickTexture.attachFramebuffer(this.framebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.framebuffer,"color1"),this.groupPickTexture.attachFramebuffer(this.framebuffer,"color2"),this.depthPickTexture.attachFramebuffer(this.framebuffer,"color3"),this.depthRenderbuffer.attachFramebuffer(this.framebuffer),this.objectPickTexture.attachFramebuffer(this.objectPickFramebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.instancePickFramebuffer,"color0"),this.groupPickTexture.attachFramebuffer(this.groupPickFramebuffer,"color0"),this.depthPickTexture.attachFramebuffer(this.depthPickFramebuffer,"color0"))}renderVariant(t,r,n,o,i,a){t.clear(!1),t.update(r,n),t.renderPick(n.primitives,r,i,a),o.handle.isEnabled&&t.renderPick(o.handle.scene,r,i,a),o.camera.isEnabled&&(o.camera.update(r),t.update(o.camera.camera,o.camera.scene),t.renderPick(o.camera.scene,o.camera.camera,i,a))}render(t,r,n,o){this.webgl.extensions.drawBuffers?(this.framebuffer.bind(),this.renderVariant(t,r,n,o,"pick",0)):(this.objectPickTarget.bind(),this.renderVariant(t,r,n,o,"pick",1),this.instancePickTarget.bind(),this.renderVariant(t,r,n,o,"pick",2),this.groupPickTarget.bind(),this.renderVariant(t,r,n,o,"pick",3),this.depthPickTarget.bind(),this.renderVariant(t,r,n,o,"depth",0))}},QSe=!1;function _L(e){return e.isWebGL2?!0:($t&&!QSe&&(console.log("WebGL2 required for async picking. Falling back to synchronous picking."),QSe=!0),!1)}var lA=class{constructor(t,r,n=5){this.webgl=t;this.pickPass=r;this.maxAsyncReadLag=n;this.viewport=co.create(0,0,0,0);this.fenceSync=null;this.fenceTimestamp=0;this.ready=!1;this.lag=0;this.asyncReadExpired=!1;let{gl:o}=t;this.objectBuffer=dy(o),this.instanceBuffer=dy(o),this.groupBuffer=dy(o),this.depthBuffer=dy(o),this.setup()}setup(){let t=this.viewport.width*this.viewport.height*4;(!this.object||this.object.length!==t)&&(this.object=new Uint8Array(t),this.instance=new Uint8Array(t),this.group=new Uint8Array(t),this.depth=new Uint8Array(t))}setViewport(t,r,n,o){co.set(this.viewport,t,r,n,o),this.setup()}read(){He&&this.webgl.timer.mark("PickBuffers.read");let{x:t,y:r,width:n,height:o}=this.viewport;this.pickPass.bindObject(),this.webgl.readPixels(t,r,n,o,this.object),this.pickPass.bindInstance(),this.webgl.readPixels(t,r,n,o,this.instance),this.pickPass.bindGroup(),this.webgl.readPixels(t,r,n,o,this.group),this.pickPass.bindDepth(),this.webgl.readPixels(t,r,n,o,this.depth),this.ready=!0,He&&this.webgl.timer.markEnd("PickBuffers.read")}get pending(){return this.fenceSync!==null}asyncRead(){let{gl:t}=this.webgl;if(!Ht(t))return;this.asyncReadExpired=!1,this.lag=0,He&&this.webgl.timer.mark("PickBuffers.asyncRead"),this.fenceSync!==null&&t.deleteSync(this.fenceSync);let{x:r,y:n,width:o,height:i}=this.viewport;this.pickPass.bindObject(),t.bindBuffer(t.PIXEL_PACK_BUFFER,this.objectBuffer),t.bufferData(t.PIXEL_PACK_BUFFER,this.object.byteLength,t.STREAM_READ),t.readPixels(r,n,o,i,t.RGBA,t.UNSIGNED_BYTE,0),this.pickPass.bindInstance(),t.bindBuffer(t.PIXEL_PACK_BUFFER,this.instanceBuffer),t.bufferData(t.PIXEL_PACK_BUFFER,this.instance.byteLength,t.STREAM_READ),t.readPixels(r,n,o,i,t.RGBA,t.UNSIGNED_BYTE,0),this.pickPass.bindGroup(),t.bindBuffer(t.PIXEL_PACK_BUFFER,this.groupBuffer),t.bufferData(t.PIXEL_PACK_BUFFER,this.group.byteLength,t.STREAM_READ),t.readPixels(r,n,o,i,t.RGBA,t.UNSIGNED_BYTE,0),this.pickPass.bindDepth(),t.bindBuffer(t.PIXEL_PACK_BUFFER,this.depthBuffer),t.bufferData(t.PIXEL_PACK_BUFFER,this.depth.byteLength,t.STREAM_READ),t.readPixels(r,n,o,i,t.RGBA,t.UNSIGNED_BYTE,0),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),this.lag=0,this.fenceTimestamp=Mn(),this.fenceSync=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0),this.ready=!1,He&&this.webgl.timer.markEnd("PickBuffers.asyncRead")}check(){if(this.ready)return!0;if(this.fenceSync===null)return!1;let{gl:t}=this.webgl;if(!Ht(t))return!0;let r=t.clientWaitSync(this.fenceSync,0,0);return r===t.WAIT_FAILED||this.lag>=this.maxAsyncReadLag?Mn()-this.fenceTimestamp<1e3/30?(this.lag+=1,!1):(t.deleteSync(this.fenceSync),this.fenceSync=null,this.lag=0,this.ready=!1,this.asyncReadExpired=!0,!1):r===t.TIMEOUT_EXPIRED?(this.lag+=1,!1):(t.bindBuffer(t.PIXEL_PACK_BUFFER,this.objectBuffer),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this.object),t.bindBuffer(t.PIXEL_PACK_BUFFER,this.instanceBuffer),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this.instance),t.bindBuffer(t.PIXEL_PACK_BUFFER,this.groupBuffer),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this.group),t.bindBuffer(t.PIXEL_PACK_BUFFER,this.depthBuffer),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this.depth),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),t.deleteSync(this.fenceSync),this.fenceSync=null,this.lag=0,this.ready=!0,!0)}getIdx(t,r){return(r*this.viewport.width+t)*4}getDepth(t,r){if(!this.ready)return-1;let n=this.getIdx(t,r),o=this.depth;return dhe(o[n],o[n+1],o[n+2],o[n+3])}getId(t,r,n){if(!this.ready)return-1;let o=this.getIdx(t,r);return Ix(n[o],n[o+1],n[o+2])}getObjectId(t,r){return this.getId(t,r,this.object)}getInstanceId(t,r){return this.getId(t,r,this.instance)}getGroupId(t,r){return this.getId(t,r,this.group)}getPickingId(t,r){let n=this.getObjectId(t,r);if(n===-1||n===C8)return;let o=this.getInstanceId(t,r);if(o===-1||o===C8)return;let i=this.getGroupId(t,r);if(!(i===-1||i===C8))return{objectId:n,instanceId:o,groupId:i}}};var S8={eyeSeparation:C.Numeric(.062,{min:.02,max:.1,step:.001},{description:"Distance between left and right camera."}),focus:C.Numeric(10,{min:1,max:20,step:.1},{description:"Apparent object distance."})},grt=C.getDefaultValues(S8);var Af=class{constructor(t,r={}){this.parent=t;this.left=new RL;this.right=new RL;this.props={...grt,...r}}get viewport(){return this.parent.viewport}get viewOffset(){return this.parent.viewOffset}setProps(t){Object.assign(this.props,t)}update(){this.parent.update(),yrt(this.parent,this.props,this.left,this.right)}};(t=>{function e(r){return"left"in r&&"right"in r}t.is=e})(Af||={});var RL=class{constructor(){this.viewport=co.create(0,0,0,0);this.view=Z();this.projection=Z();this.projectionView=Z();this.inverseProjectionView=Z();this.headRotation=Z();this.state=mo.createDefaultSnapshot();this.viewOffset=mo.ViewOffset();this.far=0;this.near=0;this.fogFar=0;this.fogNear=0}},qSe=Z.identity(),YSe=Z.identity();function KSe(e,t){co.copy(t.viewport,e.viewport),Z.copy(t.view,e.view),Z.copy(t.projection,e.projection),Z.copy(t.headRotation,e.headRotation),mo.copySnapshot(t.state,e.state),mo.copyViewOffset(t.viewOffset,e.viewOffset),t.far=e.far,t.near=e.near,t.fogFar=e.fogFar,t.fogNear=e.fogNear}function yrt(e,t,r,n){KSe(e,r),KSe(e,n);let o=Math.floor(e.viewport.width/2),i=o/e.viewport.height;r.viewport.width=o,n.viewport.x+=o,n.viewport.width-=o;let a=t.eyeSeparation/2,s=a*e.near/t.focus,l=e.near*Math.tan(e.state.fov*.5),u,c;qSe[12]=-a,YSe[12]=a,u=-l*i+s,c=l*i+s,r.projection[0]=2*e.near/(c-u),r.projection[8]=(c+u)/(c-u),Z.mul(r.view,r.view,qSe),Z.mul(r.projectionView,r.projection,r.view),Z.invert(r.inverseProjectionView,r.projectionView),u=-l*i-s,c=l*i-s,n.projection[0]=2*e.near/(c-u),n.projection[8]=(c+u)/(c-u),Z.mul(n.view,n.view,YSe),Z.mul(n.projectionView,n.projection,n.view),Z.invert(n.inverseProjectionView,n.projectionView)}var DL=class{constructor(t,r,n,o,i,a,s){this.webgl=t;this.renderer=r;this.scene=n;this.helper=o;this.pickPass=i;this.dirty=!0;this.buffers=new lA(this.webgl,this.pickPass);this.viewport=co();this.setViewport(a.x,a.y,a.width,a.height),this.pickPadding=s.pickPadding,_L(t)||(this.asyncIdentify=(l,u,c)=>({tryGet:()=>this.identify(l,u,c)}))}setViewport(t,r,n,o){co.set(this.viewport,t,r,n,o),this.update()}setPickPadding(t){this.pickPadding!==t&&(this.pickPadding=t,this.update())}update(){let{x:t,y:r,width:n,height:o}=this.viewport;this.pickRatio=this.pickPass.pickRatio,this.pickX=Math.ceil(t*this.pickRatio),this.pickY=Math.ceil(r*this.pickRatio);let i=Math.floor(n*this.pickRatio),a=Math.floor(o*this.pickRatio);(i!==this.pickWidth||a!==this.pickHeight)&&(this.pickWidth=i,this.pickHeight=a,this.halfPickWidth=Math.floor(this.pickWidth/2),this.buffers.setViewport(this.pickX,this.pickY,this.pickWidth,this.pickHeight)),this.spiral=ow(Math.ceil(this.pickRatio*this.pickPadding)),this.dirty=!0}render(t){He&&this.webgl.timer.mark("PickHelper.render",{captureStats:!0});let{pickX:r,pickY:n,pickWidth:o,pickHeight:i,halfPickWidth:a}=this,{renderer:s,scene:l,helper:u}=this;s.setTransparentBackground(!1),s.setDrawingBufferSize(o,i),s.setPixelRatio(this.pickRatio),Af.is(t)?(s.setViewport(r,n,a,i),this.pickPass.render(s,t.left,l,u),s.setViewport(r+a,n,o-a,i),this.pickPass.render(s,t.right,l,u)):(s.setViewport(r,n,o,i),this.pickPass.render(s,t,l,u)),this.dirty=!1,He&&this.webgl.timer.markEnd("PickHelper.render")}identifyInternal(t,r,n){if(this.webgl.isContextLost)return;let{webgl:o,pickRatio:i}=this;if(o.isContextLost)return;t*=o.pixelRatio,r*=o.pixelRatio,r=this.pickPass.drawingBufferHeight-r;let{viewport:a}=this;if(t<a.x||r<a.y||t>a.x+a.width||r>a.y+a.height)return;let s=t-a.x,l=r-a.y,u=Math.floor(s*i),c=Math.floor(l*i),m=this.buffers.getPickingId(u,c);if(m===void 0)return;let d=this.buffers.getDepth(u,c),p=b.create(t,r,d);if(Af.is(n)){let h=Math.floor(a.width/2);t>a.x+h?(p[0]=a.x+(s-h)*2,Hx(p,p,a,n.right.inverseProjectionView)):(p[0]=a.x+s*2,Hx(p,p,a,n.left.inverseProjectionView))}else Hx(p,p,a,n.inverseProjectionView);return{id:m,position:p}}prepare(){this.pickRatio!==this.pickPass.pickRatio&&this.update()}getPickData(t,r,n){for(let o of this.spiral){let i=this.identifyInternal(t+o[0],r+o[1],n);if(i)return i}}identify(t,r,n){return this.prepare(),this.dirty&&(He&&this.webgl.timer.mark("PickHelper.identify"),this.render(n),this.buffers.read(),He&&this.webgl.timer.markEnd("PickHelper.identify")),this.getPickData(t,r,n)}asyncIdentify(t,r,n){return this.prepare(),this.dirty?(He&&this.webgl.timer.mark("PickHelper.asyncIdentify"),this.render(n),this.buffers.asyncRead()):this.buffers.asyncReadExpired&&this.buffers.asyncRead(),{tryGet:()=>this.buffers.check()?this.getPickData(t,r,n):this.buffers.asyncReadExpired?"expired":"pending"}}};var JSe=`
precision highp float;

uniform sampler2D tWboitA;
uniform sampler2D tWboitB;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec4 accum = texture2D(tWboitA, coords);
    float r = 1.0 - accum.a;

    accum.a = texture2D(tWboitB, coords).r;
    // divisor needs to allow very small values for nice fading
    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);
}
`;var brt={...un,tWboitA:pt("texture","rgba","float","nearest"),tWboitB:pt("texture","rgba","float","nearest"),uTexSize:he("v2")},xrt=Dr("evaluate-wboit",bn,JSe);function Crt(e,t,r){let n={...cn,tWboitA:P.create(t),tWboitB:P.create(r),uTexSize:P.create(Ie.create(t.getWidth(),t.getHeight()))},o={...brt},i=Wr(e,"triangles",xrt,o,n);return Xr(i,n)}var wL=class e{constructor(t,r,n){this.webgl=t;this._supported=!1;if(!e.isSupported(t))return;let{resources:o,gl:i}=t;this.textureA=o.texture("image-float32","rgba","float","nearest"),this.textureA.define(r,n),this.textureB=o.texture("image-float32","rgba","float","nearest"),this.textureB.define(r,n),this.depthRenderbuffer=Ht(i)?o.renderbuffer("depth32f","depth",r,n):o.renderbuffer("depth16","depth",r,n),this.renderable=Crt(t,this.textureA,this.textureB),this.framebuffer=o.framebuffer(),this._supported=!0,this._init()}get supported(){return this._supported}bind(){let{state:t,gl:r}=this.webgl;this.framebuffer.bind(),t.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),t.disable(r.DEPTH_TEST),t.blendFuncSeparate(r.ONE,r.ONE,r.ZERO,r.ONE_MINUS_SRC_ALPHA),t.enable(r.BLEND)}render(){He&&this.webgl.timer.mark("WboitPass.render");let{state:t,gl:r}=this.webgl;t.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA),t.enable(r.BLEND),this.renderable.update(),this.renderable.render(),He&&this.webgl.timer.markEnd("WboitPass.render")}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;(t!==n||r!==o)&&(this.textureA.define(t,r),this.textureB.define(t,r),this.depthRenderbuffer.setSize(t,r),P.update(this.renderable.values.uTexSize,Ie.set(this.renderable.values.uTexSize.ref.value,t,r)))}reset(){this._supported&&this._init()}_init(){let{extensions:{drawBuffers:t}}=this.webgl;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1"),this.depthRenderbuffer.attachFramebuffer(this.framebuffer)}static isSupported(t){let{extensions:{drawBuffers:r,textureFloat:n,colorBufferFloat:o,depthTexture:i}}=t;if(!n||!o||!i||!r){if($t){let a=[];n||a.push("textureFloat"),o||a.push("colorBufferFloat"),i||a.push("depthTexture"),r||a.push("drawBuffers"),console.log(`Missing "${a.join('", "')}" extensions required for "wboit"`)}return!1}else return!0}};var $Se=`
precision highp float;

uniform sampler2D tDpoitFrontColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tDpoitFrontColor, coords);
}
`;var e1e=`
    precision highp float;

    uniform sampler2D tDpoitBackColor;
    uniform vec2 uTexSize;

    void main() {
        vec2 coords = gl_FragCoord.xy / uTexSize;
        gl_FragColor = texture2D(tDpoitBackColor, coords);
        if (gl_FragColor.a == 0.0) {
            discard;
        }
    }
`;var Srt={...un,tDpoitBackColor:pt("texture","rgba","float","nearest"),uTexSize:he("v2")},vrt=Dr("blend-back-dpoit",bn,e1e);function Irt(e,t){let r={...cn,tDpoitBackColor:P.create(t),uTexSize:P.create(Ie.create(t.getWidth(),t.getHeight()))},n={...Srt},o=Wr(e,"triangles",vrt,n,r);return Xr(o,r)}var Art={...un,tDpoitFrontColor:pt("texture","rgba","float","nearest"),uTexSize:he("v2")},Trt=Dr("evaluate-dpoit",bn,$Se);function Prt(e,t){let r={...cn,tDpoitFrontColor:P.create(t),uTexSize:P.create(Ie.create(t.getWidth(),t.getHeight()))},n={...Art},o=Wr(e,"triangles",Trt,n,r);return Xr(o,r)}var EL=class e{constructor(t,r,n){this.webgl=t;this.DEPTH_CLEAR_VALUE=-99999;this.MAX_DEPTH=1;this.MIN_DEPTH=0;this.passCount=0;this._supported=!1;if(!e.isSupported(t))return;let{resources:o,extensions:{colorBufferHalfFloat:i,textureHalfFloat:a}}=t;Ht(t.gl)?(this.depthTextures=[o.texture("image-float32","rg","float","nearest"),o.texture("image-float32","rg","float","nearest")],this.colorFrontTextures=i&&a?[o.texture("image-float16","rgba","fp16","nearest"),o.texture("image-float16","rgba","fp16","nearest")]:[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=i&&a?[o.texture("image-float16","rgba","fp16","nearest"),o.texture("image-float16","rgba","fp16","nearest")]:[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")]):(this.depthTextures=[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")],this.colorFrontTextures=[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")]),this.depthTextures[0].define(r,n),this.depthTextures[1].define(r,n),this.colorFrontTextures[0].define(r,n),this.colorFrontTextures[1].define(r,n),this.colorBackTextures[0].define(r,n),this.colorBackTextures[1].define(r,n),this.depthFramebuffers=[o.framebuffer(),o.framebuffer()],this.colorFramebuffers=[o.framebuffer(),o.framebuffer()],this.blendBackRenderable=Irt(t,this.colorBackTextures[0]),this.renderable=Prt(t,this.colorFrontTextures[0]),this._supported=!0,this._init()}get supported(){return this._supported}bind(){let{state:t,gl:r,extensions:{blendMinMax:n}}=this.webgl;return this.passCount=0,this.depthFramebuffers[0].bind(),t.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),r.clear(r.COLOR_BUFFER_BIT),this.depthFramebuffers[1].bind(),t.clearColor(-this.MIN_DEPTH,this.MAX_DEPTH,0,0),r.clear(r.COLOR_BUFFER_BIT),this.colorFramebuffers[0].bind(),t.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.colorFramebuffers[1].bind(),t.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.depthFramebuffers[0].bind(),t.blendEquation(n.MAX),t.depthMask(!1),{depth:this.depthTextures[1],frontColor:this.colorFrontTextures[1],backColor:this.colorBackTextures[1]}}bindDualDepthPeeling(){let{state:t,gl:r,extensions:{blendMinMax:n}}=this.webgl;return this.readId=this.passCount%2,this.writeId=1-this.readId,this.passCount+=1,this.depthFramebuffers[this.writeId].bind(),t.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),r.clear(r.COLOR_BUFFER_BIT),this.colorFramebuffers[this.writeId].bind(),t.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.depthFramebuffers[this.writeId].bind(),t.blendEquation(n.MAX),t.depthMask(!1),{depth:this.depthTextures[this.readId],frontColor:this.colorFrontTextures[this.readId],backColor:this.colorBackTextures[this.readId]}}renderBlendBack(){He&&this.webgl.timer.mark("DpoitPass.renderBlendBack");let{state:t,gl:r}=this.webgl;t.blendEquation(r.FUNC_ADD),t.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA),P.update(this.blendBackRenderable.values.tDpoitBackColor,this.colorBackTextures[this.writeId]),this.blendBackRenderable.update(),this.blendBackRenderable.render(),He&&this.webgl.timer.markEnd("DpoitPass.renderBlendBack")}render(){He&&this.webgl.timer.mark("DpoitPass.render");let{state:t,gl:r}=this.webgl;t.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),P.update(this.renderable.values.tDpoitFrontColor,this.colorFrontTextures[this.writeId]),this.renderable.update(),this.renderable.render(),He&&this.webgl.timer.markEnd("DpoitPass.render")}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;if(t!==n||r!==o){for(let i=0;i<2;i++)this.depthTextures[i].define(t,r),this.colorFrontTextures[i].define(t,r),this.colorBackTextures[i].define(t,r);P.update(this.renderable.values.uTexSize,Ie.set(this.renderable.values.uTexSize.ref.value,t,r)),P.update(this.blendBackRenderable.values.uTexSize,Ie.set(this.blendBackRenderable.values.uTexSize.ref.value,t,r))}}reset(){this._supported&&this._init()}_init(){let{extensions:{drawBuffers:t}}=this.webgl;for(let r=0;r<2;r++)this.depthFramebuffers[r].bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2]),this.colorFrontTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color0"),this.colorBackTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color1"),this.depthTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color2"),this.colorFramebuffers[r].bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.colorFrontTextures[r].attachFramebuffer(this.colorFramebuffers[r],"color0"),this.colorBackTextures[r].attachFramebuffer(this.colorFramebuffers[r],"color1")}static isSupported(t){let{extensions:{drawBuffers:r,textureFloat:n,colorBufferFloat:o,depthTexture:i,blendMinMax:a}}=t;if(!n||!o||!i||!r||!a){if($t){let s=[];n||s.push("textureFloat"),o||s.push("colorBufferFloat"),i||s.push("depthTexture"),r||s.push("drawBuffers"),a||s.push("blendMinMax"),console.log(`Missing "${s.join('", "')}" extensions required for "dpoit"`)}return!1}else return!0}};var t1e=`
precision highp float;
precision highp sampler2D;

uniform vec2 uTexSizeInv;
uniform sampler2D tEdgeTexture;
uniform vec3 uHighlightEdgeColor;
uniform vec3 uSelectEdgeColor;
uniform float uHighlightEdgeStrength;
uniform float uSelectEdgeStrength;
uniform float uGhostEdgeStrength;
uniform float uInnerEdgeFactor;

void main() {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 edgeValue = texture2D(tEdgeTexture, coords);
    if (edgeValue.a > 0.0) {
        vec3 edgeColor = edgeValue.b == 1.0 ? uHighlightEdgeColor : uSelectEdgeColor;
        gl_FragColor.rgb = edgeValue.g > 0.0 ? edgeColor : edgeColor * uInnerEdgeFactor;
        gl_FragColor.a = (edgeValue.r == 1.0 ? uGhostEdgeStrength : 1.0) * edgeValue.a;
        float edgeStrength = edgeValue.b == 1.0 ? uHighlightEdgeStrength : uSelectEdgeStrength;
        gl_FragColor.a *= edgeStrength;
    } else {
        gl_FragColor = vec4(0.0);
    }
}
`;var r1e=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tMaskTexture;
uniform vec2 uTexSizeInv;

void main() {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 offset = vec4(float(dEdgeScale), 0.0, 0.0, float(dEdgeScale)) * vec4(uTexSizeInv, uTexSizeInv);
    vec4 c0 = texture2D(tMaskTexture, coords);
    vec4 c1 = texture2D(tMaskTexture, coords + offset.xy);
    vec4 c2 = texture2D(tMaskTexture, coords - offset.xy);
    vec4 c3 = texture2D(tMaskTexture, coords + offset.yw);
    vec4 c4 = texture2D(tMaskTexture, coords - offset.yw);
    float diff1 = (c1.r - c2.r) * 0.5;
    float diff2 = (c3.r - c4.r) * 0.5;
    float d = length(vec2(diff1, diff2));
    if (d <= 0.0)
        discard;
    float a1 = min(c1.g, c2.g);
    float a2 = min(c3.g, c4.g);
    float visibility = min(a1, a2) > 0.001 ? 1.0 : 0.0;
    float mask = c0.r;
    float marker = min(c1.b, min(c2.b, min(c3.b, c4.b)));
    float fogAlpha = min(c1.a, min(c2.a, min(c3.a, c4.a)));
    gl_FragColor = vec4(visibility, mask, marker, fogAlpha);
}
`;var ML={enabled:C.Boolean(!0),highlightEdgeColor:C.Color(Fe.darken(Fe.fromNormalizedRgb(1,.4,.6),1)),selectEdgeColor:C.Color(Fe.darken(Fe.fromNormalizedRgb(.2,1,.1),1)),edgeScale:C.Numeric(1,{min:1,max:3,step:1},{description:"Thickness of the edge."}),highlightEdgeStrength:C.Numeric(1,{min:0,max:1,step:.1}),selectEdgeStrength:C.Numeric(1,{min:0,max:1,step:.1}),ghostEdgeStrength:C.Numeric(.3,{min:0,max:1,step:.1},{description:"Opacity of the hidden edges that are covered by other geometry. When set to 1, one less geometry render pass is done."}),innerEdgeFactor:C.Numeric(1.5,{min:0,max:3,step:.1},{description:"Factor to multiply the inner edge color with - for added contrast."})},Zx=class{constructor(t,r,n){this.webgl=t;this.depthTarget=t.createRenderTarget(r,n),this.maskTarget=t.createRenderTarget(r,n),this.edgesTarget=t.createRenderTarget(r,n),this.edge=Drt(t,this.maskTarget.texture),this.overlay=Mrt(t,this.edgesTarget.texture)}static isEnabled(t){return t.enabled}setEdgeState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.enable(r.BLEND),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:a,height:s}=t;n.viewport(o,i,a,s),n.scissor(o,i,a,s),n.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT)}setOverlayState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.enable(r.BLEND),n.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),n.blendEquation(r.FUNC_ADD),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:a,height:s}=t;n.viewport(o,i,a,s),n.scissor(o,i,a,s)}setSize(t,r){let n=this.depthTarget.getWidth(),o=this.depthTarget.getHeight();(t!==n||r!==o)&&(this.depthTarget.setSize(t,r),this.maskTarget.setSize(t,r),this.edgesTarget.setSize(t,r),P.update(this.edge.values.uTexSizeInv,Ie.set(this.edge.values.uTexSizeInv.ref.value,1/t,1/r)),P.update(this.overlay.values.uTexSizeInv,Ie.set(this.overlay.values.uTexSizeInv.ref.value,1/t,1/r)))}update(t){let{highlightEdgeColor:r,selectEdgeColor:n,edgeScale:o,innerEdgeFactor:i,ghostEdgeStrength:a,highlightEdgeStrength:s,selectEdgeStrength:l}=t,{values:u}=this.edge,c=Math.max(1,Math.round(o*this.webgl.pixelRatio));u.dEdgeScale.ref.value!==c&&(P.update(u.dEdgeScale,c),this.edge.update());let{values:m}=this.overlay;P.update(m.uHighlightEdgeColor,Fe.toVec3Normalized(m.uHighlightEdgeColor.ref.value,r)),P.update(m.uSelectEdgeColor,Fe.toVec3Normalized(m.uSelectEdgeColor.ref.value,n)),P.updateIfChanged(m.uInnerEdgeFactor,i),P.updateIfChanged(m.uGhostEdgeStrength,a),P.updateIfChanged(m.uHighlightEdgeStrength,s),P.updateIfChanged(m.uSelectEdgeStrength,l)}render(t,r){He&&this.webgl.timer.mark("MarkingPass.render"),this.edgesTarget.bind(),this.setEdgeState(t),this.edge.render(),r.bind(),this.setOverlayState(t),this.overlay.render(),He&&this.webgl.timer.markEnd("MarkingPass.render")}},_rt={...un,tMaskTexture:pt("texture","rgba","ubyte","linear"),uTexSizeInv:he("v2"),dEdgeScale:ct("number")},Rrt=Dr("edge",bn,r1e);function Drt(e,t){let r=t.getWidth(),n=t.getHeight(),o={...cn,tMaskTexture:P.create(t),uTexSizeInv:P.create(Ie.create(1/r,1/n)),dEdgeScale:P.create(1)},i={..._rt},a=Wr(e,"triangles",Rrt,i,o);return Xr(a,o)}var wrt={...un,tEdgeTexture:pt("texture","rgba","ubyte","linear"),uTexSizeInv:he("v2"),uHighlightEdgeColor:he("v3"),uSelectEdgeColor:he("v3"),uHighlightEdgeStrength:he("f"),uSelectEdgeStrength:he("f"),uGhostEdgeStrength:he("f"),uInnerEdgeFactor:he("f")},Ert=Dr("overlay",bn,t1e);function Mrt(e,t){let r=t.getWidth(),n=t.getHeight(),o={...cn,tEdgeTexture:P.create(t),uTexSizeInv:P.create(Ie.create(1/r,1/n)),uHighlightEdgeColor:P.create(b()),uSelectEdgeColor:P.create(b()),uHighlightEdgeStrength:P.create(1),uSelectEdgeStrength:P.create(1),uGhostEdgeStrength:P.create(0),uInnerEdgeFactor:P.create(0)},i={...wrt},a=Wr(e,"triangles",Ert,i,o);return Xr(a,o)}var uA=class{constructor(t,r,n,o,i){this.webgl=t;this.transparencyMode="blended";let{extensions:a,resources:s,isWebGL2:l}=t;this.drawTarget=t.createDrawTarget(),this.colorTarget=t.createRenderTarget(n,o,!0,"uint8","linear"),this.transparentColorTarget=t.createRenderTarget(n,o,!1,"uint8","linear"),this.packedDepth=!a.depthTexture,this.depthTargetTransparent=t.createRenderTarget(n,o),this.depthTextureTransparent=this.depthTargetTransparent.texture,this.depthTargetOpaque=this.packedDepth?t.createRenderTarget(n,o):null,this.depthTextureOpaque=this.depthTargetOpaque?this.depthTargetOpaque.texture:s.texture("image-depth","depth",l?"float":"ushort","nearest"),this.packedDepth||this.depthTextureOpaque.define(n,o),this.wboit=new wL(t,n,o),this.dpoit=new EL(t,n,o),this.marking=new Zx(t,n,o),this.postprocessing=new Rs(t,r,this),this.antialiasing=new If(t,n,o),this.bloom=new CL(t,n,o),this.dof=new Sf(t,n,o),this.copyFboTarget=mm(t,this.colorTarget.texture),this.copyFboPostprocessing=mm(t,this.postprocessing.target.texture),this.setTransparency(i)}setTransparency(t){t==="wboit"?(this.transparencyMode=this.wboit.supported?"wboit":"blended",$t&&!this.wboit.supported&&console.log('Missing "wboit" support, falling back to "blended".')):t==="dpoit"?(this.transparencyMode=this.dpoit.supported?"dpoit":"blended",$t&&!this.dpoit.supported&&console.log('Missing "dpoit" support, falling back to "blended".')):this.transparencyMode="blended",this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth")}get transparency(){return this.transparencyMode}reset(){this.wboit.reset(),this.dpoit.reset(),this.postprocessing.reset()}setSize(t,r){let n=this.colorTarget.getWidth(),o=this.colorTarget.getHeight();(t!==n||r!==o)&&(this.colorTarget.setSize(t,r),this.depthTargetTransparent.setSize(t,r),this.transparentColorTarget.setSize(t,r),this.depthTargetOpaque?this.depthTargetOpaque.setSize(t,r):this.depthTextureOpaque.define(t,r),P.update(this.copyFboTarget.values.uTexSize,Ie.set(this.copyFboTarget.values.uTexSize.ref.value,t,r)),P.update(this.copyFboPostprocessing.values.uTexSize,Ie.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,r))),this.wboit.supported&&this.wboit.setSize(t,r),this.dpoit.supported&&this.dpoit.setSize(t,r),this.marking.setSize(t,r),this.postprocessing.setSize(t,r),this.antialiasing.setSize(t,r),this.dof.setSize(t,r),this.bloom.setSize(t,r)}_renderDpoit(t,r,n,o,i,a){if(!this.dpoit.supported)throw new Error("expected dpoit to be supported");this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderOpaque(n.primitives,r),this.depthTextureOpaque.detachFramebuffer(this.colorTarget.framebuffer,"depth"),Rs.isTransparentDepthRequired(n,a)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque));let s=Rs.isEnabled(a);if(n.opacityAverage<1){let l=s?this.transparentColorTarget:this.colorTarget;s&&(l.bind(),t.clear(!1,!1,!0));let u=this.dpoit.bind();t.renderDpoitTransparent(n.primitives,r,this.depthTextureOpaque,u);for(let c=0;c<o;c++){He&&this.webgl.timer.mark("DpoitPass.layer");let m=this.dpoit.bindDualDepthPeeling();t.renderDpoitTransparent(n.primitives,r,this.depthTextureOpaque,m),l.bind(),this.dpoit.renderBlendBack(),He&&this.webgl.timer.markEnd("DpoitPass.layer")}l.bind(),this.dpoit.render()}Rs.isEnabled(a)&&this.postprocessing.render(r,n,!1,i,t.props.backgroundColor,a,t.light,t.ambientColor),n.volumes.renderables.length>0&&t.renderVolume(n.volumes,r,this.depthTextureOpaque)}_renderWboit(t,r,n,o,i){if(!this.wboit.supported)throw new Error("expected wboit to be supported");this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderOpaque(n.primitives,r),Rs.isTransparentDepthRequired(n,i)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque));let a=Rs.isEnabled(i);if(n.opacityAverage<1){let s=a?this.transparentColorTarget:this.colorTarget;a&&(s.bind(),t.clear(!1,!1,!0)),this.wboit.bind(),t.renderWboitTransparent(n.primitives,r,this.depthTextureOpaque),s.bind(),this.wboit.render()}Rs.isEnabled(i)&&this.postprocessing.render(r,n,!1,o,t.props.backgroundColor,i,t.light,t.ambientColor),n.volumes.renderables.length>0&&(this.wboit.bind(),t.renderWboitTransparent(n.volumes,r,this.depthTextureOpaque),(a?this.postprocessing.target:this.colorTarget).bind(),this.wboit.render())}_renderBlended(t,r,n,o,i,a){if(o?this.drawTarget.bind():this.packedDepth?this.colorTarget.bind():this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderOpaque(n.primitives,r),o)n.opacityAverage<1&&t.renderBlendedTransparent(n.primitives,r);else{this.depthTargetOpaque&&(this.depthTargetOpaque.bind(),t.clearDepth(!0),t.renderDepthOpaque(n.primitives,r),this.colorTarget.bind()),Rs.isTransparentDepthRequired(n,a)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque));let s=Rs.isEnabled(a);if(n.opacityAverage<1&&(s&&(this.transparentColorTarget.bind(),t.clear(!1,!1,!0),this.packedDepth?this.colorTarget.depthRenderbuffer?.attachFramebuffer(this.transparentColorTarget.framebuffer):this.depthTextureOpaque.attachFramebuffer(this.transparentColorTarget.framebuffer,"depth")),t.renderBlendedTransparent(n.primitives,r),s&&(this.packedDepth?this.colorTarget.depthRenderbuffer?.detachFramebuffer(this.transparentColorTarget.framebuffer):this.depthTextureOpaque.detachFramebuffer(this.transparentColorTarget.framebuffer,"depth"))),s&&(this.packedDepth?this.colorTarget.depthRenderbuffer?.detachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth"),this.postprocessing.render(r,n,!1,i,t.props.backgroundColor,a,t.light,t.ambientColor),this.packedDepth?this.colorTarget.depthRenderbuffer?.attachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.attachFramebuffer(this.postprocessing.target.framebuffer,"depth")),n.volumes.renderables.length>0){let l=Rs.isEnabled(a)?this.postprocessing.target:this.colorTarget;this.packedDepth?this.colorTarget.depthRenderbuffer?.detachFramebuffer(l.framebuffer):this.depthTextureOpaque.detachFramebuffer(l.framebuffer,"depth"),l.bind(),t.renderVolume(n.volumes,r,this.depthTextureOpaque),this.packedDepth?this.colorTarget.depthRenderbuffer?.attachFramebuffer(l.framebuffer):this.depthTextureOpaque.attachFramebuffer(l.framebuffer,"depth"),l.bind()}}}_render(t,r,n,o,i,a,s){let l=n.volumes.renderables.length>0,u=Rs.isEnabled(s.postprocessing),c=If.isEnabled(s.postprocessing),m=Zx.isEnabled(s.marking),d=Sf.isEnabled(s.postprocessing),{x:p,y:h,width:f,height:y}=r.viewport;t.setViewport(p,h,f,y),t.update(r,n),a&&!c&&i&&(this.drawTarget.bind(),t.clear(!1));let g=!1;this.transparencyMode==="wboit"&&this.wboit.supported?(this._renderWboit(t,r,n,a,s.postprocessing),g=!0):this.transparencyMode==="dpoit"&&this.dpoit.supported?(this._renderDpoit(t,r,n,s.dpoitIterations,a,s.postprocessing),g=!0):this._renderBlended(t,r,n,!l&&!u&&!c&&i,a,s.postprocessing);let x=u?this.postprocessing.target:!i||l||g?this.colorTarget:this.drawTarget;if(m&&n.markerAverage>0){let I=s.marking.ghostEdgeStrength<1;I&&n.markerAverage!==1&&(this.marking.depthTarget.bind(),t.clear(!1,!0),t.renderMarkingDepth(n.primitives,r)),this.marking.maskTarget.bind(),t.clear(!1,!0),t.renderMarkingMask(n.primitives,r,I?this.marking.depthTarget.texture:null),this.marking.update(s.marking),this.marking.render(r.viewport,x)}else x.bind();o.debug.isEnabled&&(o.debug.syncVisibility(),t.renderBlended(o.debug.scene,r)),o.handle.isEnabled&&t.renderBlended(o.handle.scene,r),o.camera.isEnabled&&(o.camera.update(r),t.update(o.camera.camera,o.camera.scene),t.renderBlended(o.camera.scene,o.camera.camera));let S=!1;if(c){let I=Rs.isEnabled(s.postprocessing)?this.postprocessing.target.texture:this.colorTarget.texture;this.antialiasing.render(r,I,i&&!d,s.postprocessing)}else i&&!Sf.isEnabled(s.postprocessing)&&(S=!0);if(s.postprocessing.dof.name==="on"){let I=If.isEnabled(s.postprocessing)?this.antialiasing.target.texture:Rs.isEnabled(s.postprocessing)?this.postprocessing.target.texture:this.colorTarget.texture;this.dof.update(r,I,this.depthTargetOpaque?.texture||this.depthTextureOpaque,this.depthTextureTransparent,s.postprocessing.dof.params,n.boundingSphereVisible),this.dof.render(r.viewport,i?void 0:this.getColorTarget(s.postprocessing))}else i&&!If.isEnabled(s.postprocessing)&&(S=!0);if(S&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),u?this.copyFboPostprocessing.render():(l||g)&&this.copyFboTarget.render()),s.postprocessing.bloom.name==="on"){let I=s.postprocessing.bloom.params.mode==="emissive";I&&n.emissiveAverage>0&&(this.bloom.emissiveTarget.bind(),t.clear(!1,!0),t.update(r,n),t.renderEmissive(n.primitives,r)),(!I||n.emissiveAverage>0)&&(this.bloom.update(this.colorTarget.texture,this.bloom.emissiveTarget.texture,this.depthTargetOpaque?.texture||this.depthTextureOpaque,s.postprocessing.bloom.params),this.bloom.render(r.viewport,i?void 0:this.getColorTarget(s.postprocessing)))}this.webgl.gl.flush()}render(t,r,n){He&&this.webgl.timer.mark("DrawPass.render");let{renderer:o,camera:i,scene:a,helper:s}=t;this.postprocessing.setTransparentBackground(r.transparentBackground);let l=r.transparentBackground||this.postprocessing.background.isEnabled(r.postprocessing.background);o.setTransparentBackground(l),o.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),o.setPixelRatio(this.webgl.pixelRatio),Af.is(i)?(He&&this.webgl.timer.mark("StereoCamera.left"),this._render(o,i.left,a,s,n,l,r),He&&this.webgl.timer.markEnd("StereoCamera.left"),He&&this.webgl.timer.mark("StereoCamera.right"),this._render(o,i.right,a,s,n,l,r),He&&this.webgl.timer.markEnd("StereoCamera.right")):this._render(o,i,a,s,n,l,r),He&&this.webgl.timer.markEnd("DrawPass.render")}getColorTarget(t){return Sf.isEnabled(t)?this.dof.target:If.isEnabled(t)?this.antialiasing.target:Rs.isEnabled(t)?this.postprocessing.target:this.colorTarget}};var $_;(n=>{function e(o,i,a){return{array:o,width:i,height:a}}n.create=e;function t(o){let{array:i,width:a,height:s}=o,l=i.length/(a*s),u=a*l;for(let c=0,m=s/2;c<m;++c)for(let d=0,p=u;d<p;++d){let h=c*u+d,f=(s-c-1)*u+d,y=i[h];i[h]=i[f],i[f]=y}return o}n.flipY=t;function r(o){let{array:i}=o,a=i instanceof Uint8Array?255:1;for(let s=0,l=i.length;s<l;s+=4){let u=i[s+3]/a;i[s]/=u,i[s+1]/=u,i[s+2]/=u}return o}n.divideByAlpha=r})($_||={});var Brt={alpha:C.Numeric(.51,{min:0,max:1,step:.01},{isEssential:!0,label:"Opacity"}),colorX:C.Color(Lt.red,{isEssential:!0}),colorY:C.Color(Lt.green,{isEssential:!0}),colorZ:C.Color(Lt.blue,{isEssential:!0}),scale:C.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0}),location:C.Select("bottom-left",C.arrayToOptions(["bottom-left","bottom-right","top-left","top-right"])),locationOffsetX:C.Numeric(0),locationOffsetY:C.Numeric(0),originColor:C.Color(Lt.grey),radiusScale:C.Numeric(.075,{min:.01,max:.3,step:.001}),showPlanes:C.Boolean(!0),planeColorXY:C.Color(Lt.grey,{label:"Plane Color XY"}),planeColorXZ:C.Color(Lt.grey,{label:"Plane Color XZ"}),planeColorYZ:C.Color(Lt.grey,{label:"Plane Color YZ"}),showLabels:C.Boolean(!1),labelX:C.Text("X"),labelY:C.Text("Y"),labelZ:C.Text("Z"),labelColorX:C.Color(Lt.grey),labelColorY:C.Color(Lt.grey),labelColorZ:C.Color(Lt.grey),labelOpacity:C.Numeric(1,{min:0,max:1,step:.01}),labelScale:C.Numeric(.25,{min:.1,max:1,step:.01})},qx={axes:C.MappedStatic("on",{on:C.Group(Brt),off:C.Group({})},{cycle:!0,description:"Show camera orientation axes"})},cA=class{constructor(t,r={}){this.webgl=t;this.props={axes:{name:"off",params:{}}};this.pixelRatio=1;this.eachGroup=(t,r)=>{if(!BL(t))return!1;let n=!1;if(this.meshRenderObject){let o=this.meshRenderObject.values.uGroupCount.ref.value;for(let{groupId:i,instanceId:a}of t.elements){let s=a*o+i;r(xe.ofSingleton(s))&&(n=!0)}}if(this.textRenderObject){let o=this.textRenderObject.values.uGroupCount.ref.value;for(let{groupId:i,instanceId:a}of t.elements){let s=a*o+i;r(xe.ofSingleton(s))&&(n=!0)}}return n};this.scene=Ey.create(t,"blended"),this.camera=new mo,b.set(this.camera.up,0,1,0),b.set(this.camera.target,0,0,0),this.setProps(r)}setProps(t){this.props=su(this.props,r=>{if(t.axes!==void 0&&(r.axes.name=t.axes.name,t.axes.name==="on")){this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio;let n={...t.axes.params,scale:t.axes.params.scale*this.pixelRatio,labelScale:t.axes.params.labelScale*this.pixelRatio};this.meshRenderObject=Grt(n),this.scene.add(this.meshRenderObject),t.axes.params.showLabels?(this.textRenderObject=zrt(n),this.scene.add(this.textRenderObject)):this.textRenderObject=void 0,this.scene.commit(),b.set(this.camera.position,0,0,n.scale*200),Z.lookAt(this.camera.view,this.camera.position,this.camera.target,this.camera.up),r.axes.params={...t.axes.params}}})}get isEnabled(){return this.props.axes.name==="on"}getLoci(t){let{objectId:r,groupId:n,instanceId:o}=t;return(!this.meshRenderObject||r!==this.meshRenderObject.id)&&(!this.textRenderObject||r!==this.textRenderObject.id)||n===0?dr:Lrt(this,n,o)}mark(t,r){return!Wo.is(Wo.Highlighting,r)||!Ji(t)&&(!BL(t)||t.data!==this)?!1:Fr.mark(this.meshRenderObject,t,r,this.eachGroup)||Fr.mark(this.textRenderObject,t,r,this.eachGroup)}update(t){if(!this.meshRenderObject||this.props.axes.name==="off")return;this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),Frt(this.camera,t.viewport,t.viewOffset),Z.extractRotation(this.scene.view,t.view);let r=this.textRenderObject?this.textRenderObject.values.boundingSphere.ref.value.radius:this.meshRenderObject.values.boundingSphere.ref.value.radius,n=this.props.axes.params.location,o=this.props.axes.params.locationOffsetX*this.pixelRatio,i=this.props.axes.params.locationOffsetY*this.pixelRatio;n==="bottom-left"?Z.setTranslation(this.scene.view,b.create(-t.viewport.width/2+r+o,-t.viewport.height/2+r+i,0)):n==="bottom-right"?Z.setTranslation(this.scene.view,b.create(t.viewport.width/2-r-o,-t.viewport.height/2+r+i,0)):n==="top-left"?Z.setTranslation(this.scene.view,b.create(-t.viewport.width/2+r+o,t.viewport.height/2-r-i,0)):n==="top-right"?Z.setTranslation(this.scene.view,b.create(t.viewport.width/2-r-o,t.viewport.height/2-r-i,0)):Rr(n)}};function krt(e,t){let r=t.props.axes,n=r.name==="on"?r.params.labelX:"X",o=r.name==="on"?r.params.labelY:"Y",i=r.name==="on"?r.params.labelZ:"Z";switch(e){case 1:return`${n} Axis`;case 2:return`${o} Axis`;case 3:return`${i} Axis`;case 4:return`${n}${o} Plane`;case 5:return`${n}${i} Plane`;case 6:return`${o}${i} Plane`;case 7:return"Origin";default:return"Axes"}}function Lrt(e,t,r){return Ex("camera-axes",e,[{groupId:t,instanceId:r}],void 0,()=>krt(t,e))}function BL(e){return e.kind==="data-loci"&&e.tag==="camera-axes"}function Frt(e,t,r){let{near:n,far:o}=e,i=-t.width/2,a=t.width/2,s=t.height/2,l=-t.height/2,u=(a-i)/2,c=(s-l)/2,m=(a+i)/2,d=(s+l)/2,p=m-u,h=m+u,f=d+c,y=d-c;if(r.enabled){let g=(a-i)/r.width,x=(s-l)/r.height;p+=g*r.offsetX,h=p+g*r.width,f-=x*r.offsetY,y=f-x*r.height}Z.ortho(e.projection,p,h,f,y,n,o)}function Vrt(e,t){let r=et.createState(512,256,t),n=100*e.scale,o=e.radiusScale*n,i=e.showLabels?100*e.labelScale/3:0,a=b.scale(b(),b.unitX,n-i),s=b.scale(b(),b.unitY,n-i),l=b.scale(b(),b.unitZ,n-i),u={radiusTop:o,radiusBottom:o,radialSegments:32};if(r.currentGroup=7,Nr(r,b.origin,o,2),r.currentGroup=1,Nr(r,a,o,2),nn(r,b.origin,a,1,u),r.currentGroup=2,Nr(r,s,o,2),nn(r,b.origin,s,1,u),r.currentGroup=3,Nr(r,l,o,2),nn(r,b.origin,l,1,u),e.showPlanes){b.scale(a,a,.5),b.scale(s,s,.5),b.scale(l,l,.5),r.currentGroup=4,et.addTriangle(r,b.origin,a,s),et.addTriangle(r,b.origin,s,a);let c=b.add(b(),a,s);et.addTriangle(r,c,a,s),et.addTriangle(r,c,s,a),r.currentGroup=5,et.addTriangle(r,b.origin,a,l),et.addTriangle(r,b.origin,l,a);let m=b.add(b(),a,l);et.addTriangle(r,m,a,l),et.addTriangle(r,m,l,a),r.currentGroup=6,et.addTriangle(r,b.origin,s,l),et.addTriangle(r,b.origin,l,s);let d=b.add(b(),s,l);et.addTriangle(r,d,s,l),et.addTriangle(r,d,l,s)}return et.getMesh(r)}function Ort(e,t){let r=100*e.scale,n=Vrt(e,t?.geometry);n.setBoundingSphere(ye.create(b.create(r/2,r/2,r/2),r+r/4));let o=i=>{switch(i){case 1:return e.colorX;case 2:return e.colorY;case 3:return e.colorZ;case 4:return e.planeColorXY;case 5:return e.planeColorXZ;case 6:return e.planeColorYZ;case 7:return e.originColor;default:return Lt.grey}};return Gr.create("axes-mesh",{},n,o,()=>1,()=>"")}function Grt(e){let t=Ort(e);return Gr.createRenderObject(t,{...C.getDefaultValues(ft.Params),...e,ignoreLight:!0,cellSize:0})}function Urt(e,t){let r=_s.create(e,8,8,t),n=100*e.scale,o=b.scale(b(),b.unitX,n),i=b.scale(b(),b.unitY,n),a=b.scale(b(),b.unitZ,n),s=100*e.labelScale;return r.add(e.labelX,o[0],o[1],o[2],0,s,1),r.add(e.labelY,i[0],i[1],i[2],0,s,2),r.add(e.labelZ,a[0],a[1],a[2],0,s,3),r.getText()}function Nrt(e,t){let r=100*e.scale,n=Urt(e,t?.geometry);n.setBoundingSphere(ye.create(b.create(r/2,r/2,r/2),r));let o=i=>{switch(i){case 1:return e.labelColorX;case 2:return e.labelColorY;case 3:return e.labelColorZ;default:return Lt.grey}};return Gr.create("axes-text",{},n,o,()=>1,()=>"")}function zrt(e){let t=Nrt(e);return Gr.createRenderObject(t,{...C.getDefaultValues(Ui.Params),...e,alpha:e.labelOpacity,cellSize:0})}var n1e=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tShaded;
uniform sampler2D tColor;
uniform sampler2D tNormal;
uniform sampler2D tTransparentColor;
uniform sampler2D tSsaoDepth;
uniform sampler2D tSsaoDepthTransparent;
uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform vec3 uOutlineColor;
uniform vec3 uOcclusionColor;
uniform bool uTransparentBackground;

uniform float uDenoiseThreshold;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

float getDepthTransparent(const in vec2 coords) {
    #if defined(dTransparentOutline) || defined(dOcclusionEnable)
        return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords)).x;
    #else
        return 1.0;
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

float getSsaoTransparent(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepthTransparent, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

//

// TODO: investigate
// https://interplayoflight.wordpress.com/2022/03/26/raytraced-global-illumination-denoising/

//

#define INV_SQRT_OF_2PI 0.39894228040143267793994605993439  // 1.0/SQRT_OF_2PI
#define INV_PI 0.31830988618379067153776752674503

// https://github.com/BrutPitt/glslSmartDeNoise
//
//  smartDeNoise - parameters
//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
//  sampler2D tex     - sampler image / texture
//  vec2 uv           - actual fragment coord
//  float sigma  >  0 - sigma Standard Deviation
//  float kSigma >= 0 - sigma coefficient
//      kSigma * sigma  -->  radius of the circular kernel
//  float threshold   - edge sharpening threshold

float NormalWeightStrength = 6.0;

vec4 smartDeNoise(sampler2D tex, vec2 uv) {
    float sigma = 3.0;
    float kSigma = 2.0;
    float threshold = uDenoiseThreshold;

    vec4 centrPx = texture2D(tex, uv);
    if (threshold == 0.0) return centrPx;

    float invSigmaQx2 = 0.5 / (sigma * sigma);      // 1.0 / (sigma^2 * 2.0)
    float invSigmaQx2PI = INV_PI * invSigmaQx2;    // 1.0 / (sqrt(PI) * sigma)

    float invThresholdSqx2 = 0.5 / (threshold * threshold);     // 1.0 / (sigma^2 * 2.0)
    float invThresholdSqrt2PI = INV_SQRT_OF_2PI / threshold;   // 1.0 / (sqrt(2*PI) * sigma)

    float zBuff = 0.0;
    vec4 aBuff = vec4(0.0);

    vec3 normal = texture2D(tNormal, uv).xyz;

    for (int x = -6; x <= 6; ++x) {
        for (int y = -6; y <= 6; ++y) {
            vec2 d = vec2(float(x), float(y));

            float blurFactor = exp(-dot(d , d) * invSigmaQx2) * invSigmaQx2PI;
            vec2 uvSample = uv + d / uTexSize;

            vec3 normalSample = texture2D(tNormal, uvSample).xyz;
            float normalW = saturate(dot(normal, normalSample));
            normalW = pow(normalW, NormalWeightStrength);
            blurFactor *= normalW;

            vec4 walkPx =  texture2D(tex, uvSample);

            vec4 dC = walkPx - centrPx;
            float deltaFactor = exp(-dot(dC, dC) * invThresholdSqx2) * invThresholdSqrt2PI * blurFactor;

            zBuff += deltaFactor;
            aBuff += deltaFactor * walkPx;
        }
    }
    return aBuff / zBuff;
}

int squaredOutlineScale = dOutlineScale * dOutlineScale;
float getOutline(const in vec2 coords, const in float opaqueDepth, const in float transparentDepth, out float closestTexel, out float isTransparent) {
    vec2 invTexSize = 1.0 / uTexSize;

    float outline = 1.0;
    closestTexel = 1.0;
    isTransparent = 0.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > squaredOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOutline = sampleOutlineCombined.r;
            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);

            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel) {
                outline = 0.0;
                closestTexel = sampleOutlineDepth;
                isTransparent = sampleOutlineCombined.a;
            }
        }
    }
    return isTransparent == 0.0 ? outline : (closestTexel > opaqueDepth && closestTexel < transparentDepth) ? 1.0 : outline;
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    #ifdef dDenoise
        vec4 color = smartDeNoise(tColor, coords);
    #else
        vec4 color = texture2D(tColor, coords);
    #endif

    float opaqueDepth = getDepthOpaque(coords);
    float backgroundViewZ = 2.0 * uFar;
    float opaqueSelfViewZ = isBackground(opaqueDepth) ? backgroundViewZ : getViewZ(opaqueDepth);
    float fogFactor = smoothstep(uFogNear, uFogFar, abs(opaqueSelfViewZ));
    float fogAlpha = 1.0 - fogFactor;

    float transparentDepth = 1.0;
    #ifdef dBlendTransparency
        bool blendTransparency = true;
        vec4 transparentColor = texture2D(tTransparentColor, coords);

        transparentDepth = getDepthTransparent(coords);
    #endif

    float alpha = 1.0;
    if (!uTransparentBackground) {
        // mix opaque objects with background color
        color.rgb = mix(color.rgb, uFogColor, fogFactor);
    } else {
        // pre-multiplied alpha expected for transparent background
        alpha = fogAlpha;
        color.rgb *= fogAlpha;
    }

    #if defined(dOcclusionEnable)
        if (!isBackground(opaqueDepth)) {
            float occlusionFactor = getSsao(coords);

            if (!uTransparentBackground) {
                color.rgb = mix(mix(uOcclusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(uOcclusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
        #ifdef dBlendTransparency
            if (!isBackground(transparentDepth)) {
                float viewDist = abs(getViewZ(transparentDepth));
                float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
                float occlusionFactor = getSsaoTransparent(coords);
                transparentColor.rgb = mix(uOcclusionColor * (1.0 - fogFactor), transparentColor.rgb, occlusionFactor);
            }
        #endif
    #endif

    #ifdef dOutlineEnable
        float closestTexel;
        float isTransparentOutline;
        float outline = getOutline(coords, opaqueDepth, transparentDepth, closestTexel, isTransparentOutline);
        if (outline == 0.0) {
            float viewDist = abs(getViewZ(closestTexel));
            float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {
                    color.rgb = mix(uOutlineColor, uFogColor, fogFactor);
            } else {
                alpha = 1.0 - fogFactor;
                color.rgb = mix(uOutlineColor, vec3(0.0), fogFactor);
            }
            #ifdef dBlendTransparency
                if (isTransparentOutline == 1.0 || transparentDepth > closestTexel) {
                    blendTransparency = false;
                }
            #endif
        }
    #endif

    #ifdef dBlendTransparency
        if (blendTransparency) {
            if (transparentColor.a != 0.0) {
                // blending
                color = transparentColor + color * (1.0 - transparentColor.a);
                alpha = transparentColor.a + alpha * (1.0 - transparentColor.a);
            }
        }
    #endif

    gl_FragColor = vec4(color.rgb, alpha);
}
`;var o1e=`
precision highp int;
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform sampler2D tNormal;
uniform sampler2D tShaded;
uniform sampler2D tThickness;
uniform sampler2D tAccumulate;
uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

#if dLightCount != 0
    uniform vec3 uLightDirection[dLightCount];
    uniform vec3 uLightColor[dLightCount];
#endif
uniform vec3 uAmbientColor;
uniform vec3 uLightStrength;

uniform int uFrameNo;

uniform float uRayDistance;
uniform float uMinThickness;
uniform float uThicknessFactor;
uniform float uThickness;

uniform float uShadowSoftness;
uniform float uShadowThickness;

uniform mat4 uProjection;
uniform mat4 uInvProjection;

#include common

// parts adapted from
// - https://blog.demofox.org/2020/05/25/casual-shadertoy-path-tracing-1-basic-camera-diffuse-emissive/
// - https://github.com/0beqz/realism-effects/blob/v2-debug/src/ssgi/shader/ssgi.frag

//

// after a hit, it moves the ray this far along the normal away from a surface.
// Helps prevent incorrect intersections when rays bounce off of objects.
#define RayPosNormalNudge 0.0001

#if __VERSION__ == 100
    #define StateType float

    // from https://www.shadertoy.com/view/4djSRW
    float hash14(vec4 p4) {
        p4 = fract(p4  * vec4(0.1031, 0.1030, 0.0973, 0.1099));
        p4 += dot(p4, p4.wzxy + 33.33);
        return fract((p4.x + p4.y) * (p4.z + p4.w));
    }

    float randomFloat(inout float state) {
        state += 0.06711056;
        return 1.0 - hash14(vec4(gl_FragCoord.xy, float(uFrameNo), state));
    }
#else
    #define StateType uint

    // https://www.pcg-random.org/
    // https://jcgt.org/published/0009/03/02/
    uint pcg(inout uint seed) {
        seed = seed * 747796405u + 2891336453u;
        uint word = ((seed >> ((seed >> 28u) + 4u)) ^ seed) * 277803737u;
        return (word >> 22u) ^ word;
    }

    float randomFloat(inout uint state) {
        return float(pcg(state)) / 4294967296.0;
    }
#endif

vec3 randomUnitVector(inout StateType state) {
    float z = randomFloat(state) * 2.0 - 1.0;
    float a = randomFloat(state) * TWO_PI;
    float r = sqrt(1.0 - z * z);
    float x = r * cos(a);
    float y = r * sin(a);
    return vec3(x, y, z);
}

struct RayHitInfo {
    bool missed;
    vec3 position;
    vec3 normal;
    vec3 color;
    vec3 emissive;
};

//

float getDepth(const in vec2 coords) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    return texture2D(tDepth, c).r;
}

float getThickness(const in vec2 coords) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    return unpackRGBAToDepth(texture2D(tThickness, c));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

vec2 viewSpaceToScreenSpace(const vec3 position) {
    vec4 projectedCoord = uProjection * vec4(position, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    // [-1, 1] --> [0, 1] (NDC to screen position)
    projectedCoord.xy = projectedCoord.xy * 0.5 + 0.5;
    return projectedCoord.xy;
}

vec2 binarySearch(inout vec3 dir, inout vec3 hitPos) {
    float rayHitDepthDifference;
    vec2 coords;

    dir *= 0.5;
    hitPos -= dir;

    for (int i = 0; i < dRefineSteps; i++) {
        coords = viewSpaceToScreenSpace(hitPos);
        float depth = getDepth(coords);
        float z = getViewZ(depth);
        rayHitDepthDifference = z - hitPos.z;

        dir *= 0.5;
        if (rayHitDepthDifference >= 0.0) {
            hitPos -= dir;
        } else {
            hitPos += dir;
        }
    }

    coords = viewSpaceToScreenSpace(hitPos);

    return coords;
}

float calculateGrowthFactor(float begin, float end, float steps) {
    return pow(end / begin, 1.0 / steps);
}

vec2 rayMarch(in vec3 dir, in float thickness, inout vec3 hitPos, out bool missed) {
    float rayHitDepthDifference;
    vec2 coords;

    float begin = float(dFirstStepSize);
    dir *= begin;
    missed = false;
    float gf = calculateGrowthFactor(begin, uRayDistance, float(dSteps));

    for (int i = 1; i < dSteps; i++) {
        hitPos += dir;
        dir *= gf;

        coords = viewSpaceToScreenSpace(hitPos);
        float depth = getDepth(coords);
        float z = getViewZ(depth);
        rayHitDepthDifference = z - hitPos.z;

        if (thickness == 0.0) {
            #ifdef dThicknessMode_auto
                thickness = max(uMinThickness, (getViewZ(getThickness(coords)) - z) * uThicknessFactor * texture2D(tColor, coords).a);
            #else
                thickness = uThickness;
            #endif
        }

        if (rayHitDepthDifference >= 0.0 && rayHitDepthDifference < thickness) {
            if (dRefineSteps == 0) {
                return coords;
            } else {
                return binarySearch(dir, hitPos);
            }
        }
    }

    missed = true;

    return coords;
}

//

void trace(in vec3 rayPos, in vec3 rayDir, inout RayHitInfo hitInfo) {
    vec3 hitPos = vec3(rayPos);
    bool missed;
    vec2 coords;
    coords = rayMarch(rayDir, 0.0, hitPos, missed);

    hitInfo.missed = missed;
    hitInfo.position = hitPos;
    hitInfo.normal = -texture2D(tNormal, coords).rgb;
    hitInfo.color = texture2D(tColor, coords).rgb;
    hitInfo.emissive = texture2D(tColor, coords).rgb * texture2D(tNormal, coords).a * 2.0;

    float depth = getDepth(coords);
    if (isBackground(depth)) {
        hitInfo.emissive = vec3(0.0);
    }
}

vec3 viewPos;

vec3 colorForRay(in vec3 startRayPos, in vec3 startRayDir, inout StateType rngState) {
    vec3 ret = vec3(0.0, 0.0, 0.0);

    vec3 throughput = vec3(1.0, 1.0, 1.0);
    vec3 rayPos = startRayPos;
    vec3 rayDir = startRayDir;

    RayHitInfo hitInfo;
    RayHitInfo prevHitInfo;

    for (int bounceIndex = 0; bounceIndex <= dBounces; ++bounceIndex) {
        // shoot a ray out into the world
        if (bounceIndex == 0) {
            vec2 coords = gl_FragCoord.xy / uTexSize;
            float depth = getDepth(coords);

            hitInfo.missed = false;
            hitInfo.position = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
            hitInfo.normal = -texture2D(tNormal, coords).rgb;
            hitInfo.color = texture2D(tShaded, coords).rgb;
            hitInfo.emissive = texture2D(tColor, coords).rgb * texture2D(tNormal, coords).a;

            // shadow
            #ifdef dShadowEnable
                #if dLightCount != 0
                    vec3 directLight = vec3(uAmbientColor);
                    #pragma unroll_loop_start
                    bool missed;
                    vec3 hitPos;
                    for (int i = 0; i < dLightCount; ++i) {
                        missed = false;
                        hitPos = viewPos + hitInfo.normal * RayPosNormalNudge;
                        hitPos += -uLightDirection[i] * (randomFloat(rngState));
                        rayMarch(-uLightDirection[i] + randomUnitVector(rngState) * uShadowSoftness, uShadowThickness, hitPos, missed);
                        if (missed) directLight += uLightColor[i];
                    }
                    #pragma unroll_loop_end
                    hitInfo.color *= directLight / uLightStrength;
                #endif
            #endif

            if (hitInfo.normal == vec3(0.0)) {
                hitInfo.missed = true;
            }
        } else {
            prevHitInfo = hitInfo;
            trace(rayPos, rayDir, hitInfo);
        }

        // if the ray missed, we are done
        if (hitInfo.missed) {
            vec3 accIrradiance = vec3(1.0);
            #ifdef dGlow
                if (bounceIndex > 1) {
                    accIrradiance = uLightStrength;
                }
            #else
                if (bounceIndex > 1) {
                    accIrradiance = uAmbientColor;
                    #if dLightCount != 0
                        #pragma unroll_loop_start
                        float dotNL;
                        vec3 irradiance;
                        for (int i = 0; i < dLightCount; ++i) {
                            dotNL = saturate(dot(prevHitInfo.normal, -uLightDirection[i]));
                            irradiance = dotNL * uLightColor[i];
                            accIrradiance += irradiance;
                        }
                        #pragma unroll_loop_end
                    #endif
                }
            #endif
            ret += prevHitInfo.color * accIrradiance * throughput;
            break;
        }

        // add emissive light
        ret += hitInfo.emissive * throughput;

        // update the ray position
        rayPos = hitInfo.position + hitInfo.normal * RayPosNormalNudge;

        // new ray direction from normal oriented cosine weighted hemisphere sample
        rayDir = normalize(hitInfo.normal + randomUnitVector(rngState));

        if (bounceIndex == 0) {
            continue;
        }

        // update the colorMultiplier.
        throughput *= hitInfo.color;

        // Russian Roulette
        // As the throughput gets smaller, the ray is more likely to get terminated early.
        // Survivors have their value boosted to make up for fewer samples being in the average.
        {
            float p = max(throughput.r, max(throughput.g, throughput.b));
            if (randomFloat(rngState) > p)
                break;

            // Add the energy we 'lose' by randomly terminating paths
            throughput *= 1.0 / p;
        }
    }

    // return pixel color
    return ret;
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    float depth = getDepth(coords);

    if (isBackground(depth)) {
        gl_FragColor = texture2D(tColor, coords);
        return;
    }

    #if __VERSION__ == 100
        float rngState = 26699.0;
    #else
        // initialize a random number state based on gl_FragCoord and uFrameNo
        uint rngState = uint(uint(gl_FragCoord.x) * 1973u + uint(gl_FragCoord.y) * 9277u + uint(uFrameNo) * 26699u) | 1u;
    #endif

    vec3 cameraPos = vec3(0.0, 0.0, 0.0);
    viewPos = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 rayDir = normalize(viewPos);

    // raytrace for this pixel
    vec3 color = vec3(0.0, 0.0, 0.0);
    for (int index = 0; index < int(dRendersPerFrame); ++index) {
        color += colorForRay(cameraPos, rayDir, rngState) / float(dRendersPerFrame);
    }

    // average the frames together
    vec4 lastFrameColor = texture2D(tAccumulate, coords);
    float blend = (uFrameNo < 1 || lastFrameColor.a == 0.0) ? 1.0 : 1.0 / (1.0 + (1.0 / lastFrameColor.a));
    color = mix(lastFrameColor.rgb, color, blend);

    // show the result
    gl_FragColor = vec4(color, blend);
}
`;var i1e=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`;var a1e={rendersPerFrame:C.Interval([1,16],{min:1,max:64,step:1},{description:"Number of rays per pixel each frame. May be adjusted to reach targetFps but will stay within given interval."}),targetFps:C.Numeric(30,{min:0,max:120,step:.1},{description:"Target FPS per frame. If observed FPS is lower or higher, some parameters may get adjusted."}),steps:C.Numeric(32,{min:1,max:1024,step:1}),firstStepSize:C.Numeric(.01,{min:.001,max:1,step:.001}),refineSteps:C.Numeric(4,{min:0,max:8,step:1},{description:"Number of refine steps per ray hit. May be lower to reach targetFps."}),rayDistance:C.Numeric(256,{min:1,max:8192,step:1},{description:"Maximum distance a ray can travel (in world units)."}),thicknessMode:C.Select("auto",C.arrayToOptions(["auto","fixed"])),minThickness:C.Numeric(.5,{min:.1,max:16,step:.1},{hideIf:e=>e.thicknessMode==="fixed"}),thicknessFactor:C.Numeric(1,{min:.1,max:2,step:.05},{hideIf:e=>e.thicknessMode==="fixed"}),thickness:C.Numeric(4,{min:.1,max:512,step:.1},{hideIf:e=>e.thicknessMode==="auto"}),bounces:C.Numeric(4,{min:1,max:32,step:1},{description:"Number of bounces for each ray."}),glow:C.Boolean(!0,{description:"Bounced rays always get the full light. This produces a slight glowing effect."}),shadowEnable:C.Boolean(!1),shadowSoftness:C.Numeric(.1,{min:.01,max:1,step:.01}),shadowThickness:C.Numeric(.5,{min:.1,max:32,step:.1})},kL=class{constructor(t,r){this.webgl=t;this.drawPass=r;this.clearAdjustedProps=!0;this.prevTime=0;this.currTime=0;this.rendersPerFrame=1;this.refineSteps=1;this.steps=16;let{extensions:{drawBuffers:n,colorBufferHalfFloat:o,textureHalfFloat:i},resources:a,isWebGL2:s}=t,{depthTextureOpaque:l}=r,u=l.getWidth(),c=l.getHeight();s?(this.shadedTextureOpaque=a.texture("image-uint8","rgba","ubyte","nearest"),this.shadedTextureOpaque.define(u,c),this.normalTextureOpaque=o&&i?a.texture("image-float16","rgba","fp16","nearest"):a.texture("image-float32","rgba","float","nearest"),this.normalTextureOpaque.define(u,c),this.colorTextureOpaque=a.texture("image-uint8","rgba","ubyte","nearest"),this.colorTextureOpaque.define(u,c)):(this.shadedTextureOpaque=a.texture("image-float32","rgba","float","nearest"),this.shadedTextureOpaque.define(u,c),this.normalTextureOpaque=a.texture("image-float32","rgba","float","nearest"),this.normalTextureOpaque.define(u,c),this.colorTextureOpaque=a.texture("image-float32","rgba","float","nearest"),this.colorTextureOpaque.define(u,c)),this.framebuffer=a.framebuffer(),this.framebuffer.bind(),n.drawBuffers([n.COLOR_ATTACHMENT0,n.COLOR_ATTACHMENT1,n.COLOR_ATTACHMENT2]),this.shadedTextureOpaque.attachFramebuffer(this.framebuffer,"color0"),this.normalTextureOpaque.attachFramebuffer(this.framebuffer,"color1"),this.colorTextureOpaque.attachFramebuffer(this.framebuffer,"color2"),this.thicknessTarget=t.createRenderTarget(u,c,!0,"uint8","nearest"),this.holdTarget=t.createRenderTarget(u,c,!1,"float32"),this.accumulateTarget=t.createRenderTarget(u,c,!1,"float32"),this.composeTarget=t.createRenderTarget(u,c,!1,"uint8","linear"),this.traceRenderable=Wrt(t,this.colorTextureOpaque,this.normalTextureOpaque,this.shadedTextureOpaque,this.thicknessTarget.texture,this.accumulateTarget.texture,this.drawPass.depthTextureOpaque),this.accumulateRenderable=Zrt(t,this.holdTarget.texture)}renderInput(t,r,n,o){He&&this.webgl.timer.mark("TracePass.renderInput");let{gl:i,state:a}=this.webgl;this.framebuffer.bind(),this.drawPass.depthTextureOpaque.attachFramebuffer(this.framebuffer,"depth"),t.clear(!0),t.renderTracing(n.primitives,r),o.thicknessMode==="auto"&&(this.thicknessTarget.bind(),a.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),t.renderDepthOpaqueBack(n.primitives,r)),He&&this.webgl.timer.markEnd("TracePass.renderInput")}setSize(t,r){let n=this.composeTarget.getWidth(),o=this.composeTarget.getHeight();(t!==n||r!==o)&&(this.thicknessTarget.setSize(t,r),this.holdTarget.setSize(t,r),this.accumulateTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.colorTextureOpaque.define(t,r),this.normalTextureOpaque.define(t,r),this.shadedTextureOpaque.define(t,r),P.update(this.traceRenderable.values.uTexSize,Ie.set(this.traceRenderable.values.uTexSize.ref.value,t,r)),P.update(this.accumulateRenderable.values.uTexSize,Ie.set(this.accumulateRenderable.values.uTexSize.ref.value,t,r)))}reset(){let{drawBuffers:t}=this.webgl.extensions;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2]),this.shadedTextureOpaque.attachFramebuffer(this.framebuffer,"color0"),this.normalTextureOpaque.attachFramebuffer(this.framebuffer,"color1"),this.colorTextureOpaque.attachFramebuffer(this.framebuffer,"color2"),this.restart(!0)}restart(t=!1){let{gl:r,state:n}=this.webgl;this.accumulateTarget.bind(),n.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.composeTarget.bind(),n.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),t&&(this.prevTime=0,this.currTime=0,this.clearAdjustedProps=!0)}increaseAdjustedProps(t){this.steps+=1,this.steps>t.steps&&(this.refineSteps+=1),this.refineSteps>t.refineSteps&&(this.rendersPerFrame+=1)}decreaseAdjustedProps(t){let r=Math.min(1,t.refineSteps);this.rendersPerFrame-=1,this.rendersPerFrame<1&&(this.refineSteps-=1),this.refineSteps<r&&(this.steps-=1)}getAdjustedProps(t,r){this.currTime=Mn();let n=Math.min(1,t.refineSteps),o=Math.round(t.steps/2);if(this.clearAdjustedProps&&(this.rendersPerFrame=t.rendersPerFrame[0],this.refineSteps=n,this.steps=o,this.clearAdjustedProps=!1),r>0){let i=1e3/t.targetFps,a=this.currTime-this.prevTime,s=Math.round(a/i);if(s>=2)for(;s>0;)this.decreaseAdjustedProps(t),s-=1;else a<i?this.increaseAdjustedProps(t):a>i+.5&&this.decreaseAdjustedProps(t)}return this.prevTime=this.currTime,this.rendersPerFrame=Br(this.rendersPerFrame,t.rendersPerFrame[0],t.rendersPerFrame[1]),this.refineSteps=Br(this.refineSteps,n,t.refineSteps),this.steps=Br(this.steps,o,t.steps),{rendersPerFrame:r===0?Math.ceil(this.rendersPerFrame/2):this.rendersPerFrame,refineSteps:r===0?n:this.refineSteps,steps:r===0?o:this.steps}}render(t,r,n,o,i){let{rendersPerFrame:a,refineSteps:s,steps:l}=this.getAdjustedProps(n,o);He&&this.webgl.timer.mark("TracePass.render",{note:`${a} rendersPerFrame, ${s} refineSteps, ${l} steps`});let{renderer:u,camera:c,scene:m}=t,{gl:d,state:p}=this.webgl,{x:h,y:f,width:y,height:g}=c.viewport;(o===0||i)&&(u.setTransparentBackground(r),u.setDrawingBufferSize(this.composeTarget.getWidth(),this.composeTarget.getHeight()),u.setPixelRatio(this.webgl.pixelRatio),u.setViewport(h,f,y,g),u.update(c,m),this.renderInput(u,c,m,n)),p.disable(d.BLEND),p.disable(d.DEPTH_TEST),p.disable(d.CULL_FACE),p.depthMask(!1),p.viewport(h,f,y,g),p.scissor(h,f,y,g);let x=Z.identity();Z.invert(x,c.projection);let S=c.state.mode==="orthographic"?1:0,[I,v]=this.traceRenderable.values.uTexSize.ref.value,A=c.viewport,_=b();b.scale(_,Fe.toArrayNormalized(u.props.ambientColor,_,0),u.props.ambientIntensity);let T=b.clone(_);for(let D=0,M=u.light.count;D<M;++D){let E=b.fromArray(b(),u.light.color,D*3);b.add(T,T,E)}this.holdTarget.bind();let w=!1;P.update(this.traceRenderable.values.uFrameNo,o),this.traceRenderable.values.dRendersPerFrame.ref.value!==a&&(P.update(this.traceRenderable.values.dRendersPerFrame,a),w=!0),P.update(this.traceRenderable.values.uProjection,c.projection),P.update(this.traceRenderable.values.uInvProjection,x),Ut.set(this.traceRenderable.values.uBounds.ref.value,A.x/I,A.y/v,(A.x+A.width)/I,(A.y+A.height)/v),P.update(this.traceRenderable.values.uBounds,this.traceRenderable.values.uBounds.ref.value),P.updateIfChanged(this.traceRenderable.values.uNear,c.near),P.updateIfChanged(this.traceRenderable.values.uFar,c.far),P.updateIfChanged(this.traceRenderable.values.uFogFar,c.fogFar),P.updateIfChanged(this.traceRenderable.values.uFogNear,c.fogNear),P.update(this.traceRenderable.values.uFogColor,Fe.toVec3Normalized(this.traceRenderable.values.uFogColor.ref.value,u.props.backgroundColor)),this.traceRenderable.values.dOrthographic.ref.value!==S&&(P.update(this.traceRenderable.values.dOrthographic,S),w=!0),P.update(this.traceRenderable.values.uLightDirection,u.light.direction),P.update(this.traceRenderable.values.uLightColor,u.light.color),this.traceRenderable.values.dLightCount.ref.value!==u.light.count&&(P.update(this.traceRenderable.values.dLightCount,u.light.count),w=!0),P.update(this.traceRenderable.values.uAmbientColor,_),P.update(this.traceRenderable.values.uLightStrength,T),this.traceRenderable.values.dGlow.ref.value!==n.glow&&(P.update(this.traceRenderable.values.dGlow,n.glow),w=!0),this.traceRenderable.values.dBounces.ref.value!==n.bounces&&(P.update(this.traceRenderable.values.dBounces,n.bounces),w=!0),this.traceRenderable.values.dSteps.ref.value!==l&&(P.update(this.traceRenderable.values.dSteps,l),w=!0),this.traceRenderable.values.dFirstStepSize.ref.value!==n.firstStepSize&&(P.update(this.traceRenderable.values.dFirstStepSize,n.firstStepSize),w=!0),this.traceRenderable.values.dRefineSteps.ref.value!==s&&(P.update(this.traceRenderable.values.dRefineSteps,s),w=!0),P.updateIfChanged(this.traceRenderable.values.uRayDistance,n.rayDistance),this.traceRenderable.values.dThicknessMode.ref.value!==n.thicknessMode&&(P.update(this.traceRenderable.values.dThicknessMode,n.thicknessMode),w=!0),P.updateIfChanged(this.traceRenderable.values.uMinThickness,n.minThickness),P.updateIfChanged(this.traceRenderable.values.uThicknessFactor,n.thicknessFactor),P.updateIfChanged(this.traceRenderable.values.uThickness,n.thickness),this.traceRenderable.values.dShadowEnable.ref.value!==n.shadowEnable&&(P.update(this.traceRenderable.values.dShadowEnable,n.shadowEnable),w=!0),P.updateIfChanged(this.traceRenderable.values.uShadowSoftness,n.shadowSoftness),P.updateIfChanged(this.traceRenderable.values.uShadowThickness,n.shadowThickness),w&&this.traceRenderable.update(),He&&this.webgl.timer.mark("TracePass.renderTrace"),this.traceRenderable.render(),He&&this.webgl.timer.markEnd("TracePass.renderTrace"),this.accumulateTarget.bind(),this.accumulateRenderable.render(),He&&this.webgl.timer.markEnd("TracePass.render")}},Hrt={...un,tColor:pt("texture","rgba","ubyte","nearest"),tNormal:pt("texture","rgba","ubyte","nearest"),tShaded:pt("texture","rgba","ubyte","nearest"),tThickness:pt("texture","rgba","ubyte","nearest"),tAccumulate:pt("texture","rgba","ubyte","nearest"),tDepth:pt("texture","rgba","ubyte","nearest"),uTexSize:he("v2"),dOrthographic:ct("number"),uNear:he("f"),uFar:he("f"),uFogNear:he("f"),uFogFar:he("f"),uFogColor:he("v3"),uProjection:he("m4"),uInvProjection:he("m4"),uBounds:he("v4"),uLightDirection:he("v3[]"),uLightColor:he("v3[]"),dLightCount:ct("number"),uAmbientColor:he("v3"),uLightStrength:he("v3"),uFrameNo:he("i"),dRendersPerFrame:ct("number"),dGlow:ct("boolean"),dBounces:ct("number"),dSteps:ct("number"),dFirstStepSize:ct("number"),dRefineSteps:ct("number"),uRayDistance:he("f"),dThicknessMode:ct("string"),uMinThickness:he("f"),uThicknessFactor:he("f"),uThickness:he("f"),dShadowEnable:ct("boolean"),uShadowSoftness:he("f"),uShadowThickness:he("f")},jrt=Dr("trace",bn,o1e);function Wrt(e,t,r,n,o,i,a){let s={...cn,tColor:P.create(t),tNormal:P.create(r),tShaded:P.create(n),tThickness:P.create(o),tAccumulate:P.create(i),tDepth:P.create(a),uTexSize:P.create(Ie.create(t.getWidth(),t.getHeight())),dOrthographic:P.create(0),uNear:P.create(1),uFar:P.create(1e4),uFogNear:P.create(1e4),uFogFar:P.create(1e4),uFogColor:P.create(b.create(1,1,1)),uProjection:P.create(Z.identity()),uInvProjection:P.create(Z.identity()),uBounds:P.create(Ut()),uLightDirection:P.create([]),uLightColor:P.create([]),dLightCount:P.create(0),uAmbientColor:P.create(b()),uLightStrength:P.create(b.create(1,1,1)),uFrameNo:P.create(0),dRendersPerFrame:P.create(1),dGlow:P.create(!0),dBounces:P.create(4),dSteps:P.create(32),dFirstStepSize:P.create(.01),dRefineSteps:P.create(4),uRayDistance:P.create(256),dThicknessMode:P.create("auto"),uMinThickness:P.create(.5),uThicknessFactor:P.create(1),uThickness:P.create(4),dShadowEnable:P.create(!1),uShadowSoftness:P.create(.1),uShadowThickness:P.create(.1)},l={...Hrt},u=Wr(e,"triangles",jrt,l,s);return Xr(u,s)}var Xrt={...un,tColor:pt("texture","rgba","ubyte","nearest"),uTexSize:he("v2"),uWeight:he("f")},Qrt=Dr("accumulate",bn,i1e);function Zrt(e,t){let r={...cn,tColor:P.create(t),uTexSize:P.create(Ie.create(t.getWidth(),t.getHeight())),uWeight:P.create(1)},n={...Xrt},o=Wr(e,"triangles",Qrt,n,r);return Xr(o,r)}var LL={enabled:C.Boolean(!1),maxIterations:C.Numeric(5,{min:0,max:16,step:1},{description:"Maximum number of tracing iterations. Final iteration count is 2^x."}),denoise:C.Boolean(!0),denoiseThreshold:C.Interval([.15,1],{min:0,max:4,step:.01},{description:"Threshold for denoising. Automatically adjusted within given interval based on current iteration."}),ignoreOutline:C.Boolean(!0,{description:"Ignore outline in illumination pass where it is generally not needed for visual clarity. Useful when illumination is often toggled on/off."}),...a1e},mA=class e{constructor(t,r){this.webgl=t;this.drawPass=r;this._iteration=0;this._supported=!1;this.prevSampleIndex=-1;if(!e.isSupported(t))return;let{colorTarget:n}=r,o=n.getWidth(),i=n.getHeight();this.tracing=new kL(t,this.drawPass),this.transparentTarget=t.createRenderTarget(o,i,!1,"uint8","nearest"),this.outputTarget=t.createRenderTarget(o,i,!1,"uint8","linear"),this.copyRenderable=mm(t,this.transparentTarget.texture),this.composeRenderable=Krt(t,this.tracing.accumulateTarget.texture,this.tracing.normalTextureOpaque,this.tracing.colorTextureOpaque,this.drawPass.depthTextureOpaque,this.drawPass.depthTargetTransparent.texture,this.drawPass.postprocessing.outline.target.texture,this.transparentTarget.texture,this.drawPass.postprocessing.ssao.ssaoDepthTexture,this.drawPass.postprocessing.ssao.ssaoDepthTransparentTexture,!1),this.multiSampleComposeTarget=t.createRenderTarget(o,i,!1,"float32"),this.multiSampleHoldTarget=t.createRenderTarget(o,i,!1),this.multiSampleAccumulateTarget=t.createRenderTarget(o,i,!1,"float32"),this.multiSampleCompose=ent(t,this.outputTarget.texture),this._supported=!0}get iteration(){return this._iteration}get colorTarget(){return this._colorTarget}get supported(){return this._supported}getMaxIterations(t){return Math.pow(2,t.illumination.maxIterations)}static isSupported(t){let{drawBuffers:r,textureFloat:n,colorBufferFloat:o,depthTexture:i}=t.extensions;if(!n||!o||!i||!r){if($t){let a=[];n||a.push("textureFloat"),o||a.push("colorBufferFloat"),i||a.push("depthTexture"),r||a.push("drawBuffers"),console.log(`Missing "${a.join('", "')}" extensions required for "illumination"`)}return!1}else return!0}renderInput(t,r,n,o){He&&this.webgl.timer.mark("IlluminationPass.renderInput");let{gl:i,state:a}=this.webgl,s=Zx.isEnabled(o.marking),l=n.opacityAverage<1,u=s&&n.markerAverage>0;this.transparentTarget.bind(),a.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT);let c=Rs.isTransparentOutlineEnabled(o.postprocessing)&&!o.illumination.ignoreOutline,m=Sf.isEnabled(o.postprocessing),d=Rs.isTransparentSsaoEnabled(n,o.postprocessing);if((c||m||d)&&(this.drawPass.depthTargetTransparent.bind(),t.clearDepth(!0)),l){if(this.drawPass.transparency==="wboit")this.drawPass.wboit.bind(),t.renderWboitTransparent(n.primitives,r,this.drawPass.depthTextureOpaque),n.volumes.renderables.length>0&&t.renderWboitTransparent(n.volumes,r,this.drawPass.depthTextureOpaque),this.transparentTarget.bind(),this.drawPass.wboit.render();else if(this.drawPass.transparency==="dpoit"){let p=this.drawPass.dpoit.bind();t.renderDpoitTransparent(n.primitives,r,this.drawPass.depthTextureOpaque,p);for(let h=0,f=o.dpoitIterations;h<f;h++){He&&this.webgl.timer.mark("DpoitPass.layer");let y=this.drawPass.dpoit.bindDualDepthPeeling();t.renderDpoitTransparent(n.primitives,r,this.drawPass.depthTextureOpaque,y),this.transparentTarget.bind(),this.drawPass.dpoit.renderBlendBack(),He&&this.webgl.timer.markEnd("DpoitPass.layer")}this.transparentTarget.bind(),this.drawPass.dpoit.render(),n.volumes.renderables.length>0&&t.renderVolume(n.volumes,r,this.drawPass.depthTextureOpaque)}else this.transparentTarget.bind(),this.drawPass.depthTextureOpaque.attachFramebuffer(this.transparentTarget.framebuffer,"depth"),t.renderBlendedTransparent(n.primitives,r),this.drawPass.depthTextureOpaque.detachFramebuffer(this.transparentTarget.framebuffer,"depth"),n.volumes.renderables.length>0&&t.renderVolume(n.volumes,r,this.drawPass.depthTextureOpaque);(c||m||d)&&(this.drawPass.depthTargetTransparent.bind(),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.drawPass.depthTextureOpaque)),d&&(this.drawPass.postprocessing.ssao.update(r,n,o.postprocessing.occlusion.params,!0),this.drawPass.postprocessing.ssao.render(r))}if(u){let p=o.marking.ghostEdgeStrength<1;p&&n.markerAverage!==1&&(this.drawPass.marking.depthTarget.bind(),t.clear(!1,!0),t.renderMarkingDepth(n.primitives,r)),this.drawPass.marking.maskTarget.bind(),t.clear(!1,!0),t.renderMarkingMask(n.primitives,r,p?this.drawPass.marking.depthTarget.texture:null),this.drawPass.marking.update(o.marking),this.drawPass.marking.render(r.viewport,this.transparentTarget)}this.tracing.composeTarget.bind(),a.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),He&&this.webgl.timer.markEnd("IlluminationPass.renderInput")}shouldRender(t){return this._supported&&t.illumination.enabled&&this._iteration<this.getMaxIterations(t)}setSize(t,r){if(!this._supported)return;let n=this.outputTarget.getWidth(),o=this.outputTarget.getHeight();(t!==n||r!==o)&&(this.tracing.setSize(t,r),this.transparentTarget.setSize(t,r),this.outputTarget.setSize(t,r),P.update(this.copyRenderable.values.uTexSize,Ie.set(this.copyRenderable.values.uTexSize.ref.value,t,r)),P.update(this.composeRenderable.values.uTexSize,Ie.set(this.composeRenderable.values.uTexSize.ref.value,t,r)),this.multiSampleComposeTarget.setSize(t,r),this.multiSampleHoldTarget.setSize(t,r),this.multiSampleAccumulateTarget.setSize(t,r),P.update(this.multiSampleCompose.values.uTexSize,Ie.set(this.multiSampleCompose.values.uTexSize.ref.value,t,r))),this.drawPass.setSize(t,r)}reset(){this._supported&&(this.tracing.reset(),this._iteration=0,this.prevSampleIndex=-1)}restart(t=!1){this._supported&&(this.tracing.restart(t),this._iteration=0,this.prevSampleIndex=-1)}renderInternal(t,r,n,o){if(!this.shouldRender(r))return;He&&this.webgl.timer.mark("IlluminationPass.render",{note:`iteration ${this._iteration+1} of ${this.getMaxIterations(r)}`}),this.tracing.render(t,r.transparentBackground,r.illumination,this._iteration,o);let{renderer:i,camera:a,scene:s,helper:l}=t,{gl:u,state:c}=this.webgl,{x:m,y:d,width:p,height:h}=a.viewport;(this._iteration===0||o)&&(i.setTransparentBackground(r.transparentBackground),i.setDrawingBufferSize(this.tracing.composeTarget.getWidth(),this.tracing.composeTarget.getHeight()),i.setPixelRatio(this.webgl.pixelRatio),i.setViewport(m,d,p,h),i.update(a,s),this.renderInput(i,a,s,r)),c.disable(u.BLEND),c.disable(u.DEPTH_TEST),c.disable(u.CULL_FACE),c.depthMask(!1),c.viewport(m,d,p,h),c.scissor(m,d,p,h);let f=a.state.mode==="orthographic"?1:0,y=r.postprocessing.outline.name==="on"&&!r.illumination.ignoreOutline,g=Rs.isTransparentSsaoEnabled(s,r.postprocessing),x=Zx.isEnabled(r.marking),S=s.opacityAverage<1,I=x&&s.markerAverage>0,v=!1;if(this.composeRenderable.values.dOutlineEnable.ref.value!==y&&(v=!0,P.update(this.composeRenderable.values.dOutlineEnable,y)),r.postprocessing.outline.name==="on"){let{transparentOutline:M,outlineScale:E}=this.drawPass.postprocessing.outline.update(a,r.postprocessing.outline.params,this.drawPass.depthTargetTransparent.texture,this.drawPass.depthTextureOpaque);this.drawPass.postprocessing.outline.render(),P.update(this.composeRenderable.values.uOutlineColor,Fe.toVec3Normalized(this.composeRenderable.values.uOutlineColor.ref.value,r.postprocessing.outline.params.color)),this.composeRenderable.values.dOutlineScale.ref.value!==E&&(v=!0,P.update(this.composeRenderable.values.dOutlineScale,E)),this.composeRenderable.values.dTransparentOutline.ref.value!==M&&(v=!0,P.update(this.composeRenderable.values.dTransparentOutline,M))}this.composeRenderable.values.dOcclusionEnable.ref.value!==g&&(v=!0,P.update(this.composeRenderable.values.dOcclusionEnable,g)),r.postprocessing.occlusion.name==="on"&&P.update(this.composeRenderable.values.uOcclusionColor,Fe.toVec3Normalized(this.composeRenderable.values.uOcclusionColor.ref.value,r.postprocessing.occlusion.params.color));let A=S||I;this.composeRenderable.values.dBlendTransparency.ref.value!==A&&(v=!0,P.update(this.composeRenderable.values.dBlendTransparency,A)),P.updateIfChanged(this.composeRenderable.values.uNear,a.near),P.updateIfChanged(this.composeRenderable.values.uFar,a.far),P.updateIfChanged(this.composeRenderable.values.uFogFar,a.fogFar),P.updateIfChanged(this.composeRenderable.values.uFogNear,a.fogNear),P.update(this.composeRenderable.values.uFogColor,Fe.toVec3Normalized(this.composeRenderable.values.uFogColor.ref.value,i.props.backgroundColor)),this.composeRenderable.values.dOrthographic.ref.value!==f&&(P.update(this.composeRenderable.values.dOrthographic,f),v=!0),n&&!If.isEnabled(r.postprocessing)&&r.postprocessing.dof.name==="off"?this.webgl.bindDrawingBuffer():this.tracing.composeTarget.bind(),this._colorTarget=this.tracing.composeTarget,this.drawPass.postprocessing.background.update(a,r.postprocessing.background),this.drawPass.postprocessing.background.clear(r.postprocessing.background,r.transparentBackground,i.props.backgroundColor),this.drawPass.postprocessing.background.render(r.postprocessing.background),P.updateIfChanged(this.composeRenderable.values.uTransparentBackground,r.transparentBackground||this.drawPass.postprocessing.background.isEnabled(r.postprocessing.background)),this.composeRenderable.values.dDenoise.ref.value!==r.illumination.denoise&&(P.update(this.composeRenderable.values.dDenoise,r.illumination.denoise),v=!0);let T=r.multiSample.mode==="on"?r.illumination.denoiseThreshold[0]:$n(r.illumination.denoiseThreshold[1],r.illumination.denoiseThreshold[0],Br(this.iteration/(this.getMaxIterations(r)/2),0,1));P.updateIfChanged(this.composeRenderable.values.uDenoiseThreshold,T),v&&this.composeRenderable.update(),this.composeRenderable.render(),i.setDrawingBufferSize(this.tracing.composeTarget.getWidth(),this.tracing.composeTarget.getHeight()),i.setPixelRatio(this.webgl.pixelRatio),i.setViewport(m,d,p,h),i.update(a,s),l.debug.isEnabled&&(l.debug.syncVisibility(),i.renderBlended(l.debug.scene,a)),l.handle.isEnabled&&i.renderBlended(l.handle.scene,a),l.camera.isEnabled&&(l.camera.update(a),i.update(l.camera.camera,l.camera.scene),i.renderBlended(l.camera.scene,l.camera.camera));let w=!1,D=this.outputTarget;if(If.isEnabled(r.postprocessing)){let M=n&&r.postprocessing.dof.name==="off";this.drawPass.antialiasing.render(a,this.tracing.composeTarget.texture,M?!0:this.outputTarget,r.postprocessing),M?w=!0:(this._colorTarget=this.outputTarget,D=this.tracing.composeTarget)}if(r.postprocessing.bloom.name==="on"){let M=n&&r.postprocessing.dof.name==="off"||w;this.drawPass.bloom.update(this.tracing.colorTextureOpaque,this.tracing.normalTextureOpaque,this.drawPass.depthTextureOpaque,r.postprocessing.bloom.params),this.drawPass.bloom.render(a.viewport,M?void 0:this._colorTarget)}if(r.postprocessing.dof.name==="on"){let M=n||w;this.drawPass.dof.update(a,this._colorTarget.texture,this.drawPass.depthTextureOpaque,this.drawPass.depthTargetTransparent.texture,r.postprocessing.dof.params,s.boundingSphereVisible),this.drawPass.dof.render(a.viewport,M?void 0:D),M||(this._colorTarget=D)}this._iteration+=1,He&&this.webgl.timer.markEnd("IlluminationPass.render"),this.webgl.gl.flush()}renderMultiSample(t,r,n){let{camera:o}=t,{multiSampleCompose:i,multiSampleComposeTarget:a,multiSampleHoldTarget:s,webgl:l}=this,{gl:u,state:c}=l,m=J_[Math.max(0,Math.min(r.multiSample.sampleLevel,5))],d=this.getMaxIterations(r),p=Math.min(this._iteration,d),h=Math.floor(p/d*m.length);He&&l.timer.mark("IlluminationPass.renderMultiSample",{note:`sampleIndex ${h+1} of ${m.length}`});let{x:f,y,width:g,height:x}=o.viewport,S=1/d;if(p===0)this.renderInternal(t,r,!1,!0),P.update(i.values.uWeight,1),P.update(i.values.tColor,this._colorTarget.texture),i.update(),s.bind(),c.disable(u.BLEND),c.disable(u.DEPTH_TEST),c.depthMask(!1),c.viewport(f,y,g,x),c.scissor(f,y,g,x),i.render();else{o.viewOffset.enabled=!0,P.update(i.values.tColor,this._colorTarget.texture),P.update(i.values.uWeight,S),i.update();let v=m[h];mo.setViewOffset(o.viewOffset,g,x,v[0],v[1],g,x),o.update(),this.renderInternal(t,r,!1,this.prevSampleIndex!==h),a.bind(),c.enable(u.BLEND),c.blendEquationSeparate(u.FUNC_ADD,u.FUNC_ADD),c.blendFuncSeparate(u.ONE,u.ONE,u.ONE,u.ONE),c.disable(u.DEPTH_TEST),c.depthMask(!1),c.viewport(f,y,g,x),c.scissor(f,y,g,x),p===1&&(c.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT)),i.render()}this.prevSampleIndex=h,n?this.webgl.bindDrawingBuffer():this.multiSampleAccumulateTarget.bind(),c.viewport(f,y,g,x),c.scissor(f,y,g,x);let I=p*S;I>0&&(P.update(i.values.uWeight,1),P.update(i.values.tColor,a.texture),i.update(),c.disable(u.BLEND),i.render()),I<1&&(P.update(i.values.uWeight,1-I),P.update(i.values.tColor,s.texture),i.update(),I===0?c.disable(u.BLEND):c.enable(u.BLEND),i.render()),n||(c.disable(u.BLEND),this.colorTarget.bind(),this.copyRenderable.values.tColor.ref.value!==this.multiSampleAccumulateTarget.texture&&(P.update(this.copyRenderable.values.tColor,this.multiSampleAccumulateTarget.texture),this.copyRenderable.update()),this.copyRenderable.render()),o.viewOffset.enabled=!1,o.update(),He&&l.timer.markEnd("IlluminationPass.renderMultiSample")}render(t,r,n){this._supported&&(r.multiSample.mode==="on"?this.renderMultiSample(t,r,n):this.renderInternal(t,r,n,!1))}},qrt={...un,tColor:pt("texture","rgba","ubyte","nearest"),tNormal:pt("texture","rgba","ubyte","nearest"),tShaded:pt("texture","rgba","ubyte","nearest"),tTransparentColor:pt("texture","rgba","ubyte","nearest"),dBlendTransparency:ct("boolean"),tSsaoDepth:pt("texture","rgba","ubyte","nearest"),tSsaoDepthTransparent:pt("texture","rgba","ubyte","nearest"),tDepthOpaque:pt("texture","rgba","ubyte","nearest"),tDepthTransparent:pt("texture","rgba","ubyte","nearest"),tOutlines:pt("texture","rgba","ubyte","nearest"),uTexSize:he("v2"),dDenoise:ct("boolean"),uDenoiseThreshold:he("f"),dOrthographic:ct("number"),uNear:he("f"),uFar:he("f"),uFogNear:he("f"),uFogFar:he("f"),uFogColor:he("v3"),uOutlineColor:he("v3"),uOcclusionColor:he("v3"),uTransparentBackground:he("b"),dOcclusionEnable:ct("boolean"),dOutlineEnable:ct("boolean"),dOutlineScale:ct("number"),dTransparentOutline:ct("boolean")},Yrt=Dr("compose",bn,n1e);function Krt(e,t,r,n,o,i,a,s,l,u,c){let m={...cn,tColor:P.create(t),tNormal:P.create(r),tShaded:P.create(n),tTransparentColor:P.create(s),dBlendTransparency:P.create(!0),tSsaoDepth:P.create(l),tSsaoDepthTransparent:P.create(u),tDepthOpaque:P.create(o),tDepthTransparent:P.create(i),tOutlines:P.create(a),uTexSize:P.create(Ie.create(t.getWidth(),t.getHeight())),dDenoise:P.create(!0),uDenoiseThreshold:P.create(.1),dOrthographic:P.create(0),uNear:P.create(1),uFar:P.create(1e4),uFogNear:P.create(1e4),uFogFar:P.create(1e4),uFogColor:P.create(b.create(1,1,1)),uOutlineColor:P.create(b.create(0,0,0)),uOcclusionColor:P.create(b.create(0,0,0)),uTransparentBackground:P.create(!1),dOcclusionEnable:P.create(!1),dOutlineEnable:P.create(!1),dOutlineScale:P.create(1),dTransparentOutline:P.create(c)},d={...qrt},p=Wr(e,"triangles",Yrt,d,m);return Xr(p,m)}var Jrt={...un,tColor:pt("texture","rgba","ubyte","nearest"),uTexSize:he("v2"),uWeight:he("f")},$rt=Dr("compose",bn,TL);function ent(e,t){let r={...cn,tColor:P.create(t),uTexSize:P.create(Ie.create(t.getWidth(),t.getHeight())),uWeight:P.create(1)},n={...Jrt},o=Wr(e,"triangles",$rt,n,r);return Xr(o,r)}var tnt={transparentBackground:C.Boolean(!1),dpoitIterations:C.Numeric(2,{min:1,max:10,step:1}),multiSample:C.Group(PL),postprocessing:C.Group(iA),marking:C.Group(ML),illumination:C.Group(LL),cameraHelper:C.Group(qx),renderer:C.Group(rA)},FL=class{constructor(t,r,n,o,i,a,s,l){this.webgl=t;this.renderer=n;this.scene=o;this.camera=i;this._width=0;this._height=0;this._camera=new mo;this.props={...C.getDefaultValues(tnt),...l},this.drawPass=new uA(t,r,128,128,s),this.illuminationPass=new mA(t,this.drawPass),this.multiSamplePass=new My(t,this.drawPass),this.multiSampleHelper=new aA(this.multiSamplePass),this.helper={camera:new cA(t,this.props.cameraHelper),debug:a.debug,handle:a.handle},this.setSize(1024,768)}get colorTarget(){return this._colorTarget}get width(){return this._width}get height(){return this._height}updateBackground(){return new Promise(t=>{this.drawPass.postprocessing.background.update(this.camera,this.props.postprocessing.background,()=>{t()})})}setSize(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.drawPass.setSize(t,r),this.illuminationPass.setSize(t,r),this.multiSamplePass.syncSize())}setProps(t={}){Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)}async render(t){mo.copySnapshot(this._camera.state,this.camera.state),co.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update();let r={renderer:this.renderer,camera:this._camera,scene:this.scene,helper:this.helper};if(this.illuminationPass.supported&&this.props.illumination.enabled){for(await t.update({message:"Tracing...",current:1,max:this.illuminationPass.getMaxIterations(this.props)}),this.illuminationPass.restart(!0);this.illuminationPass.shouldRender(this.props);)He&&this.webgl.timer.mark("ImagePass.render",{captureStats:!0}),this.illuminationPass.render(r,this.props,!1),He&&this.webgl.timer.markEnd("ImagePass.render"),t.shouldUpdate&&await t.update({current:this.illuminationPass.iteration}),await this.webgl.waitForGpuCommandsComplete();this._colorTarget=this.illuminationPass.colorTarget}else He&&this.webgl.timer.mark("ImagePass.render",{captureStats:!0}),My.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(r,this.props,!1),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(r,this.props,!1),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing)),He&&this.webgl.timer.markEnd("ImagePass.render");if(He){let n=this.webgl.timer.resolve();if(n)for(let o of n)sI([o])}if(He){let n=this.webgl.timer.resolve();if(n)for(let o of n)sI([o])}}async getImageData(t,r,n,o){this.setSize(r,n),await this.render(t),this.colorTarget.bind();let i=o?.width??r,a=o?.height??n,s=new Uint8Array(i*a*4);o?this.webgl.readPixels(o.x,n-o.y-o.height,i,a,s):this.webgl.readPixels(0,0,i,a,s);let l=$_.create(s,i,a);return $_.flipY(l),$_.divideByAlpha(l),new ImageData(new Uint8ClampedArray(s),i,a)}};var rnt={...ft.Params,alpha:{...ft.Params.alpha,defaultValue:1},ignoreLight:{...ft.Params.ignoreLight,defaultValue:!0},colorX:C.Color(Lt.red,{isEssential:!0}),colorY:C.Color(Lt.green,{isEssential:!0}),colorZ:C.Color(Lt.blue,{isEssential:!0}),scale:C.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})},OL={handle:C.MappedStatic("off",{on:C.Group(rnt),off:C.Group({})},{cycle:!0,description:"Show handle tool"})},VL=class{constructor(t,r={}){this.webgl=t;this.props={handle:{name:"off",params:{}}};this.pixelRatio=1;this._transform=Z();this.eachGroup=(t,r)=>{if(!this.renderObject||!s1e(t))return!1;let n=!1,o=this.renderObject.values.uGroupCount.ref.value,{elements:i}=t;for(let{groupId:a,instanceId:s}of i){let l=s*o+a;r(xe.ofSingleton(l))&&(n=!0)}return n};this.scene=Ey.create(t,"blended"),this.setProps(r)}getBoundingSphere(t,r){return this.renderObject&&(ye.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),Z.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,r*16),ye.transform(t,t,this._transform)),t}setProps(t){this.props=su(this.props,r=>{if(t.handle!==void 0&&(r.handle.name=t.handle.name,t.handle.name==="on")){this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio;let n={...t.handle.params,scale:t.handle.params.scale*this.webgl.pixelRatio,cellSize:0};this.renderObject=ant(n),this.scene.add(this.renderObject),this.scene.commit(),r.handle.params={...t.handle.params}}})}get isEnabled(){return this.props.handle.name==="on"}update(t,r,n){this.renderObject&&(this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),Z.setTranslation(this.renderObject.values.aTransform.ref.value,r),Z.fromMat3(this.renderObject.values.aTransform.ref.value,n),P.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))}getLoci(t){let{objectId:r,groupId:n,instanceId:o}=t;return!this.renderObject||r!==this.renderObject.id?dr:ont(this,n,o)}mark(t,r){return!Wo.is(Wo.Highlighting,r)||!Ji(t)&&(!s1e(t)||t.data!==this)?!1:Fr.mark(this.renderObject,t,r,this.eachGroup)}};function nnt(e,t){let r=et.createState(512,256,t),n=.05*e,o=b.scale(b(),b.unitX,e),i=b.scale(b(),b.unitY,e),a=b.scale(b(),b.unitZ,e),s={radiusTop:n,radiusBottom:n,radialSegments:32};return r.currentGroup=yS.TranslateScreenXY,Nr(r,b.origin,n*3,2),r.currentGroup=yS.TranslateObjectX,Nr(r,o,n,2),nn(r,b.origin,o,1,s),r.currentGroup=yS.TranslateObjectY,Nr(r,i,n,2),nn(r,b.origin,i,1,s),r.currentGroup=yS.TranslateObjectZ,Nr(r,a,n,2),nn(r,b.origin,a,1,s),et.getMesh(r)}var yS={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function ont(e,t,r){return Ex("handle",e,[{groupId:t,instanceId:r}],n=>e.getBoundingSphere(n,r),()=>`Handle Helper | Group Id ${t} | Instance Id ${r}`)}function s1e(e){return e.kind==="data-loci"&&e.tag==="handle"}function int(e,t){let r=10*e.scale,n=nnt(r,t?.geometry);n.setBoundingSphere(ye.create(b.create(r/2,r/2,r/2),r+r/4));let o=i=>{switch(i){case yS.TranslateObjectX:return e.colorX;case yS.TranslateObjectY:return e.colorY;case yS.TranslateObjectZ:return e.colorZ;default:return Lt.grey}};return Gr.create("handle",{},n,o,()=>1,()=>"")}function ant(e){let t=int(e);return Gr.createRenderObject(t,e)}var snt={debug:C.Group(Y_),camera:C.Group({helper:C.Group(qx)}),handle:C.Group(OL)},lnt=C.getDefaultValues(snt),GL=class{constructor(t,r,n={}){let o={...lnt,...n};this.debug=new fL(t,r,o.debug),this.camera=new cA(t,o.camera.helper),this.handle=new VL(t,o.handle)}};var UL=class{constructor(t,r,n={}){this.webgl=t;let o=this.webgl.getDrawingBufferSize();this.draw=new uA(t,r,o.width,o.height,n.transparency||"blended"),this.pick=new sA(t,o.width,o.height,n.pickScale||.25),this.multiSample=new My(t,this.draw),this.illumination=new mA(t,this.draw)}setPickScale(t){this.pick.setPickScale(t)}setTransparency(t){this.draw.setTransparency(t)}updateSize(){let t=this.webgl.getDrawingBufferSize(),r=Math.max(t.width,2),n=Math.max(t.height,2);this.draw.setSize(r,n),this.pick.setSize(r,n),this.multiSample.syncSize(),this.illumination.setSize(r,n)}};var l1e=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tPreviousLevel;
uniform vec2 uInvSize;
uniform vec2 uOffset;

void main(void) {
    vec2 position = gl_FragCoord.xy * uInvSize + uOffset;

    float x = texture(tPreviousLevel, position).r;
    float y = textureOffset(tPreviousLevel, position, ivec2(-1, 0)).r;
    float z = textureOffset(tPreviousLevel, position, ivec2(-1, -1)).r;
    float w = textureOffset(tPreviousLevel, position, ivec2(0, -1)).r;

    gl_FragColor = vec4(max(max(x, y), max(z, w)));
}
`;var unt={...un,tPreviousLevel:pt("texture","alpha","float","nearest"),uInvSize:he("v2"),uOffset:he("v2")},cnt=Dr("hi-z",bn,l1e);function u1e(e,t){let r={...cn,tPreviousLevel:P.create(t),uInvSize:P.create(Ie()),uOffset:P.create(Ie())},n={...unt},o=Wr(e,"triangles",cnt,n,r);return Xr(o,r)}var c1e=new ArrayBuffer(4),g8r=new Int32Array(c1e),y8r=new Float32Array(c1e);var m1e=new ArrayBuffer(4),mnt=new Int32Array(m1e),dnt=new Float32Array(m1e);function pnt(e){let t=e<-126?-126:e;return mnt[0]=(1<<23)*(t+126.94269504),dnt[0]}function d1e(e){return pnt(1.44269504*e)}var p1e=new ArrayBuffer(8),b8r=new Int32Array(p1e),x8r=new Float32Array(p1e);var f1e=new ArrayBuffer(4),fnt=new Int32Array(f1e),hnt=new Float32Array(f1e);function h1e(e){return hnt[0]=e,fnt[0]*11920928955078125e-23-126.94269504}var C8r=Math.PI/2,S8r=2*Math.PI,v8r=1/(2*Math.PI),I8r=2/Math.PI,A8r=4/Math.PI,T8r=4/(Math.PI*Math.PI),P8r=Math.PI/2-2*Math.PI;var g1e=new ArrayBuffer(16),_8r=new Int32Array(g1e),R8r=new Float32Array(g1e);var y1e=new ArrayBuffer(8),D8r=new Int32Array(y1e),w8r=new Float32Array(y1e);var b1e=new ArrayBuffer(4),E8r=new Int32Array(b1e),M8r=new Float32Array(b1e);var B8r=Math.PI/4;var gnt=b.transformMat4,x1e=Ut.set,ynt=h1e;function bnt(e,t,r){return t*r/((r-t)*e-r)}function xnt(e,t,r){return e*(t-r)-t}function NL(e,t,r,n){return n[11]===-1?bnt(e,t,r):xnt(e,t,r)}function Cnt(e,t,r,n){let o=t[0]*r,i=t[1]*r,a=t[2]*r,s=t[2]*t[2]-r*r,l=Math.sqrt(t[0]*t[0]+s),u=(l*t[0]-a)/(l*t[2]+o)*n[0],c=(l*t[0]+a)/(l*t[2]-o)*n[0],m=Math.sqrt(t[1]*t[1]+s),d=(m*t[1]-a)/(m*t[2]+i)*n[5],p=(m*t[1]+a)/(m*t[2]-i)*n[5];return x1e(e,c*-.5+.5,d*.5+.5,u*-.5+.5,p*.5+.5)}function Snt(e,t,r,n){let o=n[0],i=n[5],a=(t[0]+r)*o,s=(t[0]-r)*o,l=(t[1]+r)*i,u=(t[1]-r)*i;return x1e(e,s*.5+.5,l*-.5+.5,a*.5+.5,u*-.5+.5)}function vnt(e,t,r,n){return n[11]===-1?Cnt(e,t,r,n):Snt(e,t,r,n)}var v8={enabled:C.Boolean(!1,{description:"Hierarchical Z-buffer occlusion culling. Only available for WebGL2."}),maxFrameLag:C.Numeric(10,{min:1,max:30,step:1},{description:"Maximum number of frames to wait for Z-buffer data."}),minLevel:C.Numeric(3,{min:1,max:10,step:1})},zL=class{constructor(t,r,n,o){this.webgl=t;this.drawPass=r;this.viewport=co();this.near=0;this.far=0;this.view=Z();this.projection=Z();this.nextNear=0;this.nextFar=0;this.nextView=Z();this.nextProjection=Z();this.aabb=Ut();this.vp=b();this.levelData=[];this.sync=null;this.buffer=new Float32Array(0);this.frameLag=0;this.ready=!1;this.isOccluded=t=>{if(!this.supported||!this.props.enabled||!this.ready)return!1;let{vp:r,r:n}=this.transform(t),{near:o,far:i,projection:a}=this,s=r[2]+n;if(-s<o)return!1;let{aabb:l,w:u,h:c,lod:m}=this.project(r,n);if(m>=this.levelData.length||m<this.props.minLevel)return!1;let{offset:d,size:p}=this.levelData[m],h=l[0]+u/2,f=l[1]+c/2,y=p[0],g=h*y,x=f*y,S=Math.floor(g),I=Math.ceil(x),v=this.tex.getWidth();if(S+1>=y||I+1>=y)return!1;let A=(y-I-1)*v+S+d;if(s>NL(this.buffer[A],o,i,a)||s>NL(this.buffer[A+1],o,i,a))return!1;let _=(y-I+1-1)*v+S+d;return!(s>NL(this.buffer[_],o,i,a)||s>NL(this.buffer[_+1],o,i,a))};let{gl:i,extensions:a}=t;if(!Ht(i)||!a.colorBufferFloat){$t&&console.log('Missing webgl2 and/or colorBufferFloat support required for "Hi-Z"'),this.supported=!1;return}this.fb=t.resources.framebuffer(),this.tex=t.resources.texture("image-float32","alpha","float","nearest"),this.tex.attachFramebuffer(this.fb,0);let s=i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT),l=i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE);if(s!==i.RED||l!==i.FLOAT){$t&&console.log('Missing red/float reading support required for "Hi-Z"'),this.supported=!1;return}this.supported=!0,this.props={...C.getDefaultValues(v8),...o},this.buf=dy(i),this.renderable=u1e(t,this.drawPass.depthTextureOpaque),$t&&n&&this.initDebug(n)}clear(){if(!this.supported)return;let{gl:t}=this.webgl;Ht(t)&&(this.sync!==null&&(t.deleteSync(this.sync),this.sync=null),this.frameLag=0,this.ready=!1,this.debug&&(this.debug.rect.style.display="none",this.debug.container.style.display="none"))}render(t){if(!this.supported||!this.props.enabled)return;let{gl:r,state:n}=this.webgl;if(!Ht(r)||this.sync!==null)return;this.nextNear=t.near,this.nextFar=t.far,Z.copy(this.nextView,t.view),Z.copy(this.nextProjection,t.projection),He&&this.webgl.timer.mark("hi-Z"),n.disable(r.CULL_FACE),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.disable(r.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0);let o=this.renderable.values,i=Math.pow(2,Math.ceil(Math.log(Math.max(r.drawingBufferWidth,r.drawingBufferHeight))/Math.log(2))-1);for(let l=0,u=this.levelData.length;l<u;++l){let c=this.levelData[l];c.framebuffer.bind(),l>0?(P.update(o.uInvSize,c.invSize),P.update(o.uOffset,Ie.set(o.uOffset.ref.value,0,0)),P.update(o.tPreviousLevel,this.levelData[l-1].texture)):(P.update(o.uInvSize,Ie.set(o.uInvSize.ref.value,1/i,1/i)),P.update(o.uOffset,Ie.set(o.uOffset.ref.value,this.viewport.x/r.drawingBufferWidth,this.viewport.y/r.drawingBufferHeight)),P.update(o.tPreviousLevel,this.drawPass.depthTextureOpaque)),n.currentRenderItemId=-1,n.viewport(0,0,c.size[0],c.size[1]),r.clear(r.COLOR_BUFFER_BIT),this.renderable.update(),this.renderable.render(),l>=this.props.minLevel&&(this.tex.bind(0),r.copyTexSubImage2D(r.TEXTURE_2D,0,c.offset,0,0,0,c.size[0],c.size[1]),this.tex.unbind(0))}this.tex.attachFramebuffer(this.fb,0);let a=this.tex.getWidth(),s=this.tex.getHeight();r.bindBuffer(r.PIXEL_PACK_BUFFER,this.buf),r.bufferData(r.PIXEL_PACK_BUFFER,this.buffer.byteLength,r.STREAM_READ),r.readPixels(0,0,a,s,r.RED,r.FLOAT,0),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),this.sync=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0),r.flush(),He&&this.webgl.timer.markEnd("hi-Z")}tick(){if(!this.supported||!this.props.enabled||this.sync===null)return;let{gl:t}=this.webgl;if(!Ht(t))return;let r=t.clientWaitSync(this.sync,0,0);r===t.WAIT_FAILED||this.frameLag>=this.props.maxFrameLag?(t.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!1):r===t.TIMEOUT_EXPIRED?this.frameLag+=1:(t.bindBuffer(t.PIXEL_PACK_BUFFER,this.buf),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this.buffer),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),t.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!0,this.near=this.nextNear,this.far=this.nextFar,Z.copy(this.view,this.nextView),Z.copy(this.projection,this.nextProjection))}transform(t){let{view:r,vp:n}=this;gnt(n,t.center,r);let o=t.radius*1.2+1.52;return{vp:n,r:o}}project(t,r){let{projection:n,aabb:o,viewport:i}=this;vnt(o,t,r,n);let a=o[2]-o[0],s=o[3]-o[1],l=Math.max(a*i.width,s*i.height),u=Math.ceil(ynt(l/2));return{aabb:o,w:a,h:s,pr:l,lod:u}}setViewport(t,r,n,o){if(!this.supported)return;n=Math.max(n,2),o=Math.max(o,2),co.set(this.viewport,t,r,n,o);let i=Math.ceil(Math.log(Math.max(n,o))/Math.log(2));if(i===this.levelData.length)return;let{minLevel:a}=this.props;this.buffer=new Float32Array(Math.pow(2,i-a)*Math.pow(2,i-1-a)),this.tex.define(Math.pow(2,i-a),Math.pow(2,i-1-a));for(let l of this.levelData)l.framebuffer.destroy(),l.texture.destroy();this.levelData.length=0;for(let l=0;l<i;++l){let u=this.webgl.resources.framebuffer(),c=Math.pow(2,i-l-1),m=Ie.create(c,c),d=Ie.create(1/c,1/c),p=this.webgl.resources.texture("image-float32","alpha","float","nearest");p.define(c,c),p.attachFramebuffer(u,0),this.levelData.push({texture:p,framebuffer:u,size:m,invSize:d,offset:0})}let s=0;for(let l=0,u=i;l<u;++l){let c=this.levelData[l];l>=a&&(this.levelData[l].offset=s,s+=c.size[0])}this.clear()}setProps(t){if(this.supported)if(this.props.minLevel!==t.minLevel){Object.assign(this.props,t);let{x:r,y:n,width:o,height:i}=this.viewport;this.setViewport(r,n,o,i)}else Object.assign(this.props,t),this.props.enabled||this.clear()}initDebug(t){if(!t.parentElement)return;let r=document.createElement("div");Object.assign(r.style,{display:"block",position:"absolute",pointerEvents:"none"}),t.parentElement.appendChild(r);let n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw new Error("Could not create canvas 2d context");Object.assign(n.style,{width:"100%",height:"100%",imageRendering:"pixelated",position:"relative",pointerEvents:"none"}),r.appendChild(n);let i=document.createElement("div");Object.assign(i.style,{display:"none",position:"absolute",pointerEvents:"none"}),t.parentElement.appendChild(i),this.debug={container:r,canvas:n,ctx:o,rect:i}}canDebug(t){return this.supported&&this.props.enabled&&this.ready&&!!this.debug}showRect(t,r){if(!this.canDebug(this.debug))return;let{gl:{drawingBufferHeight:n},pixelRatio:o}=this.webgl,{viewport:{x:i,y:a,width:s,height:l}}=this,u=(t[0]*s+i)/o,c=(t[1]*l-a)/o,m=(t[2]*s+i)/o,d=(t[3]*l-a)/o,p=(n-l)/o;Object.assign(this.debug.rect.style,{border:r?"solid red":"solid green",display:"block",left:`${u}px`,top:`${c+p}px`,width:`${m-u}px`,height:`${d-c}px`})}showBuffer(t){if(!this.canDebug(this.debug))return;if(t>=this.levelData.length||t<this.props.minLevel){this.debug.container.style.display="none";return}let{offset:r,size:[n,o]}=this.levelData[t],i=this.tex.getWidth(),a=new Uint8ClampedArray(n*o*4);a.fill(255);for(let p=0;p<o;++p)for(let h=0;h<n;++h){let f=(o-p-1)*n+h,y=this.buffer[p*i+h+r]*255;a[f*4+0]=y,a[f*4+3]=255-y}let s=new ImageData(a,n,o);this.debug.canvas.width=s.width,this.debug.canvas.height=s.height,this.debug.ctx.putImageData(s,0,0);let{viewport:{x:l,y:u,width:c,height:m},webgl:{pixelRatio:d}}=this;Object.assign(this.debug.container.style,{display:"block",bottom:`${u/d}px`,left:`${l/d}px`,width:`${c/d}px`,height:`${m/d}px`})}debugOcclusion(t){if(!this.canDebug(this.debug))return;if(!t){this.debug.rect.style.display="none",this.debug.container.style.display="none";return}let r=this.isOccluded(t),{vp:n,r:o}=this.transform(t),{aabb:i,lod:a}=this.project(n,o);this.showRect(i,r),this.showBuffer(a)}dispose(){if(this.supported){this.clear(),this.fb.destroy(),this.tex.destroy(),this.webgl.gl.deleteBuffer(this.buf),this.renderable.dispose();for(let t of this.levelData)t.framebuffer.destroy(),t.texture.destroy()}}};function C1e(){if(typeof navigator>"u"||typeof window>"u")return!1;let e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}function I8(){if(typeof navigator>"u"||typeof window>"u")return!1;let e=/iPad|iPhone|iPod/.test(navigator.userAgent),t=navigator.userAgent.includes("Macintosh"),r=navigator.maxTouchPoints>=4;return!window.MSStream&&(e||t&&r)}var HL=class{constructor(t,r,n,o,i){this.webgl=t;this.renderer=r;this.scene=n;this.helper=o;this.viewport=co();let a=i.pickPadding*2+1;this.camera=new mo,this.pickPass=new sA(t,a,a,1),this.buffers=new lA(this.webgl,this.pickPass,i.maxAsyncReadLag),this.pickPadding=i.pickPadding,this.update(),_L(t)||(this.asyncIdentify=(s,l)=>({tryGet:()=>this.identify(s,l)}))}setPickPadding(t){this.pickPadding!==t&&(this.pickPadding=t,this.update())}update(){let t=this.pickPadding*2+1;co.set(this.viewport,0,0,t,t),this.buffers.setViewport(0,0,t,t),this.spiral=ow(this.pickPadding),this.size=t,this.pickPass.setSize(t,t)}render(t){He&&this.webgl.timer.mark("RayHelper.render",{captureStats:!0});let{renderer:r,scene:n,helper:o}=this;r.setTransparentBackground(!1),r.setDrawingBufferSize(this.size,this.size),r.setPixelRatio(1),r.setViewport(0,0,this.size,this.size),this.pickPass.render(r,t,n,o),He&&this.webgl.timer.markEnd("RayHelper.render")}identifyInternal(t,r){if(this.webgl.isContextLost)return;let{viewport:n}=this,o=this.buffers.getPickingId(t,r);if(o===void 0)return;let i=this.buffers.getDepth(t,r),a=b.create(t,r,i);return Hx(a,a,n,this.camera.inverseProjectionView),{id:o,position:a}}prepare(t,r){this.camera.far=r.far,this.camera.near=r.near,this.camera.fogFar=r.fogFar,this.camera.fogNear=r.fogNear,co.copy(this.camera.viewport,this.viewport),mo.copySnapshot(this.camera.state,{...r.state,mode:"orthographic"}),Int(this.camera,t),Z.mul(this.camera.projectionView,this.camera.projection,this.camera.view),Z.tryInvert(this.camera.inverseProjectionView,this.camera.projectionView)}getPickData(){let t=this.pickPadding;for(let r of this.spiral){let n=this.identifyInternal(t+r[0],t+r[1]);if(n)return n}}intersectsScene(t){return sf.isInsideSphere3D(t,this.scene.boundingSphereVisible)||sf.isIntersectingSphere3D(t,this.scene.boundingSphereVisible)}identify(t,r){if(this.intersectsScene(t))return this.prepare(t,r),He&&this.webgl.timer.mark("RayHelper.identify"),this.render(this.camera),this.buffers.read(),He&&this.webgl.timer.markEnd("RayHelper.identify"),this.getPickData()}asyncIdentify(t,r){if(this.intersectsScene(t))return this.prepare(t,r),He&&this.webgl.timer.mark("RayHelper.asyncIdentify"),this.render(this.camera),this.buffers.asyncRead(),He&&this.webgl.timer.markEnd("RayHelper.asyncIdentify"),{tryGet:()=>this.buffers.check()?this.getPickData():"pending"}}};function Int(e,t){let{near:r,far:n,viewport:o}=e,i=2*Math.tan(vr(.1)/2)*b.distance(e.position,e.target),a=o.height/i,s=-o.width/2,l=o.width/2,u=o.height/2,c=-o.height/2,m=(l-s)/(2*a),d=(u-c)/(2*a),p=(l+s)/2,h=(u+c)/2,f=p-m,y=p+m,g=h+d,x=h-d;Z.ortho(e.projection,f,y,g,x,r,n);let S=b.normalize(b(),t.direction),I=Tr.fromUnitVec3(Tr(),S,b.negUnitZ);Tr.invert(I,I);let v=b.clone(t.origin),A=b.transformQuat(b(),b.unitY,I),_=b.add(b(),v,S);Z.lookAt(e.view,v,_,A)}var Ds={camera:C.Group({mode:C.Select("perspective",C.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:C.Group(qx,{isFlat:!0}),stereo:C.MappedStatic("off",{on:C.Group(S8),off:C.Group({})},{cycle:!0,hideIf:e=>e?.mode!=="perspective"}),fov:C.Numeric(45,{min:10,max:130,step:1},{label:"Field of View"}),manualReset:C.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:C.MappedStatic("on",{on:C.Group({intensity:C.Numeric(15,{min:1,max:100,step:1})}),off:C.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:C.Group({radius:C.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:C.Boolean(!0,{description:"Hide scene in the distance"}),minNear:C.Numeric(5,{min:.1,max:100,step:.1},{description:"Note, may cause performance issues rendering impostors when set too small and cause issues with outline rendering when too close to 0."})},{pivot:"radius"}),viewport:C.MappedStatic("canvas",{canvas:C.Group({}),"static-frame":C.Group({x:C.Numeric(0),y:C.Numeric(0),width:C.Numeric(128),height:C.Numeric(128)}),"relative-frame":C.Group({x:C.Numeric(.33,{min:0,max:1,step:.01}),y:C.Numeric(.33,{min:0,max:1,step:.01}),width:C.Numeric(.5,{min:.01,max:1,step:.01}),height:C.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:C.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),sceneRadiusFactor:C.Numeric(1,{min:1,max:10,step:.1}),transparentBackground:C.Boolean(!1),dpoitIterations:C.Numeric(2,{min:1,max:10,step:1}),pickPadding:C.Numeric(3,{min:0,max:10,step:1},{description:"Extra pixels to around target to check in case target is empty."}),userInteractionReleaseMs:C.Numeric(250,{min:0,max:1e3,step:1},{description:"The time before the user is not considered interacting anymore."}),multiSample:C.Group(PL),postprocessing:C.Group(iA),marking:C.Group(ML),illumination:C.Group(LL),hiZ:C.Group(v8),renderer:C.Group(rA),trackball:C.Group(p8),interaction:C.Group(y8),debug:C.Group(Y_),handle:C.Group(OL)},eR=C.getDefaultValues(Ds);var Tf;(o=>{o.DefaultAttribs={powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,antialias:!0,preserveDrawingBuffer:!0,preferWebGl1:!1,handleResize:()=>{}},o.Params={resolutionMode:C.Select("auto",C.arrayToOptions(["auto","scaled","native"])),pixelScale:C.Numeric(1,{min:.1,max:2,step:.05}),pickScale:C.Numeric(.25,{min:.1,max:1,step:.05}),transparency:C.Select("wboit",[["blended","Blended"],["wboit","Weighted, Blended"],["dpoit","Depth Peeling"]])},o.DefaultProps=C.getDefaultValues(o.Params);function n(i,a,s={},l={}){let u={...o.DefaultAttribs,...s},c={...o.DefaultProps,...l},{powerPreference:m,failIfMajorPerformanceCaveat:d,antialias:p,preserveDrawingBuffer:h,preferWebGl1:f}=u,y=Tfe(i,{powerPreference:m,failIfMajorPerformanceCaveat:d,antialias:p,preserveDrawingBuffer:h,alpha:!0,depth:!0,premultipliedAlpha:!0,preferWebGl1:f});if(y===null)throw new Error("Could not create a WebGL rendering context");let g=()=>{let R=c.pixelScale/(typeof window<"u"&&window?.devicePixelRatio||1);return c.resolutionMode==="auto"?C1e()?R:c.pixelScale:c.resolutionMode==="native"?c.pixelScale:R},x=()=>{let R=g();A.setPixelScale(R),_.setPixelScale(R)},{pickScale:S,transparency:I}=c,v=g(),A=u8.fromElement(i,{pixelScale:v,preventGestures:!0}),_=Efe(y,{pixelScale:v}),T=new UL(_,a,{pickScale:S,transparency:I});if($t){let R=y.getExtension("WEBGL_lose_context");R&&i.addEventListener("mousedown",k=>{_.isContextLost||!k.shiftKey||!k.ctrlKey||!k.altKey||($t&&console.log("lose context"),R.loseContext(),setTimeout(()=>{_.isContextLost&&($t&&console.log("restore context"),R.restoreContext())},1e3))},!1)}let w=new En,D=R=>{_.setContextLost(),R.preventDefault(),$t&&console.log("context lost"),w.next(Mn())},M=()=>{_.isContextLost&&(_.handleContextRestored(()=>{T.draw.reset(),T.pick.reset(),T.illumination.reset()}),$t&&console.log("context restored"))};i.addEventListener("webglcontextlost",D,!1),i.addEventListener("webglcontextrestored",M,!1);let E=new Pa(void 0);return{canvas:i,webgl:_,input:A,passes:T,attribs:u,get props(){return{...c}},contextLost:w,contextRestored:_.contextRestored,assetManager:a,changed:E,get pixelScale(){return g()},syncPixelScale:x,setProps:R=>{if(!R)return;let k=!1,B=!1;R.resolutionMode!==void 0&&R.resolutionMode!==c.resolutionMode&&(c.resolutionMode=R.resolutionMode,B=!0),R.pixelScale!==void 0&&R.pixelScale!==c.pixelScale&&(c.pixelScale=R.pixelScale,B=!0),B&&(x(),u.handleResize(),k=!0),R.pickScale!==void 0&&R.pickScale!==c.pickScale&&(c.pickScale=R.pickScale,T.setPickScale(R.pickScale),k=!0),R.transparency!==void 0&&R.transparency!==c.transparency&&(c.transparency=R.transparency,T.setTransparency(R.transparency),k=!0),k&&E.next(void 0)},dispose:R=>{A.dispose(),i.removeEventListener("webglcontextlost",D,!1),i.removeEventListener("webglcontextrestored",M,!1),_.destroy(R)}}}o.fromCanvas=n})(Tf||={});var Ant=typeof window<"u"?window.requestAnimationFrame:e=>setImmediate(()=>e(Date.now())),S1e=typeof window<"u"?window.cancelAnimationFrame:e=>clearImmediate(e),A8;(t=>{function e(r,n={}){let{webgl:o,input:i,passes:a,assetManager:s,canvas:l,contextLost:u}=r,c={...Ya(eR),...Ya(n)},m=new Map,d=new Map,p=new Pa(0),h=new En,f=Mn(),y=new Pa(0),g=new Pa(0),x=new Pa(0),{contextRestored:S}=o,I=0,v=0,A=128,_=128,T=!1,w=0;Mt();let D=Ey.create(o,a.draw.transparency);function M(){return D.boundingSphere.radius*c.sceneRadiusFactor}let E=new mo({position:b.create(0,0,100),mode:c.camera.mode,fog:c.cameraFog.name==="on"?c.cameraFog.params.intensity:0,clipFar:c.cameraClipping.far,minNear:c.cameraClipping.minNear,fov:vr(c.camera.fov)},{x:I,y:v,width:A,height:_}),R=new Af(E,c.camera.stereo.params),k=f8.create(i,E,D,c.trackball),B=new GL(o,D,c),L=new zL(o,a.draw,l,c.hiZ),V=d8.create(o,c.renderer);V.setOcclusionTest(L.isOccluded);let U={pickPadding:c.pickPadding,maxAsyncReadLag:ZSe.maxAsyncReadLag},Q=new DL(o,V,D,B,a.pick,{x:I,y:v,width:A,height:_},U),O=new HL(o,V,D,B,U),q=new hL(Ke,tt,oe,i,E,k,c.interaction),X=new aA(a.multiSample);a.draw.postprocessing.background.update(E,c.postprocessing.background,ke=>{ke&&z()});let F=!1,Y,$,ce=!1,ie=!0;function oe(ke){let nt=dr,Ue=Vt.Empty;if(ke){let ot=B.camera.getLoci(ke);if(ot!==dr)return{loci:ot,repr:Ue};nt=B.handle.getLoci(ke),m.forEach((Tt,kt)=>{let qt=kt.getLoci(ke);Ii(qt)||(Ii(nt)||console.warn("found another loci, this should not happen"),nt=qt,Ue=kt)})}return{loci:nt,repr:Ue}}let W=[];function N(ke,nt){W.push([ke,nt])}function j(){let ke=!1;for(let[nt,Ue]of W)ke=ue(nt,Ue)||ke;return W=[],ke&&(D.update(void 0,!0),B.handle.scene.update(void 0,!0),B.camera.scene.update(void 0,!0),h.next()),ke}function ue(ke,nt){let{repr:Ue,loci:ot}=ke,Tt=!1;return Ue?Tt=Ue.mark(ot,nt)||Tt:m.forEach((kt,qt)=>{Tt=qt.mark(ot,nt)||Tt}),Tt=B.handle.mark(ot,nt)||Tt,Tt=B.camera.mark(ot,nt)||Tt,Tt}let be=null;function ee(ke){if(o.isContextLost)return!1;let nt=!1;ce&&(Ze(!1),ce=!1,nt=!0);let Ue=o.getDrawingBufferSize();if(I>Ue.width||I+A<0||v>Ue.height||v+_<0)return!1;if(be!==null)if(o.checkSyncStatus(be))be=null;else return!1;let ot=j()&&(V.props.colorMarker||c.marking.enabled),Tt=!1;k.update(w);let kt=E.update(),qt=ke||kt||nt||T;if(T=!1,a.illumination.supported&&c.illumination.enabled){if((qt||ot)&&(V.setOcclusionTest(null),a.illumination.restart()),a.illumination.shouldRender(c)&&(!At&&D.count>0||a.illumination.iteration===0||c.userInteractionReleaseMs===0)){He&&o.timer.mark("Canvas3D.render",{captureStats:!0});let pe={renderer:V,camera:E,scene:D,helper:B};a.illumination.render(pe,c,!0),He&&o.timer.markEnd("Canvas3D.render"),Q.dirty=Q.dirty||qt,Tt=!0}}else{let pe=X.update(ot||qt,c.multiSample);if(qt||pe||ot){V.setOcclusionTest(L.isOccluded);let _e=E;c.camera.stereo.name==="on"&&(R.update(),_e=R),He&&o.timer.mark("Canvas3D.render",{captureStats:!0});let de={renderer:V,camera:_e,scene:D,helper:B};if(My.isEnabled(c.multiSample)){let Me=c.multiSample.reduceFlicker&&!kt&&ot&&!k.isAnimating;X.render(de,c,!0,Me)}else a.draw.render(de,c,!0);L.render(E),He&&o.timer.markEnd("Canvas3D.render"),Q.dirty=Q.dirty||qt,Tt=!0}}return Tt&&(be=o.getFenceSync()),Tt}let le=!1,Ae=!1,Ce=!1;function J(ke){Ae||Ce||ee(!!ke?.force)&&ie&&y.next(Mn()-f)}function z(){T=!0}let ae=0;function ge(ke,nt){Ce||(w=ke,bt(nt?.isSynchronous),nt?.updateControls&&k.update(w),E.transition.tick(w),L.tick(),!nt?.manualDraw&&(J(),!E.transition.inTransition&&!o.isContextLost&&q.tick(w)))}function ve(){ge(Mn()),ae=Ant(ve)}function Oe(ke){f=ke,k.start(ke)}function ze(){Ae=!1,k.start(Mn()),ae===0&&ve()}function Re(ke=!1){Ae=ke,S1e(ae),ae=0}function Ke(ke){if(!o.isContextLost){if("origin"in ke)return O.identify(ke,E);{let nt=c.camera.stereo.name==="on"?R:E;return Q.identify(ke[0],ke[1],nt)}}}function tt(ke){if(!o.isContextLost){if("origin"in ke)return O.asyncIdentify(ke,E);{let nt=c.camera.stereo.name==="on"?R:E;return Q.asyncIdentify(ke[0],ke[1],nt)}}}function bt(ke=!1){Nn(ke)&&(Pt(),le&&(B.debug.isEnabled&&B.debug.update(),J({force:!0}),le=!1),g.next(Mn()))}function Pt(){if(!F)return;let ke=D.boundingSphereVisible,{center:nt,radius:Ue}=ke,ot=k.props.autoAdjustMinMaxDistance;if(ot.name==="on"){let Tt=ot.params.minDistanceFactor*Ue+ot.params.minDistancePadding,kt=Math.max(ot.params.maxDistanceFactor*Ue,ot.params.maxDistanceMin);k.setProps({minDistance:Tt,maxDistance:kt})}if(Ue>0){let Tt=Y===void 0?c.cameraResetDurationMs:Y,kt=E.getFocus(nt,Ue),qt=typeof $=="function"?$(D,E):$,pe=qt?{...kt,...qt}:kt;E.setState({...pe,radiusMax:M()},Tt)}Y=void 0,$=void 0,F=!1}let fr=ye(),gt=ye();function Sr(){if(E.state.radiusMax===0)return!0;if(E.transition.inTransition||$)return!1;let ke=!0,nt=!0;ye.set(gt,E.state.target,E.state.radius);for(let Ue of D.renderables){if(!Ue.state.visible)continue;let ot=Ue.values.boundingSphere.ref.value;if(!ot.radius)continue;nt=!1;let Tt=b.distance(gt.center,ot.center);if((Tt>gt.radius||Tt>ot.radius||ot.radius>E.state.radiusMax)&&!ye.includes(fr,ot))return!0;ye.overlaps(gt,ot)&&(ke=!1)}return ke||!nt&&gt.radius<=.1}let zr=250;function Nn(ke){return D.needsCommit?(ye.copy(fr,D.boundingSphereVisible),L.clear(),D.commit(ke?void 0:zr)?(x.next(0),B.debug.isEnabled&&B.debug.update(),!c.camera.manualReset&&(p.value===0||Sr())&&(F=!0),fr.radius===0&&(Y=0),c.camera.manualReset||E.setState({radiusMax:M()},0),p.next(m.size),$t&&xn(),!0):(x.next(D.commitQueueSize),!1)):!0}function xn(){let ke=D.renderables.map(Tt=>({drawCount:Tt.values.drawCount.ref.value,instanceCount:Tt.values.instanceCount.ref.value,materialId:Tt.materialId,renderItemId:Tt.id}));console.groupCollapsed(`${ke.length} RenderItems`),ke.length<50?console.table(ke):console.log(ke),console.log(JSON.stringify(o.stats,void 0,4));let{texture:nt,attribute:Ue,elements:ot}=o.resources.getByteCounts();console.log(JSON.stringify({texture:`${(nt/1024/1024).toFixed(3)} MiB`,attribute:`${(Ue/1024/1024).toFixed(3)} MiB`,elements:`${(ot/1024/1024).toFixed(3)} MiB`},void 0,4)),console.log(JSON.stringify(o.timer.formatedStats(),void 0,4)),console.groupEnd()}function In(ke){hi(ke);let nt=m.get(ke),Ue=new Set;ke.renderObjects.forEach(ot=>Ue.add(ot)),nt?no.areEqual(Ue,nt)||(Ue.forEach(ot=>{nt.has(ot)||D.add(ot)}),nt.forEach(ot=>{Ue.has(ot)||D.remove(ot)})):ke.renderObjects.forEach(ot=>D.add(ot)),m.set(ke,Ue),D.update(ke.renderObjects,!1),le=!0,$t&&xn()}function zn(ke){nl(ke);let nt=m.get(ke);nt&&(nt.forEach(Ue=>D.remove(Ue)),m.delete(ke),le=!0,$t&&xn())}function hi(ke){d.has(ke)||d.set(ke,ke.updated.subscribe(nt=>{ke.state.syncManually||In(ke)}))}function nl(ke){let nt=d.get(ke);nt&&(nt.unsubscribe(),d.delete(ke))}function fo(){let ke=D.boundingSphere.radius>0?100-Math.round(E.transition.target.radius/M()*100):0;return{camera:{mode:E.state.mode,helper:{...B.camera.props},stereo:{...c.camera.stereo},fov:Math.round(Ea(E.state.fov)),manualReset:!!c.camera.manualReset},cameraFog:E.state.fog>0?{name:"on",params:{intensity:E.state.fog}}:{name:"off",params:{}},cameraClipping:{far:E.state.clipFar,radius:ke,minNear:E.state.minNear},cameraResetDurationMs:c.cameraResetDurationMs,sceneRadiusFactor:c.sceneRadiusFactor,transparentBackground:c.transparentBackground,dpoitIterations:c.dpoitIterations,pickPadding:c.pickPadding,userInteractionReleaseMs:c.userInteractionReleaseMs,viewport:c.viewport,postprocessing:{...c.postprocessing},marking:{...c.marking},multiSample:{...c.multiSample},illumination:{...c.illumination},hiZ:{...L.props},renderer:{...V.props},trackball:{...k.props},interaction:{...q.props},debug:{...B.debug.props},handle:{...B.handle.props}}}let G=u?.subscribe(()=>{Ce=!0,be=null,Q.dirty=!0}),te=S.subscribe(()=>{D.forEach(ke=>{ke.values.meta?.ref.value.reset&&(ke.values.meta.ref.value.reset(),ke.update())}),Ce=!1,J({force:!0}),J({force:!0})}),Ge=new Pa(0);function Ze(ke=!0){a.updateSize(),Mt(),wt(),ke&&z(),Ge.next(+new Date)}aae(xn);let lt=r.changed?.subscribe(()=>{D.setTransparency(a.draw.transparency),z()}),xt=!1,At=!1,Dt=[i.drag.subscribe(()=>{xt=!0}),i.interactionEnd.subscribe(()=>{xt=!1}),jc(i.drag,i.pinch,i.wheel,i.interactionEnd).subscribe(()=>{h.next()}),h.subscribe(()=>{At=!0}),h.pipe($y(c.userInteractionReleaseMs)).subscribe(()=>{At=xt,!xt&&a.illumination.supported&&c.illumination.enabled&&z()})];if($t&&l){let ke,nt=Ue=>{let ot=Ue&&Jt.getBoundingSphere(Jt.normalize(Ue,"residue"));L.debugOcclusion(ot)};i.click.subscribe(Ue=>{if(!Ue.modifiers.control||Ue.button!==2)return;let ot=Ke(Ie.create(Ue.x,Ue.y));if(!ot){ke=void 0,nt(ke);return}ke=oe(ot.id).loci,nt(ke)}),y.subscribe(()=>{setTimeout(()=>{nt(ke)},100)})}return{webgl:o,add:In,remove:zn,commit:bt,update:(ke,nt)=>{if(ke){if(!m.has(ke))return;D.update(ke.renderObjects,!!nt)}else D.update(void 0,!!nt);le=!0},clear:()=>{d.forEach(ke=>ke.unsubscribe()),d.clear(),m.clear(),D.clear(),B.debug.clear(),be!==null&&(o.deleteSync(be),be=null),z(),p.next(m.size)},syncVisibility:()=>{E.state.radiusMax===0&&(F=!0,Y=0),D.syncVisibility()&&B.debug.isEnabled&&B.debug.update(),z()},requestDraw:z,tick:ge,animate:ze,resetTime:Oe,pause:Re,resume:()=>{Ae=!1},identify:Ke,asyncIdentify:tt,mark:N,getLoci:oe,handleResize:Ze,requestResize:()=>{ce=!0},requestCameraReset:ke=>{Y=ke?.durationMs,$=ke?.snapshot,F=!0},camera:E,boundingSphere:D.boundingSphere,boundingSphereVisible:D.boundingSphereVisible,get notifyDidDraw(){return ie},set notifyDidDraw(ke){ie=ke},didDraw:y,commited:g,commitQueueSize:x,reprCount:p,resized:Ge,setProps:(ke,nt=!1)=>{let Ue=typeof ke=="function"?su(fo(),ke):ke;Ue.sceneRadiusFactor!==void 0&&(c.sceneRadiusFactor=Ue.sceneRadiusFactor,E.setState({radiusMax:M()},0));let ot=Object.create(null);Ue.camera&&Ue.camera.mode!==void 0&&Ue.camera.mode!==E.state.mode&&(ot.mode=Ue.camera.mode);let Tt=Math.round(Ea(E.state.fov));if(Ue.camera&&Ue.camera.fov!==void 0&&Ue.camera.fov!==Tt&&(ot.fov=vr(Ue.camera.fov)),Ue.cameraFog!==void 0&&Ue.cameraFog.params){let kt=Ue.cameraFog.name==="on"?Ue.cameraFog.params.intensity:0;kt!==E.state.fog&&(ot.fog=kt)}if(Ue.cameraClipping!==void 0&&(Ue.cameraClipping.far!==void 0&&Ue.cameraClipping.far!==E.state.clipFar&&(ot.clipFar=Ue.cameraClipping.far),Ue.cameraClipping.minNear!==void 0&&Ue.cameraClipping.minNear!==E.state.minNear&&(ot.minNear=Ue.cameraClipping.minNear),Ue.cameraClipping.radius!==void 0)){let kt=M()/100*(100-Ue.cameraClipping.radius);kt>0&&kt!==ot.radius&&(ot.radius=Math.max(kt,.01))}Object.keys(ot).length>0&&E.setState(ot),Ue.camera?.helper&&B.camera.setProps(Ue.camera.helper),Ue.camera?.manualReset!==void 0&&(c.camera.manualReset=Ue.camera.manualReset),Ue.camera?.stereo!==void 0&&(Object.assign(c.camera.stereo,Ue.camera.stereo),R.setProps(c.camera.stereo.params)),Ue.cameraResetDurationMs!==void 0&&(c.cameraResetDurationMs=Ue.cameraResetDurationMs),Ue.transparentBackground!==void 0&&(c.transparentBackground=Ue.transparentBackground),Ue.dpoitIterations!==void 0&&(c.dpoitIterations=Ue.dpoitIterations),Ue.pickPadding!==void 0&&(c.pickPadding=Ue.pickPadding,Q.setPickPadding(c.pickPadding)),Ue.userInteractionReleaseMs!==void 0&&(c.userInteractionReleaseMs=Ue.userInteractionReleaseMs),Ue.viewport!==void 0&&(c.viewport===Ue.viewport||c.viewport.name===Ue.viewport.name&&Ng(c.viewport.params,Ue.viewport.params)||(c.viewport=Ue.viewport,Mt(),wt())),Ue.postprocessing?.background&&(Object.assign(c.postprocessing.background,Ue.postprocessing.background),a.draw.postprocessing.background.update(E,c.postprocessing.background,kt=>{kt&&!nt&&z()})),Ue.postprocessing&&Object.assign(c.postprocessing,Ue.postprocessing),Ue.marking&&Object.assign(c.marking,Ue.marking),Ue.illumination&&Object.assign(c.illumination,Ue.illumination),Ue.multiSample&&Object.assign(c.multiSample,Ue.multiSample),Ue.hiZ&&L.setProps(Ue.hiZ),Ue.renderer&&V.setProps(Ue.renderer),Ue.trackball&&k.setProps(Ue.trackball),Ue.interaction&&q.setProps(Ue.interaction),Ue.debug&&B.debug.setProps(Ue.debug),Ue.handle&&B.handle.setProps(Ue.handle),ot.mode==="orthographic"&&(c.camera.stereo.name="off"),nt||z()},getImagePass:(ke={})=>new FL(o,s,V,D,E,B,a.draw.transparency,ke),getRenderObjects(){let ke=[];return D.forEach((nt,Ue)=>ke.push(Ue)),ke},get props(){return fo()},get input(){return i},get stats(){return V.stats},get interaction(){return q.events},dispose:()=>{G?.unsubscribe(),te.unsubscribe(),lt?.unsubscribe();for(let ke of Dt)ke.unsubscribe();Dt=[],S1e(ae),W=[],D.clear(),B.debug.clear(),k.dispose(),V.dispose(),q.dispose(),L.dispose(),be!==null&&(o.deleteSync(be),be=null),sae(xn)}};function Mt(){let ke=I,nt=v,Ue=A,ot=_,Tt=o.getDrawingBufferSize();c.viewport.name==="canvas"?(I=0,v=0,A=Tt.width,_=Tt.height):c.viewport.name==="static-frame"?(I=c.viewport.params.x*o.pixelRatio,_=c.viewport.params.height*o.pixelRatio,v=Tt.height-_-c.viewport.params.y*o.pixelRatio,A=c.viewport.params.width*o.pixelRatio):c.viewport.name==="relative-frame"&&(I=Math.round(c.viewport.params.x*Tt.width),_=Math.round(c.viewport.params.height*Tt.height),v=Math.round(Tt.height-_-c.viewport.params.y*Tt.height),A=Math.round(c.viewport.params.width*Tt.width)),(ke!==I||nt!==v||Ue!==A||ot!==_)&&(T=!0)}function wt(){Q.setViewport(I,v,A,_),V.setViewport(I,v,A,_),co.set(E.viewport,I,v,A,_),co.set(k.viewport,I,v,A,_),L.setViewport(I,v,A,_)}}t.create=e})(A8||={});function P8(e,t){if(!e.canvas3d)return;let r=t.targets?.map(o=>{let i=o.targetRef!==void 0?_8(e,o.targetRef):T8(e);if(!i)return;let a=o.radius??i.radius*(o.radiusFactor??1)+(o.extraRadius??0);return ye.create(i.center,a)}).filter(o=>o!==void 0),n=r&&r.length>0?R8(r):T8(e);return Pnt(e.canvas3d.camera,{center:n.center,radius:Math.max(n.radius,t.minRadius??0),up:t.up,direction:t.direction})}var Tnt=b();function Pnt(e,t){let r=t.center,n=Math.max(t.radius,.01),o=t.direction??b.sub(b(),e.target,e.position),i=b.orthogonalize(b(),o,t.up??e.up),a=e.getTargetDistance(n),s=b.setMagnitude(Tnt,o,a),l=b.sub(b(),r,s);return{target:r,position:l,up:i,radius:n}}function _8(e,t){let r=v1e([],e,t);if(r.length!==0)return r.length===1?r[0]:R8(r)}function v1e(e,t,r){let n=t.state.data.cells.get(r),o=_nt(n?.obj);return o?e.push(...o):t.state.data.tree.children.get(r).forEach(a=>v1e(e,t,a)),e}function _nt(e){if(e){if(!e.data){console.warn("Focus: no data");return}if(e.data instanceof De){let t=Jt.getBoundingSphere(De.Loci(e.data));return t?[t]:[]}else if(re.isRepresentation3D(e)){let t=[];for(let r of e.data.repr.renderObjects){let n=r.values.boundingSphere.ref.value;n.radius>0&&t.push(n)}return t}}}function T8(e){let r=Rnt(e,!1).map(n=>n.values.boundingSphere.ref.value).filter(n=>n.radius>0);return R8(r)}function Rnt(e,t){let r=Array.from(e.state.data.cells.values()).filter(o=>o.obj&&re.isRepresentation3D(o.obj));return t||(r=r.filter(o=>!o.state.isHidden)),r.flatMap(o=>o.obj.data.repr.renderObjects)}var dA;function R8(e){dA??=new Ci("98"),dA.reset();for(let t of e)dA.includeSphere(t);dA.finishedIncludeStep();for(let t of e)dA.radiusSphere(t);return dA.getSphere()}function I1e(e,t){return e==="orthographic"?1/(2*Math.tan(t/2)):1/(2*Math.sin(t/2))}function A1e(e,t,r,n){let o=b.sub(b(),t,e),i=I1e(r,n);return b.scaleAndAdd(o,e,o,i)}function T1e(e,t,r,n){let o=b.sub(b(),t,e),i=I1e(r,n)||1;return b.scaleAndAdd(o,e,o,1/i)}var Dnt=function(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))};function P1e(e){return e}function D8(e,t,r,n,o,i,a,s,l){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return r(t(e));case 4:return n(r(t(e)));case 5:return o(n(r(t(e))));case 6:return i(o(n(r(t(e)))));case 7:return a(i(o(n(r(t(e))))));case 8:return s(a(i(o(n(r(t(e)))))));case 9:return l(s(a(i(o(n(r(t(e))))))));default:{for(var u=arguments[0],c=1;c<arguments.length;c++)u=arguments[c](u);return u}}}var jL=function(e,t){var r=typeof e=="number"?function(n){return n.length>=e}:e;return function(){var n=Array.from(arguments);return r(arguments)?t.apply(this,n):function(o){return t.apply(void 0,Dnt([o],n,!1))}}};var _1e=function(e){return e._tag==="Left"};var R1e=function(e){return{_tag:"Left",left:e}},D1e=function(e){return{_tag:"Right",right:e}};function w8(e){return function(t,r){return e.map(t,function(){return r})}}function w1e(e){var t=w8(e);return function(r){return t(r,void 0)}}function E1e(e){return function(t,r){return e.chain(t,function(n){return e.map(r(n),function(){return n})})}}var M1e=R1e,tR=D1e,Mnt=jL(2,function(e,t){return Qa(e)?e:t(e.right)}),B1e=function(e,t){return D8(e,knt(t))},Bnt=function(e,t){return D8(e,Fnt(t))};var E8="Either";var knt=function(e){return function(t){return Qa(t)?t:tR(e(t.right))}},k1e={URI:E8,map:B1e},PXr=jL(2,w8(k1e)),_Xr=w1e(k1e);var Lnt=function(e){return function(t){return Qa(t)?t:Qa(e)?e:tR(t.right(e.right))}},Fnt=Lnt;var Vnt={URI:E8,map:B1e,ap:Bnt,chain:Mnt};var Ont={URI:E8,fromEither:P1e};var Qa=_1e;var Gnt=function(e,t){return function(r){return Qa(r)?e(r.left):t(r.right)}};var Unt=Gnt,L1e=Unt;var RXr=jL(2,E1e(Vnt));var DXr={fromEither:Ont.fromEither};var fi=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),pA=function(){return pA=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},pA.apply(this,arguments)},Nnt=function(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))},Yx=M1e,xm=function(e,t,r){return Yx([{value:e,context:t,message:r}])},ms=tR,ko=function(){function e(t,r,n,o){this.name=t,this.is=r,this.validate=n,this.encode=o,this.decode=this.decode.bind(this)}return e.prototype.pipe=function(t,r){var n=this;return r===void 0&&(r="pipe(".concat(this.name,", ").concat(t.name,")")),new e(r,t.is,function(o,i){var a=n.validate(o,i);return Qa(a)?a:t.validate(a.right,i)},this.encode===Ei&&t.encode===Ei?Ei:function(o){return n.encode(t.encode(o))})},e.prototype.asDecoder=function(){return this},e.prototype.asEncoder=function(){return this},e.prototype.decode=function(t){return this.validate(t,[{key:"",type:this,actual:t}])},e}();var Ei=function(e){return e};function F8(e){return e.displayName||e.name||"<function".concat(e.length,">")}function By(e,t,r,n){for(var o=e.length,i=Array(o+1),a=0;a<o;a++)i[a]=e[a];return i[o]={key:t,type:r,actual:n},i}function xS(e,t){for(var r=t.length,n=0;n<r;n++)e.push(t[n])}var fA=Object.prototype.hasOwnProperty;function B8(e){return Object.keys(e).map(function(t){return"".concat(t,": ").concat(e[t].name)}).join(", ")}function rR(e){for(var t=0;t<e.length;t++)if(e[t].encode!==Ei)return!1;return!0}function U1e(e){return"{ ".concat(B8(e)," }")}function N1e(e){return"Partial<".concat(e,">")}function znt(e,t,r,n){n===void 0&&(n="{ [K in ".concat(t.name,"]: ").concat(r.name," }"));for(var o=e.length,i={},a=0;a<o;a++)i[e[a]]=r;var s=vot(i,n);return new Y1e(n,function(l){return s.is(l)},s.validate,s.encode,t,r)}function z1e(e){var t;if(j1e(e)){var r=e.value;if(V8.is(r))return t={},t[r]=null,t}else{if(qnt(e))return e.keys;if(X1e(e)){var n=e.types.map(function(o){return z1e(o)});return n.some(L8.is)?void 0:Object.assign.apply(Object,Nnt([{}],n,!1))}}}function F1e(e,t){for(var r=Object.keys(e),n=r.length,o=!1,i={},a=0;a<n;a++){var s=r[a];t.is(s)?i[s]=e[s]:o=!0}return o?i:e}function Hnt(e,t,r){return r===void 0&&(r="{ [K in ".concat(e.name,"]: ").concat(t.name," }")),new Y1e(r,function(n){return Pf.is(n)?Object.keys(n).every(function(o){return!e.is(o)||t.is(n[o])}):G1e(t)&&Array.isArray(n)},function(n,o){if(Pf.is(n)){for(var i={},a=[],s=Object.keys(n),l=s.length,u=!1,c=0;c<l;c++){var m=s[c],d=n[m],p=e.validate(m,By(o,m,e,m));if(Qa(p))u=!0;else{var h=p.right;u=u||h!==m,m=h;var f=t.validate(d,By(o,m,t,d));if(Qa(f))xS(a,f.left);else{var y=f.right;u=u||y!==d,i[m]=y}}}return a.length>0?Yx(a):ms(u?i:n)}return G1e(t)&&Array.isArray(n)?ms(n):xm(n,o)},e.encode===Ei&&t.encode===Ei?function(n){return F1e(n,e)}:function(n){for(var o={},i=Object.keys(F1e(n,e)),a=i.length,s=0;s<a;s++){var l=i[s];o[String(e.encode(l))]=t.encode(n[l])}return o},e,t)}function jnt(e){return"("+e.map(function(t){return t.name}).join(" | ")+")"}function V1e(e,t){for(var r=!0,n=!0,o=!Pf.is(e),i=0,a=t;i<a.length;i++){var s=a[i];s!==e&&(r=!1),Pf.is(s)&&(n=!1)}if(r)return e;if(n)return t[t.length-1];for(var l={},u=0,c=t;u<c.length;u++){var s=c[u];for(var m in s)(!fA.call(l,m)||o||s[m]!==e[m])&&(l[m]=s[m])}return l}function k8(e){switch(e._tag){case"RefinementType":case"ReadonlyType":return k8(e.type);case"InterfaceType":case"StrictType":case"PartialType":return e.props;case"IntersectionType":return e.types.reduce(function(t,r){return Object.assign(t,k8(r))},{})}}function O1e(e,t){for(var r=Object.getOwnPropertyNames(e),n=!1,o={},i=0;i<r.length;i++){var a=r[i];fA.call(t,a)?o[a]=e[a]:n=!0}return n?o:e}function Wnt(e){return W1e(e)?"{| ".concat(B8(e.props)," |}"):Ynt(e)?N1e("{| ".concat(B8(e.props)," |}")):"Exact<".concat(e.name,">")}function Xnt(e){return e.length>0}var fd={};function H1e(e,t){for(var r=[],n=0,o=e;n<o.length;n++){var i=o[n];t.indexOf(i)!==-1&&r.push(i)}return r}function Qnt(e,t){if(e===fd)return t;if(t===fd)return e;var r=Object.assign({},e);for(var n in t)if(fA.call(e,n)){var o=H1e(e[n],t[n]);if(Xnt(o))r[n]=o;else{r=fd;break}}else r[n]=t[n];return r}function Znt(e,t){if(e===fd||t===fd)return fd;var r=fd;for(var n in e)if(fA.call(t,n)){var o=H1e(e[n],t[n]);o.length===0&&(r===fd&&(r={}),r[n]=e[n].concat(t[n]))}return r}function G1e(e){return e._tag==="AnyType"}function j1e(e){return e._tag==="LiteralType"}function qnt(e){return e._tag==="KeyofType"}function W1e(e){return e._tag==="InterfaceType"}function Ynt(e){return e._tag==="PartialType"}function Knt(e){return e._tag==="StrictType"}function Jnt(e){return e._tag==="ExactType"}function $nt(e){return e._tag==="RefinementType"}function eot(e){return e._tag==="IntersectionType"}function X1e(e){return e._tag==="UnionType"}function tot(e){return e._tag==="RecursiveType"}function rot(e){return e._tag==="ReadonlyType"}var M8=[];function bS(e){if(M8.indexOf(e)!==-1)return fd;if(W1e(e)||Knt(e)){var t=fd;for(var r in e.props){var n=e.props[r];j1e(n)&&(t===fd&&(t={}),t[r]=[n.value])}return t}else{if(Jnt(e)||$nt(e)||rot(e))return bS(e.type);if(eot(e))return e.types.reduce(function(i,a){return Qnt(i,bS(a))},fd);if(X1e(e))return e.types.slice(1).reduce(function(i,a){return Znt(i,bS(a))},bS(e.types[0]));if(tot(e)){M8.push(e);var o=bS(e.type);return M8.pop(),o}}return fd}function not(e){var t=bS(e[0]),r=Object.keys(t),n=e.length,o=function(u){for(var c=t[u].slice(),m=[t[u]],d=1;d<n;d++){var p=e[d],h=bS(p),f=h[u];if(f===void 0)return"continue-keys";if(f.some(function(y){return c.indexOf(y)!==-1}))return"continue-keys";c.push.apply(c,f),m.push(f)}return{value:[u,m]}};e:for(var i=0,a=r;i<a.length;i++){var s=a[i],l=o(s);if(typeof l=="object")return l.value;switch(l){case"continue-keys":continue e}}}var oot=function(e){fi(t,e);function t(){var r=e.call(this,"null",function(n){return n===null},function(n,o){return r.is(n)?ms(n):xm(n,o)},Ei)||this;return r._tag="NullType",r}return t}(ko);var Q1e=new oot,iot=function(e){fi(t,e);function t(){var r=e.call(this,"undefined",function(n){return n===void 0},function(n,o){return r.is(n)?ms(n):xm(n,o)},Ei)||this;return r._tag="UndefinedType",r}return t}(ko);var L8=new iot,aot=function(e){fi(t,e);function t(){var r=e.call(this,"void",L8.is,L8.validate,Ei)||this;return r._tag="VoidType",r}return t}(ko);var MXr=new aot,sot=function(e){fi(t,e);function t(){var r=e.call(this,"unknown",function(n){return!0},ms,Ei)||this;return r._tag="UnknownType",r}return t}(ko);var BXr=new sot,lot=function(e){fi(t,e);function t(){var r=e.call(this,"string",function(n){return typeof n=="string"},function(n,o){return r.is(n)?ms(n):xm(n,o)},Ei)||this;return r._tag="StringType",r}return t}(ko);var V8=new lot,uot=function(e){fi(t,e);function t(){var r=e.call(this,"number",function(n){return typeof n=="number"},function(n,o){return r.is(n)?ms(n):xm(n,o)},Ei)||this;return r._tag="NumberType",r}return t}(ko);var XL=new uot,cot=function(e){fi(t,e);function t(){var r=e.call(this,"bigint",function(n){return typeof n=="bigint"},function(n,o){return r.is(n)?ms(n):xm(n,o)},Ei)||this;return r._tag="BigIntType",r}return t}(ko);var kXr=new cot,mot=function(e){fi(t,e);function t(){var r=e.call(this,"boolean",function(n){return typeof n=="boolean"},function(n,o){return r.is(n)?ms(n):xm(n,o)},Ei)||this;return r._tag="BooleanType",r}return t}(ko);var Z1e=new mot,dot=function(e){fi(t,e);function t(){var r=e.call(this,"UnknownArray",Array.isArray,function(n,o){return r.is(n)?ms(n):xm(n,o)},Ei)||this;return r._tag="AnyArrayType",r}return t}(ko);var WL=new dot,pot=function(e){fi(t,e);function t(){var r=e.call(this,"UnknownRecord",function(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)},function(n,o){return r.is(n)?ms(n):xm(n,o)},Ei)||this;return r._tag="AnyDictionaryType",r}return t}(ko);var Pf=new pot;var LXr=function(e){fi(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.value=a,s._tag="LiteralType",s}return t}(ko);var FXr=function(e){fi(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.keys=a,s._tag="KeyofType",s}return t}(ko);var fot=function(e){fi(t,e);function t(r,n,o,i,a,s){var l=e.call(this,r,n,o,i)||this;return l.type=a,l.predicate=s,l._tag="RefinementType",l}return t}(ko);function hot(e,t,r){return tve(e,t,r)}var VXr=hot(XL,function(e){return Number.isInteger(e)},"Int"),got=function(e){fi(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.runDefinition=a,s._tag="RecursiveType",s}return t}(ko);Object.defineProperty(got.prototype,"type",{get:function(){return this.runDefinition()},enumerable:!0,configurable:!0});var yot=function(e){fi(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.type=a,s._tag="ArrayType",s}return t}(ko);function q1e(e,t){return t===void 0&&(t="Array<".concat(e.name,">")),new yot(t,function(r){return WL.is(r)&&r.every(e.is)},function(r,n){var o=WL.validate(r,n);if(Qa(o))return o;for(var i=o.right,a=i.length,s=i,l=[],u=0;u<a;u++){var c=i[u],m=e.validate(c,By(n,String(u),e,c));if(Qa(m))xS(l,m.left);else{var d=m.right;d!==c&&(s===i&&(s=i.slice()),s[u]=d)}}return l.length>0?Yx(l):ms(s)},e.encode===Ei?Ei:function(r){return r.map(e.encode)},e)}var bot=function(e){fi(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.props=a,s._tag="InterfaceType",s}return t}(ko);function QL(e,t){t===void 0&&(t=U1e(e));var r=Object.keys(e),n=r.map(function(i){return e[i]}),o=r.length;return new bot(t,function(i){if(Pf.is(i)){for(var a=0;a<o;a++){var s=r[a],l=i[s];if(l===void 0&&!fA.call(i,s)||!n[a].is(l))return!1}return!0}return!1},function(i,a){var s=Pf.validate(i,a);if(Qa(s))return s;for(var l=s.right,u=l,c=[],m=0;m<o;m++){var d=r[m],p=u[d],h=n[m],f=h.validate(p,By(a,d,h,p));if(Qa(f))xS(c,f.left);else{var y=f.right;(y!==p||y===void 0&&!fA.call(u,d))&&(u===l&&(u=pA({},l)),u[d]=y)}}return c.length>0?Yx(c):ms(u)},rR(n)?Ei:function(i){for(var a=pA({},i),s=0;s<o;s++){var l=r[s],u=n[s].encode;u!==Ei&&(a[l]=u(i[l]))}return a},e)}var xot=function(e){fi(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.props=a,s._tag="PartialType",s}return t}(ko);function O8(e,t){t===void 0&&(t=N1e(U1e(e)));var r=Object.keys(e),n=r.map(function(i){return e[i]}),o=r.length;return new xot(t,function(i){if(Pf.is(i)){for(var a=0;a<o;a++){var s=r[a],l=i[s];if(l!==void 0&&!e[s].is(l))return!1}return!0}return!1},function(i,a){var s=Pf.validate(i,a);if(Qa(s))return s;for(var l=s.right,u=l,c=[],m=0;m<o;m++){var d=r[m],p=u[d],h=e[d],f=h.validate(p,By(a,d,h,p));if(Qa(f))p!==void 0&&xS(c,f.left);else{var y=f.right;y!==p&&(u===l&&(u=pA({},l)),u[d]=y)}}return c.length>0?Yx(c):ms(u)},rR(n)?Ei:function(i){for(var a=pA({},i),s=0;s<o;s++){var l=r[s],u=i[l];u!==void 0&&(a[l]=n[s].encode(u))}return a},e)}var Y1e=function(e){fi(t,e);function t(r,n,o,i,a,s){var l=e.call(this,r,n,o,i)||this;return l.domain=a,l.codomain=s,l._tag="DictionaryType",l}return t}(ko);function K1e(e,t,r){var n=z1e(e);return n?znt(Object.keys(n),e,t,r):Hnt(e,t,r)}var ZL=function(e){fi(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.types=a,s._tag="UnionType",s}return t}(ko);function J1e(e,t){t===void 0&&(t=jnt(e));var r=not(e);if(r!==void 0&&e.length>0){var n=r[0],o=r[1],i=o.length,a=function(s){for(var l=0;l<i;l++)if(o[l].indexOf(s)!==-1)return l};return new Rot(t,function(s){if(Pf.is(s)){var l=a(s[n]);return l!==void 0?e[l].is(s):!1}return!1},function(s,l){var u=Pf.validate(s,l);if(Qa(u))return u;var c=u.right,m=a(c[n]);if(m===void 0)return xm(s,l);var d=e[m];return d.validate(c,By(l,String(m),d,c))},rR(e)?Ei:function(s){var l=a(s[n]);if(l===void 0)throw new Error("no codec found to encode value in union codec ".concat(t));return e[l].encode(s)},e,n)}else return new ZL(t,function(s){return e.some(function(l){return l.is(s)})},function(s,l){for(var u=[],c=0;c<e.length;c++){var m=e[c],d=m.validate(s,By(l,String(c),m,s));if(Qa(d))xS(u,d.left);else return ms(d.right)}return Yx(u)},rR(e)?Ei:function(s){for(var l=0,u=e;l<u.length;l++){var c=u[l];if(c.is(s))return c.encode(s)}throw new Error("no codec found to encode value in union type ".concat(t))},e)}var Cot=function(e){fi(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.types=a,s._tag="IntersectionType",s}return t}(ko);function $1e(e,t){t===void 0&&(t="(".concat(e.map(function(n){return n.name}).join(" & "),")"));var r=e.length;return new Cot(t,function(n){return e.every(function(o){return o.is(n)})},e.length===0?ms:function(n,o){for(var i=[],a=[],s=0;s<r;s++){var l=e[s],u=l.validate(n,By(o,String(s),l,n));Qa(u)?xS(a,u.left):i.push(u.right)}return a.length>0?Yx(a):ms(V1e(n,i))},e.length===0?Ei:function(n){return V1e(n,e.map(function(o){return o.encode(n)}))},e)}var Sot=function(e){fi(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.types=a,s._tag="TupleType",s}return t}(ko);function eve(e,t){t===void 0&&(t="[".concat(e.map(function(n){return n.name}).join(", "),"]"));var r=e.length;return new Sot(t,function(n){return WL.is(n)&&n.length===r&&e.every(function(o,i){return o.is(n[i])})},function(n,o){var i=WL.validate(n,o);if(Qa(i))return i;for(var a=i.right,s=a.length>r?a.slice(0,r):a,l=[],u=0;u<r;u++){var c=a[u],m=e[u],d=m.validate(c,By(o,String(u),m,c));if(Qa(d))xS(l,d.left);else{var p=d.right;p!==c&&(s===a&&(s=a.slice()),s[u]=p)}}return l.length>0?Yx(l):ms(s)},rR(e)?Ei:function(n){return e.map(function(o,i){return o.encode(n[i])})},e)}var OXr=function(e){fi(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.type=a,s._tag="ReadonlyType",s}return t}(ko);var GXr=function(e){fi(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.type=a,s._tag="ReadonlyArrayType",s}return t}(ko);var vot=function(e,t){return Aot(QL(e),t)},Iot=function(e){fi(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.type=a,s._tag="ExactType",s}return t}(ko);function Aot(e,t){t===void 0&&(t=Wnt(e));var r=k8(e);return new Iot(t,e.is,function(n,o){var i=Pf.validate(n,o);if(Qa(i))return i;var a=e.validate(n,o);return Qa(a)?a:tR(O1e(a.right,r))},function(n){return e.encode(O1e(n,r))},e)}var Tot=function(e){fi(t,e);function t(){var r=e.call(this,"Function",function(n){return typeof n=="function"},function(n,o){return r.is(n)?ms(n):xm(n,o)},Ei)||this;return r._tag="FunctionType",r}return t}(ko);var UXr=new Tot,Pot=function(e){fi(t,e);function t(){var r=e.call(this,"never",function(n){return!1},function(n,o){return xm(n,o)},function(){throw new Error("cannot encode never")})||this;return r._tag="NeverType",r}return t}(ko);var NXr=new Pot,_ot=function(e){fi(t,e);function t(){var r=e.call(this,"any",function(n){return!0},ms,Ei)||this;return r._tag="AnyType",r}return t}(ko);var zXr=new _ot;function tve(e,t,r){return r===void 0&&(r="(".concat(e.name," | ").concat(F8(t),")")),new fot(r,function(n){return e.is(n)&&t(n)},function(n,o){var i=e.validate(n,o);if(Qa(i))return i;var a=i.right;return t(a)?ms(a):xm(a,o)},e.encode,e,t)}var rve=tve(XL,Number.isInteger,"Integer"),Rot=function(e){fi(t,e);function t(r,n,o,i,a,s){var l=e.call(this,r,n,o,i,a)||this;return l.tag=s,l}return t}(ZL);var Dot=function(e){fi(t,e);function t(){var r=e.call(this,"object",function(n){return n!==null&&typeof n=="object"},function(n,o){return r.is(n)?ms(n):xm(n,o)},Ei)||this;return r._tag="ObjectType",r}return t}(ko);var HXr=new Dot;var jXr=function(e){fi(t,e);function t(r,n,o,i,a){var s=e.call(this,r,n,o,i)||this;return s.props=a,s._tag="StrictType",s}return t}(ko);function wot(e){return typeof e=="function"?F8(e):typeof e=="number"&&!isFinite(e)?isNaN(e)?"NaN":e>0?"Infinity":"-Infinity":JSON.stringify(e)}function Eot(e){return e.map(function(t){var r=t.key,n=t.type;return"".concat(r,": ").concat(n.name)}).join("/")}function Mot(e){return e.message!==void 0?e.message:"Invalid value ".concat(wot(e.value)," supplied to ").concat(Eot(e.context))}function Bot(e){return e.map(Mot)}function kot(){return["No errors!"]}var ove={report:L1e(Bot,kot)};var Qr=V8,Ai=rve,wr=XL,Mi=Z1e,Xh=eve,Zl=q1e,_f=K1e;function qL(e,t,r){if(!t)return QL(e,r);if(r===void 0){let n=[];for(let o in e)n.push(`${o}: ${e[o].name}`);for(let o in t)n.push(`${o}?: ${t[o].name}`);r=`{ ${n.join(", ")} }`}return $1e([QL(e),O8(t)],r)}function G8(e,t){if(t===void 0){let r=[];for(let n in e)r.push(`${n}?: ${e[n].name}`);t=`{ ${r.join(", ")} }`}return O8(e,t)}function Zu(e,t,...r){let n=[];for(let o of[e,t,...r])o instanceof ZL?n.push(...o.types):n.push(o);return J1e(n)}function rr(e){return Zu(e,Q1e)}function va(...e){if(e.length===0)throw new Error("literal type must have at least one value");let t=e.length===1?kD(e[0]):`(${e.map(n=>kD(n)).join(" | ")})`,r=new Set(e);return new ko(t,n=>r.has(n),(n,o)=>r.has(n)?{_tag:"Right",right:n}:{_tag:"Left",left:[{value:n,context:o,message:`"${n}" is not a valid value for literal type ${t}`}]},n=>n)}function _n(e,t){return{type:e,required:!0,description:t}}function rt(e,t,r){return{type:e,required:!1,description:r,default:t}}function ive(e,t){let r=e.type.decode(t);if(r._tag!=="Right")return ove.report(r)}function on(e){return{type:"simple",fields:e}}function CS(e,t,r){return{type:"union",discriminator:e,discriminatorDescription:t,cases:r}}function Lot(e){let t=GT(e.fields,r=>_n(r.type,r.description));return on(t)}function Fot(e){let t=GT(e.cases,U8);return CS(e.discriminator,e.discriminatorDescription,t)}function U8(e){return e.type==="simple"?Lot(e):Fot(e)}function N8(e,t,r={}){return s1(t)?e.type==="simple"?Vot(e,t,r):Oot(e,t,r):[`Parameters must be an object, not ${t}`]}function Vot(e,t,r){for(let n in e.fields){let o=e.fields[n];if(Object.hasOwn(t,n)){let i=t[n],a=ive(o,i);if(a)return[`Invalid value for parameter "${n}":`,...a.map(s=>"  "+s)]}else{if(o.required)return[`Missing required parameter "${n}".`];if(r.requireAll)return[`Missing optional parameter "${n}".`]}}if(r.noExtra){for(let n in t)if(!Object.hasOwn(e.fields,n))return[`Unknown parameter "${n}".`]}}function Oot(e,t,r){if(!Object.hasOwn(t,e.discriminator))return[`Missing required parameter "${e.discriminator}".`];let n=t[e.discriminator],o=e.cases[n];if(o===void 0){let a=Object.keys(e.cases).map(s=>`"${s}"`).join(" | ");return[`Invalid value for parameter "${e.discriminator}":`,`"${n}" is not a valid value for literal type (${a})`]}let i=N8(o,nc(t,[e.discriminator]),r);if(i)return i.unshift(`(case "${e.discriminator}": "${n}")`),i.map(a=>"  "+a)}function z8(e,t){return e.type==="simple"?Got(e,t):Uot(e,t)}function Got(e,t){let r={...t};for(let n in e.fields){let o=e.fields[n];!o.required&&r[n]===void 0&&(r[n]=o.default)}return r}function Uot(e,t){let r=t[e.discriminator],n=e.cases[r];return z8(n,t)}function kc(e,t,r){return ave(e,void 0,t,r)}function ave(e,t,r,n){r&&r(e,t);for(let o of e.children??[])ave(o,e,r,n);n&&n(e,t)}function nR(e){let t=0,r=[];return kc(e,n=>r.push("  ".repeat(t++)+Not(n)),n=>t--),r.join(`
`)}function Not(e){return`- ${e.kind} ${oR(e.params??{})}${zot(e.custom)}${Hot(e.ref)}`}function oR(e){return e?JSON.stringify(e).replace(/,("\w+":)/g,", $1").replace(/"(\w+)":/g,"$1: "):"undefined"}function zot(e){return!e||Object.keys(e).length===0?"":`, custom: ${oR(e)}`}function Hot(e){return e===void 0?"":`, ref: "${e}"`}function jot(e){return{kind:e.kind,params:e.params?{...e.params}:void 0,custom:e.custom?{...e.custom}:void 0,ref:e.ref}}function Wot(e){return YL(e,{})}function YL(e,t){let r=new Map,n;return kc(e,(o,i)=>{let a=t[o.kind];if(a){let s=a(o,i);if(!i&&s.length===0)throw new Error("Cannot convert root to empty path");let l=i?r.get(i):void 0;for(let u of s)l?(l.children??=[]).push(u):n=u,l=u;r.set(o,l)}else{let s=jot(o);i?(r.get(i).children??=[]).push(s):n=s,r.set(o,s)}}),n}function sve(e,t,r){let n=new Map,o=Wot(e);return kc(o,i=>{n.clear();let a=[];for(let s of i.children??[]){let l;if((!t||t.has(s.kind))&&!r?.has(s.kind)){let c=s.kind+Pg(H8(s));l=n.get(c),l||n.set(c,s)}l?(l.children??=[]).push(...s.children??[]):a.push(s)}i.children=a}),o}function lve(e,t){let r={};for(let n in t.nodes)r[n]=o=>[{kind:o.kind,params:z8(t.nodes[n].params,o.params),custom:o.custom,ref:o.ref}];return YL(e,r)}function uve(e,t,r){kc(e,n=>{let o=n.params;if(o){for(let i in o)if(r.includes(i)){let a=o[i];typeof a=="string"&&(o[i]=Xot(a,t,Qot()))}}})}function Xot(...e){let t;for(let r of e.reverse())r!==void 0&&(t===void 0?t=r:t=new URL(r,t).href);return t}function Qot(){return typeof window<"u"?window.location.href:void 0}function H8(e){return e.params??{}}function cve(e){return e.custom??{}}function SS(e){return e.children??[]}function mve(e){return{...e,nodes:GT(e.nodes,t=>({...t,params:U8(t.params)}))}}function KL(e,t,r={}){if(!s1(t))return[`Node must be an object, not ${t}`];if(!r.anyRoot&&t.kind!==e.rootKind)return[`Invalid root node kind "${t.kind}", root must be of kind "${e.rootKind}"`];let n=e.nodes[t.kind];if(!n)return[`Unknown node kind "${t.kind}"`];if(n.parent&&r.parent!==void 0&&!n.parent.includes(r.parent))return[`Node of kind "${t.kind}" cannot appear as a child of "${r.parent}". Allowed parents for "${t.kind}" are: ${n.parent.map(i=>`"${i}"`).join(", ")}`];let o=N8(n.params,H8(t),r);if(o)return[`Invalid parameters for node of kind "${t.kind}":`,...o.map(i=>"  "+i)];if(t.custom!==void 0&&(typeof t.custom!="object"||t.custom===null))return[`Invalid "custom" for node of kind "${t.kind}": must be an object, not ${t.custom}.`];for(let i of SS(t)){let a=KL(e,i,{...r,anyRoot:!0,parent:t.kind});if(a)return a}}function j8(e,t,r){let n=KL(e,t,{noExtra:!0});if(n){console.warn(`Invalid ${r} tree:
${nR(t)}`),console.error(`${r} tree validation issues:`);for(let o of n)console.error(" ",o);throw new Error("FormatError")}}var dve=va("mmcif","bcif","pdb","map"),W8=va("cif","pdb","map"),pve=va("model","assembly","symmetry","symmetry_mates"),X8=va("all","polymer","protein","nucleic","branched","ligand","ion","water","coarse"),vS=G8({label_entity_id:Qr,label_asym_id:Qr,auth_asym_id:Qr,label_seq_id:Ai,auth_seq_id:Ai,pdbx_PDB_ins_code:Qr,beg_label_seq_id:Ai,end_label_seq_id:Ai,beg_auth_seq_id:Ai,end_auth_seq_id:Ai,label_comp_id:Qr,auth_comp_id:Qr,label_atom_id:Qr,auth_atom_id:Qr,type_symbol:Qr,atom_id:Ai,atom_index:Ai,instance_id:Qr}),JL=va("whole_structure","entity","chain","auth_chain","residue","auth_residue","residue_range","auth_residue_range","atom","auth_atom","all_atomic"),fve=va("cif","bcif","json"),Za=Xh([wr,wr,wr]),IS=Zl(wr),Zot=G8({structure_ref:Qr,expression_schema:JL,expressions:Zl(vS)}),qu=Zu(Za,vS,Zot),Q8=Zl(wr),iR=Zl(Ai),hve=Zl(Qr),qot=new ko("HexColor",e=>typeof e=="string",(e,t)=>Gce.is(e)?{_tag:"Right",right:e}:{_tag:"Left",left:[{value:e,context:t,message:`"${e}" is not a valid hex color string`}]},e=>e),Yot=new ko("ColorName",e=>typeof e=="string",(e,t)=>Uce.is(e)?{_tag:"Right",right:e}:{_tag:"Left",left:[{value:e,context:t,message:`"${e}" is not a valid color name`}]},e=>e),Qo=Zu(Yot,qot);function gve(e){return!!e&&Array.isArray(e)&&e.length===3&&typeof e[0]=="number"}function Z8(e){return!!e&&Array.isArray(e.expressions)}function yve(e){return!!e&&typeof e=="object"&&!e.expressions}var q8=va("Reds","Oranges","Greens","Blues","Purples","Greys","OrRd","BuGn","PuBuGn","GnBu","PuBu","BuPu","RdPu","PuRd","YlOrRd","YlOrBr","YlGn","YlGnBu","Magma","Inferno","Plasma","Viridis","Cividis","Turbo","Warm","Cool","CubehelixDefault","Rainbow","Sinebow","RdBu","RdGy","PiYG","BrBG","PRGn","PuOr","RdYlGn","RdYlBu","Spectral","Category10","Observable10","Tableau10","Set1","Set2","Set3","Pastel1","Pastel2","Dark2","Paired","Accent","Chainbow"),Kot=va("ElementSymbol","ResidueName","ResidueProperties","SecondaryStructure"),Jot=qL({kind:va("categorical")},{colors:Zu(q8,Kot,Zl(Qo),_f(Qr,Qo)),repeat_color_list:Mi,sort:va("none","lexical","numeric"),sort_direction:va("ascending","descending"),case_insensitive:Mi,missing_color:rr(Qo)}),bve={kind:"categorical",colors:"Category10",repeat_color_list:!1,sort:"none",sort_direction:"ascending",case_insensitive:!1,missing_color:null},$ot=qL({kind:va("discrete")},{colors:Zu(q8,Zl(Qo),Zl(Xh([Qo,wr])),Zl(Xh([rr(Qo),rr(wr),rr(wr)]))),reverse:Mi,mode:va("normalized","absolute"),value_domain:Xh([rr(wr),rr(wr)])}),xve={kind:"discrete",colors:"YlGn",reverse:!1,mode:"normalized",value_domain:[null,null]},eit=qL({kind:va("continuous")},{colors:Zu(q8,Zl(Qo),Zl(Xh([Qo,wr]))),reverse:Mi,mode:va("normalized","absolute"),value_domain:Xh([rr(wr),rr(wr)]),underflow_color:rr(Zu(va("auto"),Qo)),overflow_color:rr(Zu(va("auto"),Qo))}),Cve={kind:"continuous",colors:"YlGn",reverse:!1,mode:"normalized",value_domain:[null,null],underflow_color:null,overflow_color:null},Y8=Zu(Jot,$ot,eit);var tit={size_factor:rt(wr,1,"Scales the corresponding visuals."),tubular_helices:rt(Mi,!1,"Simplify corkscrew helices to tubes.")},rit={size_factor:rt(wr,1,"Scales the corresponding visuals."),ignore_hydrogens:rt(Mi,!1,"Controls whether hydrogen atoms are drawn.")},nit={size_factor:rt(wr,1,"Scales the corresponding visuals."),ignore_hydrogens:rt(Mi,!1,"Controls whether hydrogen atoms are drawn.")},oit={size_factor:rt(wr,1,"Scales the corresponding visuals.")},iit={size_factor:rt(wr,1,"Scales the corresponding visuals."),ignore_hydrogens:rt(Mi,!1,"Controls whether hydrogen atoms are drawn.")},Sve=CS("type","Representation type",{cartoon:on(tit),ball_and_stick:on(rit),spacefill:on(nit),carbohydrate:on(oit),surface:on(iit)}),ait={relative_isovalue:rt(rr(wr),null,"Relative isovalue."),absolute_isovalue:rt(rr(wr),null,"Absolute isovalue. Overrides `relative_isovalue`."),show_wireframe:rt(Mi,!1,"Show mesh wireframe. Defaults to false."),show_faces:rt(Mi,!0,"Show mesh faces. Defaults to true.")},sit={dimension:_n(va("x","y","z"),"Dimension of the grid slice, i.e. 'x', 'y', or 'z'."),absolute_index:rt(rr(Ai),null,"Index of the grid slice in the specified dimension. 0-based index, i.e. 0 is the first slice."),relative_index:rt(rr(wr),null,"Relative index of the grid slice in the specified dimension. 0.0 is the first slice, 1.0 is the last slice. Overrides `absolute_index`."),relative_isovalue:rt(rr(wr),null,"Relative isovalue."),absolute_isovalue:rt(rr(wr),null,"Absolute isovalue. Overrides `relative_isovalue`.")},vve=CS("type","Representation type",{isosurface:on(ait),grid_slice:on(sit)}),K8={check_transform:rt(rr(IS),null,"Transformation matrix to applied to each point before clipping. For example, can be used to clip volumes in the grid/fractional space. Default is null."),invert:rt(Mi,!1,"Inverts the clipping region. Default is false"),variant:rt(va("object","pixel"),"pixel",'Variant of the clip node, either "object" or "pixel"')},Ive=CS("type","Clip type",{plane:on({...K8,normal:_n(Za,"Normal vector of the clipping plane."),point:_n(Za,"Point on the clipping plane.")}),sphere:on({...K8,center:_n(Za,"Center of the clipping sphere."),radius:rt(wr,1,"Radius of the clipping sphere.")}),box:on({...K8,center:_n(Za,"Center of the clipping box."),size:rt(Za,[1,1,1],"Size of the clipping box."),rotation:rt(IS,[1,0,0,0,1,0,0,0,1],"Rotation matrix (3x3 matrix flattened in column major format (j*3+i indexing), this is equivalent to Fortran-order in numpy). This matrix will multiply the structure coordinates from the left. The default value is the identity matrix (corresponds to no rotation).")})});var Ave={start:_n(qu,"Start point of the tube."),end:_n(qu,"End point of the tube."),radius:rt(wr,.05,"Tube radius (in Angstroms)."),dash_length:rt(rr(wr),null,"Length of each dash and gap between dashes. If not specified (null), draw full line."),color:rt(rr(Qo),null,"Color of the tube. If not specified, uses the parent primitives group `color`.")},lit={vertices:_n(Q8,"3*n_vertices length array of floats with vertex position (x1, y1, z1, ...)."),indices:_n(iR,"3*n_triangles length array of indices into vertices that form triangles (t1_1, t1_2, t1_3, ...)."),triangle_groups:rt(rr(iR),null,"Assign a number to each triangle to group them. If not specified, each triangle is considered a separate group (triangle i = group i)."),group_colors:rt(_f(Ai,Qo),{},"Assign a color to each group. Where not assigned, uses `color`."),group_tooltips:rt(_f(Ai,Qr),{},"Assign a tooltip to each group. Where not assigned, uses `tooltip`."),color:rt(rr(Qo),null,"Color of the triangles and wireframe. Can be overwritten by `group_colors`. If not specified, uses the parent primitives group `color`."),tooltip:rt(rr(Qr),null,"Tooltip shown when hovering over the mesh. Can be overwritten by `group_tooltips`. If not specified, uses the parent primitives group `tooltip`."),show_triangles:rt(Mi,!0,"Determine whether to render triangles of the mesh."),show_wireframe:rt(Mi,!1,"Determine whether to render wireframe of the mesh."),wireframe_width:rt(wr,1,"Wireframe line width (in screen-space units)."),wireframe_color:rt(rr(Qo),null,"Wireframe color. If not specified, uses `group_colors`.")},uit={vertices:_n(Q8,"3*n_vertices length array of floats with vertex position (x1, y1, z1, ...)."),indices:_n(iR,"2*n_lines length array of indices into vertices that form lines (l1_1, l1_2, ...)."),line_groups:rt(rr(iR),null,"Assign a number to each triangle to group them. If not specified, each line is considered a separate group (line i = group i)."),group_colors:rt(_f(Ai,Qo),{},"Assign a color to each group. Where not assigned, uses `color`."),group_tooltips:rt(_f(Ai,Qr),{},"Assign a tooltip to each group. Where not assigned, uses `tooltip`."),group_widths:rt(_f(Ai,wr),{},"Assign a line width to each group. Where not assigned, uses `width`."),color:rt(rr(Qo),null,"Color of the lines. Can be overwritten by `group_colors`. If not specified, uses the parent primitives group `color`."),tooltip:rt(rr(Qr),null,"Tooltip shown when hovering over the lines. Can be overwritten by `group_tooltips`. If not specified, uses the parent primitives group `tooltip`."),width:rt(wr,1,"Line width (in screen-space units). Can be overwritten by `group_widths`.")},cit={...Ave,tooltip:rt(rr(Qr),null,"Tooltip to show when hovering over the tube. If not specified, uses the parent primitives group `tooltip`.")},mit={start:_n(qu,"Start point of the arrow."),end:rt(rr(qu),null,"End point of the arrow."),direction:rt(rr(Za),null,"If specified, the endpoint is computed as start + direction."),length:rt(rr(wr),null,"Length of the arrow. If unset, the distance between start and end is used."),show_start_cap:rt(Mi,!1,"Draw a cap at the start of the arrow."),start_cap_length:rt(rr(wr),null,"Length of the start cap. If not provided, will be 2 * start_cap_radius."),start_cap_radius:rt(rr(wr),null,"Radius of the start cap. If not provided, will be 2 * tube_radius."),show_end_cap:rt(Mi,!1,"Draw a cap at the end of the arrow."),end_cap_length:rt(rr(wr),null,"Length of the end cap. If not provided, will be 2 * end_cap_radius."),end_cap_radius:rt(rr(wr),null,"Radius of the end cap. If not provided, will be 2 * tube_radius."),show_tube:rt(Mi,!0,"Draw a tube connecting the start and end points."),tube_radius:rt(wr,.05,"Tube radius (in Angstroms)."),tube_dash_length:rt(rr(wr),null,"Length of each dash and gap between dashes. If not specified (null), draw full line."),color:rt(rr(Qo),null,"Color of the tube. If not specified, uses the parent primitives group `color`."),tooltip:rt(rr(Qr),null,"Tooltip to show when hovering over the arrow. If not specified, uses the parent primitives group `tooltip`.")},dit={...Ave,label_template:rt(Qr,"{{distance}}","Template used to construct the label. Use {{distance}} as placeholder for the distance."),label_size:rt(rr(wr),null,"Size of the label (text height in Angstroms). If not specified, size will be relative to the distance (see label_auto_size_scale, label_auto_size_min)."),label_auto_size_scale:rt(wr,.1,"Scaling factor for relative size."),label_auto_size_min:rt(wr,0,"Minimum size for relative size."),label_color:rt(rr(Qo),null,"Color of the label. If not specified, uses the parent primitives group `label_color`.")},pit={a:_n(qu,"Point A."),b:_n(qu,"Point B."),c:_n(qu,"Point C."),label_template:rt(Qr,"{{angle}}","Template used to construct the label. Use {{angle}} as placeholder for the angle in radians."),label_size:rt(rr(wr),null,"Size of the label (text height in Angstroms). If not specified, size will be relative to the distance (see label_auto_size_scale, label_auto_size_min)."),label_auto_size_scale:rt(wr,.33,"Scaling factor for relative size."),label_auto_size_min:rt(wr,0,"Minimum size for relative size."),label_color:rt(rr(Qo),null,"Color of the label. If not specified, uses the parent primitives group `label_color`."),show_vector:rt(Mi,!0,"Draw vectors between (a, b) and (b, c)."),vector_color:rt(rr(Qo),null,"Color of the vectors."),vector_radius:rt(wr,.05,"Radius of the vectors."),show_section:rt(Mi,!0,"Draw a filled circle section representing the angle."),section_color:rt(rr(Qo),null,"Color of the angle section. If not specified, the primitives group color is used."),section_radius:rt(rr(wr),null,"Radius of the angle section. In angstroms."),section_radius_scale:rt(wr,.33,"Factor to scale the radius of the angle section. Ignored if section_radius is set.")},fit={position:_n(qu,"Position of this label."),text:_n(Qr,"The label."),label_size:rt(wr,1,"Size of the label (text height in Angstroms)."),label_color:rt(rr(Qo),null,"Color of the label. If not specified, uses the parent primitives group `label_color`."),label_offset:rt(wr,0,"Camera-facing offset to prevent overlap with geometry.")},hit={color:rt(rr(Qo),null,"Color of the ellipse. If not specified, uses the parent primitives group `color`."),as_circle:rt(Mi,!1,"If true, ignores radius_minor/magnitude of the minor axis."),center:_n(qu,"The center of the ellipse."),major_axis:rt(rr(Za),null,"Major axis of this ellipse."),minor_axis:rt(rr(Za),null,"Minor axis of this ellipse."),major_axis_endpoint:rt(rr(qu),null,"Major axis endpoint. If specified, overrides major axis to be major_axis_endpoint - center."),minor_axis_endpoint:rt(rr(qu),null,"Minor axis endpoint. If specified, overrides minor axis to be minor_axis_endpoint - center."),radius_major:rt(rr(wr),null,"Radius of the major axis. If unset, the length of the major axis is used."),radius_minor:rt(rr(wr),null,"Radius of the minor axis. If unset, the length of the minor axis is used."),theta_start:rt(wr,0,"Start of the arc. In radians"),theta_end:rt(wr,2*Math.PI,"End of the arc. In radians"),tooltip:rt(rr(Qr),null,"Tooltip to show when hovering over the tube. If not specified, uses the parent primitives group `tooltip`.")},git={color:rt(rr(Qo),null,"Color of the ellipsoid. If not specified, uses the parent primitives group `color`."),center:_n(qu,"The center of the ellipsoid."),major_axis:rt(rr(Za),null,"Major axis of this ellipsoid."),minor_axis:rt(rr(Za),null,"Minor axis of this ellipsoid."),major_axis_endpoint:rt(rr(qu),null,"Major axis endpoint. If specified, overrides major axis to be major_axis_endpoint - center."),minor_axis_endpoint:rt(rr(qu),null,"Minor axis endpoint. If specified, overrides minor axis to be minor_axis_endpoint - center."),radius:rt(rr(Zu(Za,wr)),null,"Radii of the ellipsoid along each axis."),radius_extent:rt(rr(Zu(Za,wr)),null,"Added to the radii of the ellipsoid along each axis."),tooltip:rt(rr(Qr),null,"Tooltip to show when hovering over the tube. If not specified, uses the parent primitives group `tooltip`.")},yit={center:_n(qu,"The center of the box."),extent:rt(rr(Za),null,"The width, the height, and the depth of the box. Added to the bounding box determined by the center."),show_faces:rt(Mi,!0,"Determine whether to render the faces of the box."),face_color:rt(rr(Qo),null,"Color of the box faces."),show_edges:rt(Mi,!1,"Determine whether to render the edges of the box."),edge_radius:rt(wr,.1,"Radius of the box edges. In angstroms."),edge_color:rt(rr(Qo),null,"Color of the edges."),tooltip:rt(rr(Qr),null,"Tooltip to show when hovering over the tube. If not specified, uses the parent primitives group `tooltip`.")},Tve=CS("kind","Kind of geometrical primitive",{mesh:on(lit),lines:on(uit),tube:on(cit),arrow:on(mit),distance_measurement:on(dit),angle_measurement:on(pit),label:on(fit),ellipse:on(hit),ellipsoid:on(git),box:on(yit)});var $L={uri:_n(Qr,"URL of the annotation resource."),format:_n(fve,"Format of the annotation resource."),schema:_n(JL,"Annotation schema defines what fields in the annotation will be taken into account."),block_header:rt(rr(Qr),null,'Header of the CIF block to read annotation from (only applies when `format` is `"cif"` or `"bcif"`). If `null`, block is selected based on `block_index`.'),block_index:rt(Ai,0,'0-based index of the CIF block to read annotation from (only applies when `format` is `"cif"` or `"bcif"` and `block_header` is `null`).'),category_name:rt(rr(Qr),null,'Name of the CIF category to read annotation from (only applies when `format` is `"cif"` or `"bcif"`). If `null`, the first category in the block is used.'),field_name:_n(Qr,"Name of the column in CIF or field name (key) in JSON that contains the dependent variable (color/label/tooltip/component_id...)."),field_remapping:rt(_f(Qr,rr(Qr)),{},'Optional remapping of annotation field names `{ standardName1: actualName1, ... }`. Use `{ "label_asym_id": "X" }` to load actual field "X" as "label_asym_id". Use `{ "label_asym_id": null }` to ignore actual field "label_asym_id". Fields not mentioned here are mapped implicitely (i.e. actual name = standard name).')},eF={schema:_n(JL,"Annotation schema defines what fields in the annotation will be taken into account."),block_header:rt(rr(Qr),null,"Header of the CIF block to read annotation from. If `null`, block is selected based on `block_index`."),block_index:rt(Ai,0,"0-based index of the CIF block to read annotation from (only applies when `block_header` is `null`)."),category_name:rt(rr(Qr),null,"Name of the CIF category to read annotation from. If `null`, the first category in the block is used."),field_name:_n(Qr,"Name of the column in CIF or field name (key) in JSON that contains the dependent variable (color/label/tooltip/component_id...)."),field_remapping:rt(_f(Qr,rr(Qr)),{},'Optional remapping of annotation field names `{ standardName1: actualName1, ... }`. Use `{ "label_asym_id": "X" }` to load actual field "X" as "label_asym_id". Use `{ "label_asym_id": null }` to ignore actual field "label_asym_id". Fields not mentioned here are mapped implicitely (i.e. actual name = standard name).')},aR="white",xit=va("bottom-left","bottom-center","bottom-right","middle-left","middle-center","middle-right","top-left","top-center","top-right"),Pve=on({rotation:rt(IS,[1,0,0,0,1,0,0,0,1],"Rotation matrix (3x3 matrix flattened in column major format (j*3+i indexing), this is equivalent to Fortran-order in numpy). This matrix will multiply the structure coordinates from the left. The default value is the identity matrix (corresponds to no rotation)."),translation:rt(Za,[0,0,0],"Translation vector, applied to the structure coordinates after rotation. The default value is the zero vector (corresponds to no translation)."),matrix:rt(rr(IS),null,"Transform matrix (4x4 matrix flattened in column major format (j*4+i indexing), this is equivalent to Fortran-order in numpy). This matrix will multiply the structure coordinates from the left. Takes precedence over `rotation` and `translation`.")}),Qh={rootKind:"root",nodes:{root:{description:"Auxiliary node kind that only appears as the tree root.",parent:[],params:on({})},download:{description:"This node instructs to retrieve a data resource.",parent:["root"],params:on({url:_n(Qr,"URL of the data resource.")})},parse:{description:"This node instructs to parse a data resource.",parent:["download"],params:on({format:_n(dve,"Format of the input data resource.")})},structure:{description:'This node instructs to create a structure from a parsed data resource. "Structure" refers to an internal representation of molecular coordinates without any visual representation.',parent:["parse"],params:on({type:_n(pve,'Type of structure to be created (`"model"` for original model coordinates, `"assembly"` for assembly structure, `"symmetry"` for a set of crystal unit cells based on Miller indices, `"symmetry_mates"` for a set of asymmetric units within a radius from the original model).'),block_header:rt(rr(Qr),null,"Header of the CIF block to read coordinates from (only applies when the input data are from CIF or BinaryCIF). If `null`, block is selected based on `block_index`."),block_index:rt(Ai,0,"0-based index of the CIF block to read coordinates from (only applies when the input data are from CIF or BinaryCIF and `block_header` is `null`)."),model_index:rt(Ai,0,"0-based index of model in case the input data contain multiple models."),assembly_id:rt(rr(Qr),null,'Assembly identifier (only applies when `kind` is `"assembly"`). If `null`, the first assembly is selected.'),radius:rt(wr,5,'Distance (in Angstroms) from the original model in which asymmetric units should be included (only applies when `kind` is `"symmetry_mates"`).'),ijk_min:rt(Xh([Ai,Ai,Ai]),[-1,-1,-1],'Miller indices of the bottom-left unit cell to be included (only applies when `kind` is `"symmetry"`).'),ijk_max:rt(Xh([Ai,Ai,Ai]),[1,1,1],'Miller indices of the top-right unit cell to be included (only applies when `kind` is `"symmetry"`).')})},transform:{description:"This node instructs to rotate and/or translate coordinates OR provide a transformation matrix.",parent:["structure","component","volume"],params:Pve},instance:{description:"This node allows instantiation using the provided transformation parameters.",parent:["structure","component","volume"],params:Pve},component:{description:"This node instructs to create a component (i.e. a subset of the parent structure).",parent:["structure"],params:on({selector:_n(Zu(X8,vS,Zl(vS)),"Defines what part of the parent structure should be included in this component.")})},component_from_uri:{description:"This node instructs to create a component defined by an external annotation resource.",parent:["structure"],params:on({...$L,field_name:rt(Qr,"component","Name of the column in CIF or field name (key) in JSON that contains the component identifier."),field_values:rt(rr(Zl(Qr)),null,"List of component identifiers (i.e. values in the field given by `field_name`) which should be included in this component. If `null`, component identifiers are ignored (all annotation rows are included), and `field_name` field can be dropped from the annotation.")})},component_from_source:{description:"This node instructs to create a component defined by an annotation resource included in the same file this structure was loaded from. Only applicable if the structure was loaded from an mmCIF or BinaryCIF file.",parent:["structure"],params:on({...eF,field_name:rt(Qr,"component","Name of the column in CIF or field name (key) in JSON that contains the component identifier."),field_values:rt(rr(Zl(Qr)),null,"List of component identifiers (i.e. values in the field given by `field_name`) which should be included in this component. If `null`, component identifiers are ignored (all annotation rows are included), and `field_name` field can be dropped from the annotation.")})},representation:{description:"This node instructs to create a visual representation of a component.",parent:["component","component_from_uri","component_from_source"],params:Sve},volume:{description:'This node instructs to create a volume from a parsed data resource. "Volume" refers to an internal representation of volumetric data without any visual representation.',parent:["parse"],params:on({channel_id:rt(rr(Qr),null,"Channel identifier (only applies when the input data contain multiple channels).")})},volume_representation:{description:"This node instructs to create a visual representation of a volume.",parent:["volume"],params:vve},color:{description:"This node instructs to apply color to a visual representation.",parent:["representation","volume_representation"],params:on({color:rt(Qo,aR,'Color to apply to the representation. Can be either an X11 color name (e.g. `"red"`) or a hexadecimal code (e.g. `"#FF0011"`).'),selector:rt(Zu(X8,vS,Zl(vS)),"all","Defines to what part of the representation this color should be applied.")})},color_from_uri:{description:"This node instructs to apply colors to a visual representation. The colors are defined by an external annotation resource.",parent:["representation"],params:on({...$L,field_name:rt(Qr,"color","Name of the column in CIF or field name (key) in JSON that contains the color."),palette:rt(rr(Y8),null,"Customize mapping of annotation values to colors.")})},color_from_source:{description:"This node instructs to apply colors to a visual representation. The colors are defined by an annotation resource included in the same file this structure was loaded from. Only applicable if the structure was loaded from an mmCIF or BinaryCIF file.",parent:["representation"],params:on({...eF,field_name:rt(Qr,"color","Name of the column in CIF or field name (key) in JSON that contains the color."),palette:rt(rr(Y8),null,"Customize mapping of annotation values to colors.")})},clip:{description:"This node instructs to apply clipping to a visual representation.",parent:["representation","volume_representation"],params:Ive},opacity:{description:"This node instructs to apply opacity/transparency to a visual representation.",parent:["representation","volume_representation"],params:on({opacity:_n(wr,"Opacity of a representation. 0.0: fully transparent, 1.0: fully opaque.")})},label:{description:"This node instructs to add a label (textual visual representation) to a component.",parent:["component","component_from_uri","component_from_source"],params:on({text:_n(Qr,"Content of the shown label.")})},label_from_uri:{description:"This node instructs to add labels (textual visual representations) to parts of a structure. The labels are defined by an external annotation resource.",parent:["structure"],params:on({...$L,field_name:rt(Qr,"label","Name of the column in CIF or field name (key) in JSON that contains the label text.")})},label_from_source:{description:"This node instructs to add labels (textual visual representations) to parts of a structure. The labels are defined by an annotation resource included in the same file this structure was loaded from. Only applicable if the structure was loaded from an mmCIF or BinaryCIF file.",parent:["structure"],params:on({...eF,field_name:rt(Qr,"label","Name of the column in CIF or field name (key) in JSON that contains the label text.")})},tooltip:{description:'This node instructs to add a tooltip to a component. "Tooltip" is a text which is not a part of the visualization but should be presented to the users when they interact with the component (typically, the tooltip will be shown somewhere on the screen when the user hovers over a visual representation of the component).',parent:["component","component_from_uri","component_from_source"],params:on({text:_n(Qr,"Content of the shown tooltip.")})},tooltip_from_uri:{description:"This node instructs to add tooltips to parts of a structure. The tooltips are defined by an external annotation resource.",parent:["structure"],params:on({...$L,field_name:rt(Qr,"tooltip","Name of the column in CIF or field name (key) in JSON that contains the tooltip text.")})},tooltip_from_source:{description:"This node instructs to add tooltips to parts of a structure. The tooltips are defined by an annotation resource included in the same file this structure was loaded from. Only applicable if the structure was loaded from an mmCIF or BinaryCIF file.",parent:["structure"],params:on({...eF,field_name:rt(Qr,"tooltip","Name of the column in CIF or field name (key) in JSON that contains the tooltip text.")})},focus:{description:"This node instructs to set the camera focus to a component (zoom in).",parent:["root","component","component_from_uri","component_from_source","primitives","primitives_from_uri","volume","volume_representation"],params:on({direction:rt(Za,[0,0,-1],"Vector describing the direction of the view (camera position -> focused target)."),up:rt(Za,[0,1,0],"Vector which will be aligned with the screen Y axis."),radius:rt(rr(wr),null,"Radius of the focused sphere (overrides `radius_factor` and `radius_extra`)."),radius_factor:rt(wr,1,"Radius of the focused sphere relative to the radius of parent component (default: 1). Focused radius = component_radius * radius_factor + radius_extent."),radius_extent:rt(wr,0,"Addition to the radius of the focused sphere, if computed from the radius of parent component (default: 0). Focused radius = component_radius * radius_factor + radius_extent.")})},camera:{description:"This node instructs to set the camera position and orientation.",parent:["root"],params:on({target:_n(Za,"Coordinates of the point in space at which the camera is pointing."),position:_n(Za,"Coordinates of the camera."),up:rt(Za,[0,1,0],"Vector which will be aligned with the screen Y axis.")})},canvas:{description:"This node sets canvas properties.",parent:["root"],params:on({background_color:_n(Qo,'Color of the canvas background. Can be either an X11 color name (e.g. `"red"`) or a hexadecimal code (e.g. `"#FF0011"`).')})},primitives:{description:"This node groups a list of geometrical primitives",parent:["structure","root"],params:on({color:rt(Qo,"white","Default color for primitives in this group."),label_color:rt(Qo,"white","Default label color for primitives in this group."),tooltip:rt(rr(Qr),null,"Default tooltip for primitives in this group."),opacity:rt(wr,1,"Opacity of primitive geometry in this group."),label_opacity:rt(wr,1,"Opacity of primitive labels in this group."),label_show_tether:rt(Mi,!1,"Whether to show a tether line between the label and the target. Defaults to false."),label_tether_length:rt(wr,1,"Length of the tether line between the label and the target. Defaults to 1 (Angstrom)."),label_attachment:rt(xit,"middle-center",'How to attach the label to the target. Defaults to "middle-center".'),label_background_color:rt(rr(Qo),null,"Background color of the label. Defaults to none/transparent."),snapshot_key:rt(rr(Qr),null,"Load snapshot with the provided key when interacting with this primitives group."),instances:rt(rr(Zl(IS)),null,"Instances of this primitive group defined as 4x4 column major (j * 4 + i indexing) transformation matrices.")})},primitives_from_uri:{description:"This node loads a list of primitives from URI",parent:["structure","root"],params:on({uri:_n(Qr,"Location of the resource."),format:_n(va("mvs-node-json"),"Format of the data."),references:rt(hve,[],"List of nodes the data are referencing.")})},primitive:{description:"This node represents a geometrical primitive",parent:["primitives"],params:Tve}}},ky=mve(Qh);var Cit=Lt.white,Sit=b();function vit(e,t){let r=b.create(...t.target),n=b.create(...t.position),o=b.distance(r,n)/2;e.canvas3d&&(n=A1e(r,n,e.canvas3d.camera.state.mode,e.canvas3d.camera.state.fov));let i=b.create(...t.up);return b.orthogonalize(i,b.sub(Sit,r,n),i),{target:r,position:n,up:i,radius:o,radiusMax:o}}function Iit(e){let t=e.length>0?e[e.length-1]:void 0,r=t?.params.direction??Qh.nodes.focus.params.fields.direction.default,n=t?.params.up??Qh.nodes.focus.params.fields.up.default;return{targets:e.map(o=>({targetRef:o.target.ref==="-=root=-"?void 0:o.target.ref,radius:o.params.radius??void 0,radiusFactor:o.params.radius_factor,extraRadius:o.params.radius_extent})),direction:b.create(...r),up:b.create(...n)}}function _ve(e,t,r){let n={transitionStyle:"animate",transitionDurationInMs:r.previousTransitionDurationMs??0};if(t.camera.cameraParams!==void 0){let o=e.canvas3d.camera.getSnapshot(),i=vit(e,t.camera.cameraParams);n.current={...o,...i}}else n.focus=Iit(t.camera.focuses);return n}function Rve(e,t,r){let n=t?.params,o=Eo(n?.background_color)??Cit,i=!!t?.custom?.molstar_enable_outline,a=!!t?.custom?.molstar_enable_shadow,s=!!t?.custom?.molstar_enable_ssao;return{...e,postprocessing:{...e.postprocessing,outline:i?{name:"on",params:C.getDefaultValues(SL)}:e.postprocessing.outline,shadow:a?{name:"on",params:C.getDefaultValues(vL)}:e.postprocessing.shadow,occlusion:s?{name:"on",params:C.getDefaultValues(AL)}:e.postprocessing.occlusion},renderer:{...e.renderer,backgroundColor:o}}}function Eve(e){let t=new Set;for(let r of e.children??[]){if(r.kind!=="primitive")continue;let n=r.params;lR[n.kind].resolveRefs?.(n,t)}return t}var PS=class extends re.Create({name:"Primitive Data",typeClass:"Object"}){},Dve=class extends re.Create({name:"Primitive Shapes",typeClass:"Object"}){},Mve=wy({name:"mvs-download-primitive-data",display:{name:"MVS Primitives"},from:[re.Root,re.Molecule.Structure],to:PS,params:{uri:C.Url("",{isHidden:!0}),format:C.Text("mvs-node-json",{isHidden:!0})}})({apply({a:e,params:t,cache:r},n){return Pe.create("Download Primitive Data",async o=>{let i=Zr.getUrlAsset(n.managers.asset,t.uri),a=await n.managers.asset.resolve(i,"string").runInContext(o),s=JSON.parse(tm.toString(a.data));return r.asset=a,new PS({node:s,defaultStructure:re.Molecule.Structure.is(e)?e.data:void 0,structureRefs:{},primitives:Lve(s),options:{...s.params},positionCache:new Map,instances:Fve(s.params)},{label:"Primitive Data"})})},dispose({cache:e}){e?.asset?.dispose()}}),Bve=wy({name:"mvs-inline-primitive-data",display:{name:"MVS Primitives"},from:[re.Root,re.Molecule.Structure],to:PS,params:{node:C.Value(void 0,{isHidden:!0})}})({apply({a:e,params:t}){return new PS({node:t.node,defaultStructure:re.Molecule.Structure.is(e)?e.data:void 0,structureRefs:{},primitives:Lve(t.node),options:{...t.node.params},positionCache:new Map,instances:Fve(t.node.params)},{label:"Primitive Data"})}}),tF=wy({name:"mvs-build-primitive-shape",display:{name:"MVS Primitives"},from:PS,to:re.Shape.Provider,params:{kind:C.Text("mesh")}})({apply({a:e,params:t,dependencies:r}){let n=r?Nce([re.Molecule.Structure],r):{},o={...e.data,structureRefs:n},i={snapshotKey:{...Ait,defaultValue:e.data.options?.snapshot_key??""}},a=Kc(t.kind);if(t.kind==="mesh")return J8(e.data,"mesh")?new re.Shape.Provider({label:a,data:o,params:{...C.withDefaults(ft.Params,{alpha:e.data.options?.opacity??1}),...i},getShape:(s,l,u,c)=>Dit(l,c?.geometry),geometryUtils:ft.Utils},{label:a}):An.Null;if(t.kind==="labels"){if(!J8(e.data,"label"))return An.Null;let s=e.data.options,l=s?.label_background_color;return new re.Shape.Provider({label:a,data:o,params:{...C.withDefaults(Pit,{alpha:e.data.options?.label_opacity??1,attachment:s?.label_attachment??"middle-center",tether:s?.label_show_tether??!1,tetherLength:s?.label_tether_length??1,background:rn(l),backgroundColor:rn(l)?Eo(l):void 0}),...i},getShape:(u,c,m,d)=>Eit(c,d?.geometry,m),geometryUtils:Ui.Utils},{label:a})}else if(t.kind==="lines")return J8(e.data,"line")?new re.Shape.Provider({label:a,data:o,params:{...C.withDefaults(ln.Params,{alpha:e.data.options?.opacity??1}),...i},getShape:(s,l,u,c)=>wit(l,c?.geometry),geometryUtils:ln.Utils},{label:a}):An.Null;return An.Null}}),rF=wy({name:"shape-representation-3d",display:"3D Representation",from:re.Shape.Provider,to:re.Shape.Representation3D,params:(e,t)=>e?e.data.params:We.Params})({canAutoUpdate(){return!0},apply({a:e,params:t}){return Pe.create("Shape Representation",async r=>{let n={...C.getDefaultValues(e.data.params),...t},o=ui(e.data.getShape,e.data.geometryUtils);await o.createOrUpdate(n,e.data.data).runInContext(r);let i=!!t.snapshotKey?.trim();return i&&o.setState({pickable:i,markerActions:Wo.Highlighting}),new re.Shape.Representation3D({repr:o,sourceData:e.data},{label:e.data.label})})},update({a:e,b:t,newParams:r}){return Pe.create("Shape Representation",async n=>{let o={...t.data.repr.props,...r};await t.data.repr.createOrUpdate(o,e.data.data).runInContext(n),t.data.sourceData=e.data;let i=!!r.snapshotKey?.trim();return i&&t.data.repr.setState({pickable:i,markerActions:Wo.Highlighting}),Je.UpdateResult.Updated})}}),Ait=C.Text("",{isEssential:!0,disableInteractiveUpdates:!0,description:"Activate the snapshot with the provided key when clicking on the label"}),sR=class{constructor(){this.current=-1;this.groupToNodeMap=new Map;this.sizes=new Map;this.colors=new Map;this.tooltips=new Map}allocateSingle(t){let r=++this.current;return this.groupToNodeMap.set(r,t),r}allocateMany(t,r){let n=new Map,o=this.current;for(let i of r){if(n.has(i))continue;let a=o+n.size+1;this.groupToNodeMap.set(a,t),n.set(i,a)}return this.current+=n.size+1,n}updateColor(t,r){let n=Eo(r);typeof n=="number"&&this.colors.set(t,n)}updateTooltip(t,r){typeof r=="string"&&this.tooltips.set(t,r)}updateSize(t,r){typeof r=="number"&&this.sizes.set(t,r)}};function Tit(e,t){e.emptySelectionWarningPrinted||(console.warn("Some primitives use positions which refer to empty substructure, not showing these primitives.",t,"(There may be more)"),e.emptySelectionWarningPrinted=!0)}var kve={...C.getDefaultValues(Ui.Params),attachment:"middle-center",fontQuality:3,fontWeight:"normal",borderWidth:.15,borderColor:0,background:!1,backgroundOpacity:.5,tether:!1},Pit=C.withDefaults(Ui.Params,kve),lR={mesh:{builders:{mesh:Mit,line:Bit},isApplicable:{mesh:e=>e.show_triangles,line:e=>e.show_wireframe}},lines:{builders:{line:kit}},tube:{builders:{mesh:Ove},resolveRefs:wve},arrow:{builders:{mesh:Lit},resolveRefs:(e,t)=>{Fc(e.start,t),e.end&&Fc(e.end,t)}},label:{builders:{label:Nit},resolveRefs:Uit},distance_measurement:{builders:{mesh:Fit,label:Vit},resolveRefs:wve},angle_measurement:{builders:{mesh:Oit,label:Git},resolveRefs:(e,t)=>{Fc(e.a,t),Fc(e.b,t),Fc(e.c,t)}},ellipse:{builders:{mesh:zve},resolveRefs:(e,t)=>{Fc(e.center,t),e.major_axis_endpoint&&Fc(e.major_axis_endpoint,t),e.minor_axis_endpoint&&Fc(e.minor_axis_endpoint,t)}},ellipsoid:{builders:{mesh:Hit},resolveRefs:(e,t)=>{Fc(e.center,t),e.major_axis_endpoint&&Fc(e.major_axis_endpoint,t),e.minor_axis_endpoint&&Fc(e.minor_axis_endpoint,t)}},box:{builders:{mesh:jit},resolveRefs:(e,t)=>{Fc(e.center,t)}}};function Lve(e){return(e.children??[]).filter(t=>t.kind==="primitive")}function Fc(e,t){Z8(e)&&e.structure_ref&&t.add(e.structure_ref)}function J8(e,t){for(let r of e.primitives){let n=r.params,o=lR[n.kind];if(o.builders[t]){let a=o.isApplicable?.[t];if(a===void 0||a(n,e))return!0}}return!1}function Ly(e,t,r){return Fy(e,t,r,void 0,void 0)}var _it=ye.zero(),Rit=ut.zero();function Fy(e,t,r,n,o){let i,a;if(gve(t))return r&&b.copy(r,t),n&&ye.set(n,t,0),o&&ut.set(o,t,t),!0;if(Z8(t)?(i=eI(t.expressions),a=t.structure_ref):yve(t)&&(i=nB(t)),!i)throw console.error("Invalid expression",t),new Error("Invalid primitive potition expression, see console for details.");let s=a?e.structureRefs[a]:e.defaultStructure;if(!s)throw new Error(`Structure with ref '${a??"<default>"}' not found.`);let l=JSON.stringify(t);if(e.positionCache.has(l)){let[p,h,f]=e.positionCache.get(l);return r&&b.copy(r,h.center),n&&ye.copy(n,h),o&&ut.copy(o,f),p}let{selection:u}=Ps.createAndRun(s,i),c,m,d;if(at.isEmpty(u))r&&b.set(r,0,0,0),c=Rit,m=_it,d=!1,Tit(e,t);else{let p=at.toLociWithSourceUnits(u),h=K.Loci.getBoundary(p);r&&b.copy(r,h.sphere.center),c=h.box,m=h.sphere,d=!0}return n&&ye.copy(n,m),o&&ut.copy(o,c),e.positionCache.set(l,[d,m,c]),d}function Fve(e){if(e?.instances?.length)return e.instances.map(t=>Z.fromArray(Z(),t,0))}function Dit(e,t){let r=et.createState(1024,1024,t),n={groups:new sR,mesh:r};r.currentGroup=-1;for(let l of e.primitives){let u=l.params,c=lR[u.kind];if(!c){console.warn(`Primitive ${u.kind} not supported`);continue}c.builders.mesh?.(e,n,l,u)}let{colors:o,tooltips:i}=n.groups,a=e.options?.tooltip??"",s=Eo(e.options?.color)??0;return Gr.create("Mesh",{kind:"mvs-primitives",node:e.node,groupToNode:n.groups.groupToNodeMap},et.getMesh(r),l=>o.get(l)??s,l=>1,l=>i.get(l)??a,e.instances)}function wit(e,t){let r=Ua.create(1024,1024,t),n={groups:new sR,lines:r};for(let u of e.primitives){let c=u.params,m=lR[c.kind];if(!m){console.warn(`Primitive ${c.kind} not supported`);continue}m.builders.line?.(e,n,u,c)}let{colors:o,sizes:i,tooltips:a}=n.groups,s=e.options?.tooltip??"",l=Eo(e.options?.color)??0;return Gr.create("Lines",{kind:"mvs-primitives",node:e.node,groupToNode:n.groups.groupToNodeMap},r.getLines(),u=>o.get(u)??l,u=>i.get(u)??1,u=>a.get(u)??s,e.instances)}function Eit(e,t,r){let n=_s.create({...kve,...r},1024,1024,t),o={groups:new sR,labels:n};for(let u of e.primitives){let c=u.params,m=lR[c.kind];if(!m){console.warn(`Primitive ${c.kind} not supported`);continue}m.builders.label?.(e,o,u,c)}let i=Eo(e.options?.label_color)??0,{colors:a,sizes:s,tooltips:l}=o.groups;return Gr.create("Labels",{kind:"mvs-primitives",node:e.node,groupToNode:o.groups.groupToNodeMap},n.getText(),u=>a.get(u)??i,u=>s.get(u)??1,u=>l.get(u)??"",e.instances)}function Vve(e,t,r,n,o){let i=b.zero(),a=b.zero(),s=b.zero(),{indices:l,vertices:u,triangle_groups:c}=n,m=Math.floor(l.length/3);c??=Rm(m);let d=t.allocateMany(r,c);for(let p=0;p<m;p++){let h=c[p],f=d.get(h);b.fromArray(i,u,3*l[3*p]),b.fromArray(a,u,3*l[3*p+1]),b.fromArray(s,u,3*l[3*p+2]),o(h,f,i,a,s)}}function Mit(e,{groups:t,mesh:r},n,o){if(!o.show_triangles)return;let{group_colors:i,group_tooltips:a,color:s,tooltip:l}=o;Vve(e,t,n,o,(u,c,m,d,p)=>{t.updateColor(c,i[u]??s),t.updateTooltip(c,a[u]??l),r.currentGroup=c,et.addTriangle(r,m,d,p)})}function Bit(e,{groups:t,lines:r},n,o){if(!o.show_wireframe)return;let i=o.wireframe_width,{group_colors:a,group_tooltips:s,wireframe_color:l,color:u,tooltip:c}=o;Vve(e,t,n,o,(m,d,p,h,f)=>{t.updateColor(d,l??a[m]??u),t.updateTooltip(d,s[m]??c),t.updateSize(d,i),r.add(p[0],p[1],p[2],h[0],h[1],h[2],d),r.add(h[0],h[1],h[2],f[0],f[1],f[2],d),r.add(f[0],f[1],f[2],p[0],p[1],p[2],d)})}function kit(e,{groups:t,lines:r},n,o){let i=b.zero(),a=b.zero(),{indices:s,vertices:l,line_groups:u,group_colors:c,group_tooltips:m,group_widths:d}=o,p=o.width,h=Math.floor(s.length/2);u??=Rm(h);let f=t.allocateMany(n,u);for(let y=0;y<h;y++){let g=u[y],x=f.get(g);t.updateColor(x,c[g]??o.color),t.updateTooltip(x,m[g]??o.tooltip),t.updateSize(x,d[g]??p),b.fromArray(i,l,3*s[2*y]),b.fromArray(a,l,3*s[2*y+1]),r.add(i[0],i[1],i[2],a[0],a[1],a[2],x)}}function wve(e,t){Fc(e.start,t),Fc(e.end,t)}var AS=b.zero(),TS=b.zero();function Ove(e,{groups:t,mesh:r},n,o,i){if(!i?.skipResolvePosition){let l=Ly(e,o.start,AS),u=Ly(e,o.end,TS);if(!l||!u)return}let a=o.radius,s={radiusBottom:a,radiusTop:a,topCap:!0,bottomCap:!0};if(r.currentGroup=t.allocateSingle(n),t.updateColor(r.currentGroup,o.color),t.updateTooltip(r.currentGroup,o.tooltip),o.dash_length){let l=b.distance(AS,TS),u=Math.ceil(l/(2*o.dash_length));ep(r,AS,TS,1,u,!0,s)}else b_(r,AS,TS,s)}var Lo={start:b.zero(),end:b.zero(),dir:b.zero(),startCap:b.zero(),endCap:b.zero()};function Lit(e,{groups:t,mesh:r},n,o){if(!Ly(e,o.start,Lo.start))return;if(o.end){if(!Ly(e,o.end,Lo.end))return}else if(o.direction)b.add(Lo.end,Lo.start,o.direction);else{console.warn('Primitive arrow does not contain "end" nor "distance". Not showing.');return}if(b.sub(Lo.dir,Lo.end,Lo.start),b.normalize(Lo.dir,Lo.dir),o.length&&b.scaleAndAdd(Lo.end,Lo.start,Lo.dir,o.length),b.distance(Lo.start,Lo.end)<.001)return;let s=o.tube_radius,l={radiusBottom:s,radiusTop:s,topCap:!o.show_end_cap,bottomCap:!o.show_start_cap};if(r.currentGroup=t.allocateSingle(n),t.updateColor(r.currentGroup,o.color),t.updateTooltip(r.currentGroup,o.tooltip),o.show_start_cap){let u=o.start_cap_radius??2*s,c=o.start_cap_length??2*u;b.scaleAndAdd(Lo.startCap,Lo.start,Lo.dir,c),b_(r,Lo.startCap,Lo.start,{radiusBottom:u,radiusTop:0,topCap:!1,bottomCap:!0,radialSegments:12})}else b.copy(Lo.startCap,Lo.start);if(o.show_end_cap){let u=o.end_cap_radius??2*s,c=o.end_cap_length??2*u;b.scaleAndAdd(Lo.endCap,Lo.end,Lo.dir,-c),b_(r,Lo.endCap,Lo.end,{radiusBottom:u,radiusTop:0,topCap:!1,bottomCap:!0,radialSegments:12})}else b.copy(Lo.endCap,Lo.end);if(o.show_tube)if(o.tube_dash_length){let u=b.distance(Lo.startCap,Lo.endCap),c=Math.ceil(u/(2*o.tube_dash_length));ep(r,Lo.startCap,Lo.endCap,1,c,!0,l)}else b_(r,Lo.startCap,Lo.endCap,l)}function Gve(e,t,r){let n=Ly(e,t,AS),o=Ly(e,r,TS);if(n&&o)return b.distance(AS,TS)}function Uve(e,t){let r=`${qf(e,2)} \xC5`;return typeof t.label_template=="string"?t.label_template.replace("{{distance}}",r):r}function Fit(e,t,r,n){let o=Gve(e,n.start,n.end);if(o===void 0)return;let i=Uve(o,n);Ove(e,t,r,{...n,tooltip:i},{skipResolvePosition:!0})}var hA=b.zero();function Vit(e,t,r,n){let{labels:o,groups:i}=t,a=Gve(e,n.start,n.end);if(a===void 0)return;let s;typeof n.label_size=="number"?s=n.label_size:s=Math.max(a*n.label_auto_size_scale,n.label_auto_size_min),b.add(hA,AS,TS),b.scale(hA,hA,.5);let l=i.allocateSingle(r);i.updateColor(l,n.label_color),i.updateSize(l,s),o.add(Uve(a,n),hA[0],hA[1],hA[2],1.05*n.radius,1,l)}var yr={isDefined:!1,a:b(),b:b(),c:b(),ba:b(),bc:b(),labelPos:b(),radius:0,label:""};function Nve(e,t){let r=Ly(e,t.a,yr.a),n=Ly(e,t.b,yr.b),o=Ly(e,t.c,yr.c);if(yr.isDefined=r&&n&&o,!yr.isDefined)return;b.sub(yr.ba,yr.a,yr.b),b.sub(yr.bc,yr.c,yr.b);let i=Ea(b.angle(yr.ba,yr.bc)),a=`${qf(i,2)}\xB0`;yr.label=typeof t.label_template=="string"?t.label_template.replace("{{angle}}",a):a,typeof t.section_radius=="number"?yr.radius=t.section_radius:(yr.radius=Math.min(b.magnitude(yr.ba),b.magnitude(yr.bc)),typeof t.section_radius_scale=="number"&&(yr.radius*=t.section_radius_scale))}function Oit(e,t,r,n){if(Nve(e,n),!yr.isDefined)return;let{groups:o,mesh:i}=t;if(n.show_vector){let a=n.vector_radius??.05,s={radiusBottom:a,radiusTop:a,topCap:!0,bottomCap:!0};i.currentGroup=o.allocateSingle(r),o.updateColor(i.currentGroup,n.vector_color),o.updateTooltip(i.currentGroup,yr.label);let l=Math.ceil(b.magnitude(yr.ba)/(2*a));ep(i,yr.a,yr.b,1,l,!0,s),l=Math.ceil(b.magnitude(yr.bc)/(2*a)),ep(i,yr.b,yr.c,1,l,!0,s)}if(n.show_section){let a=b.angle(yr.ba,yr.bc);b.normalize(yr.ba,yr.ba),b.normalize(yr.bc,yr.bc),b.scale(yr.ba,yr.ba,yr.radius),b.scale(yr.bc,yr.bc,yr.radius),zve(e,t,r,{kind:"ellipse",as_circle:!0,center:yr.b,major_axis_endpoint:null,major_axis:yr.ba,minor_axis_endpoint:null,minor_axis:yr.bc,radius_major:yr.radius,radius_minor:yr.radius,theta_start:0,theta_end:a,color:n.section_color,tooltip:yr.label})}}function Git(e,t,r,n){let{labels:o,groups:i}=t;if(Nve(e,n),!yr.isDefined)return;b.normalize(yr.ba,yr.ba),b.normalize(yr.bc,yr.bc),b.scale(yr.ba,yr.ba,yr.radius),b.scale(yr.bc,yr.bc,yr.radius);let a;typeof n.label_size=="number"?a=n.label_size:a=Math.max(yr.radius*n.label_auto_size_scale,n.label_auto_size_min),b.add(yr.labelPos,yr.ba,yr.bc),b.normalize(yr.labelPos,yr.labelPos),b.scale(yr.labelPos,yr.labelPos,yr.radius),b.add(yr.labelPos,yr.labelPos,yr.b);let s=i.allocateSingle(r);i.updateColor(s,n.label_color),i.updateSize(s,a),o.add(yr.label,yr.labelPos[0],yr.labelPos[1],yr.labelPos[2],1,1,s)}function Uit(e,t){Fc(e.position,t)}var gA={position:b.zero(),sphere:ye.zero()};function Nit(e,t,r,n){let{labels:o,groups:i}=t;if(!Fy(e,n.position,gA.position,gA.sphere,void 0))return;let s=i.allocateSingle(r);i.updateColor(s,n.label_color),i.updateSize(s,n.label_size);let l=gA.sphere.radius+n.label_offset;o.add(n.text,gA.position[0],gA.position[1],gA.position[2],l,1,s)}var $8=new Map;function zit(e){let t=JSON.stringify(e);if($8.has(t))return $8.get(t);let r=(e.thetaEnd??2*Math.PI)-(e.thetaStart??0);if(Math.abs(r)<.001)return null;let n=LI({radius:1,thetaStart:e.thetaStart??0,thetaLength:r,segments:Math.ceil(2*Math.PI/r*64)});return $8.set(t,n),n}var po={centerPos:b.zero(),majorPos:b.zero(),minorPos:b.zero(),majorAxis:b.zero(),minorAxis:b.zero(),scale:b.zero(),normal:b.zero(),scaleXform:Z.identity(),rotationXform:Z.identity(),translationXform:Z.identity(),xform:Z.identity()};function zve(e,t,r,n){let o=zit({thetaStart:n.theta_start,thetaEnd:n.theta_end});if(!o||!Fy(e,n.center,po.centerPos,void 0,void 0))return;if(n.major_axis_endpoint){if(!Fy(e,n.major_axis_endpoint,po.majorPos,void 0,void 0))return;b.sub(po.majorAxis,po.majorPos,po.centerPos)}else b.copy(po.majorAxis,n.major_axis);if(n.minor_axis_endpoint){if(!Fy(e,n.minor_axis_endpoint,po.minorPos,void 0,void 0))return;b.sub(po.minorAxis,po.minorPos,po.centerPos)}else b.copy(po.minorAxis,n.minor_axis);let{mesh:a,groups:s}=t;if(Z.fromTranslation(po.translationXform,po.centerPos),n.as_circle){let l=n.radius_major??b.magnitude(po.majorAxis);b.set(po.scale,l,1,l)}else{let l=n.radius_major??b.magnitude(po.majorAxis),u=n.radius_minor??b.magnitude(po.minorAxis);b.set(po.scale,u,1,l)}Z.fromScaling(po.scaleXform,po.scale),b.normalize(po.minorAxis,po.minorAxis),b.normalize(po.majorAxis,po.majorAxis),b.cross(po.normal,po.majorAxis,po.minorAxis),Z.targetTo(po.rotationXform,b.origin,po.majorAxis,po.normal),Z.mul(po.rotationXform,po.rotationXform,Z.rotY180),Z.mul3(po.xform,po.translationXform,po.rotationXform,po.scaleXform),a.currentGroup=s.allocateSingle(r),s.updateColor(a.currentGroup,n.color),s.updateTooltip(a.currentGroup,n.tooltip),et.addPrimitive(a,po.xform,o),et.addPrimitiveFlipped(a,po.xform,o)}var Po={centerPos:b.zero(),majorPos:b.zero(),minorPos:b.zero(),majorAxis:b.zero(),minorAxis:b.zero(),sphere:ye.zero(),radius:b.zero(),extent:b.zero(),up:b.zero()};function Hit(e,t,r,n){if(!Fy(e,n.center,Po.centerPos,Po.sphere,void 0))return;if(n.major_axis_endpoint){if(!Fy(e,n.major_axis_endpoint,Po.majorPos,void 0,void 0))return;b.sub(Po.majorAxis,Po.majorPos,Po.centerPos)}else n.major_axis?b.copy(Po.majorAxis,n.major_axis):b.copy(Po.majorAxis,b.unitX);if(n.minor_axis_endpoint){if(!Fy(e,n.minor_axis_endpoint,Po.minorPos,void 0,void 0))return;b.sub(Po.minorAxis,Po.minorPos,Po.centerPos)}else n.minor_axis?b.copy(Po.minorAxis,n.minor_axis):b.copy(Po.minorAxis,b.unitY);if(typeof n.radius=="number")b.set(Po.radius,n.radius,n.radius,n.radius);else if(n.radius)b.copy(Po.radius,n.radius);else{let s=Po.sphere.radius;b.set(Po.radius,s,s,s)}typeof n.radius_extent=="number"?b.set(Po.extent,n.radius_extent,n.radius_extent,n.radius_extent):n.radius_extent?b.copy(Po.extent,n.radius_extent):b.set(Po.extent,0,0,0),b.add(Po.radius,Po.radius,Po.extent);let{mesh:i,groups:a}=t;i.currentGroup=a.allocateSingle(r),a.updateColor(i.currentGroup,n.color),a.updateTooltip(i.currentGroup,n.tooltip),b.normalize(Po.majorAxis,Po.majorAxis),b.normalize(Po.minorAxis,Po.minorAxis),b.cross(Po.up,Po.majorAxis,Po.minorAxis),_y(i,Po.centerPos,Po.up,Po.minorAxis,Po.radius,3)}var Lc={center:b.zero(),boundary:ut.zero(),size:b.zero(),cage:J0(),translationXform:Z.identity(),scaleXform:Z.identity(),xform:Z.identity()};function jit(e,t,r,n){if(!n.show_edges&&!n.show_faces||!Fy(e,n.center,Lc.center,void 0,Lc.boundary)||(n.extent&&ut.expand(Lc.boundary,Lc.boundary,n.extent),ut.volume(Lc.boundary)<.001))return;let{mesh:i,groups:a}=t;Z.fromScaling(Lc.scaleXform,ut.size(Lc.size,Lc.boundary)),Z.fromTranslation(Lc.translationXform,Lc.center),Z.mul(Lc.xform,Lc.translationXform,Lc.scaleXform),n.show_faces&&(i.currentGroup=a.allocateSingle(r),a.updateColor(i.currentGroup,n.face_color),a.updateTooltip(i.currentGroup,n.tooltip),et.addPrimitive(i,Lc.xform,Tx())),n.show_edges&&(i.currentGroup=a.allocateSingle(r),a.updateColor(i.currentGroup,n.edge_color),a.updateTooltip(i.currentGroup,n.tooltip),et.addCage(i,Lc.xform,J0(),n.edge_radius,2,8))}var Hve={id:"ww-pdb/is-hidden-custom-state",description:"Allow updating initial visibility of nodes",createExtensionContext:()=>({}),action:(e,t)=>{!t.custom||!t.custom?.is_hidden||e.update.to(e.selector).updateState({isHidden:!0})}};var Wit={radius:C.Numeric(5,{min:0},{description:"Surroundings radius in Angstroms"}),includeSelf:C.Boolean(!0,{description:"Include parent selection itself in the surroundings"}),wholeResidues:C.Boolean(!0,{description:"Include whole residues, instead of individual atoms"}),nullIfEmpty:C.Optional(C.Boolean(!0,{isHidden:!0}))},jve=Bt.BuiltIn({name:"structure-surroundings",display:{name:"Surroundings",description:"Surroundings of a structure component."},from:re.Molecule.Structure,to:re.Molecule.Structure,params:Wit})({apply({a:e,params:t,cache:r}){let n=e.data,o=n.parent??n,i=K.Bundle.fromSubStructure(o,n),a=K.Bundle.toExpression(i),s=ne.struct.modifier.includeSurroundings({0:a,radius:t.radius,"as-whole-residues":t.wholeResidues});return t.includeSelf||(s=ne.struct.modifier.exceptBy({0:s,by:a})),CI(o,{label:`Surroundings (${t.radius} \xC5)`,type:{name:"expression",params:s},nullIfEmpty:t.nullIfEmpty},r)},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}});function Wve(e,t,r,n,o){let i=Un.create(e,o?.replaceExisting??!1);Xit(i,t,r,n,o);let a=i.update.getTree(),s={tree:zo.toJSON(a)};return{id:en.create22(),data:s}}function Xit(e,t,r,n,o){let i=new Map;o?.replaceExisting&&Un.deleteChildren(e);let a=(o?.extensions??[]).map(l=>({ext:l,extCtx:l.createExtensionContext(t,n)})),s=new Map;kc(t,(l,u)=>{let c=l.kind,m,d=u?i.get(u):e,p=r[c];if(p)if(d)m=p(d,l,n),m&&l.ref&&(Un.tag(m,tW(l.ref)),s.set(l.ref,m.selector.ref)),i.set(l,m);else{console.warn(`No target found for this "${l.kind}" node`);return}if(d)for(let{ext:h,extCtx:f}of a)h.action(m??d,l,n,f)});for(let l of e.targetManager.allTargets)Un.dependsOn(l,s);a.forEach(l=>l.ext.disposeExtensionContext?.(l.extCtx,t,n))}var Un={create(e,t){let r=e.build(),n=r.toRoot();return{update:r,selector:n.selector,targetManager:new eW(e,t),mvsDependencyRefs:new Set}},apply(e,t,r,n){let o=t.id;if(t.id===dd.id){let l=r?.type?.name??"";o+=`:${l}`}let i=e.targetManager.getChildRef(e.selector,o),a=e.update.to(e.selector).apply(t,r,{...n,ref:i}),s={...e,selector:a.selector,mvsDependencyRefs:new Set,transformer:t,transformParams:r};return e.targetManager.allTargets.push(s),s},setMvsDependencies(e,t){return t.forEach(r=>e.mvsDependencyRefs.add(r)),e},dependsOn(e,t){if(!e.mvsDependencyRefs.size)return e;let r=Array.from(e.mvsDependencyRefs).map(n=>t.get(n)).filter(n=>n);return r.length&&e.update.to(e.selector).dependsOn(r),e},tag(e,t){return t.length>0&&e.update.to(e.selector).tag(t),e},deleteChildren(e){return e.update.currentTree.children.get(e.selector.ref).forEach(r=>e.update.delete(r)),e},commit(e){return e.update.commit()}},eW=class{constructor(t,r){this._counter={};this.allTargets=[];r||t.state.data.cells.forEach(n=>{let o=n.transform.ref;if(o.startsWith("!mvs:")){let[i,a,s]=o.split(":"),l=parseInt(s)+1;l>(this._counter[a]??0)&&(this._counter[a]=l)}})}nextRef(t){this._counter[t]??=0;let r=this._counter[t]++;return`!mvs:${t}:${r}`}getChildRef(t,r){let n=t.ref.replace(/^!mvs:/,"")+":"+r,o=rB(n);return this.nextRef(o)}};function tW(e){return e===void 0?[]:[`mvs-ref:${e}`]}var Qit=5,Xve={id:"wwpdb/non-covalent-interactions",description:"Allow showing non-covalent interactions around components with molstar_show_non_covalent_interactions additional property",createExtensionContext:()=>({}),action:(e,t,r,n)=>{if(t.kind!=="component"&&t.kind!=="component_from_uri"&&t.kind!=="component_from_source")return;let o=cve(t);if(!o.molstar_show_non_covalent_interactions)return;let i=Un.apply(e,jve,{radius:o.molstar_non_covalent_interactions_radius_ang??Qit,includeSelf:!0,wholeResidues:!0,nullIfEmpty:!1});Un.apply(e,Xe.Representation.StructureRepresentation3D,{type:{name:"ball-and-stick",params:{sizeFactor:.22,sizeAspectRatio:.73,adjustCylinderLength:!0,xrayShaded:!0,aromaticBonds:!1,multipleBonds:"off",excludeTypes:["hydrogen-bond","metal-coordination"]}},colorTheme:{name:"element-symbol",params:{}},sizeTheme:{name:"physical",params:{}}}),Un.apply(i,Xe.Representation.StructureRepresentation3D,{type:{name:"ball-and-stick",params:{sizeFactor:.16,excludeTypes:["hydrogen-bond","metal-coordination"]}},colorTheme:{name:"element-symbol",params:{}},sizeTheme:{name:"physical",params:{}}}),Un.apply(i,Xe.Representation.StructureRepresentation3D,{type:{name:"interactions",params:{}},colorTheme:{name:"interaction-type",params:{}},sizeTheme:{name:"uniform",params:{}}})}};var uR=-1;function Zit(e){return e>=0}var Zve=Lt.white;function qit(e,t){let r={help:o=>{let{name:i,params:a}=o,l=e.get(i).factory({},a);return{description:l.description,legend:l.legend}}},n=e.types.filter(([o,i,a])=>o!==nF&&e.get(o).isApplicable(t));return{layers:C.ObjectList({theme:C.Mapped("uniform",n,o=>C.Group(e.get(o).getParams({structure:De.Empty})),r),selection:KI},o=>ta(o.theme.name),{description:"A list of layers, each defining a color theme. The last listed layer is the top layer (applies first). If the top layer does not provide color for a location or its selection does not cover the location, the underneath layers will apply."}),background:C.Color(Zve,{description:"Color for elements where no layer applies"})}}var Yit={layers:[],background:Zve};function qve(e,t,r){let{colorLayers:n,granularity:o}=Jit(e,t,r);function i(l,u){for(let c of n){if(!(!c.elementSet||JI.has(c.elementSet,l)))continue;let d=c.color(l,u);if(Zit(d))return d}return t.background}let a=K.Location.create(e.structure);return{factory:(l,u)=>qve(l,u,r),granularity:o,preferSmoothing:!0,color:(l,u)=>K.Location.is(l)?i(l,u):Ct.isLocation(l)?(a.unit=l.aUnit,a.element=l.aUnit.elements[l.aIndex],i(a,u)):t.background,props:t,description:"Combines colors from multiple color themes."}}var yA=1,rW=2,nW=4,Qve={uniform:0,instance:yA,group:rW,groupInstance:rW|yA,vertex:nW,vertexInstance:nW|yA};function Kit(e){return e&nW?e&yA?"vertexInstance":"vertex":e&rW?e&yA?"groupInstance":"group":e&yA?"instance":"uniform"}function Jit(e,t,r){let n=[],o=0;for(let i=t.layers.length-1;i>=0;i--){let a=t.layers[i],s=r.get(a.theme.name);if(!s){console.warn(`Skipping color theme '${a.theme.name}', cannot find it in registry.`);continue}s.ensureCustomProperties?.attach&&console.warn(`Multilayer color theme: layer "${s.name}" has ensureCustomProperties.attach method, but Multilayer color theme does not call it. If the layer does not work, make sure you call ensureCustomProperties.attach somewhere.`);let l=s.factory(e,a.theme.params);switch(l.granularity){case"uniform":case"instance":case"group":case"groupInstance":case"vertex":case"vertexInstance":let u,c;if(!e.structure)u={},c="uniform";else if($0e(a.selection))u=void 0,c="uniform";else{let m=X_(e.structure,a.selection);u=JI.fromStructure(m),c=$it(e.structure,m)}n.push({elementSet:u,color:l.color}),o|=Qve[c],o|=Qve[l.granularity];break;default:console.warn(`Skipping color theme '${a.theme.name}', cannot process granularity '${l.granularity}'`)}}return{colorLayers:n,granularity:Kit(o)}}function $it(e,t){let r={};for(let u of e.units){let c=u.conformation.operator.instanceId;r[c]??=0,r[c]+=u.elements.length}let n={},o={};for(let u of t.units){let c=u.conformation.operator.instanceId;n[c]??=0,n[c]+=u.elements.length,(o[c]??={})[u.invariantId]=u.elements}let i=Object.keys(r),a=Object.keys(n),s=!a.every(u=>n[u]===r[u]),l;if(a.length===0)l=!1;else if(a.length<i.length)l=!0;else{l=!1;for(let u=1;u<a.length;u++)if(!oa(o[a[0]],o[a[u]])){l=!0;break}}return s?l?"groupInstance":"group":l?"instance":"uniform"}var nF="mvs-multilayer";function Yve(e){return{name:nF,label:"MVS Multi-layer",category:ur.Misc,factory:(t,r)=>qve(t,r,e),getParams:t=>qit(e,t),defaultValues:Yit,isApplicable:t=>!!t.structure&&yx(t.structure)}}var qs={aromatic:Eo("#15A4A4"),hydrophobic:Eo("#80A0F0"),polar:Eo("#15C015"),positive:Eo("#F01505"),negative:Eo("#C048C0"),proline:Eo("#C0C000"),cysteine:Eo("#F08080"),glycine:Eo("#F09048")},eat={...a_,HIS:qs.aromatic,TYR:qs.aromatic,ALA:qs.hydrophobic,VAL:qs.hydrophobic,LEU:qs.hydrophobic,ILE:qs.hydrophobic,MET:qs.hydrophobic,PHE:qs.hydrophobic,TRP:qs.hydrophobic,SER:qs.polar,THR:qs.polar,ASN:qs.polar,GLN:qs.polar,LYS:qs.positive,ARG:qs.positive,ASP:qs.negative,GLU:qs.negative,PRO:qs.proline,CYS:qs.cysteine,GLY:qs.glycine},tat={helix:sm.alphaHelix,strand:sm.betaStrand,turn:sm.betaTurn,bend:sm.bend,H:sm.alphaHelix,B:sm.betaStrand,E:sm.betaStrand,G:sm.threeTenHelix,I:sm.piHelix,P:10485760,T:sm.betaTurn,S:sm.bend},oW={ElementSymbol:nc(fB,["C"]),ResidueName:a_,ResidueProperties:eat,SecondaryStructure:tat},_S={Reds:lr.reds,Oranges:lr.oranges,Greens:lr.greens,Blues:lr.blues,Purples:lr.purples,Greys:lr.greys,OrRd:lr["orange-red"],BuGn:lr["blue-green"],PuBuGn:lr["purple-blue-green"],GnBu:lr["green-blue"],PuBu:lr["purple-blue"],BuPu:lr["blue-purple"],RdPu:lr["red-purple"],PuRd:lr["purple-red"],YlOrRd:lr["yellow-orange-red"],YlOrBr:lr["yellow-orange-brown"],YlGn:lr["yellow-green"],YlGnBu:lr["yellow-green-blue"],Magma:lr.magma,Inferno:lr.inferno,Plasma:lr.plasma,Viridis:lr.viridis,Cividis:lr.cividis,Turbo:lr.turbo,Warm:lr.warm,Cool:lr.cool,CubehelixDefault:lr["cubehelix-default"],Rainbow:lr.rainbow,Sinebow:lr.sinebow,RdBu:lr["red-blue"],RdGy:lr["red-grey"],PiYG:lr["pink-yellow-green"],BrBG:lr["brown-white-green"],PRGn:lr["purple-green"],PuOr:lr["purple-orange"],RdYlGn:lr["red-yellow-green"],RdYlBu:lr["red-yellow-blue"],Spectral:lr.spectral,Category10:lr["category-10"],Observable10:lr["observable-10"],Tableau10:lr["tableau-10"],Set1:lr["set-1"],Set2:lr["set-2"],Set3:lr["set-3"],Pastel1:lr["pastel-1"],Pastel2:lr["pastel-2"],Dark2:lr["dark-2"],Paired:lr.paired,Accent:lr.accent,Chainbow:lr["turbo-no-black"]};var rat=new Set(["color_from_uri","component_from_uri","label_from_uri","tooltip_from_uri"]),nat=new Set(["color_from_source","component_from_source","label_from_source","tooltip_from_source"]);function oat(e,t){if(e&&e.length!==9)throw new Error(`'rotation' param for 'transform' node must be array of 9 elements, found ${e}`);if(t&&t.length!==3)throw new Error(`'translation' param for 'transform' node must be array of 3 elements, found ${t}`);let r=Z.identity();if(e){let n=Ot.fromArray(Ot(),e,0);iat(n,n),Z.fromMat3(r,n)}if(t&&Z.setTranslation(r,b.fromArray(b(),t,0)),!Z.isRotationAndTranslation(r))throw new Error(`'rotation' param for 'transform' is not a valid rotation matrix: ${e}`);return r}function iat(e,t){let r=b.fromArray(aat,t,0),n=b.fromArray(sat,t,3),o=b.fromArray(lat,t,6);return b.normalize(r,r),b.orthogonalize(n,r,n),b.normalize(o,b.cross(o,r,n)),Ot.fromColumns(e,r,n,o),e}var aat=b(),sat=b(),lat=b();function cR(e,t){return eIe(e,t,fj,hj)}function $ve(e,t){return eIe(e,t,Cj,Sj)}function eIe(e,t,r,n){let o=e;for(let{params:a,ref:s}of Kve(t,"transform"))o=Un.apply(o,r,a),Un.tag(o,tW(s));let i=Kve(t,"instance");return i.length>0&&(o=Un.apply(o,n,{transforms:i.map(a=>a.params)})),o}function Kve(e,t){let r=[],n=SS(e).filter(o=>o.kind===t);for(let o of n){let i=o.params.matrix;if(!i){let{rotation:a,translation:s}=o.params;i=oat(a,s)}r.push({params:{transform:{name:"matrix",params:{data:i,transpose:!1}}},ref:o.ref})}return r}function tIe(e,t){let r={};return kc(e,n=>{let o;if(rat.has(n.kind)){let i=n.params;o={source:{name:"url",params:{url:i.uri,format:i.format}},schema:i.schema,cifBlock:Jve(i.block_header,i.block_index),cifCategory:i.category_name,fieldRemapping:Object.entries(i.field_remapping).map(([a,s])=>({standardName:a,actualName:s}))}}else if(nat.has(n.kind)){let i=n.params;o={source:{name:"source-cif",params:{}},schema:i.schema,cifBlock:Jve(i.block_header,i.block_index),cifCategory:i.category_name,fieldRemapping:Object.entries(i.field_remapping).map(([a,s])=>({standardName:a,actualName:s}))}}if(o){let i=Pg(o);r[i]??={...o,id:rB(i)},t.annotationMap.set(n,r[i].id)}}),Object.values(r)}function Jve(e,t){return rn(e)?{name:"header",params:{header:e}}:{name:"index",params:{index:t??0}}}function rIe(e,t){let r=[];return kc(e,n=>{if(n.kind==="tooltip_from_uri"||n.kind==="tooltip_from_source"){let o=t.annotationMap.get(n);o&&r.push({annotationId:o,fieldName:n.params.field_name})}}),IY(r)}function nIe(e,t){let r=[];return kc(e,(n,o)=>{if(n.kind==="tooltip"){if(o?.kind==="component")r.push({text:n.params.text,selector:mR(o.params.selector)});else if(o?.kind==="component_from_uri"||o?.kind==="component_from_source"){let i=dR(o,t);rn(i.annotationId)&&rn(i.fieldName)&&rn(i.fieldValues)&&r.push({text:n.params.text,selector:{name:"annotation",params:{annotationId:i.annotationId,fieldName:i.fieldName,fieldValues:i.fieldValues}}})}}}),r}function oIe(e,t){let r=[];return kc(e,(n,o)=>{if(n.kind==="label"){if(o?.kind==="component")r.push({text:n.params.text,position:{name:"selection",params:{selector:mR(o.params.selector)}}});else if(o?.kind==="component_from_uri"||o?.kind==="component_from_source"){let i=dR(o,t);rn(i.annotationId)&&rn(i.fieldName)&&rn(i.fieldValues)&&r.push({text:n.params.text,position:{name:"selection",params:{selector:{name:"annotation",params:{annotationId:i.annotationId,fieldName:i.fieldName,fieldValues:i.fieldValues}}}}})}}}),r}function oF(e){return e.ref!==void 0||e.custom!==void 0&&Object.keys(e.custom).length>0?!1:e.children&&e.children.every(t=>t.kind==="tooltip"||t.kind==="label")}function iIe(e){let t=e.params;switch(t.type){case"model":return{type:{name:"model",params:{}}};case"assembly":return{type:{name:"assembly",params:{id:t.assembly_id??void 0}}};case"symmetry":return{type:{name:"symmetry",params:{ijkMin:b.ofArray(t.ijk_min),ijkMax:b.ofArray(t.ijk_max)}}};case"symmetry_mates":return{type:{name:"symmetry-mates",params:{radius:t.radius}}};default:throw new Error(`NotImplementedError: Loading action for "structure" node, type "${t.type}"`)}}function mR(e){return e===void 0?J0e:typeof e=="string"?{name:"static",params:e}:Array.isArray(e)?{name:"expression",params:eI(e)}:{name:"expression",params:nB(e)}}function aIe(e){return e===void 0?"All":typeof e=="string"?ta(e):Array.isArray(e)?`Custom Selection: [${e.map(oR).join(", ")}]`:`Custom Selection: ${oR(e)}`}function sW(e,t){let r=t.annotationMap.get(e),n=e.params.field_name,o=t.nearestReprMap?.get(e);return{type:{name:sL.name,params:{annotationId:r,fieldName:n}},colorTheme:DS(o,t)}}function dR(e,t){let r=t.annotationMap.get(e),{field_name:n,field_values:o}=e.params;return{annotationId:r,fieldName:n,fieldValues:o?{name:"selected",params:o.map(i=>({value:i}))}:{name:"all",params:{}},nullIfEmpty:!1}}function uat(e){let t=lIe(e),r=e.params;switch(r.type){case"cartoon":return{type:{name:"cartoon",params:{alpha:t,tubularHelices:r.tubular_helices}},sizeTheme:{name:"uniform",params:{value:r.size_factor}}};case"ball_and_stick":return{type:{name:"ball-and-stick",params:{sizeFactor:(r.size_factor??1)*.5,sizeAspectRatio:.5,alpha:t,ignoreHydrogens:r.ignore_hydrogens}}};case"spacefill":return{type:{name:"spacefill",params:{alpha:t,ignoreHydrogens:r.ignore_hydrogens}},sizeTheme:{name:"physical",params:{scale:r.size_factor}}};case"carbohydrate":return{type:{name:"carbohydrate",params:{alpha:t,sizeFactor:r.size_factor??1}}};case"surface":return{type:{name:"molecular-surface",params:{alpha:t,ignoreHydrogens:r.ignore_hydrogens}},sizeTheme:{name:"physical",params:{scale:r.size_factor}}};default:throw new Error("NotImplementedError")}}function sIe(e){let t=uat(e),r=uIe(e);return r&&(t.type.params={...t.type?.params,clip:r}),e.custom?.molstar_reprepresentation_params&&(t.type.params={...t.type.params,...e.custom.molstar_reprepresentation_params}),t}function lIe(e){let t=SS(e).filter(r=>r.kind==="opacity");return t.length>0?t[t.length-1].params.opacity:1}function iW(e){return{invert:!!e.params.invert,transform:e.params.check_transform?Z.fromArray(Z(),e.params.check_transform,0):Z.identity()}}function cat(e){switch(e.params.type){case"sphere":return{type:"sphere",position:b.ofArray(e.params.center),scale:typeof e.params.radius=="number"?b.create(2*e.params.radius,2*e.params.radius,2*e.params.radius):b.create(2,2,2),rotation:{axis:b.create(1,0,0),angle:0},...iW(e)};case"plane":{let o=b.create(0,1,0),i=b.normalize(b(),b.ofArray(e.params.normal)),a=b.cross(b(),o,i),s=b.magnitude(a)<1e-6;return{type:"plane",position:b.ofArray(e.params.point),scale:b.create(1,1,1),rotation:{axis:s?b.unitX:a,angle:s?0:b.angle(o,i)*180/Math.PI},...iW(e)}}case"box":let t=Tr.fromMat3(Tr(),Ot.fromArray(Ot(),e.params.rotation,0)),r=b(),n=Tr.getAxisAngle(r,t)*180/Math.PI;return{type:"cube",position:b.ofArray(e.params.center),scale:b.ofArray(e.params.size),rotation:{axis:r,angle:n},...iW(e)};default:console.warn(`Mol* MVS: Unsupported clip type "${e.params.type}" in node ${e.ref}.`)}}function uIe(e){let t=SS(e).filter(o=>o.kind==="clip");if(!t.length)return;let r=t[0].params.variant==="object"?"instance":"pixel",n=t.map(cat).filter(o=>!!o);return{variant:r,objects:n}}function mat(e){return e.custom?"molstar_use_default_coloring"in e.custom||"molstar_color_theme_name"in e.custom:!1}function DS(e,t){if(e?.kind==="representation"){let r=SS(e).filter(n=>n.kind==="color"||n.kind==="color_from_uri"||n.kind==="color_from_source");if(r.length===0)return{name:"uniform",params:{value:Eo(aR)}};if(r.length===1&&mat(r[0])){if(r[0].custom?.molstar_use_default_coloring)return;let n=r[0].custom;return{name:n?.molstar_color_theme_name??void 0,params:n?.molstar_color_theme_params??{}}}else{if(r.length===1&&dat(r[0]))return DS(r[0],t);{let n=r.map(o=>{let i=DS(o,t);if(i)return{theme:i,selection:mR(o.kind==="color"?o.params.selector:void 0)}}).filter(o=>!!o);return{name:nF,params:{layers:n}}}}}if(e?.kind==="color")return{name:"uniform",params:{value:Eo(e.params.color)}};if(e?.kind==="color_from_uri"||e?.kind==="color_from_source"){let r=t.annotationMap.get(e);if(r===void 0)return{name:"uniform",params:{}};let n=e.params.field_name;return{name:iB.name,params:{annotationId:r,fieldName:n,background:uR,palette:pat(e.params.palette)}}}}function dat(e){return e.kind==="color"?!rn(e.params.selector)||e.params.selector==="all":!0}var RS=Eo(aR);function pat(e){if(!e)return{name:"direct",params:{}};if(e.kind==="categorical"){let t=aW(bve,e);return{name:"categorical",params:{colors:fat(t.colors),repeatColorList:t.repeat_color_list,sort:t.sort,sortDirection:t.sort_direction,caseInsensitive:t.case_insensitive,setMissingColor:!!t.missing_color,missingColor:Eo(t.missing_color)??RS}}}if(e.kind==="discrete"){let t=aW(xve,e);return{name:"discrete",params:{colors:hat(t.colors,t.reverse),mode:t.mode,xMin:t.value_domain[0],xMax:t.value_domain[1]}}}if(e.kind==="continuous"){let t=aW(Cve,e),r=gat(t.colors,t.reverse);return{name:"continuous",params:{colors:r,mode:t.mode,xMin:t.value_domain[0],xMax:t.value_domain[1],setUnderflowColor:!!t.underflow_color,underflowColor:(t.underflow_color==="auto"?yat(r.colors):Eo(t.underflow_color))??RS,setOverflowColor:!!t.overflow_color,overflowColor:(t.overflow_color==="auto"?bat(r.colors):Eo(t.overflow_color))??RS}}}throw new Error(`NotImplementedError: palettePropsFromMVSPalette is not implemented for palette kind "${e.kind}"`)}function aW(e,t){let r={...e};for(let n in t){let o=t[n];o!==void 0&&(r[n]=o)}return r}function fat(e){if(typeof e=="string"){if(e in _S)return{name:"list",params:{kind:"set",colors:_S[e].list}};if(e in oW){let t=oW[e];return{name:"dictionary",params:Object.entries(t).map(([r,n])=>({value:r,color:n}))}}console.warn(`Could not find named color palette "${e}"`)}return Array.isArray(e)?{name:"list",params:{kind:"set",colors:e.map(t=>Eo(t)??RS)}}:typeof e=="object"?{name:"dictionary",params:Object.entries(e).map(([t,r])=>({value:t,color:Eo(r)??RS}))}:{name:"list",params:{kind:"set",colors:[]}}}function hat(e,t){if(typeof e=="string"){if(e in _S){let r=_S[e],n=t?r.list.slice().reverse():r.list,o=1/n.length;return n.map((i,a)=>({color:Fe.fromColorListEntry(i),fromValue:a*o,toValue:(a+1)*o}))}console.warn(`Could not find named color palette "${e}"`)}if(Array.isArray(e)&&e.every(r=>typeof r=="string")){let r=t?e.slice().reverse():e,n=1/e.length;return r.map((o,i)=>({color:Eo(o)??uR,fromValue:i*n,toValue:(i+1)*n}))}return Array.isArray(e)&&e.every(r=>Array.isArray(r)&&r.length===2)?e.map((r,n)=>({color:Eo(r[0])??uR,fromValue:r[1],toValue:e[n+1]?.[1]??1/0})):Array.isArray(e)&&e.every(r=>Array.isArray(r)&&r.length===3)?e.map(r=>({color:Eo(r[0])??uR,fromValue:r[1]??-1/0,toValue:r[2]??1/0})):[]}function gat(e,t){if(typeof e=="string"){if(e in _S){let r=_S[e],n=t?r.list.slice().reverse():r.list,o=n.length-1;return{kind:"interpolate",colors:n.map((i,a)=>[Fe.fromColorListEntry(i),a/o])}}console.warn(`Could not find named color palette "${e}"`)}if(Array.isArray(e)){if(e.every(r=>Array.isArray(r)))return{kind:"interpolate",colors:e.map(r=>[Eo(r[0])??RS,r[1]])};{let r=t?e.slice().reverse():e,n=r.length-1;return{kind:"interpolate",colors:r.map((o,i)=>[Eo(o)??RS,i/n])}}}return{kind:"interpolate",colors:[]}}function yat(e){if(e.length!==0)return e.every(t=>Array.isArray(t))?Fe.fromColorListEntry(e.reduce((t,r)=>t[1]<r[1]?t:r)):Fe.fromColorListEntry(e[0])}function bat(e){if(e.length!==0)return e.every(t=>Array.isArray(t))?Fe.fromColorListEntry(e.reduce((t,r)=>t[1]>r[1]?t:r)):Fe.fromColorListEntry(e[e.length-1])}function cIe(e){let t=new Map;return kc(e,void 0,(r,n)=>{r.kind==="representation"&&t.set(r,r),r.kind!=="structure"&&t.has(r)&&n&&!t.has(n)&&t.set(n,t.get(r))}),kc(e,(r,n)=>{!t.has(r)&&n&&t.has(n)&&t.set(r,t.get(n))}),t}function mIe(e){let t=lIe(e),r=uIe(e),n=e.params,o=typeof n.absolute_isovalue=="number"?Ve.IsoValue.absolute(n.absolute_isovalue):Ve.IsoValue.relative(n.relative_isovalue??0);switch(n.type){case"isosurface":let i=[];return n.show_wireframe&&i.push("wireframe"),n.show_faces&&i.push("solid"),{type:{name:"isosurface",params:{alpha:t,isoValue:o,visuals:i,clip:r}}};case"grid_slice":let s={name:n.relative_index!==void 0?`relative${n.dimension.toUpperCase()}`:n.dimension,params:n.relative_index??n.relative_index};return{type:{name:"slice",params:{alpha:t,dimension:s,isoValue:o,clip:r}}};default:throw new Error("NotImplementedError")}}function dIe(e,t){if(e?.kind!=="volume_representation")return;let r=SS(e).filter(n=>n.kind==="color");if(r.length===0)return{name:"uniform",params:{value:Eo(aR)}};if(r.length===1)return DS(r[0],t)}function fIe(e={}){return new lW(e)}var Vc=class{constructor(t,r){this._root=t;this._node=r}addChild(t,r){let{params:n,custom:o,ref:i}=xat(r),a={kind:t,params:n,custom:o,ref:i};return this._node.children??=[],this._node.children.push(a),a}},lW=class extends Vc{constructor(r){let{custom:n,ref:o}=r;super(void 0,{kind:"root",custom:n,ref:o});this.focus=Yu(this,Kx,"focus");this.primitives=Yu(this,xA,"primitives");this.primitives_from_uri=Yu(this,xA,"primitives_from_uri");this._root=this}getState(r){return{root:Ya(this._node),metadata:gW.create(r)}}getSnapshot(r){return{root:Ya(this._node),metadata:{...r}}}camera(r){return this.addChild("camera",r),this}canvas(r){return this.addChild("canvas",r),this}download(r){return new uW(this._root,this.addChild("download",r))}},uW=class extends Vc{parse(t){return new cW(this._root,this.addChild("parse",t))}},iF={model:["block_header","block_index","model_index"],assembly:["block_header","block_index","model_index","assembly_id"],symmetry:["block_header","block_index","model_index","ijk_min","ijk_max"],symmetry_mates:["block_header","block_index","model_index","radius"]},cW=class extends Vc{modelStructure(t={}){return new bA(this._root,this.addChild("structure",{type:"model",...rc(t,[...iF.model]),custom:t.custom,ref:t.ref}))}assemblyStructure(t={}){return new bA(this._root,this.addChild("structure",{type:"assembly",...rc(t,iF.assembly),custom:t.custom,ref:t.ref}))}symmetryStructure(t={}){return new bA(this._root,this.addChild("structure",{type:"symmetry",...rc(t,iF.symmetry),custom:t.custom,ref:t.ref}))}symmetryMatesStructure(t={}){return new bA(this._root,this.addChild("structure",{type:"symmetry_mates",...rc(t,iF.symmetry_mates),custom:t.custom,ref:t.ref}))}volume(t={}){return new dW(this._root,this.addChild("volume",t))}},bA=class extends Vc{constructor(){super(...arguments);this.transform=Yu(this,Jx,"transform");this.instance=Yu(this,Jx,"instance");this.primitives=Yu(this,xA,"primitives");this.primitives_from_uri=Yu(this,xA,"primitives_from_uri")}component(r={}){let n={...r,selector:r.selector??"all"};return new pR(this._root,this.addChild("component",n))}componentFromUri(r){return new pR(this._root,this.addChild("component_from_uri",r))}componentFromSource(r){return new pR(this._root,this.addChild("component_from_source",r))}labelFromUri(r){return this.addChild("label_from_uri",r),this}labelFromSource(r){return this.addChild("label_from_source",r),this}tooltipFromUri(r){return this.addChild("tooltip_from_uri",r),this}tooltipFromSource(r){return this.addChild("tooltip_from_source",r),this}},pR=class extends Vc{constructor(){super(...arguments);this.focus=Yu(this,Kx,"focus");this.transform=Yu(this,Jx,"transform");this.instance=Yu(this,Jx,"instance")}representation(r={}){let n={...r,type:r.type??"cartoon"};return new mW(this._root,this.addChild("representation",n))}label(r){return this.addChild("label",r),this}tooltip(r){return this.addChild("tooltip",r),this}},mW=class extends Vc{color(t){return this.addChild("color",t),this}colorFromUri(t){return this.addChild("color_from_uri",t),this}colorFromSource(t){return this.addChild("color_from_source",t),this}opacity(t){return this.addChild("opacity",t),this}clip(t){return this.addChild("clip",t),this}},dW=class extends Vc{constructor(){super(...arguments);this.focus=Yu(this,Kx,"focus");this.transform=Yu(this,Jx,"transform");this.instance=Yu(this,Jx,"instance")}representation(r){return r||(r={type:"isosurface"}),new pW(this._root,this.addChild("volume_representation",r))}},pW=class extends Vc{constructor(){super(...arguments);this.focus=Yu(this,Kx,"focus")}color(r){return this.addChild("color",r),this}opacity(r){return this.addChild("opacity",r),this}clip(r){return this.addChild("clip",r),this}},fW=class extends Vc{constructor(){super(...arguments);this.focus=Yu(this,Kx,"focus")}mesh(r){return this.addChild("primitive",{kind:"mesh",...r}),this}lines(r){return this.addChild("primitive",{kind:"lines",...r}),this}tube(r){return this.addChild("primitive",{kind:"tube",...r}),this}arrow(r){return this.addChild("primitive",{kind:"arrow",...r}),this}distance(r){return this.addChild("primitive",{kind:"distance_measurement",...r}),this}label(r){return this.addChild("primitive",{kind:"label",...r}),this}ellipse(r){return this.addChild("primitive",{kind:"ellipse",...r}),this}ellipsoid(r){return this.addChild("primitive",{kind:"ellipsoid",...r}),this}box(r){return this.addChild("primitive",{kind:"box",...r}),this}},hW=class extends Vc{constructor(){super(...arguments);this.focus=Yu(this,Kx,"focus")}};function Yu(e,t,r){return t.prototype[r].bind(e)}var Kx=class extends Vc{focus(t={}){return this.addChild("focus",t),this}},xA=class extends Vc{primitives(t={}){return new fW(this._root,this.addChild("primitives",t))}primitives_from_uri(t){return new hW(this._root,this.addChild("primitives_from_uri",t))}},Jx=class extends Vc{transform(t={}){return pIe(t),this.addChild("transform",t),this}instance(t={}){return pIe(t),this.addChild("instance",t),this}};function pIe(e){if(e.rotation&&e.rotation.length!==9)throw new Error("ValueError: `rotation` parameter must be an array of 9 numbers");if(e.matrix&&e.matrix.length!==16)throw new Error("ValueError: `matrix` parameter must be an array of 16 numbers");if(e.matrix&&(e.translation||e.rotation))throw new Error("ValueError: `matrix` parameter cannot be used together with `translation` or `rotation` parameters")}function xat(e){let{custom:t,ref:r,...n}=e;return{params:n,custom:t,ref:r}}var gW={create(e){return{...e,version:`${Cm.SupportedVersion}`,timestamp:Cat()}}},Cm={SupportedVersion:1,fromMVSJ(e){let t=JSON.parse(e),r=hIe(t?.metadata?.version);return r===void 0?console.error("Loaded MVS does not contain valid version info."):r>(hIe(Cm.SupportedVersion)??0)&&console.warn(`Loaded MVS is of higher version (${t.metadata.version}) than currently supported version (${Cm.SupportedVersion}). Some features may not work as expected.`),t},toMVSJ(e,t){return JSON.stringify(e,void 0,t)},isValid(e,t={}){return Cm.validationIssues(e,t)===void 0},validationIssues(e,t={}){let r=e?.metadata?.version;if(typeof r!="string")return[`MVSData.metadata.version must be a string, not ${typeof r}: ${r}`];if(e.kind==="single"||e.kind===void 0)return gIe(e,t);if(e.kind==="multiple"){if(e.snapshots===void 0)return['"snapshots" missing in MVS'];let n=[];for(let o of e.snapshots){let i=gIe(o,t);i&&n.push(...i)}return n.length>0?n:void 0}else return[`MVSData.kind must be 'single' or 'multiple', not ${e.kind}`]},toPrettyString(e){let t=e.kind==="multiple"?"multiple states":"single state",r=e.metadata.title!==void 0?` "${e.metadata.title}"`:"",n=e.kind==="multiple"?e.snapshots.map((o,i)=>`[Snapshot #${i}]
${nR(o.root)}`).join(`
`):nR(e.root);return`MolViewSpec ${t}${r} (version ${e.metadata.version}, created ${e.metadata.timestamp}):
${n}`},createBuilder(){return fIe()},createMultistate(e,t){return{kind:"multiple",snapshots:[...e],metadata:gW.create(t)}},stateToStates(e){return{kind:"multiple",metadata:e.metadata,snapshots:[{metadata:{title:e.metadata.title,description:e.metadata.description,description_format:e.metadata.description_format,key:void 0,linger_duration_ms:1e3,transition_duration_ms:250},root:e.root}]}}};function hIe(e){if(typeof e=="string")return parseInt(e.split(".")[0]);if(typeof e=="number")return Math.floor(e);console.error(`Version should be a string, not ${typeof e}: ${e}`)}function gIe(e,t={}){return e.root===void 0?['"root" missing in snapshot']:KL(Qh,e.root,t)}function Cat(){return new Date().toISOString()}var yIe={mmcif:{format:"cif",is_binary:!1},bcif:{format:"cif",is_binary:!0},pdb:{format:"pdb",is_binary:!1},map:{format:"map",is_binary:!0}},Sat={download:e=>[],parse:(e,t)=>{let{format:r,is_binary:n}=yIe[e.params.format],o={kind:"parse",params:{...e.params,format:r},custom:e.custom,ref:e.ref};return t?.kind==="download"?[{kind:"download",params:{...t.params,is_binary:n},custom:t.custom,ref:t.ref},o]:(console.warn('"parse" node is not being converted, this is suspicious'),[o])},structure:(e,t)=>{if(t?.kind!=="parse")throw new Error(`Parent of "structure" must be "parse", not "${t?.kind}".`);let{format:r}=yIe[t.params.format];return[{kind:"trajectory",params:{format:r,...rc(e.params,["block_header","block_index"])}},{kind:"model",params:rc(e.params,["model_index"])},{kind:"structure",params:nc(e.params,["block_header","block_index","model_index"]),custom:e.custom,ref:e.ref}]}},vat=new Set(["download","parse","trajectory","model"]);function bIe(e,t){let r=lve(e,Qh);t&&uve(r,t,["uri","url"]);let n=YL(r,Sat);if(n.kind!=="root")throw new Error("Root's type is not 'root' after conversion from MVS tree to Molstar tree.");return sve(n,vat)}function Iat(e,t){return e=e.toLowerCase(),t.some(r=>r==="*"||e.endsWith(r))}var Aat={mmcif:[".cif",".mmif"],bcif:[".bcif"],pdb:[".pdb",".ent"],map:[".map",".ccp4",".mrc",".mrcs"]};function Tat(e){let t=[];return kc(e,(r,n)=>{if(r.kind==="parse"&&n?.kind==="download"){let o=n.params.url,i=Aat[r.params.format];Iat(o,i)||t.push(`Parsing data from ${o} as ${r.params.format} format might be a mistake. The file extension doesn't match recommended file extensions (${i.join(", ")})`)}}),t.length>0?t:void 0}function xIe(e){let t=Tat(e);if(t){console.warn("There are potential issues in the MVS tree:");for(let r of t)console.warn(" ",r)}}var CIe={rootKind:"root",nodes:{...ky.nodes,download:{...ky.nodes.download,params:on({...ky.nodes.download.params.fields,is_binary:_n(Mi,"Specifies whether file is downloaded as bytes array or string")})},parse:{...ky.nodes.parse,params:on({format:_n(W8,"File format")})},trajectory:{description:"Auxiliary node corresponding to Molstar's TrajectoryFrom*.",parent:["parse"],params:on({format:_n(W8,"File format"),...rc(ky.nodes.structure.params.fields,["block_header","block_index"])})},model:{description:"Auxiliary node corresponding to Molstar's ModelFromTrajectory.",parent:["trajectory"],params:on(rc(ky.nodes.structure.params.fields,["model_index"]))},structure:{...ky.nodes.structure,parent:["model"],params:on(nc(ky.nodes.structure.params.fields,["block_header","block_index","model_index"]))}}};async function wS(e,t,r={}){e.errorContext.clear("mvs");try{if(!e.state.hasBehavior(aF))throw new Error("MolViewSpec extension is not loaded.");let o=t.kind==="multiple"?t:Cm.stateToStates(t),i=[];for(let a=0;a<o.snapshots.length;a++){let s=o.snapshots[a],l=a>0?o.snapshots[a-1]:o.snapshots[o.snapshots.length-1];j8(Qh,s.root,"MVS"),r.sanityChecks&&xIe(s.root);let u=bIe(s.root,r.sourceUrl);j8(CIe,u,"Converted Molstar");let c=Pat(e,u,s.root,{...s.metadata,previousTransitionDurationMs:l.metadata.transition_duration_ms},r);i.push(c)}r.appendSnapshots||e.managers.snapshot.clear();for(let a of i)e.managers.snapshot.add(a);i.length>0&&await st.State.Snapshots.Apply(e,{id:i[0].snapshot.id})}catch(n){throw e.log.error(`${n}`),n}finally{if(!r.doNotReportErrors)for(let n of e.errorContext.get("mvs"))e.log.warn(n),st.Toast.Show(e,{title:"Error",message:n,timeoutMs:1e4});e.errorContext.clear("mvs")}}function Pat(e,t,r,n,o){let i=_at.create(),a=Wve(e,t,Rat,i,{replaceExisting:!0,extensions:o?.extensions??Dat});a.canvas3d={props:e.canvas3d?Rve(e.canvas3d.props,i.canvas,r.custom):void 0},o?.keepCamera||(a.camera=_ve(e,i,n)),a.durationInMs=n.linger_duration_ms+(n.previousTransitionDurationMs??0);let s={key:n.key,name:n.title,description:n.description,descriptionFormat:n.description_format??"markdown"};return pp.Entry(a,s)}var _at={create(){return{annotationMap:new Map,camera:{focuses:[]}}}},Rat={root(e,t,r){return r.nearestReprMap=cIe(t),e},download(e,t){return Un.apply(e,$0,{url:t.params.url,isBinary:t.params.is_binary})},parse(e,t){let r=t.params.format;if(r==="cif")return Un.apply(e,y7,{});if(r==="pdb")return e;if(r==="map")return Un.apply(e,b7,{});console.error(`Unknown format in "parse" node: "${r}"`)},trajectory(e,t){let r=t.params.format;if(r==="cif")return Un.apply(e,mj,{blockHeader:t.params.block_header??"",blockIndex:t.params.block_index??void 0});if(r==="pdb")return Un.apply(e,dj,{});console.error(`Unknown format in "trajectory" node: "${r}"`)},model(e,t,r){let n=tIe(t,r),o=Un.apply(e,D_,{modelIndex:t.params.model_index});return Un.apply(o,w_,{properties:{[rI.descriptor.name]:{isMvs:!0},[cy.descriptor.name]:{annotations:n}},autoAttach:[rI.descriptor.name,cy.descriptor.name]}),o},structure(e,t,r){let n=iIe(t),o=Un.apply(e,pj,n),i=cR(o,t),a=rIe(t,r),s=nIe(t,r);a.length+s.length>0&&Un.apply(o,E_,{properties:{[fS.descriptor.name]:{tooltips:a},[hS.descriptor.name]:{tooltips:s}},autoAttach:[fS.descriptor.name,hS.descriptor.name]});let l=oIe(t,r);if(l.length>0){let u=r.nearestReprMap?.get(t);Un.apply(o,dd,{type:{name:lL.name,params:{items:l}},colorTheme:DS(u,r)})}return i},tooltip:void 0,tooltip_from_uri:void 0,tooltip_from_source:void 0,component(e,t){if(oF(t))return e;let r=t.params.selector;return cR(Un.apply(e,gj,{type:mR(r),label:aIe(r),nullIfEmpty:!1}),t)},component_from_uri(e,t,r){if(oF(t))return;let n=dR(t,r);return cR(Un.apply(e,o8,n),t)},component_from_source(e,t,r){if(oF(t))return;let n=dR(t,r);return cR(Un.apply(e,o8,n),t)},representation(e,t,r){return Un.apply(e,dd,{...sIe(t),colorTheme:DS(t,r)})},volume(e,t){let r;if(e.transformer?.definition.to.includes(re.Format.Ccp4))r=Un.apply(e,bj,{});else if(e.transformer?.definition.to.includes(re.Format.Cif))r=Un.apply(e,xj,{blockHeader:t.params.channel_id||void 0});else{console.error("Unsupported volume format");return}return $ve(r,t)},volume_representation(e,t,r){return Un.apply(e,jj,{...mIe(t),colorTheme:dIe(t,r)})},color:void 0,color_from_uri:void 0,color_from_source:void 0,label:void 0,label_from_uri(e,t,r){let n=sW(t,r);return Un.apply(e,dd,n)},label_from_source(e,t,r){let n=sW(t,r);return Un.apply(e,dd,n)},focus(e,t,r){return r.camera.focuses.push({target:e.selector,params:t.params}),e},camera(e,t,r){return r.camera.cameraParams=t.params,e},canvas(e,t,r){return r.canvas=t,e},primitives(e,t,r){let n=Eve(t),o=Un.apply(e,Bve,{node:t});return SIe(o,n)},primitives_from_uri(e,t,r){let n=Un.apply(e,Mve,{uri:t.params.uri,format:t.params.format});return SIe(n,new Set(t.params.references))}};function SIe(e,t){let r=Un.setMvsDependencies(Un.apply(e,tF,{kind:"mesh"},{state:{isGhost:!0}}),t);Un.apply(r,rF);let n=Un.setMvsDependencies(Un.apply(e,tF,{kind:"labels"},{state:{isGhost:!0}}),t);Un.apply(n,rF);let o=Un.setMvsDependencies(Un.apply(e,tF,{kind:"lines"},{state:{isGhost:!0}}),t);return Un.apply(o,rF),e}var Dat=[Xve,Hve];var ES=class extends re.Create({name:"MVS Data",typeClass:"Data"}){},wat=wy({name:"mvs-parse-mvsj",display:{name:"MolViewSpec from MVSJ",description:"Create MolViewSpec view from MVSJ data"},from:re.Data.String,to:ES})({apply({a:e},t){let r=Cm.fromMVSJ(tm.toString(e.data)),n=Bat(e,t);return new ES({mvsData:r,sourceUrl:n})}}),Eat=wy({name:"mvs-parse-mvsx",display:{name:"MolViewSpec from MVSX",description:"Create MolViewSpec view from MVSX data"},from:re.Data.Binary,to:ES,params:{mainFilePath:C.Text("index.mvsj")}})({apply({a:e,params:t},r){return Pe.create("Parse MVSX file",async n=>{let o=await lF(r,n,e.data,t.mainFilePath);return new ES(o)})}}),AIe={appendSnapshots:C.Boolean(!1,{description:"If true, add snapshots from MVS into current snapshot list; if false, replace the snapshot list."}),keepCamera:C.Boolean(!1,{description:"If true, any camera positioning from the MVS state will be ignored and the current camera position will be kept."}),applyExtensions:C.Boolean(!0,{description:"If true, apply builtin MVS-loading extensions (not a part of standard MVS specification)."})},yW=Ss.build({display:{name:"Load MVS Data"},from:ES,params:AIe})(({a:e,params:t},r)=>Pe.create("Load MVS Data",async()=>{let{mvsData:n,sourceUrl:o}=e.data;await wS(r,n,{appendSnapshots:t.appendSnapshots,keepCamera:t.keepCamera,sourceUrl:o,extensions:t.applyExtensions?void 0:[]})})),bW={label:"MVSJ",description:"MVSJ",category:"Miscellaneous",stringExtensions:["mvsj"],parse:async(e,t)=>e.state.data.build().to(t).apply(wat).commit(),visuals:async(e,t)=>{let r=Yo.resolveRef(t),n=C.getDefaultValues(AIe);return await e.state.data.applyAction(yW,n,r).run()}},TIe={label:"MVSX",description:"MVSX",category:"Miscellaneous",binaryExtensions:["mvsx"],parse:async(e,t)=>e.state.data.build().to(t).apply(Eat).commit(),visuals:bW.visuals};async function lF(e,t,r,n="index.mvsj"){Mat(e);let o=`ni,fnv1a;${Ro(r)}`,i;try{i=await ex(t,r)}catch(u){throw e.log.error("Invalid MVSX file"),u}for(let u in i){let c=vIe(o,u);kat(e.managers.asset,c,i[u],{isFile:!0})}let a=i[n];if(!a)throw new Error(`File ${n} not found in the MVSX archive`);let s=Cm.fromMVSJ(Lat(a)),l=vIe(o,n);return{mvsData:s,sourceUrl:l}}async function xW(e,t,r,n){if(typeof t=="string"&&t.startsWith("base64")&&(t=Uint8Array.from(atob(t.substring(7)),o=>o.charCodeAt(0))),r==="mvsj"){t.BYTES_PER_ELEMENT&&t.buffer&&(t=new TextDecoder().decode(t));let o;typeof t=="string"?o=Cm.fromMVSJ(t):o=t,await wS(e,o,{sanityChecks:!0,sourceUrl:void 0,...n})}else if(r==="mvsx"){if(typeof t=="string")throw new Error("loadMvsData: if `format` is 'mvsx', then `data` must be a Uint8Array or a base64-encoded string prefixed with 'base64,'.");await e.runTask(Pe.create("Load MVSX file",async o=>{let i=await lF(e,o,t);await wS(e,i.mvsData,{sanityChecks:!0,...n,sourceUrl:i.sourceUrl})}))}else throw new Error(`Unknown MolViewSpec format: ${r}`);return t}function Mat(e){e.managers.asset.clearTag("mvsx-file")}function Bat(e,t){let n=t.state.data.selectQ(o=>o.ofTransformer($0)).find(o=>o.obj===e)?.transform.params?.url;return n?Zr.getUrl(n):void 0}function vIe(e,t){return new URL(t,`arcp://${e}/`).href}function kat(e,t,r,n){let o=Zr.getUrlAsset(e,t);if(!e.has(o)){let i=t.split("/").pop()??"file";e.set(o,new File([r],i),n?.isFile?{isStatic:!0,tag:"mvsx-file"}:void 0)}}function Lat(e){return IIe??=new TextDecoder,IIe.decode(e)}var IIe;var aF=qr.create({name:"molviewspec",category:"misc",display:{name:"MolViewSpec",description:"MolViewSpec extension"},ctor:class extends qr.Handler{constructor(){super(...arguments);this.registrables={customModelProperties:[rI,cy],customStructureProperties:[hS,fS],representations:[lL,sL],colorThemes:[iB,Yve(this.ctx.representation.structure.themes.colorThemeRegistry)],lociLabels:[nSe,K0e],dragAndDropHandlers:[Fat],dataFormats:[{name:"MVSJ",provider:bW},{name:"MVSX",provider:TIe}],actions:[yW]}}register(){for(let t of this.registrables.customModelProperties??[])this.ctx.customModelProperties.register(t,this.params.autoAttach);for(let t of this.registrables.customStructureProperties??[])this.ctx.customStructureProperties.register(t,this.params.autoAttach);for(let t of this.registrables.representations??[])this.ctx.representation.structure.registry.add(t);for(let t of this.registrables.colorThemes??[])this.ctx.representation.structure.themes.colorThemeRegistry.add(t);for(let t of this.registrables.lociLabels??[])this.ctx.managers.lociLabels.addProvider(t);for(let t of this.registrables.dragAndDropHandlers??[])this.ctx.managers.dragAndDrop.addHandler(t.name,t.handle);for(let t of this.registrables.dataFormats??[])this.ctx.dataFormats.add(t.name,t.provider);for(let t of this.registrables.actions??[])this.ctx.state.data.actions.add(t);this.ctx.managers.markdownExtensions.registerRefResolver("mvs",(t,r)=>{let n=new Set(r.map(o=>`mvs-ref:${o}`));return zo.doPreOrder(t.state.data.tree,t.state.data.tree.root,{mvsRefs:n,plugin:t,cells:[]},(o,i,a)=>{if(o.tags)for(let s of o.tags){if(!a.mvsRefs.has(s))continue;let l=a.plugin.state.data.cells.get(o.ref);if(l){a.cells.push(l);break}}}).cells}),this.ctx.managers.markdownExtensions.registerUriResolver("mvs",(t,r)=>{let{assets:n}=t.managers.asset,o=n.find(i=>i.file.name===r);if(o)try{return ase(o.file)}catch(i){console.error(`MVS: Failed to convert asset file to data URI for '${r}'`,i);return}})}update(t){let r=this.params.autoAttach!==t.autoAttach;this.params.autoAttach=t.autoAttach;for(let n of this.registrables.customModelProperties??[])this.ctx.customModelProperties.setDefaultAutoAttach(n.descriptor.name,this.params.autoAttach);for(let n of this.registrables.customStructureProperties??[])this.ctx.customStructureProperties.setDefaultAutoAttach(n.descriptor.name,this.params.autoAttach);return r}unregister(){for(let t of this.registrables.customModelProperties??[])this.ctx.customModelProperties.unregister(t.descriptor.name);for(let t of this.registrables.customStructureProperties??[])this.ctx.customStructureProperties.unregister(t.descriptor.name);for(let t of this.registrables.representations??[])this.ctx.representation.structure.registry.remove(t);for(let t of this.registrables.colorThemes??[])this.ctx.representation.structure.themes.colorThemeRegistry.remove(t);for(let t of this.registrables.lociLabels??[])this.ctx.managers.lociLabels.removeProvider(t);for(let t of this.registrables.dragAndDropHandlers??[])this.ctx.managers.dragAndDrop.removeHandler(t.name);for(let t of this.registrables.dataFormats??[])this.ctx.dataFormats.remove(t.name);for(let t of this.registrables.actions??[])this.ctx.state.data.actions.remove(t);this.ctx.managers.markdownExtensions.removeRefResolver("mvs")}},params:()=>({autoAttach:C.Boolean(!1)})}),Fat={name:"mvs-mvsj-mvsx",async handle(e,t){let r=!1;for(let n of e){if(n.name.toLowerCase().endsWith(".mvsj")){let o=Pe.create("Load MVSJ file",async i=>{let a=await n.text(),s=Cm.fromMVSJ(a);await wS(t,s,{sanityChecks:!0,appendSnapshots:r,sourceUrl:void 0})});await t.runTask(o),r=!0}if(n.name.toLowerCase().endsWith(".mvsx")){let o=Pe.create("Load MVSX file",async i=>{let a=await n.arrayBuffer(),s=new Uint8Array(a),l=await lF(t,i,s);await wS(t,l.mvsData,{sanityChecks:!0,appendSnapshots:r,sourceUrl:l.sourceUrl})});await t.runTask(o),r=!0}}return r}};var b3e=Rt(Pi());var XS=Rt(Pi());var zA=Rt(Pi());var CX={};Bi(CX,{AddTrajectory:()=>Wut,DownloadStructure:()=>Gut,EnableModelCustomProps:()=>Hut,EnableStructureCustomProps:()=>jut,LoadTrajectory:()=>Xut,PdbDownloadProvider:()=>MTe,UpdateTrajectory:()=>TR});var CW={get defaultTransparency(){return I8()?"blended":"wboit"},get preferWebGl1(){return typeof navigator>"u"||typeof window>"u"?!1:["Version/15.1 Safari","Version/15.2 Safari","Version/15.3 Safari"].some(t=>navigator.userAgent.indexOf(t)>0)?!0:I8()}};var SW=class{constructor(t,r){this.key=t;this.defaultValue=r}toString(){return this.key}valueOf(){return this.key}};function ti(e,t){return new SW(e,t)}var Lr={item:ti,General:{IsBusyTimeoutMs:ti("plugin-config.is-busy-timeout",750),DisableAntialiasing:ti("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:ti("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:ti("plugin-config.pixel-scale",1),PickScale:ti("plugin-config.pick-scale",.25),Transparency:ti("plugin-config.transparency",CW.defaultTransparency),PreferWebGl1:ti("plugin-config.prefer-webgl1",CW.preferWebGl1),AllowMajorPerformanceCaveat:ti("plugin-config.allow-major-performance-caveat",!1),PowerPreference:ti("plugin-config.power-preference","high-performance"),ResolutionMode:ti("plugin-config.resolution-mode","auto")},State:{DefaultServer:ti("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:ti("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:ti("history-capacity.server",5)},VolumeStreaming:{Enabled:ti("volume-streaming.enabled",!0),DefaultServer:ti("volume-streaming.server","https://ds.litemol.org"),CanStream:ti("volume-streaming.can-stream",(e,t)=>e.models.length===1&&Ft.probablyHasDensityMap(e.models[0])),EmdbHeaderServer:ti("volume-streaming.emdb-header-server","https://files.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:ti("viewer.show-expand-button",!0),ShowControls:ti("viewer.show-controls-button",!0),ShowSettings:ti("viewer.show-settings-button",!0),ShowSelectionMode:ti("viewer.show-selection-model-button",!0),ShowAnimation:ti("viewer.show-animation-button",!0),ShowTrajectoryControls:ti("viewer.show-trajectory-controls",!0),ShowScreenshotControls:ti("viewer.show-screenshot-controls",!0)},Download:{DefaultPdbProvider:ti("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:ti("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:ti("structure.size-thresholds",De.DefaultSizeThresholds),DefaultRepresentationPreset:ti("structure.default-representation-preset","auto"),DefaultRepresentationPresetParams:ti("structure.default-representation-preset-params",{}),SaccharideCompIdMapType:ti("structure.saccharide-comp-id-map-type","default")},Background:{Styles:ti("background.styles",[])}},uF=class{constructor(t){this._config=new Map;t&&t.forEach(([r,n])=>this._config.set(r,n))}get(t){return this._config.has(t)?this._config.get(t):t.defaultValue}set(t,r){this._config.set(t,r)}delete(t){this._config.delete(t)}};function PIe(e){switch(e){case 0:return"Spherical";case 1:return"Terminal";case 2:return"Linear";case 3:return"Trigonal";case 4:return"Tetrahedral";case 5:return"Trigonal Bi-Pyramidal";case 6:return"Octahedral";case 7:return"Square Planar";case 8:return"Unknown"}}function MS(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}var vW=new Map([[2,vr(180)],[3,vr(120)],[4,vr(109.4721)],[6,vr(90)]]),SA=b(),CA=b(),Rf=b(),$x=b(),Zh=b();function vA(e,t,r,n,o,i=!0){let a=[],s=[];return t.conformation.position(t.elements[r],Rf),n.conformation.position(n.elements[o],$x),b.sub(SA,$x,Rf),us(e,t,r,(l,u)=>{dn(l,u)!=="H"?(l.conformation.position(l.elements[u],Zh),b.sub(CA,Zh,Rf),a.push(b.angle(SA,CA))):i||(l.conformation.position(l.elements[u],Zh),b.sub(CA,Zh,Rf),s.push(b.angle(SA,CA)))}),[a,s]}function IW(e,t,r,n,o){t.conformation.position(t.elements[r],Rf),n.conformation.position(n.elements[o],$x),b.sub(SA,$x,Rf);let i=[b(),b()],a=0,s,l;if(us(e,t,r,(u,c)=>{a>1||dn(u,c)!=="H"&&(s=u,l=c,u.conformation.position(u.elements[c],Zh),b.sub(i[a++],Zh,Rf))}),a===1&&s&&l&&us(e,s,l,(u,c)=>{a>1||u===t&&c===r||dn(u,c)!=="H"&&(u.conformation.position(u.elements[c],Zh),b.sub(i[a++],Zh,Rf))}),a===2)return b.cross(CA,i[0],i[1]),Math.abs(Math.PI/2-b.angle(CA,SA))}function _Ie(e,t,r,n,o){let i=r;t.conformation.position(t.elements[r],Rf),n.conformation.position(n.elements[o],$x),b.sub(SA,$x,Rf);let a=b.squaredDistance(Rf,$x);return us(e,t,r,(s,l)=>{if(dn(s,l)==="H"){s.conformation.position(s.elements[l],Zh);let u=b.squaredDistance(Zh,$x);u<a&&(a=u,i=l)}}),i}var AW=new Ct.ElementBondIterator,TW=new Ct.ElementBondIterator;function Oat(e,t,r){let n=dn(t,r),o=n==="O"||n==="N";if(o&&Ec(e,t,r)===4)return!1;for(AW.setElement(e,t,r);AW.hasNext;){let i=AW.move();if(i.order>1)return!0;if(o){let a=dn(i.otherUnit,i.otherIndex);for(TW.setElement(e,i.otherUnit,i.otherIndex);TW.hasNext;){let s=TW.move();if(s.order>1){if((a==="P"||a==="S")&&dn(s.otherUnit,s.otherIndex)==="O")continue;return!0}}}}return!1}function Gat(e,t,r){let n=0,{offset:o,edgeProps:{flags:i,order:a}}=t.bonds;for(let s=o[r],l=o[r+1];s<l;++s)ht.isCovalent(i[s])&&(n+=a[s]);return e.interUnitBonds.getEdgeIndices(r,t.id).forEach(s=>{let l=e.interUnitBonds.edges[s];ht.isCovalent(l.props.flag)&&(n+=l.props.order)}),n}var IA=new Ct.ElementBondIterator,PW=new Ct.ElementBondIterator;function Uat(e,t,r,n,o){let i=Wl(e,t,r,"H"),a=dn(t,r),s=zk(t,r),l=n.assignCharge==="always"||n.assignCharge==="auto"&&s===0,u=n.assignH==="always"||n.assignH==="auto"&&!o&&i===0,c=Ec(e,t,r),m=Gat(e,t,r),d=Oat(e,t,r),p=m-c>0,h=0,f=8;switch(a){case"H":l&&(c===0?(s=1,f=0):c===1&&(s=0,f=1));break;case"C":l&&(s=0),u&&(h=Math.max(0,4-m-Math.abs(s))),f=MS(c+h+Math.max(0,-s));break;case"N":if(l)if(!u)s=m-3;else if(d&&m<4)c-i===1&&m-i===2?s=1:s=0;else for(IA.setElement(e,t,r);IA.hasNext;){let y=IA.move(),g=dn(y.otherUnit,y.otherIndex);if(g==="S"||Fle(g)){s=0;break}else s=1}u&&(h=Math.max(0,3-m+s)),d&&!p?f=MS(c+h-s):f=MS(c+h+1-s);break;case"O":if(l&&(u||(s=m-2),m===1)){IA.setElement(e,t,r);e:for(;IA.hasNext;){let y=IA.move();for(PW.setElement(e,y.otherUnit,y.otherIndex);PW.hasNext;){let g=PW.move();if(!(g.otherUnit===t&&g.otherIndex===r)&&dn(g.otherUnit,g.otherIndex)==="O"&&g.order===2){s=-1;break e}}}}u&&(h=Math.max(0,2-m+s)),d&&!p?f=MS(c+h-s+1):f=MS(c+h-s+2);break;case"S":l&&(u||(m<=3&&Wl(e,t,r,"O")===0?s=m-2:s=0)),u&&m<2&&(h=Math.max(0,2-m+s)),m<=3&&(f=MS(c+h-s+2));break;case"F":case"CL":case"BR":case"I":case"AT":l&&(s=m-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":l&&(s=1-m);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":l&&(s=2-m);break;default:$t&&console.warn("Requested charge, protonation for an unhandled element",a)}return[s,h,h+i,f]}function Nat(e,t,r){let n=t.elements.length,o=new Int8Array(n),i=new Int8Array(n),a=new Int8Array(n),s=new Int8Array(n),l=!!e.parent,u;if(l){let m=e.root.unitMap.get(t.id);if(u=Be.indicesOf(m.elements,t.elements),u.length!==t.elements.length)throw new Error("expected to find an index for every element");t=m,e=e.root}let c=!1;for(let m=0;m<n;++m){let d=l?u[m]:m;if(dn(t,d)==="H"){c=!0;break}}for(let m=0;m<n;++m){let d=l?u[m]:m,[p,h,f,y]=Uat(e,t,d,r,c);o[m]=p,i[m]=h,a[m]=f,s[m]=y}return{charge:o,implicitH:i,totalH:a,idealGeometry:s}}var _W={assignCharge:C.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:C.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};async function RIe(e,t,r){let n={...C.getDefaultValues(_W),...r},o=new Map,i=`valence-model-${JSON.stringify(n)}`;for(let a=0,s=t.units.length;a<s;++a){let l=t.units[a];if(me.isAtomic(l)){let u;l.transientCache.has(i)?u=l.transientCache.get(i):(u=Nat(t,l,n),l.transientCache.set(i,u)),o.set(l.id,u)}}return o}var RW={..._W},qh=Pl.createProvider({label:"Valence Model",descriptor:{name:"molstar_computed_valence_model"},type:"local",defaultParams:RW,getParams:e=>RW,isApplicable:e=>!0,obtain:async(e,t,r)=>{let n={...C.getDefaultValues(RW),...r};return{value:await RIe(e.runtime,t,n)}}});var _o;(c=>{function e(m,d,p,h){return b.set(m,h.x[p],h.y[p],h.z[p]),b.transformMat4(m,m,d.conformation.operator.matrix),m}c.setPosition=e;function t(m,d){let p=new Int32Array(d+1),h=new Int32Array(d),f=new Int32Array(d),{members:y,count:g,offsets:x}=m;for(let v=0,A=x[g];v<A;++v)++f[y[v]];let S=0;for(let v=0;v<d;v++)p[v]=S,S+=f[v];p[d]=S;let I=new Int32Array(S);for(let v=0;v<g;++v)for(let A=x[v],_=x[v+1];A<_;++A){let T=y[A],w=p[T]+h[T];I[w]=v,++h[T]}return{indices:I,offsets:p}}c.createElementsIndex=t;function r(m,d){let p,h;return{...d,get lookup3d(){if(!p){let f={x:d.x,y:d.y,z:d.z,indices:Se.ofBounds(0,d.count)};p=Cc(f,lf(f))}return p},get elementsIndex(){return h||(h=t(d,m))},subset:f=>n(d,f)}}c.create=r;function n(m,d){let p,{count:h,types:f}=m,y=[];for(let x=0;x<h;++x)d.has(f[x])&&y.push(x);let g=Be.ofSortedArray(y);return{indices:g,get lookup3d(){if(!p){let x={x:m.x,y:m.y,z:m.z,indices:g};p=Cc(x,lf(x))}return p}}}c.createSubset=n;function o(m,d,p){let h=qh.get(m).value;if(!h||!h.has(d.id))throw new Error("valence model required");return{unit:d,types:p.types,feature:-1,x:p.x,y:p.y,z:p.z,members:p.members,offsets:p.offsets,idealGeometry:h.get(d.id).idealGeometry}}c.Info=o;function i(m,d){return b.set(m,d.x[d.feature],d.y[d.feature],d.z[d.feature]),b.transformMat4(m,m,d.unit.conformation.operator.matrix),m}c.position=i;let a=b(),s=b();function l(m,d){let p=m.members[m.offsets[m.feature]],h=d.members[d.offsets[d.feature]];return m.unit.conformation.position(m.unit.elements[p],a),d.unit.conformation.position(d.unit.elements[h],s),b.distance(a,s)}c.distance=l;function u(m,d){return{types:new Set(m),add:d}}c.Provider=u})(_o||={});var DW;(t=>{function e(r=2048,n=1024,o){let i=Qe.create(Float32Array,1,n,o?o.x:r),a=Qe.create(Float32Array,1,n,o?o.y:r),s=Qe.create(Float32Array,1,n,o?o.z:r),l=Qe.create(Uint8Array,1,n,o?o.types:r),u=Qe.create(Uint8Array,1,n,o?o.groups:r),c=Qe.create(Uint32Array,1,n,o?o.offsets:r),m=Qe.create(Uint32Array,1,n,o?o.members:r),d={x:0,y:0,z:0,offset:0,count:0};return{startState:()=>{d.x=0,d.y=0,d.z=0,d.offset=m.elementCount,d.count=0},pushMember:(p,h,f,y)=>{Qe.add(m,y),d.x+=p,d.y+=h,d.z+=f,d.count+=1},finishState:(p,h)=>{let{count:f}=d;f!==0&&(Qe.add(l,p),Qe.add(u,h),Qe.add(i,d.x/f),Qe.add(a,d.y/f),Qe.add(s,d.z/f),Qe.add(c,d.offset))},add:(p,h,f,y,g,x)=>{Qe.add(l,p),Qe.add(u,h),Qe.add(i,f),Qe.add(a,y),Qe.add(s,g),Qe.add(c,m.elementCount),Qe.add(m,x)},getFeatures:p=>{Qe.add(c,m.elementCount);let h=Qe.compact(i,!0),f=Qe.compact(a,!0),y=Qe.compact(s,!0),g=i.elementCount;return _o.create(p,{x:h,y:f,z:y,count:g,types:Qe.compact(l,!0),groups:Qe.compact(u,!0),offsets:Qe.compact(c,!0),members:Qe.compact(m,!0)})}}}t.create=e})(DW||={});var wW;(t=>{function e(r,n,o){let i=new Int32Array(o+1),a=new Int32Array(o),s=new Int32Array(o),{members:l,offsets:u}=n;for(let d=0,p=r.edgeCount*2;d<p;++d){let h=r.a[d],f=r.b[d];if(!(h>f)){for(let y=u[h],g=u[h+1];y<g;++y)++s[l[y]];for(let y=u[f],g=u[f+1];y<g;++y)++s[l[y]]}}let c=0;for(let d=0;d<o;d++)i[d]=c,c+=s[d];i[o]=c;let m=new Int32Array(c);for(let d=0,p=r.edgeCount*2;d<p;++d){let h=r.a[d],f=r.b[d];if(!(h>f)){for(let y=u[h],g=u[h+1];y<g;++y){let x=l[y],S=i[x]+a[x];m[S]=d,++a[x]}for(let y=u[f],g=u[f+1];y<g;++y){let x=l[y],S=i[x]+a[x];m[S]=d,++a[x]}}}return{indices:m,offsets:i}}t.createElementsIndex=e})(wW||={});var cF=class extends Km{getContactIndicesForElement(t,r){return this.elementKeyIndex.get(this.getElementKey(t,r.id))||[]}getElementKey(t,r){return`${t}|${r}`}constructor(t,r){super(t),this.elementKeyIndex=new Map;for(let n=0,o=this.edges.length;n<o;++n){let{unitA:i,indexA:a}=this.edges[n],{offsets:s,members:l}=r.get(i);for(let u=s[a],c=s[a+1];u<c;++u){let m=this.getElementKey(l[u],i),d=this.elementKeyIndex.get(m);d===void 0?this.elementKeyIndex.set(m,[n]):d.push(n)}}}};function EW(e){switch(e){case 4:return"Hydrogen Bond";case 6:return"Hydrophobic Contact";case 5:return"Halogen Bond";case 1:return"Ionic Interaction";case 7:return"Metal Coordination";case 2:return"Cation-Pi Interaction";case 3:return"Pi Stacking";case 8:return"Weak Hydrogen Bond";case 0:return"Unknown Interaction"}}function DIe(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}function wIe(e){switch(e){case 0:return"None";case 1:return"Quaternary Amine";case 2:return"Tertiary Amine";case 3:return"Sulfonium";case 4:return"Sulfonic Acid";case 5:return"Sulfate";case 6:return"Phosphate";case 7:return"Halocarbon";case 8:return"Guanidine";case 9:return"Acetamidine";case 10:return"Carboxylate"}}var BW;(t=>{function e(r,n){let o=[],i=[],a=[];return{add(s,l,u){o[o.length]=s,i[i.length]=l,a[a.length]=u},getContacts(){let s=new ns.EdgeBuilder(r.count,o,i),l=new Int8Array(s.slotCount),u=new Int8Array(s.slotCount);for(let p=0,h=s.edgeCount;p<h;p++)s.addNextEdge(),s.assignProperty(l,a[p]);let c=s.createGraph({type:l,flag:u}),m;return Object.defineProperty(c,"elementsIndex",{get:()=>m||(m=wW.createElementsIndex(c,r,n))})}}}t.create=e})(BW||={});var kW;(t=>{function e(){let r=new Km.Builder;return{startUnitPair(n,o){r.startUnitPair(n.id,o.id)},finishUnitPair(){r.finishUnitPair()},add(n,o,i){r.add(n,o,{type:i,flag:0})},getContacts(n){return new cF(r.getMap(),n)}}}t.create=e})(kW||={});var BIe={lineOfSightDistFactor:C.Numeric(1,{min:0,max:3,step:.1})},zat=3;function kIe(e,t,r){let n=t.members[t.offsets[t.feature]],o=r.members[r.offsets[r.feature]];if(n===o&&t.unit===r.unit)return!1;let i=z_(t.unit,n),a=z_(r.unit,o);return!(i&&a&&i!==a||t.unit===r.unit&&t.unit.model.atomicHierarchy.residueAtomSegments.count>1&&t.unit.residueIndex[t.unit.elements[n]]===r.unit.residueIndex[r.unit.elements[o]]||m0e(e,t.unit,n,r.unit,o))}function EIe(e,t,r,n){let o=z_(e,t),i=z_(r,n);return o&&i&&o!==i}function MIe(e,t){let{feature:r,offsets:n,members:o}=t;for(let i=n[r],a=n[r+1];i<a;++i)if(o[i]===e)return!0;return!1}var eC=b(),LW=b(),FW=b(),Hat=Gv();function LIe(e,t,r,n){let o=t.feature,i=r.feature,a=t.members[t.offsets[o]],s=r.members[r.offsets[i]];_o.position(LW,t),_o.position(FW,r),b.scale(eC,b.add(eC,LW,FW),.5);let l=n*zat,{count:u,indices:c,units:m,squaredDistances:d}=e.lookup3d.find(eC[0],eC[1],eC[2],l,Hat);if(u===0)return!0;for(let p=0;p<u;++p){let h=c[p],f=m[p];if(!me.isAtomic(f))continue;let y=dn(f,h);if(y==="H")continue;let g=hh(y);if(!(g*g*n*n<=d[p])&&!(EIe(f,h,t.unit,a)||EIe(f,h,r.unit,s))&&!(t.unit===f&&MIe(h,t)||r.unit===f&&MIe(h,r))&&(f.conformation.position(f.elements[h],eC),!(b.squaredDistance(eC,LW)<1||b.squaredDistance(eC,FW)<1)))return!1}return!0}function FIe(e,t,r,n,o,i){for(let a of o)jat(e,t,r,n,a,i)}function jat(e,t,r,n,o,i){let{x:a,y:s,z:l}=r,{lookup3d:u,indices:c}=r.subset(o.requiredFeatures),m=_o.Info(e,t,r),d={...m},p=i.lineOfSightDistFactor;for(let h=0,f=Se.size(c);h<f;++h){let y=Se.getAt(c,h),{count:g,indices:x,squaredDistances:S}=u.find(a[y],s[y],l[y],o.maxDistance);if(g!==0){m.feature=y;for(let I=0;I<g;++I){let v=Se.getAt(c,x[I]);if(v<=y||(d.feature=v,!kIe(e,m,d)))continue;let A=o.getType(e,m,d,S[I]);A&&LIe(e,m,d,p)&&n.add(y,v,A)}}}}var Wat=Z();function VIe(e,t,r,n,o,i,a,s){let{count:l,x:u,y:c,z:m}=r,{lookup3d:d}=o,p=Z.mul(Wat,n.conformation.operator.inverse,t.conformation.operator.matrix),h=!Z.isIdentity(p),f=b(),y=Math.max(...a.map(_=>_.maxDistance)),{center:g,radius:x}=d.boundary.sphere,S=(x+y)*(x+y),I=s.lineOfSightDistFactor,v=_o.Info(e,t,r),A=_o.Info(e,n,o);i.startUnitPair(t,n);for(let _=0;_<l;++_){if(b.set(f,u[_],c[_],m[_]),h&&b.transformMat4(f,f,p),b.squaredDistance(f,g)>S)continue;let{indices:T,count:w,squaredDistances:D}=d.find(f[0],f[1],f[2],y);if(w!==0){v.feature=_;for(let M=0;M<w;++M){let E=T[M];if(A.feature=E,!kIe(e,v,A))continue;let R=D[M];for(let k of a)if(R<k.maxDistance*k.maxDistance){let B=k.getType(e,v,A,R);if(B&&LIe(e,v,A,I)){i.add(_,E,B);break}}}}}i.finishUnitPair()}var Xat={distanceMax:C.Numeric(4,{min:1,max:5,step:.1}),angleMax:C.Numeric(30,{min:0,max:60,step:1})},Qat=["CL","BR","I","AT"];function Zat(e,t,r){let{elements:n}=t,{x:o,y:i,z:a}=t.model.atomicConformation;for(let s=0,l=n.length;s<l;++s){let u=dn(t,s);Qat.includes(u)&&r.add(6,0,o[n[s]],i[n[s]],a[n[s]],s)}}var qat=["N","O","S"],Yat=["C","N","P","S"];function Kat(e,t,r){let{elements:n}=t,{x:o,y:i,z:a}=t.model.atomicConformation;for(let s=0,l=n.length;s<l;++s){let u=dn(t,s);if(qat.includes(u)){let c=!1;us(e,t,s,(m,d)=>{Yat.includes(dn(m,d))&&(c=!0)}),c&&r.add(7,0,o[n[s]],i[n[s]],a[n[s]],s)}}}function Jat(e,t){return e===7&&t===6||e===6&&t===7}var $at=vr(180),est=vr(120);function tst(e){return{angleMax:vr(e.angleMax)}}function rst(e,t,r,n){let o=t.types[t.feature],i=r.types[r.feature];if(!Jat(o,i))return;let[a,s]=o===6?[t,r]:[r,t],l=a.members[a.offsets[a.feature]],u=s.members[s.offsets[s.feature]],[c]=vA(e,a.unit,l,s.unit,u);if(c.length!==1||$at-c[0]>n.angleMax)return;let[m]=vA(e,s.unit,u,a.unit,l);if(m.length!==0&&!m.some(d=>est-d>n.angleMax))return 5}var OIe=_o.Provider([6],Zat),GIe=_o.Provider([7],Kat),UIe={name:"halogen-bonds",params:Xat,createTester:e=>{let t=tst(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:(r,n,o)=>rst(r,n,o,t)}}};var jIe={distanceMax:C.Numeric(3.5,{min:1,max:5,step:.1}),backbone:C.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:C.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),ignoreHydrogens:C.Boolean(!1,{description:"Ignore explicit hydrogens in geometric constraints"}),donAngleDevMax:C.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:C.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:C.Numeric(45,{min:0,max:180,step:1})},nst={...jIe,water:C.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:C.Numeric(4.1,{min:1,max:5,step:.1})},ost={...jIe};function VW(e,t){let r=qh.get(e).value;if(!r)throw Error("expected valence model to be available");let n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function ist(e,t,r){let{totalH:n}=VW(e,t),{elements:o}=t,{x:i,y:a,z:s}=t.model.atomicConformation;for(let l=0,u=o.length;l<u;++l){let c=dn(t,l);(WIe(t,l)||n[l]>0&&(c==="N"||c==="O"||c==="S"))&&r.add(4,0,i[o[l]],a[o[l]],s[o[l]],l)}}function ast(e,t,r){let{totalH:n}=VW(e,t),{elements:o}=t,{x:i,y:a,z:s}=t.model.atomicConformation;for(let l=0,u=o.length;l<u;++l)dn(t,l)==="C"&&n[l]>0&&(Wl(e,t,l,"N")>0||Wl(e,t,l,"O")>0||sst(t,l))&&r.add(9,0,i[o[l]],a[o[l]],s[o[l]],l)}function sst(e,t){let{elementAromaticRingIndices:r,all:n}=e.rings,o=r.get(t);if(o===void 0)return!1;for(let i=0,a=o.length;i<a;++i){let s=n[o[i]];for(let l=0,u=s.length;l<u;++l){let c=dn(e,s[l]);if(c==="N"||c==="O")return!0}}return!1}function lst(e,t,r){let{charge:n,implicitH:o,idealGeometry:i}=VW(e,t),{elements:a}=t,{x:s,y:l,z:u}=t.model.atomicConformation,c=m=>{r.add(5,0,s[a[m]],l[a[m]],u[a[m]],m)};for(let m=0,d=a.length;m<d;++m){let p=dn(t,m);if(p==="O")c(m);else if(p==="N"){if(WIe(t,m))c(m);else if(n[m]<1){let h=Ec(e,t,m)+o[m],f=i[m];(f===4&&h<4||f===3&&h<3||f===2&&h<2)&&c(m)}}else if(p==="S"){let h=H_(t,m);(h==="CYS"||h==="MET"||zk(t,m)===-1)&&c(m)}}}function NIe(e,t){return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]===2}function zIe(e,t){return Ym.has(Vx(e,t))}function ust(e,t){return e.rings.elementRingIndices.has(t)}function WIe(e,t){return H_(e,t)==="HIS"&&dn(e,t)==="N"&&ust(e,t)}function cst(e,t,r,n){return zIe(e,t)&&zIe(r,n)}function mst(e,t,r,n){return NIe(e,t)&&NIe(r,n)}function dst(e,t){return e===5&&t===4||e===4&&t===5}function pst(e,t){return e===9&&t===5||e===5&&t===9}function XIe(e){return{ignoreHydrogens:e.ignoreHydrogens,includeBackbone:e.backbone,maxAccAngleDev:vr(e.accAngleDevMax),maxDonAngleDev:vr(e.donAngleDevMax),maxAccOutOfPlaneAngle:vr(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:vr(e.donOutOfPlaneAngleMax)}}function fst(e){return{...XIe(e),includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax}}var HIe=vr(120);function QIe(e,t,r,n){let o=t.members[t.offsets[t.feature]],i=r.members[r.offsets[r.feature]];if(!n.includeBackbone&&cst(t.unit,o,r.unit,i))return;let[a,s]=vA(e,t.unit,o,r.unit,i,n.ignoreHydrogens),l=vW.get(t.idealGeometry[o])||HIe;if(a.some(p=>Math.abs(l-p)>n.maxDonAngleDev)||s.length&&!s.some(p=>p<n.maxDonAngleDev))return;if(t.idealGeometry[o]===3){let p=IW(e,t.unit,o,r.unit,i);if(p!==void 0&&p>n.maxDonOutOfPlaneAngle)return}let u=o;!n.ignoreHydrogens&&s.length>0&&(u=_Ie(e,t.unit,o,r.unit,i));let[c,m]=vA(e,r.unit,i,t.unit,u,n.ignoreHydrogens),d=vW.get(r.idealGeometry[i])||HIe;if(!c.some(p=>d-p>n.maxAccAngleDev)&&!m.some(p=>d-p>n.maxAccAngleDev)){if(r.idealGeometry[i]===3){let p=IW(e,r.unit,i,t.unit,o);if(p!==void 0&&p>n.maxAccOutOfPlaneAngle)return}return!0}}function hst(e,t,r,n,o){let i=t.types[t.feature],a=r.types[r.feature];if(!dst(i,a))return;let[s,l]=a===5?[t,r]:[r,t],u=s.members[s.offsets[s.feature]],c=l.members[l.offsets[l.feature]],m=dn(s.unit,u)==="S"||dn(l.unit,c)==="S"?o.maxSulfurDistSq:o.maxDistSq;if(!(n>m)&&!(!o.includeWater&&mst(s.unit,u,l.unit,c))&&QIe(e,s,l,o))return 4}function gst(e,t,r,n,o){let i=t.types[t.feature],a=r.types[r.feature];if(!pst(i,a))return;let[s,l]=a===5?[t,r]:[r,t];if(QIe(e,s,l,o))return 8}var ZIe=_o.Provider([4],ist),qIe=_o.Provider([9],ast),YIe=_o.Provider([5],lst),KIe={name:"hydrogen-bonds",params:nst,createTester:e=>{let t=Math.max(e.distanceMax,e.sulfurDistanceMax),r=fst(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:(n,o,i,a)=>hst(n,o,i,a,r)}}},JIe={name:"weak-hydrogen-bonds",params:ost,createTester:e=>{let t=XIe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:(r,n,o,i)=>gst(r,n,o,i,t)}}};var yst={distanceMax:C.Numeric(5,{min:0,max:8,step:.1})},bst={distanceMax:C.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:C.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:C.Numeric(30,{min:0,max:180,step:1})},xst={distanceMax:C.Numeric(6,{min:1,max:8,step:.1}),offsetMax:C.Numeric(2,{min:0,max:4,step:.1})},Cst=["ARG","HIS","LYS"],Sst=["GLU","ASP"];function rAe(e,t){let r=qh.get(e).value;if(!r)throw Error("expected valence model to be available");let n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function vst(e,t,r){let{charge:n}=rAe(e,t),{elements:o}=t,{x:i,y:a,z:s}=t.model.atomicConformation,l=new Set,{label_comp_id:u}=t.model.atomicHierarchy.atoms,c=Xt.transientSegments(t.model.atomicHierarchy.residueAtomSegments,o);for(;c.hasNext;){let{index:m,start:d,end:p}=c.move(),h=u.value(t.model.atomicHierarchy.residueAtomSegments.offsets[m]);if(Cst.includes(h)){r.startState();for(let f=d;f<p;++f)dn(t,f)==="N"&&!Ym.has(Vx(t,f))&&r.pushMember(i[o[f]],a[o[f]],s[o[f]],f);r.finishState(1,0)}else if(!ey.has(h)){l.clear();for(let f=d;f<p;++f){let y=0;h0e(e,t,f)?y=8:g0e(e,t,f)&&(y=9),y&&(r.startState(),us(e,t,f,(g,x)=>{dn(t,x)==="N"&&(l.add(x),r.pushMember(i[o[x]],a[o[x]],s[o[x]],x))}),r.finishState(1,y))}for(let f=d;f<p;++f)n[f]>0&&!l.has(f)&&r.add(1,0,i[o[f]],a[o[f]],s[o[f]],f)}}}function Ist(e,t,r){let{charge:n}=rAe(e,t),{elements:o}=t,{x:i,y:a,z:s}=t.model.atomicConformation,l=new Set,{label_comp_id:u}=t.model.atomicHierarchy.atoms,c=Xt.transientSegments(t.model.atomicHierarchy.residueAtomSegments,o);for(;c.hasNext;){let{index:m,start:d,end:p}=c.move(),h=u.value(t.model.atomicHierarchy.residueAtomSegments.offsets[m]);if(Sst.includes(h)){r.startState();for(let f=d;f<p;++f)dn(t,f)==="O"&&!Ym.has(Vx(t,f))&&r.pushMember(i[o[f]],a[o[f]],s[o[f]],f);r.finishState(2,0)}else if(L0.has(h))for(let f=d;f<p;++f)Kj(e,t,f)&&(r.startState(),us(e,t,f,(y,g)=>{dn(t,g)==="O"&&r.pushMember(i[o[g]],a[o[g]],s[o[g]],g)}),r.finishState(2,6));else if(!ey.has(h)){for(let f=d;f<p;++f){r.startState(),dn(t,f)==="N"&&!Ym.has(Vx(t,f))&&r.pushMember(i[o[f]],a[o[f]],s[o[f]],f),r.finishState(2,0);let y=0;d0e(e,t,f)?y=4:Kj(e,t,f)?y=6:p0e(e,t,f)?y=5:f0e(e,t,f)&&(y=10),y&&(r.startState(),us(e,t,f,(g,x)=>{dn(t,x)==="O"&&(l.add(x),r.pushMember(i[o[x]],a[o[x]],s[o[x]],x))}),r.finishState(2,y))}for(let f=d;f<p;++f)n[f]<0&&!l.has(f)&&r.add(2,0,i[o[f]],a[o[f]],s[o[f]],f)}}}function Ast(e,t,r){let{elements:n}=t,{x:o,y:i,z:a}=t.model.atomicConformation;for(let s of t.rings.aromaticRings){let l=t.rings.all[s];r.startState();for(let u=0,c=l.length;u<c;++u){let m=l[u];r.pushMember(o[n[m]],i[n[m]],a[n[m]],m)}r.finishState(3,0)}}function Tst(e,t){return e===2&&t===1||e===1&&t===2}function Pst(e,t){return e===3&&t===3}function _st(e,t){return e===3&&t===1||e===1&&t===3}var $Ie=b(),eAe=b();function Rst(e,t,r){let{feature:n,offsets:o,members:i}=e,{feature:a,offsets:s,members:l}=t;for(let u=o[n],c=o[n+1];u<c;++u){let m=i[u];e.unit.conformation.position(e.unit.elements[m],$Ie);for(let d=s[a],p=s[a+1];d<p;++d){let h=l[d];if(t.unit.conformation.position(t.unit.elements[h],eAe),b.squaredDistance($Ie,eAe)<r)return!0}}return!1}var pF=b(),AA=b(),fF=b(),dF=b();function GW(e,t){let{unit:r,feature:n,offsets:o,members:i}=t,{elements:a}=r,s=o[n];return t.unit.conformation.position(a[i[s]],pF),t.unit.conformation.position(a[i[s+1]],AA),t.unit.conformation.position(a[i[s+2]],fF),b.triangleNormal(e,pF,AA,fF)}var UW=function(e,t,r){return _o.position(pF,e),_o.position(AA,t),b.sub(fF,pF,AA),b.projectOnPlane(dF,fF,r),b.add(dF,dF,AA),b.distance(dF,AA)};function Dst(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}function wst(e){return{offsetMax:e.offsetMax,angleDevMax:vr(e.angleDevMax)}}function Est(e){return{offsetMax:e.offsetMax}}var Mst=vr(180),tAe=vr(90),fR=b(),OW=b();function Bst(e,t,r,n,o){let i=t.types[t.feature],a=r.types[r.feature];if(Tst(i,a)&&Rst(t,r,o.distanceMaxSq))return 1}function kst(e,t,r,n,o){let i=t.types[t.feature],a=r.types[r.feature];if(Pst(i,a)){GW(fR,t),GW(OW,r);let s=b.angle(fR,OW);if(Math.min(UW(t,r,OW),UW(r,t,fR))<=o.offsetMax){if(s<=o.angleDevMax||s>=Mst-o.angleDevMax)return 3;if(s<=o.angleDevMax+tAe&&s>=tAe-o.angleDevMax)return 3}}}function Lst(e,t,r,n,o){let i=t.types[t.feature],a=r.types[r.feature];if(_st(i,a)){let[s,l]=i===3?[t,r]:[r,t];if(GW(fR,s),UW(l,s,fR)<=o.offsetMax)return 2}}var nAe=_o.Provider([2],Ist),oAe=_o.Provider([1],vst),iAe=_o.Provider([3],Ast),aAe={name:"ionic",params:yst,createTester:e=>{let t=Dst(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:(r,n,o,i)=>Bst(r,n,o,i,t)}}},sAe={name:"pi-stacking",params:bst,createTester:e=>{let t=wst(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:(r,n,o,i)=>kst(r,n,o,i,t)}}},lAe={name:"cation-pi",params:xst,createTester:e=>{let t=Est(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:(r,n,o,i)=>Lst(r,n,o,i,t)}}};var Fst={distanceMax:C.Numeric(4,{min:1,max:5,step:.1})};function Vst(e,t,r){let{elements:n}=t,{x:o,y:i,z:a}=t.model.atomicConformation;for(let s=0,l=n.length;s<l;++s){let u=dn(t,s),c=!1;u==="C"?(c=!0,us(e,t,s,(m,d)=>{let p=dn(m,d);p!=="C"&&p!=="H"&&(c=!1)})):u==="F"&&(c=!0),c&&r.add(8,0,o[n[s]],i[n[s]],a[n[s]],s)}}function Ost(e,t){return e===8&&t===8}function Gst(e,t,r,n){let o=t.types[t.feature],i=r.types[r.feature];if(!Ost(o,i))return;let a=t.members[t.offsets[t.feature]],s=r.members[r.offsets[r.feature]];if(!(dn(t.unit,a)==="F"&&dn(r.unit,s)==="F"))return 6}var uAe=_o.Provider([8],Vst),cAe={name:"hydrophobic",params:Fst,createTester:e=>({maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:(t,r,n,o)=>Gst(t,r,n,o)})};var Ust={distanceMax:C.Numeric(3,{min:1,max:5,step:.1})},Nst=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function zst(e,t,r){let{elements:n}=t,{x:o,y:i,z:a}=t.model.atomicConformation;for(let s=0,l=n.length;s<l;++s){let u=dn(t,s),c=0;Nst.includes(u)?c=13:(Q9(u)||u==="ZN"||u==="CD")&&(c=12),c&&r.add(c,0,o[n[s]],i[n[s]],a[n[s]],s)}}function mAe(e){return!Ym.has(e)}function Hst(e){return Ym.has(e)}function jst(e){return Pv.has(e)}function Wst(e,t,r){let{elements:n}=t,{x:o,y:i,z:a}=t.model.atomicConformation;for(let s=0,l=n.length;s<l;++s){let u=dn(t,s),c=H_(t,s),m=Vx(t,s),d=!1,p=!1,h=k0.has(c),f=L0.has(c);!h&&!f?X9(u)||u==="O"||u==="S"?(d=!0,p=!0):u==="N"&&(d=!0):h?u==="O"?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(c)&&mAe(m)||Hst(m))&&(d=!0,p=!0):u==="S"&&(c==="CYS"||c==="MET")?(d=!0,p=!0):u==="N"&&c==="HIS"&&mAe(m)&&(d=!0):f&&(u==="O"&&jst(m)?(d=!0,p=!0):["N3","N4","N7"].includes(m)?d=!0:["O2","O4","O6"].includes(m)&&(d=!0,p=!0)),d&&r.add(11,0,o[n[s]],i[n[s]],a[n[s]],s),p&&r.add(10,0,o[n[s]],i[n[s]],a[n[s]],s)}}function dAe(e,t){if(e===12)return t===11||t===12;if(e===13)return t===10}function Xst(e,t,r,n){let o=t.types[t.feature],i=r.types[r.feature];if(!(!dAe(o,i)&&!dAe(i,o)))return 7}var pAe=_o.Provider([13,12],zst),fAe=_o.Provider([10,11],Wst),hAe={name:"metal-coordination",params:Ust,createTester:e=>({maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:(t,r,n,o)=>Xst(t,r,n,o)})};function gAe(e,t){let{contacts:r,unitsContacts:n,unitsFeatures:o}=t,i=[Qst(e,t),Zst(e,t),qst(e,t),Yst(e,t),Kst(e,t)];for(let s=0,l=r.edgeCount;s<l;++s){let u=r.edges[s],c=e.unitMap.get(u.unitA),m=e.unitMap.get(u.unitB),d=_o.Info(e,c,o.get(u.unitA));d.feature=u.indexA;let p=_o.Info(e,m,o.get(u.unitB));p.feature=u.indexB;for(let h of i)h.isApplicable(u.props.type)&&h.handleInterContact(s,d,p)}let a=n.keys();for(;;){let{done:s,value:l}=a.next();if(s)break;let u=n.get(l),c=o.get(l),m=e.unitMap.get(l);if(!me.isAtomic(m))continue;let d=_o.Info(e,m,c),p=_o.Info(e,m,c);for(let h of i)h.startUnit(m,u,c);for(let h=0,f=u.edgeCount*2;h<f;++h){d.feature=u.a[h],p.feature=u.b[h];for(let y of i)y.isApplicable(u.edgeProps.type[h])&&y.handleIntraContact(h,d,p)}}}function Qst(e,t){let{contacts:r}=t,n=function(u,c,m,d,p){let[h,f]=d.get(m)||[1/0,-1];u<h?(f!==-1&&p(f),d.set(m,[u,c])):p(c)};function o(u,c,m,d,p){let h=c.members[c.offsets[c.feature]],f=m.members[m.offsets[m.feature]],y=c.unit.getResidueIndex(h),g=m.unit.getResidueIndex(f),x=`${h}|${c.unit.id}|${g}|${m.unit.id}|A`,S=`${f}|${m.unit.id}|${y}|${c.unit.id}|B`,I=_o.distance(c,m);n(I,u,x,d,p),n(I,u,S,d,p)}let i=new Map,a=u=>r.edges[u].props.flag=1,s,l;return{isApplicable:u=>u===6,handleInterContact:(u,c,m)=>{o(u,c,m,i,a)},startUnit:(u,c,m)=>{s=new Map,l=d=>c.edgeProps.flag[d]=1},handleIntraContact:(u,c,m)=>{o(u,c,m,s,l)}}}function Zst(e,t){let{contacts:r}=t,n=(o,i)=>{let a=o.types[o.feature]===9?i:o,s=a.members[a.offsets[a.feature]],{edgeProps:{type:l},elementsIndex:{offsets:u,indices:c}}=t.unitsContacts.get(a.unit.id);for(let d=u[s],p=u[s+1];d<p;++d)if(l[c[d]]===4)return!0;let m=r.getEdgeIndices(a.feature,a.unit.id);for(let d=0,p=m.length;d<p;++d)if(r.edges[m[d]].props.type===4)return!0;return!1};return{isApplicable:o=>o===8,handleInterContact:(o,i,a)=>{n(i,a)&&(r.edges[o].props.flag=1)},startUnit:()=>{},handleIntraContact:(o,i,a)=>{if(n(i,a)){let{flag:s}=t.unitsContacts.get(i.unit.id).edgeProps;s[o]=1}}}}function NW(e,t,r,n,o){let{offsets:i,feature:a}=r,{offsets:s,feature:l}=n;for(let u=i[a],c=i[a+1];u<c;++u){let m=r.members[u],d=o.getContactIndicesForElement(m,r.unit);for(let p=0,h=d.length;p<h;++p){let f=d[p];if(e.includes(o.edges[f].props.type))for(let y=s[l],g=s[l+1];y<g;++y){let x=n.members[y];if(o.getContactIndicesForElement(x,n.unit).includes(f)){o.edges[t].props.flag=1;return}}}}}function zW(e,t,r,n,o){let{edgeProps:{type:i,flag:a},elementsIndex:{offsets:s,indices:l}}=o,{offsets:u,feature:c}=r,{offsets:m,feature:d}=n;for(let p=u[c],h=u[c+1];p<h;++p){let f=r.members[p];for(let y=s[f],g=s[f+1];y<g;++y){let x=l[y];if(e.includes(i[x]))for(let S=m[d],I=m[d+1];S<I;++S){let v=n.members[S];for(let A=s[v],_=s[v+1];A<_;++A)if(x===l[A]){a[t]=1;return}}}}}function qst(e,t){let{contacts:r}=t;return{isApplicable:n=>n===1,handleInterContact:(n,o,i)=>{NW([4,8],n,o,i,r)},startUnit:()=>{},handleIntraContact:(n,o,i)=>{zW([4,8],n,o,i,t.unitsContacts.get(o.unit.id))}}}function Yst(e,t){let{contacts:r}=t;return{isApplicable:n=>n===6||n===2,handleInterContact:(n,o,i)=>{NW([3],n,o,i,r)},startUnit:()=>{},handleIntraContact:(n,o,i)=>{zW([3],n,o,i,t.unitsContacts.get(o.unit.id))}}}function Kst(e,t){let{contacts:r}=t;return{isApplicable:n=>n===1,handleInterContact:(n,o,i)=>{NW([7],n,o,i,r)},startUnit:()=>{},handleIntraContact:(n,o,i)=>{zW([7],n,o,i,t.unitsContacts.get(o.unit.id))}}}var Df;(u=>{function e(c,m,d,p,h,f){return PB("interactions",{structure:m,interactions:c},{unitA:d,indexA:p,unitB:h,indexB:f})}u.Location=e;function t(c){return!!c&&c.kind==="data-location"&&c.tag==="interactions"}u.isLocation=t;function r(c,m){return c.data.structure===m.data.structure&&c.data.interactions===m.data.interactions&&c.element.indexA===m.element.indexA&&c.element.indexB===m.element.indexB&&c.element.unitA===m.element.unitA&&c.element.unitB===m.element.unitB}u.areLocationsEqual=r;function n(c,m){let{unitA:d,indexA:p,unitB:h,indexB:f}=m,{contacts:y,unitsContacts:g}=c;if(d===h){let x=g.get(d.id),S=x.getDirectedEdgeIndex(p,f);return EW(x.edgeProps.type[S])}else{let x=y.getEdgeIndex(p,d.id,f,h.id);return EW(y.edges[x].props.type)}}function o(c){return n(c.data.interactions,c.element)}u.locationLabel=o;function i(c,m,d){return Ex("interactions",{structure:c,interactions:m},d,p=>s(m,d,p),()=>l(c,m,d))}u.Loci=i;function a(c){return!!c&&c.kind==="data-loci"&&c.tag==="interactions"}u.isLoci=a;function s(c,m,d){let{unitsFeatures:p}=c;return cu.fromPairProvider(m.length,(h,f,y)=>{let g=m[h];_o.setPosition(f,g.unitA,g.indexA,p.get(g.unitA.id)),_o.setPosition(y,g.unitB,g.indexB,p.get(g.unitB.id))},d)}u.getBoundingSphere=s;function l(c,m,d){let p=d[0];if(p===void 0)return"";let{unitA:h,indexA:f,unitB:y,indexB:g}=p,{unitsFeatures:x}=m,{members:S,offsets:I}=x.get(h.id),{members:v,offsets:A}=x.get(y.id),_={granularity:"element"};return(I[f+1]-I[f]>1||A[g+1]-A[g]>1)&&(_.granularity="residue"),[n(m,p),O_(Ct.Location(c,h,S[I[f]],c,y,v[A[g]]),_)].join("</br>")}u.getLabel=l})(Df||={});var Jst=[ZIe,qIe,YIe,nAe,oAe,iAe,OIe,GIe,uAe,pAe,fAe],hF={ionic:aAe,"pi-stacking":sAe,"cation-pi":lAe,"halogen-bonds":UIe,"hydrogen-bonds":KIe,"weak-hydrogen-bonds":JIe,hydrophobic:cAe,"metal-coordination":hAe};function $st(e=[]){let t=Object.create(null);return Object.keys(hF).forEach(r=>{t[r]=C.MappedStatic(e.includes(r)?"on":"off",{on:C.Group(hF[r].params),off:C.Group({})},{cycle:!0})}),t}var elt=$st(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),HW={providers:C.Group(elt,{isFlat:!0}),contacts:C.Group(BIe,{label:"Advanced Options"})};async function yAe(e,t,r,n){let o={...C.getDefaultValues(HW),...r},i=JSON.stringify(o);await qh.attach(e,t);let a=[];$C(hF).forEach(p=>{let{name:h,params:f}=o.providers[p];h==="on"&&a.push(hF[p].createTester(f))});let s=new Set;a.forEach(p=>no.add(s,p.requiredFeatures));let l=Jst.filter(p=>no.areIntersecting(s,p.types)),u=xl.Mutable(),c=xl.Mutable();for(let p=0,h=t.unitSymmetryGroups.length;p<h;++p){let f=t.unitSymmetryGroups[p];e.runtime.shouldUpdate&&await e.runtime.update({message:"computing interactions",current:p,max:h});let y=tlt(t,f.units[0],l,i);for(let x=0,S=f.units.length;x<S;++x){let I=f.units[x];u.set(I.id,y)}if(n?.skipIntraContacts)continue;let g=rlt(t,f.units[0],y,a,o.contacts);for(let x=0,S=f.units.length;x<S;++x){let I=f.units[x];c.set(I.id,g)}}let m=nlt(t,u,a,o.contacts,n),d={unitsFeatures:u,unitsContacts:c,contacts:m};return gAe(t,d),d}function tlt(e,t,r,n){let o=`features-${n}`;if(t.transientCache.has(o))return t.transientCache.get(o);let i=t.elements.length,a=DW.create(i,i/2);if(me.isAtomic(t))for(let l of r)l.add(e,t,a);let s=a.getFeatures(i);return t.transientCache.set(o,s),s}function rlt(e,t,r,n,o){let i=BW.create(r,t.elements.length);return me.isAtomic(t)&&FIe(e,t,r,i,n,o),i.getContacts()}function nlt(e,t,r,n,o){let i=kW.create();return De.eachUnitPair(e,(a,s)=>{let l=t.get(a.id),u=t.get(s.id);VIe(e,a,l,s,u,i,r,n)},{maxRadius:Math.max(...r.map(a=>a.maxDistance)),validUnit:a=>me.isAtomic(a),validUnitPair:(a,s)=>o?.unitPairTest?o.unitPairTest(a,s):De.validUnitPair(e,a,s)}),i.getContacts(t)}var jW={...HW},ci=Pl.createProvider({label:"Interactions",descriptor:{name:"molstar_computed_interactions"},type:"local",defaultParams:jW,getParams:e=>jW,isApplicable:e=>!e.isCoarseGrained,obtain:async(e,t,r)=>{let n={...C.getDefaultValues(jW),...r};return{value:await yAe(e,t,n)}}});var Vy=b(),TA=b(),hR=b(),gF=Qe.add,bAe=Qe.add3,kS;(t=>{function e(r=2048,n=1024,o){let i=Qe.create(Float32Array,1,n,o?o.groupBuffer.ref.value:r),a=Qe.create(Float32Array,3,n,o?o.startBuffer.ref.value:r),s=Qe.create(Float32Array,3,n,o?o.endBuffer.ref.value:r),l=Qe.create(Float32Array,1,n,o?o.scaleBuffer.ref.value:r),u=Qe.create(Float32Array,1,n,o?o.capBuffer.ref.value:r),c=Qe.create(Float32Array,1,n,o?o.colorModeBuffer.ref.value:r),m=(p,h,f,y,g,x,S,I,v,A,_)=>{for(let T=0;T<6;++T)bAe(a,p,h,f),bAe(s,y,g,x),gF(i,_),gF(l,S),gF(u,(I?1:0)+(v?2:0)),gF(c,A)},d=(p,h,f,y,g,x,S,I,v)=>{let A=b.distance(p,h),_=f%2!==0,T=Math.floor((f+1)/2),w=A/(f+.5),D=2;b.setMagnitude(hR,b.sub(hR,h,p),w),b.copy(Vy,p);for(let M=0;M<T;++M)b.add(Vy,Vy,hR),_&&M===T-1?(b.copy(TA,h),S||(x=!1)):b.add(TA,Vy,hR),I&&(D=b.distance(p,TA)/(A*2)),m(Vy[0],Vy[1],Vy[2],TA[0],TA[1],TA[2],y,g,x,D,v),b.add(Vy,Vy,hR)};return{add:m,addFixedCountDashes:d,addFixedLengthDashes:(p,h,f,y,g,x,S,I)=>{let v=b.distance(p,h);d(p,h,v/f,y,g,x,!0,S,I)},getCylinders:()=>{let p=i.elementCount/6,h=Qe.compact(i,!0),f=Qe.compact(a,!0),y=Qe.compact(s,!0),g=Qe.compact(l,!0),x=Qe.compact(u,!0),S=Qe.compact(c,!0),I=o&&p<=o.cylinderCount?o.mappingBuffer.ref.value:new Float32Array(p*18),v=o&&p<=o.cylinderCount?o.indexBuffer.ref.value:new Uint32Array(p*12);return(!o||p>o.cylinderCount)&&olt(p,I,v),Di.create(I,v,h,f,y,g,x,S,p,o)}}}t.create=e})(kS||={});function olt(e,t,r){for(let n=0;n<e;++n){let o=n*18;t[o]=-1,t[o+1]=1,t[o+2]=-1,t[o+3]=-1,t[o+4]=-1,t[o+5]=-1,t[o+6]=1,t[o+7]=1,t[o+8]=-1,t[o+9]=1,t[o+10]=1,t[o+11]=1,t[o+12]=1,t[o+13]=-1,t[o+14]=-1,t[o+15]=1,t[o+16]=-1,t[o+17]=1}for(let n=0;n<e;++n){let o=n*6,i=n*12;r[i]=o,r[i+1]=o+1,r[i+2]=o+2,r[i+3]=o+1,r[i+4]=o+4,r[i+5]=o+2,r[i+6]=o+2,r[i+7]=o+4,r[i+8]=o+3,r[i+9]=o+4,r[i+10]=o+5,r[i+11]=o+3}}var hd={linkScale:C.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:C.Numeric(1,{min:0,max:2,step:.01}),linkCap:C.Boolean(!1),aromaticScale:C.Numeric(.3,{min:0,max:1,step:.01}),aromaticSpacing:C.Numeric(1.5,{min:0,max:3,step:.01}),aromaticDashCount:C.Numeric(2,{min:1,max:6,step:1}),dashCount:C.Numeric(4,{min:0,max:10,step:1}),dashScale:C.Numeric(.8,{min:0,max:2,step:.1}),dashCap:C.Boolean(!0),stubCap:C.Boolean(!0),radialSegments:C.Numeric(16,{min:2,max:56,step:2},We.CustomQualityParamInfo),colorMode:C.Select("default",C.arrayToOptions(["default","interpolate"]),We.ShadingCategory)},itn=C.getDefaultValues(hd),WW={linkScale:C.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:C.Numeric(.1,{min:0,max:2,step:.01}),aromaticDashCount:C.Numeric(2,{min:1,max:6,step:1}),dashCount:C.Numeric(4,{min:0,max:10,step:1})},atn=C.getDefaultValues(WW),Fo=b(),rC=b(),fp=b(),ilt=b.create(0,1,0);function XW(e,t,r,n){b.normalize(rC,b.sub(rC,t,r)),n!==null?b.sub(fp,t,n):b.copy(fp,t),b.normalize(fp,fp);let o=b.dot(rC,fp);return 1-Math.abs(o)<1e-5&&(b.set(fp,1,0,0),o=b.dot(rC,fp),1-Math.abs(o)<1e-5&&(b.set(fp,0,1,0),o=b.dot(rC,fp))),b.setMagnitude(rC,rC,o),b.sub(fp,fp,rC),b.normalize(e,fp)}var yF={linkCount:0,position:()=>{},radius:()=>0};var wf=b.scale,zi=b.add,qa=b.sub,ql=b.setMagnitude,alt=b.dot;function Oc(e,t,r,n){let{linkCount:o,referencePosition:i,position:a,style:s,radius:l,ignore:u,stub:c}=t;if(!o)return{mesh:ft.createEmpty(n)};let{radialSegments:m,stubCap:d}=r,p=m*2*o*2,h=et.createState(p,p/4,n),f=b(),y=0,g=0,x={builderState:h,props:r,assignNonAdjustedPosition:(A,_)=>{a(A,_,g,!1)},referencePosition:i?()=>i(g):void 0},S={a:b(),b:b(),group:0,linkStub:!1,linkStyle:0,linkRadius:0};for(let A=o;g<A;++g)u&&u(g)||(a(S.a,S.b,g,!0),zi(f,f,S.a),zi(f,f,S.b),y+=2,S.group=g,S.linkStub=d&&(c?c(g):!1),S.linkRadius=l(g),S.linkStyle=s?s(g):0,llt(x,S));let I=et.getMesh(h);if(y===0)return{mesh:I};b.scale(f,f,1/y);let v=n?ye.clone(n.boundingSphere):void 0;return v&&b.distance(f,v.center)/v.radius<.1?{mesh:I,boundingSphere:v}:{mesh:I}}var slt={cylinderProps:{radiusTop:1,radiusBottom:1,radialSegments:8,topCap:!1,bottomCap:!1},vShift:b(),va:b(),vb:b()};function llt(e,t){let{builderState:r,props:n,assignNonAdjustedPosition:o,referencePosition:i}=e,{linkRadius:a,linkStub:s,linkStyle:l,a:u,b:c}=t,{linkScale:m,linkSpacing:d,radialSegments:p,linkCap:h,aromaticScale:f,aromaticSpacing:y,aromaticDashCount:g,dashCount:x,dashScale:S,dashCap:I}=n,{cylinderProps:v,vShift:A,va:_,vb:T}=slt;v.radialSegments=p,b.copy(_,u),b.copy(T,c),qa(Fo,T,_);let w=alt(Fo,ilt)>0,[D,M]=w?[s,h]:[h,s];if(r.currentGroup=t.group,l===0)v.radiusTop=v.radiusBottom=a,v.topCap=D,v.bottomCap=M,nn(r,_,T,.5,v);else if(l===1)v.radiusTop=v.radiusBottom=a*S,v.topCap=v.bottomCap=I,ep(r,_,T,.5,x,s,v);else if(l===2||l===3||l===4||l===5||l===7||l===8){let E=l===2||l===3?2:l===4||l===5?3:1.5,R=a*(m/(.5*E)),k=(a-R)*d;if(XW(A,_,T,i?i():null),v.topCap=D,v.bottomCap=M,l===7||l===8){v.radiusTop=v.radiusBottom=a,nn(r,_,T,.5,v);let B=a+f*a+f*a*y;o&&o(_,T),ql(Fo,qa(Fo,T,_),a*.5),zi(_,_,Fo),qa(T,T,Fo),v.radiusTop=v.radiusBottom=a*f,v.topCap=v.bottomCap=I,ql(A,A,B),qa(_,_,A),qa(T,T,A),ep(r,_,T,.5,g,s,v),l===8&&(ql(A,A,B*2),zi(_,_,A),zi(T,T,A),ep(r,_,T,.5,g,s,v))}else if(l===3||l===5){let B=a+R+m*a*d;ql(A,A,B),v.radiusTop=v.radiusBottom=a,nn(r,_,T,.5,v),wf(Fo,Fo,d*m*.2),zi(_,_,Fo),qa(T,T,Fo),v.radiusTop=v.radiusBottom=R,v.topCap=w?s:I,v.bottomCap=w?I:s,ql(A,A,B),qa(_,_,A),qa(T,T,A),nn(r,_,T,.5,v),E===3&&(ql(A,A,B*2),zi(_,_,A),zi(T,T,A),nn(r,_,T,.5,v))}else ql(A,A,k),v.radiusTop=v.radiusBottom=R,E===3&&nn(r,_,T,.5,v),vye(r,_,T,.5,A,v)}else l===6&&(wf(Fo,Fo,.475),zi(_,_,Fo),qa(T,T,Fo),v.radiusTop=v.radiusBottom=a,v.topCap=D,v.bottomCap=M,nn(r,_,T,.5,v))}function gR(e,t,r,n){let{linkCount:o,referencePosition:i,position:a,style:s,radius:l,ignore:u,stub:c}=t;if(!o)return{cylinders:Di.createEmpty(n)};let{linkScale:m,linkSpacing:d,linkCap:p,aromaticScale:h,aromaticSpacing:f,aromaticDashCount:y,dashCount:g,dashScale:x,dashCap:S,stubCap:I,colorMode:v}=r,A=v==="interpolate",_=A===!0?3:2,T=o*2,w=kS.create(T,T/4,n),D=b(),M=b(),E=b(),R=b(),k=b(),B=0;for(let U=0,Q=o;U<Q;++U){if(u&&u(U))continue;a(D,M,U,!0),zi(k,k,D),zi(k,k,M),B+=2;let O=l(U),q=s?s(U):0,X=I&&(c?c(U):!1);if(q===0)wf(E,zi(E,D,M),.5),w.add(D[0],D[1],D[2],E[0],E[1],E[2],1,p,X,_,U);else if(q===1)wf(E,zi(E,D,M),.5),w.addFixedCountDashes(D,E,g,x,S,S,X,A,U);else if(q===2||q===3||q===4||q===5||q===7||q===8){let F=q===2||q===3?2:q===4||q===5?3:1.5,Y=m/(.5*F),$=(O-Y*O)*d;if(wf(E,zi(E,D,M),.5),XW(R,D,M,i?i(U):null),q===7||q===8){w.add(D[0],D[1],D[2],E[0],E[1],E[2],1,p,X,_,U);let ce=O+h*O+h*O*f;a(D,M,U,!1),ql(Fo,qa(Fo,M,D),O*.5),zi(D,D,Fo),ql(R,R,ce),qa(D,D,R),qa(E,E,R),w.addFixedCountDashes(D,E,y,h,S,S,X,A,U),q===8&&(ql(R,R,ce*2),zi(D,D,R),zi(E,E,R),w.addFixedCountDashes(D,E,y,h,S,S,X,A,U))}else if(q===3||q===5){let ce=O+Y*O+m*O*d;ql(R,R,ce),w.add(D[0],D[1],D[2],E[0],E[1],E[2],1,p,X,_,U),ql(Fo,qa(Fo,D,E),O/1.5),qa(D,D,Fo),F===3&&w.add(D[0]+R[0],D[1]+R[1],D[2]+R[2],E[0]+R[0],E[1]+R[1],E[2]+R[2],Y,p,X,_,U),w.add(D[0]-R[0],D[1]-R[1],D[2]-R[2],E[0]-R[0],E[1]-R[1],E[2]-R[2],Y,S,X,_,U)}else ql(R,R,$),F===3&&w.add(D[0],D[1],D[2],E[0],E[1],E[2],Y,p,X,_,U),w.add(D[0]+R[0],D[1]+R[1],D[2]+R[2],E[0]+R[0],E[1]+R[1],E[2]+R[2],Y,p,X,_,U),w.add(D[0]-R[0],D[1]-R[1],D[2]-R[2],E[0]-R[0],E[1]-R[1],E[2]-R[2],Y,p,X,_,U)}else q===6&&(wf(Fo,qa(Fo,E,D),.475),zi(D,D,Fo),qa(E,E,Fo),w.add(D[0],D[1],D[2],E[0],E[1],E[2],1,p,X,_,U))}let L=w.getCylinders();if(B===0)return{cylinders:L};b.scale(k,k,1/B);let V=n?ye.clone(n.boundingSphere):void 0;return V&&b.distance(k,V.center)/V.radius<.1?{cylinders:L,boundingSphere:V}:{cylinders:L}}function yR(e,t,r,n){let{linkCount:o,referencePosition:i,position:a,style:s,ignore:l}=t;if(!o)return{lines:ln.createEmpty(n)};let{linkScale:u,linkSpacing:c,aromaticDashCount:m,dashCount:d}=r,p=o*2,h=Ua.create(p,p/4,n),f=b(),y=b(),g=b(),x=b(),S=b(),I=0,v=4.5,A=3;for(let w=0,D=o;w<D;++w){if(l&&l(w))continue;a(f,y,w,!0),zi(S,S,f),zi(S,S,y),I+=2;let M=s?s(w):0;if(M===0)wf(g,zi(g,f,y),.5),h.add(f[0],f[1],f[2],g[0],g[1],g[2],w);else if(M===1)wf(g,zi(g,f,y),.5),h.addFixedCountDashes(f,g,d,w);else if(M===2||M===3||M===4||M===5||M===7||M===8){let E=M===2||M===3?2:M===4||M===5?3:1.5,k=(1-1*(u/(.5*E)))*c;if(wf(g,zi(g,f,y),.5),XW(x,f,y,i?i(w):null),M===7||M===8){h.add(f[0],f[1],f[2],g[0],g[1],g[2],w);let B=k*v;ql(Fo,qa(Fo,y,f),B*.5),zi(f,f,Fo),ql(x,x,B),qa(f,f,x),qa(g,g,x),h.addFixedCountDashes(f,g,m,w),M===8&&(ql(x,x,B*2),zi(f,f,x),zi(g,g,x),h.addFixedCountDashes(f,g,m,w))}else M===3||M===5?(ql(x,x,k*A),h.add(f[0],f[1],f[2],g[0],g[1],g[2],w),wf(Fo,qa(Fo,f,g),c*u),qa(f,f,Fo),E===3&&h.add(f[0]+x[0],f[1]+x[1],f[2]+x[2],g[0]+x[0],g[1]+x[1],g[2]+x[2],w),h.add(f[0]-x[0],f[1]-x[1],f[2]-x[2],g[0]-x[0],g[1]-x[1],g[2]-x[2],w)):(ql(x,x,k*1.5),E===3&&h.add(f[0],f[1],f[2],g[0],g[1],g[2],w),h.add(f[0]+x[0],f[1]+x[1],f[2]+x[2],g[0]+x[0],g[1]+x[1],g[2]+x[2],w),h.add(f[0]-x[0],f[1]-x[1],f[2]-x[2],g[0]-x[0],g[1]-x[1],g[2]-x[2],w))}else M===6&&(wf(Fo,qa(Fo,g,f),.475),zi(f,f,Fo),qa(g,g,Fo),h.add(f[0],f[1],f[2],g[0],g[1],g[2],w))}let _=h.getLines();if(I===0)return{lines:_};b.scale(S,S,1/I);let T=n?ye.clone(n.boundingSphere):void 0;return T&&b.distance(S,T.center)/T.radius<.1?{lines:_,boundingSphere:T}:{lines:_}}var bF={sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),dashCount:C.Numeric(6,{min:1,max:10,step:1}),dashScale:C.Numeric(.4,{min:0,max:2,step:.1}),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),includeParent:C.Boolean(!1),parentDisplay:C.Select("stub",C.arrayToOptions(["stub","full","between"]),{description:'Only has an effect when "includeParent" is enabled. "Stub" shows just the child side of interactions to the parent. "Full" shows both sides of interactions to the parent. "Between" shows only interactions to the parent.'})};async function ult(e,t,r,n,o,i){if(!me.isAtomic(t))return ft.createEmpty(i);let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return ft.createEmpty(i);let l=K.Location.create(r,t),u=ci.get(r).value,c=u.unitsFeatures.get(t.id),m=u.unitsContacts.get(t.id),{x:d,y:p,z:h,members:f,offsets:y,types:g}=c,{edgeCount:x,a:S,b:I,edgeProps:{flag:v,type:A}}=m,{sizeFactor:_,ignoreHydrogens:T,ignoreHydrogensVariant:w,parentDisplay:D}=o;if(!x)return ft.createEmpty(i);let{elements:M,conformation:E}=t,R=b(),k=b(),B=b(),L={linkCount:x*2,position:(Q,O,q)=>{let X=A[q];if((!T||w!=="all")&&(X===4||X===8&&w!=="non-polar")){let F=f[y[S[q]]],Y=f[y[I[q]]];E.invariantPosition(M[F],k),E.invariantPosition(M[Y],B);let $=b.distance(k,B),ce=$;b.copy(Q,k),b.copy(O,B);let ie=X===4?4:9;g[y[S[q]]]===ie?Hk(t,F,(W,N)=>{if(Mc(r,t,M[N],"all")){E.invariantPosition(M[N],R);let j=b.distance(R,B);j<$&&($=j,b.copy(Q,R))}}):Hk(t,Y,(W,N)=>{if(Mc(r,t,M[N],"all")){E.invariantPosition(M[N],R);let j=b.distance(R,k);j<ce&&(ce=j,b.copy(O,R))}})}else b.set(Q,d[S[q]],p[S[q]],h[S[q]]),b.set(O,d[I[q]],p[I[q]],h[I[q]])},style:Q=>1,radius:Q=>{l.element=M[f[y[S[Q]]]];let O=n.size.size(l);l.element=M[f[y[I[Q]]]];let q=n.size.size(l);return Math.min(O,q)*_},ignore:Q=>{if(v[Q]===1)return!0;if(s)if(D==="stub"){let O=S[Q];for(let q=y[O],X=y[O+1];q<X;++q){let F=M[f[y[q]]];if(!Be.has(s.elements,F))return!0}}else if(D==="full"||D==="between"){let O=!1,q=!1,X=S[Q];for(let Y=y[X],$=y[X+1];Y<$;++Y){let ce=M[f[y[Y]]];Be.has(s.elements,ce)||(O=!0)}let F=I[Q];for(let Y=y[F],$=y[F+1];Y<$;++Y){let ce=M[f[y[Y]]];Be.has(s.elements,ce)||(q=!0)}return D==="full"?O&&q:O===q}else Rr(D);return!1}},{mesh:V,boundingSphere:U}=Oc(e,L,o,i);if(U)V.setBoundingSphere(U);else if(V.triangleCount>0){let Q=ye.expand(ye(),(s??t).boundary.sphere,1*_);V.setBoundingSphere(Q)}return V}var ZW={...ro,...hd,...bF};function xAe(e){return So({defaultProps:C.getDefaultValues(ZW),createGeometry:ult,createLocationIterator:dlt,getLoci:clt,eachLocation:mlt,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.parentDisplay!==n.parentDisplay;let l=ci.get(a.structure).version;t.info.interactionsHash!==l&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=l)}},e)}function clt(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:a,group:s}=t,l=a.unitMap.get(s.units[o].id),u=ci.get(a).value,{a:c,b:m}=u.unitsContacts.get(l.id);return Df.Loci(a,u,[{unitA:l,indexA:c[i],unitB:l,indexB:m[i]},{unitA:l,indexA:m[i],unitB:l,indexB:c[i]}])}return dr}var QW=new Set;function mlt(e,t,r,n){let o=!1;if(Df.isLoci(e)){let{structure:i,group:a}=t;if(!De.areEquivalent(e.data.structure,i))return!1;let s=ci.get(i).value;if(e.data.interactions!==s)return!1;let l=a.units[0],u=s.unitsContacts.get(l.id),c=u.edgeCount*2;for(let m of e.elements){if(m.unitA!==m.unitB)continue;let d=a.unitIndexMap.get(m.unitA.id);if(d!==void 0){let p=u.getDirectedEdgeIndex(m.indexA,m.indexB);p!==-1&&r(xe.ofSingleton(d*c+p))&&(o=!0)}}}else if(K.Loci.is(e)){let{structure:i,group:a}=t;if(!De.areEquivalent(e.structure,i))return!1;let s=ci.get(i).value;if(!s)return!1;let l=a.units[0],u=s.unitsContacts.get(l.id),c=s.unitsFeatures.get(l.id),m=u.edgeCount*2,{offset:d}=u,{offsets:p,indices:h}=c.elementsIndex,{members:f,offsets:y}=c;for(let g of e.elements){let x=a.unitIndexMap.get(g.unit.id);x!==void 0&&(Se.forEach(g.indices,S=>{for(let I=p[S],v=p[S+1];I<v;++I){let A=h[I];for(let _=d[A],T=d[A+1];_<T;++_)QW.add(_)}}),QW.forEach(S=>{if(n){let I=u.a[S];for(let A=y[I],_=y[I+1];A<_;++A)if(!Se.has(g.indices,f[A]))return;let v=u.b[S];for(let A=y[v],_=y[v+1];A<_;++A)if(!Se.has(g.indices,f[A]))return}r(xe.ofSingleton(x*m+S))&&(o=!0)}),QW.clear())}}return o}function dlt(e){let{structure:t,group:r}=e,n=r.units[0],o=ci.get(t).value,i=o.unitsContacts.get(n.id),a=i.edgeCount*2,s=r.units.length,l=Df.Location(o,t),{element:u}=l;return Kr(a,s,1,(m,d)=>{let p=r.units[d];return u.unitA=p,u.indexA=i.a[m],u.unitB=p,u.indexB=i.b[m],l})}function plt(e,t,r,n,o){if(!t.hasAtomic)return ft.createEmpty(o);let i=K.Location.create(t),a=ci.get(t).value,{contacts:s,unitsFeatures:l}=a,{edgeCount:u,edges:c}=s,{sizeFactor:m,ignoreHydrogens:d,ignoreHydrogensVariant:p,parentDisplay:h}=n;if(!u)return ft.createEmpty(o);let{child:f}=t,y=b(),g=b(),x=b(),S={linkCount:u,position:(A,_,T)=>{let{unitA:w,indexA:D,unitB:M,indexB:E,props:{type:R}}=c[T],k=l.get(w),B=l.get(M),L=t.unitMap.get(w),V=t.unitMap.get(M);if((!d||p!=="all")&&(R===4||R===8&&p!=="non-polar")){let U=k.members[k.offsets[D]],Q=B.members[B.offsets[E]];L.conformation.position(L.elements[U],g),V.conformation.position(V.elements[Q],x);let O=b.distance(g,x),q=O;b.copy(A,g),b.copy(_,x);let X=R===4?4:9;k.types[k.offsets[D]]===X?us(t,L,U,(Y,$)=>{let ce=Y.elements[$];if(Mc(t,Y,ce,"all")){Y.conformation.position(ce,y);let ie=b.distance(y,x);ie<O&&(O=ie,b.copy(A,y))}}):us(t,V,Q,(Y,$)=>{let ce=Y.elements[$];if(Mc(t,Y,ce,"all")){Y.conformation.position(ce,y);let ie=b.distance(y,g);ie<q&&(q=ie,b.copy(_,y))}})}else b.set(A,k.x[D],k.y[D],k.z[D]),b.transformMat4(A,A,L.conformation.operator.matrix),b.set(_,B.x[E],B.y[E],B.z[E]),b.transformMat4(_,_,V.conformation.operator.matrix)},style:A=>1,radius:A=>{let _=c[A],T=l.get(_.unitA);i.unit=t.unitMap.get(_.unitA),i.element=i.unit.elements[T.members[T.offsets[_.indexA]]];let w=r.size.size(i),D=l.get(_.unitB);i.unit=t.unitMap.get(_.unitB),i.element=i.unit.elements[D.members[D.offsets[_.indexB]]];let M=r.size.size(i);return Math.min(w,M)*m},ignore:A=>{if(c[A].props.flag===1)return!0;if(f){let _=c[A];if(h==="stub"){let T=f.unitMap.get(_.unitA);if(!T)return!0;let w=t.unitMap.get(_.unitA),{offsets:D,members:M}=l.get(_.unitA);for(let E=D[_.indexA],R=D[_.indexA+1];E<R;++E){let k=w.elements[M[E]];if(!Be.has(T.elements,k))return!0}}else if(h==="full"||h==="between"){let T=!1,w=!1,D=f.unitMap.get(_.unitA);if(!D)T=!0;else{let E=t.unitMap.get(_.unitA),{offsets:R,members:k}=l.get(_.unitA);for(let B=R[_.indexA],L=R[_.indexA+1];B<L;++B){let V=E.elements[k[B]];Be.has(D.elements,V)||(T=!0)}}let M=f.unitMap.get(_.unitB);if(!M)w=!0;else{let E=t.unitMap.get(_.unitB),{offsets:R,members:k}=l.get(_.unitB);for(let B=R[_.indexB],L=R[_.indexB+1];B<L;++B){let V=E.elements[k[B]];Be.has(M.elements,V)||(w=!0)}}return h==="full"?T&&w:T===w}else Rr(h)}return!1}},{mesh:I,boundingSphere:v}=Oc(e,S,n,o);if(v)I.setBoundingSphere(v);else if(I.triangleCount>0){let{child:A}=t,_=ye.expand(ye(),(A??t).boundary.sphere,1*m);I.setBoundingSphere(_)}return I}var YW={...Qu,...hd,...bF};function CAe(e){return cs({defaultProps:C.getDefaultValues(YW),createGeometry:plt,createLocationIterator:glt,getLoci:flt,eachLocation:hlt,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.parentDisplay!==n.parentDisplay;let l=ci.get(a).version;t.info.interactionsHash!==l&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=l)}},e)}function flt(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let i=ci.get(t).value,a=i.contacts.edges[o],s=t.unitMap.get(a.unitA),l=t.unitMap.get(a.unitB);return Df.Loci(t,i,[{unitA:s,indexA:a.indexA,unitB:l,indexB:a.indexB},{unitA:l,indexA:a.indexB,unitB:s,indexB:a.indexA}])}return dr}var xF=new Map,qW=new Set;function hlt(e,t,r,n){let o=!1;if(Df.isLoci(e)){if(!De.areEquivalent(e.data.structure,t))return!1;let i=ci.get(t).value;if(e.data.interactions!==i)return!1;let{contacts:a}=i;for(let s of e.elements){let l=a.getEdgeIndex(s.indexA,s.unitA.id,s.indexB,s.unitB.id);l!==-1&&r(xe.ofSingleton(l))&&(o=!0)}}else if(K.Loci.is(e)){if(!De.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;let i=ci.get(t).value;if(!i)return!1;let{contacts:a,unitsFeatures:s}=i;for(let l of e.elements)xF.set(l.unit.id,l.indices);for(let l of e.elements){let{unit:u}=l;me.isAtomic(u)&&Se.forEach(l.indices,c=>{for(let m of a.getContactIndicesForElement(c,u))qW.add(m)})}qW.forEach(l=>{if(n){let{indexA:u,unitA:c,indexB:m,unitB:d}=a.edges[l],p=xF.get(c),h=xF.get(d);if(!p||!h)return;let{offsets:f,members:y}=s.get(c);for(let S=f[u],I=f[u+1];S<I;++S)if(!Se.has(p,y[S]))return;let{offsets:g,members:x}=s.get(d);for(let S=g[m],I=g[m+1];S<I;++S)if(!Se.has(h,x[S]))return}r(xe.ofSingleton(l))&&(o=!0)}),xF.clear(),qW.clear()}return o}function glt(e){let t=ci.get(e).value,{contacts:r}=t,n=r.edgeCount,o=1,i=Df.Location(t,e),{element:a}=i;return Kr(n,o,1,l=>{let u=r.edges[l];return a.unitA=e.unitMap.get(u.unitA),a.indexA=u.indexA,a.unitB=e.unitMap.get(u.unitB),a.indexB=u.indexB,i},!0)}var SAe={"intra-unit":(e,t)=>Qn("Intra-unit interactions cylinder",e,t,xAe),"inter-unit":(e,t)=>to("Inter-unit interactions cylinder",e,t,CAe)},vAe={...ZW,...YW,unitKinds:Ry(["atomic"]),sizeFactor:C.Numeric(.2,{min:.01,max:1,step:.01}),visuals:C.MultiSelect(["intra-unit","inter-unit"],C.objectToOptions(SAe))};function ylt(e,t){return C.clone(vAe)}function blt(e,t){return Vt.createMulti("Interactions",e,t,Gn,SAe)}var _A={name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:blt,getParams:ylt,defaultValues:C.getDefaultValues(vAe),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0&&ci.isApplicable(e),ensureCustomProperties:{attach:(e,t)=>ci.attach(e,t,void 0,!0),detach:e=>ci.ref(e,!1)},getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};var KW=13421772,xlt="Assigns colors according the interaction type of a link.",Ku={HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404},Clt=[["Hydrogen Bond",Ku.HydrogenBond],["Hydrophobic",Ku.Hydrophobic],["Halogen Bond",Ku.HalogenBond],["Ionic",Ku.Ionic],["Metal Coordination",Ku.MetalCoordination],["Cation Pi",Ku.CationPi],["Pi Stacking",Ku.PiStacking],["Weak HydrogenBond",Ku.WeakHydrogenBond]];function IAe(e){switch(e){case 4:return Ku.HydrogenBond;case 6:return Ku.Hydrophobic;case 5:return Ku.HalogenBond;case 1:return Ku.Ionic;case 7:return Ku.MetalCoordination;case 2:return Ku.CationPi;case 3:return Ku.PiStacking;case 8:return Ku.WeakHydrogenBond;case 0:return KW}}var AAe={};function Slt(e){return AAe}function TAe(e,t){let r,n=e.structure?ci.get(e.structure):void 0,o=n?Du(n.id,n.version):-1;return n&&n.value?r=i=>{if(Df.isLocation(i)){let{unitsContacts:a,contacts:s}=i.data.interactions,{unitA:l,unitB:u,indexA:c,indexB:m}=i.element;if(l===u){let d=a.get(l.id),p=d.getDirectedEdgeIndex(c,m);return IAe(d.edgeProps.type[p])}else{let d=s.getEdgeIndex(c,l.id,m,u.id);return IAe(s.edges[d].props.type)}}return KW}:r=()=>KW,{factory:TAe,granularity:"group",color:r,props:t,contextHash:o,description:xlt,legend:Ru(Clt)}}var bR={name:"interaction-type",label:"Interaction Type",category:ur.Misc,factory:TAe,getParams:Slt,defaultValues:C.getDefaultValues(AAe),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?ci.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&ci.ref(e.structure,!1)}};function RA(e,t,r={}){let n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?vlt(e,t||De.Empty,r):_Ae(e,t||De.Empty,r)}function PAe(e,t){let{themes:r}=e.representation.structure;return t?r.colorThemeRegistry.getApplicableTypes({structure:t}):r.colorThemeRegistry.types}function xR(e,t,r,n,o){let{registry:i,themes:a}=e.representation.structure,s=i.get(r||i.default.name),l=a.colorThemeRegistry.get(n||s.defaultColorTheme.name),u=C.getDefaultValues(l.getParams({structure:t||De.Empty}));return l.name===s.defaultColorTheme.name&&Object.assign(u,s.defaultColorTheme.props),{name:l.name,params:Object.assign(u,o)}}function JW(e,t,r,n,o){let{registry:i,themes:a}=e.representation.structure,s=i.get(r||i.default.name),l=a.sizeThemeRegistry.get(n||s.defaultSizeTheme.name),u=C.getDefaultValues(l.getParams({structure:t||De.Empty}));return l.name===s.defaultSizeTheme.name&&Object.assign(u,s.defaultSizeTheme.props),{name:l.name,params:Object.assign(u,o)}}function vlt(e,t,r){let n=r.type&&e.representation.structure.registry.get(r.type)||e.representation.structure.registry.default.provider,o=r.color&&e.representation.structure.themes.colorThemeRegistry.get(r.color)||e.representation.structure.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.structure.themes.sizeThemeRegistry.get(r.size)||e.representation.structure.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return _Ae(e,t,{type:n,typeParams:r.typeParams,color:o,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function _Ae(e,t,r={}){let{themes:n}=e.representation.structure,o={structure:t},i=r.type||e.representation.structure.registry.default.provider,a=C.getDefaultValues(i.getParams(n,t)),s=Object.assign(a,r.typeParams),l=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),u=C.getDefaultValues(l.getParams(o));l.name===i.defaultColorTheme.name&&Object.assign(u,i.defaultColorTheme.props);let c=Object.assign(u,r.colorParams),m=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),d=C.getDefaultValues(m.getParams(o));m.name===i.defaultSizeTheme.name&&Object.assign(d,i.defaultSizeTheme.props);let p=Object.assign(d,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:l.name,params:c},sizeTheme:{name:m.name,params:p}}}var $W={};Bi($W,{ApplyAction:()=>BAe,ClearHighlights:()=>OAe,Highlight:()=>VAe,RemoveObject:()=>kAe,SetCurrentObject:()=>EAe,Snapshots:()=>GAe,SyncBehaviors:()=>wAe,ToggleExpanded:()=>LAe,ToggleVisibility:()=>FAe,Update:()=>MAe,registerDefault:()=>Alt,setSubtreeVisibility:()=>Ef});function RAe(){let e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),o=e.getHours(),i=e.getMinutes(),a=e.getSeconds();return t+"-"+r+"-"+n+"-"+o+"-"+i+"-"+a}function Ilt(e){window.open(e,"_blank")||(window.location.href=e)}function DAe(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{let r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(r)}}function DA(e,t="download"){if(e)if("download"in HTMLAnchorElement.prototype){let r=document.createElement("a");r.download=t,r.rel="noopener",typeof e=="string"?(r.href=e,DAe(r)):(r.href=URL.createObjectURL(e),setTimeout(()=>URL.revokeObjectURL(r.href),4e4),setTimeout(()=>DAe(r)))}else if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{let r=window.navigator.userAgent,n=/Safari/i.test(r),o=/CriOS\/[\d]+/.test(r),i=a=>{Ilt(o?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((n||o)&&FileReader)if(e instanceof Blob){let a=new FileReader;a.onloadend=()=>i(a.result),a.readAsDataURL(e)}else i(e);else{let a=URL.createObjectURL(typeof e=="string"?new Blob([e]):e);location.href=a,setTimeout(()=>URL.revokeObjectURL(a),4e4)}}}function nC(e,t){return`${e}${e[e.length-1]==="/"||t[0]==="/"?"":"/"}${t}`}function Alt(e){wAe(e),EAe(e),MAe(e),BAe(e),kAe(e),LAe(e),FAe(e),VAe(e),OAe(e),GAe(e)}function wAe(e){e.state.events.object.created.subscribe(t=>{re.isBehavior(t.obj)&&t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(t=>{re.isBehavior(t.obj)&&(t.obj.data.unregister?.(),t.obj.data.dispose?.())}),e.state.events.object.updated.subscribe(t=>{t.action==="recreate"&&(t.oldObj&&re.isBehavior(t.oldObj)&&(t.oldObj.data.unregister?.(),t.oldObj.data.dispose?.()),t.obj&&re.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function EAe(e){st.State.SetCurrentObject.subscribe(e,({state:t,ref:r})=>t.setCurrent(r))}function MAe(e){st.State.Update.subscribe(e,({state:t,tree:r,options:n})=>e.runTask(t.updateTree(r,n)))}function BAe(e){st.State.ApplyAction.subscribe(e,({state:t,action:r,ref:n})=>e.runTask(t.applyAction(r.action,r.params,n)))}function kAe(e){function t(r,n){let o=r.build().delete(n);return e.runTask(r.updateTree(o))}st.State.RemoveObject.subscribe(e,({state:r,ref:n,removeParentGhosts:o})=>{if(o){let i=r.tree,a=i.transforms.get(n);if(a.parent===n)return t(r,n);for(;;){let s=i.children.get(a.parent);if(a.parent===a.ref||s.size>1)return t(r,a.ref);let l=i.transforms.get(a.parent);if(!l.state.isGhost)return t(r,a.ref);a=l}}else return t(r,n)})}function LAe(e){st.State.ToggleExpanded.subscribe(e,({state:t,ref:r})=>t.updateCellState(r,({isCollapsed:n})=>({isCollapsed:!n})))}function FAe(e){st.State.ToggleVisibility.subscribe(e,({state:t,ref:r})=>Ef(t,r,!t.cells.get(r).state.isHidden))}function Ef(e,t,r){zo.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:r},Tlt)}function Tlt(e,t,r){r.state.updateCellState(e.ref,{isHidden:r.value})}function VAe(e){st.Interactivity.Object.Highlight.subscribe(e,({state:t,ref:r})=>{if(!e.canvas3d||e.isBusy)return;e.managers.interactivity.lociHighlights.clearHighlights();let n=typeof r=="string"?[r]:r;for(let o of n){let i=t.cells.get(o);if(i){if(re.Molecule.Structure.is(i.obj))e.managers.interactivity.lociHighlights.highlight({loci:De.Loci(i.obj.data)},!1);else if(i&&re.isRepresentation3D(i.obj)){let{repr:a}=i.obj.data;for(let s of a.getAllLoci())e.managers.interactivity.lociHighlights.highlight({loci:s,repr:a},!1)}else if(re.Molecule.Structure.Selections.is(i.obj))for(let a of i.obj.data)e.managers.interactivity.lociHighlights.highlight({loci:a.loci},!1)}}})}function OAe(e){st.Interactivity.ClearHighlights.subscribe(e,()=>{e.managers.interactivity.lociHighlights.clearHighlights()})}function GAe(e){e.config.set(Lr.State.CurrentServer,e.config.get(Lr.State.DefaultServer)),st.State.Snapshots.Clear.subscribe(e,()=>{e.managers.snapshot.clear()}),st.State.Snapshots.Remove.subscribe(e,({id:t})=>{e.managers.snapshot.remove(t)}),st.State.Snapshots.Add.subscribe(e,async({key:t,name:r,description:n,descriptionFormat:o,params:i})=>{let a=e.state.getSnapshot(i),s=i?.image??e.state.snapshotParams.value.image?await pp.getCanvasImageAsset(e,`${a.id}-image.png`):void 0,l=pp.Entry(a,{key:t,name:r,description:n,descriptionFormat:o,image:s});e.managers.snapshot.add(l)}),st.State.Snapshots.Replace.subscribe(e,async({id:t,params:r})=>{let n=e.state.getSnapshot(r),o=r?.image??e.state.snapshotParams.value.image?await pp.getCanvasImageAsset(e,`${n.id}-image.png`):void 0;e.managers.snapshot.replace(t,e.state.getSnapshot(r),{image:o})}),st.State.Snapshots.Move.subscribe(e,({id:t,dir:r})=>{e.managers.snapshot.move(t,r)}),st.State.Snapshots.Apply.subscribe(e,({id:t})=>{let r=e.managers.snapshot.setCurrent(t);if(r)return e.state.setSnapshot(r)}),st.State.Snapshots.Upload.subscribe(e,async({name:t,description:r,playOnLoad:n,serverUrl:o,params:i})=>fetch(nC(o,`set?name=${encodeURIComponent(t||"")}&description=${encodeURIComponent(r||"")}`),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(await e.managers.snapshot.getStateSnapshot({name:t,description:r,playOnLoad:n}))})),st.State.Snapshots.Fetch.subscribe(e,async({url:t})=>{let r=await e.runTask(e.fetch({url:t,type:"json"}));await e.managers.snapshot.setStateSnapshot(r.data)}),st.State.Snapshots.DownloadToFile.subscribe(e,async({name:t,type:r,params:n})=>{let o=`mol-star_state_${t||RAe()}.${r==="json"?"molj":"molx"}`,i=await e.managers.snapshot.serialize({type:r,params:n});DA(i,`${o}`)}),st.State.Snapshots.OpenFile.subscribe(e,({file:t})=>e.managers.snapshot.open(t)),st.State.Snapshots.OpenUrl.subscribe(e,async({url:t,type:r})=>{let n=await e.runTask(e.fetch({url:t,type:"binary"}));return e.managers.snapshot.open(new File([n],`state.${r}`))})}var tX={};Bi(tX,{SyncRepresentationToCanvas:()=>UAe,SyncStructureRepresentation3DState:()=>NAe,UpdateRepresentationVisibility:()=>zAe,registerDefault:()=>Plt});function Plt(e){UAe(e),NAe(e),zAe(e)}function UAe(e){let t=e.state.data.events;t.object.created.subscribe(r=>{re.isRepresentation3D(r.obj)&&(eX(r.state.cells.get(r.ref),r.obj.data.repr),r.obj.data.repr.setState({syncManually:!0}),e.canvas3d?.add(r.obj.data.repr))}),t.object.updated.subscribe(r=>{r.oldObj&&re.isRepresentation3D(r.oldObj)&&(e.canvas3d?.remove(r.oldObj.data.repr),r.oldObj.data.repr.destroy()),re.isRepresentation3D(r.obj)&&(eX(r.state.cells.get(r.ref),r.obj.data.repr),r.action==="recreate"&&r.obj.data.repr.setState({syncManually:!0}),e.canvas3d?.add(r.obj.data.repr))}),t.object.removed.subscribe(r=>{re.isRepresentation3D(r.obj)&&(e.canvas3d?.remove(r.obj.data.repr),r.obj.data.repr.destroy())})}function NAe(e){let t=e.state.data.events;t.object.created.subscribe(r=>{if(!re.Molecule.Structure.Representation3DState.is(r.obj))return;let n=r.obj.data;n.repr.setState(n.state),e.canvas3d?.update(n.repr)}),t.object.updated.subscribe(r=>{if(!re.Molecule.Structure.Representation3DState.is(r.obj))return;let n=r.obj.data;n.repr.setState(n.state),e.canvas3d?.update(n.repr)}),t.object.removed.subscribe(r=>{if(!re.Molecule.Structure.Representation3DState.is(r.obj))return;let n=r.obj.data;n.repr.setState(n.initialState),e.canvas3d?.update(n.repr)})}function zAe(e){e.state.data.events.cell.stateUpdated.subscribe(t=>{let r=t.state.cells.get(t.ref);re.isRepresentation3D(r.obj)&&eX(r,r.obj.data.repr)&&e.canvas3d?.syncVisibility()})}function eX(e,t){return t.state.visible===!!e.state.isHidden?(t.setState({visible:!e.state.isHidden}),!0):!1}var rX={};Bi(rX,{Focus:()=>WAe,FocusObject:()=>XAe,OrientAxes:()=>QAe,Reset:()=>HAe,ResetAxes:()=>ZAe,SetSnapshot:()=>jAe,registerDefault:()=>_lt});function _lt(e){HAe(e),WAe(e),XAe(e),jAe(e),QAe(e),ZAe(e)}function HAe(e){st.Camera.Reset.subscribe(e,t=>{e.managers.camera.reset(t?.snapshot,t?.durationMs)})}function jAe(e){st.Camera.SetSnapshot.subscribe(e,({snapshot:t,durationMs:r})=>{e.managers.camera.setSnapshot(t,r)})}function WAe(e){st.Camera.Focus.subscribe(e,({center:t,radius:r,durationMs:n})=>{e.managers.camera.focusSphere({center:t,radius:r},{durationMs:n}),e.events.canvas3d.settingsUpdated.next(void 0)})}function XAe(e){st.Camera.FocusObject.subscribe(e,async t=>{e.managers.camera.focusObject(t)})}function QAe(e){st.Camera.OrientAxes.subscribe(e,({structures:t,durationMs:r})=>{e.managers.camera.orientAxes(t,r)})}function ZAe(e){st.Camera.ResetAxes.subscribe(e,({durationMs:t})=>{e.managers.camera.resetAxes(t)})}var nX={};Bi(nX,{Canvas3DSetSettings:()=>qAe,registerDefault:()=>Rlt});function Rlt(e){qAe(e)}function qAe(e){st.Canvas3D.ResetSettings.subscribe(e,()=>{e.canvas3d?.setProps(eR),e.events.canvas3d.settingsUpdated.next(void 0)}),st.Canvas3D.SetSettings.subscribe(e,t=>{e.canvas3d&&(e.canvas3d?.setProps(t.settings),e.events.canvas3d.settingsUpdated.next(void 0))})}var iX={};Bi(iX,{DefaultFocusLociBindings:()=>KAe,DefaultLociLabelProvider:()=>Blt,DefaultSelectLociBindings:()=>YAe,FocusLoci:()=>LS,HighlightLoci:()=>Elt,SelectLoci:()=>oX});var Oy=yu,Yh=Ql,Gy=_t.Trigger,Dlt={hoverHighlightOnly:_t([Gy(Oy.Flag.None)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:_t([Gy(Oy.Flag.None,Yh.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},wlt={bindings:C.Value(Dlt,{isHidden:!0}),ignore:C.Value([],{isHidden:!0}),preferAtoms:C.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:C.Boolean(!0)},Elt=qr.create({name:"representation-highlight-loci",category:"interaction",ctor:class extends qr.Handler{constructor(){super(...arguments);this.lociMarkProvider=(t,r)=>{!this.ctx.canvas3d||!this.params.mark||this.ctx.canvas3d.mark(t,r)}}getLoci(t){return this.params.preferAtoms&&Ct.isLoci(t)&&t.bonds.length===2?Ct.toFirstStructureElementLoci(t):t}register(){this.subscribeObservable(this.ctx.behaviors.interaction.hover,({current:t,buttons:r,modifiers:n})=>{if(!this.ctx.canvas3d||this.ctx.isBusy)return;let o=this.getLoci(t.loci);if(this.params.ignore.includes(o.kind)){this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:t.repr,loci:dr});return}let i=!1;_t.match(this.params.bindings.hoverHighlightOnly,r,n)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:o}),i=!0),_t.match(this.params.bindings.hoverHighlightOnlyExtend,r,n)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:o}),i=!0),i||this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:t.repr,loci:dr})}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)}unregister(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)}},params:()=>wlt,display:{name:"Highlight Loci on Canvas"}}),YAe={clickSelect:_t.Empty,clickSelectOnly:_t.Empty,clickToggle:_t([Gy(Oy.Flag.Primary,Yh.create())],"Toggle selection","Click on element using ${triggers}"),clickToggleExtend:_t([Gy(Oy.Flag.Primary,Yh.create({shift:!0}))],"Toggle extended selection","Click on element using ${triggers} to extend selection along polymer"),clickDeselect:_t.Empty,clickDeselectAllOnEmpty:_t([Gy(Oy.Flag.Primary,Yh.create())],"Deselect all","Click on nothing using ${triggers}")},Mlt={bindings:C.Value(YAe,{isHidden:!0}),ignore:C.Value([],{isHidden:!0}),preferAtoms:C.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:C.Boolean(!0)},oX=qr.create({name:"representation-select-loci",category:"interaction",ctor:class extends qr.Handler{constructor(t,r){super(t,r);this.lociMarkProvider=(t,r)=>{!this.ctx.canvas3d||!this.params.mark||this.ctx.canvas3d.mark({loci:t.loci},r)};this.spine=new M0.Impl(t.state.data.cells)}getLoci(t){return this.params.preferAtoms&&Ct.isLoci(t)&&t.bonds.length===2?Ct.toFirstStructureElementLoci(t):t}applySelectMark(t,r){let n=this.ctx.state.data.cells.get(t);if(n&&re.isRepresentation3D(n.obj)){this.spine.current=n;let o=this.spine.getRootOfType(re.Molecule.Structure);if(o){r&&this.lociMarkProvider({loci:De.Loci(o.data)},8);let i=this.ctx.managers.structure.selection.getLoci(o.data);this.lociMarkProvider({loci:i},4)}}}register(){let t=o=>Jt.isEmpty(o),r=o=>!Jt.isEmpty(o),n=[["clickSelect",o=>this.ctx.managers.interactivity.lociSelects.select(o),r],["clickToggle",o=>this.ctx.managers.interactivity.lociSelects.toggle(o),r],["clickToggleExtend",o=>this.ctx.managers.interactivity.lociSelects.toggleExtend(o),r],["clickSelectOnly",o=>this.ctx.managers.interactivity.lociSelects.selectOnly(o),r],["clickDeselect",o=>this.ctx.managers.interactivity.lociSelects.deselect(o),r],["clickDeselectAllOnEmpty",()=>this.ctx.managers.interactivity.lociSelects.deselectAll(),t]];n.sort((o,i)=>{let a=this.params.bindings[o[0]],s=this.params.bindings[i[0]],l=a.triggers.length===0?0:ol(a.triggers.map(c=>Yh.size(c.modifiers)));return(s.triggers.length===0?0:ol(s.triggers.map(c=>Yh.size(c.modifiers))))-l}),this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:o,button:i,modifiers:a})=>{if(!this.ctx.canvas3d||this.ctx.isBusy||!this.ctx.selectionMode)return;let s=this.getLoci(o.loci);if(!this.params.ignore.includes(s.kind)){for(let[l,u,c]of n)if(_t.match(this.params.bindings[l],i,a)&&(!c||c(s))){u({repr:o.repr,loci:s});break}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,({ref:o})=>this.applySelectMark(o)),this.subscribeObservable(this.ctx.state.events.object.updated,({ref:o,obj:i,oldObj:a,oldData:s,action:l})=>{let u=this.ctx.state.data.cells.get(o);if(u&&re.Molecule.Structure.is(u.obj)){let c=i.data,m=l==="recreate"?a?.data:l==="in-place"?s:void 0;if(m&&De.areEquivalent(c,m)&&De.areHierarchiesEqual(c,m))return;let d=this.ctx.state.data.select(er.children(o).ofType(re.Molecule.Structure.Representation3D));for(let p of d)this.applySelectMark(p.transform.ref,!0)}})}unregister(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)}},params:()=>Mlt,display:{name:"Select Loci on Canvas"}}),Blt=qr.create({name:"default-loci-label-provider",category:"interaction",ctor:class{constructor(e){this.ctx=e;this.f={label:e=>{let t=[];if(K.Loci.is(e)){let r=new Set;for(let{unit:n}of e.elements){let o=K.Location.create(e.structure,n,n.elements[0]),i=qe.entity.pdbx_description(o).join(", ");r.add(i)}r.size===1&&r.forEach(n=>t.push(n))}return t.push(mp(e)),t.filter(r=>!!r).join("</br>")},group:e=>e.toString().replace(/Model [0-9]+/g,"Models"),priority:100}}register(){this.ctx.managers.lociLabels.addProvider(this.f)}unregister(){this.ctx.managers.lociLabels.removeProvider(this.f)}},display:{name:"Provide Default Loci Label"}}),KAe={clickFocus:_t([Gy(Oy.Flag.Primary,Yh.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:_t([Gy(Oy.Flag.Primary,Yh.create({control:!0})),Gy(Oy.Flag.Primary,Yh.create({meta:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusExtend:_t([Gy(Oy.Flag.Primary,Yh.create({shift:!0}))],"Representation Focus Extend","Click on element using ${triggers}"),clickFocusSelectMode:_t([],"Representation Focus (Selection Mode)","Click element using ${triggers}"),clickFocusAddSelectMode:_t([],"Representation Focus Add (Selection Mode)","Click element using ${triggers}"),clickFocusExtendSelectMode:_t([],"Representation Focus Extend (Selection Mode)","Click on element using ${triggers}")},klt={bindings:C.Value(KAe,{isHidden:!0})},LS=qr.create({name:"representation-focus-loci",category:"interaction",ctor:class extends qr.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:t,modifiers:r})=>{let{clickFocus:n,clickFocusAdd:o,clickFocusExtend:i,clickFocusSelectMode:a,clickFocusAddSelectMode:s,clickFocusExtendSelectMode:l}=this.params.bindings,u=this.ctx.selectionMode?a:n,c=_t.match(u,t,r),m=this.ctx.selectionMode?s:o,d=_t.match(m,t,r),p=this.ctx.selectionMode?l:i,h=_t.match(p,t,r);if(!c&&!d&&!h)return;let f=e.repr?.props?.snapshotKey?.trim()??"";if(!this.ctx.selectionMode&&c&&f){this.ctx.managers.snapshot.applyKey(f);return}let{granularity:y}=this.ctx.managers.interactivity.props;if(y!=="residue"&&y!=="element")return;let g=Jt.normalize(e.loci,"residue"),x=this.ctx.managers.structure.focus.current;if(x&&Jt.areEqual(x.loci,g))this.ctx.managers.structure.focus.clear();else if(c)this.ctx.managers.structure.focus.setFromLoci(g);else{h?this.ctx.managers.structure.focus.extendFromLoci(g):this.ctx.managers.structure.focus.toggleFromLoci(g);let S=this.ctx.managers.structure.focus.current?.loci;S&&this.ctx.managers.camera.focusLoci(S)}})}},params:()=>klt,display:{name:"Representation Focus Loci on Canvas"}});var lX={};Bi(lX,{CameraAxisHelper:()=>Vlt,CameraControls:()=>Glt,DefaultClickResetCameraOnEmpty:()=>aX,DefaultClickResetCameraOnEmptySelectMode:()=>sX,DefaultFocusLociBindings:()=>JAe,FocusLoci:()=>Flt});var Kh=yu,Mf=Ql,Jh=_t.Trigger,CR=_t.TriggerKey,aX=_t([Jh(Kh.Flag.Primary,Mf.create()),Jh(Kh.Flag.Secondary,Mf.create()),Jh(Kh.Flag.Primary,Mf.create({control:!0}))],"Reset camera focus","Click on nothing using ${triggers}"),sX=_t([Jh(Kh.Flag.Secondary,Mf.create()),Jh(Kh.Flag.Primary,Mf.create({control:!0}))],"Reset camera focus (Selection Mode)","Click on nothing using ${triggers}"),JAe={clickCenterFocus:_t([Jh(Kh.Flag.Primary,Mf.create()),Jh(Kh.Flag.Secondary,Mf.create()),Jh(Kh.Flag.Primary,Mf.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:_t([Jh(Kh.Flag.Secondary,Mf.create()),Jh(Kh.Flag.Primary,Mf.create({control:!0}))],"Camera center and focus (Selection Mode)","Click element using ${triggers}"),clickResetCameraOnEmpty:aX,clickResetCameraOnEmptySelectMode:sX},Llt={minRadius:C.Numeric(8,{min:1,max:50,step:1}),extraRadius:C.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:C.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:C.Value(JAe,{isHidden:!0})},Flt=qr.create({name:"camera-focus-loci",category:"interaction",ctor:class extends qr.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:t,modifiers:r})=>{if(!this.ctx.canvas3d)return;let n=this.ctx.selectionMode?this.params.bindings.clickCenterFocusSelectMode:this.params.bindings.clickCenterFocus,o=this.ctx.selectionMode?this.params.bindings.clickResetCameraOnEmptySelectMode??sX:this.params.bindings.clickResetCameraOnEmpty??aX;if(Jt.isEmpty(e.loci)&&_t.match(o,t,r)){st.Camera.Reset(this.ctx,{});return}if(_t.match(n,t,r)){let i=Jt.normalize(e.loci,this.ctx.managers.interactivity.props.granularity);this.ctx.managers.camera.focusLoci(i,this.params)}})}},params:()=>Llt,display:{name:"Camera Focus Loci on Canvas"}}),Vlt=qr.create({name:"camera-axis-helper",category:"interaction",ctor:class extends qr.Handler{register(){let e=0,t=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:r})=>{if(!this.ctx.canvas3d||!BL(r.loci))return;let n=r.loci.elements[0].groupId;if(n===0){e=0,t=0;return}let{camera:o}=this.ctx.canvas3d,i,a;if(n>=1&&n<=3){e=0,t=0;let s=b.sub(b(),o.target,o.position),l=b.cross(b(),s,o.up);a=b(),a[n-1]=1,i=b.cross(b(),a,l),b.magnitude(i)===0&&(i=s)}else e===n?t=(t+1)%2:(e=n,t=0),n===4?(a=t?b.unitX:b.unitY,i=b.negUnitZ):n===5?(a=t?b.unitX:b.unitZ,i=b.negUnitY):(a=t?b.unitY:b.unitZ,i=b.negUnitX);this.ctx.canvas3d.requestCameraReset({snapshot:(s,l)=>l.getInvariantFocus(s.boundingSphereVisible.center,s.boundingSphereVisible.radius,a,i)})})}},params:()=>({}),display:{name:"Camera Axis Helper"}}),$Ae={keySpinAnimation:_t([CR("I")],"Spin Animation","Press ${triggers}"),keyRockAnimation:_t([CR("O")],"Rock Animation","Press ${triggers}"),keyToggleFlyMode:_t([CR("Space",Mf.create({shift:!0}))],"Toggle Fly Mode","Press ${triggers}"),keyResetView:_t([CR("T")],"Reset View","Press ${triggers}"),keyGlobalIllumination:_t([CR("G")],"Global Illumination","Press ${triggers}")},Olt={bindings:C.Value($Ae,{isHidden:!0})},Glt=qr.create({name:"camera-controls",category:"interaction",ctor:class extends qr.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.key,({code:e,key:t,modifiers:r})=>{if(!this.ctx.canvas3d)return;let n={...$Ae,...this.params.bindings},o=this.ctx.canvas3d.props.trackball,i=this.ctx.canvas3d.props.illumination;if(_t.matchKey(n.keySpinAnimation,e,r,t)){let a=o.animate.name!=="spin"?"spin":"off";a==="off"?this.ctx.canvas3d.setProps({trackball:{animate:{name:a,params:{}}}}):this.ctx.canvas3d.setProps({trackball:{animate:{name:a,params:{speed:1}}}})}if(_t.matchKey(n.keyRockAnimation,e,r,t)){let a=o.animate.name!=="rock"?"rock":"off";a==="off"?this.ctx.canvas3d.setProps({trackball:{animate:{name:a,params:{}}}}):this.ctx.canvas3d.setProps({trackball:{animate:{name:a,params:{speed:.3,angle:10}}}})}if(_t.matchKey(n.keyToggleFlyMode,e,r,t)){let a=!o.flyMode;this.ctx.canvas3d.setProps({trackball:{flyMode:a}}),this.ctx.canvas3dContext?.canvas&&(this.ctx.canvas3dContext.canvas.style.cursor=a?"crosshair":"unset")}_t.matchKey(n.keyResetView,e,r,t)&&st.Camera.Reset(this.ctx,{}),_t.matchKey(n.keyGlobalIllumination,e,r,t)&&this.ctx.canvas3d.setProps({illumination:{...i,enabled:!i.enabled}})})}},params:()=>Olt,display:{name:"Camera Controls on Canvas"}});var bX={};Bi(bX,{AccessibleSurfaceArea:()=>uTe,BestDatabaseSequenceMapping:()=>hTe,CrossLinkRestraint:()=>ITe,Interactions:()=>cTe,SecondaryStructure:()=>mTe,StructureInfo:()=>eTe,ValenceModel:()=>dTe});var eTe=qr.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:class extends qr.Handler{get maxModelIndex(){let e=-1,t=this.ctx.state.data.select(er.Generators.rootsOfType(re.Molecule.Model));for(let r of t){let n=r.obj?.data&&Ft.Index.get(r.obj?.data).value;n!==void 0&&n>e&&(e=n)}return e}get maxStructureIndex(){let e=-1,t=this.ctx.state.data.select(er.Generators.rootsOfType(re.Molecule.Structure));for(let r of t){let n=r.obj?.data&&De.Index.get(r.obj?.data).value;n!==void 0&&n>e&&(e=n)}return e}get asymIdOffset(){let e=0,t=0,r=this.ctx.state.data.select(er.Generators.rootsOfType(re.Molecule.Model));for(let n of r){let o=n.obj?.data;if(o){let i=Ft.AsymIdCount.get(o),a=Ft.AsymIdOffset.get(o).value;i!==void 0&&a!==void 0&&(e=Math.max(e,a.auth+i.auth),t=Math.max(t,a.label+i.label))}}return{auth:e,label:t}}setModelMaxIndex(){let e=this.maxModelIndex,t=this.ctx.state.data.select(er.Generators.rootsOfType(re.Molecule.Model));for(let r of t){let n=r.obj?.data;n&&Ft.MaxIndex.get(n).value!==e&&Ft.MaxIndex.set(n,{value:e},e)}}setStructureMaxIndex(){let e=this.maxModelIndex,t=this.ctx.state.data.select(er.Generators.rootsOfType(re.Molecule.Structure));for(let r of t){let n=r.obj?.data;n&&De.MaxIndex.get(n).value!==e&&De.MaxIndex.set(n,{value:e},e)}}handleModel(e,t){if(Ft.Index.get(e).value===void 0){let n=(t&&Ft.Index.get(t).value)??this.maxModelIndex+1;Ft.Index.set(e,{value:n},n)}if(Ft.AsymIdOffset.get(e).value===void 0){let n=(t&&Ft.AsymIdOffset.get(t).value)??{...this.asymIdOffset};Ft.AsymIdOffset.set(e,{value:n},n)}}handleStructure(e,t){if(e.parent!==void 0||De.Index.get(e).value!==void 0)return;let n=(t&&De.Index.get(t).value)??this.maxStructureIndex+1;De.Index.set(e,{value:n},n)}handle(e,t,r){re.Molecule.Structure.is(t)?!this.ctx.state.data.tree.transforms.get(e).transformer.definition.isDecorator&&t.data.parent===void 0&&this.handleStructure(t.data,r?.data):re.Molecule.Model.is(t)&&(this.ctx.state.data.tree.transforms.get(e).transformer.definition.isDecorator||this.handleModel(t.data,r?.data))}register(){this.ctx.customModelProperties.register(Ft.AsymIdOffset,!0),this.ctx.customModelProperties.register(Ft.Index,!0),this.ctx.customModelProperties.register(Ft.MaxIndex,!0),this.ctx.customStructureProperties.register(De.Index,!0),this.ctx.customStructureProperties.register(De.MaxIndex,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,e=>{this.handle(e.ref,e.obj),this.setModelMaxIndex(),this.setStructureMaxIndex()}),this.subscribeObservable(this.ctx.state.data.events.object.updated,e=>{this.handle(e.ref,e.obj,e.oldObj)})}unregister(){this.ctx.customModelProperties.unregister(Ft.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(Ft.Index.descriptor.name),this.ctx.customModelProperties.unregister(Ft.MaxIndex.descriptor.name),this.ctx.customStructureProperties.unregister(De.Index.descriptor.name),this.ctx.customStructureProperties.unregister(De.MaxIndex.descriptor.name)}}});var Bf=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],CF={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165},tTe=121;function rTe(e){let{key:t}=qe.residue,{type_symbol:r,label_atom_id:n,label_comp_id:o}=qe.atom,{structure:i,atomRadiusType:a,serialResidueIndex:s}=e,l=K.Location.create(i),u=0,c=0,m=-1;l.structure=i;for(let d=0,p=0,h=i.units.length;d<h;++d){let f=i.units[d],{elements:y}=f;l.unit=f,u=-1;for(let g=0,x=y.length;g<x;++g){let S=y[g],I=p+g;l.element=S,c=t(l),u!==c&&++m,u=c;let v=r(l),A=om(v);if(jd(A)){a[I]=0,s[I]=-1;continue}let _=n(l),T=Fv(f,S);if(T===2||!e.nonPolymer&&!tx(T)){a[I]=0,s[I]=-1;continue}let w=o(l);if(e.traceOnly&&(_!=="CA"&&_!=="BB"||!CF[w])){a[I]=0,s[I]=m;continue}Zi(T)?a[I]=Nlt(_,v,w):T===5?a[I]=Ult(_,v,w):a[I]=uX(v),s[I]=m}p+=y.length}}function Ult(e,t,r){switch(t){case"O":return 5;case"S":return 6;case"N":return e==="NZ"?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(r){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return e==="CD"?1:2}}}return uX(t)}function Nlt(e,t,r){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return uX(t)}function uX(e){let t=hh(e),r=Bf.indexOf(t);return r===-1&&(r=Bf.length,Bf[r]=t),r}var nTe=5e3;async function oTe(e,t){let{atomRadiusType:r}=t;for(let n=0;n<r.length;n+=nTe)e.shouldUpdate&&await e.update({message:"Computing per residue surface accessibility...",current:n,max:r.length}),zlt(t,n,Math.min(n+nTe,r.length))}function zlt(e,t,r){let{structure:n,atomRadiusType:o,serialResidueIndex:i,area:a,spherePoints:s,scalingConstant:l,maxLookupRadius:u,probeSize:c}=e,{lookup3d:m,serialMapping:d,unitIndexMap:p,units:h}=n,{cumulativeUnitElementCount:f,elementIndices:y,unitIndices:g}=d;for(let x=t;x<r;++x){let S=Bf[o[x]];if(S===Bf[0])continue;let I=h[g[x]],v=y[x],A=I.conformation.x(v),_=I.conformation.y(v),T=I.conformation.z(v),{count:w,units:D,indices:M,squaredDistances:E}=m.find(A,_,T,u),R=c+S,k=c+R,B=[];for(let V=0;V<w;++V){let U=D[V],Q=f[p.get(U.id)]+M[V],O=y[Q],q=Bf[o[Q]];if(I===U&&v===O||q===Bf[0])continue;let X=c+q;if(E[V]<(k+q)*(k+q)){let F=y[Q];B[B.length]=[E[V],(E[V]+R*R-X*X)/(2*R),U.conformation.x(F)-A,U.conformation.y(F)-_,U.conformation.z(F)-T]}}B.sort((V,U)=>V[0]-U[0]);let L=0;e:for(let V=0;V<s.length;++V){let[U,Q,O]=s[V];for(let q=0;q<B.length;++q){let[,X,F,Y,$]=B[q];if(U*F+Q*Y+O*$>X)continue e}++L}a[i[x]]+=l*L*R*R}}var cX={numberOfSpherePoints:C.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:C.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:C.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:C.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})};var Uy;(c=>{function e(m,d={}){let p={...C.getDefaultValues(cX),...d};return Pe.create("Compute Accessible Surface Area",async h=>await t(h,m,p))}c.compute=e;async function t(m,d,p){let h=r(d,p);rTe(h),await oTe(m,h);let{area:f,serialResidueIndex:y}=h;return{area:f,serialResidueIndex:y}}function r(m,d){let{elementCount:p,atomicResidueCount:h}=m,{probeSize:f,nonPolymer:y,traceOnly:g,numberOfSpherePoints:x}=d;return{structure:m,probeSize:f,nonPolymer:y,traceOnly:g,spherePoints:n(x),scalingConstant:4*Math.PI/x,maxLookupRadius:2*d.probeSize+2*Bf[2],atomRadiusType:new Int8Array(p),serialResidueIndex:new Int32Array(p),area:new Float32Array(h)}}function n(m){let d=[],p=Math.PI*(3-Math.sqrt(5)),h=2/m;for(let f=0;f<m;++f){let y=f*h-1+h/2,g=Math.sqrt(1-y*y),x=f*p;d[d.length]=b.create(Math.cos(x)*g,y,Math.sin(x)*g)}return d}let o;(h=>(h[h.NA=0]="NA",h[h.Buried=1]="Buried",h[h.Accessible=2]="Accessible"))(o=c.Flags||={}),c.Flag={NA:0,Buried:1,Accessible:2};function a(m,d){let p=CF[m]||tTe;return d/p}c.normalize=a;function s(m,d){let{area:p,serialResidueIndex:h}=d,f=h[Be.indexOf(Be.ofSortedArray(m.structure.root.serialMapping.elementIndices),m.element)];return f===-1?-1:p[f]}c.getValue=s;function l(m,d){let p=s(m,d);return p===-1?-1:a(qe.atom.label_comp_id(m),p)}c.getNormalizedValue=l;function u(m,d){let p=l(m,d);return p===-1?0:p<.16?1:2}c.getFlag=u})(Uy||={});var mX={...cX},SF={isBuried:X0.Dynamic(O9("computed","accessible-surface-area.is-buried",we.Bool),e=>{if(!me.isAtomic(e.element.unit))return!1;let t=Sm.get(e.element.structure).value;return t?Uy.getFlag(e.element,t)===Uy.Flags.Buried:!1}),isAccessible:X0.Dynamic(O9("computed","accessible-surface-area.is-accessible",we.Bool),e=>{if(!me.isAtomic(e.element.unit))return!1;let t=Sm.get(e.element.structure).value;return t?Uy.getFlag(e.element,t)===Uy.Flags.Accessible:!1})},Sm=Pl.createProvider({label:"Accessible Surface Area",descriptor:{name:"molstar_accessible_surface_area",symbols:SF},type:"root",defaultParams:mX,getParams:e=>mX,isApplicable:e=>!0,obtain:async(e,t,r)=>{let n={...C.getDefaultValues(mX),...r};return{value:await Uy.compute(t,n).runInContext(e.runtime)}}});var dX=16448250,Hlt="Assigns a color based on the relative accessible surface area of a residue.",iTe={list:C.ColorList("yellow-green-blue",{presetKind:"scale"})};function jlt(e){return iTe}function aTe(e,t){let r,n=Ba.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),o=e.structure&&Sm.get(e.structure),i=o?Du(o.id,o.version):-1;if(o?.value&&e.structure){let a=K.Location.create(e.structure),s=o.value,l=u=>{let c=Uy.getNormalizedValue(u,s);return c===-1?dX:n.color(c)};r=u=>K.Location.is(u)&&me.isAtomic(u.unit)?l(u):Ct.isLocation(u)?(a.unit=u.aUnit,a.element=u.aUnit.elements[u.aIndex],l(a)):dX}else r=()=>dX;return{factory:aTe,granularity:"group",preferSmoothing:!0,color:r,props:t,contextHash:i,description:Hlt,legend:n?n.legend:void 0}}var pX={name:"accessible-surface-area",label:"Accessible Surface Area",category:ur.Residue,factory:aTe,getParams:jlt,defaultValues:C.getDefaultValues(iTe),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?Sm.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&Sm.ref(e.structure,!1)}};var uTe=qr.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:class extends qr.Handler{constructor(){super(...arguments);this.provider=Sm;this.labelProvider={label:t=>{if(this.params.showTooltip)return Wlt(t)}}}update(t){let r=this.params.autoAttach!==t.autoAttach||this.params.showTooltip!==t.showTooltip;return this.params.autoAttach=t.autoAttach,this.params.showTooltip=t.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),r}register(){Qv.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(pX),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(sTe),this.ctx.query.structure.registry.add(lTe)}unregister(){Qv.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(pX),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(sTe),this.ctx.query.structure.registry.remove(lTe)}},params:()=>({autoAttach:C.Boolean(!1),showTooltip:C.Boolean(!0)})});function Wlt(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;let t=Sm.get(e.structure).value;if(!t||e.structure.customPropertyDescriptors.hasReference(Sm.descriptor))return;let{getSerialIndex:r}=e.structure.root.serialMapping,{area:n,serialResidueIndex:o}=t,i=new Set,a=0;for(let{indices:l,unit:u}of e.elements){let{elements:c}=u;Se.forEach(l,m=>{let d=o[r(u,c[m])];d!==-1&&!i.has(d)&&(a+=n[d],i.add(d))})}return i.size===0?void 0:`Accessible Surface Area ${`<small>(${i.size} ${i.size>1?"Residues sum":"Residue"})</small>`}: ${a.toFixed(2)} \u212B<sup>2</sup>`}else if(e.kind==="structure-loci"){let t=Sm.get(e.structure).value;return!t||e.structure.customPropertyDescriptors.hasReference(Sm.descriptor)?void 0:`Accessible Surface Area <small>(Whole Structure)</small>: ${_G(t.area).toFixed(2)} \u212B<sup>2</sup>`}}var sTe=Yn("Buried Protein Residues",ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.modifier.union([ne.struct.generator.atomGroups({"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":SF.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:"Residue Property",ensureCustomProperties:(e,t)=>Sm.attach(e,t)}),lTe=Yn("Accessible Protein Residues",ne.struct.modifier.union([ne.struct.modifier.wholeResidues([ne.struct.modifier.union([ne.struct.generator.atomGroups({"chain-test":ne.core.rel.eq([ne.ammp("objectPrimitive"),"atomistic"]),"residue-test":SF.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:"Residue Property",ensureCustomProperties:(e,t)=>Sm.attach(e,t)});var cTe=qr.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:class extends qr.Handler{constructor(){super(...arguments);this.provider=ci;this.labelProvider={label:t=>{if(this.params.showTooltip)switch(t.kind){case"element-loci":if(t.elements.length===0)return;let r=[],n=this.getStructures(t.structure);for(let o of n){let i=this.provider.get(o).value;if(!i)continue;let a=K.Loci.remap(t,o);if(a.elements.length!==1)continue;let s=a.elements[0];if(Se.size(s.indices)!==1)continue;let l=i.unitsFeatures.get(s.unit.id);if(!l)continue;let u=[],c=[],m=[],d=Se.start(s.indices),{types:p,groups:h,elementsIndex:{indices:f,offsets:y}}=l;for(let g=y[d],x=y[d+1];g<x;++g){let S=f[g],I=p[S],v=h[S];I&&u.push(DIe(I)),v&&c.push(wIe(v))}u.length&&m.push(`<small>Types</small> ${u.join(", ")}`),c.length&&m.push(`<small>Groups</small> ${c.join(", ")}`),m.length&&r.push(`Interaction Feature: ${m.join(" | ")}`)}return r.length?r.join("<br/>"):void 0;default:return}}}}getStructures(t){let r=[],n=this.ctx.helpers.substructureParent.get(t);if(n){let i=this.ctx.state.data.select(er.Generators.ofType(re.Molecule.Structure,n.transform.ref));for(let a of i)a.obj&&qo(r,a.obj.data)}return r}update(t){let r=this.params.autoAttach!==t.autoAttach||this.params.showTooltip!==t.showTooltip;return this.params.autoAttach=t.autoAttach,this.params.showTooltip=t.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),r}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(bR),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(_A)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(bR),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(_A)}},params:()=>({autoAttach:C.Boolean(!1),showTooltip:C.Boolean(!0)})});var mTe=qr.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:class extends qr.Handler{constructor(){super(...arguments);this.provider=zs}update(t){let r=this.params.autoAttach!==t.autoAttach;return this.params.autoAttach=t.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),r}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)}},params:()=>({autoAttach:C.Boolean(!1)})});var dTe=qr.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:class extends qr.Handler{constructor(){super(...arguments);this.provider=qh;this.labelProvider={label:t=>{if(this.params.showTooltip)switch(t.kind){case"element-loci":if(t.elements.length===0)return;let r=[],n=this.getStructures(t.structure);for(let o of n){let i=this.provider.get(o).value;if(!i)continue;let a=K.Loci.remap(t,o);if(a.elements.length!==1)continue;let s=a.elements[0];if(Se.size(s.indices)!==1)continue;let l=i.get(s.unit.id);if(!l)continue;let u=Se.start(s.indices),c=l.charge[u],m=l.idealGeometry[u],d=l.implicitH[u],p=l.totalH[u];r.push(`Valence Model: <small>Charge</small> ${c} | <small>Ideal Geometry</small> ${PIe(m)} | <small>Implicit H</small> ${d} | <small>Total H</small> ${p}`)}return r.length?r.join("<br/>"):void 0;default:return}}}}getStructures(t){let r=[],n=this.ctx.helpers.substructureParent.get(t);if(n){let i=this.ctx.state.data.select(er.Generators.ofType(re.Molecule.Structure,n.transform.ref));for(let a of i)a.obj&&qo(r,a.obj.data)}return r}update(t){let r=this.params.autoAttach!==t.autoAttach||this.params.showTooltip!==t.showTooltip;return this.params.autoAttach=t.autoAttach,this.params.showTooltip=t.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),r}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:C.Boolean(!1),showTooltip:C.Boolean(!0)})});var fX=16448250,Xlt="Assigns a color based on SIFTS mapping.",SR=new Map,pTe={...Ho({type:"colors",colorList:"set-1"})};function Qlt(e){return pTe}function fTe(e,t){let r;if(e.structure){for(let s of e.structure.models){let l=Tc.Provider.get(s).value;if(l)for(let u of l.accession)!u||SR.has(u)||SR.set(u,SR.size)}let n=K.Location.create(e.structure),o=Jo(SR.size+1,t,{valueLabel:s=>`${s}`}),i=new Map,a=s=>{let l=Tc.getKey(s);if(!l)return fX;if(i.has(l))return i.get(l);let u=o.color(SR.get(l));return i.set(l,u),u};r=s=>K.Location.is(s)&&me.isAtomic(s.unit)?a(s):Ct.isLocation(s)?(n.unit=s.aUnit,n.element=s.aUnit.elements[s.aIndex],a(n)):fX}else r=()=>fX;return{factory:fTe,granularity:"group",preferSmoothing:!0,color:r,props:t,description:Xlt}}var hX={name:"sifts-mapping",label:"SIFTS Mapping",category:ur.Residue,factory:fTe,getParams:Qlt,defaultValues:C.getDefaultValues(pTe),isApplicable:e=>!!e.structure?.models.some(t=>Tc.Provider.isApplicable(t)),ensureCustomProperties:{attach:async(e,t)=>{if(t.structure)for(let r of t.structure.models)await Tc.Provider.attach(e,r,void 0,!0)},detach:e=>{if(e.structure)for(let t of e.structure.models)Tc.Provider.ref(t,!1)}}};var hTe=qr.create({name:"sifts-mapping-prop",category:"custom-props",display:{name:"SIFTS Mapping"},ctor:class extends qr.Handler{constructor(){super(...arguments);this.provider=Tc.Provider;this.labelProvider={label:t=>{if(this.params.showTooltip)return Zlt(t)}}}update(t){let r=this.params.autoAttach!==t.autoAttach||this.params.showTooltip!==t.showTooltip;return this.params.autoAttach=t.autoAttach,this.params.showTooltip=t.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),r}register(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(hX),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(hX),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:C.Boolean(!0),showTooltip:C.Boolean(!0)})});function Zlt(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;let t=e.elements[0],r=t.unit,n=K.Location.create(e.structure,r,r.elements[Se.getAt(t.indices,0)]);return Tc.getLabel(n)}}var $h;(n=>{n.Descriptor={name:"ihm_cross_link_restraint"},n.Provider=ll.create(n.Descriptor);function r(o,i){let a={entity_id:o.entity_id_1,asym_id:o.asym_id_1,seq_id:o.seq_id_1,atom_id:o.atom_id_1},s={entity_id:o.entity_id_2,asym_id:o.asym_id_2,seq_id:o.seq_id_2,atom_id:o.atom_id_2};function l(f,y,g){let x=f.get(y);x?x.push(g):f.set(y,[g])}function u(f,y){let g=y.entity_id.value(f),x=y.asym_id.value(f),S=y.seq_id.value(f);if(o.model_granularity.value(f)==="by-atom"){let I=i.atomicHierarchy.index.findAtom({auth_seq_id:S,label_asym_id:x,label_atom_id:y.atom_id.value(f),label_entity_id:g});I>=0&&l(m,I,f)}else if(i.coarseHierarchy.isDefined){let I=i.coarseHierarchy.spheres.findSequenceKey(g,x,S);if(I>=0)l(d,I,f);else{let v=i.coarseHierarchy.gaussians.findSequenceKey(g,x,S);v>=0&&l(p,v,f)}}}function c(f){switch(f){case me.Kind.Atomic:return m;case me.Kind.Spheres:return d;case me.Kind.Gaussians:return p}}let m=new Map,d=new Map,p=new Map,h=[];for(let f=0;f<o._rowCount;++f)u(f,a),u(f,s);return{getIndicesByElement:(f,y)=>{let x=c(y).get(f);return x!==void 0?x:h},data:o}}n.fromTable=r})($h||={});var qlt=[];function gTe(e,t,r,n){return`${e}|${t.id}|${r}|${n.id}`}var vR=class{constructor(t){this.pairs=t;let r=new Map;this.pairs.forEach((n,o)=>{let i=gTe(n.indexA,n.unitA,n.indexB,n.unitB),a=r.get(i);a?a.push(o):r.set(i,[o])}),this.count=t.length,this.pairKeyIndices=r}getPairIndices(t,r,n,o){let i=gTe(t,r,n,o);return this.pairKeyIndices.get(i)||qlt}getPairs(t,r,n,o){return this.getPairIndices(t,r,n,o).map(a=>this.pairs[a])}};var kf=Pl.createProvider({label:"Cross Link Restraint",descriptor:{name:"integrative-cross-link-restraint"},type:"local",defaultParams:{},getParams:e=>({}),isApplicable:e=>e.models.some(t=>!!$h.Provider.get(t)),obtain:async(e,t,r)=>({value:Jlt(t)})});var hp;(h=>{let e;(y=>y.CrossLinkRestraint="cross-link-restraint")(e=h.Tag||={});function t(f){return f.models.some(y=>!!$h.Provider.get(y))}h.isApplicable=t;let r=b(),n=b();function o(f){return f.unitA.conformation.position(f.unitA.elements[f.indexA],r),f.unitB.conformation.position(f.unitB.elements[f.indexB],n),b.distance(r,n)}h.distance=o;function i(f,y,g){return PB("cross-link-restraints",{structure:y,crossLinkRestraints:f},g)}h.Location=i;function a(f){return!!f&&f.kind==="data-location"&&f.tag==="cross-link-restraints"}h.isLocation=a;function s(f,y){return f.data.structure===y.data.structure&&f.data.crossLinkRestraints===y.data.crossLinkRestraints&&f.element===y.element}h.areLocationsEqual=s;function l(f,y){let g=f.pairs[y];return`Cross Link Restraint | Type: ${g.restraintType} | Threshold: ${g.distanceThreshold} \u212B | Psi: ${g.psi} | Sigma 1: ${g.sigma1} | Sigma 2: ${g.sigma2} | Distance: ${o(g).toFixed(2)} \u212B`}function u(f){return l(f.data.crossLinkRestraints,f.element)}h.locationLabel=u;function c(f,y,g){return Ex("cross-link-restraints",{structure:f,crossLinkRestraints:y},g,x=>d(y,g,x),()=>p(f,y,g))}h.Loci=c;function m(f){return!!f&&f.kind==="data-loci"&&f.tag==="interactions"}h.isLoci=m;function d(f,y,g){return cu.fromPairProvider(y.length,(x,S,I)=>{let v=f.pairs[y[x]];v.unitA.conformation.position(v.unitA.elements[v.indexA],S),v.unitB.conformation.position(v.unitB.elements[v.indexB],I)},g)}h.getBoundingSphere=d;function p(f,y,g){let x=g[0];if(x===void 0)return"";let S=y.pairs[x];return[l(y,x),O_(Ct.Location(f,S.unitA,S.indexA,f,S.unitB,S.indexB))].join("</br>")}h.getLabel=p})(hp||={});function yTe(e,t,r){let{elements:n}=t,o=n.length,i=t.kind;for(let a=0;a<o;a++){let s=n[a];r.getIndicesByElement(s,i).forEach(l=>e.set(l,a))}}function Ylt(e,t,r){if(t.model!==r.model||t.model.sourceData.kind!=="mmCIF")return;let n=$h.Provider.get(t.model);if(!n)return;let o=new Map,i=new Map;yTe(o,t,n),yTe(i,r,n),o.forEach((a,s)=>{let l=i.get(s);l!==void 0&&e.push(vF(t,a,r,l,n,s),vF(r,l,t,a,n,s))})}function Klt(e,t){if(t.model.sourceData.kind!=="mmCIF")return;let r=$h.Provider.get(t.model);if(!r)return;let{elements:n}=t,o=n.length,i=t.kind,a=new Map;for(let s=0;s<o;s++){let l=n[s];r.getIndicesByElement(l,i).forEach(u=>{let c=a.get(u);c?c.push(s):a.set(u,[s])})}a.forEach((s,l)=>{if(s.length<2)return;let[u,c]=s;e.push(vF(t,u,t,c,r,l),vF(t,c,t,u,r,l))})}function vF(e,t,r,n,o,i){return{unitA:e,indexA:t,unitB:r,indexB:n,restraintType:o.data.restraint_type.value(i),distanceThreshold:o.data.distance_threshold.value(i),psi:o.data.psi.value(i),sigma1:o.data.sigma_1.value(i),sigma2:o.data.sigma_2.value(i)}}function Jlt(e){let t=[];if(!e.models.some(n=>$h.Provider.get(n)))return new vR(t);let r=e.units.length;for(let n=0;n<r;++n){let o=e.units[n];Klt(t,o);for(let i=n+1;i<r;++i){let a=e.units[i];o.model===a.model&&Ylt(t,o,a)}}return new vR(t)}function $lt(e,t,r,n,o){let i=kf.get(t).value;if(!i.count)return ft.createEmpty(o);let{sizeFactor:a}=n,s=K.Location.create(t),l={linkCount:i.count,position:(m,d,p)=>{let h=i.pairs[p],f=h.unitA,y=h.unitB;f.conformation.position(f.elements[h.indexA],m),y.conformation.position(y.elements[h.indexB],d)},radius:m=>{let d=i.pairs[m];return s.unit=d.unitA,s.element=d.unitA.elements[d.indexA],r.size.size(s)*a}},{mesh:u,boundingSphere:c}=Oc(e,l,n,o);if(c)u.setBoundingSphere(c);else if(u.triangleCount>0){let m=ye.expand(ye(),t.boundary.sphere,1*a);u.setBoundingSphere(m)}return u}var bTe={...Qu,...hd,sizeFactor:C.Numeric(.5,{min:0,max:10,step:.1})};function eut(e){return cs({defaultProps:C.getDefaultValues(bTe),createGeometry:$lt,createLocationIterator:tut,getLoci:rut,eachLocation:nut,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function tut(e){let t=kf.get(e).value,{pairs:r}=t,n=r.length,o=1,i=hp.Location(t,e);return Kr(n,o,1,s=>(i.element=s,i),!0)}function rut(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let i=kf.get(t).value;if(i.pairs[o])return hp.Loci(t,i,[o])}return dr}function nut(e,t,r){let n=!1;if(hp.isLoci(e)){if(!De.areEquivalent(e.data.structure,t))return!1;let o=kf.get(t).value;if(e.data.crossLinkRestraints!==o)return!1;for(let i of e.elements)r(xe.ofSingleton(i))&&(n=!0)}return n}var out={"cross-link-restraint":(e,t)=>to("Cross-link restraint",e,t,eut)},xTe={...bTe};function iut(e,t){return C.clone(xTe)}function aut(e,t){return Vt.createMulti("CrossLinkRestraint",e,t,Gn,out)}var gX={name:hp.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:aut,getParams:iut,defaultValues:C.getDefaultValues(xTe),defaultColorTheme:{name:hp.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:e=>hp.isApplicable(e),ensureCustomProperties:{attach:(e,t)=>kf.attach(e,t,void 0,!0),detach:e=>kf.ref(e,!1)}};var CTe=13421772,sut="Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",STe={domain:C.Interval([.5,1.5],{step:.01}),list:C.ColorList("red-grey",{presetKind:"scale"})};function lut(e){return STe}function vTe(e,t){let r,n,o=e.structure&&kf.get(e.structure).value;if(o){n=Ba.create({domain:t.domain,listOrName:t.list.colors});let i=n.color;r=a=>{if(hp.isLocation(a)){let s=o.pairs[a.element];if(s)return i(hp.distance(s)/s.distanceThreshold)}return CTe}}else r=()=>CTe;return{factory:vTe,granularity:"group",color:r,props:t,description:sut,legend:n?n.legend:void 0}}var yX={name:"cross-link",label:"Cross Link",category:ur.Misc,factory:vTe,getParams:lut,defaultValues:C.getDefaultValues(STe),isApplicable:e=>!!e.structure&&hp.isApplicable(e.structure),ensureCustomProperties:{attach:(e,t)=>t.structure?kf.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&kf.ref(e.structure,!1)}};var ITe=qr.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:class extends qr.Handler{constructor(){super(...arguments);this.provider=$h.Provider}register(){this.provider.formatRegistry.add("mmCIF",uut),this.ctx.representation.structure.themes.colorThemeRegistry.add(yX),this.ctx.representation.structure.registry.add(gX)}unregister(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(yX),this.ctx.representation.structure.registry.remove(gX)}}});function uut(e){if(!Cn.is(e.sourceData))return;let{ihm_cross_link_restraint:t}=e.sourceData.data.db;if(t._rowCount!==0)return $h.fromTable(t,e)}var IR={State:$W,Representation:tX,Camera:rX,Misc:nX},Gc={Representation:iX,Camera:lX,CustomProps:bX};var cut=e=>{let t=Xe.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:C.Numeric(5,{min:1,max:10,step:1}),targetParams:C.Group(t,{label:"Target",customDefault:RA(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.22,sizeAspectRatio:.73,adjustCylinderLength:!0,xrayShaded:!0,aromaticBonds:!1,multipleBonds:"off",excludeTypes:["hydrogen-bond","metal-coordination"]}})}),surroundingsParams:C.Group(t,{label:"Surroundings",customDefault:RA(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16,excludeTypes:["hydrogen-bond","metal-coordination"]}})}),nciParams:C.Group(t,{label:"Non-covalent Int.",customDefault:RA(e,void 0,{type:_A,color:bR,size:yo.BuiltIn.uniform})}),components:C.MultiSelect(ATe,C.arrayToOptions(ATe)),excludeTargetFromSurroundings:C.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),ignoreLight:C.Boolean(!1),material:Oa.getParam(),clip:C.Group(mf.Params)}},ATe=["target","surroundings","interactions"];var mut=new Set(["structure-focus-target-sel","structure-focus-target-repr","structure-focus-surr-sel","structure-focus-surr-repr","structure-focus-surr-nci-repr"]),xX=class extends qr.WithSubscribers{constructor(){super(...arguments);this.currentSource=void 0}get surrLabel(){return`[Focus] Surroundings (${this.params.expandRadius} \xC5)`}getReprParams(r){return{...r,type:{name:r.type.name,params:{...r.type.params,ignoreHydrogens:this.params.ignoreHydrogens,ignoreHydrogensVariant:this.params.ignoreHydrogensVariant,ignoreLight:this.params.ignoreLight,material:this.params.material,clip:this.params.clip}}}}ensureShape(r){let n=this.plugin.state.data,o=n.tree,i=n.build(),a=er.findUniqueTagsInSubtree(o,r.transform.ref,mut);a["structure-focus-target-sel"]||(a["structure-focus-target-sel"]=i.to(r).apply(Xe.Model.StructureSelectionFromBundle,{bundle:K.Bundle.Empty,label:"[Focus] Target"},{tags:"structure-focus-target-sel"}).ref),a["structure-focus-surr-sel"]||(a["structure-focus-surr-sel"]=i.to(r).apply(Xe.Model.StructureSelectionFromExpression,{expression:ne.struct.generator.empty(),label:this.surrLabel},{tags:"structure-focus-surr-sel"}).ref);let s=this.params.components;return s.indexOf("target")>=0&&!a["structure-focus-target-repr"]&&(a["structure-focus-target-repr"]=i.to(a["structure-focus-target-sel"]).apply(Xe.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:"structure-focus-target-repr"}).ref),s.indexOf("surroundings")>=0&&!a["structure-focus-surr-repr"]&&(a["structure-focus-surr-repr"]=i.to(a["structure-focus-surr-sel"]).apply(Xe.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:"structure-focus-surr-repr"}).ref),s.indexOf("interactions")>=0&&!a["structure-focus-surr-nci-repr"]&&r.obj&&_A.isApplicable(r.obj?.data)&&(a["structure-focus-surr-nci-repr"]=i.to(a["structure-focus-surr-sel"]).apply(Xe.Representation.StructureRepresentation3D,this.getReprParams(this.params.nciParams),{tags:"structure-focus-surr-nci-repr"}).ref),{state:n,builder:i,refs:a}}clear(r){let n=this.plugin.state.data;this.currentSource=void 0;let o=n.select(er.Generators.byRef(r).subtree().withTag("structure-focus-target-sel")),i=n.select(er.Generators.byRef(r).subtree().withTag("structure-focus-surr-sel"));if(o.length===0&&i.length===0)return;let a=n.build(),s=K.Bundle.Empty;for(let u of o)a.to(u).update(Xe.Model.StructureSelectionFromBundle,c=>({...c,bundle:s}));let l=ne.struct.generator.empty();for(let u of i)a.to(u).update(Xe.Model.StructureSelectionFromExpression,c=>({...c,expression:l}));return st.State.Update(this.plugin,{state:n,tree:a,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}async focus(r){let n=this.plugin.helpers.substructureParent.get(r.structure);if(!n||!n.obj)return;this.currentSource=r;let o=K.Loci.remap(r,n.obj.data),i=K.Loci.extendToWholeResidues(o),a=K.Bundle.fromLoci(i),s=K.Bundle.toExpression(a),l=ne.struct.modifier.includeSurroundings({0:s,radius:this.params.expandRadius,"as-whole-residues":!0});this.params.excludeTargetFromSurroundings&&(l=ne.struct.modifier.exceptBy({0:l,by:s}));let{state:u,builder:c,refs:m}=this.ensureShape(n);c.to(m["structure-focus-target-sel"]).update(Xe.Model.StructureSelectionFromBundle,d=>({...d,bundle:a})),c.to(m["structure-focus-surr-sel"]).update(Xe.Model.StructureSelectionFromExpression,d=>({...d,expression:l,label:this.surrLabel})),await st.State.Update(this.plugin,{state:u,tree:c,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}register(r){this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,n=>{n?this.focus(n.loci):this.clear(Ar.RootRef)})}async update(r){let n=this.params;if(this.params=r,n.excludeTargetFromSurroundings!==r.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),!0;let o=this.plugin.state.data,i=o.build(),a=er.Generators.root.subtree(),s=this.params.components,l=s.indexOf("target")>=0;for(let u of o.select(a.withTag("structure-focus-target-repr")))l?i.to(u).update(this.getReprParams(this.params.targetParams)):i.delete(u.transform.ref);l=s.indexOf("surroundings")>=0;for(let u of o.select(a.withTag("structure-focus-surr-repr")))l?i.to(u).update(this.getReprParams(this.params.surroundingsParams)):i.delete(u.transform.ref);l=s.indexOf("interactions")>=0;for(let u of o.select(a.withTag("structure-focus-surr-nci-repr")))l?i.to(u).update(this.getReprParams(this.params.nciParams)):i.delete(u.transform.ref);return await st.State.Update(this.plugin,{state:o,tree:i,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}}),r.expandRadius!==n.expandRadius&&this.currentSource&&this.focus(this.currentSource),!0}},FS=qr.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:xX,params:(e,t)=>cut(t)});function eg(e){return e}(i=>{i.CommonParams={ignoreHydrogens:C.Optional(C.Boolean(!1)),ignoreHydrogensVariant:C.Optional(C.Select("all",C.arrayToOptions(["all","non-polar"]))),ignoreLight:C.Optional(C.Boolean(!1)),quality:C.Optional(C.Select("auto",c_)),theme:C.Optional(C.Group({globalName:C.Optional(C.Text("")),globalColorParams:C.Optional(C.Value({},{isHidden:!0})),carbonColor:C.Optional(C.Select("chain-id",C.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:C.Optional(C.Text("")),symmetryColorParams:C.Optional(C.Value({},{isHidden:!0})),focus:C.Optional(C.Group({name:C.Optional(C.Text("")),params:C.Optional(C.Value({}))}))}))};function t(a){return a==="chain-id"?{name:a,params:sB.defaultValues}:a==="operator-name"?{name:a,params:oI.defaultValues}:{name:a,params:{}}}function r(a){return a.units.some(s=>!s.conformation.operator.assembly&&s.conformation.operator.spgrOp>=0)}function n(a,s,l){let u=a.state.data.build(),c=a.builders.structure.representation,m=a.managers.structure.component.state.options.hydrogens,d={quality:a.managers.structure.component.state.options.visualQuality,ignoreHydrogens:m!=="all",ignoreHydrogensVariant:m==="only-polar"?"non-polar":"all",ignoreLight:a.managers.structure.component.state.options.ignoreLight};s.quality&&s.quality!=="auto"&&(d.quality=s.quality),s.ignoreHydrogens!==void 0&&(d.ignoreHydrogens=!!s.ignoreHydrogens),s.ignoreHydrogensVariant!==void 0&&(d.ignoreHydrogensVariant=s.ignoreHydrogensVariant),s.ignoreLight!==void 0&&(d.ignoreLight=!!s.ignoreLight);let p=s.theme?.globalName?s.theme?.globalName:void 0,h=s.theme?.carbonColor!==void 0?{carbonColor:t(s.theme?.carbonColor),...s.theme?.globalColorParams}:{...s.theme?.globalColorParams},f=l&&s.theme?.symmetryColor&&r(l)?s.theme?.symmetryColor:p,y=s.theme?.symmetryColorParams?{...s.theme?.globalColorParams,...s.theme?.symmetryColorParams}:{...s.theme?.globalColorParams},g=s.theme?.globalColorParams?{...s.theme?.globalColorParams}:void 0;return{update:u,builder:c,color:p,symmetryColor:f,symmetryColorParams:y,globalColorParams:g,typeParams:d,ballAndStickColor:h}}i.reprBuilder=n;function o(a,s,l,u){if(a.state.hasBehavior(FS))return a.state.updateBehavior(FS,c=>{let m=xR(a,s,"ball-and-stick",l||"element-symbol",u);c.surroundingsParams.colorTheme=m,c.targetParams.colorTheme=m})}i.updateFocusRepr=o})(eg||={});var Ny=eg.CommonParams,oC=eg.reprBuilder,iC=eg.updateFocusRepr,dut={id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:()=>Ny,apply(e,t,r){let n=Yo.resolveAndCheck(r.state.data,e)?.obj?.data;if(!n)return{};let o=r.config.get(Lr.Structure.SizeThresholds)||De.DefaultSizeThresholds,i=De.getSize(n,o),a=n.polymerResidueCount/n.polymerGapCount;switch(i){case De.Size.Gigantic:case De.Size.Huge:return _Te.apply(e,t,r);case De.Size.Large:return RTe.apply(e,t,r);case De.Size.Medium:if(a>3)return PTe.apply(e,t,r);case De.Size.Small:return DTe.apply(e,{...t,showCarbohydrateSymbol:!0},r);default:Rr(i)}}},put={id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},async apply(e,t,r){return{}}},AR="Basic",PTe={id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:AR,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:()=>Ny,async apply(e,t,r){let n=Yo.resolveAndCheck(r.state.data,e);if(!n)return{};let o={polymer:await Ju(r,n,"polymer"),ligand:await Ju(r,n,"ligand"),nonStandard:await Ju(r,n,"non-standard"),branched:await Ju(r,n,"branched",{label:"Carbohydrate"}),water:await Ju(r,n,"water"),ion:await Ju(r,n,"ion"),lipid:await Ju(r,n,"lipid"),coarse:await Ju(r,n,"coarse")},i=n.obj.data,a=(o.water?.obj?.data?.elementCount||0)>5e4?"line":"ball-and-stick",s=(o.lipid?.obj?.data?.elementCount||0)>2e4?"line":"ball-and-stick",{update:l,builder:u,typeParams:c,color:m,symmetryColor:d,symmetryColorParams:p,globalColorParams:h,ballAndStickColor:f}=oC(r,t,i),y={polymer:u.buildRepresentation(l,o.polymer,{type:"cartoon",typeParams:c,color:d,colorParams:p},{tag:"polymer"}),ligand:u.buildRepresentation(l,o.ligand,{type:"ball-and-stick",typeParams:c,color:m,colorParams:f},{tag:"ligand"}),nonStandard:u.buildRepresentation(l,o.nonStandard,{type:"ball-and-stick",typeParams:c,color:m,colorParams:f},{tag:"non-standard"}),branchedBallAndStick:u.buildRepresentation(l,o.branched,{type:"ball-and-stick",typeParams:{...c,alpha:.3},color:m,colorParams:f},{tag:"branched-ball-and-stick"}),branchedSnfg3d:u.buildRepresentation(l,o.branched,{type:"carbohydrate",typeParams:c,color:m,colorParams:h},{tag:"branched-snfg-3d"}),water:u.buildRepresentation(l,o.water,{type:a,typeParams:{...c,alpha:.6,visuals:a==="line"?["intra-bond","element-point"]:void 0},color:m,colorParams:{carbonColor:{name:"element-symbol",params:{}},...h}},{tag:"water"}),ion:u.buildRepresentation(l,o.ion,{type:"ball-and-stick",typeParams:c,color:m,colorParams:{carbonColor:{name:"element-symbol",params:{}},...h}},{tag:"ion"}),lipid:u.buildRepresentation(l,o.lipid,{type:s,typeParams:{...c,alpha:.6,visuals:s==="line"?["intra-bond"]:void 0},color:m,colorParams:{carbonColor:{name:"element-symbol",params:{}},...h}},{tag:"lipid"}),coarse:u.buildRepresentation(l,o.coarse,{type:"spacefill",typeParams:c,color:m||"chain-id",colorParams:h},{tag:"coarse"})};return await l.commit({revertOnError:!1}),await iC(r,i,t.theme?.focus?.name,t.theme?.focus?.params),{components:o,representations:y}}},fut={id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:AR,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:()=>Ny,async apply(e,t,r){let n=Yo.resolveAndCheck(r.state.data,e);if(!n)return{};let o={protein:await TTe(r,n,"protein"),nucleic:await TTe(r,n,"nucleic")},i=n.obj.data,a={radiusOffset:i.isCoarseGrained?2:0,smoothness:i.isCoarseGrained?1:1.5},{update:s,builder:l,typeParams:u,symmetryColor:c,symmetryColorParams:m}=oC(r,t,i),d={protein:l.buildRepresentation(s,o.protein,{type:"cartoon",typeParams:u,color:c,colorParams:m},{tag:"protein"}),nucleic:l.buildRepresentation(s,o.nucleic,{type:"gaussian-surface",typeParams:{...u,...a},color:c,colorParams:m},{tag:"nucleic"})};return await s.commit({revertOnError:!0}),await iC(r,i,t.theme?.focus?.name,t.theme?.focus?.params),{components:o,representations:d}}},_Te={id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:AR,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:()=>Ny,async apply(e,t,r){let n=Yo.resolveAndCheck(r.state.data,e);if(!n)return{};let o={polymer:await Ju(r,n,"polymer"),lipid:await Ju(r,n,"lipid")},i=n.obj.data,a=r.config.get(Lr.Structure.SizeThresholds)||De.DefaultSizeThresholds,s=De.getSize(i,a),l=Object.create(null);s===De.Size.Gigantic?Object.assign(l,{traceOnly:!i.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):s===De.Size.Huge?Object.assign(l,{radiusOffset:i.isCoarseGrained?2:0,smoothness:1}):i.isCoarseGrained&&Object.assign(l,{radiusOffset:2,smoothness:1});let{update:u,builder:c,typeParams:m,symmetryColor:d,symmetryColorParams:p}=oC(r,t,i),h={polymer:c.buildRepresentation(u,o.polymer,{type:"gaussian-surface",typeParams:{...m,...l},color:d,colorParams:p},{tag:"polymer"}),lipid:c.buildRepresentation(u,o.lipid,{type:"gaussian-surface",typeParams:{...m,...l},color:d,colorParams:p},{tag:"lipid"})};return await u.commit({revertOnError:!0}),await iC(r,i,t.theme?.focus?.name,t.theme?.focus?.params),{components:o,representations:h}}},RTe={id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:AR,description:"Shows polymers as Cartoon."},params:()=>Ny,async apply(e,t,r){let n=Yo.resolveAndCheck(r.state.data,e);if(!n)return{};let o={polymer:await Ju(r,n,"polymer")},i=n.obj.data,{update:a,builder:s,typeParams:l,symmetryColor:u,symmetryColorParams:c}=oC(r,t,i),m={polymer:s.buildRepresentation(a,o.polymer,{type:"cartoon",typeParams:l,color:u,colorParams:c},{tag:"polymer"})};return await a.commit({revertOnError:!0}),await iC(r,i,t.theme?.focus?.name,t.theme?.focus?.params),{components:o,representations:m}}},DTe={id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:AR,description:"Shows everything in atomic detail."},params:()=>({...Ny,showCarbohydrateSymbol:C.Boolean(!1)}),async apply(e,t,r){let n=Yo.resolveAndCheck(r.state.data,e);if(!n)return{};let o={all:await Ju(r,n,"all"),branched:void 0},i=n.obj.data,a=i.elementCount>1e5,s=i.elementCount>1e6,l=i.units.length>5e3,u=i.atomicResidueCount&&i.elementCount>1e3&&i.atomicResidueCount/i.elementCount<3,c=i.models[0],m=!!Do.Provider.get(c)||vc.isExhaustive(c),d="ball-and-stick";i.isCoarseGrained||l?d=s?"point":"spacefill":u&&!m?d="spacefill":a&&(d="line");let p=t.showCarbohydrateSymbol&&!a&&!u;p&&Object.assign(o,{branched:await Ju(r,n,"branched",{label:"Carbohydrate"})});let{update:h,builder:f,typeParams:y,color:g,ballAndStickColor:x,globalColorParams:S}=oC(r,t,i),I=u&&!m?{carbonColor:{name:"element-symbol",params:{}},...S}:x,v={all:f.buildRepresentation(h,o.all,{type:d,typeParams:y,color:g,colorParams:I},{tag:"all"})};return p&&Object.assign(v,{snfg3d:f.buildRepresentation(h,o.branched,{type:"carbohydrate",typeParams:{...y,alpha:.4,visuals:["carbohydrate-symbol"]},color:g,colorParams:S},{tag:"snfg-3d"})}),await h.commit({revertOnError:!0}),await iC(r,i,t.theme?.focus?.name??g,t.theme?.focus?.params??I),{components:o,representations:v}}},hut={id:"preset-structure-representation-illustrative",display:{name:"Illustrative",group:"Miscellaneous",description:"Show everything in spacefill representation with illustrative colors and ignore light."},params:()=>Ny,async apply(e,t,r){let n=Yo.resolveAndCheck(r.state.data,e);if(!n)return{};let o={all:await Ju(r,n,"all"),branched:void 0},i=n.obj.data,{update:a,builder:s,typeParams:l,color:u}=oC(r,t,i),c={all:s.buildRepresentation(a,o.all,{type:"spacefill",typeParams:{...l,ignoreLight:!0},color:"illustrative",colorParams:{style:{name:"entity-id",params:{overrideWater:!0}}}},{tag:"all"})};return await a.commit({revertOnError:!0}),await iC(r,i,t.theme?.focus?.name??u,t.theme?.focus?.params),{components:o,representations:c}}},gut={id:"preset-structure-representation-molecular-surface",display:{name:"Molecular Surface",group:"Miscellaneous",description:"Show everything in molecular surface representation with illustrative colors."},params:()=>Ny,async apply(e,t,r){let n=Yo.resolveAndCheck(r.state.data,e);if(!n)return{};let o={all:await Ju(r,n,"all"),branched:void 0},i=n.obj.data,{update:a,builder:s,typeParams:l,color:u}=oC(r,t,i),c={all:s.buildRepresentation(a,o.all,{type:"molecular-surface",typeParams:l,color:"entity-id",colorParams:{overrideWater:!0}},{tag:"all"})};return await a.commit({revertOnError:!0}),await iC(r,i,t.theme?.focus?.name??u,t.theme?.focus?.params),{components:o,representations:c}}},yut={id:"preset-structure-representation-auto-lod",display:{name:"Automatic Detail",group:"Miscellaneous",description:"Shows more (or less) detailed representations automatically based on camera distance."},params:()=>Ny,async apply(e,t,r){let n=Yo.resolveAndCheck(r.state.data,e);if(!n)return{};let o={all:await Ju(r,n,"all")},i=n.obj.data,{update:a,builder:s,typeParams:l,color:u,symmetryColor:c,symmetryColorParams:m,ballAndStickColor:d}=oC(r,t,i),p={gaussianSurface:s.buildRepresentation(a,o.all,{type:"gaussian-surface",typeParams:{...l,lod:b.create(30,1e7,100)},color:c,colorParams:m},{tag:"gaussian-surface"}),cartoon:s.buildRepresentation(a,o.all,{type:"cartoon",typeParams:{...l,lod:b.create(-20,300,100)},color:c,colorParams:m},{tag:"cartoon"}),ballAndStick:s.buildRepresentation(a,o.all,{type:"ball-and-stick",typeParams:{...l,lod:b.create(-20,40,20)},color:u,colorParams:d},{tag:"ball-and-stick"})};return await a.commit({revertOnError:!1}),await iC(r,i,t.theme?.focus?.name,t.theme?.focus?.params),{components:o,representations:p}}};function Ju(e,t,r,n){return e.builders.structure.tryCreateComponentStatic(t,r,n)}function TTe(e,t,r,n){return e.builders.structure.tryCreateComponentFromSelection(t,li[r],`selection-${r}`,n)}var Yl={empty:put,auto:dut,"atomic-detail":DTe,"polymer-cartoon":RTe,"polymer-and-ligand":PTe,"protein-and-nucleic":fut,"coarse-surface":_Te,illustrative:hut,"molecular-surface":gut,"auto-lod":yut};var vm="Trajectory";function Lf(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}var but={label:"mmCIF",description:"mmCIF",category:vm,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>e.ext==="mmcif"||e.ext==="mcif"?!0:e.ext==="cif"||e.ext==="bcif"?$I(e,t)===-1:!1,parse:async(e,t,r)=>{let o=e.state.data.build().to(t).apply(Xe.Data.ParseCif,void 0,{state:{isGhost:!0}}),i=await o.apply(Xe.Model.TrajectoryFromMmCif,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0});return(o.selector.cell?.obj?.data.blocks.length||0)>1&&e.state.data.updateCellState(o.ref,{isGhost:!1}),{trajectory:i}},visuals:Lf},xut={label:"cifCore",description:"CIF Core",category:vm,stringExtensions:["cif"],isApplicable:(e,t)=>e.ext==="cif"?$I(e,t)==="coreCif":!1,parse:async(e,t,r)=>{let o=e.state.data.build().to(t).apply(Xe.Data.ParseCif,void 0,{state:{isGhost:!0}}),i=await o.apply(Xe.Model.TrajectoryFromCifCore,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0});return(o.selector.cell?.obj?.data.blocks.length||0)>1&&e.state.data.updateCellState(o.ref,{isGhost:!1}),{trajectory:i}},visuals:Lf};function zy(e,t){return async(r,n,o)=>({trajectory:await r.state.data.build().to(n).apply(e,t,{tags:o?.trajectoryTags}).commit({revertOnError:!0})})}var Cut={label:"PDB",description:"PDB",category:vm,stringExtensions:["pdb","ent"],parse:zy(Xe.Model.TrajectoryFromPDB),visuals:Lf},Sut={label:"PDBQT",description:"PDBQT",category:vm,stringExtensions:["pdbqt"],parse:zy(Xe.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:Lf},vut={label:"XYZ",description:"XYZ",category:vm,stringExtensions:["xyz"],parse:zy(Xe.Model.TrajectoryFromXYZ),visuals:Lf},Iut={label:"Lammps Data",description:"Lammps Data",category:vm,stringExtensions:["data"],parse:zy(Xe.Model.TrajectoryFromLammpsData),visuals:Lf},Aut={label:"Lammps Trajectory Data",description:"Lammps Trajectory Data",category:vm,stringExtensions:["lammpstrj"],parse:zy(Xe.Model.TrajectoryFromLammpsTrajData),visuals:Lf},Tut={label:"GRO",description:"GRO",category:vm,stringExtensions:["gro"],binaryExtensions:[],parse:zy(Xe.Model.TrajectoryFromGRO),visuals:Lf},Put={label:"MOL",description:"MOL",category:vm,stringExtensions:["mol"],parse:zy(Xe.Model.TrajectoryFromMOL),visuals:Lf},_ut={label:"SDF",description:"SDF",category:vm,stringExtensions:["sdf","sd"],parse:zy(Xe.Model.TrajectoryFromSDF),visuals:Lf},Rut={label:"MOL2",description:"MOL2",category:vm,stringExtensions:["mol2"],parse:zy(Xe.Model.TrajectoryFromMOL2),visuals:Lf},IF=[["mmcif",but],["cifCore",xut],["pdb",Cut],["pdbqt",Sut],["gro",Tut],["xyz",vut],["lammps_data",Iut],["lammps_traj_data",Aut],["mol",Put],["sdf",_ut],["mol2",Rut]];var Dut=["gz","zip"];function Hy(e){let t=e,r="",n=t.lastIndexOf("?"),o=n!==-1?t.substring(n):"";t=t.substring(0,n===-1?t.length:n);let i=t.replace(/^.*[\\/]/,""),a=i.substring(0,i.lastIndexOf(".")),s=i.split("."),l=s.length>1?(s.pop()||"").toLowerCase():"",u=t.match(/^(.+):\/\/(.+)$/);u&&(r=u[1].toLowerCase(),t=u[2]||"");let c=t.substring(0,t.lastIndexOf("/")+1);if(Dut.includes(l)){let m=t.length-l.length-1;l=(t.substring(0,m).split(".").pop()||"").toLowerCase();let d=a.length-l.length-1;a=a.substring(0,d)}return{path:t,name:i,ext:l,base:a,dir:c,protocol:r,query:o}}var wA="Topology";var wut={label:"PSF",description:"PSF",category:wA,stringExtensions:["psf"],parse:async(e,t)=>{let r=e.state.data.build().to(t).apply(Xe.Data.ParsePsf,{},{state:{isGhost:!0}}),n=r.apply(Xe.Model.TopologyFromPsf);return await r.commit(),{format:r.selector,topology:n.selector}}};var Eut={label:"PRMTOP",description:"PRMTOP",category:wA,stringExtensions:["prmtop","parm7"],parse:async(e,t)=>{let r=e.state.data.build().to(t).apply(Xe.Data.ParsePrmtop,{},{state:{isGhost:!0}}),n=r.apply(Xe.Model.TopologyFromPrmtop);return await r.commit(),{format:r.selector,topology:n.selector}}};var Mut={label:"TOP",description:"TOP",category:wA,stringExtensions:["top"],parse:async(e,t)=>{let r=e.state.data.build().to(t).apply(Xe.Data.ParseTop,{},{state:{isGhost:!0}}),n=r.apply(Xe.Model.TopologyFromTop);return await r.commit(),{format:r.selector,topology:n.selector}}},wTe=[["psf",wut],["prmtop",Eut],["top",Mut]];var aC="Coordinates";var But={label:"DCD",description:"DCD",category:aC,binaryExtensions:["dcd"],parse:(e,t)=>e.state.data.build().to(t).apply(Xe.Model.CoordinatesFromDcd).commit()};var kut={label:"XTC",description:"XTC",category:aC,binaryExtensions:["xtc"],parse:(e,t)=>e.state.data.build().to(t).apply(Xe.Model.CoordinatesFromXtc).commit()};var Lut={label:"TRR",description:"TRR",category:aC,binaryExtensions:["trr"],parse:(e,t)=>e.state.data.build().to(t).apply(Xe.Model.CoordinatesFromTrr).commit()};var Fut={label:"NCTRAJ",description:"NCTRAJ",category:aC,binaryExtensions:["nc","nctraj"],parse:(e,t)=>e.state.data.build().to(t).apply(Xe.Model.CoordinatesFromNctraj).commit()};var Vut={label:"LAMMPSTRAJ",description:"LAMMPSTRAJ",category:aC,stringExtensions:["lammpstrj"],parse:(e,t)=>e.state.data.build().to(t).apply(Xe.Model.CoordinatesFromLammpstraj).commit()},ETe=[["dcd",But],["xtc",kut],["trr",Lut],["nctraj",Fut],["lammpstrj",Vut]];var Out=e=>{let t=e.config.get(Lr.Structure.DefaultRepresentationPreset)||Yl.auto.id;return C.Group({type:Iy.getParams(void 0,"auto").type,representation:C.Select(t,e.builders.structure.representation.getPresets().map(r=>[r.id,r.display.name,r.display.group]),{description:"Which representation preset to use."}),representationParams:C.Group(eg.CommonParams,{isHidden:!0}),asTrajectory:C.Optional(C.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})},MTe={rcsb:C.Group({encoding:C.Select("bcif",C.arrayToOptions(["cif","bcif"]))},{label:"RCSB PDB",isFlat:!0}),pdbe:C.Group({variant:C.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0}),pdbj:C.EmptyGroup({label:"PDBj"})};var Gut=Ss.build({from:re.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:(e,t)=>{let r=Out(t),n=t.config.get(Lr.Download.DefaultPdbProvider)||"pdbe";return{source:C.MappedStatic("pdb",{pdb:C.Group({provider:C.Group({id:C.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:C.MappedStatic(n,MTe)},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB"}),"pdb-ihm":C.Group({provider:C.Group({id:C.Text("8zzc",{label:"PDB-IHM Id(s)",description:"One or more comma/space separated ids."}),encoding:C.Select("bcif",C.arrayToOptions(["cif","bcif"]))},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB-IHM"}),swissmodel:C.Group({id:C.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),alphafolddb:C.Group({provider:C.Group({id:C.Text("Q8W3K0",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),encoding:C.Select("bcif",C.arrayToOptions(["cif","bcif"]))},{pivot:"id"}),options:r},{isFlat:!0,label:"AlphaFold DB",description:"Loads the predicted model if available"}),modelarchive:C.Group({id:C.Text("ma-bak-cepc-0003",{label:"Accession Code(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"Model Archive"}),pubchem:C.Group({id:C.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:r},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:C.Group({url:C.Url(""),format:C.Select("mmcif",C.arrayToOptions(IF.map(o=>o[0]),o=>o)),isBinary:C.Boolean(!1),label:C.Optional(C.Text("")),options:r},{isFlat:!0,label:"URL"})})}}})(({params:e,state:t},r)=>Pe.create("Download Structure",async n=>{r.behaviors.layout.leftPanelTabName.next("data");let o=e.source,i,a=!1,s="mmcif";switch(o.name){case"url":i=[{url:o.params.url,isBinary:o.params.isBinary,label:o.params.label||void 0}],s=o.params.format;break;case"pdb":i=await(o.params.provider.server.name==="pdbe"?Uut(o):o.params.provider.server.name==="pdbj"?Nut(o):o.params.provider.server.name==="rcsb"?zut(o):Rr(o)),a=!!o.params.options.asTrajectory;break;case"pdb-ihm":let m=d=>d.startsWith("PDBDEV_")?d:`PDBDEV_${d.padStart(8,"0")}`;i=await Ff(o.params.provider.id,d=>{if(d.match(/^[1-9][A-Z0-9]{3}$/i)!==null)return o.params.provider.encoding==="bcif"?`https://pdb-ihm.org/bcif/${d.toLowerCase()}.bcif`:`https://pdb-ihm.org/cif/${d.toLowerCase()}.cif`;let p=m(d.toUpperCase());return o.params.provider.encoding==="bcif"?`https://pdb-ihm.org/bcif/${p}.bcif`:`https://pdb-ihm.org/cif/${p}.cif`},d=>{let p=d.toUpperCase();return p.match(/^[1-9][A-Z0-9]{3}$/)?`PDB-IHM: ${p}`:m(p)},o.params.provider.encoding==="bcif"),a=!!o.params.options.asTrajectory;break;case"swissmodel":i=await Ff(o.params.id,d=>`https://swissmodel.expasy.org/repository/uniprot/${d.toUpperCase()}.pdb`,d=>`SWISS-MODEL: ${d}`,!1),a=!!o.params.options.asTrajectory,s="pdb";break;case"alphafolddb":i=await Ff(o.params.provider.id,async d=>{let p=`https://www.alphafold.ebi.ac.uk/api/prediction/${d.toUpperCase()}`,h=await r.runTask(r.fetch({url:p,type:"json"}));if(Array.isArray(h)&&h.length>0){let f=o.params.provider.encoding==="bcif"?"bcifUrl":"cifUrl";return h[0][f]}throw new Error(`No AlphaFold DB entry for '${d}'`)},d=>`AlphaFold DB: ${d}`,o.params.provider.encoding==="bcif"),a=!!o.params.options.asTrajectory,s="mmcif";break;case"modelarchive":i=await Ff(o.params.id,d=>`https://www.modelarchive.org/doi/10.5452/${d.toLowerCase()}.cif`,d=>`Model Archive: ${d}`,!1),a=!!o.params.options.asTrajectory,s="mmcif";break;case"pubchem":i=await Ff(o.params.id,d=>`https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/${d.trim()}/record/SDF/?record_type=3d`,d=>`PubChem: ${d}`,!1),a=!!o.params.options.asTrajectory,s="mol";break;default:Rr(o)}let l=e.source.params.options.representation||r.config.get(Lr.Structure.DefaultRepresentationPreset)||Yl.auto.id,u=l!==Yl.empty.id,c=o.params.options.type.name==="auto"?void 0:o.params.options.type;await t.transaction(async()=>{if(i.length>0&&a){let m=await r.builders.data.downloadBlob({sources:i.map((p,h)=>({id:""+h,url:p.url,isBinary:p.isBinary})),maxConcurrency:6},{state:{isGhost:!0}}),d=await r.builders.structure.parseTrajectory(m,{formats:i.map((p,h)=>({id:""+h,format:"cif"}))});await r.builders.structure.hierarchy.applyPreset(d,"default",{structure:c,showUnitcell:u,representationPreset:l,representationPresetParams:e.source.params.options.representationParams})}else for(let m of i){let d=await r.builders.data.download(m,{state:{isGhost:!0}}),p=r.dataFormats.get(s);if(!p)throw new Error("unknown file format");let h=await r.builders.structure.parseTrajectory(d,p);await r.builders.structure.hierarchy.applyPreset(h,"default",{structure:c,showUnitcell:u,representationPreset:l,representationPresetParams:e.source.params.options.representationParams})}}).runInContext(n)}));async function Ff(e,t,r,n){let o=e.split(/[,\s]/).map(a=>a.trim()).filter(a=>!!a&&(a.length>=4||/^[1-9][0-9]*$/.test(a))),i=[];for(let a of o)i.push({url:Zr.Url(await t(a)),isBinary:n,label:r(a)});return i}async function Uut(e){if(e.name!=="pdb"||e.params.provider.server.name!=="pdbe")throw new Error("expected pdbe");return e.params.provider.server.params.variant==="updated"?Ff(e.params.provider.id,t=>`https://www.ebi.ac.uk/pdbe/static/entry/${t.toLowerCase()}_updated.cif`,t=>`PDBe: ${t} (updated cif)`,!1):e.params.provider.server.params.variant==="updated-bcif"?Ff(e.params.provider.id,t=>`https://www.ebi.ac.uk/pdbe/entry-files/download/${t.toLowerCase()}.bcif`,t=>`PDBe: ${t} (updated cif)`,!0):Ff(e.params.provider.id,t=>`https://www.ebi.ac.uk/pdbe/static/entry/${t.toLowerCase()}.cif`,t=>`PDBe: ${t} (cif)`,!1)}async function Nut(e){if(e.name!=="pdb"||e.params.provider.server.name!=="pdbj")throw new Error("expected pdbj");return Ff(e.params.provider.id,t=>`https://data.pdbjlc1.pdbj.org/pub/pdb/data/structures/divided/mmCIF/${t.toLowerCase().substring(1,3)}/${t.toLowerCase()}.cif`,t=>`PDBj: ${t} (cif)`,!1)}async function zut(e){if(e.name!=="pdb"||e.params.provider.server.name!=="rcsb")throw new Error("expected rcsb");return e.params.provider.server.params.encoding==="cif"?Ff(e.params.provider.id,t=>`https://files.rcsb.org/download/${t.toUpperCase()}.cif`,t=>`RCSB PDB: ${t} (cif)`,!1):Ff(e.params.provider.id,t=>`https://models.rcsb.org/${t.toUpperCase()}.bcif`,t=>`RCSB PDB: ${t} (bcif)`,!0)}var TR=Ss.build({display:{name:"Update Trajectory"},params:{action:C.Select("advance",C.arrayToOptions(["advance","reset"])),by:C.Optional(C.Numeric(1,{min:-1,max:1,step:1}))}})(({params:e,state:t})=>{let r=t.selectQ(o=>o.ofTransformer(Xe.Model.ModelFromTrajectory)),n=t.build();if(e.action==="reset")for(let o of r)n.to(o).update({modelIndex:0});else for(let o of r){let i=er.findAncestorOfType(t.tree,t.cells,o.transform.ref,re.Molecule.Trajectory);if(!i||!i.obj)continue;let a=i.obj;n.to(o).update(s=>{let l=(s.modelIndex+e.by)%a.data.frameCount;return l<0&&(l+=a.data.frameCount),{modelIndex:l}})}return t.updateTree(n)}),Hut=Ss.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:re.Molecule.Model,params(e,t){return t.customModelProperties.getParams(e?.data)},isApplicable(e,t,r){return t.transformer!==w_}})(({ref:e,params:t},r)=>r.builders.structure.insertModelProperties(e,t)),jut=Ss.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:re.Molecule.Structure,params(e,t){return t.customStructureProperties.getParams(e?.data)},isApplicable(e,t,r){return t.transformer!==E_}})(({ref:e,params:t},r)=>r.builders.structure.insertStructureProperties(e,t)),Wut=Ss.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:re.Root,params(e,t){let r=t.state.data,o=[...r.selectQ(s=>s.rootsOfType(re.Molecule.Model)),...r.selectQ(s=>s.rootsOfType(re.Molecule.Topology))].map(s=>[s.transform.ref,s.obj.label]),a=r.selectQ(s=>s.rootsOfType(re.Molecule.Coordinates)).map(s=>[s.transform.ref,s.obj.label]);return{model:C.Select(o.length?o[0][0]:"",o),coordinates:C.Select(a.length?a[0][0]:"",a)}}})(({params:e,state:t},r)=>Pe.create("Add Trajectory",n=>t.transaction(async()=>{let o=[e.model,e.coordinates],i=t.build().toRoot().apply(Pk,{modelRef:e.model,coordinatesRef:e.coordinates},{dependsOn:o}).apply(Xe.Model.ModelFromTrajectory,{modelIndex:0});await t.updateTree(i).runInContext(n);let a=await r.builders.structure.createStructure(i.selector);await r.builders.structure.representation.applyPreset(a,"auto")}).runInContext(n))),Xut=Ss.build({display:{name:"Load Trajectory",description:"Load trajectory of model/topology and coordinates from URL or file."},from:re.Root,params(e,t){let{options:r}=t.dataFormats,n=r.filter(s=>s[2]===vm||s[2]===wA),o=r.filter(s=>s[2]===aC),i=[],a=[];for(let{provider:s}of t.dataFormats.list)s.category===vm||s.category===wA?(s.binaryExtensions&&i.push(...s.binaryExtensions),s.stringExtensions&&i.push(...s.stringExtensions)):s.category===aC&&(s.binaryExtensions&&a.push(...s.binaryExtensions),s.stringExtensions&&a.push(...s.stringExtensions));return{source:C.MappedStatic("file",{url:C.Group({model:C.Group({url:C.Url(""),format:C.Select(n[0][0],n),isBinary:C.Boolean(!1)},{isExpanded:!0}),coordinates:C.Group({url:C.Url(""),format:C.Select(o[0][0],o)},{isExpanded:!0})},{isFlat:!0}),file:C.Group({model:C.File({accept:i.map(s=>`.${s}`).join(","),label:"Model"}),coordinates:C.File({accept:a.map(s=>`.${s}`).join(","),label:"Coordinates"})},{isFlat:!0})},{options:[["url","URL"],["file","File"]]})}}})(({params:e,state:t},r)=>Pe.create("Load Trajectory",n=>t.transaction(async()=>{let o=e.source;if(o.name==="file"&&(o.params.model===null||o.params.coordinates===null)){r.log.error("No file(s) selected");return}if(o.name==="url"&&(!o.params.model||!o.params.coordinates)){r.log.error("No URL(s) given");return}let i=async(s,l,u)=>{let c=await r.builders.data.download({url:s,isBinary:u}),m=r.dataFormats.get(l);if(!m){r.log.warn(`LoadTrajectory: could not find data provider for '${l}'`);return}return m.parse(r,c)},a=async s=>{if(!s)throw new Error("No file selected");let l=Hy(s.file?.name??""),u=r.dataFormats.binaryExtensions.has(l.ext),{data:c}=await r.builders.data.readFile({file:s,isBinary:u}),m=r.dataFormats.auto(l,c.cell?.obj);if(!m){r.log.warn(`LoadTrajectory: could not find data provider for '${l.ext}'`),await r.state.data.build().delete(c).commit();return}return m.parse(r,c)};try{let s=o.name==="url"?await i(o.params.model.url,o.params.model.format,o.params.model.isBinary):await a(o.params.model),l;"trajectory"in s?l=await t.build().to(s.trajectory).apply(D_,{modelIndex:0}).commit():l=s.topology;let u=o.name==="url"?await i(o.params.coordinates.url,o.params.coordinates.format,!0):await a(o.params.coordinates),c=[l.ref,u.ref],m=t.build().toRoot().apply(Pk,{modelRef:l.ref,coordinatesRef:u.ref},{dependsOn:c}).apply(Xe.Model.ModelFromTrajectory,{modelIndex:0});await t.updateTree(m).runInContext(n);let d=await r.builders.structure.createStructure(m.selector);await r.builders.structure.representation.applyPreset(d,"auto")}catch(s){console.error(s),r.log.error("Error loading trajectory")}}).runInContext(n)));var Ti=Rt(Pi());var AX=Rt(Pi());var ds=Rt(nr()),br=class extends AX.PureComponent{constructor(){super(...arguments);this.hide=()=>this.props.onSelect(void 0)}render(){let r=this.props,n=(0,ds.jsx)(vX,{items:r.items,onSelect:r.onSelect,current:r.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent});return(0,ds.jsxs)("div",{className:`msp-action-menu-options${r.header?"":" msp-action-menu-options-no-header"}`,children:[r.header&&(0,ds.jsx)(Cl,{header:r.header,title:r.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:dc,children:n}),!r.header&&n]})}};(l=>{function e(u,c){return c?{kind:"header",label:u,...c}:{kind:"header",label:u}}l.Header=e;function t(u,c,m){return{kind:"item",label:u,value:c,...m}}l.Item=t;function r(u,c){let{label:m,value:d,category:p,selected:h,icon:f,addOn:y,description:g}=c||{},x,S=[];for(let I=0;I<u.length;I++){let v=u[I];if(c?.filter&&!c.filter(v))continue;let A=p?.(v),_=m?m(v):""+v,T=d?d(v):v,w=g?g(v):typeof v=="string"?v:void 0,D;A?(x||(x=new Map),D=x.get(A),D||(D=[l.Header(A,{description:A})],x.set(A,D),S.push(D))):D=S;let M=y?.(v);D.push({kind:"item",label:_,value:T,icon:f?f(v):void 0,selected:h?h(v):void 0,addOn:M,description:w})}return S}l.createItems=r;let n={value:u=>u[0],label:u=>u[1],category:u=>u[2]};function o(u,c){return r(u,c?{...n,...c}:n)}l.createItemsFromSelectOptions=o;function i(u){if(jy(u))return!1;if(EA(u))return!!u.selected;for(let c of u)if(i(c))return!0;return!1}l.hasSelectedItem=i;function a(u,c){if(!jy(u)){if(EA(u))return u.value===c?u:void 0;for(let m of u){let d=a(m,c);if(d)return d}}}l.findItem=a;function s(u){if(!jy(u)){if(EA(u))return u;for(let c of u){let m=s(c);if(m)return m}}}l.getFirstItem=s})(br||={});var vX=class e extends AX.PureComponent{constructor(){super(...arguments);this.state=e.createState(this.props);this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()};this.selectAll=()=>{let r=IX(this.props.items,[]).filter(n=>!n.selected);this.props.onSelect(r)};this.selectNone=()=>{let r=IX(this.props.items,[]).filter(n=>!!n.selected);this.props.onSelect(r)}}static createState(r,n){let o=SX(r.items)&&jy(r.items[0])?r.items[0]:void 0,i=o?.isIndependent?!1:r.multiselect?br.hasSelectedItem(r.items):!!r.current&&!!br.findItem(r.items,r.current.value)||br.hasSelectedItem(r.items);return{header:o,hasCurrent:i,isExpanded:i||(n??!!o?.initiallyExpanded)}}componentDidUpdate(r){if(this.props.items!==r.items||this.props.current!==r.current){let n=SX(this.props.items)&&SX(r.items)&&jy(this.props.items[0])&&jy(r.items[0])&&this.props.items[0].label===r.items[0].label?this.state.isExpanded:void 0;this.setState(e.createState(this.props,n))}}get multiselectHeader(){let{header:r,hasCurrent:n}=this.state;return(0,ds.jsxs)("div",{className:"msp-flex-row msp-control-group-header",children:[(0,ds.jsx)(sr,{icon:this.state.isExpanded?wu:Eu,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?"collapse":"expand"}.${r?.description?` ${r?.description}`:""}`,children:n?(0,ds.jsx)("b",{children:r?.label}):r?.label}),(0,ds.jsx)(sr,{icon:Lm,flex:!0,onClick:this.selectAll,style:{flex:"0 0 50px",textAlign:"right"},children:"All"}),(0,ds.jsx)(sr,{icon:dc,flex:!0,onClick:this.selectNone,style:{flex:"0 0 50px",textAlign:"right"},children:"None"})]})}get basicHeader(){let{header:r,hasCurrent:n}=this.state;return(0,ds.jsx)("div",{className:"msp-control-group-header",style:{marginTop:"1px"},children:(0,ds.jsx)(sr,{noOverflow:!0,icon:this.state.isExpanded?wu:Eu,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?"collapse":"expand"}. ${r?.description?r?.description:""}`,children:n?(0,ds.jsx)("b",{children:r?.label}):r?.label})})}render(){let{items:r,onSelect:n,current:o}=this.props;if(jy(r))return null;if(EA(r))return(0,ds.jsx)(BTe,{item:r,onSelect:n,current:o,multiselect:this.props.multiselect});let{header:i}=this.state;return(0,ds.jsxs)(ds.Fragment,{children:[i&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),(0,ds.jsx)("div",{className:this.props.noOffset?void 0:this.props.noAccent?"msp-control-offset":"msp-accent-offset",children:(!i||this.state.isExpanded)&&r.map((a,s)=>jy(a)?null:EA(a)?(0,ds.jsx)(BTe,{item:a,onSelect:n,current:o,multiselect:this.props.multiselect},s):(0,ds.jsx)(e,{items:a,onSelect:n,current:o,multiselect:this.props.multiselect,noAccent:!0},s))})]})}},BTe=({item:e,onSelect:t,current:r,multiselect:n})=>{let o=r===e,i=e.addOn?{position:"relative"}:void 0;return(0,ds.jsxs)(sr,{icon:e.icon,noOverflow:!0,className:"msp-action-menu-button",onClick:a=>t(n?[e]:e,a),disabled:e.disabled,style:i,title:e.description,children:[o||e.selected?(0,ds.jsx)("b",{children:e.label}):e.label,e.addOn]})};function SX(e){return!!e&&Array.isArray(e)}function EA(e){let t=e;return t&&t.kind==="item"}function jy(e){let t=e;return t&&t.kind==="header"}function IX(e,t){if(jy(e))return t;if(EA(e))return t.push(e),t;for(let r of e)IX(r,t);return t}var kTe=Rt(Pi());var TX=[["black",0],["gray",8421504],["white",16777215],["red",13840661],["orange",14840576],["yellow",16565248],["green",6863872],["cyan",1484197],["blue",40160],["purple",8086783],["magenta",16394495],["violet",8200583]];var ws=Rt(nr()),MA=class extends kTe.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!!this.props.param.isExpanded||!!this.props.hideNameRow,lightness:0};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()};this.onClickSwatch=r=>{let n=Fe.fromHexString(r.currentTarget.getAttribute("data-color")||"0");n!==this.props.value&&(this.props.param.isExpanded||this.setState({isExpanded:!1}),this.update(n))};this.onR=r=>{let[,n,o]=Fe.toRgb(this.props.value),i=Fe.fromRgb(r,n,o);i!==this.props.value&&this.update(i)};this.onG=r=>{let[n,,o]=Fe.toRgb(this.props.value),i=Fe.fromRgb(n,r,o);i!==this.props.value&&this.update(i)};this.onB=r=>{let[n,o]=Fe.toRgb(this.props.value),i=Fe.fromRgb(n,o,r);i!==this.props.value&&this.update(i)};this.onRGB=r=>{let n=Fe.fromHexStyle(r.currentTarget.value||"0");n!==this.props.value&&this.update(n)};this.onLighten=()=>{this.update(Fe.lighten(this.props.value,.1))};this.onDarken=()=>{this.update(Fe.darken(this.props.value,.1))}}update(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})}swatch(){return(0,ws.jsx)("div",{className:"msp-combined-color-swatch",children:TX.map(r=>(0,ws.jsx)(sr,{inline:!0,"data-color":r[1],onClick:this.onClickSwatch,style:{background:Fe.toStyle(r[1])}},r[1]))})}render(){let r=this.props.param.label||Ls(this.props.name),[n,o,i]=Fe.toRgb(this.props.value),a=(0,ws.jsxs)(ws.Fragment,{children:[this.swatch(),(0,ws.jsx)(Sl,{label:"RGB",className:"msp-control-label-short",control:(0,ws.jsxs)("div",{style:{display:"flex",textAlignLast:"center",left:"80px"},children:[(0,ws.jsx)(fc,{onChange:this.onR,numeric:!0,value:n,delayMs:250,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,ws.jsx)(fc,{onChange:this.onG,numeric:!0,value:o,delayMs:250,style:{order:2,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,ws.jsx)(fc,{onChange:this.onB,numeric:!0,value:i,delayMs:250,style:{order:3,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,ws.jsx)("input",{onInput:this.onRGB,type:"color",value:Fe.toHexStyle(this.props.value),style:{order:4,flex:"1 1 auto",minWidth:"32px",width:"32px",height:"32px",padding:"0 2px 0 2px",background:"none",border:"none",cursor:"pointer"}})]})}),(0,ws.jsxs)("div",{style:{display:"flex",textAlignLast:"center"},children:[(0,ws.jsx)(sr,{onClick:this.onLighten,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",children:"Lighten"}),(0,ws.jsx)(sr,{onClick:this.onDarken,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",children:"Darken"})]})]});return this.props.hideNameRow?a:(0,ws.jsxs)(ws.Fragment,{children:[(0,ws.jsx)(Sl,{title:this.props.param.description,label:r,control:(0,ws.jsx)(sr,{onClick:this.toggleExpanded,inline:!0,className:"msp-combined-color-button",style:{background:Fe.toStyle(this.props.value)}})}),this.state.isExpanded&&(0,ws.jsx)("div",{className:"msp-control-offset",children:a})]})}};var ksn=function(){let e=new Map;for(let t of TX)e.set(t[1],t[0]);return e}();var RX=Rt(Pi()),tg=Rt(nr());function LTe(e){switch(e.kind){case"scale-legend":return PX;case"table-legend":return _X;default:console.warn(`${e} has no associated UI component`);return}}var PX=class extends RX.PureComponent{render(){let{legend:t}=this.props,r=t.colors.map(n=>Array.isArray(n)?`${Fe.toStyle(n[0])} ${100*n[1]}%`:Fe.toStyle(n)).join(", ");return(0,tg.jsx)("div",{className:"msp-scale-legend",children:(0,tg.jsxs)("div",{style:{background:`linear-gradient(to right, ${r})`},children:[(0,tg.jsx)("span",{style:{float:"left"},children:t.minLabel}),(0,tg.jsx)("span",{style:{float:"right"},children:t.maxLabel})]})})}},_X=class extends RX.PureComponent{render(){let{legend:t}=this.props;return(0,tg.jsx)("div",{className:"msp-table-legend",children:t.table.map((r,n)=>{let[o,i]=r;return(0,tg.jsxs)("div",{children:[(0,tg.jsx)("div",{className:"msp-table-legend-color",style:{backgroundColor:Fe.toStyle(i)}}),(0,tg.jsx)("div",{className:"msp-table-legend-text",children:o})]},n)})})}};var FTe=Rt(Pi());var VTe=Rt(nr()),AF=class extends FTe.Component{constructor(t){super(t),this.state={show:!1},this.handleHover=this.handleHover.bind(this),this.handleHoverOff=this.handleHoverOff.bind(this),this.deletePoint=this.deletePoint.bind(this)}handleHover(){this.setState({show:!0});let t=Ie.create(this.props.nX,this.props.nY);this.props.onmouseover(t)}handleHoverOff(){this.setState({show:!1}),this.props.onmouseover(void 0)}deletePoint(){this.props.delete(this.props.id)}render(){return[(0,VTe.jsx)("circle",{r:"10",id:`${this.props.id}`,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"},`${this.props.id}circle`)]}};var PF=Rt(Pi());var rg=Rt(nr()),TF=class extends PF.Component{constructor(r){super(r);this.handleKeyDown=r=>{};this.handleKeyUp=r=>{};this.handleClick=r=>n=>{};this.handleMouseDown=r=>n=>{if(r===0||r===this.state.points.length-1||this.state.canSelectMultiple)return;let o=this.normalizePoint(Ie.create(this.state.points[r][0],this.state.points[r][1]));this.ghostPoints.push(document.createElementNS(this.namespace,"circle")),this.ghostPoints[0].setAttribute("r","10"),this.ghostPoints[0].setAttribute("fill","orange"),this.ghostPoints[0].setAttribute("cx",`${o[0]}`),this.ghostPoints[0].setAttribute("cy",`${o[1]}`),this.ghostPoints[0].setAttribute("style","display: none"),this.gElement.appendChild(this.ghostPoints[0]),this.updatedX=o[0],this.updatedY=o[1],this.selected=[r]};this.deletePoint=r=>n=>{if(r===0||r===this.state.points.length-1)return;let o=this.state.points.filter((i,a)=>a!==r);o.sort((i,a)=>i[0]===a[0]?i[0]===0?i[1]-a[1]:i[1]===1?a[1]-i[1]:i[1]-a[1]:i[0]-a[0]),this.setState({points:o}),this.change(o),n.stopPropagation()};this.myRef=PF.createRef(),this.state={points:[Ie.create(0,0),Ie.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},this.height=400,this.width=600,this.padding=70,this.selected=void 0,this.ghostPoints=[],this.namespace="http://www.w3.org/2000/svg";for(let n of this.props.data)this.state.points.push(n);this.state.points.sort((n,o)=>n[0]===o[0]?n[0]===0?n[1]-o[1]:n[1]===1?o[1]-n[1]:n[1]-o[1]:n[0]-o[0]),this.handleDrag=this.handleDrag.bind(this),this.handleMultipleDrag=this.handleMultipleDrag.bind(this),this.handleDoubleClick=this.handleDoubleClick.bind(this),this.refCallBack=this.refCallBack.bind(this),this.handlePointUpdate=this.handlePointUpdate.bind(this),this.change=this.change.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleLeave=this.handleLeave.bind(this),this.handleEnter=this.handleEnter.bind(this)}render(){let r=this.renderPoints(),n=this.renderLines(),o=this.renderHistogram();return[(0,rg.jsx)("div",{children:(0,rg.jsxs)("svg",{className:"msp-canvas",ref:this.refCallBack,viewBox:`0 0 ${this.width+this.padding} ${this.height+this.padding}`,onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick,children:[(0,rg.jsxs)("g",{stroke:"black",fill:"black",children:[o,n,r]}),(0,rg.jsx)("g",{className:"ghost-points",stroke:"black",fill:"black"})]})},"LineGraph"),(0,rg.jsx)("div",{id:"modal-root"},"modal")]}componentDidMount(){this.gElement=document.getElementsByClassName("ghost-points")[0]}change(r){let n=r.slice();n.shift(),n.pop(),this.props.onChange(n)}handleDrag(r){if(this.selected===void 0)return;let n=this.myRef.createSVGPoint(),o,i=this.padding/2;n.x=r.clientX,n.y=r.clientY;let a=n.matrixTransform(this.myRef.getScreenCTM().inverse());o=Ie.create(a.x,a.y),(a.x<i||a.x>this.width+i)&&(a.y>this.height+i||a.y<i)?o=Ie.create(this.updatedX,this.updatedY):a.x<i?o=Ie.create(i,a.y):a.x>this.width+i?o=Ie.create(this.width+i,a.y):a.y>this.height+i?o=Ie.create(a.x,this.height+i):a.y<i?o=Ie.create(a.x,i):o=Ie.create(a.x,a.y),this.updatedX=o[0],this.updatedY=o[1];let s=this.unNormalizePoint(o);this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx",`${o[0]}`),this.ghostPoints[0].setAttribute("cy",`${o[1]}`),this.props.onDrag(s)}handleMultipleDrag(){}handlePointUpdate(r){let n=this.selected;if(this.state.canSelectMultiple)return;if(n===void 0||n[0]===0||n[0]===this.state.points.length-1){this.setState({copyPoint:void 0});return}this.selected=void 0;let o=this.unNormalizePoint(Ie.create(this.updatedX,this.updatedY)),i=this.state.points.filter((a,s)=>s!==n[0]);i.push(o),i.sort((a,s)=>a[0]===s[0]?a[0]===0?a[1]-s[1]:a[1]===1?s[1]-a[1]:a[1]-s[1]:a[0]-s[0]),this.setState({points:i}),this.change(i),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}handleDoubleClick(r){let n=this.myRef.createSVGPoint();n.x=r.clientX,n.y=r.clientY;let o=n.matrixTransform(this.myRef.getScreenCTM().inverse()),i=this.state.points,a=this.padding/2;if(o.x<a||o.x>this.width+a||o.y>this.height+a||o.y<this.padding/2)return;let s=this.unNormalizePoint(Ie.create(o.x,o.y));i.push(s),i.sort((l,u)=>l[0]===u[0]?l[0]===0?l[1]-u[1]:l[1]===1?u[1]-l[1]:l[1]-u[1]:l[0]-u[0]),this.setState({points:i}),this.change(i)}handleLeave(){this.selected!==void 0&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))}handleEnter(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}normalizePoint(r){let n=this.padding/2,o=this.width+n,i=this.height+n,a=r[0]*(o-n)+n,s=r[1]*(i-n)+n,l=this.height+this.padding-s;return Ie.create(a,l)}unNormalizePoint(r){let n=this.padding/2,o=this.width+n,i=this.height+n,a=(r[0]-n)/(o-n),s=(this.height+this.padding-r[1]-n)/(i-n);return Ie.create(a,s)}refCallBack(r){r&&(this.myRef=r)}renderHistogram(){if(!this.props.volume)return null;let r=Xn.getHistogram(this.props.volume.grid,40),n=[],o=r.counts.length,i=this.width/o,a=this.padding/2,s=ol(r.counts)||1;for(let l=0;l<o;l++){let u=this.width*l/(o-1)+a,c=this.height+a,m=this.height*(1-r.counts[l]/s)+a;n.push((0,rg.jsx)("line",{x1:u,x2:u,y1:c,y2:m,stroke:"#ded9ca",strokeWidth:i},`histogram${l}`))}return n}renderPoints(){let r=[],n;for(let o=0;o<this.state.points.length;o++)o!==0&&o!==this.state.points.length-1&&(n=this.normalizePoint(this.state.points[o]),r.push((0,rg.jsx)(AF,{id:o,x:n[0],y:n[1],nX:this.state.points[o][0],nY:this.state.points[o][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(o),onclick:this.handleClick(o)},o)));return r}renderLines(){let r=[],n=[],o,i,a,s,l,u=this.padding/2;for(let d of this.state.points)o=this.width+u,i=this.height+this.padding,a=d[0]*(o-u)+u,s=d[1]*(i-u)+u,l=this.height+this.padding-s,r.push(Ie.create(a,l));let c=r,m=c.length;for(let d=0;d<m-1;d++){let p=c[d][0],h=c[d][1],f=c[d+1][0],y=c[d+1][1];n.push((0,rg.jsx)("line",{x1:p,x2:f,y1:h,y2:y,stroke:"#cec9ba",strokeWidth:"5"},`lineOf${d}`))}return n}};var ng=Rt(Pi());var Kl=Rt(nr()),BA=class extends ng.Component{constructor(){super(...arguments);this.state={isChanging:!1,current:0};this.begin=()=>{this.setState({isChanging:!0})};this.end=r=>{this.setState({isChanging:!1}),this.props.onChange(r)};this.updateCurrent=r=>{this.setState({current:r}),this.props.onChangeImmediate?.(r)};this.updateManually=r=>{this.setState({isChanging:!0});let n=r;this.props.step===1&&(n=Math.round(n)),n<this.props.min&&(n=this.props.min),n>this.props.max&&(n=this.props.max),this.setState({current:n,isChanging:!0})};this.onManualBlur=()=>{this.setState({isChanging:!1}),this.props.onChange(this.state.current)};this.onMouseWheel=r=>{let{dx:n,dy:o,dz:i}=c8(r),a=(n>=0?1:-1)*(o>=0?1:-1)*(i>=0?1:-1),s=r.getModifierState("Shift"),l=a*(this.props.max-this.props.min)/(s?100:25);this.updateCurrent(this.state.current+l)}}static getDerivedStateFromProps(r,n){return n.isChanging||r.value===n.current?null:{current:r.value}}render(){let r=this.props.step;return r===void 0&&(r=1),(0,Kl.jsxs)("div",{className:"msp-slider",children:[(0,Kl.jsx)("div",{children:(0,Kl.jsx)(RF,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onWheel:this.onMouseWheel,onChange:this.updateCurrent,onAfterChange:this.end})}),(0,Kl.jsx)("div",{children:(0,Kl.jsx)(fc,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually})})]})}},_F=class extends ng.Component{constructor(){super(...arguments);this.state={isChanging:!1,current:[0,1]};this.begin=()=>{this.setState({isChanging:!0})};this.end=r=>{this.setState({isChanging:!1}),this.props.onChange(r)};this.updateCurrent=r=>{this.setState({current:r})};this.updateMax=r=>{let n=r;this.props.step===1&&(n=Math.round(n)),n<this.state.current[0]?n=this.state.current[0]:n<this.props.min&&(n=this.props.min),n>this.props.max&&(n=this.props.max),this.props.onChange([this.state.current[0],n])};this.updateMin=r=>{let n=r;this.props.step===1&&(n=Math.round(n)),n<this.props.min&&(n=this.props.min),n>this.state.current[1]?n=this.state.current[1]:n>this.props.max&&(n=this.props.max),this.props.onChange([n,this.state.current[1]])}}static getDerivedStateFromProps(r,n){return n.isChanging||r.value[0]===n.current[0]&&r.value[1]===n.current[1]?null:{current:r.value}}render(){let r=this.props.step;return r===void 0&&(r=1),(0,Kl.jsxs)("div",{className:"msp-slider2",children:[(0,Kl.jsx)("div",{children:(0,Kl.jsx)(fc,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin})}),(0,Kl.jsx)("div",{children:(0,Kl.jsx)(RF,{min:this.props.min,max:this.props.max,step:r,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0})}),(0,Kl.jsx)("div",{children:(0,Kl.jsx)(fc,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax})})]})}};function wX(e){let t=[],r={}.hasOwnProperty;for(let n=0;n<arguments.length;n++){let o=arguments[n];if(!o)continue;let i=typeof o;if(i==="string"||i==="number")t.push(o);else if(Array.isArray(o))t.push(wX.apply(null,o));else if(i==="object")for(let a in o)r.call(o,a)&&o[a]&&t.push(a)}return t.join(" ")}function OTe(e){return e.touches.length>1||e.type.toLowerCase()==="touchend"&&e.touches.length>0}function GTe(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function UTe(e,t){return e?t.clientY:t.pageX}function NTe(e,t){let r=t.getBoundingClientRect();return e?r.top+r.height*.5:r.left+r.width*.5}function DX(e){e.stopPropagation(),e.preventDefault()}var EX=class extends ng.Component{render(){let{className:t,tipFormatter:r,vertical:n,offset:o,value:i,index:a}=this.props,s=n?{bottom:`${o}%`}:{left:`${o}%`};return(0,Kl.jsx)("div",{className:t,style:s,title:r(i,a)})}},RF=class extends ng.Component{constructor(r){super(r);this.sliderElement=ng.createRef();this.handleElements=[];this.dragOffset=0;this.startPosition=0;this.startValue=0;this._getPointsCache=void 0;this.onMouseDown=r=>{if(r.button!==0)return;let n=UTe(this.props.vertical,r);if(!this.isEventFromHandle(r))this.dragOffset=0;else{let o=NTe(this.props.vertical,r.target);this.dragOffset=n-o,n=o}this.onStart(n),this.addDocumentEvents("mouse"),DX(r)};this.onTouchMove=r=>{if(OTe(r)){this.end("touch");return}let n=GTe(this.props.vertical,r);this.onMove(r,n-this.dragOffset)};this.onTouchStart=r=>{if(OTe(r))return;let n=GTe(this.props.vertical,r);if(!this.isEventFromHandle(r))this.dragOffset=0;else{let o=NTe(this.props.vertical,r.target);this.dragOffset=n-o,n=o}this.onStart(n),this.addDocumentEvents("touch"),DX(r)};this.eventHandlers={touchmove:r=>this.onTouchMove(r),touchend:r=>this.end("touch"),mousemove:r=>this.onMouseMove(r),mouseup:r=>this.end("mouse")};this.calcOffset=r=>{let{min:n,max:o}=this.props;return(r-n)/(o-n)*100};let{range:n,min:o,max:i}=r,a=n?Array.apply(null,Array(+n+1)).map(()=>o):o,s="defaultValue"in r?r.defaultValue:a,l=r.value!==void 0?r.value:s,u=(n?l:[o,l]).map(m=>this.trimAlignValue(m)),c;n&&u[0]===u[u.length-1]&&u[0]===i?c=0:c=u.length-1,this.state={handle:null,recent:c,bounds:u}}static{this.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:(0,Kl.jsx)(EX,{className:"",vertical:!1,offset:0,tipFormatter:r=>r,value:0,index:0}),onBeforeChange:iu,onChange:iu,onAfterChange:iu,tipFormatter:(r,n)=>r,disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1}}componentDidUpdate(r){if(!("value"in this.props||"min"in this.props||"max"in this.props))return;let{bounds:n}=this.state;if(r.range){let i=(this.props.value||n).map(a=>this.trimAlignValue(a,this.props));if(i.every((a,s)=>a===n[s]))return;this.setState({bounds:i}),n.some(a=>this.isValueOutOfBounds(a,this.props))&&this.props.onChange(i)}else{let o=this.props.value!==void 0?this.props.value:n[1],i=this.trimAlignValue(o,this.props);if(i===n[1]&&n[0]===r.min)return;this.setState({bounds:[r.min,i]}),this.isValueOutOfBounds(n[1],this.props)&&this.props.onChange(i)}}onChange(r){let n=this.props;!("value"in n)?this.setState(r):r.handle!==void 0&&this.setState({handle:r.handle});let i={...this.state,...r},a=n.range?i.bounds:i.bounds[1];n.onChange(a)}onMouseMove(r){let n=UTe(this.props.vertical,r);this.onMove(r,n-this.dragOffset)}onMove(r,n){DX(r);let o=this.props,i=this.state,a=n-this.startPosition;a=this.props.vertical?-a:a;let s=a/this.getSliderLength()*(o.max-o.min),l=this.trimAlignValue(this.startValue+s),u=i.bounds[i.handle];if(l===u)return;let c=[...i.bounds];c[i.handle]=l;let m=i.handle;if(o.pushable){let d=i.bounds[m];this.pushSurroundingHandles(c,m,d)}else o.allowCross&&(c.sort((d,p)=>d-p),m=c.indexOf(l));this.onChange({handle:m,bounds:c})}onStart(r){this.props.onBeforeChange(this.getValue());let o=this.calcValueByPos(r);this.startValue=o,this.startPosition=r;let i=this.state,{bounds:a}=i,s=1;if(this.props.range){let c=0;for(let d=1;d<a.length-1;++d)o>a[d]&&(c=d);Math.abs(a[c+1]-o)<Math.abs(a[c]-o)&&(c=c+1),s=c;let m=a[c+1]===a[c];m&&(s=i.recent),m&&o!==a[c+1]&&(s=o<a[c+1]?c:c+1)}this.setState({handle:s,recent:s});let l=i.bounds[s];if(o===l)return;let u=[...i.bounds];u[s]=o,this.onChange({bounds:u})}getPoints(){let{marks:r,step:n,min:o,max:i}=this.props,a=this._getPointsCache;if(!a||a.marks!==r||a.step!==n){let s={...r};if(n!==null)for(let u=o;u<=i;u+=n)s[u]=u;let l=Object.keys(s).map(parseFloat);l.sort((u,c)=>u-c),this._getPointsCache={marks:r,step:n,points:l}}return this._getPointsCache.points}getPrecision(r){let n=r.toString(),o=0;return n.indexOf(".")>=0&&(o=n.length-n.indexOf(".")-1),o}getSliderLength(){let r=this.sliderElement.current;return r?this.props.vertical?r.clientHeight:r.clientWidth:0}getSliderStart(){let n=this.sliderElement.current.getBoundingClientRect();return this.props.vertical?n.top:n.left}getValue(){let{bounds:r}=this.state;return this.props.range?r:r[1]}addDocumentEvents(r){r==="touch"?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))}calcValue(r){let{vertical:n,min:o,max:i}=this.props,a=Math.abs(r/this.getSliderLength());return n?(1-a)*(i-o)+o:a*(i-o)+o}calcValueByPos(r){let n=r-this.getSliderStart();return this.trimAlignValue(this.calcValue(n))}end(r){this.removeEvents(r),this.props.onAfterChange(this.getValue()),this.setState({handle:null})}isEventFromHandle(r){for(let n of this.handleElements)if(n.current===r.target)return!0;return!1}isValueOutOfBounds(r,n){return r<n.min||r>n.max}pushHandle(r,n,o,i){let a=r[n],s=r[n];for(;o*(s-a)<i;){if(!this.pushHandleOnePoint(r,n,o))return r[n]=a,!1;s=r[n]}return!0}pushHandleOnePoint(r,n,o){let i=this.getPoints(),s=i.indexOf(r[n])+o;if(s>=i.length||s<0)return!1;let l=n+o,u=i[s],{pushable:c}=this.props,m=o*(r[l]-u);return this.pushHandle(r,l,o,+c-m)?(r[n]=u,!0):!1}pushSurroundingHandles(r,n,o){let{pushable:i}=this.props,a=r[n],s=0;if(r[n+1]-a<+i?s=1:a-r[n-1]<+i&&(s=-1),s===0)return;let l=n+s,u=s*(r[l]-a);this.pushHandle(r,l,s,+i-u)||(r[n]=o)}removeEvents(r){r==="touch"?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):r==="mouse"&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))}trimAlignValue(r,n){let{handle:o,bounds:i}=this.state||{},{marks:a,step:s,min:l,max:u,allowCross:c}={...this.props,...n||{}},m=r;m<=l&&(m=l),m>=u&&(m=u),!c&&o!=null&&o>0&&m<=i[o-1]&&(m=i[o-1]),!c&&o!=null&&o<i.length-1&&m>=i[o+1]&&(m=i[o+1]);let d=Object.keys(a).map(parseFloat);if(s!==null){let f=Math.round((m-l)/s)*s+l;d.push(f)}let p=d.map(f=>Math.abs(m-f)),h=d[p.indexOf(Math.min.apply(Math,p))];return s!==null?parseFloat(h.toFixed(this.getPrecision(s))):h}render(){let{handle:r,bounds:n}=this.state,{className:o,prefixCls:i,disabled:a,vertical:s,range:l,step:u,marks:c,tipFormatter:m}=this.props,d=this.props.handle,p=n.map(this.calcOffset),h=`${i}-handle`,f=n.map((I,v)=>wX({[h]:!0,[`${h}-${v+1}`]:!0,[`${h}-lower`]:v===0,[`${h}-upper`]:v===n.length-1})),g={prefixCls:i,noTip:u===null||m===null,tipFormatter:m,vertical:s};if(this.handleElements.length!==n.length){this.handleElements=[];for(let I=0;I<n.length;I++)this.handleElements.push(ng.createRef())}let x=n.map((I,v)=>ng.cloneElement(d,{...g,className:f[v],value:I,offset:p[v],dragging:r===v,index:v,key:v,ref:this.handleElements[v]}));l||x.shift();let S=wX({[i]:!0,[`${i}-with-marks`]:Object.keys(c).length,[`${i}-disabled`]:a,[`${i}-vertical`]:this.props.vertical,[o]:!!o});return(0,Kl.jsxs)("div",{ref:this.sliderElement,className:S,onTouchStart:a?iu:this.onTouchStart,onMouseDown:a?iu:this.onMouseDown,onWheel:a?iu:this.props.onWheel,children:[(0,Kl.jsx)("div",{className:`${i}-rail`}),x]})}};var $e=Rt(nr()),Kn=class extends Ti.PureComponent{constructor(){super(...arguments);this.onChange=r=>{if(this.props.onChange?.(r,this.props.values),this.props.onChangeValues){let n={...this.props.values,[r.name]:r.value};this.props.onChangeValues(n,this.props.values)}};this.paramGroups=uu(r=>Qut(r))}renderGroup(r){if(r.length===0)return null;let n=this.props.values,o=null,i;for(let[a,s,l]of r)s.hideIf?.(n)||(o||(o=[]),i=s.category,o.push((0,$e.jsx)(l,{param:s,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:a,value:n[a]},a)));return o?i?[(0,$e.jsx)(Ja,{header:i,children:o},i)]:o:null}renderPart(r){let n=null;for(let o of r){let i=this.renderGroup(o);if(i){n||(n=[]);for(let a of i)n.push(a)}}return n}render(){let r=this.paramGroups(this.props.params),n=this.renderPart(r.essentials),o=this.renderPart(r.advanced);return n&&o?(0,$e.jsxs)($e.Fragment,{children:[n,(0,$e.jsx)(Ja,{header:"Advanced Options",children:o})]}):n||o}},wF=class extends Ir{constructor(){super(...arguments);this.state={isDisabled:!1};this.setSettings=(r,n)=>{let o={...n,[r.name]:r.value},i=this.props.mapping.update(o,this.plugin);this.props.mapping.apply(i,this.plugin)}}componentDidMount(){this.subscribe(this.plugin.state.data.behaviors.isUpdating,r=>{this.setState({isDisabled:r})})}render(){let r=this.props.mapping.getTarget(this.plugin),n=this.props.mapping.getValues(r,this.plugin),o=this.props.mapping.params(this.plugin);return(0,$e.jsx)(Kn,{params:o,values:n,onChange:this.setSettings,isDisabled:this.state.isDisabled})}};function Qut(e){function t(a,s,l){let u=DR(s);if(u)if(!s.category)l.params[0].push([a,s,u]);else{l.map||(l.map=new Map);let c=l.map.get(s.category);c||(c=[],l.map.set(s.category,c),l.params.push(c)),c.push([a,s,u])}}function r(a,s){let l=a[0],u=s[0];return!l||!l[1].category?-1:!u||!u[1].category?1:l[1].category<u[1].category?-1:1}let n=Object.keys(e),o={params:[[]],map:void 0},i={params:[[]],map:void 0};for(let a of n){let s=e[a];s.isHidden||(s.isEssential?t(a,s,o):t(a,s,i))}return o.params.sort(r),i.params.sort(r),{essentials:o.params,advanced:i.params}}function DR(e){switch(e.type){case"value":return;case"boolean":return _R;case"number":return typeof e.min<"u"&&typeof e.max<"u"?kX:BX;case"converted":return ZX;case"conditioned":return QX;case"multi-select":return jX;case"color":return MA;case"color-list":return e.offsets?OX:VX;case"vec3":return GX;case"mat4":return UX;case"url":return NX;case"file":return zX;case"file-list":return HX;case"select":return kA;case"value-ref":return MF;case"data-ref":return;case"text":return EF;case"interval":return typeof e.min<"u"&&typeof e.max<"u"?FX:LX;case"group":return BF;case"mapped":return WX;case"line-graph":return MX;case"script":return qX;case"object-list":return RR;default:console.warn(`${e} has no associated UI component`);return}}var PR=class extends Ti.PureComponent{render(){let{legend:t,description:r}=this.props,n=t&&LTe(t);return(0,$e.jsx)("div",{className:"msp-help-text",children:(0,$e.jsxs)("div",{children:[(0,$e.jsxs)("div",{className:"msp-help-description",children:[(0,$e.jsx)(yn,{svg:Mu,inline:!0}),r]}),n&&(0,$e.jsx)("div",{className:"msp-help-legend",children:(0,$e.jsx)(n,{legend:t})})]})})}};function OS(e){let{props:t,state:r,control:n,toggleHelp:o,addOn:i}=e,a=[];t.param.shortLabel&&a.push("msp-control-label-short"),t.param.twoColumns&&a.push("msp-control-col-2"),t.param.multiline&&a.push("msp-control-twoline");let s=a.join(" "),l=t.param.label||Ls(t.name),u=t.param.help?t.param.help(t.value):{description:t.param.description,legend:t.param.legend},c=u.description||u.legend,m=l+(c?". Click for help.":"");return(0,$e.jsxs)($e.Fragment,{children:[(0,$e.jsx)(Sl,{className:s,title:m,label:(0,$e.jsxs)($e.Fragment,{children:[l,c&&(0,$e.jsx)(YX,{show:r.showHelp,toggle:o,title:m})]}),control:n}),c&&r.showHelp&&(0,$e.jsx)("div",{className:"msp-control-offset",children:(0,$e.jsx)(PR,{legend:u.legend,description:u.description})}),i]})}function YX({show:e,toggle:t,title:r}){return(0,$e.jsx)("button",{className:"msp-help msp-btn-link msp-btn-icon msp-control-group-expander",onClick:t,title:r||`${e?"Hide":"Show"} help`,style:{background:"transparent",textAlign:"left",padding:"0"},children:(0,$e.jsx)(yn,{svg:Mu})})}var VS=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1};this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})}renderAddOn(){return null}render(){return OS({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}},_R=class extends VS{constructor(){super(...arguments);this.onClick=r=>{this.update(!this.props.value),r.currentTarget.blur()}}renderControl(){return(0,$e.jsxs)("button",{onClick:this.onClick,disabled:this.props.isDisabled,children:[(0,$e.jsx)(yn,{svg:this.props.value?Lm:xN}),this.props.value?"On":"Off"]})}},MX=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1,isOverPoint:!1,message:`${this.props.param.defaultValue.length} points`};this.onHover=r=>{this.setState({isOverPoint:!this.state.isOverPoint}),r?this.setState({message:this.pointToLabel(r)}):this.setState({message:`${this.props.value.length} points`})};this.onDrag=r=>{this.setState({message:this.pointToLabel(r)})};this.onChange=r=>{this.props.onChange({name:this.props.name,param:this.props.param,value:r})};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}pointToLabel(r){if(!r)return"";let n=this.props.param.getVolume?.();if(n){let{min:o,max:i,mean:a,sigma:s}=n.grid.stats,l=o+(i-o)*r[0],u=(l-a)/s;return`(${l.toFixed(2)} | ${u.toFixed(2)}\u03C3, ${r[1].toFixed(2)})`}else return`(${r[0].toFixed(2)}, ${r[1].toFixed(2)})`}render(){let r=this.props.param.label||Ls(this.props.name);return(0,$e.jsxs)($e.Fragment,{children:[(0,$e.jsx)(Sl,{label:r,control:(0,$e.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:`${this.state.message}`})}),(0,$e.jsx)("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none",marginTop:1},children:(0,$e.jsx)(TF,{data:this.props.value,volume:this.props.param.getVolume?.(),onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag})})]})}},BX=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={value:"0"};this.update=r=>{let n=U0(this.props.param.step||.01);r=parseFloat(r.toFixed(n)),this.props.onChange({param:this.props.param,name:this.props.name,value:r})}}render(){let r=this.props.param.label||Ls(this.props.name),n=this.props.param.label||Ls(this.props.name),o=U0(this.props.param.step||.01);return(0,$e.jsx)(Sl,{title:this.props.param.description,label:n,control:(0,$e.jsx)(fc,{numeric:!0,value:parseFloat(this.props.value.toFixed(o)),onEnter:this.props.onEnter,placeholder:r,isDisabled:this.props.isDisabled,onChange:this.update})})}},kX=class extends VS{constructor(){super(...arguments);this.onChange=r=>{this.update(r)}}renderControl(){let r=typeof this.props.value>"u"?this.props.param.defaultValue:this.props.value;return(0,$e.jsx)(BA,{value:r,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}},EF=class extends VS{constructor(){super(...arguments);this.updateValue=r=>{r!==this.props.value&&this.update(r)}}renderControl(){let r=this.props.param.placeholder||this.props.param.label||Ls(this.props.name);return(0,$e.jsx)(Zut,{props:this.props,placeholder:r,update:this.updateValue})}};function Zut({props:e,placeholder:t,update:r}){let[n,o]=Ti.useState(e.value);Ti.useEffect(()=>o(e.value),[e.value]);let i=l=>{e.param.disableInteractiveUpdates?o(l.target.value):r(l.target.value)},a=l=>{e.param.disableInteractiveUpdates&&r(l.target.value)},s=l=>{l.key==="Enter"&&(e.onEnter&&!e.param.multiline?(l.stopPropagation(),e.onEnter()):l.shiftKey||l.ctrlKey||l.metaKey?l.currentTarget.blur():e.param.disableInteractiveUpdates&&!e.param.multiline&&r(n))};return e.param.multiline?(0,$e.jsx)("div",{className:"msp-control-text-area-wrapper",children:(0,$e.jsx)("textarea",{value:n??"",placeholder:t,disabled:e.isDisabled,onChange:i,onBlur:a,onKeyDown:s})}):(0,$e.jsx)("input",{type:"text",value:n??"",placeholder:t,disabled:e.isDisabled,onChange:i,onBlur:a,onKeyDown:s})}var og=class extends Ti.PureComponent{constructor(){super(...arguments);this.onChange=r=>{typeof this.props.param.defaultValue=="number"?this.update(parseInt(r.target.value,10)):this.update(r.target.value)}}update(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})}render(){let r=this.props.value!==void 0&&!this.props.param.options.some(n=>n[0]===this.props.value);return(0,$e.jsxs)("select",{className:"msp-form-control",title:this.props.title,value:this.props.value!==void 0?this.props.value:this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled,children:[r&&(0,$e.jsx)("option",{value:this.props.value,children:`[Invalid] ${this.props.value}`},this.props.value),this.props.param.options.map(([n,o])=>(0,$e.jsx)("option",{value:n,children:o},n))]})}},kA=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1,showOptions:!1};this.onSelect=r=>{!r||r.value===this.props.value?this.setState({showOptions:!1}):this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:r.value})})};this.toggle=()=>this.setState({showOptions:!this.state.showOptions});this.cycle=()=>{let{options:r}=this.props.param,n=r.findIndex(i=>i[0]===this.props.value),o=n===r.length-1?0:n+1;this.props.onChange({param:this.props.param,name:this.props.name,value:r[o][0]})};this.items=uu(r=>br.createItemsFromSelectOptions(r.options));this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}renderControl(){let r=this.items(this.props.param),n=this.props.value!==void 0?br.findItem(r,this.props.value):void 0,o=n?n.label:typeof this.props.value>"u"?`${br.getFirstItem(r)?.label||""} [Default]`:`[Invalid] ${this.props.value}`,i=this.props.param.cycle?this.cycle:this.toggle,a=this.props.param.cycle?"center":"left",s=this.props.param.cycle?this.props.value==="on"?Lm:this.props.value==="off"?xN:void 0:void 0;return(0,$e.jsx)(di,{disabled:this.props.isDisabled,style:{textAlign:a,overflow:"hidden",textOverflow:"ellipsis"},label:o,title:o,icon:s,toggle:i,isSelected:this.state.showOptions})}renderAddOn(){if(!this.state.showOptions)return null;let r=this.items(this.props.param),n=br.findItem(r,this.props.value);return(0,$e.jsx)(br,{items:r,current:n,onSelect:this.onSelect})}render(){return OS({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}},MF=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1,showOptions:!1};this.onSelect=r=>{!r||r.value===this.props.value?this.setState({showOptions:!1}):this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:{ref:r.value}})})};this.toggle=()=>this.setState({showOptions:!this.state.showOptions});this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}get items(){return br.createItemsFromSelectOptions(this.props.param.getOptions(this.context))}renderControl(){let r=this.items,n=this.props.value.ref?br.findItem(r,this.props.value.ref):void 0,o=n?n.label:`[Ref] ${this.props.value.ref??""}`;return(0,$e.jsx)(di,{disabled:this.props.isDisabled,style:{textAlign:"left",overflow:"hidden",textOverflow:"ellipsis"},label:o,title:o,toggle:this.toggle,isSelected:this.state.showOptions})}renderAddOn(){if(!this.state.showOptions)return null;let r=this.items,n=br.findItem(r,this.props.value.ref);return(0,$e.jsx)(br,{items:r,current:n,onSelect:this.onSelect})}render(){return OS({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}};MF.contextType=vl;var LX=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.components={0:C.Numeric(0,{step:this.props.param.step},{label:"Min"}),1:C.Numeric(0,{step:this.props.param.step},{label:"Max"})};this.componentChange=({name:r,value:n})=>{let o=[...this.props.value];o[+r]=n,this.change(o)};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}render(){let r=this.props.value,n=this.props.param.label||Ls(this.props.name),o=U0(this.props.param.step||.01),i=`[${r[0].toFixed(o)}, ${r[1].toFixed(o)}]`;return(0,$e.jsxs)($e.Fragment,{children:[(0,$e.jsx)(Sl,{label:n,control:(0,$e.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:i})}),this.state.isExpanded&&(0,$e.jsx)("div",{className:"msp-control-offset",children:(0,$e.jsx)(Kn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}},FX=class extends VS{constructor(){super(...arguments);this.onChange=r=>{this.update(r)}}renderControl(){return(0,$e.jsx)(_F,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}};var qut=af(hE),Yut=af(fE);function KX(e,t="0"){return{background:Kut(e.colors,e.kind==="set"),position:"absolute",bottom:"0",height:"4px",right:t,left:"0"}}function Kut(e,t){return t?Yut(e):qut(e)}function Jut(){let e=t=>{let r=Ma(t[0]);return(0,$e.jsx)("div",{style:KX({kind:r.type!=="qualitative"?"interpolate":"set",colors:r.list})})};return{ColorPresets:{all:br.createItemsFromSelectOptions(sw,{addOn:e,description:t=>t[3]}),scale:br.createItemsFromSelectOptions(lee,{addOn:e,description:t=>t[3]}),set:br.createItemsFromSelectOptions(uee,{addOn:e,description:t=>t[3]})},ColorsParam:C.ObjectList({color:C.Color(0)},({color:t})=>Fe.toHexString(t).toUpperCase()),OffsetColorsParam:C.ObjectList({color:C.Color(0),offset:C.Numeric(0,{min:0,max:1,step:.01})},({color:t,offset:r})=>`${Fe.toHexString(t).toUpperCase()} [${r.toFixed(2)}]`),IsInterpolatedParam:C.Boolean(!1,{label:"Interpolated"})}}var DF;function zTe(){return DF||(DF=Jut(),DF)}var VX=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1,show:void 0};this.toggleEdit=()=>this.setState({show:this.state.show==="edit"?void 0:"edit"});this.togglePresets=()=>this.setState({show:this.state.show==="presets"?void 0:"presets"});this.selectPreset=r=>{if(!r)return;this.setState({show:void 0});let n=Ma(r.value);this.update({kind:n.type!=="qualitative"?"interpolate":"set",colors:n.list})};this.colorsChanged=({value:r})=>{this.update({kind:this.props.value.kind,colors:r.map(n=>n.color)})};this.isInterpolatedChanged=({value:r})=>{this.update({kind:r?"interpolate":"set",colors:this.props.value.colors})};this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})}renderControl(){let{value:r}=this.props;return(0,$e.jsxs)($e.Fragment,{children:[(0,$e.jsxs)("button",{onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"},children:[r.colors.length===1?"1 color":`${r.colors.length} colors`,(0,$e.jsx)("div",{style:KX(r,"33px")})]}),(0,$e.jsx)(or,{svg:Qg,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}})]})}renderColors(){if(!this.state.show)return null;let{ColorPresets:r,ColorsParam:n,IsInterpolatedParam:o}=zTe(),i=r[this.props.param.presetKind];if(this.state.show==="presets")return(0,$e.jsx)(br,{items:i,onSelect:this.selectPreset});let a=this.props.value.colors.map(s=>({color:Array.isArray(s)?s[0]:s}));return(0,$e.jsxs)("div",{className:"msp-control-offset",children:[(0,$e.jsx)(RR,{name:"colors",param:n,value:a,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,$e.jsx)(_R,{name:"isInterpolated",param:o,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return OS({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}},OX=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1,show:void 0};this.toggleEdit=()=>this.setState({show:this.state.show==="edit"?void 0:"edit"});this.togglePresets=()=>this.setState({show:this.state.show==="presets"?void 0:"presets"});this.selectPreset=r=>{if(!r)return;this.setState({show:void 0});let n=Ma(r.value);this.update({kind:n.type!=="qualitative"?"interpolate":"set",colors:n.list})};this.colorsChanged=({value:r})=>{let n=r.map(o=>[o.color,o.offset]);n.sort((o,i)=>o[1]-i[1]),this.update({kind:this.props.value.kind,colors:n})};this.isInterpolatedChanged=({value:r})=>{this.update({kind:r?"interpolate":"set",colors:this.props.value.colors})};this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(r){this.props.onChange({param:this.props.param,name:this.props.name,value:r})}renderControl(){let{value:r}=this.props;return(0,$e.jsxs)($e.Fragment,{children:[(0,$e.jsxs)("button",{onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"},children:[r.colors.length===1?"1 color":`${r.colors.length} colors`,(0,$e.jsx)("div",{style:KX(r,"33px")})]}),(0,$e.jsx)(or,{svg:Qg,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}})]})}renderColors(){if(!this.state.show)return null;let{ColorPresets:r,OffsetColorsParam:n,IsInterpolatedParam:o}=zTe(),i=r[this.props.param.presetKind];if(this.state.show==="presets")return(0,$e.jsx)(br,{items:i,onSelect:this.selectPreset});let a=this.props.value.colors,s=a.map((l,u)=>Array.isArray(l)?{color:l[0],offset:l[1]}:{color:l,offset:u/a.length});return s.sort((l,u)=>l.offset-u.offset),(0,$e.jsxs)("div",{className:"msp-control-offset",children:[(0,$e.jsx)(RR,{name:"colors",param:n,value:s,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,$e.jsx)(_R,{name:"isInterpolated",param:o,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return OS({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}},GX=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.components={0:C.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.x||"X"}),1:C.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.y||"Y"}),2:C.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.z||"Z"})};this.componentChange=({name:r,value:n})=>{let o=b.copy(b.zero(),this.props.value);o[+r]=n,this.change(o)};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}render(){let r=this.props.value,n=this.props.param.label||Ls(this.props.name),o=U0(this.props.param.step||.01),i=`[${r[0].toFixed(o)}, ${r[1].toFixed(o)}, ${r[2].toFixed(o)}]`;return(0,$e.jsxs)($e.Fragment,{children:[(0,$e.jsx)(Sl,{label:n,control:(0,$e.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:(0,$e.jsx)("div",{title:i,className:"msp-no-overflow",style:{display:"block"},children:i})})}),this.state.isExpanded&&(0,$e.jsx)("div",{className:"msp-control-offset",children:(0,$e.jsx)(Kn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}},UX=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.components={json:C.Text(JSON.stringify(Z()),{description:"JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format"})};this.componentChange=({name:r,value:n})=>{let o=Z.copy(Z(),this.props.value);r==="json"?Z.copy(o,JSON.parse(n)):o[+r]=n,this.change(o)};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}changeValue(r){return n=>{let o=Z.copy(Z(),this.props.value);o[r]=n,this.change(o)}}get grid(){let r=this.props.value,n=[];for(let o=0;o<4;o++){let i=[];for(let a=0;a<4;a++)i.push((0,$e.jsx)(fc,{numeric:!0,delayMs:50,value:Z.getValue(r,o,a),onChange:this.changeValue(4*a+o),className:"msp-form-control",blurOnEnter:!0,isDisabled:this.props.isDisabled},a));n.push((0,$e.jsx)("div",{className:"msp-flex-row",children:i},o))}return(0,$e.jsx)("div",{className:"msp-parameter-matrix",children:n})}render(){let r={json:JSON.stringify(this.props.value)},n=this.props.param.label||Ls(this.props.name);return(0,$e.jsxs)($e.Fragment,{children:[(0,$e.jsx)(Sl,{label:n,control:(0,$e.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:(0,$e.jsx)("div",{className:"msp-no-overflow",style:{display:"block"},children:"4\xD74 Matrix"})})}),this.state.isExpanded&&(0,$e.jsxs)("div",{className:"msp-control-offset",children:[this.grid,(0,$e.jsx)(Kn,{params:this.components,values:r,onChange:this.componentChange,onEnter:this.props.onEnter})]})]})}},NX=class extends VS{constructor(){super(...arguments);this.onChange=r=>{let n=r.target.value;n!==Zr.getUrl(this.props.value||"")&&this.update(Zr.Url(n))};this.onKeyPress=r=>{(r.keyCode===13||r.charCode===13||r.key==="Enter")&&this.props.onEnter&&this.props.onEnter(),r.stopPropagation()}}renderControl(){let r=this.props.param.label||Ls(this.props.name);return(0,$e.jsx)("input",{type:"text",value:Zr.getUrl(this.props.value||""),placeholder:r,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled})}},zX=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1};this.onChangeFile=r=>{this.change(r.target.files[0])};this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:Zr.File(r)})}renderControl(){let r=this.props.value;return(0,$e.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"},children:[r?r.name:"Select a file..."," ",(0,$e.jsx)("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept})]})}render(){return this.props.param.label?OS({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}},HX=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={showHelp:!1};this.onChangeFileList=r=>{this.change(r.target.files)};this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(r){let n=[];if(r)for(let o=0,i=r.length;o<i;++o)n.push(Zr.File(r[o]));this.props.onChange({name:this.props.name,param:this.props.param,value:n})}renderControl(){let r=this.props.value,n=[];if(r)for(let i of r)n.push(i.name);let o=n.length===0?"Select files...":n.length===1?n[0]:`${n.length} files selected`;return(0,$e.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"},children:[o," ",(0,$e.jsx)("input",{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:"file",multiple:!0,accept:this.props.param.accept})]})}render(){return this.props.param.label?OS({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}},jX=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}toggle(r){return n=>{this.props.value.indexOf(r)<0?this.change(this.props.value.concat(r)):this.change(this.props.value.filter(o=>o!==r)),n.currentTarget.blur()}}render(){let r=this.props.value,n=this.props.param.emptyValue,o=this.props.param.label||Ls(this.props.name);return(0,$e.jsxs)($e.Fragment,{children:[(0,$e.jsx)(Sl,{label:o,control:(0,$e.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:r.length===0&&n?n:`${r.length} of ${this.props.param.options.length}`})}),this.state.isExpanded&&(0,$e.jsx)("div",{className:"msp-control-offset",children:this.props.param.options.map(([i,a])=>{let s=r.indexOf(i)>=0;return(0,$e.jsx)(sr,{onClick:this.toggle(i),disabled:this.props.isDisabled,style:{marginTop:"1px"},children:(0,$e.jsx)("span",{style:{float:s?"left":"right"},children:s?`\u2713 ${a}`:`${a} \u2717`})},i)})})]})}},BF=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!!this.props.param.isExpanded,showPresets:!1,showHelp:!1};this.onChangeParam=r=>{this.change({...this.props.value,[r.name]:r.value})};this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded});this.toggleShowPresets=()=>this.setState({showPresets:!this.state.showPresets});this.presetItems=uu(r=>br.createItemsFromSelectOptions(r.presets??[]));this.onSelectPreset=r=>{this.setState({showPresets:!1}),this.change(r?.value)}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}pivotedPresets(){if(!this.props.param.presets)return null;let r=this.props.param.label||Ls(this.props.name);return(0,$e.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,$e.jsx)("div",{className:"msp-control-group-header",children:(0,$e.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets,children:[(0,$e.jsx)(yn,{svg:Qg}),r," Presets"]})}),this.state.showPresets&&(0,$e.jsx)(br,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]})}presets(){return this.props.param.presets?(0,$e.jsxs)($e.Fragment,{children:[(0,$e.jsx)("div",{className:"msp-control-group-presets-wrapper",children:(0,$e.jsx)("div",{className:"msp-control-group-header",children:(0,$e.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets,children:[(0,$e.jsx)(yn,{svg:Qg}),"Presets"]})})}),this.state.showPresets&&(0,$e.jsx)(br,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]}):null}pivoted(){let r=this.props.param.pivot,n=this.props.param.params,o=n[r],i=DR(o),a=(0,$e.jsx)(i,{name:r,param:o,value:this.props.value[r],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled});if(!this.state.isExpanded)return(0,$e.jsxs)("div",{className:"msp-mapped-parameter-group",children:[a,(0,$e.jsx)(or,{svg:Fd,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"})]});let s=Object.create(null);for(let l of Object.keys(n))l!==r&&(s[l]=n[l]);return(0,$e.jsxs)("div",{className:"msp-mapped-parameter-group",children:[a,(0,$e.jsx)(or,{svg:Fd,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"}),(0,$e.jsxs)("div",{className:"msp-control-offset",children:[this.pivotedPresets(),(0,$e.jsx)(Kn,{params:s,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled})]})]})}render(){let r=this.props.param.params;if(Object.keys(r).length===0)return null;if(this.props.param.pivot)return this.pivoted();let n=this.props.param.label||Ls(this.props.name),o=(0,$e.jsx)(Kn,{params:r,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled});return this.props.inMapped?(0,$e.jsx)("div",{className:"msp-control-offset",children:o}):this.props.param.isFlat?o:(0,$e.jsxs)("div",{className:"msp-control-group-wrapper",style:{position:"relative"},children:[(0,$e.jsx)("div",{className:"msp-control-group-header",children:(0,$e.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,children:[(0,$e.jsx)(yn,{svg:this.state.isExpanded?wu:Eu}),n]})}),this.presets(),this.state.isExpanded&&(0,$e.jsx)("div",{className:"msp-control-offset",children:o})]})}},WX=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.valuesCache={};this.onChangeName=r=>{this.change({name:r.value,params:this.getValues(r.value)})};this.onChangeParam=r=>{this.setValues(this.props.value.name,r.value),this.change({name:this.props.value.name,params:r.value})};this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}setValues(r,n){this.valuesCache[r]=n}getValues(r){return r in this.valuesCache?this.valuesCache[r]:this.props.param.map(r).defaultValue}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}areParamsEmpty(r){for(let n of Object.keys(r))if(!r[n].isHidden)return!1;return!0}render(){let r=this.props.value||this.props.param.defaultValue,n=this.props.param.map(r.name),o=this.props.param.label||Ls(this.props.name),i=DR(n),a=this.props.param.help,s=a?{...this.props.param.select,help:u=>a({name:u,params:this.getValues(u)})}:this.props.param.select,l=(0,$e.jsx)(kA,{param:s,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:o,value:r.name});return i?n.type==="group"&&!n.isFlat?this.areParamsEmpty(n.params)?l:(0,$e.jsxs)("div",{className:"msp-mapped-parameter-group",children:[l,(0,$e.jsx)(or,{svg:Fd,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:`${o} Properties`}),this.state.isExpanded&&(0,$e.jsx)(BF,{inMapped:!0,param:n,value:r.params,name:r.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):(0,$e.jsxs)($e.Fragment,{children:[l,(0,$e.jsx)(i,{param:n,value:r.params,name:r.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):l}},kF=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={current:this.props.value};this.onChangeParam=r=>{this.setState({current:{...this.state.current,[r.name]:r.value}})};this.apply=()=>{this.props.apply(this.state.current)}}componentDidUpdate(r){(this.props.params!==r.params||this.props.value!==r.value)&&this.setState({current:this.props.value})}render(){return(0,$e.jsxs)($e.Fragment,{children:[(0,$e.jsx)(Kn,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled}),(0,$e.jsx)("button",{className:"msp-btn msp-btn-block msp-form-control msp-control-top-offset",onClick:this.apply,disabled:this.props.isDisabled,children:this.props.isUpdate?"Update":"Add"})]})}},XX=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.update=r=>{this.props.actions.update(r,this.props.index)};this.moveUp=()=>{this.props.actions.move(this.props.index,-1)};this.moveDown=()=>{this.props.actions.move(this.props.index,1)};this.remove=()=>{this.setState({isExpanded:!1}),this.props.actions.remove(this.props.index)};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}render(){return(0,$e.jsxs)($e.Fragment,{children:[(0,$e.jsxs)("div",{className:"msp-param-object-list-item",children:[(0,$e.jsxs)("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:this.toggleExpanded,children:[(0,$e.jsx)("span",{children:`${this.props.index+1}: `}),this.props.param.getLabel(this.props.value)]}),(0,$e.jsxs)("div",{children:[(0,$e.jsx)(or,{svg:kb,title:"Move Up",onClick:this.moveUp,small:!0}),(0,$e.jsx)(or,{svg:Lb,title:"Move Down",onClick:this.moveDown,small:!0}),(0,$e.jsx)(or,{svg:Vs,title:"Remove",onClick:this.remove,small:!0})]})]}),this.state.isExpanded&&(0,$e.jsx)("div",{className:"msp-control-offset",children:(0,$e.jsx)(kF,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled})})]})}},RR=class extends Ti.PureComponent{constructor(){super(...arguments);this.state={isExpanded:!1};this.add=r=>{this.change([...this.props.value,r])};this.actions={update:(r,n)=>{let o=this.props.value.slice(0);o[n]=r,this.change(o)},move:(r,n)=>{let o=this.props.value;if(o.length===1)return;let i=(r+n)%o.length;i<0&&(i+=o.length),o=o.slice(0);let a=o[r];o[r]=o[i],o[i]=a,this.change(o)},remove:r=>{let n=this.props.value,o=[];for(let i=0;i<n.length;i++)r!==i&&o.push(n[i]);this.change(o)}};this.toggleExpanded=r=>{this.setState({isExpanded:!this.state.isExpanded}),r.currentTarget.blur()}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}render(){let r=this.props.value,n=this.props.param.label||Ls(this.props.name),o=`${r.length} item${r.length!==1?"s":""}`;return(0,$e.jsxs)($e.Fragment,{children:[(0,$e.jsx)(Sl,{label:n,control:(0,$e.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:o})}),this.state.isExpanded&&(0,$e.jsxs)("div",{className:"msp-control-offset",children:[this.props.value.map((i,a)=>(0,$e.jsx)(XX,{param:this.props.param,value:i,index:a,actions:this.actions,isDisabled:this.props.isDisabled},a)),(0,$e.jsx)(Cl,{header:"New Item",children:(0,$e.jsx)(kF,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled})})]})]})}},QX=class extends Ti.PureComponent{constructor(){super(...arguments);this.onChangeCondition=r=>{this.change(this.props.param.conditionedValue(this.props.value,r.value))};this.onChangeParam=r=>{this.change(r.value)}}change(r){this.props.onChange({name:this.props.name,param:this.props.param,value:r})}render(){let r=this.props.value,n=this.props.param.conditionForValue(r),o=this.props.param.conditionParams[n],i=this.props.param.label||Ls(this.props.name),a=DR(o),s=(0,$e.jsx)(kA,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:`${i} Kind`,value:n});return a?(0,$e.jsxs)($e.Fragment,{children:[s,(0,$e.jsx)(a,{param:o,value:r,name:i,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):s}},ZX=class extends Ti.PureComponent{constructor(){super(...arguments);this.onChange=r=>{this.props.onChange({name:this.props.name,param:this.props.param,value:this.props.param.toValue(r.value)})}}render(){let r=this.props.param.fromValue(this.props.value),n=DR(this.props.param.converted);return n?(0,$e.jsx)(n,{param:this.props.param.converted,value:r,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled}):null}},qX=class extends Ti.PureComponent{constructor(){super(...arguments);this.onChange=({name:r,value:n})=>{let o=r;n!==this.props.value[o]&&this.props.onChange({param:this.props.param,name:this.props.name,value:{...this.props.value,[o]:n}})}}render(){let r={defaultValue:this.props.value.language,options:C.objectToOptions(To.Info),type:"select"},n=(0,$e.jsx)(kA,{param:r,isDisabled:this.props.isDisabled,onChange:this.onChange,onEnter:this.props.onEnter,name:"language",value:this.props.value.language}),o={defaultValue:this.props.value.language,type:"text"},i=(0,$e.jsx)(EF,{param:o,isDisabled:this.props.isDisabled,onChange:this.onChange,name:"expression",value:this.props.value.expression});return(0,$e.jsxs)($e.Fragment,{children:[n,this.props.value.language!=="mol-script"&&(0,$e.jsxs)("div",{className:"msp-help-text",style:{padding:"10px"},children:[(0,$e.jsx)(yn,{svg:Ew})," Support for PyMOL, VMD, and Jmol selections is an experimental feature and may not always work as intended."]}),i]})}};var Wy=Rt(nr()),LF=class extends Ir{constructor(){super(...arguments);this.updateParams=r=>{this.plugin.managers.animation.updateParams({[r.name]:r.value})};this.updateCurrentParams=r=>{this.plugin.managers.animation.updateCurrentParams({[r.name]:r.value})};this.startOrStop=()=>{let r=this.plugin.managers.animation;r.state.animationState==="playing"?r.stop():(this.props.onStart&&this.props.onStart(),r.start())}}componentDidMount(){this.subscribe(this.plugin.managers.animation.events.updated,()=>this.forceUpdate())}render(){let r=this.plugin.managers.animation;if(r.isEmpty)return null;let n=r.state.animationState==="playing",o=r.current.anim.canApply?.(this.plugin);return(0,Wy.jsxs)(Wy.Fragment,{children:[(0,Wy.jsx)(Kn,{params:r.getParams(),values:r.state.params,onChange:this.updateParams,isDisabled:n}),(0,Wy.jsx)(Kn,{params:r.current.params,values:r.current.paramValues,onChange:this.updateCurrentParams,isDisabled:n}),(0,Wy.jsx)("div",{className:"msp-flex-row",children:(0,Wy.jsx)(sr,{icon:r.state.animationState!=="playing"?void 0:Dw,onClick:this.startOrStop,disabled:o!==void 0&&o.canApply===!1,children:r.state.animationState==="playing"?"Stop":o===void 0||o.canApply?"Start":o.reason||"Start"})})]})}};var jTe="overpaint-controls";async function JX(e,t,r,n,o){await $ut(e,t,async(i,a,s)=>{if(o&&o.length>0&&!o.includes(a.params.values.type.name))return;let l=a.obj.data.sourceData,u=await n(l.root);if(Jt.isEmpty(u)||Ii(u))return;let c={bundle:K.Bundle.fromLoci(u),color:r===-1?0:r,clear:r===-1};if(s){let m=[...s.params.values.layers,c],d=HTe(m,l);i.to(s).update(Ha.toBundle(d))}else{let m=HTe([c],l);i.to(a.transform.ref).apply(Xe.Representation.OverpaintStructureRepresentation3DFromBundle,Ha.toBundle(m),{tags:jTe})}})}async function $ut(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let a of i.representations){let s=n.select(er.Generators.ofTransformer(Xe.Representation.OverpaintStructureRepresentation3DFromBundle,a.cell.transform.ref).withTag(jTe));await r(o,a.cell,s[0])}return o.commit({doNotUpdateCurrent:!0})}function HTe(e,t){let r=Ha.ofBundle(e,t.root),n=Ha.merge(r);return Ha.filter(n,t)}var XTe="clipping-controls";async function QTe(e,t,r,n,o){await ect(e,t,async(i,a,s)=>{if(o&&o.length>0&&!o.includes(a.params.values.type.name))return;let l=a.obj.data.sourceData,u=await n(l.root);if(Jt.isEmpty(u)||Ii(u))return;let c={bundle:K.Bundle.fromLoci(u),groups:r};if(s){let m=[...s.params.values.layers,c],d=WTe(m,l);i.to(s).update(lo.toBundle(d))}else{let m=WTe([c],l);i.to(a.transform.ref).apply(Xe.Representation.ClippingStructureRepresentation3DFromBundle,lo.toBundle(m),{tags:XTe})}})}async function ect(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let a of i.representations){let s=n.select(er.Generators.ofTransformer(Xe.Representation.ClippingStructureRepresentation3DFromBundle,a.cell.transform.ref).withTag(XTe));await r(o,a.cell,s[0])}return o.commit({doNotUpdateCurrent:!0})}function WTe(e,t){let r=lo.ofBundle(e,t.root),n=lo.merge(r);return lo.filter(n,t)}var qTe="transparency-controls";async function YTe(e,t,r,n,o){await tct(e,t,async(i,a,s)=>{if(o&&o.length>0&&!o.includes(a.params.values.type.name))return;let l=a.obj.data.sourceData,u=await n(l.root);if(Jt.isEmpty(u)||Ii(u))return;let c={bundle:K.Bundle.fromLoci(u),value:r};if(s){let m=[...s.params.values.layers,c],d=ZTe(m,l);i.to(s).update(ja.toBundle(d))}else{let m=ZTe([c],l);i.to(a.transform.ref).apply(Xe.Representation.TransparencyStructureRepresentation3DFromBundle,ja.toBundle(m),{tags:qTe})}})}async function tct(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let a of i.representations){let s=n.select(er.Generators.ofTransformer(Xe.Representation.TransparencyStructureRepresentation3DFromBundle,a.cell.transform.ref).withTag(qTe));await r(o,a.cell,s[0])}return o.commit({doNotUpdateCurrent:!0})}function ZTe(e,t){let r=ja.ofBundle(e,t.root),n=ja.merge(r);return ja.filter(n,t)}var JTe="substance-controls";async function $X(e,t,r,n,o){await rct(e,t,async(i,a,s)=>{if(o&&o.length>0&&!o.includes(a.params.values.type.name))return;let l=a.obj.data.sourceData,u=await n(l.root);if(Jt.isEmpty(u)||Ii(u))return;let c={bundle:K.Bundle.fromLoci(u),material:r??Oa(),clear:!r};if(s){let m=[...s.params.values.layers,c],d=KTe(m,l);i.to(s).update(Wa.toBundle(d))}else{let m=KTe([c],l);i.to(a.transform.ref).apply(Xe.Representation.SubstanceStructureRepresentation3DFromBundle,Wa.toBundle(m),{tags:JTe})}})}async function rct(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let a of i.representations){let s=n.select(er.Generators.ofTransformer(Xe.Representation.SubstanceStructureRepresentation3DFromBundle,a.cell.transform.ref).withTag(JTe));await r(o,a.cell,s[0])}return o.commit({doNotUpdateCurrent:!0})}function KTe(e,t){let r=Wa.ofBundle(e,t.root),n=Wa.merge(r);return Wa.filter(n,t)}var ePe="emissive-controls";async function tPe(e,t,r,n,o){await nct(e,t,async(i,a,s)=>{if(o&&o.length>0&&!o.includes(a.params.values.type.name))return;let l=a.obj.data.sourceData,u=await n(l.root);if(Jt.isEmpty(u)||Ii(u))return;let c={bundle:K.Bundle.fromLoci(u),value:r};if(s){let m=[...s.params.values.layers,c],d=$Te(m,l);i.to(s).update(Xa.toBundle(d))}else{let m=$Te([c],l);i.to(a.transform.ref).apply(Xe.Representation.EmissiveStructureRepresentation3DFromBundle,Xa.toBundle(m),{tags:ePe})}})}async function nct(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let a of i.representations){let s=n.select(er.Generators.ofTransformer(Xe.Representation.EmissiveStructureRepresentation3DFromBundle,a.cell.transform.ref).withTag(ePe));await r(o,a.cell,s[0])}return o.commit({doNotUpdateCurrent:!0})}function $Te(e,t){let r=Xa.ofBundle(e,t.root),n=Xa.merge(r);return Xa.filter(n,t)}var gp=class e extends Bs{constructor(r){super({options:C.getDefaultValues(e.OptionsParams)});this.plugin=r;this.events={optionsUpdated:this.ev()}}get currentStructures(){return this.plugin.managers.structure.hierarchy.selection.structures}get pivotStructure(){return this.currentStructures[0]}_setSnapshotState(r){this.updateState({options:r}),this.events.optionsUpdated.next(void 0)}async setOptions(r){let n=r.interactions!==this.state.options.interactions;this.updateState({options:r}),this.events.optionsUpdated.next(void 0);let o=this.dataState.build();for(let i of this.currentStructures)for(let a of i.components)this.updateReprParams(o,a);return this.plugin.dataTransaction(async()=>{await o.commit(),await this.plugin.state.updateBehavior(FS,i=>{i.ignoreHydrogens=r.hydrogens!=="all",i.ignoreHydrogensVariant=r.hydrogens==="only-polar"?"non-polar":"all",i.ignoreLight=r.ignoreLight,i.material=r.materialStyle,i.clip=r.clipObjects}),n&&await this.updateInterationProps()})}updateReprParams(r,n){let{hydrogens:o,visualQuality:i,ignoreLight:a,materialStyle:s,clipObjects:l}=this.state.options,u=o!=="all",c=o==="only-polar"?"non-polar":"all";for(let m of n.representations){if(m.cell.transform.transformer!==dd)continue;let d=m.cell.transform.params;(!!d.type.params.ignoreHydrogens!==u||d.type.params.ignoreHydrogensVariant!==c||d.type.params.quality!==i||d.type.params.ignoreLight!==a||!Ng(d.type.params.material,s)||!C.areEqual(mf.Params,d.type.params.clip,l))&&r.to(m.cell).update(p=>{p.type.params.ignoreHydrogens=u,p.type.params.ignoreHydrogensVariant=c,p.type.params.quality=i,p.type.params.ignoreLight=a,p.type.params.material=s,p.type.params.clip=l})}}async updateInterationProps(){for(let r of this.currentStructures){let n=ci.getParams(r.cell.obj?.data);if(r.properties){let o=r.properties.cell.transform.params?.properties[ci.descriptor.name];if(C.areEqual(n,o,this.state.options.interactions))continue;await this.dataState.build().to(r.properties.cell).update(i=>{i.properties[ci.descriptor.name]=this.state.options.interactions}).commit()}else{let o=this.plugin.customStructureProperties.getParams(r.cell.obj?.data),i=C.getDefaultValues(o);if(C.areEqual(n,i.properties[ci.descriptor.name],this.state.options.interactions))continue;i.properties[ci.descriptor.name]=this.state.options.interactions,await this.plugin.builders.structure.insertStructureProperties(r.cell,i)}}}applyPreset(r,n,o){return this.plugin.dataTransaction(async()=>{for(let i of r){let a=await this.plugin.builders.structure.representation.applyPreset(i.cell,n,o);await this.syncPreset(i,a)}},{canUndo:"Preset"})}syncPreset(r,n){if(!n||!n.components)return this.clearComponents([r]);let o=new Set;if(gi(n.components,l=>{l&&o.add(l.ref)}),n.representations&&gi(n.representations,l=>{l&&o.add(l.ref)}),o.size===0)return this.clearComponents([r]);let i=!1,a=this.dataState.build(),s=l=>{o.has(l.cell.transform.ref)||(i=!0,a.delete(l.cell))};for(let l of r.components){s(l);for(let u of l.representations)s(u);if(l.genericRepresentations)for(let u of l.genericRepresentations)s(u)}if(r.genericRepresentations)for(let l of r.genericRepresentations)s(l);if(i)return a.commit()}clear(r){return this.clearComponents(r)}selectThis(r){let n=this.plugin.managers.structure.selection;n.clear();for(let o of r){let i=De.toSubStructureElementLoci(o.structure.cell.obj.data,o.cell.obj?.data);n.fromLoci("set",i)}}canBeModified(r){return this.plugin.builders.structure.isComponentTransform(r.cell)}modifyByCurrentSelection(r,n){return this.plugin.runTask(Pe.create("Modify Component",async o=>{let i=this.dataState.build();for(let a of r){if(!this.canBeModified(a))continue;let s=this.plugin.managers.structure.selection.getStructure(a.structure.cell.obj.data);!s||s.elementCount===0||this.modifyComponent(i,a,s,n)}await this.dataState.updateTree(i,{canUndo:"Modify Selection"}).runInContext(o)}))}toggleVisibility(r,n){if(r.length!==0)if(n){let o=r[0].representations.indexOf(n),i=!n.cell.state.isHidden;for(let a of r){let s=a.representations[o];s&&Ef(this.dataState,s.cell.transform.ref,i)}}else{let o=!r[0].cell.state.isHidden;for(let i of r)Ef(this.dataState,i.cell.transform.ref,o)}}removeRepresentations(r,n){if(r.length===0)return;let o=[];if(n){let i=r[0].representations.indexOf(n);if(i<0)return;for(let a of r)a.representations[i]&&o.push(a.representations[i])}else for(let i of r)for(let a of i.representations)o.push(a);return this.plugin.managers.structure.hierarchy.remove(o,!0)}updateRepresentations(r,n,o){if(r.length===0)return Promise.resolve();let i=r[0].representations.indexOf(n);if(i<0)return Promise.resolve();let a=this.dataState.build();for(let s of r){let l=s.representations[i];l&&l.cell.transform.transformer===n.cell.transform.transformer&&a.to(l.cell).update(o)}return a.commit({canUndo:"Update Representation"})}updateRepresentationsTheme(r,n){if(r.length===0)return;let o=this.dataState.build();for(let i of r)for(let a of i.representations){let s=a.cell.transform.params,l=typeof n=="function"?n(i,a):n,u=l.color==="default"?xR(this.plugin,i.structure.cell.obj?.data,s?.type.name):l.color?xR(this.plugin,i.structure.cell.obj?.data,s?.type.name,l.color,l.colorParams):void 0,c=l.size==="default"?JW(this.plugin,i.structure.cell.obj?.data,s?.type.name):l.color?JW(this.plugin,i.structure.cell.obj?.data,s?.type.name,l.size,l.sizeParams):void 0;(u||c)&&o.to(a.cell).update(m=>{u&&(m.colorTheme=u),c&&(m.sizeTheme=c)})}return o.commit({canUndo:"Update Theme"})}addRepresentation(r,n){if(r.length===0)return;let{hydrogens:o,visualQuality:i,ignoreLight:a,materialStyle:s,clipObjects:l}=this.state.options,m={ignoreHydrogens:o!=="all",ignoreHydrogensVariant:o==="only-polar"?"non-polar":"all",quality:i,ignoreLight:a,material:s,clip:l};return this.plugin.dataTransaction(async()=>{for(let d of r)await this.plugin.builders.structure.representation.addRepresentation(d.cell,{type:this.plugin.representation.structure.registry.get(n),typeParams:m})},{canUndo:"Add Representation"})}tryFindComponent(r,n){if(r.components.length!==0)return this.plugin.runTask(Pe.create("Find Component",async o=>{let i=r.cell.obj?.data;if(!i)return;let a=at.unionStructure(await n.getSelection(this.plugin,o,i));for(let s of r.components){let l=s.cell.obj?.data;if(!(!l||!s.cell.parent)&&Jle(a,l))return s.cell}}))}async add(r,n){return this.plugin.dataTransaction(async()=>{let o=n||this.currentStructures;if(o.length===0)return;let{hydrogens:i,visualQuality:a,ignoreLight:s,materialStyle:l,clipObjects:u}=this.state.options,d={ignoreHydrogens:i!=="all",ignoreHydrogensVariant:i==="only-polar"?"non-polar":"all",quality:a,ignoreLight:s,material:l,clip:u},p=en.create22();for(let h of o){let f;r.options.checkExisting&&(f=await this.tryFindComponent(h,r.selection)),f||(f=await this.plugin.builders.structure.tryCreateComponentFromSelection(h.cell,r.selection,p,{label:r.options.label||(r.selection===li.current?"Custom Selection":"")})),!(r.representation==="none"||!f)&&await this.plugin.builders.structure.representation.addRepresentation(f,{type:this.plugin.representation.structure.registry.get(r.representation),typeParams:d})}},{canUndo:"Add Selection"})}async applyTheme(r,n){return this.plugin.dataTransaction(async o=>{let i=n||this.currentStructures;if(i.length===0)return;let a=async s=>at.toLociWithSourceUnits(await r.selection.getSelection(this.plugin,o,s));for(let s of i)if(r.action.name==="color"){let l=r.action.params;await JX(this.plugin,s.components,l.color,a,r.representations)}else if(r.action.name==="resetColor")await JX(this.plugin,s.components,-1,a,r.representations);else if(r.action.name==="transparency"){let l=r.action.params;await YTe(this.plugin,s.components,l.value,a,r.representations)}else if(r.action.name==="emissive"){let l=r.action.params;await tPe(this.plugin,s.components,l.value,a,r.representations)}else if(r.action.name==="material"){let l=r.action.params;await $X(this.plugin,s.components,l.material,a,r.representations)}else if(r.action.name==="resetMaterial")await $X(this.plugin,s.components,void 0,a,r.representations);else if(r.action.name==="clipping"){let l=r.action.params;await QTe(this.plugin,s.components,lo.Groups.fromNames(l.excludeGroups),a,r.representations)}},{canUndo:"Apply Theme"})}modifyComponent(r,n,o,i){let a=n.cell.obj?.data;if(!a||(i==="subtract"||i==="intersect")&&!Uv(a,o))return;let s=n.structure.cell.obj?.data,l=i==="union"?oy(s,[a,o]):i==="intersect"?MM(a,o):Nv(a,o);if(l.elementCount===0)r.delete(n.cell.transform.ref);else{let c={type:{name:"bundle",params:K.Bundle.fromSubStructure(s,l)},nullIfEmpty:!0,label:n.cell.obj?.label};r.to(n.cell).update(c)}}updateLabel(r,n){let o={type:r.cell.params?.values.type,nullIfEmpty:r.cell.params?.values.nullIfEmpty,label:n};this.dataState.build().to(r.cell).update(o).commit()}get dataState(){return this.plugin.state.data}clearComponents(r){let n=this.dataState.build();for(let o of r)for(let i of o.components)n.delete(i.cell.transform.ref);return n.commit({canUndo:"Clear Selections"})}};(i=>{i.OptionsParams={hydrogens:C.Select("all",[["all","Show All"],["hide-all","Hide All"],["only-polar","Only Polar"]],{description:"Determine display of hydrogen atoms in representations"}),visualQuality:C.Select("auto",c_,{description:"Control the visual/rendering quality of representations"}),ignoreLight:C.Boolean(!1,{description:"Ignore light for stylized rendering of representations"}),materialStyle:Oa.getParam(),clipObjects:C.Group(mf.Params),interactions:C.Group(ci.defaultParams,{label:"Non-covalent Interactions"})};function t(a,s){let{options:l}=a.query.structure.registry;return s={pivot:a.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1,...s},{selection:C.Select(l[1][0],l,{isHidden:s?.hideSelection}),representation:o(a,s?.pivot,s?.allowNone?[["none","< Create Later >"]]:[]),options:C.Group({label:C.Text(""),checkExisting:C.Boolean(!!s?.checkExisting,{help:()=>({description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."})})})}}i.getAddParams=t;function r(a,s){let{options:l}=a.query.structure.registry;return{selection:C.Select(l[1][0],l,{isHidden:!1}),action:C.MappedStatic("color",{color:C.Group({color:C.Color(Lt.blue,{isExpanded:!0})},{isFlat:!0}),resetColor:C.EmptyGroup({label:"Reset Color"}),transparency:C.Group({value:C.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),emissive:C.Group({value:C.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),material:C.Group({material:Oa.getParam({isFlat:!0})},{isFlat:!0}),resetMaterial:C.EmptyGroup({label:"Reset Material"}),clipping:C.Group({excludeGroups:C.MultiSelect([],C.objectToOptions(lo.Groups.Names))},{isFlat:!0})}),representations:C.MultiSelect([],n(a,s),{emptyValue:"All"})}}i.getThemeParams=r;function n(a,s){return s?.cell.obj?.data?a.representation.structure.registry.getApplicableTypes(s.cell.obj?.data):a.representation.structure.registry.types}i.getRepresentationTypes=n;function o(a,s,l,u){let c=[...l,...n(a,s)];return C.Select(c[0][0],c,{label:u})}})(gp||={});var wR;(i=>{function e(a,s){return{key:a,data:s}}function t(a){return{entries:L2(),capacity:Math.max(1,a)}}i.create=t;function r(a,s){for(let l=a.entries.first;l;l=l.next)if(l.value.key===s)return a.entries.remove(l),a.entries.addLast(l.value),l.value.data}i.get=r;function n(a,s,l){let u;if(a.entries.count>=a.capacity){let c=a.entries.first;u=c.value.data,a.entries.remove(c)}return a.entries.addLast(e(s,l)),u}i.set=n;function o(a,s){for(let l=a.entries.first;l;l=l.next)if(l.value.key===s){a.entries.remove(l);break}}i.remove=o})(wR||={});var FF=class{constructor(t=!1){this.isRunning=!1,this.queue=[],this.counter=0,this.log=t}enqueue(t){this.log&&console.log("SingleAsyncQueue enqueue",this.counter),this.queue[0]={id:this.counter,func:t},this.counter++,this.run()}async run(){if(this.isRunning)return;let t=this.queue.pop();if(t){this.isRunning=!0;try{this.log&&console.log("SingleAsyncQueue run",t.id),await t.func(),this.log&&console.log("SingleAsyncQueue complete",t.id)}finally{this.isRunning=!1,this.run()}}}};var ps=class extends re.CreateBehavior({name:"Volume Streaming"}){};(c=>{c.RootTag="volume-streaming-info";function t(m,d,p,h,f={}){return C.Group({isoValue:Ve.createIsoValueParam(f.isoValue??p,h),color:C.Color(f.color??d),wireframe:C.Boolean(f.wireframe??!1),opacity:C.Numeric(f.opacity??.3,{min:0,max:1,step:.01})},{label:m,isExpanded:!0})}let r={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function n(m={}){let{data:d,defaultView:p,channelParams:h}=m,f=new Map;d&&d.entries.forEach(x=>f.set(x.dataId,x));let y=d?d.entries.map(x=>[x.dataId,x.dataId]):[],g=d?d.entries[0].dataId:"";return{entry:C.Mapped(g,y,x=>C.Group(o({entryData:f.get(x),defaultView:p,structure:d&&d.structure,channelParams:h})))}}c.createParams=n;function o(m){let{entryData:d,defaultView:p,structure:h,channelParams:f={}}=m,y=d||{kind:"em",header:{sampling:[r],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:Ve.IsoValue.relative(0)},g=h&&h.boundary.box||ut();return{view:C.MappedStatic(p||(y.kind==="em"?"auto":"selection-box"),{off:C.Group({}),box:C.Group({bottomLeft:C.Vec3(g.min),topRight:C.Vec3(g.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":C.Group({radius:C.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),bottomLeft:C.Vec3(b.create(0,0,0),{},{isHidden:!0}),topRight:C.Vec3(b.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),"camera-target":C.Group({radius:C.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),dynamicDetailLevel:i(y.header.availablePrecisions,0,{label:"Dynamic Detail"}),bottomLeft:C.Vec3(b.create(0,0,0),{},{isHidden:!0}),topRight:C.Vec3(b.create(0,0,0),{},{isHidden:!0})},{description:"Box around camera target.",isFlat:!0}),cell:C.Group({}),auto:C.Group({radius:C.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),selectionDetailLevel:i(y.header.availablePrecisions,6,{label:"Selection Detail"}),isSelection:C.Boolean(!1,{isHidden:!0}),bottomLeft:C.Vec3(g.min,{},{isHidden:!0}),topRight:C.Vec3(g.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:c.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:i(y.header.availablePrecisions,3),channels:y.kind==="em"?C.Group({em:t("EM",6524815,y.emDefaultContourLevel||Ve.IsoValue.relative(1),y.header.sampling[0].valuesInfo[0],f.em)},{isFlat:!0}):C.Group({"2fo-fc":t("2Fo-Fc",3367602,Ve.IsoValue.relative(1.5),y.header.sampling[0].valuesInfo[0],f["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",3390259,Ve.IsoValue.relative(3),y.header.sampling[0].valuesInfo[1],f["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",12268339,Ve.IsoValue.relative(-3),y.header.sampling[0].valuesInfo[1],f["fo-fc(-ve)"])},{isFlat:!0})}}c.createEntryParams=o;function i(m,d,p){return C.Select(Math.min(d,m.length-1),m.map((h,f)=>[f,`${f+1} [ ${Math.pow(h.maxVoxels,1/3)|0}^3 cells ]`]),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 1 (0.52M voxels) to 7 (25.17M voxels).",...p})}function a(m){return{entry:{name:m.entry.name,params:{detailLevel:m.entry.params.detailLevel,channels:m.entry.params.channels,view:{name:m.entry.params.view.name,params:{...m.entry.params.view.params}}}}}}c.copyParams=a,c.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["camera-target","Around Camera"],["cell","Whole Structure"],["auto","Auto"]],c.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]];class u extends qr.WithSubscribers{constructor(p,h){super(p,{});this.plugin=p;this.data=h;this.cache=wR.create(25);this.params={};this.lastLoci=dr;this.ref="";this.cameraTargetObservable=this.plugin.canvas3d.didDraw.pipe(Cu(500,void 0,{leading:!0,trailing:!0}),BC(()=>this.plugin.canvas3d?.camera.getSnapshot()),VT((p,h)=>this.isCameraTargetSame(p,h)),zf(p=>p!==void 0));this.cameraTargetSubscription=void 0;this.channels={};this._invTransform=Z();this.infoMap=new Map,this.data.entries.forEach(f=>this.infoMap.set(f.dataId,f)),this.updateQueue=new FF}get info(){return this.infoMap.get(this.params.entry.name)}async queryData(p){let h=nC(this.data.serverUrl,`${this.info.kind}/${this.info.dataId.toLowerCase()}`);if(p){let{min:v,max:A}=p;h+=`/box/${v.map(_=>Math.round(1e3*_)/1e3).join(",")}/${A.map(_=>Math.round(1e3*_)/1e3).join(",")}`}else h+="/cell";let f=this.params.entry.params.detailLevel;this.params.entry.params.view.name==="auto"&&this.params.entry.params.view.params.isSelection&&(f=this.params.entry.params.view.params.selectionDetailLevel),this.params.entry.params.view.name==="camera-target"&&p&&(f=this.decideDetail(p,this.params.entry.params.view.params.dynamicDetailLevel)),h+=`?detail=${f}`;let y=wR.get(this.cache,h);if(y)return y.data;let g=Zr.getUrlAsset(this.plugin.managers.asset,h),x=await this.plugin.runTask(this.plugin.managers.asset.resolve(g,"binary")),S=await this.parseCif(x.data);if(!S)return;let I=wR.set(this.cache,h,{data:S,asset:x});return I&&I.asset.dispose(),S}async parseCif(p){let h=await this.plugin.runTask(mu.parseBinary(p));if(h.isError){this.plugin.log.error("VolumeStreaming, parsing CIF: "+h.toString());return}if(h.result.blocks.length<2){this.plugin.log.error("VolumeStreaming: Invalid data.");return}let f={};for(let y=1;y<h.result.blocks.length;y++){let g=h.result.blocks[y],x=mu.schema.densityServer(g),S=await this.plugin.runTask(zB(x));f[g.header]=S}return f}async updateParams(p,h=!1){let f=a(this.params),y=f.entry.params.view.name;y!=="off"&&y!=="cell"&&(f.entry.params.view.params.bottomLeft=p?.min||b.zero(),f.entry.params.view.params.topRight=p?.max||b.zero()),y==="auto"&&(f.entry.params.view.params.isSelection=h);let g=this.plugin.state.data,x=g.build().to(this.ref).update(f);await st.State.Update(this.plugin,{state:g,tree:x,options:{doNotUpdateCurrent:!0}})}getStructureRoot(){return this.plugin.state.data.select(er.Generators.byRef(this.ref).rootOfType(re.Molecule.Structure))[0]}register(p){this.ref=p,this.subscribeObservable(this.plugin.state.events.object.removed,h=>{!re.Molecule.Structure.is(h.obj)||!K.Loci.is(this.lastLoci)||this.lastLoci.structure===h.obj.data&&(this.lastLoci=dr)}),this.subscribeObservable(this.plugin.state.events.object.updated,h=>{!re.Molecule.Structure.is(h.oldObj)||!K.Loci.is(this.lastLoci)||this.lastLoci.structure===h.oldObj.data&&(this.lastLoci=dr)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,h=>{if(!this.plugin.state.data.tree.children.has(this.ref))return;let f=h?h.loci:dr;switch(this.params.entry.params.view.name){case"auto":this.updateAuto(f);break;case"selection-box":this.updateSelectionBox(f);break;default:this.lastLoci=f;break}})}unregister(){let p=this.cache.entries.first;for(;p;)p.value.data.asset.dispose(),p=p.next}isCameraTargetSame(p,h){if(!p||!h)return!1;let f=b.equals(p.target,h.target),y=b.squaredDistance(p.target,p.position),g=b.squaredDistance(h.target,h.position),x=Math.abs(y-g)/y<.001;return f&&x}cameraTargetDistance(p){return b.distance(p.target,p.position)}getBoxFromLoci(p){if(Jt.isEmpty(p)||Ii(p))return ut();let h=this.plugin.helpers.substructureParent.get(p.structure,!0);if(!h)return ut();let f=this.getStructureRoot();if(!f||f.obj?.data!==h.obj?.data)return ut();let y=ly.get(f.obj?.data.models[0]);y&&Z.invert(this._invTransform,y);let g=K.Loci.extendToWholeResidues(p),x=K.Loci.getBoundary(g,y&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return K.Loci.size(g)===1&&ut.expand(x,x,b.create(1,1,1)),x}updateAuto(p){this.updateQueue.enqueue(async()=>{this.lastLoci=p,Ii(p)?await this.updateParams(this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0,!1):await this.updateParams(this.getBoxFromLoci(p),!0)})}updateSelectionBox(p){this.updateQueue.enqueue(async()=>{Jt.areEqual(this.lastLoci,p)?this.lastLoci=dr:this.lastLoci=p;let h=this.getBoxFromLoci(this.lastLoci);await this.updateParams(h)})}updateCameraTarget(p){this.updateQueue.enqueue(async()=>{let h=this.plugin.canvas3d?.props.camera.manualReset;try{h||this.plugin.canvas3d?.setProps({camera:{manualReset:!0}});let f=this.boxFromCameraTarget(p,!0);await this.updateParams(f)}finally{h||this.plugin.canvas3d?.setProps({camera:{manualReset:h}})}})}boxFromCameraTarget(p,h){let f=p.target,y=this.cameraTargetDistance(p),x=Math.tan(.5*p.fov)*y,S=this.plugin.canvas3d?.camera.viewport;S&&S.width>S.height&&(x*=S.width/S.height);let I=this.params.entry.params.view.name==="camera-target"?this.params.entry.params.view.params.radius:.5;x*=I;let v,A,_;if(h){let T=b.zero();ut.size(T,this.data.structure.boundary.box),v=Math.min(x,.5*T[0]),A=Math.min(x,.5*T[1]),_=Math.min(x,.5*T[2])}else v=A=_=x;return ut.create(b.create(f[0]-v,f[1]-A,f[2]-_),b.create(f[0]+v,f[1]+A,f[2]+_))}decideDetail(p,h){let f=this.info.kind==="x-ray"?ut.volume(this.data.structure.boundary.box):this.info.header.spacegroup.size.reduce((I,v)=>I*v,1),g=ut.volume(p)/f,x=this.info.header.availablePrecisions.length-1,S=h;for(;g<=.5&&S<x;)g*=2,S+=1;return S}async update(p){let h=p.entry.params.view.name==="selection-box"&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&this.params.entry.params.view.name!=="selection-box";this.params=p;let f,y=!1;switch(p.entry.params.view.name!=="camera-target"&&this.cameraTargetSubscription&&(this.cameraTargetSubscription.unsubscribe(),this.cameraTargetSubscription=void 0),p.entry.params.view.name){case"off":y=!0;break;case"box":f=ut.create(p.entry.params.view.params.bottomLeft,p.entry.params.view.params.topRight),y=ut.volume(f)<1e-4;break;case"selection-box":{h?f=this.getBoxFromLoci(this.lastLoci)||ut():f=ut.create(b.clone(p.entry.params.view.params.bottomLeft),b.clone(p.entry.params.view.params.topRight));let S=p.entry.params.view.params.radius;y=ut.volume(f)<1e-4,ut.expand(f,f,b.create(S,S,S));break}case"camera-target":this.cameraTargetSubscription||(this.cameraTargetSubscription=this.subscribeObservable(this.cameraTargetObservable,S=>this.updateCameraTarget(S))),f=this.boxFromCameraTarget(this.plugin.canvas3d.camera.getSnapshot(),!0);break;case"cell":f=this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0;break;case"auto":if(f=p.entry.params.view.params.isSelection||this.info.kind==="x-ray"?ut.create(b.clone(p.entry.params.view.params.bottomLeft),b.clone(p.entry.params.view.params.topRight)):void 0,f&&(y=ut.volume(f)<1e-4,p.entry.params.view.params.isSelection)){let S=p.entry.params.view.params.radius;ut.expand(f,f,b.create(S,S,S))}break}let g=y?{}:await this.queryData(f);if(!g)return!1;let x=p.entry.params.channels;return this.info.kind==="x-ray"?(this.channels["2fo-fc"]=this.createChannel(g["2FO-FC"]||Ve.One,x["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(g["FO-FC"]||Ve.One,x["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(g["FO-FC"]||Ve.One,x["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(g.EM||Ve.One,x.em,this.info.header.sampling[0].valuesInfo[0]),!0}createChannel(p,h,f){let y=h;return{data:p,color:y.color,wireframe:y.wireframe,opacity:y.opacity,isoValue:y.isoValue.kind==="relative"?y.isoValue:Ve.IsoValue.toRelative(y.isoValue,f)}}getDescription(){return this.params.entry.params.view.name==="selection-box"?"Selection":this.params.entry.params.view.name==="camera-target"?"Camera":this.params.entry.params.view.name==="box"?"Static Box":this.params.entry.params.view.name==="cell"?"Cell":""}}c.Behavior=u})(ps||={});function aPe(e,t){let r=fct(e,t||OF());return bct(e.tree,r),t&&t.refs.forEach(gct,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function OF(){return{trajectories:[],models:[],structures:[],refs:new Map}}function oct(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function rPe(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function ict(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function act(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function nPe(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function sct(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function lct(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function uct(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function cct(e){return e.transform.tags?[...e.transform.tags].sort().join():e.transform.ref}function mct(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:cct(e),representations:[]}}function dct(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function pct(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function fct(e,t){return{state:e,oldHierarchy:t,hierarchy:OF(),changed:!1,added:new Set}}function LA(e,t,r,n,...o){let i=n(...o);r.push(i),e.hierarchy.refs.set(t.transform.ref,i);let a=e.oldHierarchy.refs.get(t.transform.ref);return a?a.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function GS(e,t,r,...n){let o=r(...n);e.hierarchy.refs.set(t.transform.ref,o);let i=e.oldHierarchy.refs.get(t.transform.ref);return i?i.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function oPe(e){return t=>e.is(t.obj)}function iPe(e,t){return(r,n)=>!t(n)&&e.is(r.obj)}function VF(e){return t=>t.transform.transformer===e}function US(){}var hct=[[oPe(re.Molecule.Trajectory),(e,t)=>{e.currentTrajectory=LA(e,t,e.hierarchy.trajectories,oct,t)},e=>e.currentTrajectory=void 0],[iPe(re.Molecule.Model,e=>e.currentModel),(e,t)=>{e.currentTrajectory?e.currentModel=LA(e,t,e.currentTrajectory.models,rPe,t,e.currentTrajectory):e.currentModel=GS(e,t,rPe,t),e.hierarchy.models.push(e.currentModel)},e=>e.currentModel=void 0],[VF(Xe.Model.CustomModelProperties),(e,t)=>{if(!e.currentModel)return!1;e.currentModel.properties=GS(e,t,ict,t,e.currentModel)},US],[VF(Xe.Representation.ModelUnitcell3D),(e,t)=>{if(!e.currentModel)return!1;e.currentModel.unitcell=GS(e,t,act,t,e.currentModel)},US],[iPe(re.Molecule.Structure,e=>e.currentStructure),(e,t)=>{e.currentModel?e.currentStructure=LA(e,t,e.currentModel.structures,nPe,t,e.currentModel):e.currentStructure=GS(e,t,nPe,t),e.hierarchy.structures.push(e.currentStructure)},e=>e.currentStructure=void 0],[VF(Xe.Model.CustomStructureProperties),(e,t)=>{if(!e.currentStructure)return!1;e.currentStructure.properties=GS(e,t,sct,t,e.currentStructure)},US],[VF(Xe.Model.TransformStructureConformation),(e,t)=>{if(!e.currentStructure)return!1;e.currentStructure.transform=GS(e,t,lct,t,e.currentStructure)},US],[oPe(ps),(e,t)=>(e.currentStructure&&(e.currentStructure.volumeStreaming=GS(e,t,uct,t,e.currentStructure)),!1),US],[(e,t)=>!t.currentStructure||e.transform.transformer.definition.isDecorator?!1:re.Molecule.Structure.is(e.obj),(e,t)=>{e.currentStructure&&(e.currentComponent&&(e.parentComponents||(e.parentComponents=[]),e.parentComponents.push(e.currentComponent)),e.currentComponent=LA(e,t,e.currentStructure.components,mct,t,e.currentStructure))},e=>{e.parentComponents&&e.parentComponents.length>0?e.currentComponent=e.parentComponents.pop():e.currentComponent=void 0}],[(e,t)=>!e.state.isGhost&&!!t.currentComponent&&re.Molecule.Structure.Representation3D.is(e.obj),(e,t)=>(e.currentComponent&&LA(e,t,e.currentComponent.representations,dct,t,e.currentComponent),!1),US],[e=>!e.state.isGhost&&re.isRepresentation3D(e.obj),(e,t)=>{let r=e.currentComponent||e.currentStructure||e.currentModel;r&&(r.genericRepresentations||(r.genericRepresentations=[]),LA(e,t,r.genericRepresentations,pct,t,r))},US]];function sPe(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;let{obj:t}=e;return!(!t||t===An.Null||e.status!=="ok"&&e.status!=="error")}function gct(e){let{cell:t}=e;sPe(t)||(this.changed=!0)}function yct(e){lPe(this,this.tree.transforms.get(e))}function lPe(e,t){let{state:r}=e,n=r.state.cells.get(t.ref);if(!sPe(n))return;let o,i=!1;for(let[s,l,u]of hct)if(s(n,r)){if(l(r,n)===!1){i=!0;break}o=u;break}if(i)return;let a=e.tree.children.get(t.ref);a&&a.size&&a.forEach(yct,e),o&&o(r)}function bct(e,t){let r={tree:e,state:t};return lPe(r,e.root),r.state}var ig=class e extends ic{constructor(r){super();this.plugin=r;this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:OF(),selection:{trajectories:[],models:[],structures:[]}};this.behaviors={selection:this.ev.behavior({hierarchy:this.current,trajectories:this.selection.trajectories,models:this.selection.models,structures:this.selection.structures})};this._currentComponentGroups=void 0;this._currentSelectionSet=void 0;this.subscribe(r.state.data.events.changed,n=>{n.inTransaction||r.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe(r.behaviors.state.isAnimating,n=>{!n&&!r.behaviors.state.isUpdating.value&&this.sync(!0)})}get dataState(){return this.plugin.state.data}get currentComponentGroups(){return this._currentComponentGroups?this._currentComponentGroups:(this._currentComponentGroups=e.getComponentGroups(this.selection.structures),this._currentComponentGroups)}get seletionSet(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(let r of this.selection.trajectories)this._currentSelectionSet.add(r.cell.transform.ref);for(let r of this.selection.models)this._currentSelectionSet.add(r.cell.transform.ref);for(let r of this.selection.structures)this._currentSelectionSet.add(r.cell.transform.ref);return this._currentSelectionSet}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}getStructuresWithSelection(){let r=this.plugin.managers.structure.hierarchy.current.structures,n=[];for(let o of r)this.plugin.managers.structure.selection.structureHasSelection(o)&&n.push(o);return n}findStructure(r){if(!r)return;let n=this.plugin.helpers.substructureParent.get(r);if(!n)return;let o=this.plugin.state.data.selectQ(i=>i.byValue(n).rootOfType(re.Molecule.Structure))[0];if(o)return this.behaviors.selection.value.structures.find(i=>i.cell===o)}syncCurrent(r,n){let o=this.seletionSet,i=[];for(let a of r){let s=a.cell.transform.ref;(o.has(s)||n.has(s))&&i.push(a)}return i.length===0?r.length>0?[r[0]]:[]:i}sync(r){if(!r&&this.dataState.inUpdate)return;if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,...this.state.selection}));return}this.state.syncedTree=this.dataState.tree;let n=aPe(this.plugin.state.data,this.current);if(!n.changed)return;let{hierarchy:o}=n,i=this.syncCurrent(o.trajectories,n.added),a=this.syncCurrent(o.models,n.added),s=this.syncCurrent(o.structures,n.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=o,this.state.selection.trajectories=i,this.state.selection.models=a,this.state.selection.structures=s,r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:o,trajectories:i,models:a,structures:s})):this.state.notified=!1}updateCurrent(r,n){let o=this.current,i=n==="add"?no.union(this.seletionSet,new Set(r.map(u=>u.cell.transform.ref))):no.difference(this.seletionSet,new Set(r.map(u=>u.cell.transform.ref))),a=[],s=[],l=[];for(let u of o.trajectories)i.has(u.cell.transform.ref)&&a.push(u);for(let u of o.models)i.has(u.cell.transform.ref)&&s.push(u);for(let u of o.structures)i.has(u.cell.transform.ref)&&l.push(u);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=a,this.state.selection.models=s,this.state.selection.structures=l,this.behaviors.selection.next({hierarchy:o,trajectories:a,models:s,structures:l})}remove(r,n){if(r.length===0)return;let o=this.plugin.state.data.build();for(let i of r)o.delete(typeof i=="string"?i:i.cell.transform.ref);return o.commit({canUndo:n?"Remove":!1})}toggleVisibility(r,n){if(r.length===0)return;let o=n!==void 0?n!=="show":!r[0].cell.state.isHidden;for(let i of r)Ef(this.dataState,i.cell.transform.ref,o)}applyPreset(r,n,o){return this.plugin.dataTransaction(async()=>{for(let i of r)i.models.length>0&&await this.clearTrajectory(i),await this.plugin.builders.structure.hierarchy.applyPreset(i.cell,n,o)})}async updateStructure(r,n){await this.plugin.dataTransaction(async()=>{let o=zo.getDecoratorRoot(this.dataState.tree,r.cell.transform.ref),i=this.dataState.tree.children.get(o).toArray();await this.remove(i,!1),await this.plugin.state.updateTransform(this.plugin.state.data,r.cell.transform.ref,n,"Structure Type"),await this.plugin.builders.structure.representation.applyPreset(r.cell.transform.ref,"auto")},{canUndo:"Structure Type"}),st.Camera.Reset(this.plugin)}clearTrajectory(r){let n=this.dataState.build();for(let o of r.models)n.delete(o.cell);return n.commit()}};(r=>{function e(n){if(!n.length)return[];if(n.length===1)return n[0].components.map(a=>[a]);let o=[],i=new Map;for(let a of n)for(let s of a.components){let l=s.key;if(!l)continue;let u=i.get(l);u||(u=[],i.set(l,u),o.push(u)),u.push(s)}return o}r.getComponentGroups=e;function t(n){let{structures:o}=n.managers.structure.hierarchy.selection;if(o.length===0)return"";if(o.length===1){let l=o[0],u=l.cell.obj?.data;if(!u)return l.cell.obj?.label||"Structure";let c=u.models[0]||u.representativeModel||u.masterModel;if(!c)return l.cell.obj?.label||"Structure";let m=c.entryId;return l.model?.trajectory?.models&&l.model.trajectory.models.length===1?m:l.model?`${l.model.cell.obj?.label} | ${m}`:m}let a=o[0]?.model?.trajectory,s=!0;for(let l of o)if(l?.model?.trajectory!==a){s=!1;break}return s&&a?`${a.cell.obj?.label} | ${o.length} structures`:`${o.length} structures`}r.getSelectedStructuresDescription=t})(ig||={});var fs=Rt(nr());var Vf=class extends ii{constructor(){super(...arguments);this.onChange=({name:r,value:n})=>{let o={...this.props.params,[r]:n};this.props.events.onChange(o,this.areInitial(o),this.validate(o))}}validate(r){}areInitial(r){return C.areEqual(this.props.info.params,r,this.props.info.initialValues)}render(){return(0,fs.jsx)(Kn,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})}};(n=>{function e(o){let i=Object.keys(o);for(let a of i)if(!o[a].isHidden)return!1;return!0}function t(o,i,a,s){let l=i.cells.get(s).obj,u=a.definition.params?a.definition.params(l,o):{};return{initialValues:C.getDefaultValues(u),params:u,isEmpty:e(u)}}n.infoFromAction=t;function r(o,i,a){let s=i.cells.get(a.ref),l=s.params&&s.params.definition||{};return{initialValues:s.params&&s.params.values||{},params:l,isEmpty:e(l)}}n.infoFromTransform=r})(Vf||={});var FA=class extends ii{constructor(){super(...arguments);this.busy=new Pa(!1);this.onEnter=()=>{this.state.error||this.apply()};this.autoApplyHandle=void 0;this.events={onEnter:this.onEnter,onChange:(r,n,o)=>{this.clearAutoApply(),this.setState({params:r,isInitial:n,error:o&&o[0]},()=>{!n&&!this.state.error&&this.canAutoApply(r)&&(this.clearAutoApply(),this.autoApplyHandle=setTimeout(this.apply,50))})}};this.apply=async()=>{this.clearAutoApply(),this.setState({busy:!0});try{await this.applyAction()}catch(r){console.error(r)}finally{this.props.onApply?.(),this.busy.next(!1)}};this.refresh=()=>{this.setState({params:this.getInfo().initialValues,isInitial:!0,error:void 0})};this.setDefault=()=>{let r=this.getInfo(),n=C.getDefaultValues(r.params);this.setState({params:n,isInitial:C.areEqual(r.params,n,r.initialValues),error:void 0})};this.toggleExpanded=()=>{this.setState({isCollapsed:!this.state.isCollapsed})}}clearAutoApply(){this.autoApplyHandle!==void 0&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)}componentDidMount(){this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.busy.value!==r&&this.busy.next(r)}),this.subscribe(this.busy.pipe(OT(1)),r=>{this.setState({busy:r})})}renderApply(){let r=this.canApply();return this.props.autoHideApply&&(!r||this.canAutoApply(this.state.params))?null:(0,fs.jsxs)("div",{className:"msp-transform-apply-wrap",children:[(0,fs.jsx)(or,{svg:HP,className:"msp-transform-default-params",onClick:this.setDefault,disabled:this.state.busy,title:"Set default params"}),(0,fs.jsx)("div",{className:"msp-transform-apply-wider",children:(0,fs.jsx)(sr,{icon:r?Lm:void 0,className:`msp-btn-commit msp-btn-commit-${r?"on":"off"}`,onClick:this.apply,disabled:!r,children:this.props.applyLabel||this.applyText()})})]})}renderDefault(){let r=this.getInfo(),n=r.isEmpty&&this.isUpdate(),o=this.getHeader(),i=this.getTransformerId(),a=this.plugin.customParamEditors.has(i)?this.plugin.customParamEditors.get(i):Vf,s=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper",l=null;if(!n&&!this.state.isCollapsed){let{a:c,b:m,bCell:d}=this.getSourceAndTarget(),p=this.renderApply();l=(0,fs.jsxs)(fs.Fragment,{children:[(0,fs.jsx)(a,{info:r,a:c,b:m,bCell:d,events:this.events,params:this.state.params,isDisabled:this.state.busy}),p]})}let u=(0,fs.jsxs)("div",{className:s,style:{marginBottom:this.props.noMargin?0:void 0},children:[o!=="none"&&!this.props.wrapInExpander&&(0,fs.jsx)("div",{className:"msp-transform-header",children:(0,fs.jsxs)(sr,{onClick:this.toggleExpanded,title:o.description,children:[!n&&(0,fs.jsx)(yn,{svg:this.state.isCollapsed?Eu:wu}),o.name]})}),l]});return n||!this.props.wrapInExpander?u:(0,fs.jsx)(Ja,{header:this.isUpdate()?`Update ${o==="none"?"":o.name}`:`Apply ${o==="none"?"":o.name}`,headerLeftMargin:this.props.expanderHeaderLeftMargin,children:u})}renderSimple(){let r=this.getInfo(),n=this.canApply(),o=(0,fs.jsxs)("div",{className:"msp-flex-row",children:[(0,fs.jsx)(sr,{icon:this.props.simpleApply?.icon,title:this.props.simpleApply?.title,disabled:this.state.busy||!n,onClick:this.apply,className:"msp-btn-apply-simple",children:this.props.simpleApply?.header}),!r.isEmpty&&(0,fs.jsx)(di,{icon:pc,label:"",title:"Options",toggle:this.toggleExpanded,isSelected:!this.state.isCollapsed,disabled:this.state.busy,style:{flex:"0 0 40px",padding:0}})]});if(this.state.isCollapsed)return o;let i=this.getTransformerId(),a=this.plugin.customParamEditors.has(i)?this.plugin.customParamEditors.get(i):Vf,{a:s,b:l,bCell:u}=this.getSourceAndTarget();return(0,fs.jsxs)(fs.Fragment,{children:[o,(0,fs.jsx)(a,{info:r,a:s,b:l,bCell:u,events:this.events,params:this.state.params,isDisabled:this.state.busy})]})}render(){return this.props.simpleApply?this.renderSimple():this.renderDefault()}};var xct=Rt(nr());var $u=class extends FA{constructor(){super(...arguments);this._getInfo=uu(r=>Vf.infoFromTransform(this.plugin,this.props.state,r));this.state={error:void 0,isInitial:!0,params:this.getInfo().initialValues,busy:!1,isCollapsed:this.props.initiallyCollapsed}}applyAction(){return this.props.customUpdate?this.props.customUpdate(this.state.params):this.plugin.state.updateTransform(this.props.state,this.props.transform.ref,this.state.params)}getInfo(){return this._getInfo(this.props.transform)}getTransformerId(){return this.props.transform.transformer.id}getHeader(){return this.props.customHeader||this.props.transform.transformer.definition.display}canApply(){let{state:r}=this.props,n=r.cells.get(this.props.transform.ref);if(!n)return!1;if(n.status==="error"){let o=r.cells.get(this.props.transform.parent);return o?o.status==="ok":!1}return!this.state.error&&!this.state.busy&&!this.state.isInitial}applyText(){return this.canApply()?"Update":"Nothing to Update"}isUpdate(){return!0}getSourceAndTarget(){let r=this.props.state.cells.get(this.props.transform.ref);return{a:this.props.state.cells.get(this.props.transform.parent).obj,b:r?.obj,bCell:r}}canAutoApply(r){let n=this.props.transform.transformer.definition.canAutoUpdate;if(!n)return!1;let{state:o}=this.props,i=o.cells.get(this.props.transform.ref);if(!i||!i.sourceRef||i.status!=="ok")return!1;let a=o.cells.get(i.sourceRef);return n({a:a.obj,b:i.obj,oldParams:this.getInfo().initialValues,newParams:r},this.plugin)}componentDidMount(){super.componentDidMount(),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,()=>this.setState({isCollapsed:!this.state.isCollapsed})),this.subscribe(this.plugin.state.events.object.updated,({ref:r,state:n})=>{this.props.transform.ref!==r||this.props.state!==n||this.state.params!==this.props.transform.params&&(this._getInfo=uu(o=>Vf.infoFromTransform(this.plugin,this.props.state,o)),this.setState({params:this.props.transform.params,isInitial:!0}))})}componentDidUpdate(r){if(this.props.transform!==r.transform){let n=this.props.state.cells.get(this.props.transform.ref);this.setState({params:n.params?.values||{},isInitial:!0,error:void 0,simpleOnly:this.state.simpleOnly})}}};var Ys=Rt(nr()),GF=class extends ii{get current(){return this.plugin.managers.structure.hierarchy.behaviors.selection}componentDidMount(){this.subscribe(this.current,()=>this.forceUpdate())}get unitcell(){let{selection:t}=this.plugin.managers.structure.hierarchy;if(t.structures.length===0)return null;let r=[];for(let n of t.structures){let o=n.model;o?.unitcell&&o.unitcell?.cell.obj&&r.push(o.unitcell)}return r.length===0?null:(0,Ys.jsx)(UF,{refs:r,labelMultiple:"Unit Cells"})}get customControls(){let t=[];return this.plugin.genericRepresentationControls.forEach((r,n)=>{let[o,i]=r(this.plugin.managers.structure.hierarchy.selection);o.length>0&&t.push((0,Ys.jsx)("div",{children:(0,Ys.jsx)(UF,{refs:o,labelMultiple:i})},n))}),t.length>0?t:null}render(){return(0,Ys.jsx)(Ys.Fragment,{children:(0,Ys.jsxs)("div",{style:{marginTop:"6px"},children:[this.unitcell,this.customControls]})})}},UF=class extends ii{constructor(){super(...arguments);this.state={showOptions:!1};this.toggleVisibility=r=>{r.preventDefault(),this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.refs),r.currentTarget.blur()};this.highlight=r=>{r.preventDefault(),this.pivot.cell.parent&&st.Interactivity.Object.Highlight(this.plugin,{state:this.pivot.cell.parent,ref:this.props.refs.map(n=>n.cell.transform.ref)})};this.clearHighlight=r=>{r.preventDefault(),st.Interactivity.ClearHighlights(this.plugin)};this.focus=r=>{r.preventDefault();let n=!0;for(let i of this.props.refs)if(!i.cell.state.isHidden){n=!1;break}n&&this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.refs,"show");let o=[];for(let i of this.props.refs){if(i.cell.state.isHidden)continue;let a=i.cell.obj?.data.repr.getLoci();a&&o.push(a)}this.plugin.managers.camera.focusLoci(o)};this.toggleOptions=()=>this.setState({showOptions:!this.state.showOptions})}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,r=>{rm.ObjectEvent.isCell(r,this.pivot?.cell)&&this.forceUpdate()})}get pivot(){return this.props.refs[0]}render(){let{refs:r,labelMultiple:n}=this.props;if(r.length===0)return null;let o=r[0],i,a;if(r.length===1){let{obj:s}=o.cell;if(!s)return null;i=s?.label,a=s?.description}else i=`${r.length} ${n||"Objects"}`;return(0,Ys.jsxs)(Ys.Fragment,{children:[(0,Ys.jsxs)("div",{className:"msp-flex-row",children:[(0,Ys.jsxs)("button",{className:"msp-form-control msp-control-button-label",title:`${i}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[i," ",(0,Ys.jsx)("small",{children:a})]}),(0,Ys.jsx)(or,{svg:o.cell.state.isHidden?Fm:Jc,toggleState:!1,className:"msp-form-control",onClick:this.toggleVisibility,title:`${o.cell.state.isHidden?"Show":"Hide"}`,small:!0,flex:!0}),r.length===1&&(0,Ys.jsx)(or,{svg:Fd,className:"msp-form-control",onClick:this.toggleOptions,title:"Options",toggleState:this.state.showOptions,flex:!0})]}),r.length===1&&this.state.showOptions&&o.cell.parent&&(0,Ys.jsx)(Ys.Fragment,{children:(0,Ys.jsx)("div",{className:"msp-control-offset",children:(0,Ys.jsx)($u,{state:o.cell.parent,transform:o.cell.transform,customHeader:"none",autoHideApply:!0})})})]})}};var gn=Rt(nr()),NF=class extends hc{defaultState(){return{header:"Components",isCollapsed:!1,isDisabled:!1,brand:{accent:"blue",svg:GP}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>this.setState({description:ig.getSelectedStructuresDescription(this.plugin)}))}renderControls(){return(0,gn.jsxs)(gn.Fragment,{children:[(0,gn.jsx)(eQ,{}),(0,gn.jsx)(rQ,{}),(0,gn.jsx)(GF,{})]})}},eQ=class extends ii{constructor(){super(...arguments);this.state={isEmpty:!0,isBusy:!1,canUndo:!1};this.togglePreset=this.toggleAction("preset");this.toggleAdd=this.toggleAction("add");this.toggleOptions=this.toggleAction("options");this.hideAction=()=>this.setState({action:void 0});this.applyPreset=r=>{if(this.hideAction(),!r)return;let n=this.plugin.managers.structure,{structures:o}=n.hierarchy.selection;r.value===null?n.component.clear(o):n.component.applyPreset(o,r.value)};this.undo=()=>{let r=this.plugin.state.data.undo();r&&this.plugin.runTask(r)}}get isDisabled(){return this.state.isBusy||this.state.isEmpty}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,r=>this.setState({action:this.state.action!=="options"||r.structures.length===0?void 0:"options",isEmpty:r.structures.length===0})),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r,action:this.state.action!=="options"?void 0:"options"})}),this.subscribe(this.plugin.state.data.events.historyUpdated,({state:r})=>{this.setState({canUndo:r.canUndo})})}toggleAction(r){return()=>this.setState({action:this.state.action===r?void 0:r})}get presetControls(){return(0,gn.jsx)(br,{items:this.presetActions,onSelect:this.applyPreset})}get presetActions(){let r=this.plugin.managers.structure.component.pivotStructure,n=this.plugin.builders.structure.representation.getPresets(r?.cell.obj);return br.createItems(n,{label:o=>o.display.name,category:o=>o.display.group,description:o=>o.display.description})}render(){let r=this.state.canUndo?`Undo ${this.plugin.state.data.latestUndoLabel}`:"Some mistakes of the past can be undone.";return(0,gn.jsxs)(gn.Fragment,{children:[(0,gn.jsxs)("div",{className:"msp-flex-row",children:[(0,gn.jsx)(di,{icon:Qg,label:"Preset",title:"Apply a representation preset for the current structure(s).",toggle:this.togglePreset,isSelected:this.state.action==="preset",disabled:this.isDisabled}),(0,gn.jsx)(di,{icon:Kp,label:"Add",title:"Add a new representation component for a selection.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled}),(0,gn.jsx)(di,{icon:pc,label:"",title:"Options that are applied to all applicable representations.",style:{flex:"0 0 40px",padding:0},toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.isDisabled}),(0,gn.jsx)(or,{svg:WP,className:"msp-flex-item",flex:"40px",onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:r})]}),this.state.action==="preset"&&this.presetControls,this.state.action==="add"&&(0,gn.jsx)("div",{className:"msp-control-offset",children:(0,gn.jsx)(ER,{onApply:this.hideAction})}),this.state.action==="options"&&(0,gn.jsx)("div",{className:"msp-control-offset",children:(0,gn.jsx)(tQ,{isDisabled:this.isDisabled})})]})}},ER=class extends ii{constructor(){super(...arguments);this.state=this.createState();this.apply=()=>{let r=this.props.forSelection?this.currentStructures:this.selectedStructures;this.props.onApply(),this.plugin.managers.structure.component.add(this.state.values,r)};this.paramsChanged=r=>this.setState({values:r})}createState(){let r=gp.getAddParams(this.plugin);return{params:r,values:C.getDefaultValues(r)}}get selectedStructures(){return this.plugin.managers.structure.component.currentStructures}get currentStructures(){return this.plugin.managers.structure.hierarchy.current.structures}render(){return(0,gn.jsxs)(gn.Fragment,{children:[(0,gn.jsx)(Kn,{params:this.state.params,values:this.state.values,onChangeValues:this.paramsChanged}),(0,gn.jsx)(sr,{icon:Kp,title:"Use Selection and optional Representation to create a new Component.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"},children:"Create Component"})]})}},tQ=class extends ii{constructor(){super(...arguments);this.update=r=>this.plugin.managers.structure.component.setOptions(r)}componentDidMount(){this.subscribe(this.plugin.managers.structure.component.events.optionsUpdated,()=>this.forceUpdate())}render(){return(0,gn.jsx)(Kn,{params:gp.OptionsParams,values:this.plugin.managers.structure.component.state.options,onChangeValues:this.update,isDisabled:this.props.isDisabled})}},rQ=class extends ii{componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>{this.forceUpdate()})}render(){let t=this.plugin.managers.structure.hierarchy.currentComponentGroups;return t.length===0?null:(0,gn.jsx)("div",{style:{marginTop:"6px"},children:t.map(r=>(0,gn.jsx)(nQ,{group:r},r[0].cell.transform.ref))})}},nQ=class extends ii{constructor(){super(...arguments);this.state={action:void 0};this.toggleVisible=r=>{r.preventDefault(),r.currentTarget.blur(),this.plugin.managers.structure.component.toggleVisibility(this.props.group)};this.selectAction=r=>{r&&(r?.value)()};this.remove=()=>this.plugin.managers.structure.hierarchy.remove(this.props.group,!0);this.toggleAction=()=>this.setState({action:this.state.action==="action"?void 0:"action"});this.toggleLabel=()=>this.setState({action:this.state.action==="label"?void 0:"label"});this.highlight=r=>{r.preventDefault(),this.props.group[0].cell.parent&&st.Interactivity.Object.Highlight(this.plugin,{state:this.props.group[0].cell.parent,ref:this.props.group.map(n=>n.cell.transform.ref)})};this.clearHighlight=r=>{r.preventDefault(),st.Interactivity.ClearHighlights(this.plugin)};this.focus=()=>{let r=!0;for(let n of this.props.group)if(!n.cell.state.isHidden){r=!1;break}r&&this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.group,"show"),this.plugin.managers.camera.focusSpheres(this.props.group,n=>{if(!n.cell.state.isHidden)return n.cell.obj?.data.boundary.sphere})};this.updateLabel=r=>{this.plugin.managers.structure.component.updateLabel(this.pivot,r)}}get pivot(){return this.props.group[0]}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,r=>{rm.ObjectEvent.isCell(r,this.pivot.cell)&&this.forceUpdate()})}get colorByActions(){let r=this.plugin.managers.structure.component,o=this.pivot.representations[0].cell.transform.params?.colorTheme.name,i=PAe(this.plugin,this.pivot.cell.obj?.data);return br.createItemsFromSelectOptions(i,{value:a=>()=>r.updateRepresentationsTheme(this.props.group,{color:a[0]}),selected:a=>a[0]===o})}get actions(){let r=this.plugin.managers.structure.component,n=[[br.Header("Add Representation"),...gp.getRepresentationTypes(this.plugin,this.props.group[0]).map(o=>br.Item(o[1],()=>r.addRepresentation(this.props.group,o[0])))]];return this.pivot.representations.length>0&&n.push([br.Header("Set Coloring",{isIndependent:!0}),...this.colorByActions]),r.canBeModified(this.props.group[0])&&n.push([br.Header("Modify by Selection"),br.Item("Include",()=>r.modifyByCurrentSelection(this.props.group,"union"),{icon:FP}),br.Item("Subtract",()=>r.modifyByCurrentSelection(this.props.group,"subtract"),{icon:VP}),br.Item("Intersect",()=>r.modifyByCurrentSelection(this.props.group,"intersect"),{icon:OP})]),n.push(br.Item("Select This",()=>r.selectThis(this.props.group),{icon:i0})),r.canBeModified(this.props.group[0])&&n.push(br.Item("Edit Label",this.toggleLabel)),n}get reprLabel(){let r=this.pivot;return r.representations.length===0?"No repr.":r.representations.length===1?r.representations[0].cell.obj?.label:`${r.representations.length} reprs`}render(){let r=this.pivot,n=r.cell,o=n.obj?.label,i=this.reprLabel;return(0,gn.jsxs)(gn.Fragment,{children:[(0,gn.jsxs)("div",{className:"msp-flex-row",children:[(0,gn.jsxs)(sr,{noOverflow:!0,className:"msp-control-button-label",title:`${o}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[o,(0,gn.jsx)("small",{className:"msp-25-lower-contrast-text",style:{float:"right"},children:i})]}),(0,gn.jsx)(or,{svg:n.state.isHidden?Fm:Jc,toggleState:!1,onClick:this.toggleVisible,title:`${n.state.isHidden?"Show":"Hide"} component`,small:!0,className:"msp-form-control",flex:!0}),(0,gn.jsx)(or,{svg:Vs,toggleState:!1,onClick:this.remove,title:"Remove",small:!0,className:"msp-form-control",flex:!0}),(0,gn.jsx)(or,{svg:Fd,onClick:this.toggleAction,title:"Actions",toggleState:this.state.action==="action",className:"msp-form-control",flex:!0})]}),this.state.action==="label"&&(0,gn.jsx)("div",{className:"msp-control-offset",style:{marginBottom:"6px"},children:(0,gn.jsx)(Sl,{label:"Label",control:(0,gn.jsxs)("div",{style:{display:"flex",textAlignLast:"center"},children:[(0,gn.jsx)(fc,{onChange:this.updateLabel,value:o,style:{flex:"1 1 auto",minWidth:0},className:"msp-form-control",blurOnEnter:!0,blurOnEscape:!0}),(0,gn.jsx)(or,{svg:Lm,onClick:this.toggleLabel,className:"msp-form-control msp-control-button-label",flex:!0})]})})}),this.state.action==="action"&&(0,gn.jsxs)("div",{className:"msp-accent-offset",children:[(0,gn.jsx)("div",{style:{marginBottom:"6px"},children:(0,gn.jsx)(br,{items:this.actions,onSelect:this.selectAction,noOffset:!0})}),(0,gn.jsx)("div",{style:{marginBottom:"6px"},children:r.representations.map(a=>(0,gn.jsx)(oQ,{group:this.props.group,representation:a},a.cell.transform.ref))})]})]})}},oQ=class extends ii{constructor(){super(...arguments);this.remove=()=>this.plugin.managers.structure.component.removeRepresentations(this.props.group,this.props.representation);this.toggleVisible=r=>{r.preventDefault(),r.currentTarget.blur(),this.plugin.managers.structure.component.toggleVisibility(this.props.group,this.props.representation)};this.update=r=>this.plugin.managers.structure.component.updateRepresentations(this.props.group,this.props.representation,r)}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,r=>{rm.ObjectEvent.isCell(r,this.props.representation.cell)&&this.forceUpdate()})}render(){let r=this.props.representation.cell;return(0,gn.jsxs)("div",{className:"msp-representation-entry",children:[r.parent&&(0,gn.jsx)(Ja,{header:`${r.obj?.label||""} Representation`,noOffset:!0,children:(0,gn.jsx)($u,{state:r.parent,transform:r.transform,customHeader:"none",customUpdate:this.update,noMargin:!0})}),(0,gn.jsx)(or,{svg:Vs,onClick:this.remove,title:"Remove",small:!0,className:"msp-default-bg",toggleState:!1,style:{position:"absolute",top:0,right:"32px",lineHeight:"24px",height:"24px",textAlign:"right",width:"44px",paddingRight:"6px",background:"none"}}),(0,gn.jsx)(or,{svg:this.props.representation.cell.state.isHidden?Fm:Jc,toggleState:!1,onClick:this.toggleVisible,title:"Toggle Visibility",small:!0,className:"msp-default-bg",style:{position:"absolute",top:0,right:0,lineHeight:"24px",height:"24px",textAlign:"right",width:"32px",paddingRight:"6px",background:"none"}})]})}};var iQ="measurement-group",zF="measurement-order-label",aQ={distanceUnitLabel:C.Text("\u212B",{isEssential:!0}),textColor:Bj.textColor},Cct=C.getDefaultValues(aQ);function gd(e){return{bundle:K.Bundle.fromLoci(e)}}var HF=class extends Bs{constructor(r){super({labels:[],distances:[],angles:[],dihedrals:[],orientations:[],planes:[],options:Cct});this.plugin=r;this.behaviors={state:this.ev.behavior(this.state)};this._empty=[];r.state.data.events.changed.subscribe(n=>{n.inTransaction||r.behaviors.state.isAnimating.value||this.sync()}),r.behaviors.state.isAnimating.subscribe(n=>{!n&&!r.behaviors.state.isUpdating.value&&this.sync()})}stateUpdated(){this.behaviors.state.next(this.state)}getGroup(){let r=this.plugin.state.data,n=er.findTagInSubtree(r.tree,Ar.RootRef,iQ),o=this.plugin.state.data.build();return n?o.to(n):o.toRoot().group(Xe.Misc.CreateGroup,{label:"Measurements"},{tags:iQ})}async setOptions(r){this.updateState({options:r})&&this.stateUpdated();let n=this.plugin.state.data.build();for(let o of this.state.distances)n.to(o).update(i=>{i.unitLabel=r.distanceUnitLabel,i.textColor=r.textColor});for(let o of this.state.labels)n.to(o).update(i=>{i.textColor=r.textColor});for(let o of this.state.angles)n.to(o).update(i=>{i.textColor=r.textColor});for(let o of this.state.dihedrals)n.to(o).update(i=>{i.textColor=r.textColor});n.editInfo.count!==0&&await st.State.Update(this.plugin,{state:this.plugin.state.data,tree:n,options:{doNotLogTiming:!0}})}async addDistance(r,n,o){let i=this.plugin.helpers.substructureParent.get(r.structure),a=this.plugin.helpers.substructureParent.get(n.structure);if(!i||!a)return;let s=[i.transform.ref];qo(s,a.transform.ref);let u=this.getGroup().apply(Xe.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",groupId:"a",ref:i.transform.ref,...gd(r)},{key:"b",groupId:"b",ref:a.transform.ref,...gd(n)}],isTransitive:!0,label:"Distance"},{dependsOn:s,tags:o?.selectionTags}),c=u.apply(Xe.Representation.StructureSelectionsDistance3D,{customText:o?.customText||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor,...o?.lineParams,...o?.labelParams,...o?.visualParams},{tags:o?.reprTags}),m=this.plugin.state.data;return await st.State.Update(this.plugin,{state:m,tree:c,options:{doNotLogTiming:!0}}),{selection:u.selector,representation:c.selector}}async addAngle(r,n,o,i){let a=this.plugin.helpers.substructureParent.get(r.structure),s=this.plugin.helpers.substructureParent.get(n.structure),l=this.plugin.helpers.substructureParent.get(o.structure);if(!a||!s||!l)return;let u=[a.transform.ref];qo(u,s.transform.ref),qo(u,l.transform.ref);let m=this.getGroup().apply(Xe.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",ref:a.transform.ref,...gd(r)},{key:"b",ref:s.transform.ref,...gd(n)},{key:"c",ref:l.transform.ref,...gd(o)}],isTransitive:!0,label:"Angle"},{dependsOn:u,tags:i?.selectionTags}),d=m.apply(Xe.Representation.StructureSelectionsAngle3D,{customText:i?.customText||"",textColor:this.state.options.textColor,...i?.lineParams,...i?.labelParams,...i?.visualParams},{tags:i?.reprTags}),p=this.plugin.state.data;return await st.State.Update(this.plugin,{state:p,tree:d,options:{doNotLogTiming:!0}}),{selection:m.selector,representation:d.selector}}async addDihedral(r,n,o,i,a){let s=this.plugin.helpers.substructureParent.get(r.structure),l=this.plugin.helpers.substructureParent.get(n.structure),u=this.plugin.helpers.substructureParent.get(o.structure),c=this.plugin.helpers.substructureParent.get(i.structure);if(!s||!l||!u||!c)return;let m=[s.transform.ref];qo(m,l.transform.ref),qo(m,u.transform.ref),qo(m,c.transform.ref);let p=this.getGroup().apply(Xe.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",ref:s.transform.ref,...gd(r)},{key:"b",ref:l.transform.ref,...gd(n)},{key:"c",ref:u.transform.ref,...gd(o)},{key:"d",ref:c.transform.ref,...gd(i)}],isTransitive:!0,label:"Dihedral"},{dependsOn:m,tags:a?.selectionTags}),h=p.apply(Xe.Representation.StructureSelectionsDihedral3D,{customText:a?.customText||"",textColor:this.state.options.textColor,...a?.lineParams,...a?.labelParams,...a?.visualParams},{tags:a?.reprTags}),f=this.plugin.state.data;return await st.State.Update(this.plugin,{state:f,tree:h,options:{doNotLogTiming:!0}}),{selection:p.selector,representation:h.selector}}async addLabel(r,n){let o=this.plugin.helpers.substructureParent.get(r.structure);if(!o)return;let i=[o.transform.ref],s=this.getGroup().apply(Xe.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",ref:o.transform.ref,...gd(r)}],isTransitive:!0,label:"Label"},{dependsOn:i,tags:n?.selectionTags}),l=s.apply(Xe.Representation.StructureSelectionsLabel3D,{textColor:this.state.options.textColor,...n?.labelParams,...n?.visualParams},{tags:n?.reprTags}),u=this.plugin.state.data;return await st.State.Update(this.plugin,{state:u,tree:l,options:{doNotLogTiming:!0}}),{selection:s.selector,representation:l.selector}}async addOrientation(r){let n=[],o=[];for(let u=0,c=r.length;u<c;++u){let m=r[u],d=this.plugin.helpers.substructureParent.get(m.structure);d&&(qo(o,d.transform.ref),n.push({key:`l${u}`,ref:d.transform.ref,...gd(m)}))}if(n.length===0)return;let a=this.getGroup().apply(Xe.Model.MultiStructureSelectionFromBundle,{selections:n,isTransitive:!0,label:"Orientation"},{dependsOn:o}),s=a.apply(Xe.Representation.StructureSelectionsOrientation3D),l=this.plugin.state.data;return await st.State.Update(this.plugin,{state:l,tree:s,options:{doNotLogTiming:!0}}),{selection:a.selector,representation:s.selector}}async addPlane(r){let n=[],o=[];for(let u=0,c=r.length;u<c;++u){let m=r[u],d=this.plugin.helpers.substructureParent.get(m.structure);d&&(qo(o,d.transform.ref),n.push({key:`l${u}`,ref:d.transform.ref,...gd(m)}))}if(n.length===0)return;let i=this.getGroup(),a=i.apply(Xe.Model.MultiStructureSelectionFromBundle,{selections:n,isTransitive:!0,label:"Plane"},{dependsOn:o}),s=a.apply(Xe.Representation.StructureSelectionsPlane3D),l=this.plugin.state.data;return await st.State.Update(this.plugin,{state:l,tree:i,options:{doNotLogTiming:!0}}),{selection:a.selector,representation:s.selector}}async addOrderLabels(r){let n=this.getGroup(),o=this.plugin.state.data.select(er.Generators.ofType(re.Molecule.Structure.Selections).withTag(zF));for(let s of o)n.delete(s);let i=1;for(let s of r){let l=this.plugin.helpers.substructureParent.get(s.structure);if(!l)continue;let u=[l.transform.ref];n.apply(Xe.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",ref:l.transform.ref,...gd(s)}],isTransitive:!0,label:"Order"},{dependsOn:u,tags:zF}).apply(Xe.Representation.StructureSelectionsLabel3D,{textColor:Fe.fromRgb(255,255,255),borderColor:Fe.fromRgb(0,0,0),textSize:.33,borderWidth:.3,offsetZ:.75,customText:`${i++}`},{tags:zF})}let a=this.plugin.state.data;return await st.State.Update(this.plugin,{state:a,tree:n,options:{doNotLogTiming:!0}}),{representation:n.selector}}getTransforms(r){let n=this.plugin.state.data,o=er.findTagInSubtree(n.tree,Ar.RootRef,iQ),i=o?n.select(er.Generators.ofTransformer(r,o)):this._empty;return i.length===0?this._empty:i}sync(){let r=[];for(let o of this.getTransforms(Xe.Representation.StructureSelectionsLabel3D)){let i=o.obj.tags;(!i||!i.includes(zF))&&r.push(o)}this.updateState({labels:r,distances:this.getTransforms(Xe.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(Xe.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(Xe.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(Xe.Representation.StructureSelectionsOrientation3D),planes:this.getTransforms(Xe.Representation.StructureSelectionsPlane3D)})&&this.stateUpdated()}};var mPe=Rt(Pi());var sC=class e extends Bs{constructor(r,n={}){super({props:{...C.getDefaultValues(e.Params),...n}});this.plugin=r;this._props=C.getDefaultValues(e.Params);this.events={propsUpdated:this.ev()};this.lociSelects=new e.LociSelectManager(r,this._props),this.lociHighlights=new e.LociHighlightManager(r,this._props)}get props(){return{...this.state.props}}setProps(r){let n=this.props,o={...this.state.props,...r};eb(n,o)||(this.updateState({props:o}),this.lociSelects.setProps(o),this.lociHighlights.setProps(o),this.events.propsUpdated.next(void 0))}dispose(){super.dispose(),this.lociSelects.dispose(),this.lociHighlights.dispose()}};(o=>{o.Params={granularity:C.Select("residue",Jt.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};class t{constructor(a,s={}){this.ctx=a;this.providers=[];this.props=C.getDefaultValues(o.Params);this.sel=a.managers.structure.selection,this.setProps(s)}setProps(a){Object.assign(this.props,a)}addProvider(a){this.providers.push(a)}removeProvider(a){this.providers=this.providers.filter(s=>s!==a)}normalizedLoci(a,s,l=!1){let{loci:u,repr:c}=a,m=s?this.props.granularity:void 0;return{loci:Jt.normalize(u,m,l),repr:c}}mark(a,s,l=!1){if(!Jt.isEmpty(a.loci))for(let u of this.providers)u(a,s,l)}dispose(){this.providers.length=0,this.sel.dispose()}}o.LociMarkManager=t;class r extends t{constructor(){super(...arguments);this.prev=[];this.clearHighlights=(s=!1)=>{for(let l of this.prev)this.mark(l,2,s);this.prev.length=0}}isHighlighted(s){for(let l of this.prev)if(Vt.Loci.areEqual(l,s))return!0;return!1}addHighlight(s){this.mark(s,1),this.prev.push(s)}highlight(s,l=!0){let u=this.normalizedLoci(s,l);this.isHighlighted(u)||this.addHighlight(u)}highlightOnly(s,l=!0){let u=this.normalizedLoci(s,l);this.isHighlighted(u)||(Jt.isEmpty(u.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(u)))}highlightOnlyExtend(s,l=!0){let u=this.normalizedLoci(s,l);if(K.Loci.is(u.loci)){let m={loci:(this.ctx.selectionMode?this.sel.tryGetRange(u.loci):this.ctx.managers.structure.focus.tryGetRange(u.loci))??u.loci,repr:u.repr};this.isHighlighted(m)||(Jt.isEmpty(m.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(m)))}}dispose(){super.dispose(),this.prev.length=0}}o.LociHighlightManager=r;class n extends t{toggle(a,s=!0){if(Jt.isEmpty(a.loci))return;let l=this.normalizedLoci(a,s,!0);K.Loci.is(l.loci)?this.toggleSel(l):super.mark(l,16)}toggleExtend(a,s=!0){if(Jt.isEmpty(a.loci))return;let l=this.normalizedLoci(a,s,!0);if(K.Loci.is(l.loci)){let u=this.sel.tryGetRange(l.loci)||l.loci;this.toggleSel({loci:u,repr:l.repr})}}select(a,s=!0){let l=this.normalizedLoci(a,s,!0);K.Loci.is(l.loci)&&this.sel.modify("add",l.loci),this.mark(l,4)}selectJoin(a,s=!0){let l=this.normalizedLoci(a,s,!0);K.Loci.is(l.loci)&&this.sel.modify("intersect",l.loci),this.mark(l,4)}selectOnly(a,s=!0){let l=this.normalizedLoci(a,s,!0);K.Loci.is(l.loci)&&(this.mark({loci:De.Loci(l.loci.structure),repr:l.repr},8),this.sel.modify("set",l.loci)),this.mark(l,4)}deselect(a,s=!0){let l=this.normalizedLoci(a,s,!0);K.Loci.is(l.loci)&&this.sel.modify("remove",l.loci),this.mark(l,8)}deselectAll(){this.sel.clear(),this.mark({loci:Uh},8)}deselectAllOnEmpty(a){Ii(a.loci)&&this.deselectAll()}mark(a,s){let{loci:l}=a;if(!Jt.isEmpty(l))if(K.Loci.is(l)){let u=this.sel.getLoci(l.structure);super.mark({loci:De.Loci(l.structure)},8,!Jt.isEmpty(u)),super.mark({loci:u},4)}else super.mark(a,s)}toggleSel(a){this.sel.has(a.loci)?(this.sel.modify("remove",a.loci),this.mark(a,8)):(this.sel.modify("add",a.loci),this.mark(a,4))}}o.LociSelectManager=n})(sC||={});function Sct(e,t){let r=[],n=t==="auth"?"auth_asym_id":"label_asym_id",o=t==="auth"?"auth_seq_id":"label_seq_id";for(let a of e)if(a.kind==="range")r.push(ne.struct.generator.atomGroups({"chain-test":ne.core.rel.eq([ne.ammp(n),a.asym_id]),"residue-test":ne.core.rel.inRange([ne.ammp(o),a.seq_id_beg,a.seq_id_end])}));else{let s=(a.ins_code??"").trim();r.push(ne.struct.generator.atomGroups({"chain-test":ne.core.rel.eq([ne.ammp(n),a.asym_id]),"residue-test":ne.core.logic.and([ne.core.rel.eq([ne.ammp(o),a.seq_id]),ne.core.rel.eq([ne.ammp("pdbx_PDB_ins_code"),s])])}))}let i=ne.struct.combinator.merge(r);return Ic(i)}function vct(e){let t=Tn.create();for(let[n,o]of e)for(let i=n;i<=o;i++)Tn.add(t,i,i);let r=ne.struct.generator.atomGroups({"atom-test":ne.core.set.has([ne.set(...t.array),ne.ammp("id")])});return Ic(r)}function Ict(e){let t=Tn.create();for(let[n,o]of e)for(let i=n;i<=o;i++)Tn.add(t,i.toString(),i.toString());let r=ne.struct.generator.atomGroups({"atom-test":ne.core.set.has([ne.set(...t.array),ne.acp("elementSymbol")])});return Ic(r)}function Act(e){let t=ne.struct.generator.atomGroups({"atom-test":ne.core.set.has([ne.set(...e),ne.acp("elementSymbol")])});return Ic(t)}function Tct(e,t,r){if(!(!e||t.length===0||Number.isNaN(+t[0])))return Number.isNaN(r)?{kind:"single",asym_id:e,seq_id:+t[0],ins_code:t[1]}:{kind:"range",asym_id:e,seq_id_beg:+t[0],seq_id_end:r}}function Pct(e){return e?e.split(":"):[]}function _ct(e){return e.split(",").map(t=>t.trim().split(/\s+|[-]/g).filter(r=>!!r)).map(t=>Tct(t[0],Pct(t[1]),+t[2])).filter(t=>!!t)}function uPe(e){return e.split(",").map(t=>t.trim().split(/\s+|[-]/g).filter(r=>!!r)).filter(t=>t.length===1||t.length===2).map(t=>t.length===1?[+t[0],+t[0]]:[+t[0],+t[1]])}function cPe(e,t){if(t==="atom-id"){let r=uPe(e);return vct(r)}else if(t==="element-symbol"){if(/[a-zA-Z]/.test(e))return Act(e.split(",").map(n=>n.trim()));{let n=uPe(e);return Ict(n)}}else{let r=_ct(e);return Sct(r,t)}}var WF=Rt(Pi());var Er=Rt(nr());function Rct(e){return Object.keys(e).map(t=>[t,e[t]]).filter(t=>_t.isBinding(t[1]))}var VA=class extends WF.PureComponent{getBindingComponents(){let t=Rct(this.props.bindings);return(0,Er.jsx)(Er.Fragment,{children:t.map(r=>{let[n,o]=r;return _t.isEmpty(o)?null:(0,Er.jsxs)("div",{style:{marginBottom:"6px"},children:[(0,Er.jsx)("b",{children:o.action}),(0,Er.jsx)("br",{}),(0,Er.jsx)("span",{dangerouslySetInnerHTML:{__html:_t.format(o,n)}})]},n)})})}render(){return(0,Er.jsx)(yd,{children:this.getBindingComponents()})}},yd=class extends WF.PureComponent{render(){return(0,Er.jsx)("div",{className:"msp-help-text",children:(0,Er.jsx)("div",{children:this.props.children})})}},bd=class extends WF.PureComponent{constructor(){super(...arguments);this.state={header:this.props.header,isExpanded:!!this.props.initiallyExpanded};this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){return(0,Er.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,Er.jsx)("div",{className:"msp-control-group-header",children:(0,Er.jsxs)(sr,{onClick:this.toggleExpanded,children:[(0,Er.jsx)(yn,{svg:this.state.isExpanded?wu:Eu}),this.props.header]})}),this.state.isExpanded&&(0,Er.jsx)("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"},children:this.props.children})]})}};function sQ(e){return(0,Er.jsx)("div",{className:"msp-simple-help-section",children:e.header})}var NS=class extends Ir{constructor(){super(...arguments);this.getInteractionBindings=uu(r=>{let n;return r.forEach(o=>{let i=o.params?.values;i?.bindings&&Object.keys(i.bindings).length>0&&(n||(n={}),Object.assign(n,i.bindings))}),n})}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate())}render(){let r=this.getInteractionBindings(this.plugin.state.behaviors.cells);return(0,Er.jsxs)(Er.Fragment,{children:[!this.props.selectOnly&&this.plugin.canvas3d&&(0,Er.jsx)(bd,{header:"Moving in 3D",children:(0,Er.jsx)(VA,{bindings:this.plugin.canvas3d.props.trackball.bindings})},"trackball"),!!r&&(0,Er.jsx)(bd,{header:"Mouse & Key Controls",children:(0,Er.jsx)(VA,{bindings:r})},"interactions")]})}},jF=class extends Ir{componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate())}formatTriggers(t){return t.triggers.map(r=>_t.Trigger.format(r)).join(" or ")}getTriggerFor(t,r){let o=this.plugin.state.behaviors.select(er.Generators.ofTransformer(t)),i=o.length===1?o[0].params:void 0,a=i?i.values.bindings:{},s=r in a?a[r]:_t.Empty;return this.formatTriggers(s)}render(){let t=this.getTriggerFor(oX,"clickSelectToggle"),r=this.getTriggerFor(LS,"clickFocus");return(0,Er.jsxs)("div",{children:[(0,Er.jsx)(sQ,{header:"Interface Controls"}),(0,Er.jsxs)(bd,{header:"Inline Help",children:[(0,Er.jsx)(yd,{children:"Many user interface elements show a little questionmark icon when hovered over. Clicking the icon toggles the display of an inline help text."}),(0,Er.jsx)(yd,{children:"Tooltips may provide additional information on a user interface element and are shown when hovering over it with the mouse."})]}),(0,Er.jsx)(bd,{header:"Selections",children:(0,Er.jsxs)(yd,{children:["The viewer allows changing colors and representations for selections of atoms, residues or chains. Selections can be created by",(0,Er.jsxs)("ul",{style:{paddingLeft:"20px"},children:[(0,Er.jsxs)("li",{children:["picking elements on the 3D canvas or the sequence view using the mouse, e.g. toggle selection using ",t," (for more see help section on ",(0,Er.jsx)("i",{children:"Mouse Controls"}),")"]}),(0,Er.jsxs)("li",{children:["using the ",(0,Er.jsx)("i",{children:"Add"}),", ",(0,Er.jsx)("i",{children:"Remove"})," and ",(0,Er.jsx)("i",{children:"Only"})," dropdown buttons in the ",(0,Er.jsx)("i",{children:"Manage Selection"})," panel which allow modifing the current selection by predefined sets"]})]})]})}),(0,Er.jsx)(bd,{header:"Coloring",children:(0,Er.jsxs)(yd,{children:["There are two ways to color structures. Every representation (e.g. cartoon or spacefill) has a color theme which can be changed using the dropdown for each representation in the ",(0,Er.jsx)("i",{children:"Structure Settings"})," panel. Additionally any selection atoms, residues or chains can by given a custom color. For that, first select the parts of the structure to be colored (see help section on ",(0,Er.jsx)("i",{children:"Selections"}),") and, second, choose a color from the color dropdown botton in the ",(0,Er.jsx)("i",{children:"Selection"})," row of the ",(0,Er.jsx)("i",{children:"Change Representation"})," panel. The theme color can be seen as a base color that is overpainted by the custom color. Custom colors can be removed for a selection with the 'Clear' option in the color dropdown."]})}),(0,Er.jsx)(bd,{header:"Representations",children:(0,Er.jsxs)(yd,{children:["Structures can be shown with many different representations (e.g. cartoon or spacefill). The ",(0,Er.jsx)("i",{children:"Change Representation"})," panel offers a collection of predefined styles which can be applied using the ",(0,Er.jsx)("i",{children:"Preset"})," dropdown button. Additionally any selection atoms, residues or chains can by shown with a custom representation. For that, first select the parts of the structure to be mofified (see help section on ",(0,Er.jsx)("i",{children:"Selections"}),") and, second, choose a representation to hide or show from the ",(0,Er.jsx)("i",{children:"Show"})," and ",(0,Er.jsx)("i",{children:"Hide"})," dropdown bottons in the ",(0,Er.jsx)("i",{children:"Selection"})," row of the ",(0,Er.jsx)("i",{children:"Change Representation"})," panel. The ",(0,Er.jsx)("i",{children:"Everything"})," row applies the action to the whole structure instead of the current selection."]})}),(0,Er.jsx)(bd,{header:"Surroundings",children:(0,Er.jsxs)(yd,{children:["To show the surroundings of a residue or ligand, click it in the 3D scene or in the sequence widget using ",r,"."]})}),(0,Er.jsx)(sQ,{header:"How-to Guides"}),(0,Er.jsx)(bd,{header:"Create an Image",children:(0,Er.jsxs)(yd,{children:[(0,Er.jsxs)("p",{children:["Use the ",(0,Er.jsx)(yn,{svg:Qte})," icon in the viewport to bring up the screenshot controls."]}),(0,Er.jsxs)("p",{children:["To adjust the size of the image, use the ",(0,Er.jsx)("i",{children:"Resolution"})," dropdown."]})]})}),(0,Er.jsx)(sQ,{header:"Mouse Controls"}),(0,Er.jsx)(NS,{})]})}};var Ur=Rt(nr()),lC=class extends ii{constructor(){super(...arguments);this._toggleSelMode=()=>{this.plugin.selectionMode=!this.plugin.selectionMode}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.interaction.selectionMode,()=>this.forceUpdate())}render(){let r=this.props.inline?{background:"transparent",width:"auto",height:"auto",lineHeight:"unset"}:{background:"transparent"};return(0,Ur.jsx)(or,{svg:are,onClick:this._toggleSelMode,title:"Toggle Selection Mode",style:r,toggleState:this.plugin.selectionMode})}},XF={granularity:sC.Params.granularity},OA=new Map([["add","Add/Union Selection"],["remove","Remove/Subtract Selection"],["intersect","Intersect Selection"],["set","Set Selection"]]),QF=class extends Ir{constructor(){super(...arguments);this.state={action:void 0,helper:void 0,isEmpty:!0,isBusy:!1,canUndo:!1,structureSelectionParams:XF};this.set=(r,n)=>{this.plugin.managers.structure.selection.fromSelectionQuery(r,n,!1)};this.selectQuery=(r,n)=>{if(!r||!this.state.action){this.setState({action:void 0});return}let o=this.state.action;n?.shiftKey?this.set(o,r.value):this.setState({action:void 0},()=>{this.set(o,r.value)})};this.selectHelper=(r,n)=>{if(console.log(r),!r||!this.state.action){this.setState({action:void 0,helper:void 0});return}this.setState({helper:r.value.kind})};this.queriesItems=[];this.queriesVersion=-1;this.helpersItems=void 0;this.toggleAdd=this.showAction("add");this.toggleRemove=this.showAction("remove");this.toggleIntersect=this.showAction("intersect");this.toggleSet=this.showAction("set");this.toggleTheme=this.showAction("theme");this.toggleAddComponent=this.showAction("add-component");this.toggleHelp=this.showAction("help");this.setGranuality=({value:r})=>{this.plugin.managers.interactivity.setProps({granularity:r})};this.turnOff=()=>this.plugin.selectionMode=!1;this.undo=()=>{let r=this.plugin.state.data.undo();r&&this.plugin.runTask(r)};this.subtract=()=>{let r=this.plugin.managers.structure.hierarchy.getStructuresWithSelection(),n=[];for(let o of r)n.push(...o.components);n.length!==0&&this.plugin.managers.structure.component.modifyByCurrentSelection(n,"subtract")}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,n=>{let o=n.hierarchy.structures.length===0;this.state.isEmpty!==o&&this.setState({isEmpty:o}),this.queriesVersion=-1,this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,n=>{this.setState({isBusy:n,action:void 0})}),this.subscribe(this.plugin.managers.interactivity.events.propsUpdated,()=>{this.forceUpdate()}),this.subscribe(this.plugin.state.data.events.historyUpdated,({state:n})=>{this.setState({canUndo:n.canUndo})});let r=this.plugin.spec.components?.selectionTools?.granularityOptions;if(r){let n=new Set(r),o={...XF,granularity:{...XF.granularity,options:XF.granularity.options.filter(([i])=>n.has(i))}};this.setState({structureSelectionParams:o})}}get isDisabled(){return this.state.isBusy||this.state.isEmpty}get structures(){let r=[];for(let n of this.plugin.managers.structure.hierarchy.selection.structures){let o=n.cell.obj?.data;o&&r.push(o)}return r}get queries(){let{registry:r}=this.plugin.query.structure;if(r.version!==this.queriesVersion){let n=this.structures,o=[...r.list,...WCe(n),...jCe(n),...HCe(n)].sort((i,a)=>a.priority-i.priority);this.queriesItems=br.createItems(o,{filter:i=>i!==li.current&&!i.isHidden,label:i=>i.label,category:i=>i.category,description:i=>i.description}),this.queriesVersion=r.version}return this.queriesItems}get helpers(){if(this.helpersItems)return this.helpersItems;let r=[{kind:"residue-list",category:"Helpers",label:"Atom/Residue Identifier List",description:"Create a selection from a list of atom/residue ranges."}];return this.helpersItems=br.createItems(r,{label:n=>n.label,category:n=>n.category,description:n=>n.description}),this.helpersItems}showAction(r){return()=>this.setState({action:this.state.action===r?void 0:r,helper:void 0})}render(){let r=this.plugin.managers.interactivity.props.granularity,n=this.plugin.spec.components?.selectionTools?.hide,o=this.state.canUndo?`Undo ${this.plugin.state.data.latestUndoLabel}`:"Some mistakes of the past can be undone.",i;if(this.state.action&&!this.state.helper)i=(0,Ur.jsxs)(Ur.Fragment,{children:[this.state.action&&this.state.action!=="theme"&&this.state.action!=="add-component"&&this.state.action!=="help"&&(0,Ur.jsxs)("div",{className:"msp-selection-viewport-controls-actions",children:[(0,Ur.jsx)(br,{header:OA.get(this.state.action),title:"Click to close.",items:this.queries,onSelect:this.selectQuery,noOffset:!0}),(0,Ur.jsx)(br,{items:this.helpers,onSelect:this.selectHelper,noOffset:!0})]}),this.state.action==="theme"&&(0,Ur.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,Ur.jsx)(Cl,{header:"Theme",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleTheme,topRightIcon:dc,children:(0,Ur.jsx)(lQ,{onApply:this.toggleTheme})})}),this.state.action==="add-component"&&(0,Ur.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,Ur.jsx)(Cl,{header:"Add Component",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleAddComponent,topRightIcon:dc,children:(0,Ur.jsx)(ER,{onApply:this.toggleAddComponent,forSelection:!0})})}),this.state.action==="help"&&(0,Ur.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,Ur.jsxs)(Cl,{header:"Help",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleHelp,topRightIcon:dc,maxHeight:"300px",children:[(0,Ur.jsx)(bd,{header:"Selection Operations",children:(0,Ur.jsxs)(yd,{children:["Use ",(0,Ur.jsx)(yn,{svg:FP,inline:!0})," ",(0,Ur.jsx)(yn,{svg:VP,inline:!0})," ",(0,Ur.jsx)(yn,{svg:OP,inline:!0})," ",(0,Ur.jsx)(yn,{svg:i0,inline:!0})," to modify the selection."]})}),(0,Ur.jsx)(bd,{header:"Representation Operations",children:(0,Ur.jsxs)(yd,{children:["Use ",(0,Ur.jsx)(yn,{svg:_w,inline:!0})," ",(0,Ur.jsx)(yn,{svg:GP,inline:!0})," ",(0,Ur.jsx)(yn,{svg:jP,inline:!0})," ",(0,Ur.jsx)(yn,{svg:WP,inline:!0})," to color, create components, remove from components, or undo actions."]})}),(0,Ur.jsx)(NS,{selectOnly:!0})]})})]});else if(OA.has(this.state.action)&&this.state.helper==="residue-list"){let a=()=>this.setState({action:void 0,helper:void 0});i=(0,Ur.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,Ur.jsx)(Cl,{header:"Atom/Residue Identifier List",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:a,topRightIcon:dc,children:(0,Ur.jsx)(wct,{modifier:this.state.action,plugin:this.plugin,close:a})})})}return(0,Ur.jsxs)(Ur.Fragment,{children:[(0,Ur.jsxs)("div",{className:"msp-flex-row",style:{background:"none"},children:[!n?.granularity&&(0,Ur.jsx)(og,{title:"Picking Level for selecting and highlighting",param:this.state.structureSelectionParams.granularity,name:"granularity",value:r,onChange:this.setGranuality,isDisabled:this.isDisabled}),!n?.union&&(0,Ur.jsx)(di,{icon:FP,title:`${OA.get("add")}. Hold shift key to keep menu open.`,toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled}),!n?.subtract&&(0,Ur.jsx)(di,{icon:VP,title:`${OA.get("remove")}. Hold shift key to keep menu open.`,toggle:this.toggleRemove,isSelected:this.state.action==="remove",disabled:this.isDisabled}),!n?.intersect&&(0,Ur.jsx)(di,{icon:OP,title:`${OA.get("intersect")}. Hold shift key to keep menu open.`,toggle:this.toggleIntersect,isSelected:this.state.action==="intersect",disabled:this.isDisabled}),!n?.set&&(0,Ur.jsx)(di,{icon:i0,title:`${OA.get("set")}. Hold shift key to keep menu open.`,toggle:this.toggleSet,isSelected:this.state.action==="set",disabled:this.isDisabled}),!n?.theme&&(0,Ur.jsx)(di,{icon:_w,title:"Apply Theme to Selection",toggle:this.toggleTheme,isSelected:this.state.action==="theme",disabled:this.isDisabled,style:{marginLeft:"10px"}}),!n?.componentAdd&&(0,Ur.jsx)(di,{icon:GP,title:"Create Component of Selection with Representation",toggle:this.toggleAddComponent,isSelected:this.state.action==="add-component",disabled:this.isDisabled}),!n?.componentRemove&&(0,Ur.jsx)(or,{svg:jP,title:"Remove/subtract Selection from all Components",onClick:this.subtract,disabled:this.isDisabled}),!n?.undo&&(0,Ur.jsx)(or,{svg:WP,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:o}),!n?.help&&(0,Ur.jsx)(di,{icon:Mu,title:"Show/hide help",toggle:this.toggleHelp,style:{marginLeft:"10px"},isSelected:this.state.action==="help"}),!n?.cancel&&this.plugin.config.get(Lr.Viewport.ShowSelectionMode)&&(0,Ur.jsx)(or,{svg:UP,title:"Turn selection mode off",onClick:this.turnOff})]}),i]})}},ZF=class extends Ir{constructor(){super(...arguments);this.state={isEmpty:!0,isBusy:!1};this.clear=()=>this.plugin.managers.interactivity.lociSelects.deselectAll();this.focus=()=>{if(this.plugin.managers.structure.selection.stats.elementCount===0)return;let{sphere:r}=this.plugin.managers.structure.selection.getBoundary();this.plugin.managers.camera.focusSphere(r)};this.highlight=r=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights(),this.plugin.managers.structure.selection.entries.forEach(n=>{this.plugin.managers.interactivity.lociHighlights.highlight({loci:n.selection},!1)})};this.clearHighlight=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()}}componentDidMount(){this.subscribe(this.plugin.managers.structure.selection.events.changed,()=>{this.forceUpdate()}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,r=>{let n=r.structures.length===0;this.state.isEmpty!==n&&this.setState({isEmpty:n})}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r})})}get isDisabled(){return this.state.isBusy||this.state.isEmpty}get stats(){let r=this.plugin.managers.structure.selection.stats;return r.structureCount===0||r.elementCount===0?"Nothing Selected":`${Zp(r.label)} Selected`}render(){let r=this.plugin.managers.structure.selection.stats,n=r.structureCount===0||r.elementCount===0;return n&&this.props.hideOnEmpty?null:(0,Ur.jsx)(Ur.Fragment,{children:(0,Ur.jsxs)("div",{className:"msp-flex-row",children:[(0,Ur.jsx)(sr,{noOverflow:!0,onClick:this.focus,title:"Click to Focus Selection",disabled:n,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlignLast:n?void 0:"left"},children:this.stats}),!n&&(0,Ur.jsx)(or,{svg:UP,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0})]})})}},lQ=class extends ii{constructor(){super(...arguments);this._params=uu(r=>gp.getThemeParams(this.plugin,r));this.state={values:C.getDefaultValues(this.params)};this.apply=()=>{this.plugin.managers.structure.component.applyTheme(this.state.values,this.plugin.managers.structure.hierarchy.current.structures),this.props.onApply?.()};this.paramsChanged=r=>this.setState({values:r})}get params(){return this._params(this.plugin.managers.structure.component.pivotStructure)}render(){return(0,Ur.jsxs)(Ur.Fragment,{children:[(0,Ur.jsx)(Kn,{params:this.params,values:this.state.values,onChangeValues:this.paramsChanged}),(0,Ur.jsx)(sr,{icon:_w,className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"},children:"Apply Theme"})]})}},dPe={idType:C.Select("auth",C.arrayToOptions(["auth","label","atom-id","element-symbol"])),identifiers:C.Text("",{description:"A comma separated list of atom identifiers (e.g. 10, 15-25), element symbols (e.g. N, C or 20-200) or residue ranges in given chain (e.g. A 10-15, B 25, C 30:i)"})},Dct=C.getDefaultValues(dPe);function wct({modifier:e,plugin:t,close:r}){let[n,o]=mPe.useState(Dct),i=()=>{if(n.identifiers.trim().length!==0)try{r();let a=cPe(n.identifiers,n.idType);t.managers.structure.selection.fromCompiledQuery(e,a,!1)}catch(a){console.error(a),t.log.error("Failed to create selection")}};return(0,Ur.jsxs)(Ur.Fragment,{children:[(0,Ur.jsx)(Kn,{params:dPe,values:n,onChangeValues:o,onEnter:i}),(0,Ur.jsxs)(sr,{className:"msp-btn-commit msp-btn-commit-on",disabled:n.identifiers.trim().length===0,onClick:i,style:{marginTop:"1px"},children:[Kc(e)," Selection"]})]})}var vn=Rt(nr()),qF=class extends hc{defaultState(){return{isCollapsed:!1,header:"Measurements",brand:{accent:"gray",svg:zte}}}renderControls(){return(0,vn.jsxs)(vn.Fragment,{children:[(0,vn.jsx)(cQ,{}),(0,vn.jsx)(uQ,{})]})}},uQ=class extends ii{componentDidMount(){this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,()=>{this.forceUpdate()})}renderGroup(t,r){let n=[];for(let o of t)o.obj&&n.push((0,vn.jsx)(dQ,{cell:o},o.obj.id));return n.length?(0,vn.jsx)(Ja,{header:r,initiallyExpanded:!0,children:n}):null}render(){let t=this.plugin.managers.structure.measurement.state;return(0,vn.jsxs)("div",{style:{marginTop:"6px"},children:[this.renderGroup(t.labels,"Labels"),this.renderGroup(t.distances,"Distances"),this.renderGroup(t.angles,"Angles"),this.renderGroup(t.dihedrals,"Dihedrals"),this.renderGroup(t.orientations,"Orientations"),this.renderGroup(t.planes,"Planes")]})}},cQ=class extends ii{constructor(){super(...arguments);this.state={isBusy:!1,action:void 0};this.measureDistance=()=>{let r=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addDistance(r[0].loci,r[1].loci)};this.measureAngle=()=>{let r=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addAngle(r[0].loci,r[1].loci,r[2].loci)};this.measureDihedral=()=>{let r=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addDihedral(r[0].loci,r[1].loci,r[2].loci,r[3].loci)};this.addLabel=()=>{let r=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addLabel(r[0].loci)};this.addOrientation=()=>{let r=[];this.plugin.managers.structure.selection.entries.forEach(n=>{r.push(n.selection)}),this.plugin.managers.structure.measurement.addOrientation(r)};this.addPlane=()=>{let r=[];this.plugin.managers.structure.selection.entries.forEach(n=>{r.push(n.selection)}),this.plugin.managers.structure.measurement.addPlane(r)};this.selectAction=r=>{this.toggleAdd(),r&&(r?.value)()};this.toggleAdd=()=>this.setState({action:this.state.action==="add"?void 0:"add"});this.toggleOptions=()=>this.setState({action:this.state.action==="options"?void 0:"options"})}componentDidMount(){this.subscribe(this.selection.events.additionsHistoryUpdated,()=>{this.forceUpdate(),this.updateOrderLabels()}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r})})}componentWillUnmount(){this.clearOrderLabels(),super.componentWillUnmount()}componentDidUpdate(r,n){this.state.action!==n.action&&this.updateOrderLabels()}clearOrderLabels(){this.plugin.managers.structure.measurement.addOrderLabels([])}updateOrderLabels(){if(this.state.action!=="add"){this.clearOrderLabels();return}let r=[],n=this.selection.additionsHistory;for(let o=0;o<n.length&&o<4;o++)r.push(n[o].loci);this.plugin.managers.structure.measurement.addOrderLabels(r)}get selection(){return this.plugin.managers.structure.selection}get actions(){let r=this.selection.additionsHistory;return[{kind:"item",label:`Label ${r.length===0?" (1 selection item required)":" (1st selection item)"}`,value:this.addLabel,disabled:r.length===0},{kind:"item",label:`Distance ${r.length<2?" (2 selection items required)":" (top 2 selection items)"}`,value:this.measureDistance,disabled:r.length<2},{kind:"item",label:`Angle ${r.length<3?" (3 selection items required)":" (top 3 items)"}`,value:this.measureAngle,disabled:r.length<3},{kind:"item",label:`Dihedral ${r.length<4?" (4 selection items required)":" (top 4 selection items)"}`,value:this.measureDihedral,disabled:r.length<4},{kind:"item",label:`Orientation ${r.length===0?" (selection required)":" (current selection)"}`,value:this.addOrientation,disabled:r.length===0},{kind:"item",label:`Plane ${r.length===0?" (selection required)":" (current selection)"}`,value:this.addPlane,disabled:r.length===0}]}highlight(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)}moveHistory(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,4)}focusLoci(r){this.plugin.managers.camera.focusLoci(r)}historyEntry(r,n){let o=this.plugin.managers.structure.selection.additionsHistory;return(0,vn.jsxs)("div",{className:"msp-flex-row",onMouseEnter:()=>this.highlight(r.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:[(0,vn.jsxs)(sr,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(r.loci),style:{width:"auto",textAlign:"left"},children:[n,". ",(0,vn.jsx)("span",{dangerouslySetInnerHTML:{__html:r.label}})]}),o.length>1&&(0,vn.jsx)(or,{svg:Lb,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(r,"up"),flex:"20px",title:"Move up"}),o.length>1&&(0,vn.jsx)(or,{svg:kb,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(r,"down"),flex:"20px",title:"Move down"}),(0,vn.jsx)(or,{svg:Vs,small:!0,className:"msp-form-control",onClick:()=>this.plugin.managers.structure.selection.modifyHistory(r,"remove"),flex:!0,title:"Remove"})]},r.id)}add(){let r=this.plugin.managers.structure.selection.additionsHistory,n=[];for(let a=0,s=Math.min(r.length,4);a<s;a++)n.push(this.historyEntry(r[a],a+1));let i=this.plugin.config.get(Lr.Viewport.ShowSelectionMode)?(0,vn.jsxs)(vn.Fragment,{children:[" ","(toggle ",(0,vn.jsx)(lC,{inline:!0})," mode)"]}):null;return(0,vn.jsxs)(vn.Fragment,{children:[(0,vn.jsx)(br,{items:this.actions,onSelect:this.selectAction}),n.length>0&&(0,vn.jsx)("div",{className:"msp-control-offset",children:n}),n.length===0&&(0,vn.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,vn.jsxs)("div",{className:"msp-help-description",children:[(0,vn.jsx)(yn,{svg:Mu,inline:!0}),"Add one or more selections",i]})})]})}render(){return(0,vn.jsxs)(vn.Fragment,{children:[(0,vn.jsxs)("div",{className:"msp-flex-row",children:[(0,vn.jsx)(di,{icon:Kp,label:"Add",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.state.isBusy,className:"msp-btn-apply-simple"}),(0,vn.jsx)(di,{icon:pc,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}})]}),this.state.action==="add"&&this.add(),this.state.action==="options"&&(0,vn.jsx)(mQ,{})]})}},mQ=class extends ii{constructor(){super(...arguments);this.state={isDisabled:!1};this.changed=r=>{this.plugin.managers.structure.measurement.setOptions(r)}}componentDidMount(){this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,()=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isDisabled:r})})}render(){let r=this.plugin.managers.structure.measurement.state;return(0,vn.jsx)("div",{className:"msp-control-offset",children:(0,vn.jsx)(Kn,{params:aQ,values:r.options,onChangeValues:this.changed,isDisabled:this.state.isDisabled})})}},dQ=class extends ii{constructor(){super(...arguments);this.state={showUpdate:!1};this.delete=()=>{st.State.RemoveObject(this.plugin,{state:this.props.cell.parent,ref:this.props.cell.transform.parent,removeParentGhosts:!0})};this.toggleVisibility=r=>{r.preventDefault(),st.State.ToggleVisibility(this.plugin,{state:this.props.cell.parent,ref:this.props.cell.transform.parent}),r.currentTarget.blur()};this.highlight=()=>{if(!this.selections)return;this.plugin.managers.interactivity.lociHighlights.clearHighlights();for(let o of this.lociArray)this.plugin.managers.interactivity.lociHighlights.highlight({loci:o},!1);let n=this.props.cell.obj?.data.repr.getAllLoci();if(n)for(let o of n)this.plugin.managers.interactivity.lociHighlights.highlight({loci:o},!1)};this.clearHighlight=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()};this.toggleUpdate=()=>this.setState({showUpdate:!this.state.showUpdate});this.focus=()=>{if(!this.selections)return;let n=Jt.getBundleBoundingSphere({loci:this.lociArray});n&&this.plugin.managers.camera.focusSphere(n)};this.selectAction=r=>{r&&(this.setState({showUpdate:!1}),(r?.value)())}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,r=>{this.forceUpdate()})}get selections(){return this.props.cell.obj?.data.sourceData}get lociArray(){let r=this.selections;return r?r.infos?[r.infos[0].loci]:r.pairs?r.pairs[0].loci:r.triples?r.triples[0].loci:r.quads?r.quads[0].loci:r.locis?r.locis:[]:[]}get label(){let r=this.selections;return r?r.infos?mp(r.infos[0].loci,{condensed:!0}):r.pairs?MI(r.pairs[0],{condensed:!0,unitLabel:this.plugin.managers.structure.measurement.state.options.distanceUnitLabel}):r.triples?BI(r.triples[0],{condensed:!0}):r.quads?kI(r.quads[0],{condensed:!0}):r.locis?Mx(r.locis,{countsOnly:!0}):"<empty>":"<empty>"}get actions(){return this.props.cell.sourceRef,[br.Item("Select This",()=>this.plugin.managers.structure.selection.fromSelections(this.props.cell.sourceRef),{icon:i0})]}render(){let{cell:r}=this.props,{obj:n}=r;return n?(0,vn.jsxs)(vn.Fragment,{children:[(0,vn.jsxs)("div",{className:"msp-flex-row",onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,children:[(0,vn.jsx)("button",{className:"msp-form-control msp-control-button-label msp-no-overflow",title:"Click to focus. Hover to highlight.",onClick:this.focus,style:{width:"auto",textAlign:"left"},children:(0,vn.jsx)("span",{dangerouslySetInnerHTML:{__html:this.label}})}),(0,vn.jsx)(or,{svg:r.state.isHidden?Fm:Jc,toggleState:!1,small:!0,className:"msp-form-control",onClick:this.toggleVisibility,flex:!0,title:r.state.isHidden?"Show":"Hide"}),(0,vn.jsx)(or,{svg:Vs,small:!0,className:"msp-form-control",onClick:this.delete,flex:!0,title:"Delete",toggleState:!1}),(0,vn.jsx)(or,{svg:Fd,className:"msp-form-control",onClick:this.toggleUpdate,flex:!0,title:"Actions",toggleState:this.state.showUpdate})]},n.id),this.state.showUpdate&&r.parent&&(0,vn.jsx)(vn.Fragment,{children:(0,vn.jsxs)("div",{className:"msp-accent-offset",children:[(0,vn.jsx)(br,{items:this.actions,onSelect:this.selectAction,noOffset:!0}),(0,vn.jsx)(Ja,{header:"Options",noOffset:!0,children:(0,vn.jsx)($u,{state:r.parent,transform:r.transform,customHeader:"none",autoHideApply:!0})})]})})]}):null}};var ag=Rt(nr());function pQ(e,t,r,n){let o=Be.indexOf(t.unit.elements,t.element),i=K.Loci(t.structure,[{unit:t.unit,indices:Se.ofSingleton(o)}]),a=n==="residue"?K.Loci.extendToWholeResidues(i):K.Loci.extendToWholeChains(i),s=qe.entity.pdbx_description(t).join(", ");for(let l of r.units){let u=K.Loci(a.structure,[{unit:l,indices:a.elements[0].indices}]),c=mp(u,{reverse:!0,hidePrefix:!0,htmlStyling:!1,granularity:n});c||(c=mp(u,{hidePrefix:!1,htmlStyling:!1})),r.units.length>1&&(c+=` | ${u.elements[0].unit.conformation.operator.name}`);let m={label:c,category:s,loci:u};e.has(s)?e.get(s).push(m):e.set(s,[m])}}function Ect(e){let t=new Map,r=K.Location.create(e);for(let o of e.unitSymmetryGroups){if(!me.isAtomic(o.units[0]))continue;r.unit=o.units[0],r.element=o.elements[0];let i=me.Traits.is(r.unit.traits,me.Trait.MultiChain),a=qe.entity.type(r),s=a==="non-polymer",l=a==="branched";if(!!qe.entity.prd_id(r))pQ(t,r,o,"chain");else if(s&&!i)pQ(t,r,o,"residue");else if(l||s&&i){let c=r.unit,{index:m}=c.model.atomicHierarchy.residueAtomSegments,d=-1;for(let p=0,h=c.elements.length;p<h;++p){let f=c.elements[p],y=m[f];y!==d&&(r.element=f,pQ(t,r,o,"residue"),d=y)}}}let n=[];return t.forEach((o,i)=>{o.length===1?n.push({label:`${i}: ${o[0].label}`,loci:o[0].loci}):o.length<2e3&&n.push(...o)}),n}var YF=class extends Ir{constructor(){super(...arguments);this.state={isBusy:!1,showAction:!1};this.getSelectionItems=uu(r=>{let n=[];for(let o of r){let i=o.cell.obj?.data;if(i){let a=Ect(i);a.length>0&&n.push([br.Header(i.label,{description:i.label}),...br.createItems(a,{label:s=>s.label,category:s=>s.category,description:s=>s.label})])}}return n});this.selectAction=(r,n)=>{if(!r||!this.state.showAction){this.setState({showAction:!1});return}let o=r.value;n?.shiftKey?this.plugin.managers.structure.focus.addFromLoci(o.loci):this.plugin.managers.structure.focus.set(o),this.focusCamera()};this.toggleAction=()=>this.setState({showAction:!this.state.showAction});this.focusCamera=()=>{let{current:r}=this.plugin.managers.structure.focus;r&&this.plugin.managers.camera.focusLoci(r.loci)};this.clear=()=>{this.plugin.managers.structure.focus.clear(),this.plugin.managers.camera.reset()};this.highlightCurrent=()=>{let{current:r}=this.plugin.managers.structure.focus;r&&this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r.loci},!1)};this.clearHighlights=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()}}componentDidMount(){this.subscribe(this.plugin.managers.structure.focus.behaviors.current,r=>{this.getSelectionItems([]),this.forceUpdate()}),this.subscribe(this.plugin.managers.structure.focus.events.historyUpdated,r=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r,showAction:!1})})}get isDisabled(){return this.state.isBusy||this.plugin.managers.structure.hierarchy.selection.structures.length===0}get actionItems(){let r=[],{history:n}=this.plugin.managers.structure.focus;n.length>0&&r.push([br.Header("History",{description:"Previously focused on items."}),...br.createItems(n,{label:a=>a.label,description:a=>a.category&&a.label!==a.category?`${a.category} | ${a.label}`:a.label})]);let o=this.getSelectionItems(this.plugin.managers.structure.hierarchy.selection.structures);if(o.length===1){let s=o[0][0];s.initiallyExpanded=!0}let i=[];return o.length>0&&i.push(...o),r.length>0&&i.push(...r),i}getToggleBindingLabel(){let r=this.plugin.state.behaviors.transforms.get(LS.id);if(!r)return"";let n=r.params?.bindings.clickFocus;return!n||_t.isEmpty(n)?"":_t.formatTriggers(n)}render(){let{current:r}=this.plugin.managers.structure.focus,n=r?.label||"Nothing Focused",o="Click to Center Camera";if(!r){o="Select focus using the menu";let i=this.getToggleBindingLabel();i&&(o+=`
or use '${i}' on element`)}return(0,ag.jsxs)(ag.Fragment,{children:[(0,ag.jsxs)("div",{className:"msp-flex-row",children:[(0,ag.jsx)(sr,{noOverflow:!0,onClick:this.focusCamera,title:o,onMouseEnter:this.highlightCurrent,onMouseLeave:this.clearHighlights,disabled:this.isDisabled||!r,style:{textAlignLast:r?"left":void 0},children:n}),r&&(0,ag.jsx)(or,{svg:UP,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0,disabled:this.isDisabled}),(0,ag.jsx)(di,{icon:Zte,title:"Select a focus target to center on an show its surroundings. Hold shift to focus on multiple targets.",toggle:this.toggleAction,isSelected:this.state.showAction,disabled:this.isDisabled,style:{flex:"0 0 40px",padding:0}})]}),this.state.showAction&&(0,ag.jsx)(br,{items:this.actionItems,onSelect:this.selectAction})]})}};var bu=Rt(nr()),KF=class extends hc{constructor(){super(...arguments);this.item=r=>{let n=this.plugin.managers.structure.hierarchy.seletionSet,o;switch(r.kind){case"model":{let a=r.cell.obj?.data;a&&Ft.TrajectoryInfo.get(a).size>1&&(o=`${r.cell.obj?.data.entryId} | Model ${Ft.TrajectoryInfo.get(a).index+1} of ${Ft.TrajectoryInfo.get(a).size}`),o=`${r.cell.obj?.data.entryId} | ${r.cell.obj?.label}`;break}case"structure":{let a=r.cell.obj?.data.models[0];if(a&&Ft.TrajectoryInfo.get(a).size>1){o=`${a.entryId} | ${r.cell.obj?.label} (Model ${Ft.TrajectoryInfo.get(a).index+1} of ${Ft.TrajectoryInfo.get(a).size})`;break}else if(a){o=`${a.entryId} | ${r.cell.obj?.label}`;break}else{o=`${r.cell.obj?.label}`;break}}default:o=r.cell.obj?.label;break}return{kind:"item",label:o||r.kind,selected:n.has(r.cell.transform.ref),value:[r]}};this.getTrajectoryItems=r=>r.models.length===0?this.item(r):[br.Header(r.cell.obj?.label),...r.models.map(this.getModelItems)];this.getModelItems=r=>{if(r.structures.length===0)return this.item(r);if(r.structures.length===1){let n=this.plugin.managers.structure.hierarchy.seletionSet,o=r.structures[0];return{label:`${r.cell.obj?.label} | ${o.cell.obj?.label}`,selected:n.has(o.cell.transform.ref),value:[r,o]}}return[br.Header(r.cell.obj?.label),...r.structures.map(this.item)]};this.selectHierarchy=r=>{if(!r||r.length===0)return;let n=[];for(let o of r)for(let i of o.value)n.push(i);this.plugin.managers.structure.hierarchy.updateCurrent(n,r[0].selected?"remove":"add")};this.toggleHierarchy=()=>this.setState({show:this.state.show!=="hierarchy"?"hierarchy":void 0});this.togglePreset=()=>this.setState({show:this.state.show!=="presets"?"presets":void 0});this.applyPreset=r=>{if(this.setState({show:void 0}),!r)return;let n=this.plugin.managers.structure,{trajectories:o}=n.hierarchy.selection;n.hierarchy.applyPreset(o,r.value)};this.updateModelQueueParams=void 0;this.isUpdatingModel=!1;this.updateStructureModel=r=>{this.updateModelQueueParams=r,this._updateStructureModel()};this.updateStructure=r=>{let{selection:n}=this.plugin.managers.structure.hierarchy,o=n.structures[0];return this.plugin.managers.structure.hierarchy.updateStructure(o,r)}}defaultState(){return{header:"Structure",isCollapsed:!1,isBusy:!1,brand:{accent:"purple",svg:Ute}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r})})}get hierarchyItems(){let r=this.plugin.managers.structure.hierarchy,{current:n}=r,o=[];return n.trajectories.length>1&&o.push([br.Header("Trajectories"),...n.trajectories.map(this.item)]),(n.models.length>1||n.trajectories.length>1)&&o.push([br.Header("Models"),...n.models.map(this.item)]),n.trajectories.length===1&&n.models.length===1?o.push(...n.structures.map(this.item)):n.structures.length>0&&o.push([br.Header("Structures"),...n.structures.map(this.item)]),o}get isEmpty(){let{structures:r,models:n,trajectories:o}=this.plugin.managers.structure.hierarchy.current;return o.length===0&&n.length===0&&r.length===0}get label(){let{structures:r,models:n,trajectories:o}=this.plugin.managers.structure.hierarchy.selection;if(r.length===1){let i=r[0];return i.model?.trajectory?.models&&i.model.trajectory.models.length===1?i.cell.obj?.data.label:i.model?`${i.model.cell.obj?.label} | ${i.cell.obj?.data.label}`:i.cell.obj?.data.label}if(r.length>1){let a=r[0]?.model?.trajectory,s=!0;for(let l of r)if(l?.model?.trajectory!==a){s=!1;break}return s&&a?`${a.cell.obj?.label} | ${r.length} structures`:`${r.length} structures`}if(n.length>0){let i=n[0].trajectory;if(n.length===1){let s=n[0].cell.obj?.data;return s&&Ft.TrajectoryInfo.get(s).size>1?`${i?.cell.obj?.label} | Model ${Ft.TrajectoryInfo.get(s).index+1} of ${Ft.TrajectoryInfo.get(s).size}`:`${i?.cell.obj?.label} | Model`}let a=!0;for(let s of n)if(s.trajectory!==i){a=!1;break}return a?`${i?.cell.obj?.label} | ${n.length} models`:`${n.length} models`}return o.length>0?o.length===1?`${o[0].cell.obj?.label} trajectory`:`${o.length} trajectories`:o.length===0&&n.length===0&&r.length===0?"Nothing Loaded":"Nothing Selected"}get presetActions(){let r=[],{trajectories:n}=this.plugin.managers.structure.hierarchy.selection;if(n.length===0)return r;let o=this.plugin.builders.structure.hierarchy.getPresets(n[0].cell.obj);if(n.length>1){let i=new Set(o);for(let a=1;a<n.length;a++){let s=this.plugin.builders.structure.hierarchy.getPresets(n[a].cell.obj),l=new Set(s);for(let u of s)l.has(u)||i.delete(u)}o=o.filter(a=>i.has(a))}for(let i of o)r.push(br.Item(i.display.name,i,{description:i.display.description}));return r}async _updateStructureModel(){if(!this.updateModelQueueParams||this.isUpdatingModel)return;let r=this.updateModelQueueParams;this.updateModelQueueParams=void 0;try{this.isUpdatingModel=!0;let{selection:n}=this.plugin.managers.structure.hierarchy,o=n.structures[0].model;await this.plugin.state.updateTransform(this.plugin.state.data,o.cell.transform.ref,r,"Model Index")}finally{this.isUpdatingModel=!1,this._updateStructureModel()}}get modelIndex(){let{selection:r}=this.plugin.managers.structure.hierarchy;if(r.structures.length!==1)return null;let n=r.structures[0].model;if(!n||n.cell.transform.transformer!==Xe.Model.ModelFromTrajectory||!n.cell.obj||Ft.TrajectoryInfo.get(n.cell.obj.data).size<=1)return null;let o=n.cell.params?.definition;return o?(0,bu.jsx)(Kn,{params:o,values:n.cell.params?.values,onChangeValues:this.updateStructureModel,isDisabled:this.state.isBusy}):null}get structureType(){let{selection:r}=this.plugin.managers.structure.hierarchy;if(r.structures.length!==1)return null;let n=r.structures[0];return!n.cell.params?.definition||!n.cell.parent?null:(0,bu.jsx)($u,{state:n.cell.parent,transform:n.cell.transform,customHeader:"none",customUpdate:this.updateStructure,noMargin:!0,autoHideApply:!0})}get transform(){let{selection:r}=this.plugin.managers.structure.hierarchy;if(r.structures.length!==1)return null;let n=r.structures[0];if(!n.cell.parent)return null;let o=er.tryFindDecorator(this.plugin.state.data,n.cell.transform.ref,Xe.Model.TransformStructureConformation);if(o)return(0,bu.jsx)(Ja,{header:"Conformation Transform",children:(0,bu.jsx)($u,{state:o.parent,transform:o.transform,customHeader:"none",noMargin:!0,autoHideApply:!0})})}renderControls(){let r=this.state.isBusy||this.isEmpty,n=this.presetActions,o=this.label;return(0,bu.jsxs)(bu.Fragment,{children:[(0,bu.jsxs)("div",{className:"msp-flex-row",style:{marginTop:"1px"},children:[(0,bu.jsx)(sr,{noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:o,children:o}),n.length>0&&(0,bu.jsx)(or,{svg:Qg,className:"msp-form-control",flex:"40px",onClick:this.togglePreset,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="presets",disabled:r})]}),this.state.show==="hierarchy"&&(0,bu.jsx)(br,{items:this.hierarchyItems,onSelect:this.selectHierarchy,multiselect:!0}),this.state.show==="presets"&&(0,bu.jsx)(br,{items:n,onSelect:this.applyPreset}),this.modelIndex,this.structureType,this.transform,(0,bu.jsxs)("div",{style:{marginTop:"6px"},children:[(0,bu.jsx)(YF,{}),(0,bu.jsx)(ZF,{hideOnEmpty:!0})]})]})}};function Xy(e,t,r={}){let n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?Mct(e,t||Ve.One,r):pPe(e,t||Ve.One,r)}function Mct(e,t,r){let n=r.type&&e.representation.volume.registry.get(r.type)||e.representation.volume.registry.default.provider,o=r.color&&e.representation.volume.themes.colorThemeRegistry.get(r.color)||e.representation.volume.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.volume.themes.sizeThemeRegistry.get(r.size)||e.representation.volume.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return pPe(e,t,{type:n,typeParams:r.typeParams,color:o,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function pPe(e,t,r={}){let{themes:n}=e.representation.volume,o={volume:t},i=r.type||e.representation.volume.registry.default.provider,a=C.getDefaultValues(i.getParams(n,t)),s=Object.assign(a,r.typeParams),l=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),u=C.getDefaultValues(l.getParams(o));l.name===i.defaultColorTheme.name&&Object.assign(u,i.defaultColorTheme.props);let c=Object.assign(u,r.colorParams),m=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),d=C.getDefaultValues(m.getParams(o));m.name===i.defaultSizeTheme.name&&Object.assign(d,i.defaultSizeTheme.props);let p=Object.assign(d,r.sizeParams);return{type:{name:i.name,params:s},colorTheme:{name:l.name,params:c},sizeTheme:{name:m.name,params:p}}}function hPe(e,t){let r=Fct(e,t||JF());return Nct(e.tree,r),t&&t.refs.forEach(Gct,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function JF(){return{volumes:[],lazyVolumes:[],refs:new Map}}function Bct(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function kct(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function Lct(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function Fct(e,t){return{state:e,oldHierarchy:t,hierarchy:JF(),changed:!1,added:new Set}}function fQ(e,t,r,n,...o){let i=n(...o);r.push(i),e.hierarchy.refs.set(t.transform.ref,i);let a=e.oldHierarchy.refs.get(t.transform.ref);return a?a.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function Vct(e,t){return(r,n)=>!t(n)&&e.is(r.obj)}function fPe(){}var Oct=[[Vct(re.Volume.Data,e=>e.currentVolume),(e,t)=>{e.currentVolume=fQ(e,t,e.hierarchy.volumes,Bct,t)},e=>e.currentVolume=void 0],[e=>re.Volume.Lazy.is(e.obj),(e,t)=>{fQ(e,t,e.hierarchy.lazyVolumes,kct,t)},fPe],[(e,t)=>!e.state.isGhost&&!!t.currentVolume&&re.Volume.Representation3D.is(e.obj),(e,t)=>(e.currentVolume&&fQ(e,t,e.currentVolume.representations,Lct,t,e.currentVolume),!1),fPe]];function gPe(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;let{obj:t}=e;return!(!t||t===An.Null||e.status!=="ok"&&e.status!=="error")}function Gct(e){let{cell:t}=e;gPe(t)||(this.changed=!0)}function Uct(e){yPe(this,this.tree.transforms.get(e))}function yPe(e,t){let{state:r}=e,n=r.state.cells.get(t.ref);if(!gPe(n))return;let o,i=!1;for(let[s,l,u]of Oct)if(s(n,r)){if(l(r,n)===!1){i=!0;break}o=u;break}if(i)return;let a=e.tree.children.get(t.ref);a&&a.size&&a.forEach(Uct,e),o&&o(r)}function Nct(e,t){let r={tree:e,state:t};return yPe(r,e.root),r.state}var uC=class extends ic{constructor(r){super();this.plugin=r;this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:JF(),selection:void 0};this.behaviors={selection:this.ev.behavior({hierarchy:this.current,volume:this.selection})};this.subscribe(r.state.data.events.changed,n=>{n.inTransaction||r.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe(r.behaviors.state.isAnimating,n=>{!n&&!r.behaviors.state.isUpdating.value&&this.sync(!0)})}get dataState(){return this.plugin.state.data}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}sync(r){if(!r&&this.dataState.inUpdate)return;if(this.state.syncedTree===this.dataState.tree){r&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection}));return}this.state.syncedTree=this.dataState.tree;let n=hPe(this.plugin.state.data,this.current);if(!n.changed)return;let{hierarchy:o}=n;this.state.hierarchy=o,this.state.selection?this.state.selection=o.refs.has(this.state.selection.cell.transform.ref)?o.refs.get(this.state.selection.cell.transform.ref):o.volumes[0]:this.state.selection=o.volumes[0],r?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:o,volume:this.state.selection})):this.state.notified=!1}setCurrent(r){this.state.selection=r||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:r||this.state.hierarchy.volumes[0]})}remove(r,n){if(r.length===0)return;let o=this.plugin.state.data.build();for(let i of r)o.delete(typeof i=="string"?i:i.cell.transform.ref);return o.commit({canUndo:n?"Remove":!1})}toggleVisibility(r,n){if(r.length===0)return;let o=n!==void 0?n!=="show":!r[0].cell.state.isHidden;for(let i of r)Ef(this.dataState,i.cell.transform.ref,o)}addRepresentation(r,n){return this.dataState.build().to(r.cell).apply(Xe.Representation.VolumeRepresentation3D,Xy(this.plugin,r.cell.obj?.data,{type:n})).commit({canUndo:"Add Representation"})}};(t=>{function e(r,n){return n?.cell.obj?.data?r.representation.volume.registry.getApplicableTypes(n.cell.obj?.data):r.representation.volume.registry.types}t.getRepresentationTypes=e})(uC||={});var GA=class extends re.Create({name:"Volume Streaming",typeClass:"Object"}){},zct;(t=>{let e;(o=>(o.Float32="float32",o.Int8="int8"))(e=t.ValueType||={})})(zct||={});function bPe(e,t="x-ray"){if(!e)return t;let r=e.models[0];return Cn.is(r.sourceData)?Ft.hasEmMap(r)?"em":Ft.hasXrayMap(r)?"x-ray":Ft.isFromEm(r)?"em":Ft.isFromXray(r)?"x-ray":t:t}function Hct(e){let t=[];if(!Cn.is(e.sourceData))return[e.entryId];let{db_id:r,db_name:n,content_type:o}=e.sourceData.data.db.pdbx_database_related;if(!n.isDefined)return[e.entryId];for(let i=0,a=n.rowCount;i<a;++i)n.value(i).toUpperCase()==="EMDB"&&o.value(i)==="associated EM volume"&&t.push(r.value(i));return t}function jct(e){return[e.entryId]}function xPe(e,t){if(!t||!t.models.length)return[];let r=t.models[0];switch(e){case"em":return Hct(r);case"x-ray":return jct(r)}}async function hQ(e,t,r,n){switch(e){case"emdb":return gQ(t,r,n);case"pdbe":return Wct(t,r,n)}}async function gQ(e,t,r){let n=e.config.get(Lr.VolumeStreaming.EmdbHeaderServer),a=(await e.fetch({url:`${n}/${r.toUpperCase()}/header/${r.toLowerCase()}.xml`,type:"xml"}).runInContext(t)).getElementsByTagName("map")[0].getElementsByTagName("contour"),s=a[0];for(let u=1;u<a.length;u++)if(a[u].getAttribute("primary")==="true"){s=a[u];break}return parseFloat(s.getElementsByTagName("level")[0].textContent)}async function Wct(e,t,r){r=r.toUpperCase();let o=(await e.fetch({url:`https://www.ebi.ac.uk/emdb/api/entry/map/${r}`,type:"json"}).runInContext(t))?.map?.contour_list?.contour;return!o||o.length===0?Xct(e,t,r):o.find(i=>i.primary)?.level??o[0].level}async function Xct(e,t,r){r=r.toUpperCase();let o=(await e.fetch({url:`https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/${r}`,type:"json"}).runInContext(t))?.[r],i;return o?.[0]?.map?.contour_level?.value!==void 0&&(i=+o[0].map.contour_level.value),i}async function CPe(e,t,r){let o=(await e.fetch({url:`https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/${r}`,type:"json"}).runInContext(t))?.[r],i=[];if(o?.[0]?.related_structures){let a=o[0].related_structures.filter(s=>s.resource==="EMDB"&&s.relationship==="associated EM volume");if(!a.length)throw new Error(`No related EMDB entry found for '${r}'.`);i.push(...a.map(s=>s.accession))}else throw new Error(`No related EMDB entry found for '${r}'.`);return i}function cC(e,t,r){return{i:e,j:t,k:r}}function yp(e,t){return{a:e,b:t}}var Ia=[cC(0,0,0),cC(1,0,0),cC(1,1,0),cC(0,1,0),cC(0,0,1),cC(1,0,1),cC(1,1,1),cC(0,1,1)],SPe=[yp(Ia[0],Ia[1]),yp(Ia[1],Ia[2]),yp(Ia[2],Ia[3]),yp(Ia[3],Ia[0]),yp(Ia[4],Ia[5]),yp(Ia[5],Ia[6]),yp(Ia[6],Ia[7]),yp(Ia[7],Ia[4]),yp(Ia[0],Ia[4]),yp(Ia[1],Ia[5]),yp(Ia[2],Ia[6]),yp(Ia[3],Ia[7])],vPe=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],IPe=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],mC=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],$F=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function APe(e,t){let r=Math.min(65536,e*4),n=Qe.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),o=Qe.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),i=Qe.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),a=Qe.create(Uint32Array,3,r,t&&t.indexBuffer.ref.value),s=0,l=0;return{addVertex:(u,c,m)=>(++s,Qe.add3(n,u,c,m)),addNormal:(u,c,m)=>{Qe.add3(o,u,c,m)},addGroup:u=>{Qe.add(i,u)},addTriangle:(u,c,m,d)=>{let p=u[c],h=u[m],f=u[d];p>=0&&h>=0&&f>=0&&(++l,Qe.add3(a,p,h,f))},get:()=>{let u=Qe.compact(n,!0),c=Qe.compact(o,!0),m=Qe.compact(a,!0),d=Qe.compact(i,!0);return ft.create(u,m,c,d,s,l,t)}}}function TPe(e,t){let r=Qe.create(Float32Array,3,e),n=Qe.create(Float32Array,1,e),o=Qe.create(Float32Array,2,e),i=0;return{addVertex:(a,s,l)=>Qe.add3(r,a,s,l),addNormal:()=>iu,addGroup:a=>{Qe.add(n,a)},addTriangle:(a,s,l,u,c)=>{let m=a[s],d=a[l],p=a[u];m>=0&&d>=0&&p>=0&&($F[s][l]&c&&(++i,Qe.add2(o,a[s],a[l])),$F[l][u]&c&&(++i,Qe.add2(o,a[l],a[u])),$F[s][u]&c&&(++i,Qe.add2(o,a[s],a[u])))},get:()=>{let a=Qe.compact(r,!0),s=Qe.compact(o,!0),l=Qe.compact(n,!0),u=Ua.create(i,i/10,t);for(let c=0;c<i;++c){let m=s[c*2],d=s[c*2+1];u.add(a[m*3],a[m*3+1],a[m*3+2],a[d*3],a[d*3+1],a[d*3+2],l[m])}return u.getLines()}}}function PPe(e){return{...e,bottomLeft:Wi(e.bottomLeft,[0,0,0]),topRight:Wi(e.topRight,e.scalarField.space.dimensions)}}function _Pe(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function sg(e,t){return Pe.create("Marching Cubes Mesh",async r=>{let n=PPe(e),{dX:o,dY:i,dZ:a}=_Pe(n),s=Math.min(262144,Math.max(o*i*a/32,1024)),l=APe(s,t);return await new eV(r,l,n).run(),l.get()})}function UA(e,t){return Pe.create("Marching Cubes Lines",async r=>{let n=PPe(e),{dX:o,dY:i,dZ:a}=_Pe(n),s=Math.min(262144,Math.max(o*i*a/32,1024)),l=TPe(s,t);return await new eV(r,l,n).run(),l.get()})}var eV=class{constructor(t,r,n){this.ctx=t;this.minX=0;this.minY=0;this.minZ=0;this.maxX=0;this.maxY=0;this.maxZ=0;this.state=new yQ(r,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}async doSlices(){let t=0;this.edgeFilter=15;for(let r=this.minZ;r<this.maxZ;r++,this.edgeFilter&=-5)this.slice(r),t+=this.sliceSize,this.ctx.shouldUpdate&&await this.ctx.update({message:"Computing surface...",current:t,max:this.size})}slice(t){this.edgeFilter|=2;for(let r=this.minY;r<this.maxY;r++,this.edgeFilter&=-3){this.edgeFilter|=1;for(let n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,r,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)}async run(){await this.doSlices()}},yQ=class{constructor(t,r){this.builder=t;this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0];this.i=0;this.j=0;this.k=0;let n=r.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=r.isoLevel,this.scalarFieldGet=r.scalarField.space.get,this.scalarField=r.scalarField.data,r.idField&&(this.idField=r.idField.data,this.idFieldGet=r.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}get3dOffsetFromEdgeInfo(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i}clearEdgeVertexIndexSlice(t){let r=t%2===0?0:3*this.nX*this.nY,n=t%2===0?3*this.nX*this.nY:this.verticesOnEdges.length;this.verticesOnEdges.fill(0,r,n)}interpolate(t){let r=vPe[t],n=3*this.get3dOffsetFromEdgeInfo(r)+r.e,o=this.verticesOnEdges[n];if(o>0)return o-1;let i=this.scalarField,a=this.scalarFieldGet,s=SPe[t],l=s.a,u=s.b,c=l.i+this.i,m=l.j+this.j,d=l.k+this.k,p=u.i+this.i,h=u.j+this.j,f=u.k+this.k,y=a(i,c,m,d),g=a(i,p,h,f),x=(this.isoLevel-y)/(y-g);if(this.idField){let R=this.idFieldGet(this.idField,c,m,d),k=this.idFieldGet(this.idField,p,h,f),B=x<.5?R:k;if(B===-1&&(B=x<.5?k:R),B===-2)return-1;this.builder.addGroup(B)}else this.builder.addGroup(0);let S=this.builder.addVertex(c+x*(c-p),m+x*(m-h),d+x*(d-f));this.verticesOnEdges[n]=S+1;let I=a(i,Math.max(0,c-1),m,d)-a(i,Math.min(this.nX-1,c+1),m,d),v=a(i,c,Math.max(0,m-1),d)-a(i,c,Math.min(this.nY-1,m+1),d),A=a(i,c,m,Math.max(0,d-1))-a(i,c,m,Math.min(this.nZ-1,d+1)),_=a(i,Math.max(0,p-1),h,f)-a(i,Math.min(this.nX-1,p+1),h,f),T=a(i,p,Math.max(0,h-1),f)-a(i,p,Math.min(this.nY-1,h+1),f),w=a(i,p,h,Math.max(0,f-1))-a(i,p,h,Math.min(this.nZ-1,f+1)),D=I+x*(I-_),M=v+x*(v-T),E=A+x*(A-w);return this.isoLevel>=0?this.builder.addNormal(D,M,E):this.builder.addNormal(-D,-M,-E),S}get(t,r,n){return this.scalarFieldGet(this.scalarField,t,r,n)}processCell(t,r,n,o){let i=0;if(this.get(t,r,n)<this.isoLevel&&(i|=1),this.get(t+1,r,n)<this.isoLevel&&(i|=2),this.get(t+1,r+1,n)<this.isoLevel&&(i|=4),this.get(t,r+1,n)<this.isoLevel&&(i|=8),this.get(t,r,n+1)<this.isoLevel&&(i|=16),this.get(t+1,r,n+1)<this.isoLevel&&(i|=32),this.get(t+1,r+1,n+1)<this.isoLevel&&(i|=64),this.get(t,r+1,n+1)<this.isoLevel&&(i|=128),i===0||i===255)return;this.i=t,this.j=r,this.k=n;let a=IPe[i];(a&1)>0&&(this.vertList[0]=this.interpolate(0)),(a&2)>0&&(this.vertList[1]=this.interpolate(1)),(a&4)>0&&(this.vertList[2]=this.interpolate(2)),(a&8)>0&&(this.vertList[3]=this.interpolate(3)),(a&16)>0&&(this.vertList[4]=this.interpolate(4)),(a&32)>0&&(this.vertList[5]=this.interpolate(5)),(a&64)>0&&(this.vertList[6]=this.interpolate(6)),(a&128)>0&&(this.vertList[7]=this.interpolate(7)),(a&256)>0&&(this.vertList[8]=this.interpolate(8)),(a&512)>0&&(this.vertList[9]=this.interpolate(9)),(a&1024)>0&&(this.vertList[10]=this.interpolate(10)),(a&2048)>0&&(this.vertList[11]=this.interpolate(11));let s=mC[i];for(let l=0;l<s.length;l+=3){let u=s[l],c=s[l+1],m=s[l+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,u,c,m,o):this.builder.addTriangle(this.vertList,m,c,u,o)}}};function RPe(e,t,r,n,o){let i=e.instances.length,a=new Float32Array(i*16);for(let s=0;s<i;++s)Z.toArray(e.instances[s].transform,a,s*16);return Y0(a,i,t,r,n,o)}function Qct(e,t,r,n,o,i){let{createValues:a,createRenderableState:s}=Ga.getUtils(t),l=RPe(e,t.boundingSphere,o.cellSize,o.batchSize),u=a(t,l,r,n,o),c=s(o);return Kd(t.kind,u,c,i)}function Uc(e,t){let{defaultProps:r,createGeometry:n,createLocationIterator:o,getLoci:i,eachLocation:a,setUpdateState:s,mustRecreate:l,dispose:u}=e,{updateValues:c,updateBoundingSphere:m,updateRenderableState:d,createPositionIterator:p}=e.geometryUtils,h=ld.create(),f,y,g,x,S,I=Object.assign({},r),v=pi.createEmpty(),A,_,T,w=-1,D,M;function E(L,V,U,Q){if(!U&&!A)throw new Error("missing volume");if(y=Object.assign({},I,V),g=L,x=U,S=Q,ld.reset(h),f?Xn.areEquivalent(x.grid,A.grid)&&!Ve.areInstanceTransformsEqual(x,A)?h.updateTransform=!0:(!Ve.areEquivalent(x,A)||S!==_)&&(h.createNew=!0):h.createNew=!0,h.createNew){h.createGeometry=!0;return}s(h,U,y,I,g,v),as.areEqual(L.color,v.color)||(h.updateColor=!0),yo.areEqual(L.size,v.size)||(h.updateSize=!0),(y.instanceGranularity!==I.instanceGranularity||y.cellSize!==I.cellSize||y.batchSize!==I.batchSize)&&(h.updateTransform=!0),h.updateTransform&&(h.updateMatrix=!0),h.updateSize&&!("uSize"in f.values)&&(h.createGeometry=!0),h.createGeometry&&(h.updateColor=!0,h.updateSize=!0)}function R(L){if(h.createNew)if(D=o(x,S),L)f=Qct(x,L,D,g,y,t),M=p(L,f.values);else throw new Error("expected geometry to be given");else{if(!f)throw new Error("expected renderObject to be available");if((h.updateColor||h.updateSize||h.updateTransform)&&(D=o(x,S)),h.updateTransform){let{instanceCount:V,groupCount:U}=D;y.instanceGranularity?oo(V,"instance",f.values):oo(V*U,"groupInstance",f.values)}if(h.updateMatrix&&RPe(x,T.boundingSphere,y.cellSize,y.batchSize,f.values),h.createGeometry)if(L)P.updateIfChanged(f.values.drawCount,Ga.getDrawCount(L)),P.updateIfChanged(f.values.uVertexCount,Ga.getVertexCount(L)),P.updateIfChanged(f.values.uGroupCount,D.groupCount);else throw new Error("expected geometry to be given");(h.updateTransform||h.createGeometry)&&(m(f.values,L||T),M=p(L||T,f.values)),h.updateSize&&"uSize"in f.values&&Ml(D,g.size,f.values),h.updateColor&&Ki(D,M,g.color,f.values),c(f.values,y),d(f.state,y)}I=y,v=g,A=x,_=S,L&&(T=L,w+=1)}function k(L,V,U,Q){let O=!1;if(Ve.Cell.isLoci(L)){if(Ve.Cell.isLociEmpty(L)||!Ve.areEquivalent(L.volume,V))return!1;for(let{instances:q}of L.elements)Se.forEach(q,X=>{Q(xe.ofSingleton(X))&&(O=!0)})}else if(Ve.Segment.isLoci(L)){if(Ve.Segment.isLociEmpty(L)||!Ve.areEquivalent(L.volume,V))return!1;for(let{segments:q,instances:X}of L.elements)Se.has(q,U)&&Se.forEach(X,F=>{Q(xe.ofSingleton(F))&&(O=!0)})}else if(Ve.Isosurface.isLoci(L)){if(Ve.Isosurface.isLociEmpty(L))return!1;if(xe.is(L.instances))Q(L.instances)&&(O=!0);else for(let q=0,X=L.instances.length;q<X;++q)Q(xe.ofSingleton(q))&&(O=!0)}else if(Ve.isLoci(L)){if(Ve.isLociEmpty(L))return!1;if(xe.is(L.instances))Q(L.instances)&&(O=!0);else for(let q=0,X=L.instances.length;q<X;++q)Q(xe.ofSingleton(q))&&(O=!0)}return O}function B(L,V){return Ji(L)?I.instanceGranularity?V(xe.ofBounds(0,D.instanceCount)):V(xe.ofBounds(0,D.groupCount*D.instanceCount)):I.instanceGranularity?k(L,A,_,V):a(L,A,_,I,V)}return{get groupCount(){return D?D.count:0},get renderObject(){return f},get geometryVersion(){return w},async createOrUpdate(L,V,U={},Q){if(E(V,U,Q?.volume||A,Q?.key||_),h.createGeometry){let O=n(L,x,S,g,y,T);return Eb(O)?O.then(R):R(O)}else R()},getLoci(L){return f?i(L,A,_,I,f.id):dr},eachLocation(L){for(D.reset();D.hasNext;){let{location:V,isSecondary:U}=D.move();L(V,U)}},mark(L,V){return Fr.mark(f,L,V,B)},setVisibility(L){Fr.setVisibility(f,L)},setAlphaFactor(L){Fr.setAlphaFactor(f,L)},setPickable(L){Fr.setPickable(f,L)},setColorOnly(L){Fr.setColorOnly(f,L)},setTransform(L,V){Fr.setTransform(f,L,V)},setOverpaint(L){return Fr.setOverpaint(f,L,B,!0)},setTransparency(L){return Fr.setTransparency(f,L,B,!0)},setEmissive(L){return Fr.setEmissive(f,L,B,!0)},setSubstance(L){return Fr.setSubstance(f,L,B,!0)},setClipping(L){return Fr.setClipping(f,L,B,!0)},setThemeStrength(L){Fr.setThemeStrength(f,L)},destroy(){u?.(T),f&&(f.state.disposed=!0,f=void 0)},mustRecreate:l}}var Lfn={...We.Params};function bp(e,t,r,n,o,i=()=>[-1]){let a=0,{webgl:s}=t,l=new En,u=new Vt.GeometryState,c=Dc(),m=[],d=Vt.createState(),p=new Map,h,f,y,g,x=pi.createEmpty();async function S(D,M){let E=p.get(M);return E?E.mustRecreate?.({volume:h,key:M},g,s)&&(E.destroy(),E=n(c,h,M,g,s),p.set(M,E)):(E=n(c,h,M,g,s),p.set(M,E)),E.createOrUpdate({webgl:s,runtime:D},x,g,{volume:h,key:M})}function I(D={},M){M&&M!==h&&(y=r(t,M),h=M,g||(g=C.getDefaultValues(y)));let E=M_(Object.assign({},g,D),h);return Object.assign(g,D,E),f=i(g),Pe.create("Creating or updating VolumeRepresentation",async R=>{let k=new Set(p.keys());for(let B=0,L=f.length;B<L;++B){let V=f[B];k.delete(V);let U=S(R,V);U&&await U}k.forEach(B=>{p.get(B)?.destroy(),p.delete(B)}),m.length=0,p.forEach(B=>{B.renderObject&&(m.push(B.renderObject),u.add(B.renderObject.id,B.geometryVersion))}),u.snapshot(),l.next(a++)})}function v(D,M){let E=!1;return p.forEach(R=>{E=R.mark(D,M)||E}),E}function A(D,M){M.visible!==void 0&&D&&D.setVisibility(M.visible),M.alphaFactor!==void 0&&D&&D.setAlphaFactor(M.alphaFactor),M.pickable!==void 0&&D&&D.setPickable(M.pickable),M.overpaint!==void 0&&D&&D.setOverpaint(M.overpaint),M.transparency!==void 0&&D&&D.setTransparency(M.transparency),M.emissive!==void 0&&D&&D.setEmissive(M.emissive),M.substance!==void 0&&D&&D.setSubstance(M.substance),M.clipping!==void 0&&D&&D.setClipping(M.clipping),M.transform!==void 0&&D&&D.setTransform(M.transform),M.themeStrength!==void 0&&D&&D.setThemeStrength(M.themeStrength)}function _(D){let{visible:M,alphaFactor:E,pickable:R,overpaint:k,transparency:B,emissive:L,substance:V,clipping:U,transform:Q,themeStrength:O,syncManually:q,markerActions:X}=D,F={};M!==void 0&&(F.visible=M),E!==void 0&&(F.alphaFactor=E),R!==void 0&&(F.pickable=R),k!==void 0&&(F.overpaint=k),B!==void 0&&(F.transparency=B),L!==void 0&&(F.emissive=L),V!==void 0&&(F.substance=V),U!==void 0&&(F.clipping=U),O!==void 0&&(F.themeStrength=O),Q!==void 0&&!Z.areEqual(Q,d.transform,1e-6)&&(F.transform=Q),q!==void 0&&(F.syncManually=q),X!==void 0&&(F.markerActions=X),p.forEach(Y=>A(Y,F)),Vt.updateState(d,D)}function T(D){x=D}function w(){p.forEach(D=>D.destroy()),p.clear()}return{label:e,get groupCount(){let D=0;return p.forEach(M=>{M.renderObject&&(D+=M.groupCount)}),D},get props(){return g},get params(){return y},get state(){return d},get theme(){return x},get geometryVersion(){return u.version},renderObjects:m,updated:l,createOrUpdate:I,setState:_,setTheme:T,getLoci:D=>{let M=dr;return p.forEach(E=>{let R=E.getLoci(D);Ii(R)||(M=R)}),M},getAllLoci:()=>[o(h,g)],eachLocation:D=>{p.forEach(M=>{M.eachLocation(D)})},mark:v,destroy:w}}var DPe=`
precision highp float;
precision highp int;

#if __VERSION__ == 100
    precision highp sampler2D;
    uniform sampler2D tTexture;
#else
    precision highp isampler2D;
    uniform isampler2D tTexture;
#endif

void main(void) {
    #if __VERSION__ == 100
        gl_FragColor = texture2D(tTexture, vec2(0.5));
    #else
        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);
    #endif
}
`;var Zct={...un,tTexture:pt("texture","rgba","float","nearest")},xp="histopyramid-sum";function qct(e,t){if(e.namedComputeRenderables[xp]){let r=e.namedComputeRenderables[xp].values;P.update(r.tTexture,t),e.namedComputeRenderables[xp].update()}else e.namedComputeRenderables[xp]=Yct(e,t);return e.namedComputeRenderables[xp]}function Yct(e,t){let r={...cn,tTexture:P.create(t)},n={...Zct},o=Dr("sum",bn,DPe,{},{0:"ivec4"}),i=Wr(e,"triangles",o,n,r);return Xr(i,r)}function Kct(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}var tV=new Uint8Array(4),wPe=new Int32Array(4);function EPe(e,t){He&&e.timer.mark("getHistopyramidSum");let{gl:r,state:n,resources:o}=e,i=qct(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[xp]||(e.namedFramebuffers[xp]=o.framebuffer());let a=e.namedFramebuffers[xp];return e.namedTextures[xp]||(e.namedTextures[xp]=Ht(r)?o.texture("image-int32","rgba","int","nearest"):o.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[xp].define(1,1)),e.namedTextures[xp].attachFramebuffer(a,0),Kct(e),n.viewport(0,0,1,1),i.render(),r.finish(),e.readPixels(0,0,1,1,Ht(r)?wPe:tV),r.bindFramebuffer(r.FRAMEBUFFER,null),He&&e.timer.markEnd("getHistopyramidSum"),Ht(r)?wPe[0]:Ix(tV[0],tV[1],tV[2])}var MPe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInputLevel;

// previous level used to evaluate the new level
#if __VERSION__ == 100
    uniform sampler2D tPreviousLevel;
#else
    precision highp isampler2D;
    uniform isampler2D tPreviousLevel;
#endif

// inverted size of the previous level texture.
uniform float uSize;
uniform float uTexSize;
uniform bool uFirst;

#include common

void main(void) {
    float k = 0.5 * uSize;
    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;

    #if __VERSION__ == 100
        float a, b, c, d;

        if (uFirst) {
            a = texture2D(tInputLevel, position).r * 255.0;
            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;
            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;
            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;
        } else {
            a = unpackRGBToInt(texture2D(tPreviousLevel, position).rgb);
            b = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);
            c = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);
            d = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);
        }
        gl_FragColor = vec4(packIntToRGB(a + b + c + d), 1.0);
    #else
        int a, b, c, d;

        if (uFirst) {
            a = int(texture2D(tInputLevel, position).r * 255.0);
            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);
            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);
            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);
        } else {
            a = texture2D(tPreviousLevel, position).r;
            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;
            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;
            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;
        }
        gl_FragColor = ivec4(a + b + c + d);
    #endif
}
`;var Jct={...un,tInputLevel:pt("texture","rgba","float","nearest"),tPreviousLevel:pt("texture","rgba","float","nearest"),uSize:he("f"),uTexSize:he("f"),uFirst:he("b")},dC="histogram-pyramid";function $ct(e,t,r){if(e.namedComputeRenderables[dC]){let n=e.namedComputeRenderables[dC].values;P.update(n.tInputLevel,t),P.update(n.tPreviousLevel,r),e.namedComputeRenderables[dC].update()}else e.namedComputeRenderables[dC]=emt(e,t,r);return e.namedComputeRenderables[dC]}function emt(e,t,r){let n={...cn,tInputLevel:P.create(t),tPreviousLevel:P.create(r),uSize:P.create(0),uTexSize:P.create(0),uFirst:P.create(!0)},o={...Jct},i=Dr("reduction",bn,MPe,{},{0:"ivec4"}),a=Wr(e,"triangles",i,o,n);return Xr(a,n)}function tmt(e,t){let r=Math.pow(2,t),n=`level${t}`,o=e.isWebGL2?rV(n,e,"image-int32","alpha","int","nearest"):rV(n,e,"image-uint8","rgba","ubyte","nearest");o.define(r,r);let i=nmt(n,e);return i||(i=BPe(n,e)),o.attachFramebuffer(i,0),{texture:o,framebuffer:i}}function rmt(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function BPe(e,t){let r=`${dC}-${e}`;return t.namedFramebuffers[r]||(t.namedFramebuffers[r]=t.resources.framebuffer()),t.namedFramebuffers[r]}function rV(e,t,r,n,o,i){let a=`${dC}-${e}`;return t.namedTextures[a]||(t.namedTextures[a]=t.resources.texture(r,n,o,i)),t.namedTextures[a]}function nmt(e,t){let r=`${dC}-${e}`;return t.namedFramebuffers[r]}function kPe(e,t,r,n){He&&e.timer.mark("createHistogramPyramid");let{gl:o,state:i}=e,a=t.getWidth(),s=t.getHeight();if(a!==s||!Rb(a))throw new Error("inputTexture must be of square power-of-two size");let l=Math.ceil(Math.log(a)/Math.log(2)),u=Math.pow(2,l),c=Math.pow(2,l),m=Math.pow(2,l-1),d=e.isWebGL2?rV("pyramid",e,"image-int32","alpha","int","nearest"):rV("pyramid",e,"image-uint8","rgba","ubyte","nearest");d.define(c,m);let p=BPe("pyramid",e);d.attachFramebuffer(p,0),i.viewport(0,0,c,m),Ht(o)?o.clearBufferiv(o.COLOR,0,[0,0,0,0]):o.clear(o.COLOR_BUFFER_BIT);let h=[];for(let S=0;S<l;++S)h.push(tmt(e,S));let f=$ct(e,t,h[0].texture);i.currentRenderItemId=-1,rmt(e);let y=0;for(let S=0;S<l;S++){let I=l-1-S;h[I].framebuffer.bind();let A=Math.pow(2,I);P.update(f.values.uSize,Math.pow(2,S+1)/u),P.update(f.values.uTexSize,A),P.updateIfChanged(f.values.uFirst,S===0),S>0&&(P.update(f.values.tPreviousLevel,h[l-S].texture),f.update()),i.currentRenderItemId=-1,i.viewport(0,0,A,A),i.scissor(0,0,A,A),Ht(o)?o.clearBufferiv(o.COLOR,0,[0,0,0,0]):o.clear(o.COLOR_BUFFER_BIT),i.scissor(0,0,n[0],n[1]),f.render(),d.bind(0),o.copyTexSubImage2D(o.TEXTURE_2D,0,y,0,0,0,A,A),d.unbind(0),y+=A}o.finish(),He&&e.timer.markEnd("createHistogramPyramid");let g=Math.max(1,EPe(e,h[0].texture)),x=Math.ceil(g/Math.pow(2,l));return{pyramidTex:d,count:g,height:x,levels:l,scale:r}}var MR;function LPe(){if(MR!==void 0)return MR;MR=so(16*16,1,Uint8Array);let{array:e}=MR;for(let t=0,r=mC.length;t<r;++t)e[t]=mC[t].length/3;return MR}var BR;function FPe(){if(BR!==void 0)return BR;BR=so(64*64,1,Uint8Array);let{array:e}=BR;for(let t=0,r=mC.length;t<r;++t)for(let n=0;n<16;++n)n<mC[t].length?e[t*16+n]=mC[t][n]:e[t*16+n]=255;return BR}var VPe=`
precision highp float;
precision highp int;
precision highp sampler2D;

#if __VERSION__ == 100
    uniform sampler2D tActiveVoxelsPyramid;
#else
    precision highp isampler2D;
    uniform isampler2D tActiveVoxelsPyramid;
#endif

uniform sampler2D tActiveVoxelsBase;
uniform sampler2D tVolumeData;
uniform sampler2D tTriIndices;

uniform float uIsoValue;
uniform float uLevels;
uniform float uSize;
uniform float uCount;
uniform bool uInvert;

uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform mat4 uGridTransform;
uniform mat3 uGridTransformAdjoint;

// scale to volume data coord
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord + 0.5 / (texDim / uScale));
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

float voxelValuePadded(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding
    vec4 v = texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
    #ifdef dValueChannel_red
        return v.r;
    #else
        return v.a;
    #endif
}

int idot2(const in ivec2 a, const in ivec2 b) {
    return a.x * b.x + a.y * b.y;
}

int idot4(const in ivec4 a, const in ivec4 b) {
    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;
}

#if __VERSION__ == 100
    int pyramidVoxel(vec2 pos) {
        return int(unpackRGBToInt(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));
    }
#else
    int pyramidVoxel(vec2 pos) {
        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;
    }
#endif

vec4 baseVoxel(vec2 pos) {
    return texture2D(tActiveVoxelsBase, pos / uSize);
}

vec4 getGroup(const in vec3 p) {
    vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
    // note that we swap x and z because the texture is flipped around y
    #if defined(dAxisOrder_012)
        float group = p.z + p.y * gridDim.z + p.x * gridDim.z * gridDim.y; // 210
    #elif defined(dAxisOrder_021)
        float group = p.y + p.z * gridDim.y + p.x * gridDim.y * gridDim.z; // 120
    #elif defined(dAxisOrder_102)
        float group = p.z + p.x * gridDim.z + p.y * gridDim.z * gridDim.x; // 201
    #elif defined(dAxisOrder_120)
        float group = p.x + p.z * gridDim.x + p.y * gridDim.x * gridDim.z; // 021
    #elif defined(dAxisOrder_201)
        float group = p.y + p.x * gridDim.y + p.z * gridDim.y * gridDim.x; // 102
    #elif defined(dAxisOrder_210)
        float group = p.x + p.y * gridDim.x + p.z * gridDim.x * gridDim.y; // 012
    #endif
    return vec4(group > 16777215.5 ? vec3(1.0) : packIntToRGB(group), 1.0);
}

void main(void) {
    // get 1D index
    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);

    // ignore 1D indices outside of the grid
    if(vI >= int(uCount)) discard;

    ivec2 offset = ivec2(int(uSize) - 2, 0);

    int start = 0;
    ivec4 starts = ivec4(0);
    ivec4 ends = ivec4(0);
    int diff = 2;
    ivec4 m = ivec4(0);
    ivec2 position = ivec2(0);
    ivec4 vI4 = ivec4(vI);

    ivec2 relativePosition = ivec2(0);
    int end = 0;
    ivec2 pos1 = ivec2(0);
    ivec2 pos2 = ivec2(0);
    ivec2 pos3 = ivec2(0);
    ivec2 pos4 = ivec2(0);
    ivec3 vI3 = ivec3(vI);
    ivec3 mask = ivec3(0);

    // traverse the different levels of the pyramid
    for(int i = 1; i < 14; i++) {
        if(float(i) >= uLevels) break;

        offset.x -= diff;
        diff *= 2;
        relativePosition = position + offset;

        end = start + pyramidVoxel(vec2(relativePosition));
        pos1 = ivec2(relativePosition);
        starts.x = start;
        ends.x = end;
        pos2 = ivec2(relativePosition + ivec2(1, 0));
        starts.y = ends.x;
        ends.y = ends.x + pyramidVoxel(vec2(pos2));
        pos3 = relativePosition + ivec2(0, 1);
        starts.z = ends.y;
        ends.z = ends.y + pyramidVoxel(vec2(pos3));
        pos4 = relativePosition + ivec2(1, 1);
        starts.w = ends.z;
        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
        m = ivec4(mask, 1 - int(any(bvec3(mask))));

        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;
        start = idot4(m, starts);
        position = 2 * (relativePosition - offset);
    }

    end = start + int(baseVoxel(vec2(position)).r * 255.0);
    pos1 = position;
    starts.x = start;
    ends.x = end;
    pos2 = position + ivec2(1, 0);
    starts.y = ends.x;
    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);
    pos3 = position + ivec2(0, 1);
    starts.z = ends.y;
    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);
    pos4 = position + ivec2(1, 1);
    starts.w = ends.z;
    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
    m = ivec4(mask, 1 - int(any(bvec3(mask))));
    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;

    vec2 coord2d = (vec2(position) / uSize) / uScale;
    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);

    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);

    // current vertex for the up to 15 MC cases
    int currentVertex = vI - idot4(m, starts);

    // ensure winding-order is the same for negative and positive iso-levels
    if (uInvert) {
        int v = imod(currentVertex + 1, 3);
        if (v == 1) currentVertex += 2;
        else if (v == 0) currentVertex -= 2;
    }

    // get index into triIndices table
    int mcIndex = 16 * int(edgeIndex) + currentVertex;
    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);

    // bit mask to avoid conditionals (see comment below) for getting MC case corner
    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));

    // get edge value masks
    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));
    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));
    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));

    // apply bit masks
    vec3 b0 = coord3d +
                m1.y * c1 +
                m1.z * c2 +
                m1.w * c3 +
                m2.x * c4 +
                m2.y * c5 +
                m2.z * c6 +
                m2.w * c7 +
                m3.y * c1 +
                m3.z * c2 +
                m3.w * c3;
    vec3 b1 = coord3d +
                m1.x * c1 +
                m1.y * c2 +
                m1.z * c3 +
                m2.x * c5 +
                m2.y * c6 +
                m2.z * c7 +
                m2.w * c4 +
                m3.x * c4 +
                m3.y * c5 +
                m3.z * c6 +
                m3.w * c7;

    // the conditionals that are avoided by above bitmasks
    // vec3 b0 = coord3d;
    // vec3 b1 = coord3d;
    // if (mcIndex == 0.0) {
    //     b1 += c1;
    // } else if (mcIndex == 1.0) {
    //     b0 += c1; b1 += c2;
    // } else if (mcIndex == 2.0) {
    //     b0 += c2; b1 += c3;
    // } else if (mcIndex == 3.0) {
    //     b0 += c3;
    // } else if (mcIndex == 4.0) {
    //     b0 += c4; b1 += c5;
    // } else if (mcIndex == 5.0) {
    //     b0 += c5; b1 += c6;
    // } else if (mcIndex == 6.0) {
    //     b0 += c6; b1 += c7;
    // } else if (mcIndex == 7.0) {
    //     b0 += c7; b1 += c4;
    // } else if (mcIndex == 8.0) {
    //     b1 += c4;
    // } else if (mcIndex == 9.0) {
    //     b0 += c1; b1 += c5;
    // } else if (mcIndex == 10.0) {
    //     b0 += c2; b1 += c6;
    // } else if (mcIndex == 11.0) {
    //     b0 += c3; b1 += c7;
    // }
    // b0 = floor(b0 + 0.5);
    // b1 = floor(b1 + 0.5);

    vec4 d0 = voxel(b0);
    vec4 d1 = voxel(b1);

    #ifdef dValueChannel_red
        float v0 = d0.r;
        float v1 = d1.r;
    #else
        float v0 = d0.a;
        float v1 = d1.a;
    #endif

    float t = (uIsoValue - v0) / (v0 - v1);
    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;

    // group id
    #if __VERSION__ == 100 || defined(dConstantGroup)
        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)
        // ensure a constant group id per triangle as needed
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);
        #else
            gl_FragData[1] = getGroup(coord3d);
        #endif
    #else
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);
        #else
            gl_FragData[1] = getGroup(t < 0.5 ? b0 : b1);
        #endif
    #endif

    // normals from gradients
    vec3 n0 = -normalize(vec3(
        voxelValuePadded(b0 - c1) - voxelValuePadded(b0 + c1),
        voxelValuePadded(b0 - c3) - voxelValuePadded(b0 + c3),
        voxelValuePadded(b0 - c4) - voxelValuePadded(b0 + c4)
    ));
    vec3 n1 = -normalize(vec3(
        voxelValuePadded(b1 - c1) - voxelValuePadded(b1 + c1),
        voxelValuePadded(b1 - c3) - voxelValuePadded(b1 + c3),
        voxelValuePadded(b1 - c4) - voxelValuePadded(b1 + c4)
    ));
    gl_FragData[2].xyz = -vec3(
        n0.x + t * (n0.x - n1.x),
        n0.y + t * (n0.y - n1.y),
        n0.z + t * (n0.z - n1.z)
    );

    // ensure normal-direction is the same for negative and positive iso-levels
    if (uInvert) {
        gl_FragData[2].xyz *= -1.0;
    }

    // apply normal matrix
    gl_FragData[2].xyz = uGridTransformAdjoint * gl_FragData[2].xyz;
}
`;var OPe=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tTriCount;
uniform sampler2D tVolumeData;

uniform float uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord);
}

float voxelValue(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    vec4 v = texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
    #ifdef dValueChannel_red
        return v.r;
    #else
        return v.a;
    #endif
}

void main(void) {
    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;
    vec3 posXYZ = index3dFrom2d(uv);

    // get MC case as the sum of corners that are below the given iso level
    float c = step(voxelValue(posXYZ), uIsoValue)
        + 2. * step(voxelValue(posXYZ + c1), uIsoValue)
        + 4. * step(voxelValue(posXYZ + c2), uIsoValue)
        + 8. * step(voxelValue(posXYZ + c3), uIsoValue)
        + 16. * step(voxelValue(posXYZ + c4), uIsoValue)
        + 32. * step(voxelValue(posXYZ + c5), uIsoValue)
        + 64. * step(voxelValue(posXYZ + c6), uIsoValue)
        + 128. * step(voxelValue(posXYZ + c7), uIsoValue);
    c *= step(c, 254.);

    // handle out of bounds positions
    posXYZ += 1.0;
    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)
    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)
        c = 0.0;

    // get total triangles to generate for calculated MC case from triCount texture
    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;
    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);
}
`;var omt={...un,tTriCount:pt("image-uint8","alpha","ubyte","nearest"),tVolumeData:pt("texture","rgba","ubyte","nearest"),dValueChannel:ct("string",["red","alpha"]),uIsoValue:he("f"),uGridDim:he("v3"),uGridTexDim:he("v3"),uScale:he("v2")},Of="active-voxels";function GPe(e,t){return Ht(e.gl)&&t.format===e.gl.RED?"red":"alpha"}function imt(e,t,r,n,o,i){if(e.namedComputeRenderables[Of]){let a=e.namedComputeRenderables[Of].values;P.update(a.uQuadScale,i),P.update(a.tVolumeData,t),P.update(a.dValueChannel,GPe(e,t)),P.updateIfChanged(a.uIsoValue,o),P.update(a.uGridDim,r),P.update(a.uGridTexDim,n),P.update(a.uScale,i),e.namedComputeRenderables[Of].update()}else e.namedComputeRenderables[Of]=amt(e,t,r,n,o,i);return e.namedComputeRenderables[Of]}function amt(e,t,r,n,o,i){let a={...cn,tTriCount:P.create(LPe()),uQuadScale:P.create(i),tVolumeData:P.create(t),dValueChannel:P.create(GPe(e,t)),uIsoValue:P.create(o),uGridDim:P.create(r),uGridTexDim:P.create(n),uScale:P.create(i)},s={...omt},l=Dr("active-voxels",bn,OPe),u=Wr(e,"triangles",l,s,a);return Xr(u,a)}function smt(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function UPe(e,t,r,n,o,i){He&&e.timer.mark("calcActiveVoxels");let{gl:a,state:s,resources:l}=e,u=t.getWidth(),c=t.getHeight();e.namedFramebuffers[Of]||(e.namedFramebuffers[Of]=l.framebuffer());let m=e.namedFramebuffers[Of];m.bind(),e.namedTextures[Of]||(e.namedTextures[Of]=l.texture("image-uint8","rgba","ubyte","nearest"));let d=e.namedTextures[Of];d.define(u,c);let p=imt(e,t,r,n,o,i);return e.state.currentRenderItemId=-1,d.attachFramebuffer(m,0),smt(e),s.viewport(0,0,u,c),s.scissor(0,0,u,c),a.clear(a.COLOR_BUFFER_BIT),s.scissor(0,0,n[0],n[1]),p.render(),a.finish(),He&&e.timer.markEnd("calcActiveVoxels"),d}var lmt={...un,tTriIndices:pt("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:pt("texture","rgba","float","nearest"),tActiveVoxelsBase:pt("texture","rgba","float","nearest"),tVolumeData:pt("texture","rgba","ubyte","nearest"),dValueChannel:ct("string",["red","alpha"]),uIsoValue:he("f"),uSize:he("f"),uLevels:he("f"),uCount:he("f"),uInvert:he("b"),uGridDim:he("v3"),uGridTexDim:he("v3"),uGridTransform:he("m4"),uGridTransformAdjoint:he("m3"),uScale:he("v2"),dPackedGroup:ct("boolean"),dAxisOrder:ct("string",["012","021","102","120","201","210"]),dConstantGroup:ct("boolean")},pC="isosurface";function NPe(e,t){return Ht(e.gl)&&t.format===e.gl.RED?"red":"alpha"}function umt(e,t,r,n,o,i,a,s,l,u,c,m,d,p,h){if(e.namedComputeRenderables[pC]){let f=e.namedComputeRenderables[pC].values;P.update(f.tActiveVoxelsPyramid,t),P.update(f.tActiveVoxelsBase,r),P.update(f.tVolumeData,n),P.update(f.dValueChannel,NPe(e,n)),P.updateIfChanged(f.uIsoValue,s),P.updateIfChanged(f.uSize,Math.pow(2,l)),P.updateIfChanged(f.uLevels,l),P.updateIfChanged(f.uCount,c),P.updateIfChanged(f.uInvert,m),P.update(f.uGridDim,o),P.update(f.uGridTexDim,i),P.update(f.uGridTransform,a),P.update(f.uGridTransformAdjoint,Ot.adjointFromMat4(Ot(),a)),P.update(f.uScale,u),P.updateIfChanged(f.dPackedGroup,d),P.updateIfChanged(f.dAxisOrder,p.join("")),P.updateIfChanged(f.dConstantGroup,h),e.namedComputeRenderables[pC].update()}else e.namedComputeRenderables[pC]=cmt(e,t,r,n,o,i,a,s,l,u,c,m,d,p,h);return e.namedComputeRenderables[pC]}function cmt(e,t,r,n,o,i,a,s,l,u,c,m,d,p,h){let f={...cn,tTriIndices:P.create(FPe()),tActiveVoxelsPyramid:P.create(t),tActiveVoxelsBase:P.create(r),tVolumeData:P.create(n),dValueChannel:P.create(NPe(e,n)),uIsoValue:P.create(s),uSize:P.create(Math.pow(2,l)),uLevels:P.create(l),uCount:P.create(c),uInvert:P.create(m),uGridDim:P.create(o),uGridTexDim:P.create(i),uGridTransform:P.create(a),uGridTransformAdjoint:P.create(Ot.adjointFromMat4(Ot(),a)),uScale:P.create(u),dPackedGroup:P.create(d),dAxisOrder:P.create(p.join("")),dConstantGroup:P.create(h)},y={...lmt},g=Dr("isosurface",bn,VPe,{drawBuffers:"required"}),x=Wr(e,"triangles",g,y,f);return Xr(x,f)}function mmt(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function dmt(e,t,r,n,o,i,a,s,l,u,c,m,d,p,h){let{drawBuffers:f}=e.extensions;if(!f)throw new Error("need WebGL draw buffers");He&&e.timer.mark("createIsosurfaceBuffers");let{gl:y,state:g,resources:x,extensions:S}=e,{pyramidTex:I,height:v,levels:A,scale:_,count:T}=n,w=I.getWidth();e.namedFramebuffers[pC]||(e.namedFramebuffers[pC]=x.framebuffer());let D=e.namedFramebuffers[pC];Ht(y)?(d||(d=x.texture("image-float32","rgba","float","nearest")),p||(p=x.texture("image-uint8","rgba","ubyte","nearest")),h||(h=S.colorBufferHalfFloat&&S.textureHalfFloat?x.texture("image-float16","rgba","fp16","nearest"):x.texture("image-float32","rgba","float","nearest"))):(d||(d=x.texture("image-float32","rgba","float","nearest")),p||(p=x.texture("image-float32","rgba","float","nearest")),h||(h=x.texture("image-float32","rgba","float","nearest"))),d.define(w,v),p.define(w,v),h.define(w,v),d.attachFramebuffer(D,0),p.attachFramebuffer(D,1),h.attachFramebuffer(D,2);let M=umt(e,I,t,r,o,i,a,s,A,_,T,l,u,c,m);return e.state.currentRenderItemId=-1,D.bind(),f.drawBuffers([f.COLOR_ATTACHMENT0,f.COLOR_ATTACHMENT1,f.COLOR_ATTACHMENT2]),mmt(e),g.viewport(0,0,w,v),y.clear(y.COLOR_BUFFER_BIT),M.render(),y.finish(),He&&e.timer.markEnd("createIsosurfaceBuffers"),{vertexTexture:d,groupTexture:p,normalTexture:h,vertexCount:T}}function zS(e,t,r,n,o,i,a,s,l,u,c,m,d,p){He&&e.timer.mark("extractIsosurface");let h=UPe(e,t,r,n,a,o),f=kPe(e,h,o,n),y=dmt(e,h,t,f,r,n,i,a,s,l,u,c,m,d,p);return He&&e.timer.markEnd("extractIsosurface"),y}var HPe={isoValue:Ve.IsoValueParam},pmt={isoValue:Ve.IsoValueParam,tryUseGpu:C.Boolean(!0),gpuDataType:C.Select("byte",C.arrayToOptions(["byte","float","halfFloat"]),{hideIf:e=>!e.tryUseGpu})};function fmt(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var kR=1;function xQ(e,t){if(e.grid.cells.data.length<Math.pow(10,3))return!1;let r=e.grid.cells.space.dimensions,{powerOfTwoSize:n}=up(r,kR);return n<=t.maxTextureSize/2}function hmt(e,t,r,n,o){return n.tryUseGpu&&o&&fmt(o)&&xQ(t,o)?xmt(e):ymt(e)}function zPe(e,t){let r=xe.ofLength(e.instances.length);return Ve.Isosurface.Loci(e,t.isoValue,r)}function CQ(e,t,r,n,o){let{objectId:i,groupId:a,instanceId:s}=e;if(o===i){let l=Ve.PickingGranularity.get(t),u=Se.ofSingleton(s);if(l==="volume")return Ve.Loci(t,u);if(l==="object")return Ve.Isosurface.Loci(t,n.isoValue,u);{let c=xe.ofSingleton(a);return Ve.Cell.Loci(t,[{indices:c,instances:u}])}}return dr}function SQ(e,t,r,n,o){return Nh(e,t,{isoValue:n.isoValue},o)}async function gmt(e,t,r,n,o,i){e.runtime.update({message:"Marching cubes..."});let a=_a(new Int32Array(t.grid.cells.data.length)),s=await sg({isoLevel:Ve.IsoValue.toAbsolute(o.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:xr.create(t.grid.cells.space,xr.Data1(a))},i).runAsChild(e.runtime),l=Xn.getGridToCartesianTransform(t.grid);return ft.transform(s,l),e.webgl&&!e.webgl.isWebGL2?(ft.uniformTriangleGroup(s,!1),P.updateIfChanged(s.varyingGroup,!1)):P.updateIfChanged(s.varyingGroup,!0),s.setBoundingSphere(Ve.Isosurface.getBoundingSphere(t,o.isoValue)),s}var vQ={...ft.Params,...is.Params,...HPe,...pmt,quality:{...ft.Params.quality,isEssential:!1}};function ymt(e){return Uc({defaultProps:C.getDefaultValues(vQ),createGeometry:gmt,createLocationIterator:lp,getLoci:CQ,eachLocation:SQ,setUpdateState:(t,r,n,o)=>{Ve.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:ft.Utils,mustRecreate:(t,r,n)=>r.tryUseGpu&&!!n&&xQ(t.volume,n)},e)}var bQ;(o=>{let e="volume-isosurface-texture";o.descriptor={name:e};function r(i){delete i._propertyData[e]}o.clear=r;function n(i,a,s){let l=Xn.getGridToCartesianTransform(i.grid),u=b.clone(i.grid.cells.space.dimensions),{width:c,height:m,powerOfTwoSize:d}=up(u,kR),p=b.create(c,m,0),h=Ie.create(c/d,m/d);if(d>a.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");let f=s.gpuDataType==="halfFloat"&&!a.extensions.textureHalfFloat?"float":s.gpuDataType;if(i._propertyData[e]?.dataType!==f){let y=f==="byte"?a.resources.texture("image-uint8","alpha","ubyte","linear"):f==="halfFloat"?a.resources.texture("image-float16","alpha","fp16","linear"):a.resources.texture("image-float32","alpha","float","linear");i._propertyData[e]={texture:y,dataType:f},y.define(d,d),y.load(Ek(i,"data",kR,f),!0),i.customProperties.add(o.descriptor),i.customProperties.assets(o.descriptor,[{dispose:()=>y.destroy()}])}return u[0]+=kR,u[1]+=kR,{texture:i._propertyData[e].texture,transform:l,gridDimension:u,gridTexDim:p,gridTexScale:h}}o.get=n})(bQ||={});function bmt(e,t,r,n,o,i){let{webgl:a}=e;if(!a)throw new Error("webgl context required to create volume isosurface texture-mesh");if(t.grid.cells.data.length<=1)return is.createEmpty(i);let{max:s,min:l}=t.grid.stats,u=s-l,c=Ve.IsoValue.toAbsolute(o.isoValue,t.grid.stats).absoluteValue,m=(c-l)/u,d=t.grid.cells.space.axisOrderSlowToFast,p=t.grid.cells.data.length,h=Ve.getBoundingSphere(t),f=g=>{let{texture:x,gridDimension:S,gridTexDim:I,gridTexScale:v,transform:A}=bQ.get(t,a,o),_=g?.doubleBuffer.get(),T=zS(a,x,S,I,v,A,m,c<0,!1,d,!0,_?.vertex,_?.group,_?.normal);return is.create(T.vertexCount,p,T.vertexTexture,T.groupTexture,T.normalTexture,h,g)},y=f(i);return y.meta.webgl=a,y.meta.reset=()=>{bQ.clear(t),f(y)},y}function xmt(e){return Uc({defaultProps:C.getDefaultValues(vQ),createGeometry:bmt,createLocationIterator:lp,getLoci:CQ,eachLocation:SQ,setUpdateState:(t,r,n,o)=>{Ve.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||(t.createGeometry=!0),n.gpuDataType!==o.gpuDataType&&(t.createGeometry=!0)},geometryUtils:is.Utils,mustRecreate:(t,r,n)=>!r.tryUseGpu||!n||!xQ(t.volume,n),dispose:t=>{t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}async function Cmt(e,t,r,n,o,i){e.runtime.update({message:"Marching cubes..."});let a=_a(new Int32Array(t.grid.cells.data.length)),s=await UA({isoLevel:Ve.IsoValue.toAbsolute(o.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:xr.create(t.grid.cells.space,xr.Data1(a))},i).runAsChild(e.runtime),l=Xn.getGridToCartesianTransform(t.grid);return ln.transform(s,l),s.setBoundingSphere(Ve.Isosurface.getBoundingSphere(t,o.isoValue)),s}var jPe={...ln.Params,...HPe,quality:{...ln.Params.quality,isEssential:!1},sizeFactor:C.Numeric(3,{min:0,max:10,step:.1})};function Smt(e){return Uc({defaultProps:C.getDefaultValues(jPe),createGeometry:Cmt,createLocationIterator:lp,getLoci:CQ,eachLocation:SQ,setUpdateState:(t,r,n,o)=>{Ve.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:ln.Utils},e)}var WPe={solid:(e,t)=>bp("Isosurface mesh",e,t,hmt,zPe),wireframe:(e,t)=>bp("Isosurface wireframe",e,t,Smt,zPe)},XPe={...vQ,...jPe,visuals:C.MultiSelect(["solid"],C.objectToOptions(WPe)),bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},We.ShadingCategory)};function vmt(e,t){let r=C.clone(XPe);return r.isoValue=Ve.createIsoValueParam(Ve.IsoValue.relative(2),t.grid.stats),r}function Imt(e,t){return Vt.createMulti("Isosurface",e,t,Vt.StateBuilder,WPe)}var QPe={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:Imt,getParams:vmt,defaultValues:C.getDefaultValues(XPe),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!Ve.isEmpty(e)&&!Ve.Segmentation.get(e)};var AQ={...hu.Params,quality:{...hu.Params.quality,isEssential:!1},dimension:C.MappedStatic("x",{x:C.Numeric(0,{min:0,max:0,step:1},{immediateUpdate:!0}),y:C.Numeric(0,{min:0,max:0,step:1},{immediateUpdate:!0}),z:C.Numeric(0,{min:0,max:0,step:1},{immediateUpdate:!0}),relativeX:C.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeY:C.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeZ:C.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0})},{isEssential:!0,hideIf:e=>e.mode!=="grid",description:"Slice position in grid coordinates."}),isoValue:Ve.IsoValueParam,mode:C.Select("grid",C.arrayToOptions(["grid","frame","plane"]),{description:"Grid: slice through the volume along the grid axes in integer steps. Frame: slice through the volume along arbitrary axes in any step size. Plane: an arbitrary plane defined by point and normal."}),offset:C.Numeric(0,{min:-1,max:1,step:.01},{isEssential:!0,immediateUpdate:!0,hideIf:e=>e.mode!=="frame",description:"Relative offset from center."}),axis:C.Select("a",C.arrayToOptions(["a","b","c"]),{isEssential:!0,hideIf:e=>e.mode!=="frame",description:"Axis of the frame."}),rotation:C.Group({axis:C.Vec3(b.create(1,0,0),{},{description:"Axis of rotation"}),angle:C.Numeric(0,{min:-180,max:180,step:1},{immediateUpdate:!0,description:"Axis rotation angle in Degrees"})},{isExpanded:!0,hideIf:e=>e.mode!=="frame"}),plane:C.Group({point:C.Vec3(b.create(0,0,0),{},{description:"Plane point"}),normal:C.Vec3(b.create(1,0,0),{},{description:"Plane normal"})},{isExpanded:!0,hideIf:e=>e.mode!=="plane"})};function Amt(e,t){let r=C.clone(AQ),n=t.grid.cells.space.dimensions;return r.dimension=C.MappedStatic("x",{x:C.Numeric(0,{min:0,max:n[0]-1,step:1},{immediateUpdate:!0}),y:C.Numeric(0,{min:0,max:n[1]-1,step:1},{immediateUpdate:!0}),z:C.Numeric(0,{min:0,max:n[2]-1,step:1},{immediateUpdate:!0}),relativeX:C.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeY:C.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeZ:C.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0})},{isEssential:!0,hideIf:o=>o.mode!=="grid"}),r.isoValue=Ve.createIsoValueParam(Ve.IsoValue.absolute(t.grid.stats.min),t.grid.stats),r}async function Tmt(e,t,r,n,o,i){switch(o.mode){case"frame":return _mt(e,t,r,n,o,i);case"grid":return Dmt(e,t,r,n,o,i);case"plane":return Rmt(e,t,r,n,o,i);default:Rr(o.mode)}}function Pmt(e,t){let{axis:r,rotation:n,mode:o}=t,i=Xn.getGridToCartesianTransform(e.grid),a=Z.invert(Z(),i),[s,l,u]=e.grid.cells.space.dimensions,c=s-1,m=l-1,d=u-1,p=b.create(c,0,0),h=b.create(0,m,0),f=b.create(0,0,d),y=Math.max(c,m,d)/Math.max(s,l,u),g=b.create(0,0,0),x=b.create(c,m,d);b.transformMat4(g,g,i),b.transformMat4(x,x,i);let S=b.center(b(),x,g),I=b(),v=b(),A=b(),_=b();if(r==="c"?(b.set(I,c,m,d),b.copy(v,p),b.copy(A,h),b.copy(_,f)):r==="b"?(b.set(I,c,d,m),b.copy(v,p),b.copy(_,h),b.copy(A,f)):(b.set(I,m,d,c),b.copy(_,p),b.copy(v,h),b.copy(A,f)),n.angle!==0){let w=b();b.scaleAndAdd(w,w,p,n.axis[0]),b.scaleAndAdd(w,w,h,n.axis[1]),b.scaleAndAdd(w,w,f,n.axis[2]),b.normalize(w,w);let D=Z.fromRotation(Z(),vr(n.angle),w);b.transformDirection(v,v,D),b.transformDirection(A,A,D),b.transformDirection(_,_,D)}if(o==="frame"){let w=b.distance(g,x),D=b.distance(g,x)*Math.SQRT2;b.set(I,D,D,w)}b.transformDirection(v,v,i),b.transformDirection(A,A,i),b.transformDirection(_,_,i);let T={type:3,center:b.create(c/2,m/2,d/2),scale:b.create(c,m,d),rotation:Tr.identity(),transform:a};return{size:I,major:v,minor:A,normal:_,center:S,trim:T,resolution:y}}function ZPe(e,t,r,n,o,i){let{m:a,width:s,height:l}=r,{cells:{space:u},stats:c}=e.grid,{min:m,max:d}=c,p=t.color.granularity==="uniform",h="color"in t.color&&t.color.color?t.color.color:()=>16777215,f=b(),y=Xn.getGridToCartesianTransform(e.grid),g=Z.invert(Z(),y),[x,S,I]=u.dimensions,v=new Uint8Array(s*l*4),A=new Uint8Array(s*l*4),_=new Float32Array(s*l),T=b(),w=As(b(),b()),D=Xn.makeGetTrilinearlyInterpolated(e.grid,"none"),M=0;for(let U=0;U<l;++U)for(let Q=0;Q<s;++Q){let O=Br(Q+.5,0,s-1)/s-.5,q=Br(U+.5,0,l-1)/l-.5;b.set(f,q,-O,0),b.transformMat4(f,f,a),b.copy(T,f),b.transformMat4(T,T,g);let X=Math.trunc(T[0]),F=Math.trunc(T[1]),Y=Math.trunc(T[2]);b.copy(w.position,f);let $=h(w,!1);Fe.toArray($,v,M);let ce=Qp(D(f),m,d);p&&(v[M]*=ce,v[M+1]*=ce,v[M+2]*=ce),_[M/4]=ce,X>=0&&X<x&&F>=0&&F<S&&Y>=0&&Y<I&&df(u.dataOffset(X,F,Y),A,M),M+=4}let E={width:s,height:l,array:v,flipY:!0},R={width:s,height:l,array:A,flipY:!0},k={width:s,height:l,array:_,flipY:!0},B=new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]);Pc(a,B,0,4);let L=Br(Qp(Ve.IsoValue.toAbsolute(n,c).absoluteValue,m,d),0,1),V=hu.create(E,B,R,k,o,L,i);return V.setBoundingSphere(Ve.getBoundingSphere(e)),V}async function _mt(e,t,r,n,o,i){let{offset:a,isoValue:s}=o,{size:l,major:u,minor:c,normal:m,center:d,trim:p,resolution:h}=Pmt(t,o),f=1/h,y=b.create(l[0],l[1],1),g=b.setMagnitude(b(),m,l[2]/2),x=Math.floor(l[1]*f),S=Math.floor(l[0]*f),I=Z.identity(),v=b(),A=b();return b.add(v,d,u),Z.targetTo(I,d,v,c),b.scaleAndAdd(A,d,g,a),Z.setTranslation(I,A),Z.mul(I,I,Z.rotY90),Z.scale(I,I,y),ZPe(t,n,{m:I,width:x,height:S},s,p,i)}async function Rmt(e,t,r,n,o,i){let{plane:{point:a,normal:s},isoValue:l}=o,u=Z.fromPlane(Z(),s,a),c=Xn.getGridToCartesianTransform(t.grid),m=Z.invert(Z(),c),[d,p,h]=t.grid.cells.space.dimensions,f=d-1,y=p-1,g=h-1,S=1/(Math.max(f,y,g)/Math.max(d,p,h)),I=b.distance(b.create(0,0,0),b.create(f,y,g))*Math.SQRT2,v=b.set(b(),I,I,I);Z.mul(u,u,Z.rotY90),Z.scale(u,u,v);let A=Math.floor(v[1]*S),_=Math.floor(v[0]*S),T={type:3,center:b.create(f/2,y/2,g/2),scale:b.create(f,y,g),rotation:Tr.identity(),transform:m};return ZPe(t,n,{m:u,width:A,height:_},l,T,i)}async function Dmt(e,t,r,n,o,i){let{dimension:{name:a},isoValue:s}=o,{cells:{space:l,data:u},stats:c}=t.grid,{min:m,max:d}=c,p=n.color.granularity==="uniform",h="color"in n.color&&n.color.color?n.color.color:()=>16777215,{width:f,height:y,x:g,y:x,z:S,x0:I,y0:v,z0:A,nx:_,ny:T,nz:w}=TQ(t.grid,o),D=new Float32Array(a==="x"||a==="relativeX"?[g,0,0,g,x,0,g,0,S,g,x,S]:a==="y"||a==="relativeY"?[0,x,0,g,x,0,0,x,S,g,x,S]:[0,0,S,0,x,S,g,0,S,g,x,S]),M=new Uint8Array(f*y*4),E=wmt(t.grid,o),R=new Float32Array(f*y),k=Xn.getGridToCartesianTransform(t.grid),B=As(b(),b()),L=0;for(let Y=v;Y<T;++Y)for(let $=I;$<_;++$)for(let ce=A;ce<w;++ce){b.set(B.position,$,Y,ce),b.transformMat4(B.position,B.position,k),Fe.toArray(h(B,!1),M,L);let ie=Qp(l.get(u,$,Y,ce),m,d);p&&(M[L]*=ie,M[L+1]*=ie,M[L+2]*=ie),R[L/4]=ie,L+=4}let V={width:f,height:y,array:M,flipY:!0},U={width:f,height:y,array:E,flipY:!0},Q={width:f,height:y,array:R,flipY:!0},O=Xn.getGridToCartesianTransform(t.grid);Pc(O,D,0,4);let q=hu.createEmptyTrim(),X=Br(Qp(Ve.IsoValue.toAbsolute(s,c).absoluteValue,m,d),0,1),F=hu.create(V,D,U,Q,q,X,i);return F.setBoundingSphere(Ve.getBoundingSphere(t)),F}function IQ(e,t){return Br(Math.round((e-1)*t),0,e-1)}function TQ(e,t){let{dimension:{name:r,params:n}}=t,{space:o}=e.cells,i,a,s,l,u,c=0,m=0,d=0,[p,h,f]=o.dimensions;return r==="x"?(s=n,l=h-1,u=f-1,i=f,a=h,c=s,p=c+1):r==="y"?(s=p-1,l=n,u=f-1,i=f,a=p,m=l,h=m+1):r==="z"?(s=p-1,l=h-1,u=n,i=p,a=h,d=u,f=d+1):r==="relativeX"?(s=IQ(p,n),l=h-1,u=f-1,i=f,a=h,c=s,p=c+1):r==="relativeY"?(s=p-1,l=IQ(h,n),u=f-1,i=f,a=p,m=l,h=m+1):(s=p-1,l=h-1,u=IQ(f,n),i=p,a=h,d=u,f=d+1),{width:i,height:a,x:s,y:l,z:u,x0:c,y0:m,z0:d,nx:p,ny:h,nz:f}}function wmt(e,t){let{space:r}=e.cells,{width:n,height:o,x0:i,y0:a,z0:s,nx:l,ny:u,nz:c}=TQ(e,t),m=new Uint8Array(n*o*4),d=0;for(let p=a;p<u;++p)for(let h=i;h<l;++h)for(let f=s;f<c;++f)df(r.dataOffset(h,p,f),m,d),d+=4;return m}function Emt(e,t){let{space:r}=e.cells,{width:n,height:o,x0:i,y0:a,z0:s,nx:l,ny:u,nz:c}=TQ(e,t),m=new Uint32Array(n*o),d=0;for(let p=a;p<u;++p)for(let h=i;h<l;++h)for(let f=s;f<c;++f)m[d]=r.dataOffset(h,p,f),d+=1;return m}function qPe(e,t,r){if(r.mode==="grid"){let n=Emt(e.grid,r),o=Be.ofUnsortedArray(n);return Ve.Cell.Loci(e,[{indices:o,instances:t}])}else return Ve.Loci(e,t)}function Mmt(e,t){let r=xe.ofLength(e.instances.length);return qPe(e,r,t)}function Bmt(e,t,r,n,o){let{objectId:i,groupId:a,instanceId:s}=e;if(o===i){let l=Ve.PickingGranularity.get(t),u=Se.ofSingleton(s);if(l==="volume")return Ve.Loci(t,u);if(l==="object")return qPe(t,u,n);{let c=xe.ofSingleton(a);return Ve.Cell.Loci(t,[{indices:c,instances:u}])}}return dr}function kmt(e,t,r,n,o){return Nh(e,t,void 0,o)}function Lmt(e){return Uc({defaultProps:C.getDefaultValues(AQ),createGeometry:Tmt,createLocationIterator:lp,getLoci:Bmt,eachLocation:kmt,setUpdateState:(t,r,n,o,i,a)=>{t.createGeometry=n.dimension.name!==o.dimension.name||n.dimension.params!==o.dimension.params||n.mode!==o.mode||!b.equals(n.rotation.axis,o.rotation.axis)||n.rotation.angle!==o.rotation.angle||n.offset!==o.offset||n.axis!==o.axis||!b.equals(n.plane.point,o.plane.point)||!b.equals(n.plane.normal,o.plane.normal)||!Ve.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||!as.areEqual(i.color,a.color)},geometryUtils:hu.Utils},e)}function Fmt(e,t){return bp("Slice",e,t,Lmt,Mmt)}var YPe={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:Fmt,getParams:Amt,defaultValues:C.getDefaultValues(AQ),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!Ve.isEmpty(e)&&!Ve.Segmentation.get(e)};function KPe(e,t){let r=ut();return ut.add(r,e),ut.transform(r,r,t),r}function Vmt(e,t,r,n,o){let i=r.grid.cells.space.dimensions,{width:a,height:s}=up(i);if(Math.max(a,s)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");let l=n.dataType==="halfFloat"&&!t.extensions.textureHalfFloat?"float":n.dataType,u=Ek(r,"normals",0,l),c=Xn.getGridToCartesianTransform(r.grid),m=KPe(i,c),d;o&&o.dataType.ref.value===l?d=o.gridTexture.ref.value:d=l==="byte"?t.resources.texture("image-uint8","rgba","ubyte","linear"):l==="halfFloat"?t.resources.texture("image-float16","rgba","fp16","linear"):t.resources.texture("image-float32","rgba","float","linear"),d.load(u);let{unitToCartn:p,cellDim:h}=JPe(r.grid),f=r.grid.cells.space.axisOrderSlowToFast;return Bl.create(m,i,c,p,h,d,r.grid.stats,!1,f,l,o)}function JPe(e){if(e.transform.kind==="matrix")return{unitToCartn:Z.mul(Z(),e.transform.matrix,Z.fromScaling(Z(),e.cells.space.dimensions)),cellDim:Z.getScaling(b(),e.transform.matrix)};let t=e.transform.fractionalBox,r=ut.size(b(),t);return{unitToCartn:Z.mul3(Z(),e.transform.cell.fromFractional,Z.fromTranslation(Z(),t.min),Z.fromScaling(Z(),r)),cellDim:b.div(b(),e.transform.cell.size,e.cells.space.dimensions)}}function Omt(e,t,r,n,o){let i=r.grid.cells.space.dimensions;if(Math.max(...i)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");let a=n.dataType==="halfFloat"&&!t.extensions.textureHalfFloat?"float":n.dataType,s=zxe(r,a),l=Xn.getGridToCartesianTransform(r.grid),u=KPe(i,l),c;o&&o.dataType.ref.value===a?c=o.gridTexture.ref.value:c=a==="byte"?t.resources.texture("volume-uint8","rgba","ubyte","linear"):a==="halfFloat"?t.resources.texture("volume-float16","rgba","fp16","linear"):t.resources.texture("volume-float32","rgba","float","linear"),c.load(s);let{unitToCartn:m,cellDim:d}=JPe(r.grid),p=r.grid.cells.space.axisOrderSlowToFast;return Bl.create(u,i,l,m,d,c,r.grid.stats,!1,p,a,o)}async function Gmt(e,t,r,n,o,i){let{runtime:a,webgl:s}=e;if(s===void 0)throw new Error("DirectVolumeVisual requires `webgl` in VisualContext");return s.isWebGL2?Omt(a,s,t,o,i):Vmt(a,s,t,o,i)}function Umt(e,t){let r=xe.ofLength(e.instances.length);return Ve.Loci(e,r)}function Nmt(e,t,r,n,o){let{objectId:i,groupId:a,instanceId:s}=e;if(o===i){let l=Se.ofSingleton(s),u=xe.ofSingleton(a);return Ve.Cell.Loci(t,[{indices:u,instances:l}])}return dr}function zmt(e,t,r,n,o){return Nh(e,t,void 0,o)}var PQ={...Bl.Params,quality:{...Bl.Params.quality,isEssential:!1},dataType:C.Select("byte",C.arrayToOptions(["byte","float","halfFloat"]))};function Hmt(e,t){let r=C.clone(PQ);return r.controlPoints.getVolume=()=>t,r}function jmt(e){return Uc({defaultProps:C.getDefaultValues(PQ),createGeometry:Gmt,createLocationIterator:lp,getLoci:Nmt,eachLocation:zmt,setUpdateState:(t,r,n,o)=>{t.createGeometry=n.dataType!==o.dataType},geometryUtils:Bl.Utils,dispose:t=>{t.gridTexture.ref.value.destroy()}},e)}function Wmt(e,t){return bp("Direct Volume",e,t,jmt,Umt)}var $Pe={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:Wmt,getParams:Hmt,defaultValues:C.getDefaultValues(PQ),defaultColorTheme:{name:"volume-value"},defaultSizeTheme:{name:"uniform"},locationKinds:["position-location","direct-location"],isApplicable:e=>!Ve.isEmpty(e)&&!Ve.Segmentation.get(e)};var Xmt={segments:C.Converted(e=>e.map(t=>`${t}`),e=>e.map(t=>parseInt(t)),C.MultiSelect(["0"],C.arrayToOptions(["0"]),{isEssential:!0}))};function Qmt(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var LR=1;function RQ(e,t){if(e.grid.cells.data.length<Math.pow(10,3))return!1;let r=e.grid.cells.space.dimensions,{powerOfTwoSize:n}=up(r,LR);return n<=t.maxTextureSize/2}var Zmt=Z();function e2e(e,t){let r=Xn.getGridToCartesianTransform(e),n=Z.fromTranslation(Zmt,t.min);return Z.mul(Z(),r,n)}function qmt(e,t,r,n,o){return n.tryUseGpu&&o&&Qmt(o)&&RQ(t,o)?rdt(e):$mt(e)}function Ymt(e,t){let r=Be.ofUnsortedArray(t.segments),n=xe.ofLength(e.instances.length);return Ve.Segment.Loci(e,[{segments:r,instances:n}])}function t2e(e,t,r,n,o){let{objectId:i,groupId:a,instanceId:s}=e;if(o===i){let l=Ve.PickingGranularity.get(t),u=Se.ofSingleton(s);if(l==="volume")return Ve.Loci(t,u);if(l==="object"){let c=Se.ofSingleton(r);return Ve.Segment.Loci(t,[{segments:c,instances:u}])}else{let c=xe.ofSingleton(a);return Ve.Cell.Loci(t,[{indices:c,instances:u}])}}return dr}function r2e(e,t,r,n,o){let i=Be.ofSingleton(r);return Nh(e,t,{segments:i},o)}function Kmt(e,t,r){let n=r.data,o=r.space.dataOffset,i=ut.size(b(),t),[a,s,l]=i,u=a-1,c=s-1,m=l-1,[d,p,h]=t.min,[f,y,g]=t.max,x=[...r.space.axisOrderSlowToFast],S=xr.Space(i,x,Uint8Array),I=xr.create(S,S.create()),v=I.data,A=S.set;for(let _=0;_<l;++_)for(let T=0;T<s;++T)for(let w=0;w<a;++w){let D=e.includes(n[o(w+d,T+p,_+h)])?255:0,M=e.includes(n[o(Math.min(u+f,w+1+d),T+p,_+h)])?255:0,E=e.includes(n[o(Math.max(0,w-1+d),T+p,_+h)])?255:0,R=e.includes(n[o(w+d,Math.min(c+y,T+1+p),_+h)])?255:0,k=e.includes(n[o(w+d,Math.max(0,T-1+p),_+h)])?255:0,B=e.includes(n[o(w+d,T+p,Math.min(m+g,_+1+h))])?255:0,L=e.includes(n[o(w+d,T+p,Math.max(0,_-1+h))])?255:0;A(v,w,T,_,Math.round((D+D+M+E+R+k+B+L)/8))}return I}async function Jmt(e,t,r,n,o,i){let a=Ve.Segmentation.get(t);if(!a)throw new Error("missing volume segmentation");e.runtime.update({message:"Marching cubes..."});let s=ut.clone(a.bounds[r]);ut.expand(s,s,b.create(2,2,2));let l=Array.from(a.segments.get(r).values()),u=Kmt(l,s,t.grid.cells),c=_a(new Int32Array(u.data.length)),m=await sg({isoLevel:128,scalarField:u,idField:xr.create(u.space,xr.Data1(c))},i).runAsChild(e.runtime),d=e2e(t.grid,s);ft.transform(m,d),e.webgl&&!e.webgl.isWebGL2?(ft.uniformTriangleGroup(m,!1),P.updateIfChanged(m.varyingGroup,!1)):P.updateIfChanged(m.varyingGroup,!0);let p=xe.ofLength(t.instances.length),h=Se.ofSingleton(r);return m.setBoundingSphere(Ve.Segment.getBoundingSphere(t,[{segments:h,instances:p}])),m}var DQ={...ft.Params,...is.Params,...Xmt,quality:{...ft.Params.quality,isEssential:!1},tryUseGpu:C.Boolean(!0)};function $mt(e){return Uc({defaultProps:C.getDefaultValues(DQ),createGeometry:Jmt,createLocationIterator:(t,r)=>{let n=Ve.Segment.Location(t,r);return Kr(t.grid.cells.data.length,t.instances?t.instances.length:1,1,()=>n)},getLoci:t2e,eachLocation:r2e,setUpdateState:(t,r,n,o)=>{},geometryUtils:ft.Utils,mustRecreate:(t,r,n)=>r.tryUseGpu&&!!n&&RQ(t.volume,n)},e)}var _Q="segment-texture";function edt(e,t,r){let n=Ve.Segmentation.get(e);if(!n)throw new Error("missing volume segmentation");let{resources:o}=r,i=ut.clone(n.bounds[t]);ut.expand(i,i,b.create(2,2,2));let a=e2e(e.grid,i),s=ut.size(b(),i),{width:l,height:u,powerOfTwoSize:c}=up(s,LR),m=b.create(l,u,0),d=Ie.create(l/c,u/c);if(c>r.maxTextureSize/2)throw new Error("volume too large for gpu segment extraction");r.namedTextures[_Q]||(r.namedTextures[_Q]=o.texture("image-uint8","alpha","ubyte","linear"));let p=r.namedTextures[_Q];p.define(c,c);let h=Array.from(n.segments.get(t).values());return p.load(Hxe(e,h,i,LR),!0),s[0]+=LR,s[1]+=LR,{texture:p,transform:a,gridDimension:s,gridTexDim:m,gridTexScale:d}}async function tdt(e,t,r,n,o,i){if(!e.webgl)throw new Error("webgl context required to create volume segment texture-mesh");if(t.grid.cells.data.length<=1)return is.createEmpty(i);let{texture:a,gridDimension:s,gridTexDim:l,gridTexScale:u,transform:c}=edt(t,r,e.webgl),m=t.grid.cells.space.axisOrderSlowToFast,d=i?.doubleBuffer.get(),p=zS(e.webgl,a,s,l,u,c,.5,!1,!1,m,!0,d?.vertex,d?.group,d?.normal),h=t.grid.cells.data.length,f=xe.ofLength(t.instances.length),y=Se.ofSingleton(r),g=Ve.Segment.getBoundingSphere(t,[{segments:y,instances:f}]);return is.create(p.vertexCount,h,p.vertexTexture,p.groupTexture,p.normalTexture,g,i)}function rdt(e){return Uc({defaultProps:C.getDefaultValues(DQ),createGeometry:tdt,createLocationIterator:(t,r)=>{let n=Ve.Segment.Location(t,r);return Kr(t.grid.cells.data.length,t.instances?t.instances.length:1,1,()=>n)},getLoci:t2e,eachLocation:r2e,setUpdateState:(t,r,n,o)=>{},geometryUtils:is.Utils,mustRecreate:(t,r,n)=>!r.tryUseGpu||!n||!RQ(t.volume,n),dispose:t=>{t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}function ndt(e){return Be.ofUnsortedArray(e.segments)}var n2e={segment:(e,t)=>bp("Segment mesh",e,t,qmt,Ymt,ndt)},o2e={...DQ,visuals:C.MultiSelect(["segment"],C.objectToOptions(n2e)),bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},We.ShadingCategory)};function odt(e,t){let r=C.clone(o2e),n=Ve.Segmentation.get(t);if(n){let o=Array.from(n.segments.keys());r.segments=C.Converted(i=>i.map(a=>`${a}`),i=>i.map(a=>parseInt(a)),C.MultiSelect(o.map(i=>`${i}`),C.arrayToOptions(o.map(i=>`${i}`)),{isEssential:!0}))}return r}function idt(e,t){return Vt.createMulti("Segment",e,t,Vt.StateBuilder,n2e)}var i2e={name:"segment",label:"Segment",description:"Displays a triangulated segment of volumetric data.",factory:idt,getParams:odt,defaultValues:C.getDefaultValues(o2e),defaultColorTheme:{name:"volume-segment"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!Ve.isEmpty(e)&&!!Ve.Segmentation.get(e)};var adt=Qe.add3,sdt=Qe.add,NA;(t=>{function e(r=2048,n=1024,o){let i=Qe.create(Float32Array,3,n,o?o.centerBuffer.ref.value:r),a=Qe.create(Float32Array,1,n,o?o.groupBuffer.ref.value:r);return{add:(s,l,u,c)=>{adt(i,s,l,u),sdt(a,c)},getPoints:()=>{let s=Qe.compact(i,!0),l=Qe.compact(a,!0);return ml.create(s,l,i.elementCount,o)}}}t.create=e})(NA||={});var s2e={isoValue:Ve.IsoValueParam},wQ={...Ts.Params,...ft.Params,...s2e,tryUseImpostor:C.Boolean(!0),detail:C.Numeric(0,{min:0,max:3,step:1},We.CustomQualityParamInfo)};function ldt(e,t,r,n,o){return n.tryUseImpostor&&o&&o.extensions.fragDepth&&o.extensions.textureFloat?udt(e):cdt(e)}function udt(e){return Uc({defaultProps:C.getDefaultValues(wQ),createGeometry:mdt,createLocationIterator:lp,getLoci:EQ,eachLocation:MQ,setUpdateState:(t,r,n,o)=>{t.createGeometry=!Ve.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)},geometryUtils:Ts.Utils,mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function cdt(e){return Uc({defaultProps:C.getDefaultValues(wQ),createGeometry:ddt,createLocationIterator:lp,getLoci:EQ,eachLocation:MQ,setUpdateState:(t,r,n,o)=>{t.createGeometry=!Ve.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||n.sizeFactor!==o.sizeFactor||n.detail!==o.detail},geometryUtils:ft.Utils,mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}function mdt(e,t,r,n,o,i){let{cells:{space:a,data:s},stats:l}=t.grid,u=Xn.getGridToCartesianTransform(t.grid),c=Ve.IsoValue.toAbsolute(o.isoValue,l).absoluteValue,m=b(),[d,p,h]=a.dimensions,f=Math.ceil(d*p*h/10),y=jh.create(f,Math.ceil(f/2),i);for(let x=0;x<h;++x)for(let S=0;S<p;++S)for(let I=0;I<d;++I)a.get(s,I,S,x)<c||(b.set(m,I,S,x),b.transformMat4(m,m,u),y.add(m[0],m[1],m[2],a.dataOffset(I,S,x)));let g=y.getSpheres();return g.setBoundingSphere(Ve.Isosurface.getBoundingSphere(t,o.isoValue)),g}function ddt(e,t,r,n,o,i){let{detail:a,sizeFactor:s}=o,{cells:{space:l,data:u},stats:c}=t.grid,m=Xn.getGridToCartesianTransform(t.grid),d=Ve.IsoValue.toAbsolute(o.isoValue,c).absoluteValue,p=b(),[h,f,y]=l.dimensions,x=h*f*y/10*pm(a),S=et.createState(x,x/2,i),I=Ve.Cell.Location(t),v=n.size.size;for(let _=0;_<y;++_)for(let T=0;T<f;++T)for(let w=0;w<h;++w){if(l.get(u,w,T,_)<d)continue;b.set(p,w,T,_),b.transformMat4(p,p,m),S.currentGroup=l.dataOffset(w,T,_),I.cell=S.currentGroup;let D=v(I);Nr(S,p,D*s,a)}let A=et.getMesh(S);return A.setBoundingSphere(Ve.Isosurface.getBoundingSphere(t,o.isoValue)),A}var l2e={...ml.Params,...s2e};function pdt(e){return Uc({defaultProps:C.getDefaultValues(l2e),createGeometry:fdt,createLocationIterator:lp,getLoci:EQ,eachLocation:MQ,setUpdateState:(t,r,n,o)=>{t.createGeometry=!Ve.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)},geometryUtils:ml.Utils},e)}function fdt(e,t,r,n,o,i){let{cells:{space:a,data:s},stats:l}=t.grid,u=Xn.getGridToCartesianTransform(t.grid),c=Ve.IsoValue.toAbsolute(o.isoValue,l).absoluteValue,m=b(),[d,p,h]=a.dimensions,f=Math.ceil(d*p*h/10),y=NA.create(f,Math.ceil(f/2),i);for(let x=0;x<h;++x)for(let S=0;S<p;++S)for(let I=0;I<d;++I)a.get(s,I,S,x)<c||(b.set(m,I,S,x),b.transformMat4(m,m,u),y.add(m[0],m[1],m[2],a.dataOffset(I,S,x)));let g=y.getPoints();return g.setBoundingSphere(Ve.Isosurface.getBoundingSphere(t,o.isoValue)),g}function a2e(e,t){let r=xe.ofLength(e.instances.length);return Ve.Isosurface.Loci(e,t.isoValue,r)}function EQ(e,t,r,n,o){let{objectId:i,groupId:a,instanceId:s}=e;if(o===i){let l=Ve.PickingGranularity.get(t),u=Se.ofSingleton(s);if(l==="volume")return Ve.Loci(t,u);if(l==="object")return Ve.Isosurface.Loci(t,n.isoValue,u);{let c=xe.ofSingleton(a);return Ve.Cell.Loci(t,[{indices:c,instances:u}])}}return dr}function MQ(e,t,r,n,o){return Nh(e,t,{isoValue:n.isoValue},o)}var u2e={sphere:(e,t)=>bp("Dot sphere",e,t,ldt,a2e),point:(e,t)=>bp("Dot point",e,t,pdt,a2e)},c2e={...wQ,...l2e,visuals:C.MultiSelect(["sphere"],C.objectToOptions(u2e)),bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},We.ShadingCategory)};function hdt(e,t){let r=C.clone(c2e);return r.isoValue=Ve.createIsoValueParam(Ve.IsoValue.relative(2),t.grid.stats),r}function gdt(e,t){return Vt.createMulti("Dot",e,t,Vt.StateBuilder,u2e)}var m2e={name:"dot",label:"Dot",description:"Displays dots of volumetric data.",factory:gdt,getParams:hdt,defaultValues:C.getDefaultValues(c2e),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!Ve.isEmpty(e)&&!Ve.Segmentation.get(e)};var fC=class e extends OI{constructor(){super(),gi(e.BuiltIn,(t,r)=>{if(t.name!==r)throw new Error(`Fix BuiltInVolumeRepresentations to have matching names. ${t.name} ${r}`);this.add(t)})}};(t=>t.BuiltIn={"direct-volume":$Pe,dot:m2e,isosurface:QPe,segment:i2e,slice:YPe})(fC||={});function d2e(e,t,r,n){e.push({source:t==="em"?{name:"em",params:{isoValue:Ve.IsoValue.absolute(n||0)}}:{name:"x-ray",params:{}},dataId:r})}var FR=Ss.build({display:{name:"Volume Streaming"},from:re.Molecule.Structure,params(e,t){let r=bPe(e&&e.data),n=xPe(r,e&&e.data);return{method:C.Select(r,[["em","EM"],["x-ray","X-Ray"]]),entries:C.ObjectList({id:C.Text(n[0]||"")},({id:o})=>o,{defaultValue:n.map(o=>({id:o}))}),defaultView:C.Select(r==="em"?"auto":"selection-box",ps.ViewTypeOptions),options:C.Group({serverUrl:C.Text(t.config.get(Lr.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:C.Text("",{isHidden:!0}),emContourProvider:C.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:C.Value({},{isHidden:!0})})}},isApplicable:(e,t,r)=>{let n=r.config.get(Lr.VolumeStreaming.CanStream);return n?n(e.data,r):e.data.models.length===1&&Ft.probablyHasDensityMap(e.data.models[0])}})(({ref:e,state:t,params:r},n)=>Pe.create("Volume Streaming",async o=>{let i=[];for(let m=0,d=r.entries.length;m<d;++m){let p=r.entries[m].id.toLowerCase(),h;if(r.method==="em"){if(!p.toUpperCase().startsWith("EMD")){await o.update("Getting EMDB info...");let f=await CPe(n,o,p);for(let y=0,g=f.length;y<g;++y){let x=f[y],S;try{S=await hQ(r.options.emContourProvider,n,o,x)}catch(I){console.info(`Could not get map info for ${x}: ${I}`);continue}d2e(i,r.method,x,S||0)}continue}try{h=await hQ(r.options.emContourProvider,n,o,p)}catch(f){console.info(`Could not get map info for ${p}: ${f}`);continue}}d2e(i,r.method,p,h||0)}let a=t.build().to(e).applyOrUpdateTagged(ps.RootTag,bdt,{serverUrl:r.options.serverUrl,entries:i});await a.commit();let s=a.selector;if(!s.isOk)return;let l=t.tree.children.get(s.ref);l?.size>0&&await n.managers.structure.hierarchy.remove(l?.toArray());let u=s.cell.obj,c=t.build().to(a.ref).apply(VR,C.getDefaultValues(ps.createParams({data:u.data,defaultView:r.defaultView,channelParams:r.options.channelParams})),{ref:r.options.behaviorRef?r.options.behaviorRef:void 0});r.method==="em"?c.apply(oV,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(c.apply(oV,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),c.apply(oV,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),c.apply(oV,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),await t.updateTree(c).runInContext(o)})),f2e=Ss.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:ps,isApplicable:e=>e.data.params.entry.params.view.name==="selection-box"})(({a:e,ref:t,state:r},n)=>{let o=e.data.params;if(o.entry.params.view.name!=="selection-box")return;let i=ut.create(b.clone(o.entry.params.view.params.bottomLeft),b.clone(o.entry.params.view.params.topRight)),a=o.entry.params.view.params.radius;ut.expand(i,i,b.create(a,a,a));let s={...o,entry:{name:o.entry.name,params:{...o.entry.params,view:{name:"box",params:{bottomLeft:i.min,topRight:i.max}}}}};return r.updateTree(r.build().to(t).update(s))}),ydt={dataId:C.Text(""),source:C.MappedStatic("x-ray",{em:C.Group({isoValue:Ve.createIsoValueParam(Ve.IsoValue.relative(1))}),"x-ray":C.Group({})})};var bdt=Bt.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:re.Molecule.Structure,to:GA,params(e){return{serverUrl:C.Text("https://ds.litemol.org"),entries:C.ObjectList(ydt,({dataId:t})=>t,{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})}}})({apply:({a:e,params:t},r)=>Pe.create("",async n=>{let o=[];for(let a=0,s=t.entries.length;a<s;++a){let l=t.entries[a],u=l.dataId,c=l.source.name==="em"?l.source.params.isoValue:Ve.IsoValue.relative(1);await n.update("Getting server header...");let m=await r.fetch({url:nC(t.serverUrl,`${l.source.name}/${u.toLocaleLowerCase()}`),type:"json"}).runInContext(n);o.push({dataId:u,kind:l.source.name,header:m,emDefaultContourLevel:c})}let i={serverUrl:t.serverUrl,entries:o,structure:e.data};return new GA(i,{label:"Volume Server",description:`${o.map(a=>a.dataId).join(", ")}`})})});var VR=Bt.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:GA,to:ps,params(e){return ps.createParams({data:e&&e.data})}})({canAutoUpdate:({oldParams:e,newParams:t})=>e.entry.params.view===t.entry.params.view||t.entry.params.view.name==="selection-box"||t.entry.params.view.name==="camera-target"||t.entry.params.view.name==="off",apply:({a:e,params:t},r)=>Pe.create("Volume streaming",async n=>{let o=new ps.Behavior(r,e.data);return await o.update(t),new ps(o,{label:"Volume Streaming",description:o.getDescription()})}),update({a:e,b:t,oldParams:r,newParams:n}){return Pe.create("Update Volume Streaming",async o=>{if(r.entry.name!==n.entry.name&&"em"in n.entry.params.channels){let{emDefaultContourLevel:a}=t.data.infoMap.get(n.entry.name);a&&(n.entry.params.channels.em.isoValue=a)}let i=await t.data.update(n)?Je.UpdateResult.Updated:Je.UpdateResult.Unchanged;return t.description=t.data.getDescription(),i})}});var oV=Bt.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:ps,to:re.Volume.Representation3D,params:{channel:C.Select("em",ps.ChannelTypeOptions,{isHidden:!0})}})({apply:({a:e,params:t,spine:r},n)=>Pe.create("Volume Representation",async o=>{let i=e.data.channels[t.channel];if(!i)return An.Null;let a=p2e(e.data,t.channel),s=fC.BuiltIn.isosurface,l=a.type.params||{},u=s.factory({webgl:n.canvas3d?.webgl,...n.representation.volume.themes},s.getParams);u.setTheme(pi.create(n.representation.volume.themes,{volume:i.data},a));let c=r.getAncestorOfType(re.Molecule.Structure)?.data,m=c?.models.length===0?void 0:ly.get(c?.models[0]);return await u.createOrUpdate(l,i.data).runInContext(o),m&&u.setState({transform:m}),new re.Volume.Representation3D({repr:u,sourceData:i.data},{label:`${Math.round(i.isoValue.relativeValue*100)/100} \u03C3 [${t.channel}]`})}),update:({a:e,b:t,newParams:r,spine:n},o)=>Pe.create("Volume Representation",async i=>{let a=e.data.channels[r.channel];if(!a)return Je.UpdateResult.Unchanged;let s=t.data.repr.state.visible,l=p2e(e.data,r.channel),u={...t.data.repr.props,...l.type.params};return t.data.repr.setTheme(pi.create(o.representation.volume.themes,{volume:a.data},l)),await t.data.repr.createOrUpdate(u,a.data).runInContext(i),t.data.repr.setState({visible:s}),t.data.sourceData=a.data,Je.UpdateResult.Updated})});function p2e(e,t){let r=e.channels[t];return Cf.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:r.isoValue,alpha:r.opacity,visuals:r.wireframe?["wireframe"]:["solid"]},"uniform",{value:r.color})}var hC=class extends FA{constructor(){super(...arguments);this._getInfo=uu((r,n,o)=>Vf.infoFromAction(this.plugin,this.props.state,this.props.action,this.props.nodeRef));this.state={plugin:this.plugin,ref:this.props.nodeRef,version:this.props.state.transforms.get(this.props.nodeRef).version,error:void 0,isInitial:!0,params:this.getInfo().initialValues,busy:!1,isCollapsed:this.props.initiallyCollapsed}}applyAction(){return st.State.ApplyAction(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})}getInfo(){return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version,this.state?.isCollapsed)}getTransformerId(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id}getHeader(){return this.props.hideHeader?"none":this.props.action.definition.display}canApply(){return!this.state.error&&!this.state.busy}canAutoApply(){return!1}applyText(){return"Apply"}isUpdate(){return!1}getSourceAndTarget(){return{a:this.props.state.cells.get(this.props.nodeRef).obj}}static getDerivedStateFromProps(r,n){let o=r.state.transforms.get(r.nodeRef).version;if(r.nodeRef===n.ref&&o===n.version)return null;let i=r.state.cells.get(r.nodeRef).obj,a=r.action.definition.params?C.getDefaultValues(r.action.definition.params(i,n.plugin)):{};return{plugin:n.plugin,ref:r.nodeRef,version:o,params:a,isInitial:!0,error:void 0}}};var Zn=Rt(nr()),iV=class extends hc{defaultState(){return{header:"Volume Streaming",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"cyan",svg:bN}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>{this.setState({isHidden:!this.canEnable(),description:ig.getSelectedStructuresDescription(this.plugin)})}),this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{Ar.hasTag(t.cell.transform,ps.RootTag)&&this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})})}get pivot(){return this.plugin.managers.structure.hierarchy.selection.structures[0]}canEnable(){let{selection:t}=this.plugin.managers.structure.hierarchy;if(t.structures.length!==1)return!1;let r=this.pivot.cell;return r.obj?!!FR.definition.isApplicable?.(r.obj,r.transform,this.plugin):!1}renderEnable(){let t=this.pivot;if(!t.cell.parent)return null;let r=er.findTagInSubtree(t.cell.parent.tree,this.pivot.cell.transform.ref,ps.RootTag),n=r&&t.cell.parent.cells.get(r),o=n&&n.status==="error"?{header:n.errorText&&n.errorText?.includes("404")?"No Density Data Available":"Error Enabling",icon:CN,title:n.errorText}:n&&n.obj?.data.entries.length===0?{header:"Error Enabling",icon:CN,title:"No Entry for Streaming Found"}:{header:"Enable",icon:Lm,title:"Enable"};return(0,Zn.jsx)(hC,{state:t.cell.parent,action:FR,initiallyCollapsed:!0,nodeRef:t.cell.transform.ref,simpleApply:o})}renderParams(){let t=this.pivot;if(!t.cell.parent)return null;let r=t.volumeStreaming?.cell.transform.params?.entry.params.view.name==="selection-box"&&this.plugin.state.behaviors.cells.get(LS.id)?.params?.values?.bindings;return(0,Zn.jsxs)(Zn.Fragment,{children:[(0,Zn.jsx)($u,{state:t.cell.parent,transform:t.volumeStreaming.cell.transform,customHeader:"none",noMargin:!0}),r&&(0,Zn.jsx)(Ja,{header:"Controls Help",children:(0,Zn.jsx)(VA,{bindings:r})})]})}renderControls(){let t=this.pivot;return t?t.volumeStreaming?this.renderParams():this.renderEnable():null}},aV=class extends hc{constructor(){super(...arguments);this.item=r=>{let n=this.plugin.managers.volume.hierarchy.selection,o=r.cell.obj?.label||"Volume";return{kind:"item",label:(r.kind==="lazy-volume"?"Load ":"")+(o||r.kind),selected:n===r,value:r}};this.selectCurrent=r=>{if(this.toggleHierarchy(),!r)return;let n=r.value;n.kind==="volume"?this.plugin.managers.volume.hierarchy.setCurrent(n):this.lazyLoad(n.cell)};this.selectAdd=r=>{r&&(this.setState({show:void 0}),r.value())};this.toggleHierarchy=()=>this.setState({show:this.state.show!=="hierarchy"?"hierarchy":void 0});this.toggleAddRepr=()=>this.setState({show:this.state.show!=="add-repr"?"add-repr":void 0});this.toggleVisibility=()=>{let r=this.plugin.managers.volume.hierarchy,{current:n}=r,o=!n.volumes[0]?.representations[0]?.cell.state.isHidden;this.plugin.managers.volume.hierarchy.toggleVisibility(n.volumes.flatMap(i=>i.representations),o?"hide":"show")}}defaultState(){return{header:"Volume",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"purple",svg:bN}}}componentDidMount(){this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection,r=>{this.setState({isHidden:r.hierarchy.volumes.length===0&&r.hierarchy.lazyVolumes.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r})})}get hierarchyItems(){let r=this.plugin.managers.volume.hierarchy,{current:n}=r,o=[];for(let i of n.volumes)o.push(this.item(i));for(let i of n.lazyVolumes)o.push(this.item(i));return o}get addActions(){let r=this.plugin.managers.volume.hierarchy,n=r.selection;return[...uC.getRepresentationTypes(this.plugin,n).map(i=>br.Item(i[1],()=>r.addRepresentation(n,i[0])))]}get isEmpty(){let{volumes:r,lazyVolumes:n}=this.plugin.managers.volume.hierarchy.current;return r.length===0&&n.length===0}get label(){if(this.state.loadingLabel)return`Loading ${this.state.loadingLabel}...`;let r=this.plugin.managers.volume.hierarchy.selection;return r?r?.cell.obj?.label||"Volume":"Nothing Selected"}async lazyLoad(r){let{url:n,isBinary:o,format:i,entryId:a,isovalues:s}=r.obj.data;this.setState({isBusy:!0,loadingLabel:r.obj.label});try{let l=this.plugin;await l.dataTransaction(async()=>{let u=await l.builders.data.download({url:n,isBinary:o},{state:{isGhost:!0}}),c=await l.dataFormats.get(i).parse(l,u,{entryId:a}),m=c.volume||c.volumes[0];if(!m?.isOk)throw new Error("Failed to parse any volume.");let d=l.build();for(let p of s)d.to(c.volumes?.[p.volumeIndex??0]??c.volume).apply(Xe.Representation.VolumeRepresentation3D,Xy(this.plugin,m.data,{type:"isosurface",typeParams:{alpha:p.alpha??1,isoValue:p.type==="absolute"?{kind:"absolute",absoluteValue:p.value}:{kind:"relative",relativeValue:p.value}},color:"uniform",colorParams:{value:p.color}}));await d.commit(),await l.build().delete(r).commit()})}finally{this.setState({isBusy:!1,loadingLabel:void 0})}}renderControls(){let r=this.state.isBusy||this.isEmpty,n=this.label,o=this.plugin.managers.volume.hierarchy.selection,i=this.plugin.managers.volume.hierarchy,{current:a}=i;return(0,Zn.jsxs)(Zn.Fragment,{children:[(0,Zn.jsxs)("div",{className:"msp-flex-row",style:{marginTop:"1px"},children:[(0,Zn.jsx)(sr,{noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:r,title:n,children:n}),!this.isEmpty&&o&&(0,Zn.jsx)(or,{svg:Kp,onClick:this.toggleAddRepr,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="add-repr",disabled:r}),!this.isEmpty&&(0,Zn.jsx)(or,{svg:Jc,onClick:this.toggleVisibility,toggleState:!1,title:"Toggle visibility of all volumes.",disabled:r})]}),this.state.show==="hierarchy"&&(0,Zn.jsx)(br,{items:this.hierarchyItems,onSelect:this.selectCurrent}),this.state.show==="add-repr"&&(0,Zn.jsx)(br,{items:this.addActions,onSelect:this.selectAdd}),a.volumes.length>0&&(0,Zn.jsx)("div",{style:{marginTop:"6px"},children:a.volumes.map(s=>(0,Zn.jsx)(xdt,{volume:s},s.cell.transform.ref))})]})}};function xdt({volume:e}){return(0,Zn.jsxs)(Zn.Fragment,{children:[(0,Zn.jsx)("div",{className:"msp-control-group-header",style:{marginTop:"1px"},children:(0,Zn.jsx)("div",{children:(0,Zn.jsx)("b",{children:e.cell.obj?.label??"n/a"})})}),e.representations.map(t=>(0,Zn.jsx)(BQ,{volume:e,representation:t},t.cell.transform.ref))]})}var BQ=class extends ii{constructor(){super(...arguments);this.state={action:void 0};this.updateIsoValueEvent=new En;this.remove=()=>this.plugin.managers.volume.hierarchy.remove([this.props.representation],!0);this.toggleVisible=r=>{r.preventDefault(),r.currentTarget.blur(),this.plugin.managers.volume.hierarchy.toggleVisibility([this.props.representation])};this.toggleColor=()=>{this.setState({action:this.state.action==="select-color"?void 0:"select-color"})};this.toggleUpdate=()=>this.setState({action:this.state.action==="update"?void 0:"update"});this.highlight=r=>{r.preventDefault(),this.props.representation.cell.parent&&st.Interactivity.Object.Highlight(this.plugin,{state:this.props.representation.cell.parent,ref:this.props.representation.cell.transform.ref})};this.clearHighlight=r=>{r.preventDefault(),st.Interactivity.ClearHighlights(this.plugin)};this.focus=()=>{let r=this.props.representation,n=r.cell.obj?.data.repr.getAllLoci();r.cell.state.isHidden&&this.plugin.managers.volume.hierarchy.toggleVisibility([this.props.representation],"show"),n&&this.plugin.managers.camera.focusLoci(n,{extraRadius:1})};this.updateColor=({value:r})=>{let n=this.props.representation.cell.transform;return this.plugin.build().to(n.ref).update({...n.params,colorTheme:{name:"uniform",params:{value:r}}}).commit()};this.requestIsoValueUpdate=r=>{this.updateIsoValueEvent.next(r)};this.updateIsoValue=r=>{let n=this.props.representation.cell.transform;return this.plugin.build().to(n.ref).update({...n.params,type:{...n.params?.type,params:{...n.params?.type.params,isoValue:r.isoValue}}}).commit()};this.isoValueParams=uu((r,n)=>{let i=this.props.representation.cell.transform.params;if(i?.type.name==="isosurface")return{isoValue:Ve.createIsoValueParam(i.type.params.isoValue,this.props.volume.cell.obj?.data.grid?.stats)}})}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,r=>{rm.ObjectEvent.isCell(r,this.props.representation.cell)&&this.forceUpdate()}),this.subscribe(this.updateIsoValueEvent.pipe(Cu(100,void 0,{leading:!1,trailing:!0})),this.updateIsoValue)}get color(){let r=this.props.representation.cell;if(r.transform.params?.colorTheme.name==="uniform")return r.transform.params?.colorTheme.params.value}get isIsoSurface(){return this.props.representation.cell.transform.params?.type.name==="isosurface"}render(){let r=this.props.representation.cell,n=r.transform.params,o=this.color,i=this.isoValueParams(r.transform.ref,n?.type.name);return(0,Zn.jsxs)(Zn.Fragment,{children:[(0,Zn.jsxs)("div",{className:"msp-flex-row",children:[o!==void 0&&(0,Zn.jsx)(sr,{style:{backgroundColor:Fe.toStyle(o),minWidth:32,width:32},onClick:this.toggleColor}),(0,Zn.jsxs)(sr,{noOverflow:!0,className:"msp-control-button-label",title:`${r.obj?.label}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[r.obj?.label,(0,Zn.jsx)("small",{className:"msp-25-lower-contrast-text",style:{float:"right"},children:r.obj?.description})]}),(0,Zn.jsx)(or,{svg:r.state.isHidden?Fm:Jc,toggleState:!1,onClick:this.toggleVisible,title:`${r.state.isHidden?"Show":"Hide"} component`,small:!0,className:"msp-form-control",flex:!0}),(0,Zn.jsx)(or,{svg:Vs,onClick:this.remove,title:"Remove",small:!0}),(0,Zn.jsx)(or,{svg:Fd,onClick:this.toggleUpdate,title:"Actions",toggleState:this.state.action==="update"})]}),this.state.action==="update"&&!!r.parent&&(0,Zn.jsx)("div",{style:{marginBottom:"6px"},className:"msp-accent-offset",children:(0,Zn.jsxs)("div",{children:[!!i&&(0,Zn.jsx)("div",{style:{marginBottom:"1px"},children:(0,Zn.jsx)(Kn,{params:i,values:{isoValue:n?.type.params.isoValue},onChangeValues:this.requestIsoValueUpdate})}),(0,Zn.jsx)($u,{state:r.parent,transform:r.transform,customHeader:"none",noMargin:!0})]})}),this.state.action==="select-color"&&o!==void 0&&(0,Zn.jsx)("div",{style:{marginBottom:"6px",marginTop:1},className:"msp-accent-offset",children:(0,Zn.jsx)(Cl,{header:"Select Color",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleColor,topRightIcon:dc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,Zn.jsx)(MA,{param:Cdt,value:this.color,onChange:this.updateColor,name:"color",hideNameRow:!0})})})]})}},Cdt=C.Color(1184274);var sV;(r=>{function e(n){return{size:n,matrix:Dn.create(n,n),eigenValues:new Float64Array(n),D:new Float64Array(n),E:new Float64Array(n)}}r.createCache=e;function t(n){Sdt(n.size,n.matrix.data,n.eigenValues,n.D,n.E)}r.compute=t})(sV||={});function Sdt(e,t,r,n,o){for(let a=0;a<e;a++)o[a]=0;let i=e-1;for(let a=0;a<e;a++)n[a]=t[a*e+i];vdt(t,n,o,e),Idt(t,n,o,e);for(let a=0;a<e;a++)r[a]=n[a]}function vdt(e,t,r,n){for(let o=n-1;o>0;o--){let i=0,a=0;for(let s=0;s<o;s++)i=i+Math.abs(t[s]);if(i===0){r[o]=t[o-1];for(let s=0;s<o;s++)t[s]=e[s*n+o-1],e[s*n+o]=0,e[o*n+s]=0}else{for(let c=0;c<o;c++)t[c]/=i,a+=t[c]*t[c];let s=t[o-1],l=Math.sqrt(a);s>0&&(l=-l),r[o]=i*l,a=a-s*l,t[o-1]=s-l;for(let c=0;c<o;c++)r[c]=0;for(let c=0;c<o;c++){s=t[c],e[o*n+c]=s,l=r[c]+e[c*n+c]*s;for(let m=c+1;m<=o-1;m++)l+=e[c*n+m]*t[m],r[m]+=e[c*n+m]*s;r[c]=l}s=0;for(let c=0;c<o;c++)r[c]/=a,s+=r[c]*t[c];let u=s/(a+a);for(let c=0;c<o;c++)r[c]-=u*t[c];for(let c=0;c<o;c++){s=t[c],l=r[c];for(let m=c;m<=o-1;m++)e[c*n+m]-=s*r[m]+l*t[m];t[c]=e[c*n+o-1],e[c*n+o]=0}}t[o]=a}for(let o=0;o<n-1;o++){e[o*n+n-1]=e[o*n+o],e[o*n+o]=1;let i=t[o+1];if(i!==0){for(let a=0;a<=o;a++)t[a]=e[(o+1)*n+a]/i;for(let a=0;a<=o;a++){let s=0;for(let l=0;l<=o;l++)s+=e[(o+1)*n+l]*e[a*n+l];for(let l=0;l<=o;l++)e[a*n+l]-=s*t[l]}}for(let a=0;a<=o;a++)e[(o+1)*n+a]=0}for(let o=0;o<n;o++)t[o]=e[o*n+n-1],e[o*n+n-1]=0;e[n*n-1]=1,r[0]=0}function Idt(e,t,r,n){for(let l=1;l<n;l++)r[l-1]=r[l];r[n-1]=0;let i=0,a=0,s=Math.pow(2,-53);for(let l=0;l<n;l++){a=Math.max(a,Math.abs(t[l])+Math.abs(r[l]));let u=l;for(;u<n&&!(Math.abs(r[u])<=s*a);)u++;if(u>l){let c=0;do{c=c+1;let m=t[l],d=(t[l+1]-m)/(2*r[l]),p=h2e(d,1);d<0&&(p=-p),t[l]=r[l]/(d+p),t[l+1]=r[l]*(d+p);let h=t[l+1],f=m-t[l];for(let A=l+2;A<n;A++)t[A]-=f;i=i+f,d=t[u];let y=1,g=y,x=y,S=r[l+1],I=0,v=0;for(let A=u-1;A>=l;A--){x=g,g=y,v=I,m=y*r[A],f=y*d,p=h2e(d,r[A]),r[A+1]=I*p,I=r[A]/p,y=d/p,d=y*t[A]-I*m,t[A+1]=f+I*(y*m+I*t[A]);for(let _=0;_<n;_++)f=e[(A+1)*n+_],e[(A+1)*n+_]=I*e[A*n+_]+y*f,e[A*n+_]=y*e[A*n+_]-I*f}if(d=-I*v*x*S*r[l]/h,r[l]=I*d,t[l]=y*d,c>=1e3)throw new Error("SVD: Not converging.")}while(Math.abs(r[l])>s*a)}t[l]=t[l]+i,r[l]=0}for(let l=0;l<n-1;l++){let u=l,c=t[l];for(let m=l+1;m<n;m++)t[m]<c&&(u=m,c=t[m]);if(u!==l){t[u]=t[l],t[l]=c;for(let m=0;m<n;m++)c=e[l*n+m],e[l*n+m]=e[u*n+m],e[u*n+m]=c}}}function h2e(e,t){if(Math.abs(e)>Math.abs(t)){let r=t/e;return Math.abs(e)*Math.sqrt(1+r*r)}if(t!==0){let r=e/t;return Math.abs(t)*Math.sqrt(1+r*r)}return 0}var lg;(r=>{let e;(o=>{function n(i){return{x:new Float64Array(i),y:new Float64Array(i),z:new Float64Array(i)}}o.empty=n})(e=r.Positions||={});function t(n,o){return typeof o>"u"&&(o={bTransform:Z.zero(),rmsd:0}),Pdt(new kQ(n,o)),o}r.compute=t})(lg||={});var kQ=class{constructor(t,r){this.evdCache=sV.createCache(4);this.translateB=Z.identity();this.rotateB=Z.identity();this.tempMatrix=Z.identity();this.a=t.a,this.b=t.b,t.centerA?this.centerA=t.centerA:this.centerA=t.centerA=cu.fromArrays(t.a,ye()).center,t.centerB?this.centerB=t.centerB:this.centerB=t.centerB=cu.fromArrays(t.b,ye()).center,this.result=r}};function Adt(e){let t=e.evdCache.matrix;Dn.makeZero(t);let r=e.a.x,n=e.a.y,o=e.a.z,i=e.b.x,a=e.b.y,s=e.b.z,l=e.centerA,u=e.centerB,c=0,m=Math.min(e.a.x.length,e.b.x.length);for(let d=0;d<m;d++){let p=r[d]-l[0],h=n[d]-l[1],f=o[d]-l[2],y=i[d]-u[0],g=a[d]-u[1],x=s[d]-u[2];c+=p*p+h*h+f*f+y*y+g*g+x*x,Dn.add(t,0,0,p*y+h*g+f*x),Dn.add(t,0,1,-(f*g)+h*x),Dn.add(t,0,2,f*y-p*x),Dn.add(t,0,3,-(h*y)+p*g),Dn.add(t,1,0,-(f*g)+h*x),Dn.add(t,1,1,p*y-h*g-f*x),Dn.add(t,1,2,h*y+p*g),Dn.add(t,1,3,f*y+p*x),Dn.add(t,2,0,f*y-p*x),Dn.add(t,2,1,h*y+p*g),Dn.add(t,2,2,-(p*y)+h*g-f*x),Dn.add(t,2,3,f*g+h*x),Dn.add(t,3,0,-(h*y)+p*g),Dn.add(t,3,1,f*y+p*x),Dn.add(t,3,2,f*g+h*x),Dn.add(t,3,3,-(p*y)-h*g+f*x)}return c}function Tdt(e){let t=e.evdCache.matrix,r=Dn.get(t,1,3),n=Dn.get(t,2,3),o=Dn.get(t,3,3),i=Dn.get(t,0,3),a=2*n*n,s=2*o*o,l=2*r*r,u=2*r*n,c=2*i*o,m=2*r*o,d=2*i*n,p=2*n*o,h=2*i*r,f=e.translateB;Z.setValue(f,0,3,-e.centerB[0]),Z.setValue(f,1,3,-e.centerB[1]),Z.setValue(f,2,3,-e.centerB[2]),f=e.rotateB,Z.setValue(f,0,0,1-a-s),Z.setValue(f,0,1,u+c),Z.setValue(f,0,2,m-d),Z.setValue(f,1,0,u-c),Z.setValue(f,1,1,1-l-s),Z.setValue(f,1,2,p+h),Z.setValue(f,2,0,m+d),Z.setValue(f,2,1,p-h),Z.setValue(f,2,2,1-l-a),Z.setValue(f,3,3,1),Z.mul(e.tempMatrix,e.rotateB,e.translateB),f=e.translateB,Z.setValue(f,0,3,e.centerA[0]),Z.setValue(f,1,3,e.centerA[1]),Z.setValue(f,2,3,e.centerA[2]),Z.mul(e.result.bTransform,e.translateB,e.tempMatrix)}function Pdt(e){let t=Adt(e);sV.compute(e.evdCache);let r=t-2*e.evdCache.eigenValues[3];r=r<0?0:Math.sqrt(r/e.a.x.length),Tdt(e),e.result.rmsd=r}var _dt="ACDEFGHIKLMNPQRSTVWY",Rdt="ARNDCQEGHILKMFPSTWYVBZX",Ddt=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]],wdt=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]];function g2e(e,t){let r,n=0,o={};return t.forEach(i=>{r=0;let a={};i.forEach(s=>a[e[r++]]=s),o[e[n++]]=a}),o}var y2e={blosum62:g2e(Rdt,wdt),blosum62x:g2e(_dt,Ddt)};var Edt={gapPenalty:-11,gapExtensionPenalty:-1,substMatrix:"default"};function b2e(e,t,r={}){let n={...Edt,...r},o=new LQ(e,t,n);return o.calculate(),o.trace()}var LQ=class{constructor(t,r,n){this.seqA=t;this.seqB=r;this.S=[];this.V=[];this.H=[];this.gapPenalty=n.gapPenalty,this.gapExtensionPenalty=n.gapExtensionPenalty,this.substMatrix=n.substMatrix==="default"?void 0:y2e[n.substMatrix],this.n=this.seqA.length,this.m=this.seqB.length}initMatrices(){let{n:t,m:r,gapPenalty:n,S:o,V:i,H:a}=this;for(let s=0;s<=t;++s){o[s]=[],i[s]=[],a[s]=[];for(let l=0;l<=r;++l)o[s][l]=0,i[s][l]=0,a[s][l]=0}for(let s=0;s<=t;++s)o[s][0]=n,a[s][0]=-1/0;for(let s=0;s<=r;++s)o[0][s]=n,i[0][s]=-1/0;o[0][0]=0}makeScoreFn(){let{seqA:t,seqB:r,substMatrix:n}=this;return n?function(i,a){let s=t[i],l=r[a];return n[s]?.[l]??-4}:function(i,a){let s=t[i],l=r[a];return s===l?5:-3}}calculate(){this.initMatrices();let t=this.makeScoreFn(),{V:r,H:n,S:o,n:i,m:a,gapExtensionPenalty:s,gapPenalty:l}=this,u,c,m,d,p;for(let h=1;h<=i;++h){c=o[h-1],u=r[h-1],m=r[h],d=n[h],p=o[h];for(let f=1;f<=a;++f)m[f]=Math.max(c[f]+l,u[f]+s),d[f]=Math.max(p[f-1]+l,d[f-1]+s),p[f]=Math.max(c[f-1]+t(h-1,f-1),m[f],d[f])}}trace(){let t=this.makeScoreFn(),{V:r,H:n,S:o,seqA:i,seqB:a,gapExtensionPenalty:s,gapPenalty:l}=this,u=this.n,c=this.m,m,d,p="",h="";for(o[u][c]>=r[u][c]?(m="S",d=o[u][c]):r[u][c]>=n[u][c]?(m="V",d=r[u][c]):(m="H",d=n[u][c]);u>0&&c>0;)m==="S"?o[u][c]===o[u-1][c-1]+t(u-1,c-1)?(p=i[u-1]+p,h=a[c-1]+h,--u,--c,m="S"):o[u][c]===r[u][c]?m="V":o[u][c]===n[u][c]?m="H":(--u,--c):m==="V"?r[u][c]===r[u-1][c]+s?(p=i[u-1]+p,h="-"+h,--u,m="V"):r[u][c]===o[u-1][c]+l?(p=i[u-1]+p,h="-"+h,--u,m="S"):--u:m==="H"&&(n[u][c]===n[u][c-1]+s?(p="-"+p,h=a[c-1]+h,--c,m="H"):n[u][c]===o[u][c-1]+l?(p="-"+p,h=a[c-1]+h,--c,m="S"):--c);for(;u>0;)p=i[u-1]+p,h="-"+h,--u;for(;c>0;)p="-"+p,h=a[c-1]+h,--c;return{aliA:p,aliB:h,score:d}}};var FQ;(r=>{function e(n){let o=new Map;if(me.isAtomic(n.unit)){let{label_seq_id:i}=n.unit.model.atomicHierarchy.residues,{residueIndex:a}=n.unit;for(let s=0,l=Se.size(n.indices);s<l;++s){let u=Se.getAt(n.indices,s),c=n.unit.elements[u],m=i.value(a[c]);o.has(m)?o.get(m).push(u):o.set(m,[u])}}else if(me.isCoarse(n.unit)){let{seq_id_begin:i}=me.isSpheres(n.unit)?n.unit.model.coarseHierarchy.spheres:n.unit.model.coarseHierarchy.gaussians;for(let a=0,s=Se.size(n.indices);a<s;++a){let l=Se.getAt(n.indices,a),u=n.unit.elements[l],c=i.value(u);o.set(c,[l])}}return o}r.createSeqIdIndicesMap=e;function t(n,o={}){let i=x2e(n.a.unit),a=x2e(n.b.unit),s=e(n.a),l=e(n.b),u=[],c=[],{aliA:m,aliB:d,score:p}=b2e(i.code.toArray(),a.code.toArray(),o),h=0,f=0;for(let x=0,S=m.length;x<S;++x){if(m[x]==="-"||d[x]==="-"){m[x]!=="-"&&(h+=1),d[x]!=="-"&&(f+=1);continue}let I=i.seqId.value(h),v=a.seqId.value(f);if(s.has(I)&&l.has(v)){let A=s.get(I),_=l.get(v);for(let T=0,w=Math.min(A.length,_.length);T<w;++T)u.push(A[T]),c.push(_[T])}h+=1,f+=1}let y=Se.intersect(Se.ofSortedArray(u),n.a.indices),g=Se.intersect(Se.ofSortedArray(c),n.b.indices);return{a:{unit:n.a.unit,indices:y},b:{unit:n.b.unit,indices:g},score:p}}r.compute=t})(FQ||={});function Mdt(e){switch(e.kind){case me.Kind.Atomic:return e.model.atomicHierarchy.index.getEntityFromChain(e.chainIndex[e.elements[0]]);case me.Kind.Spheres:return e.model.coarseHierarchy.spheres.entityKey[e.elements[0]];case me.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.entityKey[e.elements[0]]}}function x2e(e){return e.model.sequence.byEntityKey[Mdt(e)].sequence}function VQ(e){let t=[];if(e.length<=0)return t;let r=kdt(e),n={a:OR(e[0],r),b:OR(e[1],r)};t[0]=lg.compute(n);for(let o=2;o<e.length;o++)n.b=OR(e[o],r),n.centerB=void 0,t.push(lg.compute(n));return t}var Bdt=/(polypeptide|cyclic-pseudo-peptide)/i;function C2e(e){let t=[];if(e.length<=0)return t;let r=K.Loci.getFirstLocation(e[0]),o=qe.entity.subtype(r).match(Bdt)?"blosum62":"default";for(let i=1;i<e.length;i++){let{a,b:s,score:l}=FQ.compute({a:e[0].elements[0],b:e[i].elements[0]},{substMatrix:o}),u=K.Loci(e[0].structure,[a]),c=K.Loci(e[i].structure,[s]),m=Se.size(a.indices);t.push({...lg.compute({a:OR(u,m),b:OR(c,m)}),alignmentScore:l})}return t}function OR(e,t){let r=lg.Positions.empty(t),n=0;for(let o of e.elements){let{unit:i,indices:a}=o,{elements:s,conformation:l}=i;for(let u=0,c=Se.size(a);u<c;u++){let m=s[Se.getAt(a,u)];if(r.x[n]=l.x(m),r.y[n]=l.y(m),r.z[n]=l.z(m),n++,n>=t)break}if(n>=t)break}return r}function kdt(e){if(e.length===0)return 0;let t=K.Loci.size(e[0]);for(let r=1;r<e.length;r++){let n=K.Loci.size(e[r]);n<t&&(t=n)}return t}function S2e(e,t){let r=new Map;for(let l=0;l<e.length;l++)Odt(e[l],r,l,t?.traceOnly??!0,t?.includeResidueTest??Vdt);let n=Array.from(r.values()),o=Fdt(e.length,n),i=[],a=[],s=[];for(let l of o)if(l.count===0)i.push([l.i,l.j]);else{let[u,c]=Ldt(n,l.i,l.j,l.count),m=lg.compute({a:u,b:c});Number.isNaN(m.rmsd)?a.push([l.i,l.j]):s.push({transform:m,pivot:l.i,other:l.j})}return{entries:s,zeroOverlapPairs:i,failedPairs:a}}function Ldt(e,t,r,n){let o=lg.Positions.empty(n),i=lg.Positions.empty(n),a=0;for(let{pivots:s}of e){let l=s[t],u=s[r];if(!l||!u)continue;let c=Math.min(l[2]-l[1],u[2]-u[1]);for(let m=0;m<c;m++){let d=l[1]+m;o.x[a]=l[0].conformation.x(d),o.y[a]=l[0].conformation.y(d),o.z[a]=l[0].conformation.z(d),d=u[1]+m,i.x[a]=u[0].conformation.x(d),i.y[a]=u[0].conformation.y(d),i.z[a]=u[0].conformation.z(d),a++}}return[o,i]}function Fdt(e,t){let r=[];for(let o=0;o<e;o++){r[o]=[];for(let i=0;i<e;i++)r[o][i]=0}for(let{pivots:o}of t)for(let i=0;i<e;i++){if(!o[i])continue;let a=o[i][2]-o[i][1];for(let s=i+1;s<e;s++){if(!o[s])continue;let l=o[s][2]-o[s][1];r[i][s]=r[i][s]+Math.min(a,l)}}let n=[];for(let o=1;o<e;o++)n[o-1]={i:0,j:o,count:r[0][o]};return n}function Vdt(){return!0}function Odt(e,t,r,n,o){let i=K.Location.create(e);for(let a of e.units){if(a.kind!==me.Kind.Atomic)continue;let{elements:s,model:l}=a;i.unit=a;let u=Tc.Provider.get(l).value;if(!u)return;let{dbName:c,accession:m,num:d}=u,p=Xt.transientSegments(a.model.atomicHierarchy.chainAtomSegments,s),h=Xt.transientSegments(a.model.atomicHierarchy.residueAtomSegments,s),f=a.model.atomicHierarchy.derived.residue.traceElementIndex;for(;p.hasNext;){let y=p.move();for(h.setSegment(y);h.hasNext;){let g=h.move(),x=g.index;if(!c[x])continue;let S=f[x],I,v;if(n){if(I=S,I===-1)continue;v=I+1}else I=s[g.start],v=s[g.end-1]+1;if(i.element=S>=0?S:I,!o(i,x,I,v))continue;let A=`${c[x]}-${m[x]}-${d[x]}`;if(!t.has(A))t.set(A,{key:A,pivots:{[r]:[a,I,v]}});else{let _=t.get(A);_.pivots[r]||(_.pivots[r]=[a,I,v])}}}}}var Rn=Rt(nr()),lV=class extends hc{defaultState(){return{isCollapsed:!1,header:"Superposition",brand:{accent:"gray",svg:lre},isHidden:!0}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>{this.setState({isHidden:t.structures.length<2})})}renderControls(){return(0,Rn.jsx)(Rn.Fragment,{children:(0,Rn.jsx)(OQ,{})})}},v2e={alignSequences:C.Boolean(!0,{isEssential:!0,description:"For Chain-based 3D superposition, perform a sequence alignment and use the aligned residue pairs to guide the 3D superposition."}),traceOnly:C.Boolean(!0,{description:"For Chain- and Uniprot-based 3D superposition, base superposition only on CA (and equivalent) atoms."})},Gdt=C.getDefaultValues(v2e),Udt="SuperpositionTransform",OQ=class extends ii{constructor(){super(...arguments);this.state={isBusy:!1,canUseDb:!1,action:void 0,options:Gdt};this.superposeChains=async()=>{let{query:r}=this.state.options.traceOnly?li.trace:li.polymer,n=this.chainEntries,o=n.map(u=>{let c=K.Loci.toStructure(u.loci),m=at.toLociWithSourceUnits(r(new ai(c)));return K.Loci.remap(m,this.getRootStructure(u.loci.structure))}),a=this.plugin.managers.structure.hierarchy.findStructure(o[0]?.structure)?.transform?.cell.obj?.data.coordinateSystem,s=this.state.options.alignSequences?C2e(o):VQ(o),l=n[0];for(let u=1,c=o.length;u<c;++u){let m=n[u],{bTransform:d,rmsd:p}=s[u-1];await this.transform(m.cell,d,a);let h=Zp(l.label),f=Zp(m.label);this.plugin.log.info(`Superposed [${h}] and [${f}] with RMSD ${p.toFixed(2)}.`)}await this.cameraReset()};this.superposeAtoms=async()=>{let r=this.atomEntries,n=r.map(l=>K.Loci.remap(l.loci,this.getRootStructure(l.loci.structure))),o=VQ(n),a=this.plugin.managers.structure.hierarchy.findStructure(n[0]?.structure)?.transform?.cell.obj?.data.coordinateSystem,s=r[0];for(let l=1,u=n.length;l<u;++l){let c=r[l],{bTransform:m,rmsd:d}=o[l-1];await this.transform(c.cell,m,a);let p=Zp(s.label),h=Zp(c.label),f=r[l].atoms.length;this.plugin.log.info(`Superposed ${f} ${f===1?"atom":"atoms"} of [${p}] and [${h}] with RMSD ${d.toFixed(2)}.`)}await this.cameraReset()};this.superposeDb=async()=>{let r=this.plugin.managers.structure.hierarchy.behaviors.selection.value.structures,n=this.state.options.traceOnly,o=r.map(m=>m.cell.obj?.data),{entries:i,failedPairs:a,zeroOverlapPairs:s}=S2e(o,{traceOnly:n}),l=r[0]?.transform?.cell.obj?.data.coordinateSystem,u=0;for(let m of i)await this.transform(r[m.other].cell,m.transform.bTransform,l),u+=m.transform.rmsd;u/=Math.max(i.length-1,1);let c=m=>`[${m.map(([d,p])=>`(${o[d].models[0].entryId}, ${o[p].models[0].entryId})`).join(", ")}]`;s.length&&this.plugin.log.warn(`Superposition: No UNIPROT mapping overlap between structures ${c(s)}.`),a.length&&this.plugin.log.error(`Superposition: Failed to superpose structures ${c(a)}.`),i.length&&(this.plugin.log.info(`Superposed ${i.length+1} structures with avg. RMSD ${u.toFixed(2)} \xC5.`),await this.cameraReset())};this.toggleByChains=()=>this.setState({action:this.state.action==="byChains"?void 0:"byChains"});this.toggleByAtoms=()=>this.setState({action:this.state.action==="byAtoms"?void 0:"byAtoms"});this.toggleOptions=()=>this.setState({action:this.state.action==="options"?void 0:"options"});this.setOptions=r=>{this.setState({options:r})}}componentDidMount(){this.subscribe(this.selection.events.changed,()=>{this.forceUpdate()}),this.subscribe(this.selection.events.additionsHistoryUpdated,()=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{this.setState({isBusy:r})}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,r=>{this.setState({canUseDb:r.structures.every(n=>!!n.cell.obj?.data&&n.cell.obj.data.models.some(o=>Tc.Provider.isApplicable(o)))})})}get selection(){return this.plugin.managers.structure.selection}async transform(r,n,o){let i=Yo.resolveAndCheck(this.plugin.state.data,r);if(!i)return;let a=this.plugin.state.data.selectQ(c=>c.byRef(i.transform.ref).subtree().withTransformer(Xe.Model.TransformStructureConformation))[0],l={transform:{name:"matrix",params:{data:o&&!Z.isIdentity(o.matrix)?Z.mul(Z(),o.matrix,n):n,transpose:!1}}},u=a?this.plugin.state.data.build().to(a).update(l):this.plugin.state.data.build().to(r).insert(Xe.Model.TransformStructureConformation,l,{tags:Udt});await this.plugin.runTask(this.plugin.state.data.updateTree(u))}getRootStructure(r){let n=this.plugin.helpers.substructureParent.get(r);return this.plugin.state.data.selectQ(o=>o.byValue(n).rootOfType(re.Molecule.Structure))[0].obj?.data}async cameraReset(){await new Promise(r=>requestAnimationFrame(r)),st.Camera.Reset(this.plugin)}highlight(r){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:r},!1)}moveHistory(r,n){this.plugin.managers.structure.selection.modifyHistory(r,n,void 0,!0)}focusLoci(r){this.plugin.managers.camera.focusLoci(r)}lociEntry(r,n){return(0,Rn.jsx)("div",{className:"msp-flex-row",children:(0,Rn.jsx)(sr,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(r.loci),style:{width:"auto",textAlign:"left"},onMouseEnter:()=>this.highlight(r.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:(0,Rn.jsx)("span",{dangerouslySetInnerHTML:{__html:r.label}})})},n)}historyEntry(r,n){let o=this.plugin.managers.structure.selection.additionsHistory;return(0,Rn.jsxs)("div",{className:"msp-flex-row",children:[(0,Rn.jsxs)(sr,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(r.loci),style:{width:"auto",textAlign:"left"},onMouseEnter:()=>this.highlight(r.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:[n,". ",(0,Rn.jsx)("span",{dangerouslySetInnerHTML:{__html:r.label}})]}),o.length>1&&(0,Rn.jsx)(or,{svg:Lb,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(r,"up"),flex:"20px",title:"Move up"}),o.length>1&&(0,Rn.jsx)(or,{svg:kb,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(r,"down"),flex:"20px",title:"Move down"}),(0,Rn.jsx)(or,{svg:Vs,small:!0,className:"msp-form-control",onClick:()=>this.plugin.managers.structure.selection.modifyHistory(r,"remove"),flex:!0,title:"Remove"})]},r.id)}atomsLociEntry(r,n){return(0,Rn.jsxs)("div",{children:[(0,Rn.jsx)("div",{className:"msp-control-group-header",children:(0,Rn.jsx)("div",{className:"msp-no-overflow",title:r.label,children:r.label})}),(0,Rn.jsx)("div",{className:"msp-control-offset",children:r.atoms.map((o,i)=>this.historyEntry(o,i))})]},n)}get chainEntries(){let r=K.Location.create(),n=[];return this.plugin.managers.structure.selection.entries.forEach(({selection:o},i)=>{let a=Yo.resolveAndCheck(this.plugin.state.data,i);if(!a||K.Loci.isEmpty(o))return;let s=K.Loci.getFirstLocation(o,r);if(o.elements.length>1||qe.entity.type(s)!=="polymer")return;let l=K.Stats.ofLoci(o),u=sS(l,{countsOnly:!0}),c=cd(s,{reverse:!0,granularity:"chain"}).split("|"),m=`${u} | ${c[0]} | ${c[c.length-1]}`;n.push({loci:o,label:m,cell:a})}),n}get atomEntries(){let r=new Map,n=this.plugin.managers.structure.selection.additionsHistory;for(let i=0,a=n.length;i<a;++i){let s=n[i];if(K.Loci.size(s.loci)!==1)continue;let l=s.loci.structure;r.has(l)?r.get(l).push(s):r.set(l,[s])}let o=[];return r.forEach((i,a)=>{let s=this.plugin.helpers.substructureParent.get(a),l=[];for(let m=0,d=i.length;m<d;++m)l.push(i[m].loci.elements[0]);let u=K.Loci(i[0].loci.structure,l),c=u.structure.label.split(" | ")[0];o.push({loci:u,label:c,cell:s,atoms:i})}),o}toggleHint(){return this.plugin.config.get(Lr.Viewport.ShowSelectionMode)?(0,Rn.jsxs)(Rn.Fragment,{children:[" ","(toggle ",(0,Rn.jsx)(lC,{inline:!0})," mode)"]}):null}addByChains(){let r=this.chainEntries;return(0,Rn.jsxs)(Rn.Fragment,{children:[r.length>0&&(0,Rn.jsx)("div",{className:"msp-control-offset",children:r.map((n,o)=>this.lociEntry(n,o))}),r.length<2&&(0,Rn.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,Rn.jsxs)("div",{className:"msp-help-description",children:[(0,Rn.jsx)(yn,{svg:Mu,inline:!0}),"Add 2 or more selections",this.toggleHint()," from separate structures. Selections must be limited to single polymer chains or residues therein."]})}),r.length>1&&(0,Rn.jsx)(sr,{title:"Superpose structures by selected chains.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeChains,style:{marginTop:"1px"},children:"Superpose"})]})}addByAtoms(){let r=this.atomEntries;return(0,Rn.jsxs)(Rn.Fragment,{children:[r.length>0&&(0,Rn.jsx)("div",{className:"msp-control-offset",children:r.map((n,o)=>this.atomsLociEntry(n,o))}),r.length<2&&(0,Rn.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,Rn.jsxs)("div",{className:"msp-help-description",children:[(0,Rn.jsx)(yn,{svg:Mu,inline:!0}),"Add 1 or more selections",this.toggleHint()," from separate structures. Selections must be limited to single atoms."]})}),r.length>1&&(0,Rn.jsx)(sr,{title:"Superpose structures by selected atoms.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeAtoms,style:{marginTop:"1px"},children:"Superpose"})]})}superposeByDbMapping(){return(0,Rn.jsx)(Rn.Fragment,{children:(0,Rn.jsx)(sr,{icon:AN,title:"Superpose structures using intersection of residues from SIFTS UNIPROT mapping.",className:"msp-btn msp-btn-block",onClick:this.superposeDb,style:{marginTop:"1px"},disabled:this.state.isBusy,children:"Uniprot"})})}render(){return(0,Rn.jsxs)(Rn.Fragment,{children:[(0,Rn.jsxs)("div",{className:"msp-flex-row",children:[(0,Rn.jsx)(di,{icon:AN,label:"Chains",toggle:this.toggleByChains,isSelected:this.state.action==="byChains",disabled:this.state.isBusy}),(0,Rn.jsx)(di,{icon:sre,label:"Atoms",toggle:this.toggleByAtoms,isSelected:this.state.action==="byAtoms",disabled:this.state.isBusy}),this.state.canUseDb&&this.superposeByDbMapping(),(0,Rn.jsx)(di,{icon:pc,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}})]}),this.state.action==="byChains"&&this.addByChains(),this.state.action==="byAtoms"&&this.addByAtoms(),this.state.action==="options"&&(0,Rn.jsx)("div",{className:"msp-control-offset",children:(0,Rn.jsx)(Kn,{params:v2e,values:this.state.options,onChangeValues:this.setOptions,isDisabled:this.state.isBusy})})]})}};var hs=Rt(nr()),uV=class extends hc{defaultState(){return{isCollapsed:!1,header:"Quick Styles",brand:{accent:"gray",svg:Nte}}}renderControls(){return(0,hs.jsx)(hs.Fragment,{children:(0,hs.jsx)(GQ,{})})}},GQ=class extends ii{constructor(){super(...arguments);this.state={busy:!1,style:"default"}}async applyRepresentation(r){this.setState({busy:!0}),await Ndt(this.plugin,r),await A2e(this.plugin,this.state.style),this.setState({busy:!1})}async applyStyle(r){this.setState({busy:!0}),await A2e(this.plugin,r),this.setState({busy:!1,style:r})}render(){return(0,hs.jsxs)(hs.Fragment,{children:[(0,hs.jsx)(I2e,{title:"Apply Representation",children:(0,hs.jsxs)("div",{className:"msp-flex-row",children:[(0,hs.jsx)(sr,{title:"Applies default representation preset (depends on structure size)",onClick:()=>this.applyRepresentation("default"),disabled:this.state.busy,children:"Default"}),(0,hs.jsx)(sr,{title:"Applies cartoon polymer and ball-and-stick ligand representation preset",onClick:()=>this.applyRepresentation("cartoon"),disabled:this.state.busy,children:"Cartoon"}),(0,hs.jsx)(sr,{title:"Applies spacefill representation preset",onClick:()=>this.applyRepresentation("spacefill"),disabled:this.state.busy,children:"Spacefill"}),(0,hs.jsx)(sr,{title:"Applies molecular surface representation preset",onClick:()=>this.applyRepresentation("surface"),disabled:this.state.busy,children:"Surface"})]})}),(0,hs.jsx)(I2e,{title:"Apply Style",children:(0,hs.jsxs)("div",{className:"msp-flex-row",children:[(0,hs.jsx)(sr,{title:"Applies default appearance (no outline, no ignore-light)",onClick:()=>this.applyStyle("default"),disabled:this.state.busy,children:"Default"}),(0,hs.jsx)(sr,{title:"Applies illustrative appearance (outline, ignore-light)",onClick:()=>this.applyStyle("illustrative"),disabled:this.state.busy,children:"Illustrative"})]})})]})}};function I2e(e){return(0,hs.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,hs.jsx)("div",{className:"msp-control-group-header",children:(0,hs.jsx)("div",{children:(0,hs.jsx)("b",{children:e.title})})}),e.children]})}async function Ndt(e,t){let{structures:r}=e.managers.structure.hierarchy.selection;switch(t){case"default":let n=e.config.get(Lr.Structure.DefaultRepresentationPreset)||Yl.auto.id,o=e.builders.structure.representation.resolveProvider(n);await e.managers.structure.component.applyPreset(r,o);break;case"spacefill":await e.managers.structure.component.applyPreset(r,Yl.illustrative);break;case"cartoon":await e.managers.structure.component.applyPreset(r,Yl["polymer-and-ligand"]);break;case"surface":await e.managers.structure.component.applyPreset(r,Yl["molecular-surface"]);break}}async function A2e(e,t){if(t==="default"&&(await e.managers.structure.component.setOptions({...e.managers.structure.component.state.options,ignoreLight:!1}),e.canvas3d)){let r=C.getDefaultValues(iA);e.canvas3d.setProps({postprocessing:{outline:r.outline,occlusion:r.occlusion,shadow:r.shadow}})}if(t==="illustrative"&&(await e.managers.structure.component.setOptions({...e.managers.structure.component.state.options,ignoreLight:!0}),e.canvas3d)){let r=e.canvas3d.props.postprocessing;e.canvas3d.setProps({postprocessing:{outline:{name:"on",params:r.outline.name==="on"?r.outline.params:{scale:1,color:0,threshold:.33,includeTransparent:!0}},occlusion:{name:"on",params:r.occlusion.name==="on"?r.occlusion.params:{multiScale:{name:"off",params:{}},radius:5,bias:.8,blurKernelSize:15,blurDepthBias:.5,samples:32,resolutionScale:1,color:0,transparentThreshold:.4}},shadow:{name:"off",params:{}}}})}}var wn=Rt(nr()),cV=class extends Ir{constructor(){super(...arguments);this.state={show:!1,label:""};this.update=()=>{let r=this.plugin.state.data,n=r.selectQ(s=>s.ofTransformer(Xe.Model.ModelFromTrajectory));if(n.length===0){this.setState({show:!1});return}let o="",i=0,a=new Set;for(let s of n){if(!s.sourceRef)continue;let l=r.cells.get(s.sourceRef).obj;if(l&&l.data.frameCount>1){if(a.has(s.sourceRef)){this.setState({show:!1});return}a.add(s.sourceRef),i++,o||(o=`Model ${s.transform.params.modelIndex+1} / ${l.data.frameCount}`)}}i>1&&(o=""),this.setState({show:i>0,label:o})};this.reset=()=>st.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:TR.create({action:"reset"})});this.prev=()=>st.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:TR.create({action:"advance",by:-1})});this.next=()=>st.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:TR.create({action:"advance",by:1})})}componentDidMount(){this.subscribe(this.plugin.state.data.events.changed,this.update),this.subscribe(this.plugin.behaviors.state.isAnimating,this.update)}render(){let r=this.plugin.behaviors.state.isAnimating.value;return!this.state.show||r&&!this.state.label||!this.plugin.config.get(Lr.Viewport.ShowTrajectoryControls)?null:(0,wn.jsxs)("div",{className:"msp-traj-controls",children:[!r&&(0,wn.jsx)(or,{svg:nre,title:"First Model",onClick:this.reset,disabled:r}),!r&&(0,wn.jsx)(or,{svg:SN,title:"Previous Model",onClick:this.prev,disabled:r}),!r&&(0,wn.jsx)(or,{svg:vN,title:"Next Model",onClick:this.next,disabled:r}),!!this.state.label&&(0,wn.jsx)("span",{children:this.state.label})]})}},mV=class extends Ir{constructor(){super(...arguments);this.state={isBusy:!1,show:!0};this.keyUp=r=>{if(!r.ctrlKey||this.state.isBusy||r.target!==document.body)return;let n=this.plugin.managers.snapshot;if(r.keyCode===37||r.key==="ArrowLeft")n.state.isPlaying&&n.stop(),this.prev();else if(r.keyCode===38||r.key==="ArrowUp"){if(n.state.isPlaying&&n.stop(),n.state.entries.size===0)return;let o=n.state.entries.get(0);this.update(o.snapshot.id)}else if(r.keyCode===39||r.key==="ArrowRight")n.state.isPlaying&&n.stop(),this.next();else if(r.keyCode===40||r.key==="ArrowDown"){if(n.state.isPlaying&&n.stop(),n.state.entries.size===0)return;let o=n.state.entries.get(n.state.entries.size-1);this.update(o.snapshot.id)}};this.change=r=>{r.target.value!=="none"&&this.update(r.target.value)};this.prev=()=>{let r=this.plugin.managers.snapshot,n=r.getNextId(r.state.current,-1);n&&this.update(n)};this.next=()=>{let r=this.plugin.managers.snapshot,n=r.getNextId(r.state.current,1);n&&this.update(n)};this.togglePlay=()=>{this.plugin.managers.snapshot.togglePlay()}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.state.isBusy,r=>this.setState({isBusy:r})),this.subscribe(this.plugin.behaviors.state.isAnimating,r=>this.setState({isBusy:r})),window.addEventListener("keyup",this.keyUp,!1)}componentWillUnmount(){super.componentWillUnmount(),window.removeEventListener("keyup",this.keyUp,!1)}async update(r){this.setState({isBusy:!0}),await st.State.Snapshots.Apply(this.plugin,{id:r}),this.setState({isBusy:!1})}render(){let r=this.plugin.managers.snapshot,n=r.state.entries.size;if(n<2||!this.state.show)return null;let o=r.state.current,i=r.state.isPlaying;return(0,wn.jsxs)("div",{className:"msp-state-snapshot-viewport-controls",children:[(0,wn.jsxs)("select",{className:"msp-form-control",value:o||"none",onChange:this.change,disabled:this.state.isBusy||i,children:[!o&&(0,wn.jsx)("option",{value:"none"},"none"),r.state.entries.valueSeq().map((a,s)=>(0,wn.jsxs)("option",{value:a.snapshot.id,children:[`[${s+1}/${n}]`," ",a.name||new Date(a.timestamp).toLocaleString()]},a.snapshot.id))]}),(0,wn.jsx)(or,{svg:i?IN:Dw,title:i?"Pause":"Cycle States",onClick:this.togglePlay,disabled:i?!1:this.state.isBusy}),!i&&(0,wn.jsxs)(wn.Fragment,{children:[(0,wn.jsx)(or,{svg:SN,title:"Previous State",onClick:this.prev,disabled:this.state.isBusy||i}),(0,wn.jsx)(or,{svg:vN,title:"Next State",onClick:this.next,disabled:this.state.isBusy||i})]})]})}};function T2e(){let e=zA.useContext(vl),[t,r]=zA.useState(0);zA.useEffect(()=>{let i=e.managers.snapshot.events.changed.subscribe(()=>r(a=>a+1));return()=>i.unsubscribe()},[e]);let n=e.managers.snapshot.state.current;if(!n)return null;let o=e.managers.snapshot.getEntry(n);return o?.description?.trim()?(0,wn.jsx)("div",{id:"snapinfo",className:"msp-snapshot-description-wrapper",children:o.descriptionFormat==="plaintext"&&o.description||(0,wn.jsx)(gE,{children:o.description})}):null}var dV=class extends Ir{constructor(){super(...arguments);this.state={isEmpty:!0,isExpanded:!1,isBusy:!1,isAnimating:!1,isPlaying:!1};this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded});this.stop=()=>{this.plugin.managers.animation.stop(),this.plugin.managers.snapshot.stop()}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>{this.plugin.managers.snapshot.state.isPlaying?this.setState({isPlaying:!0,isExpanded:!1}):this.setState({isPlaying:!1})}),this.subscribe(this.plugin.behaviors.state.isBusy,r=>{r?this.setState({isBusy:!0,isExpanded:!1,isEmpty:this.plugin.state.data.tree.transforms.size<2}):this.setState({isBusy:!1,isEmpty:this.plugin.state.data.tree.transforms.size<2})}),this.subscribe(this.plugin.behaviors.state.isAnimating,r=>{r?this.setState({isAnimating:!0,isExpanded:!1}):this.setState({isAnimating:!1})})}render(){let r=this.plugin.managers.snapshot.state.isPlaying;if(r||this.state.isEmpty||this.plugin.managers.animation.isEmpty||!this.plugin.config.get(Lr.Viewport.ShowAnimation))return null;let n=this.state.isAnimating;return(0,wn.jsxs)("div",{className:"msp-animation-viewport-controls",children:[(0,wn.jsxs)("div",{children:[(0,wn.jsx)("div",{className:"msp-semi-transparent-background"}),(0,wn.jsx)(or,{svg:n||r?IN:ore,transparent:!0,title:n?"Stop":"Select Animation",onClick:n||r?this.stop:this.toggleExpanded,toggleState:this.state.isExpanded,disabled:n||r?!1:this.state.isBusy||this.state.isPlaying||this.state.isEmpty})]}),this.state.isExpanded&&!this.state.isBusy&&(0,wn.jsx)("div",{className:"msp-animation-viewport-controls-select",children:(0,wn.jsx)(LF,{onStart:this.toggleExpanded})})]})}},pV=class extends Ir{componentDidMount(){this.subscribe(this.plugin.behaviors.interaction.selectionMode,()=>this.forceUpdate())}render(){return this.plugin.selectionMode?(0,wn.jsx)("div",{className:"msp-selection-viewport-controls",children:(0,wn.jsx)(QF,{})}):null}},fV=class extends Ir{constructor(){super(...arguments);this.state={labels:[]}}componentDidMount(){this.subscribe(this.plugin.behaviors.labels.highlight,r=>this.setState({labels:r.labels}))}render(){return this.state.labels.length===0?null:(0,wn.jsx)("div",{className:"msp-highlight-info",children:this.state.labels.map((r,n)=>r.indexOf(`
`)>=0?(0,wn.jsx)("div",{className:"msp-highlight-markdown-row",children:(0,wn.jsx)(a2,{skipHtml:!0,children:r})},""+n):(0,wn.jsx)("div",{className:"msp-highlight-simple-row",dangerouslySetInnerHTML:{__html:r}},""+n))})}},UQ=class extends Ir{componentDidMount(){this.subscribe(this.plugin.state.behaviors.events.changed,()=>this.forceUpdate())}render(){let t=[];return this.plugin.customStructureControls.forEach((r,n)=>{t.push((0,wn.jsx)(r,{initiallyCollapsed:this.props.initiallyCollapsed},n))}),t.length>0?(0,wn.jsx)(wn.Fragment,{children:t}):null}},hV=class extends Ir{render(){return(0,wn.jsxs)(wn.Fragment,{children:[(0,wn.jsxs)("div",{className:"msp-section-header",children:[(0,wn.jsx)(yn,{svg:Wte}),"Structure Tools"]}),(0,wn.jsx)(KF,{}),(0,wn.jsx)(qF,{}),(0,wn.jsx)(lV,{}),(0,wn.jsx)(uV,{}),(0,wn.jsx)(NF,{}),this.plugin.config.get(Lr.VolumeStreaming.Enabled)&&(0,wn.jsx)(iV,{}),(0,wn.jsx)(aV,{}),(0,wn.jsx)(UQ,{})]})}};var HA=Rt(nr()),gV=class extends Ir{get current(){return this.props.state.behaviors.currentObject.value}componentDidMount(){this.subscribe(this.plugin.state.events.object.updated,({ref:t,state:r})=>{let n=this.current;n.ref!==t||n.state!==r||this.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.added,()=>this.forceUpdate()),this.subscribe(this.plugin.state.data.actions.events.removed,()=>this.forceUpdate())}render(){let{state:t,nodeRef:r}=this.props,n=t.cells.get(r),o=t.actions.fromCell(n,this.plugin);if(o.length===0)return null;let i=n.transform.transformer.definition,a=n.obj?n.obj.label:i.display&&i.display.name||i.name;return(0,HA.jsxs)("div",{className:"msp-state-actions",children:[!this.props.hideHeader&&(0,HA.jsxs)("div",{className:"msp-section-header",children:[(0,HA.jsx)(yn,{svg:Yte})," ",`Actions (${a})`]}),o.map((s,l)=>(0,HA.jsx)(hC,{state:t,action:s,nodeRef:r,initiallyCollapsed:l===0?!this.props.alwaysExpandFirst&&this.props.initiallyCollapsed:this.props.initiallyCollapsed},`${s.id}`))]})}};var HS=Rt(Pi());var gC=class e extends ic{constructor(r){super();this.plugin=r;this.data=rm.create(new re.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,historyCapacity:this.plugin.config.get(Lr.State.HistoryCapacity)});this.behaviors=rm.create(new qr.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,rootState:{isLocked:!0}});this.events={cell:{stateUpdated:jc(this.data.events.cell.stateUpdated,this.behaviors.events.cell.stateUpdated),created:jc(this.data.events.cell.created,this.behaviors.events.cell.created),removed:jc(this.data.events.cell.removed,this.behaviors.events.cell.removed)},object:{created:jc(this.data.events.object.created,this.behaviors.events.object.created),removed:jc(this.data.events.object.removed,this.behaviors.events.object.removed),updated:jc(this.data.events.object.updated,this.behaviors.events.object.updated)}};this.snapshotParams=this.ev.behavior(e.DefaultSnapshotParams);this.setSnapshotParams=r=>{this.snapshotParams.next({...e.DefaultSnapshotParams,...r})}}get animation(){return this.plugin.managers.animation}getSnapshot(r){let n={...this.snapshotParams.value,...r};return{id:en.create22(),data:n.data?this.data.getSnapshot():void 0,behaviour:n.behavior?this.behaviors.getSnapshot():void 0,animation:n.animation?this.animation.getSnapshot():void 0,startAnimation:n.startAnimation?!!n.startAnimation:void 0,camera:n.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:n.cameraTransition.name,transitionDurationInMs:n?.cameraTransition?.name==="animate"?n.cameraTransition.params.durationInMs:void 0}:void 0,canvas3dContext:n.canvas3dContext?{props:this.plugin.canvas3dContext?.props}:void 0,canvas3d:n.canvas3d?{props:this.plugin.canvas3d?.props}:void 0,interactivity:n.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),structureSelection:n.structureSelection?this.plugin.managers.structure.selection.getSnapshot():void 0,structureComponentManager:n.componentManager?{options:this.plugin.managers.structure.component.state.options}:void 0,durationInMs:n?.durationInMs}}async setSnapshot(r){if(await this.animation.stop(),r.structureComponentManager?.options&&this.plugin.managers.structure.component._setSnapshotState(r.structureComponentManager?.options),r.behaviour&&await this.plugin.runTask(this.behaviors.setSnapshot(r.behaviour)),r.data&&await this.plugin.runTask(this.data.setSnapshot(r.data)),r.canvas3d?.props){let n=C.normalizeParams(Ds,r.canvas3d.props,"children");await st.Canvas3D.SetSettings(this.plugin,{settings:n})}if(r.canvas3dContext?.props){let n=C.normalizeParams(Tf.Params,r.canvas3dContext.props,"children");this.plugin.canvas3dContext?.setProps(n)}r.interactivity&&r.interactivity.props&&this.plugin.managers.interactivity.setProps(r.interactivity.props),r.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(r.structureFocus),r.structureSelection&&this.plugin.managers.structure.selection.setSnapshot(r.structureSelection),r.animation&&this.animation.setSnapshot(r.animation),r.camera?.current?st.Camera.Reset(this.plugin,{snapshot:r.camera.current,durationMs:r.camera.transitionStyle==="animate"?r.camera.transitionDurationInMs:void 0}):r.camera?.focus&&st.Camera.FocusObject(this.plugin,{...r.camera.focus,durationMs:r.camera.transitionStyle==="animate"?r.camera.transitionDurationInMs:void 0}),r.startAnimation&&this.animation.start()}updateTransform(r,n,o,i){let a=r.build().to(n).update(o);return st.State.Update(this.plugin,{state:r,tree:a,options:{canUndo:i}})}hasBehavior(r){return this.behaviors.tree.transforms.has(r.id)}updateBehavior(r,n){let o=this.behaviors.build();if(this.behaviors.tree.transforms.has(r.id))o.to(r.id).update(n);else{let i=r.createDefaultParams(void 0,this.plugin);o.to(qr.getCategoryId(r)).apply(r,su(i,n),{ref:r.id})}return this.plugin.runTask(this.behaviors.updateTree(o))}dispose(){this.behaviors.cells.forEach(r=>{qr.Behavior.is(r.obj)&&(r.obj.data.unregister?.(),r.obj.data.dispose?.())}),super.dispose(),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()}};(r=>(r.SnapshotParams={durationInMs:C.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:C.Boolean(!0),behavior:C.Boolean(!1),structureSelection:C.Boolean(!1),componentManager:C.Boolean(!0),animation:C.Boolean(!0),startAnimation:C.Boolean(!1),canvas3d:C.Boolean(!0),canvas3dContext:C.Boolean(!0),interactivity:C.Boolean(!0),camera:C.Boolean(!0),cameraTransition:C.MappedStatic("animate",{animate:C.Group({durationInMs:C.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:C.Group({})},{options:[["animate","Animate"],["instant","Instant"]]}),image:C.Boolean(!1)},r.DefaultSnapshotParams=C.getDefaultValues(r.SnapshotParams)))(gC||={});var ir=Rt(nr()),yV=class extends Ir{render(){return(0,ir.jsxs)("div",{children:[(0,ir.jsx)(Jp,{icon:ww,title:"Plugin State"}),(0,ir.jsx)("div",{style:{marginBottom:"10px"},children:(0,ir.jsx)(Ja,{header:"Save Options",initiallyExpanded:!1,children:(0,ir.jsx)(UR,{})})}),(0,ir.jsx)(NQ,{}),(0,ir.jsx)(zQ,{}),(0,ir.jsx)(Jp,{title:"Save as File",accent:"blue"}),(0,ir.jsx)(GR,{}),this.plugin.spec.components?.remoteState!=="none"&&(0,ir.jsx)(NR,{})]})}},GR=class extends Ir{constructor(){super(...arguments);this.downloadToFileJson=()=>{this.props.onAction?.(),st.State.Snapshots.DownloadToFile(this.plugin,{type:"json"})};this.downloadToFileZip=()=>{this.props.onAction?.(),st.State.Snapshots.DownloadToFile(this.plugin,{type:"zip"})};this.open=r=>{if(!r.target.files||!r.target.files[0]){this.plugin.log.error("No state file selected");return}this.props.onAction?.(),st.State.Snapshots.OpenFile(this.plugin,{file:r.target.files[0]})}}render(){return(0,ir.jsxs)(ir.Fragment,{children:[(0,ir.jsxs)("div",{className:"msp-flex-row",children:[(0,ir.jsx)(sr,{icon:NP,onClick:this.downloadToFileJson,title:"Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input.",children:"State"}),(0,ir.jsx)(sr,{icon:NP,onClick:this.downloadToFileZip,title:"Save the state including the input data.",children:"Session"}),(0,ir.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",children:[(0,ir.jsx)(yn,{svg:rre,inline:!0})," Open ",(0,ir.jsx)("input",{onChange:this.open,type:"file",multiple:!1,accept:".molx,.molj"})]})]}),(0,ir.jsxs)("div",{className:"msp-help-text",style:{padding:"10px"},children:[(0,ir.jsx)(yn,{svg:Ew})," This is an experimental feature and stored states/sessions might not be openable in a future version."]})]})}},UR=class extends Ir{componentDidMount(){this.subscribe(this.plugin.state.snapshotParams,()=>this.forceUpdate())}render(){return(0,ir.jsx)(Kn,{params:gC.SnapshotParams,values:this.plugin.state.snapshotParams.value,onChangeValues:this.plugin.state.setSnapshotParams})}},NQ=class e extends Ir{constructor(){super(...arguments);this.state={params:C.getDefaultValues(e.Params)};this.add=()=>{st.State.Snapshots.Add(this.plugin,{name:this.state.params.name,description:this.state.params.description})};this.updateParams=r=>this.setState({params:r});this.clear=()=>{st.State.Snapshots.Clear(this.plugin,{})}}static{this.Params={name:C.Text(),description:C.Text()}}shouldComponentUpdate(r,n){return!Yf(this.props,r)||!Yf(this.state,n)}render(){return(0,ir.jsx)("div",{children:(0,ir.jsx)(zdt,{parent:this})})}};function P2e(e,t,r){return t?e.managers.snapshot.state.entries.some(n=>(!r||n.snapshot.id!==r)&&n.key===t):!1}function zdt({parent:e}){let[t,r]=HS.useState({key:"",name:"",description:""}),n=()=>{st.State.Snapshots.Add(e.plugin,{key:t.key,name:t.name,description:t.description}),r({key:"",name:"",description:""})},o=P2e(e.plugin,t.key);return(0,ir.jsxs)(ir.Fragment,{children:[(0,ir.jsx)(_2e,{state:t,setState:r,apply:n}),(0,ir.jsxs)("div",{className:"msp-flex-row",children:[(0,ir.jsx)(or,{onClick:e.clear,svg:Vs,title:"Remove All"}),(0,ir.jsx)(sr,{onClick:n,icon:o?void 0:Kp,style:{textAlign:"right"},commit:o?"off":"on",disabled:o,children:o?"Key must be unique":"Add"})]})]})}var zQ=class extends Ir{constructor(){super(...arguments);this.state={editingId:void 0};this.edit=r=>{let n=r.currentTarget.getAttribute("data-id");if(!n)return;let o=this.state.editingId;this.setState({editingId:n===o?void 0:n})};this.doneEdit=()=>this.setState({editingId:void 0});this.apply=r=>{let n=r.currentTarget.getAttribute("data-id");n&&st.State.Snapshots.Apply(this.plugin,{id:n})};this.remove=r=>{let n=r.currentTarget.getAttribute("data-id");n&&st.State.Snapshots.Remove(this.plugin,{id:n})};this.moveUp=r=>{let n=r.currentTarget.getAttribute("data-id");n&&st.State.Snapshots.Move(this.plugin,{id:n,dir:-1})};this.moveDown=r=>{let n=r.currentTarget.getAttribute("data-id");n&&st.State.Snapshots.Move(this.plugin,{id:n,dir:1})};this.replace=r=>{let n=r.currentTarget.getAttribute("data-id");n&&st.State.Snapshots.Replace(this.plugin,{id:n})}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>this.forceUpdate())}render(){let r=this.plugin.managers.snapshot.state.current,n=[];return this.plugin.managers.snapshot.state.entries.forEach(o=>{n.push((0,ir.jsxs)("li",{className:"msp-flex-row",children:[(0,ir.jsxs)(sr,{"data-id":o.snapshot.id,onClick:this.apply,className:"msp-no-overflow",children:[(0,ir.jsxs)("span",{style:{fontWeight:o.snapshot.id===r?"bold":void 0},children:[!!o.key&&`[${o.key}] `,o.name||new Date(o.timestamp).toLocaleString()]})," ",(0,ir.jsx)("small",{children:`${o.snapshot.durationInMs?U1(o.snapshot.durationInMs,!1):""}`})]}),(0,ir.jsx)(or,{svg:pc,"data-id":o.snapshot.id,title:"Edit",onClick:this.edit,flex:"28px"}),(0,ir.jsx)(or,{svg:Lb,"data-id":o.snapshot.id,title:"Move Up",onClick:this.moveUp,flex:"20px"}),(0,ir.jsx)(or,{svg:kb,"data-id":o.snapshot.id,title:"Move Down",onClick:this.moveDown,flex:"20px"}),(0,ir.jsx)(or,{svg:ire,"data-id":o.snapshot.id,title:"Replace",onClick:this.replace,flex:"20px"}),(0,ir.jsx)(or,{svg:Vs,"data-id":o.snapshot.id,title:"Remove",onClick:this.remove,flex:"20px"})]},o.snapshot.id)),this.state.editingId===o.snapshot.id&&n.push((0,ir.jsx)(Hdt,{entry:o,plugin:this.plugin,done:this.doneEdit},`${o.snapshot.id}-edit`));let i=o.image&&this.plugin.managers.asset.get(o.image)?.file;i&&n.push((0,ir.jsx)("li",{className:"msp-state-image-row",children:(0,ir.jsx)(sr,{"data-id":o.snapshot.id,onClick:this.apply,children:(0,ir.jsx)("img",{draggable:!1,src:URL.createObjectURL(i)})})},`${o.snapshot.id}-image`))}),(0,ir.jsx)(ir.Fragment,{children:(0,ir.jsx)("ul",{style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list",children:n})})}};function _2e({state:e,setState:t,apply:r}){let n=HS.useRef(),o=HS.useRef(),[i,a]=HS.useState(!1);return(0,ir.jsxs)(ir.Fragment,{children:[(0,ir.jsx)(Sl,{label:"Name",control:(0,ir.jsx)("input",{type:"text",value:e.name,placeholder:"Name",onChange:s=>t({...e,name:s.target.value}),onKeyUp:s=>{s.key==="Enter"&&n.current?.focus()}})}),(0,ir.jsx)(Sl,{label:(0,ir.jsxs)(ir.Fragment,{children:["Key",(0,ir.jsx)(YX,{show:i,toggle:()=>a(s=>!s)})]}),control:(0,ir.jsx)("input",{type:"text",ref:n,value:e.key,placeholder:"Key (optional)",onChange:s=>t({...e,key:s.target.value}),onKeyUp:s=>{s.key==="Enter"&&o.current?.focus()}})}),i&&(0,ir.jsx)("div",{className:"msp-control-offset",children:(0,ir.jsx)(PR,{description:"Optional snapshot key used to activate snapshots from descriptions, labels, etc."})}),(0,ir.jsx)("div",{className:"msp-flex-row msp-text-area-wrapper",style:{marginBottom:1},children:(0,ir.jsx)("textarea",{ref:o,placeholder:`Markdown Description

- Use [title](#key) to link to a snapshot`,className:"msp-form-control",value:e.description,onChange:s=>t({...e,description:s.target.value}),onKeyUp:s=>{s.key==="Enter"&&s.ctrlKey&&r(e)}})})]})}function Hdt({entry:e,plugin:t,done:r}){let[n,o]=HS.useState({key:e.key??"",name:e.name??"",description:e.description??"",descriptionFormat:e.descriptionFormat}),i=()=>{t.managers.snapshot.update(e,n),r()},a=P2e(t,n.key,e.snapshot.id);return(0,ir.jsxs)(ir.Fragment,{children:[(0,ir.jsx)(_2e,{state:n,setState:o,apply:i}),(0,ir.jsx)("div",{className:"msp-flex-row",style:{marginBottom:1},children:(0,ir.jsx)(sr,{onClick:i,icon:a?void 0:Lm,style:{textAlign:"right"},commit:a?"off":"on",disabled:a,children:a?"Key must be unique":"Apply"})})]})}var NR=class extends Ir{constructor(){super(...arguments);this.Params={name:C.Text(),options:C.Group({description:C.Text(),playOnLoad:C.Boolean(!1),serverUrl:C.Text(this.plugin.config.get(Lr.State.CurrentServer))})};this.state={params:C.getDefaultValues(this.Params),entries:Us(),isBusy:!1};this.ListOnlyParams={options:C.Group({serverUrl:C.Text(this.plugin.config.get(Lr.State.CurrentServer))},{isFlat:!0})};this._mounted=!1;this.refresh=async()=>{try{this.setState({isBusy:!0}),this.plugin.config.set(Lr.State.CurrentServer,this.state.params.options.serverUrl);let r=await this.plugin.runTask(this.plugin.fetch({url:this.serverUrl("list"),type:"json"}))||[];r.sort((o,i)=>o.isSticky===i.isSticky?o.timestamp-i.timestamp:o.isSticky?-1:1);let n=Us().asMutable();for(let o of r)n.set(o.id,{...o,url:this.serverUrl(`get/${o.id}`),removeUrl:this.serverUrl(`remove/${o.id}`)});this._mounted&&this.setState({entries:n.asImmutable(),isBusy:!1})}catch(r){console.error(r),this.plugin.log.error("Error fetching remote snapshots"),this._mounted&&this.setState({entries:Us(),isBusy:!1})}};this.upload=async()=>{this.setState({isBusy:!0}),this.plugin.config.set(Lr.State.CurrentServer,this.state.params.options.serverUrl),await st.State.Snapshots.Upload(this.plugin,{name:this.state.params.name,description:this.state.params.options.description,playOnLoad:this.state.params.options.playOnLoad,serverUrl:this.state.params.options.serverUrl}),this.plugin.log.message("Snapshot uploaded."),this._mounted&&(this.setState({isBusy:!1}),this.refresh())};this.fetch=async r=>{let n=r.currentTarget.getAttribute("data-id");if(!n)return;let o=this.state.entries.get(n);if(o){this.setState({isBusy:!0});try{await st.State.Snapshots.Fetch(this.plugin,{url:o.url})}finally{this._mounted&&this.setState({isBusy:!1})}}};this.remove=async r=>{let n=r.currentTarget.getAttribute("data-id");if(!n)return;let o=this.state.entries.get(n);if(o){this.setState({entries:this.state.entries.remove(n)});try{await fetch(o.removeUrl)}catch(i){console.error(i)}}}}componentDidMount(){this.refresh(),this._mounted=!0}componentWillUnmount(){super.componentWillUnmount(),this._mounted=!1}serverUrl(r){return r?nC(this.state.params.options.serverUrl,r):this.state.params.options.serverUrl}render(){return(0,ir.jsxs)(ir.Fragment,{children:[(0,ir.jsx)(Jp,{title:"Remote States",accent:"blue"}),!this.props.listOnly&&(0,ir.jsxs)(ir.Fragment,{children:[(0,ir.jsx)(Kn,{params:this.Params,values:this.state.params,onEnter:this.upload,onChange:r=>{this.setState({params:{...this.state.params,[r.name]:r.value}})},isDisabled:this.state.isBusy}),(0,ir.jsxs)("div",{className:"msp-flex-row",children:[(0,ir.jsx)(or,{onClick:this.refresh,disabled:this.state.isBusy,svg:HP}),(0,ir.jsx)(sr,{icon:qte,onClick:this.upload,disabled:this.state.isBusy,commit:!0,children:"Upload"})]})]}),(0,ir.jsx)(HQ,{entries:this.state.entries,isBusy:this.state.isBusy,serverUrl:this.state.params.options.serverUrl,fetch:this.fetch,remove:this.props.listOnly?void 0:this.remove}),this.props.listOnly&&(0,ir.jsxs)("div",{style:{marginTop:"10px"},children:[(0,ir.jsx)(Kn,{params:this.ListOnlyParams,values:this.state.params,onEnter:this.upload,onChange:r=>{this.setState({params:{...this.state.params,[r.name]:r.value}})},isDisabled:this.state.isBusy}),(0,ir.jsx)("div",{className:"msp-flex-row",children:(0,ir.jsx)(sr,{onClick:this.refresh,disabled:this.state.isBusy,icon:HP,children:"Refresh"})})]})]})}},HQ=class extends ii{constructor(){super(...arguments);this.open=async r=>{let n=r.currentTarget.getAttribute("data-id");if(!n)return;let o=this.props.entries.get(n);if(!o)return;r.preventDefault();let i=`${window.location}`,a=i.indexOf("?");a>0&&(i=i.substr(0,a)),window.open(`${i}?snapshot-url=${encodeURIComponent(o.url)}`,"_blank")}}render(){return(0,ir.jsx)("ul",{style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list",children:this.props.entries.valueSeq().map(r=>(0,ir.jsxs)("li",{className:"msp-flex-row",children:[(0,ir.jsxs)(sr,{"data-id":r.id,onClick:this.props.fetch,disabled:this.props.isBusy,onContextMenu:this.open,title:"Click to download, right-click to open in a new tab.",children:[r.name||new Date(r.timestamp).toLocaleString()," ",(0,ir.jsx)("small",{children:r.description})]}),!r.isSticky&&this.props.remove&&(0,ir.jsx)(or,{svg:Vs,"data-id":r.id,title:"Remove",onClick:this.props.remove,disabled:this.props.isBusy,small:!0})]},r.id))})}};var Vo=Rt(nr()),zR=class extends Ir{constructor(){super(...arguments);this.state={showActions:!0}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.created,r=>{r.cell.transform.parent===Ar.RootRef&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,r=>{r.parent===Ar.RootRef&&this.forceUpdate()})}static getDerivedStateFromProps(r,n){let o=r.state.tree.root.ref,a=r.state.tree.children.get(o).size===0;return n.showActions===a?null:{showActions:a}}render(){let r=this.props.state.tree.root.ref;return this.state.showActions?(0,Vo.jsxs)("div",{style:{margin:"10px",cursor:"default"},children:[(0,Vo.jsx)("p",{children:"Nothing to see here yet."}),(0,Vo.jsxs)("p",{children:["Structures and Volumes can be loaded from the ",(0,Vo.jsx)(yn,{svg:zP})," tab."]})]}):(0,Vo.jsx)(jQ,{cell:this.props.state.cells.get(r),depth:0})}},jQ=class e extends Ir{constructor(){super(...arguments);this.state={isCollapsed:!!this.props.cell.state.isCollapsed,isNull:e.isNull(this.props.cell),showLabel:e.showLabel(this.props.cell)}}is(r){return r.ref===this.ref&&r.state===this.props.cell.parent}get ref(){return this.props.cell.transform.ref}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,r=>{this.props.cell===r.cell&&this.is(r)&&r.state.cells.has(this.ref)&&(this.state.isCollapsed!==!!r.cell.state.isCollapsed||this.state.isNull!==e.isNull(r.cell)||this.state.showLabel!==e.showLabel(r.cell))&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.created,r=>{this.props.cell.parent===r.state&&this.ref===r.cell.transform.parent&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,r=>{this.props.cell.parent===r.state&&this.ref===r.parent&&this.forceUpdate()})}static getDerivedStateFromProps(r,n){let o=e.isNull(r.cell),i=e.showLabel(r.cell);return!!r.cell.state.isCollapsed===n.isCollapsed&&n.isNull===o&&n.showLabel===i?null:{isCollapsed:!!r.cell.state.isCollapsed,isNull:o,showLabel:i}}static hasDecorator(r){let n=r.parent.tree.children.get(r.transform.ref);if(n.size!==1)return!1;let o=n.first();return!!o&&!!r.parent?.tree.transforms.get(o).transformer.definition.isDecorator}static isNull(r){return!r||!r.parent||r.obj===An.Null||!r.parent.tree.transforms.has(r.transform.ref)}static showLabel(r){return r.transform.ref!==Ar.RootRef&&(r.status!=="ok"||!r.state.isGhost&&!e.hasDecorator(r))}render(){if(this.state.isNull)return null;let r=this.props.cell,n=r.parent.tree.children.get(this.ref);if(!this.state.showLabel)return n.size===0?null:(0,Vo.jsx)(Vo.Fragment,{children:n.map(i=>(0,Vo.jsx)(e,{cell:r.parent.cells.get(i),depth:this.props.depth},i))});let o=this.props.depth+1;return(0,Vo.jsxs)(Vo.Fragment,{children:[(0,Vo.jsx)(WQ,{cell:r,depth:this.props.depth}),n.size===0?void 0:(0,Vo.jsx)("div",{style:{display:this.state.isCollapsed?"none":"block"},children:n.map(i=>(0,Vo.jsx)(e,{cell:r.parent.cells.get(i),depth:o},i))})]})}},WQ=class extends Ir{constructor(){super(...arguments);this.state={isCurrent:this.props.cell.parent.current===this.ref,isCollapsed:!!this.props.cell.state.isCollapsed,action:void 0,currentAction:void 0};this.setCurrent=r=>{r?.preventDefault(),r?.currentTarget.blur(),st.State.SetCurrentObject(this.plugin,{state:this.props.cell.parent,ref:this.ref})};this.setCurrentRoot=r=>{r?.preventDefault(),r?.currentTarget.blur(),this.props.cell.parent&&st.State.SetCurrentObject(this.plugin,{state:this.props.cell.parent,ref:Ar.RootRef})};this.remove=r=>{r?.preventDefault(),st.State.RemoveObject(this.plugin,{state:this.props.cell.parent,ref:this.ref,removeParentGhosts:!0})};this.toggleVisible=r=>{r.preventDefault(),st.State.ToggleVisibility(this.plugin,{state:this.props.cell.parent,ref:this.ref}),r.currentTarget.blur()};this.toggleExpanded=r=>{r.preventDefault(),st.State.ToggleExpanded(this.plugin,{state:this.props.cell.parent,ref:this.ref}),r.currentTarget.blur()};this.highlight=r=>{r.preventDefault(),st.Interactivity.Object.Highlight(this.plugin,{state:this.props.cell.parent,ref:this.ref}),r.currentTarget.blur()};this.clearHighlight=r=>{r.preventDefault(),st.Interactivity.ClearHighlights(this.plugin),r.currentTarget.blur()};this.hideApply=()=>{this.setCurrentRoot()};this.selectAction=r=>{r&&(r?.value)()}}is(r){return r.ref===this.ref&&r.state===this.props.cell.parent}get ref(){return this.props.cell.transform.ref}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(zf(r=>this.is(r)),$y(33)),r=>{this.forceUpdate()}),this.subscribe(this.props.cell.parent.behaviors.currentObject,r=>{if(!this.is(r)){this.state.isCurrent&&r.state.transforms.has(this.ref)&&this._setCurrent(this.props.cell.parent.current===this.ref,this.state.isCollapsed);return}r.state.transforms.has(this.ref)&&this._setCurrent(this.props.cell.parent.current===this.ref,!!this.props.cell.state.isCollapsed)})}_setCurrent(r,n){r?this.setState({isCurrent:r,action:"options",currentAction:void 0,isCollapsed:n}):this.setState({isCurrent:r,action:void 0,currentAction:void 0,isCollapsed:n})}static getDerivedStateFromProps(r,n){let o=r.cell.parent.current===r.cell.transform.ref,i=!!r.cell.state.isCollapsed;return n.isCollapsed===i&&n.isCurrent===o?null:{isCurrent:o,isCollapsed:i,action:void 0,currentAction:void 0}}get actions(){let r=this.props.cell,n=[...r.parent.actions.fromCell(r,this.plugin)];if(n.length!==0)return n.sort((o,i)=>o.definition.display.name<i.definition.display.name?-1:o.definition.display.name===i.definition.display.name?0:1),[br.Header("Apply Action"),...n.map(o=>br.Item(o.definition.display.name,()=>this.setState({action:"apply",currentAction:o})))]}updates(r){let n=this.props.cell,o=M0.getDecoratorChain(n.parent,n.transform.ref),i=[];for(let a=o.length-1;a>=0;a--){let s=o[a];i.push((0,Vo.jsx)($u,{state:n.parent,transform:s.transform,noMargin:!0,wrapInExpander:!0,expanderHeaderLeftMargin:r},`${s.transform.transformer.id}-${a}`))}return(0,Vo.jsx)("div",{className:"msp-tree-updates-wrapper",children:i})}render(){let r=this.props.cell,n=r.transform;if(!r)return null;let o=this.is(r.parent.behaviors.currentObject.value),i=r.status!=="error"&&r.status!=="ok",a;if(r.status==="error"||!r.obj){let h=r.status==="error"?r.errorText:n.transformer.definition.display.name;a=(0,Vo.jsxs)(sr,{className:"msp-btn-tree-label msp-no-hover-outline",noOverflow:!0,title:h,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,disabled:i,children:[r.status==="error"&&(0,Vo.jsxs)("b",{children:["[",r.status,"]"]})," ",(0,Vo.jsx)("span",{children:h})]})}else{let h=r.obj,f=`${h.label} ${h.description?h.description:""}`;a=(0,Vo.jsxs)(sr,{className:`msp-btn-tree-label msp-type-class-${h.type.typeClass}`,noOverflow:!0,disabled:i,title:f,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,children:[(0,Vo.jsx)("span",{children:h.label})," ",h.description?(0,Vo.jsx)("small",{children:h.description}):void 0]})}let s=r.parent.tree.children.get(this.ref),l=r.state,u=(0,Vo.jsx)(or,{svg:l.isCollapsed?Eu:wu,flex:"20px",disabled:i,onClick:this.toggleExpanded,transparent:!0,className:"msp-no-hover-outline",style:{visibility:s.size>0?"visible":"hidden"}}),c=r.state.isLocked?void 0:(0,Vo.jsx)(or,{svg:Vs,onClick:this.remove,disabled:i,small:!0,toggleState:!1}),m=(0,Vo.jsx)(or,{svg:l.isHidden?Fm:Jc,toggleState:!1,disabled:i,small:!0,onClick:this.toggleVisible}),d={marginLeft:`${this.props.depth*8}px`},p=(0,Vo.jsxs)("div",{className:`msp-flex-row msp-tree-row${o?" msp-tree-row-current":""}`,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:d,children:[u,a,c,m]});if(!o)return p;if(this.state.action==="apply"&&this.state.currentAction)return(0,Vo.jsxs)("div",{style:{marginBottom:"1px"},children:[p,(0,Vo.jsx)(Cl,{header:`Apply ${this.state.currentAction.definition.display.name}`,initialExpanded:!0,hideExpander:!0,hideOffset:!1,onHeaderClick:this.hideApply,topRightIcon:dc,headerLeftMargin:`${this.props.depth*8+21}px`,children:(0,Vo.jsx)(hC,{onApply:this.hideApply,state:this.props.cell.parent,action:this.state.currentAction,nodeRef:this.props.cell.transform.ref,hideHeader:!0,noMargin:!0})})]});if(this.state.action==="options"){let h=this.actions,f=this.updates(`${this.props.depth*8+21}px`);return(0,Vo.jsxs)("div",{style:{marginBottom:"1px"},children:[p,f,h&&(0,Vo.jsx)("div",{style:{marginLeft:`${this.props.depth*8+21}px`,marginTop:"-1px"},children:(0,Vo.jsx)(br,{items:h,onSelect:this.selectAction})})]})}return p}};var pn=Rt(nr()),XQ=class extends Ir{componentDidMount(){this.subscribe(this.plugin.state.behaviors.events.changed,()=>this.forceUpdate())}render(){let t=[];return this.plugin.customImportControls.forEach((r,n)=>{t.push((0,pn.jsx)(r,{initiallyCollapsed:this.props.initiallyCollapsed},n))}),t.length>0?(0,pn.jsx)(pn.Fragment,{children:t}):null}},bV=class extends Ir{constructor(){super(...arguments);this.state={tab:this.plugin.behaviors.layout.leftPanelTabName.value};this.set=r=>{if(this.state.tab===r){this.setState({tab:"none"},()=>this.plugin.behaviors.layout.leftPanelTabName.next("none")),st.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"collapsed"}}});return}this.setState({tab:r},()=>this.plugin.behaviors.layout.leftPanelTabName.next(r)),this.plugin.layout.state.regionState.left!=="full"&&st.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"full"}}})};this.tabs={none:(0,pn.jsx)(pn.Fragment,{}),root:(0,pn.jsxs)(pn.Fragment,{children:[(0,pn.jsx)(Jp,{icon:zP,title:"Home"}),(0,pn.jsx)(gV,{state:this.plugin.state.data,nodeRef:Ar.RootRef,hideHeader:!0,initiallyCollapsed:!0,alwaysExpandFirst:!0}),(0,pn.jsx)(XQ,{}),this.plugin.spec.components?.remoteState!=="none"&&(0,pn.jsx)(NR,{listOnly:!0})]}),data:(0,pn.jsxs)(pn.Fragment,{children:[(0,pn.jsx)(Jp,{icon:yN,title:(0,pn.jsxs)(pn.Fragment,{children:[(0,pn.jsx)(qQ,{})," State Tree"]})}),(0,pn.jsx)(zR,{state:this.plugin.state.data})]}),states:(0,pn.jsx)(yV,{}),settings:(0,pn.jsxs)(pn.Fragment,{children:[(0,pn.jsx)(Jp,{icon:pc,title:"Plugin Settings"}),(0,pn.jsx)(ZQ,{})]}),help:(0,pn.jsxs)(pn.Fragment,{children:[(0,pn.jsx)(Jp,{icon:Mu,title:"Help"}),(0,pn.jsx)(jF,{})]})}}componentDidMount(){this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,r=>{this.state.tab!==r&&this.setState({tab:r}),r==="none"&&this.plugin.layout.state.regionState.left!=="collapsed"&&st.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"collapsed"}}})}),this.subscribe(this.plugin.state.data.events.changed,({state:r})=>{this.state.tab==="data"&&r.cells.size===1&&this.set("root")})}render(){let r=this.state.tab;return(0,pn.jsxs)("div",{className:"msp-left-panel-controls",children:[(0,pn.jsxs)("div",{className:"msp-left-panel-controls-buttons",children:[(0,pn.jsx)(or,{svg:zP,toggleState:r==="root",transparent:!0,onClick:()=>this.set("root"),title:"Home"}),(0,pn.jsx)(QQ,{set:this.set}),(0,pn.jsx)(or,{svg:ww,toggleState:r==="states",transparent:!0,onClick:()=>this.set("states"),title:"Plugin State"}),(0,pn.jsx)(or,{svg:Mu,toggleState:r==="help",transparent:!0,onClick:()=>this.set("help"),title:"Help"}),(0,pn.jsx)("div",{className:"msp-left-panel-controls-buttons-bottom",children:(0,pn.jsx)(or,{svg:pc,toggleState:r==="settings",transparent:!0,onClick:()=>this.set("settings"),title:"Settings"})})]}),(0,pn.jsx)("div",{className:"msp-scrollable-container",children:this.tabs[r]})]})}},QQ=class extends Ir{constructor(){super(...arguments);this.state={changed:!1}}get tab(){return this.plugin.behaviors.layout.leftPanelTabName.value}componentDidMount(){this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,r=>{this.tab==="data"?this.setState({changed:!1}):this.forceUpdate()}),this.subscribe(this.plugin.state.data.events.changed,r=>{this.tab!=="data"&&this.setState({changed:!0})})}render(){return(0,pn.jsx)(or,{svg:yN,toggleState:this.tab==="data",transparent:!0,onClick:()=>this.props.set("data"),title:"State Tree",style:{position:"relative"},extraContent:this.state.changed?(0,pn.jsx)("div",{className:"msp-left-panel-controls-button-data-dirty"}):void 0})}},ZQ=class extends Ir{constructor(){super(...arguments);this.setSettings=r=>{st.Canvas3D.SetSettings(this.plugin,{settings:{[r.name]:r.value}})};this.setCanvas3DContextProps=r=>{this.plugin.canvas3dContext?.setProps({[r.name]:r.value}),this.plugin.events.canvas3d.settingsUpdated.next(void 0)}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.plugin.canvas3d&&this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(Cu(500,void 0,{leading:!0,trailing:!0})),r=>{(r.radiusMax!==void 0||r.radius!==void 0)&&this.forceUpdate()})}render(){return(0,pn.jsxs)(pn.Fragment,{children:[this.plugin.canvas3d&&this.plugin.canvas3dContext&&(0,pn.jsxs)(pn.Fragment,{children:[(0,pn.jsx)(Jp,{title:"Viewport"}),(0,pn.jsx)(Kn,{params:Ds,values:this.plugin.canvas3d.props,onChange:this.setSettings}),(0,pn.jsx)(Kn,{params:Tf.Params,values:this.plugin.canvas3dContext.props,onChange:this.setCanvas3DContextProps})]}),(0,pn.jsx)(Jp,{title:"Behavior"}),(0,pn.jsx)(zR,{state:this.plugin.state.behaviors})]})}},qQ=class extends Ir{constructor(){super(...arguments);this.remove=r=>{r.preventDefault(),st.State.RemoveObject(this.plugin,{state:this.plugin.state.data,ref:Ar.RootRef})}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.created,r=>{r.cell.transform.parent===Ar.RootRef&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,r=>{r.parent===Ar.RootRef&&this.forceUpdate()})}render(){return this.plugin.state.data.tree.children.get(Ar.RootRef).size===0?null:(0,pn.jsx)(or,{svg:Vs,onClick:this.remove,title:"Remove All",style:{display:"inline-block"},small:!0,className:"msp-no-hover-outline",transparent:!0})}};var M2e=Rt(Pi());var D2e=Rt(Pi());var xV=Rt(nr()),R2e=5,YQ={selected:"rgb(51, 255, 25)",highlighted:"rgb(255, 102, 153)",focused:""},CV=class extends Ir{constructor(){super(...arguments);this.parentDiv=D2e.createRef();this.lastMouseOverSeqIdx=-1;this.highlightQueue=new En;this.markerColors={...YQ};this.lociHighlightProvider=(r,n)=>{this.props.sequenceWrapper.markResidue(r.loci,n)&&this.updateMarker()};this.lociSelectionProvider=(r,n)=>{this.props.sequenceWrapper.markResidue(r.loci,n)&&this.updateMarker()};this.contextMenu=r=>{r.preventDefault()};this.mouseDownLoci=void 0;this.mouseDown=r=>{r.stopPropagation();let n=this.getSeqIdx(r),o=this.getLoci(n);this.mouseDownLoci=o};this.mouseUp=r=>{if(r.stopPropagation(),this.mouseDownLoci===void 0)return;let n=this.getSeqIdx(r),o=this.getLoci(n);if(o){let i=gS(r.nativeEvent),a=eA(r.nativeEvent),s=cL(r.nativeEvent),l=o;if(!K.Loci.areEqual(this.mouseDownLoci,o)){let u=this.mouseDownLoci.elements[0],c=o.elements[0],m=Math.min(Se.min(u.indices),Se.min(c.indices)),d=Math.max(Se.max(u.indices),Se.max(c.indices));l=K.Loci(o.structure,[{unit:u.unit,indices:Se.ofRange(m,d)}])}this.click(l,i,a,s)}this.mouseDownLoci=void 0};this.location=K.Location.create(void 0);this.mouseMove=r=>{r.stopPropagation();let n=gS(r.nativeEvent),o=eA(r.nativeEvent),i=cL(r.nativeEvent),a=r.target;if(!a||!a.getAttribute){if(this.lastMouseOverSeqIdx===-1)return;this.lastMouseOverSeqIdx=-1,this.highlightQueue.next({seqIdx:-1,buttons:n,button:o,modifiers:i});return}let s=a.hasAttribute("data-seqid")?+a.getAttribute("data-seqid"):-1;if(this.lastMouseOverSeqIdx!==s)if(this.lastMouseOverSeqIdx=s,this.mouseDownLoci!==void 0){let l=this.getLoci(s);this.hover(l,yu.Flag.None,yu.Flag.None,i)}else this.highlightQueue.next({seqIdx:s,buttons:n,button:o,modifiers:i})};this.mouseLeave=r=>{if(r.stopPropagation(),this.mouseDownLoci=void 0,this.lastMouseOverSeqIdx===-1)return;this.lastMouseOverSeqIdx=-1;let n=gS(r.nativeEvent),o=eA(r.nativeEvent),i=cL(r.nativeEvent);this.highlightQueue.next({seqIdx:-1,buttons:n,button:o,modifiers:i})}}get sequenceNumberPeriod(){return this.props.sequenceNumberPeriod!==void 0?this.props.sequenceNumberPeriod:this.props.sequenceWrapper.length>10?10:this.getSequenceNumber(this.props.sequenceWrapper.length-1).length>1?5:1}componentDidMount(){this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider),this.subscribe(this.highlightQueue.pipe(Cu(3*16.666,void 0,{leading:!0,trailing:!0})),r=>{let n=this.getLoci(r.seqIdx<0?void 0:r.seqIdx);this.hover(n,r.buttons,r.button,r.modifiers)}),this.subscribe(this.plugin.managers.structure.focus.behaviors.current,r=>{this.updateFocus(r?.loci),this.updateMarker()}),this.updateColors(),st.Canvas3D.SetSettings.subscribe(this.plugin,()=>{this.updateColors(),this.updateMarker()})}updateColors(){this.plugin.canvas3d?(this.markerColors.highlighted=Fe.toHexStyle(this.plugin.canvas3d.props.renderer.highlightColor),this.markerColors.selected=Fe.toHexStyle(this.plugin.canvas3d.props.renderer.selectColor)):(this.markerColors.highlighted=YQ.highlighted,this.markerColors.selected=YQ.selected)}updateFocus(r){this.props.sequenceWrapper.markResidue(Uh,"unfocus"),r&&this.props.sequenceWrapper.markResidue(r,"focus")}componentWillUnmount(){super.componentWillUnmount(),this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider)}getLoci(r){if(r!==void 0){let n=this.props.sequenceWrapper.getLoci(r);if(!K.Loci.isEmpty(n))return n}}getSeqIdx(r){let n,o=r.target;return o&&o.getAttribute&&(n=o.hasAttribute("data-seqid")?+o.getAttribute("data-seqid"):void 0),n}hover(r,n,o,i){let a={current:Vt.Loci.Empty,buttons:n,button:o,modifiers:i};if(r!==void 0&&!K.Loci.isEmpty(r)&&(a.current={loci:r},this.mouseDownLoci)){let s=this.mouseDownLoci.elements[0],l=r.elements[0],u=Math.min(Se.min(s.indices),Se.min(l.indices)),c=Math.max(Se.max(s.indices),Se.max(l.indices)),m=K.Loci(r.structure,[{unit:s.unit,indices:Se.ofRange(u,c)}]);a.current={loci:m}}this.plugin.behaviors.interaction.hover.next(a)}click(r,n,o,i){let a={current:Vt.Loci.Empty,buttons:n,button:o,modifiers:i};r!==void 0&&!K.Loci.isEmpty(r)&&(a.current={loci:r}),this.plugin.behaviors.interaction.click.next(a)}getBackgroundColor(r){let n=this.props.sequenceWrapper;return n.isHighlighted(r)?this.markerColors.highlighted:n.isSelected(r)?this.markerColors.selected:n.isFocused(r)?this.markerColors.focused:""}getResidueClass(r,n){let o=this.props.sequenceWrapper,i=[o.residueClass(r)];return n.length>1&&i.push(r===0?"msp-sequence-residue-long-begin":"msp-sequence-residue-long"),o.isHighlighted(r)&&i.push("msp-sequence-residue-highlighted"),o.isSelected(r)&&i.push("msp-sequence-residue-selected"),o.isFocused(r)&&i.push("msp-sequence-residue-focused"),i.join(" ")}residue(r,n){return(0,xV.jsx)("span",{"data-seqid":r,style:{backgroundColor:this.getBackgroundColor(r)},className:this.getResidueClass(r,n),children:`\u200B${n}\u200B`},r)}getSequenceNumberClass(r,n,o){let i=["msp-sequence-number"];return n.startsWith("-")?o.length>1&&r>0?i.push("msp-sequence-number-long-negative"):i.push("msp-sequence-number-negative"):o.length>1&&r>0&&i.push("msp-sequence-number-long"),i.join(" ")}getSequenceNumber(r){let n="",o=this.props.sequenceWrapper.getLoci(r),i=K.Loci.getFirstLocation(o,this.location);if(i)if(me.isAtomic(i.unit)){let a=qe.residue.auth_seq_id(i),s=qe.residue.pdbx_PDB_ins_code(i);n=`${a}${s||""}`}else me.isCoarse(i.unit)&&(n=`${r+1}`);return n}padSeqNum(r){return r.length<R2e?r+new Array(R2e-r.length+1).join("\xA0"):r}getSequenceNumberSpan(r,n){let o=this.getSequenceNumber(r);return(0,xV.jsx)("span",{className:this.getSequenceNumberClass(r,o,n),children:this.padSeqNum(o)},`marker-${r}`)}updateMarker(){if(!this.parentDiv.current)return;let r=this.parentDiv.current.children,n=!this.props.hideSequenceNumbers,o=this.sequenceNumberPeriod,i=this.props.sequenceWrapper,a=i.length,s=0;for(let l=0;l<a;l++){n&&l%o===0&&l<a&&s++;let u=r[s];if(!u)return;s++;let c=this.getResidueClass(l,i.residueLabel(l));u.className!==c&&(u.className=c);let m=this.getBackgroundColor(l);u.style.backgroundColor!==m&&(u.style.backgroundColor=m)}}render(){let r=this.props.sequenceWrapper,n=[],o=!this.props.hideSequenceNumbers,i=this.sequenceNumberPeriod;for(let a=0,s=r.length;a<s;++a){let l=r.residueLabel(a);o&&a%i===0&&a<s&&(n[n.length]=this.getSequenceNumberSpan(a,l)),n[n.length]=this.residue(a,l)}return this.updateFocus(this.plugin.managers.structure.focus.behaviors.current.value?.loci),this.updateMarker(),(0,xV.jsx)("div",{className:"msp-sequence-wrapper",onContextMenu:this.contextMenu,onMouseDown:this.mouseDown,onMouseUp:this.mouseUp,onMouseMove:this.mouseMove,onMouseLeave:this.mouseLeave,ref:this.parentDiv,children:n})}};var ug=class{constructor(t,r){this.data=t;this.length=r;this.markerArray=new Uint8Array(r),this.focusMarkerArray=new Uint8Array(r)}mark(t,r){let n=this.getSeqIndices(t);return Se.size(n)===0?!1:wx(this.markerArray,n,r)}markResidue(t,r){return r==="focus"?this.markResidueFocus(t,!0):r==="unfocus"?this.markResidueFocus(t,!1):Ji(t)?wx(this.markerArray,xe.ofLength(this.length),r):this.mark(t,r)}markResidueFocus(t,r){let n=r?1:0;if(Ji(t))return this.focusMarkerArray.fill(n,0,this.length),!0;{let o=this.getSeqIndices(t);return Se.forEach(o,i=>this.focusMarkerArray[i]=n),Se.size(o)>0}}isHighlighted(t){return!!(this.markerArray[t]&1)}isSelected(t){return!!(this.markerArray[t]&2)}isFocused(t){return!!this.focusMarkerArray[t]}};var SV=class extends ug{seqId(t){return this.sequence.seqId.value(t)}residueLabel(t){return this.sequence.label.value(t)||this.sequence.code.value(t)}residueColor(t){return this.missing.has(this.modelNum,this.asymId,this.seqId(t))?Lt.grey:Lt.black}residueClass(t){return this.missing.has(this.modelNum,this.asymId,this.seqId(t))?"msp-sequence-missing":"msp-sequence-present"}getSeqIndices(t){let{structure:r}=this.data,n=o=>this.sequence.index(o);if(K.Loci.is(t)){if(!De.areRootsEquivalent(t.structure,r))return xe.Empty;t=K.Loci.remap(t,r);let o=[];for(let i of t.elements)this.unitMap.has(i.unit.id)&&(me.isAtomic(i.unit)?Wdt(o,i,n):Xdt(o,i,n));return Be.deduplicate(Be.ofSortedArray(o))}else if(De.isLoci(t))return De.areRootsEquivalent(t.structure,r)?this.observed:xe.Empty;return xe.Empty}getLoci(t){let r=jdt(this.data.units[0].chainGroupId,this.data.units[0].conformation.operator.name,this.seqId(t));return at.toLociWithSourceUnits(LM.run(r,this.data.structure))}constructor(t){let r=K.Location.create(t.structure,t.units[0],t.units[0].elements[0]),n=t.units[0].model.sequence.byEntityKey[qe.entity.key(r)],o=n.sequence.length;super(t,o),this.unitMap=new Map;for(let a of t.units)this.unitMap.set(a.id,a);this.sequence=n.sequence,this.missing=t.units[0].model.properties.missingResidues,this.modelNum=t.units[0].model.modelNum,this.asymId=me.isAtomic(t.units[0])?qe.chain.label_asym_id(r):qe.coarse.asym_id(r);let i=[];for(let a=0;a<o;++a)this.missing.has(this.modelNum,this.asymId,this.seqId(a))&&i.push(a);this.observed=Se.subtract(xe.ofBounds(0,o),Be.ofSortedArray(i))}};function jdt(e,t,r){return Fn.generators.atoms({unitTest:n=>qe.unit.chainGroupId(n.element)===e&&qe.unit.operator_name(n.element)===t,residueTest:n=>n.element.unit.kind===me.Kind.Atomic?qe.residue.label_seq_id(n.element)===r:qe.coarse.seq_id_begin(n.element)<=r&&qe.coarse.seq_id_end(n.element)>=r})}function Wdt(e,t,r){let{model:n,elements:o}=t.unit,{index:i}=n.atomicHierarchy.residueAtomSegments,{label_seq_id:a}=n.atomicHierarchy.residues;return Se.forEachSegment(t.indices,s=>i[o[s]],s=>{let l=a.value(s),u=r(l);e.push(u)}),!0}function Xdt(e,t,r){let{model:n,elements:o}=t.unit,i=me.isSpheres(t.unit)?n.coarseHierarchy.spheres.seq_id_begin:n.coarseHierarchy.gaussians.seq_id_begin,a=me.isSpheres(t.unit)?n.coarseHierarchy.spheres.seq_id_end:n.coarseHierarchy.gaussians.seq_id_end;return Se.forEach(t.indices,s=>{let l=o[s];for(let u=r(i.value(l)),c=r(a.value(l));u<=c;u++)e.push(u)}),!0}var vV=class extends ug{residueLabel(t){return this.sequence[t]}residueColor(t){return Lt.black}residueClass(t){return"msp-sequence-present"}getSeqIndices(t){let{structure:r}=this.data;if(K.Loci.is(t)){if(!De.areRootsEquivalent(t.structure,r))return xe.Empty;t=K.Loci.remap(t,r);let n=[];for(let o of t.elements){let i=this.unitMap.get(o.unit.id);if(i){let{index:a}=o.unit.model.atomicHierarchy.residueAtomSegments;Se.forEach(o.indices,s=>{let l=this.sequenceIndices.get(a[i.elements[s]]);l!==void 0&&n.push(l)})}}return Be.deduplicate(Be.ofSortedArray(n))}else if(De.isLoci(t))return De.areRootsEquivalent(t.structure,r)?xe.ofBounds(0,this.length):xe.Empty;return xe.Empty}getLoci(t){let r=[],n=this.residueIndices.get(t);if(n!==void 0){let o=this.seqToUnit.get(t),{offsets:i}=o.model.atomicHierarchy.residueAtomSegments,a=Be.findPredecessorIndex(o.elements,i[n]),s=Be.findPredecessorIndex(o.elements,i[n+1]);r.push({unit:o,indices:xe.ofBounds(a,s)})}return K.Loci(this.data.structure,r)}constructor(t){let r=[],n=new Map,o=new Map,i=new Map;for(let s=0,l=t.units.length;s<l;++s){let u=t.units[s],{residueAtomSegments:c,atoms:m}=u.model.atomicHierarchy,d=Xt.transientSegments(c,u.elements);for(;d.hasNext;){let{index:p}=d.move();n.set(p,r.length),o.set(r.length,p),i.set(r.length,u),r.push(m.label_comp_id.value(c.offsets[p]))}}let a=r.length;super(t,a),this.unitMap=new Map;for(let s of t.units)this.unitMap.set(s.id,s);this.sequence=r,this.sequenceIndices=n,this.residueIndices=o,this.seqToUnit=i}};var jA=class extends ug{residueLabel(t){return this.label}residueColor(t){return Lt.black}residueClass(t){return"msp-sequence-present"}getSeqIndices(t){let{structure:r}=this.data;if(K.Loci.is(t)){if(!De.areRootsEquivalent(t.structure,r))return xe.Empty;t=K.Loci.remap(t,r);for(let n of t.elements){let o=this.unitIndices.get(n.unit.id);if(o&&Se.isSubset(o,n.indices))return xe.ofSingleton(0)}}else if(De.isLoci(t))return De.areRootsEquivalent(t.structure,r)?xe.ofSingleton(0):xe.Empty;return xe.Empty}getLoci(t){return this.loci}constructor(t){let r=0,n=0,o=[],i=K.Location.create(t.structure),a=new Map,s=[];for(let u=0,c=t.units.length;u<c;++u){let m=t.units[u];K.Location.set(i,t.structure,m,m.elements[0]);let d=m.model.sequence.byEntityKey[qe.entity.key(i)];d&&(r+=d.sequence.length),n+=m.elements.length;let p=xe.ofBounds(0,m.elements.length);a.set(m.id,p),s.push({unit:m,indices:p})}r>0&&o.push(`${r} residues`),o.push(`${n} elements`),super(t,1),this.label=`Whole Chain (${o.join(", ")})`,this.unitIndices=a,this.loci=K.Loci(this.data.structure,s)}};var IV=class extends ug{residueLabel(t){return"X"}residueColor(t){return Lt.black}residueClass(t){return"msp-sequence-present"}getSeqIndices(t){let{structure:r,units:n}=this.data;if(K.Loci.is(t)){if(!De.areRootsEquivalent(t.structure,r))return xe.Empty;t=K.Loci.remap(t,r);for(let o of t.elements){let i=this.unitIndices.get(o.unit.id);if(i&&Se.isSubset(i,o.indices))return o.indices}}else if(De.isLoci(t)){if(!De.areRootsEquivalent(t.structure,r))return xe.Empty;for(let o=0,i=n.length;o<i;++o)return this.unitIndices.get(n[o].id)}return xe.Empty}getLoci(t){let{units:r}=this.data,n=[],o=0;for(let i=0,a=r.length;i<a;++i){let s=r[i];if(t<o+s.elements.length){n.push({unit:s,indices:xe.ofSingleton(t-o)});break}o+=s.elements.length}return K.Loci(this.data.structure,n)}constructor(t){let r=0,n=new Map,o=[];for(let i=0,a=t.units.length;i<a;++i){let s=t.units[i];r+=s.elements.length;let l=xe.ofBounds(0,s.elements.length);n.set(s.id,l),o.push({unit:s,indices:l})}super(t,r),this.unitIndices=n}};var sa=Rt(nr()),KQ=5e3,$Q=1e3,Qdt=30;function B2e(e){let t=qe.unit.pdbx_struct_oper_list_ids(e),r=qe.unit.struct_ncs_oper_id(e),n=qe.unit.hkl(e),o=qe.unit.spgrOp(e);return`${t.sort().join(",")}|${r}|${n}|${o}`}function eZ(e){let[t,r]=e.split("|");return[parseInt(t),r]}function w2e(e,t){let{structure:r,modelEntityId:n,chainGroupId:o,operatorKey:i}=e,a=K.Location.create(r),[s,l]=eZ(n),u=[];for(let c of r.units)K.Location.set(a,r,c,c.elements[0]),r.getModelIndex(c.model)===s&&qe.entity.id(a)===l&&c.chainGroupId===o&&B2e(a)===i&&u.push(c);if(u.length>0){let c={structure:r,units:u},m=u[0],d;if(m.polymerElements.length){let p=K.Location.create(r,m,m.elements[0]),h=m.model.sequence.byEntityKey[qe.entity.key(p)];if(h&&h.sequence.length<=KQ)d=new SV(c);else{let f=u.reduce((y,g)=>y+g.polymerElements.length,0);me.isAtomic(m)||f>KQ?d=new jA(c):d=new IV(c)}}else me.isAtomic(m)?u.reduce((h,f)=>h+f.residueCount,0)>KQ?d=new jA(c):d=new vV(c):(console.warn("should not happen, expecting coarse units to be polymeric"),d=new jA(c));return d.markResidue(t.getLoci(r),4),d}else return"No sequence available"}function AV(e,t=!1){let r=[],n=K.Location.create(e),o=new Set;for(let i of e.units){K.Location.set(n,e,i,i.elements[0]);let a=qe.entity.id(n),s=e.getModelIndex(i.model),l=`${s}|${a}`;if(o.has(l)||t&&qe.entity.type(n)!=="polymer")continue;let u=qe.entity.pdbx_description(n).join(", ");e.models.length&&(e.representativeModel?u+=` (Model ${e.models[s].modelNum})`:u.startsWith("Polymer ")&&(u+=` (${e.models[s].entry})`));let c=`${a}: ${u}`;if(r.push([l,c]),o.add(l),r.length>$Q)return[["","Too many entities"]]}return r.length===0&&r.push(["","No entities"]),r}function HR(e,t){let r=[],n=K.Location.create(e),o=new Set,[i,a]=eZ(t);for(let s of e.units){if(K.Location.set(n,e,s,s.elements[0]),e.getModelIndex(s.model)!==i||qe.entity.id(n)!==a)continue;let l=s.chainGroupId;if(o.has(l))continue;let u=cd(n,{granularity:"chain",hidePrefix:!0,htmlStyling:!1});if(r.push([l,u]),o.add(l),r.length>$Q)return[[-1,"Too many chains"]]}return r.length===0&&r.push([-1,"No chains"]),r}function WA(e,t,r){let n=[],o=K.Location.create(e),i=new Set,[a,s]=eZ(t);for(let l of e.units){if(K.Location.set(o,e,l,l.elements[0]),e.getModelIndex(l.model)!==a||qe.entity.id(o)!==s||l.chainGroupId!==r)continue;let u=B2e(o);if(i.has(u))continue;let c=l.conformation.operator.name;if(n.push([u,c]),i.add(u),n.length>$Q)return[["","Too many operators"]]}return n.length===0&&n.push(["","No operators"]),n}function E2e(e){let t=[],r=[],n=e.select(er.Generators.rootsOfType(re.Molecule.Structure));for(let o of n)o.obj?.data&&(r.push(o.obj.data),t.push([o.transform.ref,o.obj.data.label]));return t.length===0&&t.push(["","No structure"]),{options:t,all:r}}var JQ=C.Select("single",[["single","Chain"],["polymers","Polymers"],["all","Everything"]]),TV=class extends Ir{constructor(){super(...arguments);this.state={structureOptions:{options:[],all:[]},structure:De.Empty,structureRef:"",modelEntityId:"",chainGroupId:-1,operatorKey:"",mode:"single",sequenceViewModeParam:JQ};this.setParamProps=r=>{let n={...this.state};switch(r.name){case"mode":if(n.mode=r.value,this.state.mode===n.mode)return;if(n.mode==="all"||n.mode==="polymers")break;case"structure":r.name==="structure"&&(n.structureRef=r.value),n.structure=this.getStructure(n.structureRef),n.modelEntityId=AV(n.structure)[0][0],n.chainGroupId=HR(n.structure,n.modelEntityId)[0][0],n.operatorKey=WA(n.structure,n.modelEntityId,n.chainGroupId)[0][0];break;case"entity":n.modelEntityId=r.value,n.chainGroupId=HR(n.structure,n.modelEntityId)[0][0],n.operatorKey=WA(n.structure,n.modelEntityId,n.chainGroupId)[0][0];break;case"chain":n.chainGroupId=r.value,n.operatorKey=WA(n.structure,n.modelEntityId,n.chainGroupId)[0][0];break;case"operator":n.operatorKey=r.value;break}this.setState(n)}}componentDidMount(){this.plugin.state.data.select(er.Generators.rootsOfType(re.Molecule.Structure)).length>0&&this.setState(this.getInitialState()),this.subscribe(this.plugin.state.events.object.updated,({ref:n,obj:o})=>{n===this.state.structureRef&&o&&o.type===re.Molecule.Structure.type&&o.data!==this.state.structure&&this.sync()}),this.subscribe(this.plugin.state.events.object.created,({obj:n})=>{n&&n.type===re.Molecule.Structure.type&&this.sync()}),this.subscribe(this.plugin.state.events.object.removed,({obj:n})=>{n&&n.type===re.Molecule.Structure.type&&this.sync()});let r=this.plugin.spec.components?.sequenceViewer?.modeOptions;if(r){let n=new Set(r),o={...JQ,options:JQ.options.filter(([i])=>n.has(i))};this.setState({sequenceViewModeParam:o})}}sync(){let r=E2e(this.plugin.state.data);kC(r.all,this.state.structureOptions.all)||this.setState(this.getInitialState())}getStructure(r){let o=this.plugin.state.data.select(r)[0];return!r||!o||!o.obj?De.Empty:o.obj.data}getSequenceWrapper(r){return{wrapper:w2e(this.state,this.plugin.managers.structure.selection),label:`${C.optionLabel(r.chain,this.state.chainGroupId)} | ${C.optionLabel(r.entity,this.state.modelEntityId)}`}}getSequenceWrappers(r){if(this.state.mode==="single")return[this.getSequenceWrapper(r)];let n=this.getStructure(this.state.structureRef),o=[];for(let[i,a]of AV(n,this.state.mode==="polymers"))for(let[s,l]of HR(n,i))for(let[u]of WA(n,i,s))if(o.push({wrapper:w2e({structure:n,modelEntityId:i,chainGroupId:s,operatorKey:u},this.plugin.managers.structure.selection),label:`${l} | ${a}`}),o.length>Qdt)return[];return o}getInitialState(){let r=E2e(this.plugin.state.data),n=r.options[0][0],o=this.getStructure(n),i=AV(o)[0][0],a=HR(o,i)[0][0],s=WA(o,i,a)[0][0];this.state.structure&&this.state.structure===o&&(i=this.state.modelEntityId,a=this.state.chainGroupId,s=this.state.operatorKey);let l=this.plugin.spec.components?.sequenceViewer?.defaultMode,u=this.props.defaultMode??l??"single";return{structureOptions:r,structure:o,structureRef:n,modelEntityId:i,chainGroupId:a,operatorKey:s,mode:u,sequenceViewModeParam:this.state.sequenceViewModeParam}}get params(){let{structureOptions:r,structure:n,modelEntityId:o,chainGroupId:i}=this.state,a=AV(n),s=HR(n,o),l=WA(n,o,i);return{structure:C.Select(r.options[0][0],r.options,{shortLabel:!0}),entity:C.Select(a[0][0],a,{shortLabel:!0}),chain:C.Select(s[0][0],s,{shortLabel:!0,twoColumns:!0,label:"Chain"}),operator:C.Select(l[0][0],l,{shortLabel:!0,twoColumns:!0}),mode:this.state.sequenceViewModeParam}}get values(){return{structure:this.state.structureRef,entity:this.state.modelEntityId,chain:this.state.chainGroupId,operator:this.state.operatorKey,mode:this.state.mode}}render(){if(this.getStructure(this.state.structureRef)===De.Empty)return(0,sa.jsx)("div",{className:"msp-sequence",children:(0,sa.jsxs)("div",{className:"msp-sequence-select",children:[(0,sa.jsx)(yn,{svg:Mu,style:{cursor:"help",position:"absolute",right:0,top:0},title:"Shows a sequence of one or more chains. Use the controls to alter selection."}),(0,sa.jsx)("span",{children:"Sequence"}),(0,sa.jsx)("span",{style:{fontWeight:"normal"},children:"No structure available"})]})});let r=this.params,n=this.values,o=this.getSequenceWrappers(r);return(0,sa.jsxs)("div",{className:"msp-sequence",children:[(0,sa.jsxs)("div",{className:"msp-sequence-select",children:[(0,sa.jsx)(yn,{svg:Mu,style:{cursor:"help",position:"absolute",right:0,top:0},title:`This shows a single sequence. Use the controls to show a different sequence. 
Use Ctrl or Cmd key to add a sequence range to focus; use Shift key to extend last focused/selected range.`}),(0,sa.jsx)("span",{children:"Sequence of"}),(0,sa.jsx)(og,{title:`[Structure] ${C.optionLabel(r.structure,n.structure)}`,param:r.structure,name:"structure",value:n.structure,onChange:this.setParamProps}),(0,sa.jsx)(og,{title:"[Mode]",param:this.state.sequenceViewModeParam,name:"mode",value:n.mode,onChange:this.setParamProps}),n.mode==="single"&&(0,sa.jsx)(og,{title:`[Entity] ${C.optionLabel(r.entity,n.entity)}`,param:r.entity,name:"entity",value:n.entity,onChange:this.setParamProps}),n.mode==="single"&&(0,sa.jsx)(og,{title:`[Chain] ${C.optionLabel(r.chain,n.chain)}`,param:r.chain,name:"chain",value:n.chain,onChange:this.setParamProps}),r.operator.options.length>1&&(0,sa.jsx)(sa.Fragment,{children:(0,sa.jsx)(og,{title:`[Instance] ${C.optionLabel(r.operator,n.operator)}`,param:r.operator,name:"operator",value:n.operator,onChange:this.setParamProps})})]}),(0,sa.jsx)(Zdt,{children:o.map((i,a)=>{let s=typeof i.wrapper=="string"?(0,sa.jsx)("div",{className:"msp-sequence-wrapper",children:i.wrapper},a):(0,sa.jsx)(CV,{sequenceWrapper:i.wrapper},a);return n.mode==="single"?s:(0,sa.jsxs)(M2e.Fragment,{children:[(0,sa.jsx)("div",{className:"msp-sequence-chain-label",children:i.label}),s]},a)})})]})}};function Zdt({children:e}){return(0,sa.jsx)("div",{className:"msp-sequence-wrapper-non-empty",children:e})}var cg=Rt(Pi());var pl=Rt(nr());function k2e(){let e=(0,cg.useContext)(vl),[t,r]=(0,cg.useState)(Us());return(0,cg.useEffect)(()=>{let n=e.events.task.progress.subscribe(i=>{let a=!!e.spec.components?.hideTaskOverlay;i.level==="background"&&(a||!i.useOverlay)&&r(s=>s.set(i.id,i))}),o=e.events.task.finished.subscribe(({id:i})=>{r(a=>a.delete(i))});return()=>{n.unsubscribe(),o.unsubscribe()}},[e]),(0,pl.jsxs)("div",{className:"msp-background-tasks",children:[t.valueSeq().map(n=>(0,pl.jsx)(PV,{event:n},n.id)),(0,pl.jsx)(qdt,{})]})}function qdt(){let e=(0,cg.useContext)(vl),t=vu(e.canvas3d?.commitQueueSize);return t?(0,pl.jsx)("div",{className:"msp-task-state",children:(0,pl.jsx)("div",{children:(0,pl.jsxs)("div",{children:["Commiting renderables... ",t," remaining"]})})}):null}var PV=class extends Ir{constructor(){super(...arguments);this.abort=()=>{this.plugin.managers.task.requestAbort(this.props.event.progress.root.progress.taskId,"User Request")}}render(){let r=this.props.event.progress.root,n=L2e(this.props.event.progress.root)-1,o=r.progress.isIndeterminate?void 0:(0,pl.jsxs)(pl.Fragment,{children:["[",r.progress.current,"/",r.progress.max,"]"]}),i=n>0?(0,pl.jsxs)(pl.Fragment,{children:["[",n," subtask(s)]"]}):void 0;return(0,pl.jsx)("div",{className:"msp-task-state",children:(0,pl.jsxs)("div",{children:[r.progress.canAbort&&(0,pl.jsx)(or,{svg:Rw,onClick:this.abort,title:"Abort"}),(0,pl.jsxs)("div",{children:[r.progress.message," ",o," ",i]})]})})}};function L2e(e){if(e.children.length===0)return 1;let t=0;for(let r of e.children)t+=L2e(r);return t}function F2e(){let e=(0,cg.useContext)(vl),[t,r]=(0,cg.useState)(Us());return(0,cg.useEffect)(()=>{let n=e.events.task.progress.subscribe(i=>{i.useOverlay&&r(a=>a.set(i.id,i))}),o=e.events.task.finished.subscribe(({id:i})=>{r(a=>a.delete(i))});return()=>{n.unsubscribe(),o.unsubscribe()}},[e]),t.size===0?null:(0,pl.jsx)("div",{className:"msp-overlay-tasks",children:t.valueSeq().map(n=>(0,pl.jsx)(PV,{event:n},n.id))})}var xd=Rt(nr()),tZ=class extends Ir{constructor(){super(...arguments);this.hide=()=>{(this.props.entry.hide||function(){}).call(null)}}render(){let r=this.props.entry,n=typeof r.message=="string"?(0,xd.jsx)("div",{dangerouslySetInnerHTML:{__html:r.message}}):(0,xd.jsx)("div",{children:(0,xd.jsx)(r.message,{})});return(0,xd.jsxs)("div",{className:"msp-toast-entry",children:[(0,xd.jsx)("div",{className:"msp-toast-title",onClick:()=>this.hide(),children:r.title}),(0,xd.jsx)("div",{className:"msp-toast-message",children:n}),(0,xd.jsx)("div",{className:"msp-toast-clear"}),(0,xd.jsx)("div",{className:"msp-toast-hide",children:(0,xd.jsx)(or,{svg:Rw,onClick:this.hide,title:"Hide",className:"msp-no-hover-outline"})})]})}},_V=class extends Ir{componentDidMount(){this.subscribe(this.plugin.managers.toast.events.changed,()=>this.forceUpdate())}render(){let t=this.plugin.managers.toast.state;if(!t.entries.count())return null;let r=[];return t.entries.forEach((n,o)=>r.push(n)),r.sort(function(n,o){return n.serialNumber-o.serialNumber}),(0,xd.jsx)("div",{className:"msp-toast-container",children:r.map(n=>(0,xd.jsx)(tZ,{entry:n},n.serialNumber))})}};var V2e=Rt(Pi());var Cp=Rt(nr()),RV=class extends Ir{constructor(){super(...arguments);this.container=V2e.createRef();this.mounted=!1;this.state={noWebGl:!1,showLogo:!0};this.handleLogo=()=>{this.setState({showLogo:!this.plugin.canvas3d?.reprCount.value})}}async applyMount(){try{let r=await this.plugin.mountAsync(this.container.current,{checkeredCanvasBackground:!0});if(!this.mounted)return;r||this.setState({noWebGl:!0}),this.handleLogo(),this.subscribe(this.plugin.canvas3d.reprCount,this.handleLogo)}catch(r){console.error(r),this.setState({noWebGl:!0})}}componentDidMount(){if(this.mounted=!0,!this.container.current){this.setState({noWebGl:!0});return}this.applyMount()}componentWillUnmount(){this.mounted=!1,super.componentWillUnmount(),this.plugin.unmount()}renderMissing(){if(this.props.noWebGl){let r=this.props.noWebGl;return(0,Cp.jsx)(r,{})}return(0,Cp.jsx)("div",{className:"msp-no-webgl",children:(0,Cp.jsxs)("div",{children:[(0,Cp.jsx)("p",{children:(0,Cp.jsx)("b",{children:"WebGL does not seem to be available."})}),(0,Cp.jsx)("p",{children:"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps. Also, make sure hardware acceleration is enabled in your browser."}),(0,Cp.jsxs)("p",{children:["For a list of supported browsers, refer to ",(0,Cp.jsx)("a",{href:"http://caniuse.com/#feat=webgl",target:"_blank",children:"http://caniuse.com/#feat=webgl"}),"."]})]})})}render(){if(this.state.noWebGl)return this.renderMissing();let r=this.props.logo;return(0,Cp.jsx)("div",{className:this.props.parentClassName||"msp-viewport",style:this.props.parentStyle,ref:this.container,children:this.state.showLogo&&r&&(0,Cp.jsx)(r,{})})}};var DV=Rt(Pi()),Im=Rt(Pi());var fl=Rt(nr()),Ydt=e=>{let{plugin:t,cropFrameColor:r}=e,n=t.helpers.viewportScreenshot,[o,i]=(0,Im.useState)(null),a=(0,Im.useRef)(null),s=(0,Im.useRef)(e);return(0,Im.useEffect)(()=>{s.current=e},Object.values(e)),(0,Im.useEffect)(()=>{o!==a.current&&i(a.current)}),(0,Im.useEffect)(()=>{let l=!1,u=[];function c(f,y){f&&u.push(f.subscribe(y))}function m(){let f=s.current;!f.suspend&&a.current&&O2e(t,n,a.current,f.customBackground,f.borderColor,f.borderWidth),a.current||(l=!0)}let d=setInterval(()=>{l&&(l=!1,m())},1e3/8);c(t.events.canvas3d.settingsUpdated,()=>l=!0),c(t.canvas3d?.didDraw,()=>l=!0),c(t.state.data.behaviors.isUpdating,f=>{f||(l=!0)}),c(n?.behaviors.values,()=>l=!0),c(n?.behaviors.cropParams,()=>l=!0);let p;typeof ResizeObserver<"u"&&(p=new ResizeObserver(()=>l=!0));let h=a.current;return p?.observe(h),m(),()=>{clearInterval(d),u.forEach(f=>f.unsubscribe()),p?.unobserve(h)}},[n]),(0,Im.useLayoutEffect)(()=>{a.current&&O2e(t,n,a.current,e.customBackground,e.borderColor,e.borderWidth)},[...Object.values(e)]),(0,fl.jsx)(fl.Fragment,{children:(0,fl.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%"},children:[(0,fl.jsx)("canvas",{ref:a,onContextMenu:l=>{l.preventDefault(),l.stopPropagation()},style:{display:"block",width:"100%",height:"100%"}}),(0,fl.jsx)(Kdt,{plugin:t,canvas:o,color:r})]})})},U2e=DV.memo(Ydt,(e,t)=>eb(e,t));async function O2e(e,t,r,n,o,i){let a=Pe.create("Render Screenshot",async s=>{if(!t)return;let l=await t.getPreview(s);if(!l)return;let u=r.getContext("2d");if(!u)return;let{canvas:c,width:m,height:d}=l,p=r.clientWidth,h=r.clientHeight;r.width=p,r.height=h,u.clearRect(0,0,p,h);let f=N2e(m,d,p,h);if(n)u.fillStyle=n,u.fillRect(f.x,f.y,f.width,f.height);else if(t.values.transparent)for(let g=0;g<f.width;g+=13)for(let x=0;x<f.height;x+=13){u.fillStyle=(g+x)%2?"#ffffff":"#bfbfbf";let S=f.x+g,I=f.y+x,v=g+13>f.width?f.width-g:13,A=x+13>f.height?f.height-x:13;u.fillRect(S,I,v,A)}if(u.drawImage(c,f.x,f.y,f.width,f.height),o&&i){let y=i;u.rect(f.x,f.y,f.width,f.height),u.rect(f.x+y,f.y+y,f.width-2*y,f.height-2*y),u.fillStyle=o,u.fill("evenodd")}});return e.runTask(a,{useOverlay:!0})}function Kdt({plugin:e,canvas:t,color:r="rgba(255, 87, 45, 0.75)"}){let n=e.helpers.viewportScreenshot,o=vu(n?.behaviors.values),i=vu(n?.behaviors.cropParams),a=vu(n?.behaviors.relativeCrop),s=(0,Im.useRef)({x:0,y:0,width:0,height:0});vu(o?.resolution.name==="viewport"?e.canvas3d?.resized:void 0);let[l,u]=DV.useState(""),[c,m]=(0,Im.useState)([0,0]),[d,p]=(0,Im.useState)([0,0]);if(!n||!t||!a)return null;let{width:h,height:f}=n.getSizeAndViewport(),y=N2e(h,f,t.clientWidth,t.clientHeight),g={x:y.x+Math.floor(y.width*a.x),y:y.y+Math.floor(y.height*a.y),width:Math.ceil(y.width*a.width),height:Math.ceil(y.height*a.height)},x=G2e(g),S=G2e(y);if(l==="move"?(x.l+=d[0]-c[0],x.r+=d[0]-c[0],x.t+=d[1]-c[1],x.b+=d[1]-c[1]):l&&(l.indexOf("left")>=0?x.l+=d[0]-c[0]:l.indexOf("right")>=0&&(x.r+=d[0]-c[0]),l.indexOf("top")>=0?x.t+=d[1]-c[1]:l.indexOf("bottom")>=0&&(x.b+=d[1]-c[1])),x.l>x.r){let L=x.l;x.l=x.r,x.r=L}if(x.t>x.b){let L=x.t;x.t=x.b,x.b=L}let I=40;x.l=Math.min(S.r-I,Math.max(S.l,x.l)),x.r=Math.max(S.l+I,Math.min(S.r,x.r)),x.t=Math.min(S.b-I,Math.max(S.t,x.t)),x.b=Math.max(S.t+I,Math.min(S.b,x.b)),g.x=x.l,g.y=x.t,g.width=x.r-x.l+1,g.height=x.b-x.t+1,s.current=g;let v=L=>{L.preventDefault(),p([L.pageX,L.pageY])},A=L=>{L.preventDefault();let V=L.touches[0];p([V.pageX,V.pageY])},_=L=>{L.preventDefault(),u(L.currentTarget.getAttribute("data-drag"));let V=L.touches[0],U=[V.pageX,V.pageY];m(U),p(U),window.addEventListener("touchend",D),window.addEventListener("touchmove",A)},T=L=>{L.preventDefault(),u(L.currentTarget.getAttribute("data-drag"));let V=[L.pageX,L.pageY];m(V),p(V),window.addEventListener("mouseup",w),window.addEventListener("mousemove",v)},w=()=>{window.removeEventListener("mouseup",w),window.removeEventListener("mousemove",v),M()},D=()=>{window.removeEventListener("touchend",D),window.removeEventListener("touchmove",A),M()};function M(){let L=s.current;i?.auto&&n?.behaviors.cropParams.next({...i,auto:!1}),n?.behaviors.relativeCrop.next({x:(L.x-y.x)/y.width,y:(L.y-y.y)/y.height,width:L.width/y.width,height:L.height/y.height}),u("");let V=[0,0];m(V),p(V)}let E=L=>{L.preventDefault(),L.stopPropagation()},R=4,k=`3px solid ${r}`,B="transparent";return(0,fl.jsxs)(fl.Fragment,{children:[(0,fl.jsx)("div",{"data-drag":"move",style:{position:"absolute",left:g.x,top:g.y,width:g.width,height:g.height,border:k,cursor:"move"},onMouseDown:T,onTouchStart:_,draggable:!1,onContextMenu:E}),(0,fl.jsx)("div",{"data-drag":"left",style:{position:"absolute",left:g.x-R,top:g.y+R,width:4*R,height:g.height-R,background:B,cursor:"w-resize"},onMouseDown:T,onTouchStart:_,draggable:!1,onContextMenu:E}),(0,fl.jsx)("div",{"data-drag":"right",style:{position:"absolute",left:x.r-2*R,top:g.y,width:4*R,height:g.height-R,background:B,cursor:"w-resize"},onMouseDown:T,onTouchStart:_,draggable:!1,onContextMenu:E}),(0,fl.jsx)("div",{"data-drag":"top",style:{position:"absolute",left:g.x-R,top:g.y-R,width:g.width+2*R,height:4*R,background:B,cursor:"n-resize"},onMouseDown:T,onTouchStart:_,draggable:!1,onContextMenu:E}),(0,fl.jsx)("div",{"data-drag":"bottom",style:{position:"absolute",left:g.x-R,top:x.b-2*R,width:g.width+2*R,height:4*R,background:B,cursor:"n-resize"},onMouseDown:T,onTouchStart:_,draggable:!1,onContextMenu:E}),(0,fl.jsx)("div",{"data-drag":"top, left",style:{position:"absolute",left:x.l-R,top:x.t-R,width:4*R,height:4*R,background:B,cursor:"nw-resize"},onMouseDown:T,onTouchStart:_,draggable:!1,onContextMenu:E}),(0,fl.jsx)("div",{"data-drag":"bottom, right",style:{position:"absolute",left:x.r-2*R,top:x.b-2*R,width:4*R,height:4*R,background:B,cursor:"nw-resize"},onMouseDown:T,onTouchStart:_,draggable:!1,onContextMenu:E}),(0,fl.jsx)("div",{"data-drag":"top, right",style:{position:"absolute",left:x.r-2*R,top:x.t-R,width:4*R,height:4*R,background:B,cursor:"ne-resize"},onMouseDown:T,onTouchStart:_,draggable:!1,onContextMenu:E}),(0,fl.jsx)("div",{"data-drag":"bottom, left",style:{position:"absolute",left:x.l-R,top:x.b-2*R,width:4*R,height:4*R,background:B,cursor:"ne-resize"},onMouseDown:T,onTouchStart:_,draggable:!1,onContextMenu:E})]})}function G2e(e){return{l:e.x,t:e.y,r:e.x+e.width-1,b:e.y+e.height-1}}function N2e(e,t,r,n){let o=e/t,i=r/n;if(o<=i){let a=n*o;return{x:Math.round((r-a)/2),y:0,width:Math.round(a),height:n}}else{let a=r/o;return{x:0,y:Math.round((n-a)/2),width:r,height:Math.round(a)}}}var EV=Rt(Pi());var bo=Rt(nr()),wV=class extends Ir{constructor(){super(...arguments);this.state={showPreview:!0,isDisabled:!1};this.download=()=>{this.plugin.helpers.viewportScreenshot?.download(),this.props.close()};this.copy=async()=>{try{await this.plugin.helpers.viewportScreenshot?.copyToClipboard(),st.Toast.Show(this.plugin,{message:"Copied to clipboard.",title:"Screenshot",timeoutMs:1500})}catch{return this.copyImg()}};this.copyImg=async()=>{let r=await this.plugin.helpers.viewportScreenshot?.getImageDataUri();this.setState({imageData:r})};this.open=r=>{!r.target.files||!r.target.files[0]||st.State.Snapshots.OpenFile(this.plugin,{file:r.target.files[0]})}}componentDidMount(){this.subscribe(this.plugin.state.data.behaviors.isUpdating,r=>{this.setState({isDisabled:r})})}componentWillUnmount(){super.componentWillUnmount(),this.setState({imageData:void 0})}render(){let r=!!navigator.clipboard?.write;return(0,bo.jsxs)("div",{children:[this.state.showPreview&&(0,bo.jsxs)("div",{className:"msp-image-preview",children:[(0,bo.jsx)(U2e,{plugin:this.plugin}),(0,bo.jsx)(tpt,{plugin:this.plugin})]}),(0,bo.jsxs)("div",{className:"msp-flex-row",children:[!this.state.imageData&&(0,bo.jsx)(sr,{icon:Kte,onClick:r?this.copy:this.copyImg,disabled:this.state.isDisabled,children:"Copy"}),this.state.imageData&&(0,bo.jsx)(sr,{onClick:()=>this.setState({imageData:void 0}),disabled:this.state.isDisabled,children:"Clear"}),(0,bo.jsx)(sr,{icon:NP,onClick:this.download,disabled:this.state.isDisabled,children:"Download"})]}),this.state.imageData&&(0,bo.jsxs)("div",{className:"msp-row msp-copy-image-wrapper",children:[(0,bo.jsx)("div",{children:"Right click below + Copy Image"}),(0,bo.jsx)("img",{src:this.state.imageData,style:{width:"100%",height:32,display:"block"}})]}),(0,bo.jsx)(ept,{plugin:this.plugin,isDisabled:this.state.isDisabled}),(0,bo.jsxs)(Ja,{header:"State",children:[(0,bo.jsx)(GR,{onAction:this.props.close}),(0,bo.jsx)(Ja,{header:"Save Options",initiallyExpanded:!1,noOffset:!0,children:(0,bo.jsx)(UR,{})})]}),(0,bo.jsx)(Ja,{header:"Camera",children:(0,bo.jsx)($dt,{plugin:this.plugin})})]})}};function jR(e){return`${e?.map(t=>qf(t,2)).join(", ")}`}function jS({title:e,children:t}){return(0,bo.jsxs)("div",{className:"msp-control-row",children:[(0,bo.jsx)("span",{className:"msp-control-row-label",children:e}),(0,bo.jsx)("div",{className:"msp-control-row-text",style:{fontSize:"0.85rem",overflow:"hidden",whiteSpace:"nowrap"},children:t})]})}function Jdt(e){if(e)return T1e(e.target,e.position,e.mode,e.fov)}function $dt({plugin:e}){let[,t]=(0,EV.useState)({});(0,EV.useEffect)(()=>{let i=e.canvas3d?.didDraw.subscribe(()=>t({}));return()=>i?.unsubscribe()},[e]);let r=e.canvas3d?.camera.state,n=Jdt(r),o=b.sub(b(),r?.target??b.origin,r?.position??b.origin);return b.normalize(o,o),(0,bo.jsxs)("div",{children:[(0,bo.jsx)(jS,{title:"Position",children:jR(r?.position)}),(0,bo.jsx)(jS,{title:"FoV Norm. Pos.",children:jR(n)}),(0,bo.jsx)(jS,{title:"Target",children:jR(r?.target)}),(0,bo.jsx)(jS,{title:"Direction",children:jR(o)}),(0,bo.jsx)(jS,{title:"Up",children:jR(r?.up)}),(0,bo.jsx)(jS,{title:"Distance",children:qf(b.distance(r?.position??b.origin,r?.target??b.origin),2)}),(0,bo.jsx)(jS,{title:"Radius",children:qf(r?.radius??0,2)}),(0,bo.jsx)(sr,{onClick:()=>{if(!navigator.clipboard)return;let i=`{
    position: [${n?.map(a=>qf(a,2)).join(", ")}],
    target: [${r?.target.map(a=>qf(a,2)).join(", ")}],
    up: [${r?.up.map(a=>qf(a,2)).join(", ")}],
}`;navigator.clipboard.writeText(i)},style:{marginTop:1},title:"Copy JSON usable in MolViewSpec, uses FoV Normalized Position",children:"Copy MVS JSON"})]})}function ept({plugin:e,isDisabled:t}){let r=e.helpers.viewportScreenshot,n=vu(r?.behaviors.values);return r?(0,bo.jsx)(Kn,{params:r.params,values:n,onChangeValues:o=>r.behaviors.values.next(o),isDisabled:t}):null}function tpt({plugin:e}){let t=e.helpers.viewportScreenshot,r=vu(t?.behaviors.cropParams);return vu(t?.behaviors.relativeCrop),!t||!r?null:(0,bo.jsxs)("div",{style:{width:"100%",height:"24px",marginTop:"8px"},children:[(0,bo.jsx)(di,{icon:ere,title:"Auto-crop",inline:!0,isSelected:r.auto,style:{background:"transparent",float:"left",width:"auto",height:"24px",lineHeight:"24px"},toggle:()=>t.toggleAutocrop(),label:"Auto-crop "+(r.auto?"On":"Off")}),!r.auto&&(0,bo.jsx)(sr,{icon:Jte,title:"Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:()=>t.autocrop()}),!r.auto&&!t.isFullFrame&&(0,bo.jsx)(sr,{icon:$te,title:"Reset Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:()=>t.resetCrop()})]})}function z2e(e){return({values:t,update:r,apply:n})=>({params:typeof e.params=="function"?e.params:o=>e.params,getTarget:e.target,getValues:t,update(o,i){let a=e.target(i);return su(a,s=>r(o,s,i))},apply:n||(()=>{})})}var WS=Rt(nr()),MV=class extends Ir{componentDidMount(){this.plugin.canvas3d&&(this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(Cu(500,void 0,{leading:!0,trailing:!0})),t=>{(t.radiusMax!==void 0||t.radius!==void 0)&&this.forceUpdate()}))}render(){return this.plugin.canvas3d?(0,WS.jsxs)(WS.Fragment,{children:[(0,WS.jsx)(wF,{mapping:npt}),(0,WS.jsx)(NS,{})]}):null}},WR={sequence:"Sequence",log:"Log",left:"Left Panel",right:"Right Panel"},rpt={animate:Ds.trackball.params.animate,camera:Ds.camera,background:C.Group({color:C.Color(16579577,{label:"Background",description:"Custom background color"}),transparent:C.Boolean(!1),style:Ds.postprocessing.params.background},{pivot:"color"}),lighting:C.Group({occlusion:Ds.postprocessing.params.occlusion,shadow:Ds.postprocessing.params.shadow,outline:Ds.postprocessing.params.outline,dof:Ds.postprocessing.params.dof,fog:Ds.cameraFog},{isFlat:!0}),clipping:C.Group({...Ds.cameraClipping.params},{pivot:"radius"}),layout:C.MultiSelect([],C.objectToOptions(WR)),advanced:C.Group({illumination:Ds.illumination,multiSample:Ds.multiSample,hiZ:Ds.hiZ,sharpening:Ds.postprocessing.params.sharpening,bloom:Ds.postprocessing.params.bloom,resolutionMode:Tf.Params.resolutionMode,pixelScale:Tf.Params.pixelScale,transparency:Tf.Params.transparency})},npt=z2e({params:e=>{let t=C.clone(rpt),r=e.spec.components?.controls;if(r){let o=[];r.top!=="none"&&o.push(["sequence",WR.sequence]),r.bottom!=="none"&&o.push(["log",WR.log]),r.left!=="none"&&o.push(["left",WR.left]),r.right!=="none"&&o.push(["right",WR.right]),t.layout.options=o}let n=e.config.get(Lr.Background.Styles)||[];return n.length>0&&Object.assign(t.background.params.style,{presets:Ya(n),isFlat:!1}),t},target(e){let t=e.spec.components?.controls,r=e.layout.state.regionState,n=[];r.top!=="hidden"&&(!t||t.top!=="none")&&n.push("sequence"),r.bottom!=="hidden"&&(!t||t.bottom!=="none")&&n.push("log"),r.left!=="hidden"&&(!t||t.left!=="none")&&n.push("left"),r.right!=="hidden"&&(!t||t.right!=="none")&&n.push("right");let{pixelScale:o,transparency:i,resolutionMode:a}=e.canvas3dContext?.props;return{canvas:e.canvas3d?.props,layout:n,resolutionMode:a,pixelScale:o,transparency:i}}})({values(e,t){let{canvas:r}=e,n=r.renderer;return{layout:e.layout,animate:r.trackball.animate,camera:r.camera,background:{color:n.backgroundColor,transparent:r.transparentBackground,style:r.postprocessing.background},lighting:{occlusion:r.postprocessing.occlusion,shadow:r.postprocessing.shadow,outline:r.postprocessing.outline,dof:r.postprocessing.dof,fog:r.cameraFog},clipping:{...r.cameraClipping},advanced:{illumination:r.illumination,multiSample:r.multiSample,hiZ:r.hiZ,sharpening:r.postprocessing.sharpening,bloom:r.postprocessing.bloom,resolutionMode:e.resolutionMode,pixelScale:e.pixelScale,transparency:e.transparency}}},update(e,t){let r=t.canvas;r.trackball.animate=e.animate,r.camera=e.camera,r.transparentBackground=e.background.transparent,r.renderer.backgroundColor=e.background.color,r.postprocessing.occlusion=e.lighting.occlusion,r.postprocessing.shadow=e.lighting.shadow,r.postprocessing.outline=e.lighting.outline,r.postprocessing.background=e.background.style,r.cameraFog=e.lighting.fog,r.cameraClipping={radius:e.clipping.radius,far:e.clipping.far,minNear:e.clipping.minNear},r.illumination=e.advanced.illumination,r.multiSample=e.advanced.multiSample,r.hiZ=e.advanced.hiZ,r.postprocessing.sharpening=e.advanced.sharpening,r.postprocessing.bloom=e.advanced.bloom,r.postprocessing.dof=e.lighting.dof,t.layout=e.layout,t.resolutionMode=e.advanced.resolutionMode,t.pixelScale=e.advanced.pixelScale,t.transparency=e.advanced.transparency},async apply(e,t){await st.Canvas3D.SetSettings(t,{settings:e.canvas});let r=e.layout.indexOf("left")<0,n=su(t.layout.state,o=>{o.regionState.top=e.layout.indexOf("sequence")>=0?"full":"hidden",o.regionState.bottom=e.layout.indexOf("log")>=0?"full":"hidden",o.regionState.left=r?"hidden":t.behaviors.layout.leftPanelTabName.value==="none"?"collapsed":"full",o.regionState.right=e.layout.indexOf("right")>=0?"full":"hidden"});await st.Layout.Update(t,{state:n}),r&&st.State.SetCurrentObject(t,{state:t.state.data,ref:Ar.RootRef}),t.canvas3dContext?.setProps({resolutionMode:e.resolutionMode,pixelScale:e.pixelScale,transparency:e.transparency})}});var mi=Rt(nr()),BV=class extends Ir{constructor(){super(...arguments);this.allCollapsedState={isSettingsExpanded:!1,isScreenshotExpanded:!1};this.state={...this.allCollapsedState,isCameraResetEnabled:!0};this.resetCamera=()=>{st.Camera.Reset(this.plugin,{})};this.toggleSettingsExpanded=this.toggle("isSettingsExpanded");this.toggleScreenshotExpanded=this.toggle("isScreenshotExpanded");this.toggleControls=()=>{st.Layout.Update(this.plugin,{state:{showControls:!this.plugin.layout.state.showControls}})};this.toggleExpanded=()=>{st.Layout.Update(this.plugin,{state:{isExpanded:!this.plugin.layout.state.isExpanded}})};this.setSettings=r=>{st.Canvas3D.SetSettings(this.plugin,{settings:{[r.name]:r.value}})};this.setLayout=r=>{st.Layout.Update(this.plugin,{state:{[r.name]:r.value}})};this.screenshot=()=>{this.plugin.helpers.viewportScreenshot?.download()};this.enableCameraReset=r=>{this.setState(n=>({...n,isCameraResetEnabled:r}))}}toggle(r){return n=>{this.setState(o=>({...o,...this.allCollapsedState,[r]:!this.state[r]})),n?.currentTarget.blur()}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.plugin.canvas3d&&this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(Cu(500,void 0,{leading:!0,trailing:!0})),r=>this.enableCameraReset(r.radius!==0&&r.radiusMax!==0))}icon(r,n,o,i=!0){return(0,mi.jsx)(or,{svg:r,toggleState:i,onClick:n,title:o,style:{background:"transparent"}})}render(){return(0,mi.jsxs)("div",{className:"msp-viewport-controls",children:[(0,mi.jsxs)("div",{className:"msp-viewport-controls-buttons",children:[(0,mi.jsxs)("div",{className:"msp-hover-box-wrapper",children:[(0,mi.jsx)("div",{className:"msp-semi-transparent-background"}),this.icon(Hte,this.resetCamera,"Reset Zoom"),(0,mi.jsx)("div",{className:"msp-hover-box-body",children:(0,mi.jsxs)("div",{className:"msp-flex-column",children:[(0,mi.jsx)("div",{className:"msp-flex-row",children:(0,mi.jsx)(sr,{onClick:()=>this.resetCamera(),disabled:!this.state.isCameraResetEnabled,title:"Set camera zoom to fit the visible scene into view",children:"Reset Zoom"})}),(0,mi.jsx)("div",{className:"msp-flex-row",children:(0,mi.jsx)(sr,{onClick:()=>st.Camera.OrientAxes(this.plugin),disabled:!this.state.isCameraResetEnabled,title:"Align principal component axes of the loaded structures to the screen axes (\u201Clay flat\u201D)",children:"Orient Axes"})}),(0,mi.jsx)("div",{className:"msp-flex-row",children:(0,mi.jsx)(sr,{onClick:()=>st.Camera.ResetAxes(this.plugin),disabled:!this.state.isCameraResetEnabled,title:"Align Cartesian axes to the screen axes",children:"Reset Axes"})})]})}),(0,mi.jsx)("div",{className:"msp-hover-box-spacer"})]}),this.plugin.config.get(Lr.Viewport.ShowScreenshotControls)&&(0,mi.jsxs)("div",{children:[(0,mi.jsx)("div",{className:"msp-semi-transparent-background"}),this.icon(Xte,this.toggleScreenshotExpanded,"Screenshot / State Snapshot",this.state.isScreenshotExpanded)]}),(0,mi.jsxs)("div",{children:[(0,mi.jsx)("div",{className:"msp-semi-transparent-background"}),this.plugin.config.get(Lr.Viewport.ShowControls)&&this.icon(jte,this.toggleControls,"Toggle Controls Panel",this.plugin.layout.state.showControls),this.plugin.config.get(Lr.Viewport.ShowExpand)&&this.icon(tre,this.toggleExpanded,"Toggle Expanded Viewport",this.plugin.layout.state.isExpanded),this.plugin.config.get(Lr.Viewport.ShowSettings)&&this.icon(pc,this.toggleSettingsExpanded,"Settings / Controls Info",this.state.isSettingsExpanded)]}),this.plugin.config.get(Lr.Viewport.ShowSelectionMode)&&(0,mi.jsxs)("div",{children:[(0,mi.jsx)("div",{className:"msp-semi-transparent-background"}),(0,mi.jsx)(lC,{})]})]}),this.state.isScreenshotExpanded&&(0,mi.jsx)("div",{className:"msp-viewport-controls-panel",children:(0,mi.jsx)(Cl,{header:"Screenshot / State",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleScreenshotExpanded,topRightIcon:dc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,mi.jsx)(wV,{close:this.toggleScreenshotExpanded})})}),this.state.isSettingsExpanded&&(0,mi.jsx)("div",{className:"msp-viewport-controls-panel",children:(0,mi.jsx)(Cl,{header:"Settings / Controls Info",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleSettingsExpanded,topRightIcon:dc,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,mi.jsx)(MV,{})})})]})}},opt=()=>(0,mi.jsx)("a",{className:"msp-logo",href:"https://molstar.org",target:"_blank"}),H2e=()=>(0,mi.jsx)(RV,{logo:opt});var rZ={};Bi(rZ,{DownloadFile:()=>ipt,OpenFiles:()=>XR});async function kV(e,t,r,n){let o=Hy(e.file?.name??""),i=t.dataFormats.binaryExtensions.has(o.ext),{data:a}=await t.builders.data.readFile({file:e,isBinary:i}),s=r==="auto"?t.dataFormats.auto(o,a.cell?.obj):t.dataFormats.get(r);if(!s){t.log.warn(`OpenFiles: could not find data provider for '${o.ext}'`),await t.state.data.build().delete(a).commit();return}let l=await s.parse(t,a);n&&await s.visuals?.(t,l)}var XR=Ss.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:re.Root,params:(e,t)=>{let{extensions:r,options:n}=t.dataFormats;return{files:C.FileList({accept:Array.from(r.values()).map(o=>`.${o}`).join(",")+",.gz,.zip",multiple:!0}),format:C.MappedStatic("auto",{auto:C.EmptyGroup(),specific:C.Select(n[0][0],n)}),visuals:C.Boolean(!0,{description:"Add default visuals"})}}})(({params:e,state:t},r)=>Pe.create("Open Files",async n=>{r.behaviors.layout.leftPanelTabName.next("data"),await t.transaction(async()=>{if(e.files===null){r.log.error("No file(s) selected");return}for(let o of e.files)try{if(o.file&&o.name.toLowerCase().endsWith(".zip")){let i=await ex(n,await o.file.arrayBuffer());for(let[a,s]of Object.entries(i)){if(!(s instanceof Uint8Array)||s.length===0)continue;let l=Zr.File(new File([s],a));await kV(l,r,"auto",e.visuals)}}else{let i=e.format.name==="auto"?"auto":e.format.params;await kV(o,r,i,e.visuals)}}catch(i){console.error(i),r.log.error(`Error opening file '${o.name}'`)}}).runInContext(n)})),ipt=Ss.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:re.Root,params:(e,t)=>{let r=[...t.dataFormats.options,["zip","Zip"],["gzip","Gzip"]];return{url:C.Url(""),format:C.Select(r[0][0],r),isBinary:C.Boolean(!1),visuals:C.Boolean(!0,{description:"Add default visuals"})}}})(({params:e,state:t},r)=>Pe.create("Open Files",async n=>{r.behaviors.layout.leftPanelTabName.next("data"),await t.transaction(async()=>{try{if(e.format==="zip"||e.format==="gzip"){let o=await r.builders.data.download({url:e.url,isBinary:!0});if(e.format==="zip"){let i=await ex(n,(o.obj?.data).buffer);for(let[a,s]of Object.entries(i)){if(!(s instanceof Uint8Array)||s.length===0)continue;let l=Zr.File(new File([s],a));await kV(l,r,"auto",e.visuals)}}else{let i=Zr.getUrl(e.url),a=Hy(i).name;await kV(Zr.File(new File([o.obj?.data],a)),r,"auto",e.visuals)}}else{let o=r.dataFormats.get(e.format);if(!o){r.log.warn(`DownloadFile: could not find data provider for '${e.format}'`);return}let i=await r.builders.data.download({url:e.url,isBinary:e.isBinary}),a=await o.parse(r,i);e.visuals&&await o.visuals?.(r,a)}}catch(o){console.error(o),r.log.error(`Error downloading '${typeof e.url=="string"?e.url:e.url.url}'`)}}).runInContext(n)}));var Jn=Rt(nr());function j2e({plugin:e}){return e.isInitialized?(0,Jn.jsx)(vl.Provider,{value:e,children:(0,Jn.jsx)(LV,{})}):(0,Jn.jsx)(apt,{plugin:e})}function apt({plugin:e}){let[t,r]=XS.useState({kind:"pending"});return XS.useEffect(()=>{r({kind:"pending"});let n=!0;return e.initialized.then(()=>{n&&r({kind:"initialized"})}).catch(o=>{n&&r({kind:"error",message:`${o}`})}),()=>{n=!1}},[e]),t.kind==="pending"?null:t.kind==="error"?(0,Jn.jsx)("div",{className:"msp-plugin",children:(0,Jn.jsxs)("div",{className:"msp-plugin-init-error",children:["Initialization error: ",t.message]})}):(0,Jn.jsx)(vl.Provider,{value:e,children:(0,Jn.jsx)(LV,{})})}var LV=class extends Ir{constructor(){super(...arguments);this.onDrop=r=>{r.preventDefault();let n=[];if(r.dataTransfer.items)for(let i=0;i<r.dataTransfer.items.length;i++){if(r.dataTransfer.items[i].kind!=="file")continue;let a=r.dataTransfer.items[i].getAsFile();a&&n.push(a)}else for(let i=0;i<r.dataTransfer.files.length;i++){let a=r.dataTransfer.files[i];a&&n.push(a)}let o=n.filter(i=>{let a=i.name.toLowerCase();return a.endsWith(".molx")||a.endsWith(".molj")});o.length>0?st.State.Snapshots.OpenFile(this.plugin,{file:o[0]}):this.plugin.runTask(this.plugin.state.data.applyAction(XR,{files:n.map(i=>Zr.File(i)),format:{name:"auto",params:{}},visuals:!0}))};this.onDragOver=r=>{r.preventDefault()};this.showDragOverlay=new Pa(!1);this.onDragEnter=r=>{let n=!1;if(r.dataTransfer.items&&r.dataTransfer.items.length>0){for(let o=0;o<r.dataTransfer.items.length;o++)if(r.dataTransfer.items[o].kind==="file"){n=!0;break}}else for(let o=0;o<r.dataTransfer.types.length;o++)if(r.dataTransfer.types[o]==="Files"){n=!0;break}n&&this.showDragOverlay.next(!0)}}componentDidMount(){this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate())}region(r,n){return(0,Jn.jsx)("div",{className:`msp-layout-region msp-layout-${r}`,children:(0,Jn.jsx)("div",{className:"msp-layout-static",children:n?(0,Jn.jsx)(n,{}):null})})}get layoutVisibilityClassName(){let r=this.plugin.layout.state,n=this.plugin.spec.components?.controls??{},o=[];return(n.top==="none"||!r.showControls||r.regionState.top==="hidden")&&o.push("msp-layout-hide-top"),n.left==="none"||!r.showControls||r.regionState.left==="hidden"?o.push("msp-layout-hide-left"):r.regionState.left==="collapsed"&&o.push("msp-layout-collapse-left"),(n.right==="none"||!r.showControls||r.regionState.right==="hidden")&&o.push("msp-layout-hide-right"),(n.bottom==="none"||!r.showControls||r.regionState.bottom==="hidden")&&o.push("msp-layout-hide-bottom"),o.join(" ")}get layoutClassName(){let r=this.plugin.layout.state,n=["msp-plugin-content"];return r.isExpanded?n.push("msp-layout-expanded"):n.push("msp-layout-standard",`msp-layout-standard-${r.controlsDisplay}`),n.join(" ")}render(){let r=this.plugin.layout.state,n=this.plugin.spec.components?.controls||{},o=this.plugin.spec.components?.viewport?.view||oZ,i=this.plugin.spec.components?.sequenceViewer?.view||TV;return(0,Jn.jsx)("div",{className:"msp-plugin",children:(0,Jn.jsxs)("div",{className:this.layoutClassName,onDragEnter:this.onDragEnter,children:[(0,Jn.jsxs)("div",{className:this.layoutVisibilityClassName,children:[this.region("main",o),r.showControls&&n.top!=="none"&&this.region("top",n.top||i),r.showControls&&n.left!=="none"&&this.region("left",n.left||bV),r.showControls&&n.right!=="none"&&this.region("right",n.right||nZ),r.showControls&&n.bottom!=="none"&&this.region("bottom",n.bottom||iZ)]}),!this.plugin.spec.components?.hideTaskOverlay&&(0,Jn.jsx)(F2e,{}),!this.plugin.spec.components?.disableDragOverlay&&(0,Jn.jsx)(lpt,{plugin:this.plugin,showDragOverlay:this.showDragOverlay})]})})}};function spt(e,t,r){e.preventDefault(),e.stopPropagation(),r.next(!1);let n=[];if(e.dataTransfer.items)for(let o=0;o<e.dataTransfer.items.length;o++){if(e.dataTransfer.items[o].kind!=="file")continue;let i=e.dataTransfer.items[o].getAsFile();i&&n.push(i)}else for(let o=0;o<e.dataTransfer.files.length;o++){let i=e.dataTransfer.files[o];i&&n.push(i)}t.managers.dragAndDrop.handle(n)}function lpt({plugin:e,showDragOverlay:t}){let r=vu(t),n=o=>{o.dataTransfer.dropEffect="copy",o.preventDefault(),o.stopPropagation()};return(0,Jn.jsx)("div",{className:"msp-drag-drop-overlay",style:{display:r?"flex":"none"},onDragEnter:n,onDragOver:n,onDragLeave:()=>t.next(!1),onDrop:o=>spt(o,e,t),children:"Load File(s)"})}var nZ=class extends Ir{render(){let t=this.plugin.spec.components?.structureTools||hV;return(0,Jn.jsx)("div",{className:"msp-scrollable-container",children:(0,Jn.jsx)(t,{})})}},oZ=class extends Ir{render(){let t=this.plugin.spec.components?.viewport?.controls||BV,r=this.plugin.spec.components?.selectionTools?.controls||pV,n=this.plugin.spec.components?.viewport?.snapshotDescription||T2e;return(0,Jn.jsxs)(Jn.Fragment,{children:[(0,Jn.jsx)(H2e,{}),(0,Jn.jsxs)("div",{className:"msp-viewport-top-left-controls",children:[(0,Jn.jsx)(dV,{}),(0,Jn.jsx)(cV,{}),(0,Jn.jsx)(mV,{}),(0,Jn.jsx)(n,{})]}),(0,Jn.jsx)(r,{}),(0,Jn.jsx)(t,{}),(0,Jn.jsx)(k2e,{}),(0,Jn.jsxs)("div",{className:"msp-highlight-toast-wrapper",children:[(0,Jn.jsx)(fV,{}),(0,Jn.jsx)(_V,{})]})]})}},iZ=class extends Ir{constructor(){super(...arguments);this.wrapper=XS.createRef();this.state={entries:this.plugin.log.entries}}componentDidMount(){this.subscribe(this.plugin.events.log,()=>this.setState({entries:this.plugin.log.entries}))}componentDidUpdate(){this.scrollToBottom()}scrollToBottom(){let r=this.wrapper.current;r&&(r.scrollTop=r.scrollHeight-r.clientHeight-1)}render(){let n=this.state.entries,o=n.size,i=[];for(let a=Math.max(0,o-10),s=0;a<o;a++){let l=n.get(a);i.push((0,Jn.jsxs)("li",{children:[(0,Jn.jsx)("div",{className:"msp-log-entry-badge msp-log-entry-"+l.type}),(0,Jn.jsx)("div",{className:"msp-log-timestamp",children:pee(l.timestamp)}),(0,Jn.jsx)("div",{className:"msp-log-entry",children:l.message})]},s++))}return(0,Jn.jsx)("div",{ref:this.wrapper,className:"msp-log",style:{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",overflowY:"auto"},children:(0,Jn.jsx)("ul",{className:"msp-list-unstyled",children:i})})}};var FV;(t=>{class e{constructor(){this.providers=Us().asMutable();this.defaultAutoAttachValues=new Map}getParams(n){let o={},i=[],a=[];if(n){let s=this.providers.values();for(;;){let l=s.next();if(l.done)break;let u=l.value;u.isApplicable(n)&&(u.isHidden||(i.push([u.descriptor.name,u.label]),this.defaultAutoAttachValues.get(u.descriptor.name)&&a.push(u.descriptor.name)),o[u.descriptor.name]=C.Group({...u.getParams(n)},{label:u.label,isHidden:u.isHidden}))}}return{autoAttach:C.MultiSelect(a,i),properties:C.Group(o,{isFlat:!0})}}setDefaultAutoAttach(n,o){this.defaultAutoAttachValues.set(n,o)}get(n){if(!this.providers.get(n))throw new Error(`Custom property '${n}' is not registered.`);return this.providers.get(n)}register(n,o){this.providers.set(n.descriptor.name,n),this.defaultAutoAttachValues.set(n.descriptor.name,o)}unregister(n){this.providers.delete(n),this.defaultAutoAttachValues.delete(n)}}t.Registry=e})(FV||={});var VV=class{constructor(t){this.plugin=t}get dataState(){return this.plugin.state.data}rawData(t,r){return this.dataState.build().toRoot().apply(h7,t,r).commit({revertOnError:!0})}download(t,r){return this.dataState.build().toRoot().apply($0,t,r).commit({revertOnError:!0})}downloadBlob(t,r){return this.dataState.build().toRoot().apply(f7,t,r).commit({revertOnError:!0})}async readFile(t,r){let n=await this.dataState.build().toRoot().apply(g7,t,r).commit({revertOnError:!0}),o=Hy(t.file?.file?.name??"");return{data:n,fileInfo:o}}};var OV=class{constructor(t){this.plugin=t;this._providers=[];this.providerMap=new Map;this.defaultProvider=Yl.auto;gi(Yl,r=>this.registerPreset(r))}get dataState(){return this.plugin.state.data}resolveProvider(t){return typeof t=="string"?Yl[t]??z1(this._providers,r=>r.id===t):t}hasPreset(t){for(let r of this._providers)if(!r.isApplicable||r.isApplicable(t,this.plugin))return!0;return!1}get providers(){return this._providers}getPresets(t){if(!t)return this.providers;let r=[];for(let n of this._providers)n.isApplicable&&!n.isApplicable(t,this.plugin)||r.push(n);return r}getPresetSelect(t){let r=[];for(let n of this._providers)t&&n.isApplicable&&!n.isApplicable(t,this.plugin)||r.push([n.id,n.display.name,n.display.group]);return C.Select("auto",r)}getPresetsWithOptions(t){let r=[],n=Object.create(null);for(let o of this._providers)o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?C.Group(o.params(t,this.plugin)):C.EmptyGroup());return r.length===0?C.MappedStatic("",{"":C.EmptyGroup()}):C.MappedStatic(r[0][0],n,{options:r})}registerPreset(t){if(this.providerMap.has(t.id))throw new Error(`Representation provider with id '${t.id}' already registered.`);this._providers.push(t),this.providerMap.set(t.id,t)}unregisterPreset(t){this.providerMap.delete(t.id),_g(this._providers,t)}applyPreset(t,r,n){let o=this.resolveProvider(r);if(!o)return;let i=this.plugin.state.data,a=Yo.resolveAndCheck(i,t);if(!a){Yb||console.warn("Applying structure repr. provider to bad cell.");return}let s=o.params?.(a.obj,this.plugin)||{},l=n||(o.params?C.getDefaultValues(s):{}),u=this.plugin.config.get(Lr.Structure.DefaultRepresentationPresetParams);l=C.merge(s,u,l);let c=Pe.create(`${o.display.name}`,()=>o.apply(a,l,this.plugin));return this.plugin.runTask(c)}async addRepresentation(t,r,n){let o=this.dataState.build(),i=this.buildRepresentation(o,t,r,n);if(i)return await o.commit(),i}buildRepresentation(t,r,n,o){if(!r)return;let i=Yo.resolveAndCheck(this.dataState,r)?.obj?.data;if(!i)return;let a=RA(this.plugin,i,n);return o?.tag?t.to(r).applyOrUpdateTagged(o.tag,dd,a,{state:o?.initialState}).selector:t.to(r).apply(dd,a,{state:o?.initialState}).selector}};function aZ(e){return e}(t=>t.CommonParams=(r,n)=>({modelProperties:C.Optional(C.Group(Je.getParamDefinition(Xe.Model.CustomModelProperties,void 0,n))),structureProperties:C.Optional(C.Group(Je.getParamDefinition(Xe.Model.CustomStructureProperties,void 0,n))),representationPreset:C.Optional(C.Text("auto"))}))(aZ||={});var GV=aZ.CommonParams,upt=(e,t)=>({model:C.Optional(C.Group(Je.getParamDefinition(Xe.Model.ModelFromTrajectory,e,t))),showUnitcell:C.Optional(C.Boolean(!1)),structure:C.Optional(Iy.getParams(void 0,"assembly").type),representationPresetParams:C.Optional(C.Group(eg.CommonParams)),...GV(e,t)}),W2e={id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:e=>!0,params:upt,async apply(e,t,r){let n=r.builders.structure,o=await n.createModel(e,t.model),i=await n.insertModelProperties(o,t.modelProperties),a=await n.createStructure(i||o,t.structure),s=await n.insertStructureProperties(a,t.structureProperties),l=t.showUnitcell===void 0||t.showUnitcell?await n.tryCreateUnitcell(i,void 0,{isHidden:!0}):void 0,u=t.representationPreset||r.config.get(Lr.Structure.DefaultRepresentationPreset)||Yl.auto.id,c=await r.builders.structure.representation.applyPreset(s,u,t.representationPresetParams);return{model:o,modelProperties:i,unitcell:l,structure:a,structureProperties:s,representation:c}}},cpt=(e,t)=>({useDefaultIfSingleModel:C.Optional(C.Boolean(!1)),representationPresetParams:C.Optional(C.Group(eg.CommonParams)),...GV(e,t)}),mpt={id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by trajectory-index."},isApplicable:e=>e.data.frameCount>1,params:cpt,async apply(e,t,r){let n=Yo.resolveAndCheck(r.state.data,e)?.obj?.data;if(!n)return{};if(n.frameCount===1&&t.useDefaultIfSingleModel)return W2e.apply(e,t,r);let o=r.builders.structure,i=[],a=[];for(let s=0;s<n.frameCount;s++){let l=await o.createModel(e,{modelIndex:s}),u=await o.insertModelProperties(l,t.modelProperties,{isCollapsed:!0}),c=await o.createStructure(u||l,{name:"model",params:{}}),m=await o.insertStructureProperties(c,t.structureProperties);i.push(l),a.push(c);let d=c.obj?Ij(c.obj.data,{elementCountFactor:n.frameCount}):"medium",p=t.representationPreset||r.config.get(Lr.Structure.DefaultRepresentationPreset)||Yl.auto.id;await o.representation.applyPreset(m,p,{theme:{globalName:"trajectory-index"},quality:d})}return{models:i,structures:a}}},X2e=(e,t)=>({model:C.Optional(C.Group(Je.getParamDefinition(Xe.Model.ModelFromTrajectory,e,t))),...GV(e,t)});async function Q2e(e,t,r,n){let o=n.builders.structure,i=await o.createModel(t,r.model),a=await o.insertModelProperties(i,r.modelProperties),s=await o.createStructure(a||i,{name:"symmetry",params:e}),l=await o.insertStructureProperties(s,r.structureProperties),u=await o.tryCreateUnitcell(a,void 0,{isHidden:!1}),c=r.representationPreset||n.config.get(Lr.Structure.DefaultRepresentationPreset)||Yl.auto.id,m=await n.builders.structure.representation.applyPreset(l,c,{theme:{globalName:e.theme}});return{model:i,modelProperties:a,unitcell:u,structure:s,structureProperties:l,representation:m}}var dpt={id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:e=>Ft.hasCrystalSymmetry(e.data.representative),params:X2e,async apply(e,t,r){return await Q2e({ijkMin:b.create(0,0,0),ijkMax:b.create(0,0,0)},e,t,r)}},ppt={id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:e=>Ft.hasCrystalSymmetry(e.data.representative),params:X2e,async apply(e,t,r){return await Q2e({ijkMin:b.create(-1,-1,-1),ijkMax:b.create(1,1,1),theme:"operator-hkl"},e,t,r)}},fpt=(e,t)=>({model:C.Optional(C.Group(Je.getParamDefinition(Xe.Model.ModelFromTrajectory,e,t))),...GV(e,t)}),hpt={id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 \u212B, i.e., symmetry mates."},isApplicable:e=>Ft.hasCrystalSymmetry(e.data.representative),params:fpt,async apply(e,t,r){let n=r.builders.structure,o=await n.createModel(e,t.model),i=await n.insertModelProperties(o,t.modelProperties),a=await n.createStructure(i||o,{name:"symmetry-mates",params:{radius:5}}),s=await n.insertStructureProperties(a,t.structureProperties),l=await n.tryCreateUnitcell(i,void 0,{isHidden:!0}),u=t.representationPreset||r.config.get(Lr.Structure.DefaultRepresentationPreset)||Yl.auto.id,c=await r.builders.structure.representation.applyPreset(s,u,{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:oI.defaultValues}}}}});return{model:o,modelProperties:i,unitcell:l,structure:a,structureProperties:s,representation:c}}},UV={default:W2e,"all-models":mpt,unitcell:dpt,supercell:ppt,crystalContacts:hpt};var NV=class{constructor(t){this.plugin=t;this._providers=[];this.providerMap=new Map;this.defaultProvider=UV.default;gi(UV,r=>this.registerPreset(r))}resolveProvider(t){return typeof t=="string"?UV[t]??z1(this._providers,r=>r.id===t):t}hasPreset(t){for(let r of this._providers)if(!r.isApplicable||r.isApplicable(t,this.plugin))return!0;return!1}get providers(){return this._providers}getPresets(t){if(!t)return this.providers;let r=[];for(let n of this._providers)n.isApplicable&&!n.isApplicable(t,this.plugin)||r.push(n);return r}getPresetSelect(t){let r=[];for(let n of this._providers)t&&n.isApplicable&&!n.isApplicable(t,this.plugin)||r.push([n.id,n.display.name]);return C.Select("auto",r)}getPresetsWithOptions(t){let r=[],n=Object.create(null);for(let o of this._providers)o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?C.Group(o.params(t,this.plugin)):C.EmptyGroup());return r.length===0?C.MappedStatic("",{"":C.EmptyGroup()}):C.MappedStatic(r[0][0],n,{options:r})}registerPreset(t){if(this.providerMap.has(t.id))throw new Error(`Hierarchy provider with id '${t.id}' already registered.`);this._providers.push(t),this.providerMap.set(t.id,t)}unregisterPreset(t){this.providerMap.delete(t.id),_g(this._providers,t)}applyPreset(t,r,n){let o=this.resolveProvider(r);if(!o)return;let i=this.plugin.state.data,a=Yo.resolveAndCheck(i,t);if(!a){Yb||console.warn("Applying hierarchy preset provider to bad cell.");return}let s=n||(o.params?C.getDefaultValues(o.params(a.obj,this.plugin)):{}),l=Pe.create(`${o.display.name}`,()=>o.apply(a,s,this.plugin));return this.plugin.runTask(l)}};var zV=class{constructor(t){this.plugin=t;this.hierarchy=new NV(this.plugin);this.representation=new OV(this.plugin)}get dataState(){return this.plugin.state.data}async parseTrajectoryData(t,r){let n=typeof r=="string"?this.plugin.dataFormats.get(r):r;if(!n)throw new Error(`'${r}' is not a supported data format.`);let{trajectory:o}=await n.parse(this.plugin,t);return o}parseTrajectoryBlob(t,r){return this.dataState.build().to(t).apply(Xe.Data.ParseBlob,r,{state:{isGhost:!0}}).apply(Xe.Model.TrajectoryFromBlob,void 0).commit({revertOnError:!0})}parseTrajectory(t,r){let n=Yo.resolveAndCheck(this.dataState,t);if(!n)throw new Error("Invalid data cell.");return re.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(t,r):this.parseTrajectoryData(t,r)}createModel(t,r,n){return this.dataState.build().to(t).apply(Xe.Model.ModelFromTrajectory,r||{modelIndex:0},{state:n}).commit({revertOnError:!0})}insertModelProperties(t,r,n){return this.dataState.build().to(t).apply(Xe.Model.CustomModelProperties,r,{state:n}).commit({revertOnError:!0})}tryCreateUnitcell(t,r,n){let o=this.dataState,i=Yo.resolveAndCheck(o,t)?.obj?.data;if(!i)return;let a=wo.Provider.get(i)?.spacegroup.cell;return Yi.isZero(a)?void 0:o.build().to(t).apply(Xe.Representation.ModelUnitcell3D,r,{state:n}).commit({revertOnError:!0})}createStructure(t,r,n,o){let i=this.dataState;if(!r){let s=Yo.resolveAndCheck(i,t);if(s){let l=wo.Provider.get(s.obj?.data);(!l||l?.assemblies.length===0)&&(r={name:"model",params:{}})}}return i.build().to(t).apply(Xe.Model.StructureFromModel,{type:r||{name:"assembly",params:{}}},{state:n,tags:o}).commit({revertOnError:!0})}insertStructureProperties(t,r){return this.dataState.build().to(t).apply(Xe.Model.CustomStructureProperties,r).commit({revertOnError:!0})}isComponentTransform(t){return t.transform.transformer===Xe.Model.StructureComponent}async tryCreateComponent(t,r,n,o){let i=this.dataState,a=i.build().to(t),s=`structure-component-${n}`,l=a.applyOrUpdateTagged(s,Xe.Model.StructureComponent,r,{tags:o?[...o,s]:[s]});await l.commit();let u=l.selector;if(!u.isOk||u.cell?.obj?.data.elementCount===0){await i.build().delete(u.ref).commit();return}return u}tryCreateComponentFromExpression(t,r,n,o){return this.tryCreateComponent(t,{type:{name:"expression",params:r},nullIfEmpty:!0,label:(o?.label||"").trim()},n,o?.tags)}tryCreateComponentStatic(t,r,n){return this.tryCreateComponent(t,{type:{name:"static",params:r},nullIfEmpty:!0,label:(n?.label||"").trim()},`static-${r}`,n?.tags)}tryCreateComponentFromSelection(t,r,n,o){return this.plugin.runTask(Pe.create("Query Component",async i=>{let{label:a,tags:s}=o||{};a=(a||"").trim();let l=Yo.resolveAndCheck(this.dataState,t)?.obj?.data;if(!l)return;let u=r.referencesCurrent?{type:{name:"bundle",params:K.Bundle.fromSelection(await r.getSelection(this.plugin,i,l))},nullIfEmpty:!0,label:a||r.label}:{type:{name:"expression",params:r.expression},nullIfEmpty:!0,label:a||r.label};return r.ensureCustomProperties&&await r.ensureCustomProperties({runtime:i,assetManager:this.plugin.managers.asset,errorContext:this.plugin.errorContext},l),this.tryCreateComponent(t,u,n,s)}))}};var Z2e;(t=>{function e(r){let{name:n}=r;return{descriptor:r,get(o){return o._propertyData[n]},set(o,i){o.customProperties.add(r),o._propertyData[n]=i}}}t.create=e})(Z2e||={});var HV;(r=>(r.Descriptor={name:"recommended_iso_value"},r.Provider=Z2e.create(r.Descriptor)))(HV||={});var XA="Volume";async function QR(e,t){if(!t)return;let{entryId:r}=t;if(!(!r||!r.toLowerCase().startsWith("emd")))return e.runTask(Pe.create("Try Set Recommended IsoValue",async n=>{try{let o=await gQ(e,n,r);HV.Provider.set(t,Ve.IsoValue.absolute(o))}catch(o){console.warn(o)}}))}function q2e(e){let t=HV.Provider.get(e);if(t)return t.kind==="relative"?t:Ve.adjustedIsoValue(e,t.absoluteValue,"absolute")}async function sZ(e,t){let r={},n=t.volume.data&&q2e(t.volume.data);return n&&(r.isoValue=n),[await e.build().to(t.volume).apply(Xe.Representation.VolumeRepresentation3D,Xy(e,t.volume.data,{type:"isosurface",typeParams:r})).commit()]}var gpt={label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:XA,binaryExtensions:["ccp4","mrc","map"],parse:async(e,t,r)=>{let n=e.build().to(t).apply(Xe.Data.ParseCcp4,{},{state:{isGhost:!0}}),o=n.apply(Xe.Volume.VolumeFromCcp4,{entryId:r?.entryId});return await n.commit({revertOnError:!0}),await QR(e,o.selector.data),{format:n.selector,volume:o.selector}},visuals:sZ},ypt={label:"DSN6/BRIX",description:"DSN6/BRIX",category:XA,binaryExtensions:["dsn6","brix"],parse:async(e,t,r)=>{let n=e.build().to(t).apply(Xe.Data.ParseDsn6,{},{state:{isGhost:!0}}),o=n.apply(Xe.Volume.VolumeFromDsn6,{entryId:r?.entryId});return await n.commit({revertOnError:!0}),await QR(e,o.selector.data),{format:n.selector,volume:o.selector}},visuals:sZ},bpt={label:"DX",description:"DX",category:XA,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:async(e,t,r)=>{let o=e.build().to(t).apply(Xe.Data.ParseDx,{},{state:{isGhost:!0}}).apply(Xe.Volume.VolumeFromDx,{entryId:r?.entryId});return await o.commit({revertOnError:!0}),await QR(e,o.selector.data),{volume:o.selector}},visuals:sZ},xpt={label:"Cube",description:"Cube",category:XA,stringExtensions:["cub","cube"],parse:async(e,t,r)=>{let n=e.build().to(t).apply(Xe.Data.ParseCube,{},{state:{isGhost:!0}}),o=n.apply(Xe.Volume.VolumeFromCube,{entryId:r?.entryId}),i=n.apply(Xe.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(Xe.Model.ModelFromTrajectory).apply(Xe.Model.StructureFromModel);return await n.commit({revertOnError:!0}),await QR(e,o.selector.data),{format:n.selector,volume:o.selector,structure:i.selector}},visuals:async(e,t)=>{let r=e.build(),n=[],o=t.volume.cell?.obj?.data;if(o&&Ve.isOrbitals(o)){let s=r.to(t.volume).apply(Xe.Representation.VolumeRepresentation3D,Xy(e,o,{type:"isosurface",typeParams:{isoValue:Ve.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:Lt.blue}})),l=r.to(t.volume).apply(Xe.Representation.VolumeRepresentation3D,Xy(e,o,{type:"isosurface",typeParams:{isoValue:Ve.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:Lt.red}}));n.push(s.selector,l.selector)}else{let s=r.to(t.volume).apply(Xe.Representation.VolumeRepresentation3D,Xy(e,o,{type:"isosurface",typeParams:{isoValue:Ve.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:Lt.grey}}));n.push(s.selector)}let i=await e.builders.structure.representation.applyPreset(t.structure,"auto");await r.commit();let a=[];return gi(i?.representations,s=>{s&&a.push(s)}),[...n,...a]}},Cpt={label:"DensityServer CIF",description:"DensityServer CIF",category:XA,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>$I(e,t)==="dscif",parse:async(e,t,r)=>{let n=await e.build().to(t).apply(Xe.Data.ParseCif).commit(),o=e.build().to(n),i=n.obj.data.blocks;if(i.length===0)throw new Error("no data blocks");let a=[],s=0;for(let l of i){if(l.header.toUpperCase()==="SERVER")continue;let u=Array.isArray(r?.entryId)?r?.entryId[s]:r?.entryId;l.categories.volume_data_3d_info?.rowCount>0&&(a.push(o.apply(Xe.Volume.VolumeFromDensityServerCif,{blockHeader:l.header,entryId:u}).selector),s++)}await o.commit();for(let l of a)await QR(e,l.data);return{volumes:a}},visuals:async(e,t)=>{let{volumes:r}=t,n=e.build(),o=[];if(r.length>0){let i=r[0].data&&q2e(r[0].data)||Ve.IsoValue.relative(1.5);o[0]=n.to(r[0]).apply(Xe.Representation.VolumeRepresentation3D,Cf.getDefaultParamsStatic(e,"isosurface",{isoValue:i,alpha:1},"uniform",{value:Lt.teal})).selector}if(r.length>1){let i=Cf.getDefaultParamsStatic(e,"isosurface",{isoValue:Ve.IsoValue.relative(3),alpha:.3},"uniform",{value:Lt.green}),a=Cf.getDefaultParamsStatic(e,"isosurface",{isoValue:Ve.IsoValue.relative(-3),alpha:.3},"uniform",{value:Lt.red});o[o.length]=n.to(r[1]).apply(Xe.Representation.VolumeRepresentation3D,i).selector,o[o.length]=n.to(r[1]).apply(Xe.Representation.VolumeRepresentation3D,a).selector}return await n.commit(),o}},Spt={label:"Segmentation CIF",description:"Segmentation CIF",category:XA,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>$I(e,t)==="segcif",parse:async(e,t)=>{let r=await e.build().to(t).apply(Xe.Data.ParseCif).commit(),n=e.build().to(r),o=r.obj.data.blocks;if(o.length===0)throw new Error("no data blocks");let i=[];for(let a of o)a.header.toUpperCase()!=="SERVER"&&a.categories.volume_data_3d_info?.rowCount>0&&i.push(n.apply(Xe.Volume.VolumeFromSegmentationCif,{blockHeader:a.header}).selector);return await n.commit(),{volumes:i}},visuals:async(e,t)=>{let{volumes:r}=t,n=e.build(),o=[];return r.length>0&&Ve.Segmentation.get(r[0].data)&&(o[o.length]=n.to(r[0]).apply(Xe.Representation.VolumeRepresentation3D,Cf.getDefaultParams(e,"segment",r[0].data,{alpha:1,instanceGranularity:!0},"volume-segment",{})).selector),await n.commit(),o}},Y2e=[["ccp4",gpt],["dsn6",ypt],["cube",xpt],["dx",bpt],["dscif",Cpt],["segcif",Spt]];var vpt="Shape",Ipt={label:"PLY",description:"PLY",category:vpt,stringExtensions:["ply"],parse:async(e,t)=>{let r=e.state.data.build().to(t).apply(Xe.Data.ParsePly,{},{state:{isGhost:!0}}),n=r.apply(Xe.Model.ShapeFromPly);return await r.commit(),{format:r.selector,shape:n.selector}},visuals(e,t){return e.state.data.build().to(t.shape).apply(Xe.Representation.ShapeRepresentation3D).commit()}},K2e=[["ply",Ipt]];var jV=class{constructor(){this._list=[];this._map=new Map;this._extensions=void 0;this._binaryExtensions=void 0;this._options=void 0;for(let[t,r]of Y2e)this.add(t,r);for(let[t,r]of wTe)this.add(t,r);for(let[t,r]of ETe)this.add(t,r);for(let[t,r]of K2e)this.add(t,r);for(let[t,r]of IF)this.add(t,r)}get types(){return this._list.map(t=>[t.name,t.provider.label])}get extensions(){if(this._extensions)return this._extensions;let t=new Set;return this._list.forEach(({provider:r})=>{r.stringExtensions?.forEach(n=>t.add(n)),r.binaryExtensions?.forEach(n=>t.add(n))}),this._extensions=t,t}get binaryExtensions(){if(this._binaryExtensions)return this._binaryExtensions;let t=new Set;return this._list.forEach(({provider:r})=>r.binaryExtensions?.forEach(n=>t.add(n))),this._binaryExtensions=t,t}get options(){if(this._options)return this._options;let t=[];return this._list.forEach(({name:r,provider:n})=>t.push([r,n.label,n.category||""])),this._options=t,t}_clear(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0}add(t,r){this._clear(),this._list.push({name:t,provider:r}),this._map.set(t,r)}remove(t){this._clear(),this._list.splice(this._list.findIndex(r=>r.name===t),1),this._map.delete(t)}auto(t,r){for(let n=0,o=this.list.length;n<o;++n){let i=this._list[n].provider,a=!1;if((i.binaryExtensions?.includes(t.ext)||i.stringExtensions?.includes(t.ext))&&(a=!0),a&&(!i.isApplicable||i.isApplicable(t,r.data)))return i}}get(t){if(this._map.has(t))return this._map.get(t);throw new Error(`unknown data format name '${t}'`)}get list(){return this._list}};var WV=class extends Bs{constructor(r){super({params:{current:""},animationState:"stopped"});this.context=r;this.map=new Map;this._animations=[];this.currentTime=0;this._params=void 0;this.events={updated:this.ev(),applied:this.ev()};this.isStopped=!0;this.isApplying=!1}get isEmpty(){return this._animations.length===0}get current(){return this._current}get animations(){return this._animations}triggerUpdate(){this.events.updated.next(void 0)}triggerApply(){this.events.applied.next(void 0)}getParams(){return this._params||(this._params={current:C.Select(this._animations[0]&&this._animations[0].name,this._animations.map(r=>[r.name,r.display.name]),{label:"Animation"})}),this._params}updateParams(r){if(this.isEmpty)return;this.updateState({params:{...this.state.params,...r}});let n=this.map.get(this.state.params.current),o=n.params(this.context);this._current={anim:n,params:o,paramValues:C.getDefaultValues(o),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}updateCurrentParams(r){this.isEmpty||(this._current.paramValues={...this._current.paramValues,...r},this.triggerUpdate())}register(r){if(this.map.has(r.name)){this.context.log.error(`Animation '${r.name}' is already registered.`);return}this._params=void 0,this.map.set(r.name,r),this._animations.push(r),this._animations.length===1?this.updateParams({current:r.name}):this.triggerUpdate()}async play(r,n){await this.stop(),this.map.has(r.name)||this.register(r),this.updateParams({current:r.name}),this.updateCurrentParams(n),await this.start()}async tick(r,n,o){this.currentTime=r,!this.isStopped&&(n||o?await this.applyFrame(o):this.applyAsync())}async start(){this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate();let r=this._current.anim,n=this._current.anim.initialState(this._current.paramValues,this.context);if(r.setup){let o=await r.setup(this._current.paramValues,n,this.context);o&&(n=o)}this._current.lastTime=0,this._current.startedTime=-1,this._current.state=n,this.isStopped=!1}async stop(){if(this.isStopped=!0,this.state.animationState!=="stopped"){let r=this._current.anim;r.teardown&&await r.teardown(this._current.paramValues,this._current.state,this.context),this.updateState({animationState:"stopped"}),this.triggerUpdate()}this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1)}get isAnimating(){return this.state.animationState==="playing"}async applyAsync(){if(!this.isApplying){this.isApplying=!0;try{await this.applyFrame()}finally{this.isApplying=!1}}}async applyFrame(r){let n=this.currentTime;this._current.startedTime<0&&(this._current.startedTime=n);let o=await this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:n-this._current.startedTime,animation:r},{params:this._current.paramValues,plugin:this.context});o.kind==="finished"?this.stop():o.kind==="next"&&(this._current.state=o.state,this._current.lastTime=n-this._current.startedTime),this.triggerApply()}getSnapshot(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}}setSnapshot(r){this.isEmpty||(this.updateState({animationState:r.state.animationState}),this.updateParams(r.state.params),r.current&&(this.current.paramValues=r.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(r.current.state):r.current.state,this.triggerUpdate(),this.state.animationState==="playing"&&this.resume()))}async resume(){this._current.lastTime=0,this._current.startedTime=-1;let r=this._current.anim;this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),r.setup&&await r.setup(this._current.paramValues,this._current.state,this.context),this.isStopped=!1}};function J2e(e,t,r){let n=r[0],o=r[1],i=r[2],a=-n*t[0]-o*t[1]-i*t[2],s=e[0],l=e[1],u=e[2];return(n*s+o*l+i*u+a)/Math.sqrt(n*n+o*o+i*i)}function Apt(e,t,r,n){let o=J2e(e,t,n);return{aroundX:J2e(e,t,r)<0,aroundY:o<0}}function $2e(e,t,r){if(!e.canvas3d)return;let{origin:n,dirA:o,dirB:i,dirC:a}=r.principalAxes.boxAxes,s=b.clone(o),l=b.clone(a);if(r.positionToFlip){let{aroundX:c,aroundY:m}=Apt(r.positionToFlip,n,s,i);c&&(b.negate(l,l),b.negate(s,s)),m&&b.negate(l,l)}let u=b.scale(b(),n,-100);return b.dot(u,s)<=0&&b.negate(l,l),b.dot(b.unitY,l)<=0&&b.negate(s,s),e.canvas3d.camera.getFocus(n,t,s,l,mo.createDefaultSnapshot())}var Tpt=3,mg={identity:Ot.create(1,0,0,0,1,0,0,0,1),rotX90:Ot.create(1,0,0,0,0,1,0,-1,0),rotY90:Ot.create(0,0,-1,0,1,0,1,0,0),rotZ90:Ot.create(0,1,0,-1,0,0,0,0,1),rotX270:Ot.create(1,0,0,0,0,-1,0,1,0),rotY270:Ot.create(0,0,1,0,1,0,-1,0,0),rotZ270:Ot.create(0,-1,0,1,0,0,0,0,1),rotX180:Ot.create(1,0,0,0,-1,0,0,0,-1),rotY180:Ot.create(-1,0,0,0,1,0,0,0,-1),rotZ180:Ot.create(-1,0,0,0,-1,0,0,0,1)};function e_e(e,t){let r=_pt(e,Tpt);return Ppt(r,t)}function Ppt(e,t){if(e.length===0)return console.warn("Skipping PCA, no atoms"),{rotation:mg.identity,origin:b.zero()};let r=lu.calculateMomentsAxes(e),n=lu.calculateNormalizedAxes(r),o=Ept(n.dirA,n.dirB,n.dirC);Mpt(o);let i=t?Rpt(o,t):Dpt(e,o,r.origin);return Ot.mul(o,i,o),{rotation:o,origin:n.origin}}function _pt(e,t){let r;return r=lZ(e,{onlyTrace:!0}),r.length>=3*t||(r=lZ(e,{skipHydrogens:!0,skipWater:!0}),r.length>=3*t)||(r=lZ(e,{})),r}function lZ(e,t){let{onlyTrace:r,skipHydrogens:n,skipWater:o}=t,{x:i,y:a,z:s,type_symbol:l,label_comp_id:u}=qe.atom,c=[];for(let m of e){let d=K.Location.create(m);for(let p of m.units){d.unit=p;let h=r?p.polymerElements:p.elements;for(let f=0;f<h.length;f++)d.element=h[f],!(n&&l(d)==="H")&&(o&&u(d)==="HOH"||c.push(i(d),a(d),s(d)))}}return c}function Rpt(e,t){let r=mg.identity,n=0,o=Ot();for(let i of[mg.identity,mg.rotX180,mg.rotY180,mg.rotZ180]){let a=Ot.innerProduct(Ot.mul(o,i,e),t);a>n&&(r=i,n=a)}return r}function Dpt(e,t,r){let n=b.create(Ot.getValue(t,0,0),Ot.getValue(t,0,1),Ot.getValue(t,0,2)),o=b.create(Ot.getValue(t,1,0),Ot.getValue(t,1,1),Ot.getValue(t,1,2)),i=b.create(Ot.getValue(t,2,0),Ot.getValue(t,2,1),Ot.getValue(t,2,2)),a=Math.floor(e.length/3),s=b(),l=0,u=0,c=0;for(let p=0;p<a;p++)b.fromArray(s,e,3*p),b.sub(s,s,r),l+=p*b.dot(s,n),u+=p*b.dot(s,o),c+=wpt(p,a)*b.dot(s,i);let m=c<0,d=m?l+u<0:l-u<0;return d&&m?mg.rotY180:m?mg.rotX180:d?mg.rotZ180:mg.identity}function wpt(e,t){let r=Math.floor(t/2);return e<r?t%2?r-e:r-e-1:e-r}function Ept(e,t,r){let n=Ot();return Ot.setValue(n,0,0,e[0]),Ot.setValue(n,0,1,e[1]),Ot.setValue(n,0,2,e[2]),Ot.setValue(n,1,0,t[0]),Ot.setValue(n,1,1,t[1]),Ot.setValue(n,1,2,t[2]),Ot.setValue(n,2,0,r[0]),Ot.setValue(n,2,1,r[1]),Ot.setValue(n,2,2,r[2]),n}function Mpt(e){Ot.determinant(e)<0&&(Ot.setValue(e,2,0,-Ot.getValue(e,2,0)),Ot.setValue(e,2,1,-Ot.getValue(e,2,1)),Ot.setValue(e,2,2,-Ot.getValue(e,2,2)))}function uZ(e,t){let r=Ot.invert(Ot(),t),n=b.distance(e.position,e.target),o=b.transformMat3(b(),b.create(0,0,n),r),i=b.transformMat3(b(),b.create(0,1,0),r),a=b.add(b(),e.target,o);return{...e,position:a,up:i}}var XV={minRadius:5,extraRadius:4,durationMs:250},QV=class{constructor(t){this.plugin=t;this.boundaryHelper=new Ci("98")}transformedLoci(t){if(K.Loci.is(t)){let r=this.plugin.helpers.substructureParent.get(t.structure)?.obj?.data;r&&(t=K.Loci.remap(t,r))}return t}focusRenderObjects(t,r){if(!t)return;let n=[];for(let o of t){let i=o.values.boundingSphere.ref.value;i.radius!==0&&n.push(i)}this.focusSpheres(n,o=>o,r)}focusLoci(t,r){let n;if(Array.isArray(t)&&t.length>1){let o=[];for(let i of t){let a=Jt.getBoundingSphere(this.transformedLoci(i));a&&o.push(a)}if(o.length===0)return;this.boundaryHelper.reset();for(let i of o)this.boundaryHelper.includeSphere(i);this.boundaryHelper.finishedIncludeStep();for(let i of o)this.boundaryHelper.radiusSphere(i);n=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(t.length===0)return;n=Jt.getBoundingSphere(this.transformedLoci(t[0]))}else n=Jt.getBoundingSphere(this.transformedLoci(t));n&&this.focusSphere(n,r)}focusSpheres(t,r,n){let o=[];for(let i of t){let a=r(i);a&&o.push(a)}if(o.length!==0){if(o.length===1)return this.focusSphere(o[0],n);this.boundaryHelper.reset();for(let i of o)this.boundaryHelper.includeSphere(i);this.boundaryHelper.finishedIncludeStep();for(let i of o)this.boundaryHelper.radiusSphere(i);this.focusSphere(this.boundaryHelper.getSphere(),n)}}focusSphere(t,r){let{canvas3d:n}=this.plugin;if(!n)return;let{extraRadius:o,minRadius:i,durationMs:a}={...XV,...r},s=Math.max(t.radius+o,i);if(r?.principalAxes){let l=$2e(this.plugin,s,r);this.plugin.canvas3d?.requestCameraReset({durationMs:a,snapshot:l})}else{let l=n.camera.getFocus(t.center,s);n.requestCameraReset({durationMs:a,snapshot:l})}}focusObject(t){if(!this.plugin.canvas3d)return;let r=P8(this.plugin,{...t,targets:t.targets?.map(n=>({...n,extraRadius:n.extraRadius??XV.extraRadius})),minRadius:t.minRadius??XV.minRadius});this.plugin.canvas3d.requestCameraReset({snapshot:r,durationMs:t.durationMs??XV.durationMs})}orientAxes(t,r){if(!this.plugin.canvas3d)return;t||(t=this.plugin.state.data.selectQ(s=>s.ofType(re.Molecule.Structure)).filter(s=>s.obj&&!s.transform.transformer.definition.isDecorator&&!s.obj.data.parent).map(s=>s.obj?.data).filter(s=>!!s));let{rotation:n}=e_e(t),o=uZ(this.plugin.canvas3d.camera.getSnapshot(),n);this.setSnapshot(o,r)}resetAxes(t){if(!this.plugin.canvas3d)return;let r=uZ(this.plugin.canvas3d.camera.getSnapshot(),Ot.Identity);this.setSnapshot(r,t)}setSnapshot(t,r){this.plugin.canvas3d?.requestCameraReset({snapshot:t,durationMs:r})}reset(t,r){this.plugin.canvas3d?.requestCameraReset({snapshot:t,durationMs:r})}};var ZV=class{constructor(t){this.ctx=t;this.providers=[];this.locis=[];this.isDirty=!1;this.labels=[];this.groupedLabels=new Map;t.managers.interactivity.lociHighlights.addProvider((r,n,o)=>{this.providers.length!==0&&(this.mark(r,n),o||this.showLabels())})}clearProviders(){this.providers=[],this.isDirty=!0,this.showLabels()}addProvider(t){this.providers.push(t),this.providers.sort((r,n)=>(n.priority||0)-(r.priority||0)),this.isDirty=!0,this.showLabels()}removeProvider(t){this.providers=this.providers.filter(r=>r!==t),this.isDirty=!0,this.showLabels()}mark(t,r){let n=this.locis.findIndex(o=>Vt.Loci.areEqual(t,o));n===-1&&r===1?(this.locis.push(t),this.isDirty=!0):n!==-1&&r===2&&(ob(this.locis,n),this.isDirty=!0)}showLabels(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})}getLabels(){if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(let t of this.providers)for(let r of this.locis){if(Jt.isEmpty(r.loci))continue;let n=t.label(r.loci,r.repr);if(n){let o=t.group?t.group(n):n.toString(),i=this.groupedLabels.get(o);i?i.push(n):this.groupedLabels.set(o,[n])}}this.labels.length=0,this.groupedLabels.forEach((t,r)=>{let n=t.length,o=n>1&&t[0]!==t[1]?r:t[0];this.labels.push(n===1?o:`${o} <small>|| \xD7 ${n}</small>`)}),this.isDirty=!1}return this.labels}};var ZR=new Ci("98"),Bpt=24,qV=class extends Bs{constructor(r){super({entries:new Map,additionsHistory:[],stats:kpt()});this.plugin=r;this.events={changed:this.ev(),additionsHistoryUpdated:this.ev(),loci:{add:this.ev(),remove:this.ev(),clear:this.ev()}};r.helpers.substructureParent.events.removed.subscribe(n=>this.onRemove(n.ref,n.obj)),r.helpers.substructureParent.events.updated.subscribe(n=>this.onUpdate(n.ref,n.oldObj,n.obj))}get entries(){return this.state.entries}get additionsHistory(){return this.state.additionsHistory}get stats(){return this.state.stats?this.state.stats:(this.state.stats=this.calcStats(),this.state.stats)}getEntry(r){let n=this.plugin.helpers.substructureParent.get(r,!0);if(!n)return;let o=n.transform.ref;if(!this.entries.has(o)){let i=new qR(K.Loci(r,[]));return this.entries.set(o,i),i}return this.entries.get(o)}calcStats(){let r=0,n=0,o=K.Stats.create();this.entries.forEach(a=>{let{elements:s}=a.selection;if(s.length){r+=1;for(let l=0,u=s.length;l<u;++l)n+=Se.size(s[l].indices);K.Stats.add(o,o,K.Stats.ofLoci(a.selection))}});let i=sS(o,{countsOnly:!0});return{structureCount:r,elementCount:n,label:i}}add(r){if(!K.Loci.is(r))return!1;let n=this.getEntry(r.structure);if(!n)return!1;let o=n.selection;return n.selection=K.Loci.union(n.selection,r),this.tryAddHistory(r),this.referenceLoci=r,this.events.loci.add.next(r),!K.Loci.areEqual(o,n.selection)}remove(r){if(!K.Loci.is(r))return!1;let n=this.getEntry(r.structure);if(!n)return!1;let o=n.selection;return n.selection=K.Loci.subtract(n.selection,r),this.referenceLoci=r,this.events.loci.remove.next(r),!K.Loci.areEqual(o,n.selection)}intersect(r){if(!K.Loci.is(r))return!1;let n=this.getEntry(r.structure);if(!n)return!1;let o=n.selection;return n.selection=K.Loci.intersect(n.selection,r),this.referenceLoci=r,!K.Loci.areEqual(o,n.selection)}set(r){if(!K.Loci.is(r))return!1;let n=this.getEntry(r.structure);if(!n)return!1;let o=n.selection;return n.selection=r,this.tryAddHistory(r),this.referenceLoci=void 0,!K.Loci.areEqual(o,n.selection)}modifyHistory(r,n,o,i=!1){let a=this.additionsHistory,s=a.indexOf(r);if(s<0)return;let l;switch(n){case"remove":ob(a,s);break;case"up":l=s-1;break;case"down":l=s+1;break}if(l!==void 0){let u=o?Math.min(a.length,o):a.length;for(;;)if(l=l%u,l<0&&(l+=u),!i||a[s].loci.structure===a[l].loci.structure){let c=a[s];a[s]=a[l],a[l]=c;break}else l+=n==="up"?-1:1}this.events.additionsHistoryUpdated.next(void 0)}tryAddHistory(r){if(Jt.isEmpty(r))return;let n=0,o;for(let s of this.additionsHistory){if(Jt.areEqual(s.loci,r)){o=s;break}n++}if(o){ob(this.additionsHistory,n),this.additionsHistory.unshift(o),this.events.additionsHistoryUpdated.next(void 0);return}let i=K.Stats.ofLoci(r),a=sS(i,{reverse:!0});this.additionsHistory.unshift({id:en.create22(),loci:r,label:a}),this.additionsHistory.length>Bpt&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next(void 0)}clearHistory(){this.state.additionsHistory.length!==0&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next(void 0))}clearHistoryForStructure(r){let n=[];for(let o of this.state.additionsHistory)o.loci.structure.root===r.root&&n.push(o);for(let o of n)this.modifyHistory(o,"remove");n.length!==0&&this.events.additionsHistoryUpdated.next(void 0)}onRemove(r,n){this.entries.has(r)&&(this.entries.delete(r),n?.data&&this.clearHistoryForStructure(n.data),this.referenceLoci?.structure===n?.data&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next(void 0))}onUpdate(r,n,o){if(n===o||n?.data===o.data)return;let i=this.plugin.helpers.substructureParent.get(o.data,!0);if(!i||r!==i.transform.ref||!this.entries.has(r))return;let a=this.plugin.helpers.substructureParent.get(o.data)?.obj?.data;if(a)if(!n?.data||De.areUnitIdsAndIndicesEqual(n.data,o.data)){this.entries.set(r,Lpt(this.entries.get(r),a)),this.referenceLoci?.structure.root===a.root&&(this.referenceLoci=K.Loci.remap(this.referenceLoci,a));let s=!1;for(let l of this.state.additionsHistory)l.loci.structure.root===a.root&&(l.loci=K.Loci.remap(l.loci,a),s=!0);s&&this.events.additionsHistoryUpdated.next(void 0)}else this.entries.set(r,new qR(K.Loci(a,[]))),this.referenceLoci?.structure.root===a.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(a),this.state.stats=void 0,this.events.changed.next(void 0)}clear(){let r=this.entries.keys(),n=[];for(;;){let o=r.next();if(o.done)break;let i=this.entries.get(o.value);K.Loci.isEmpty(i.selection)||n.push(i.selection),i.selection=K.Loci(i.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(void 0),this.events.loci.clear.next(void 0),this.clearHistory(),n}getLoci(r){let n=this.getEntry(r);return n?n.selection:dr}getStructure(r){let n=this.getEntry(r);if(n)return n.structure}structureHasSelection(r){let n=r.cell?.obj?.data;if(!n)return!1;let o=this.getEntry(n);return!!o&&!K.Loci.isEmpty(o.selection)}has(r){if(K.Loci.is(r)){let n=this.getEntry(r.structure);if(n)return K.Loci.isSubset(n.selection,r)}return!1}tryGetRange(r){if(K.Loci.is(r)&&this.getEntry(r.structure))return cZ(this.referenceLoci,r)}elementCount(){let r=0;return this.entries.forEach(n=>{r+=K.Loci.size(n.selection)}),r}getBoundary(){let r=b.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=b.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);ZR.reset();let o=[];this.entries.forEach(i=>{let a=i.selection;K.Loci.isEmpty(a)||o.push(K.Loci.getBoundary(a))});for(let i=0,a=o.length;i<a;++i){let{box:s,sphere:l}=o[i];b.min(r,r,s.min),b.max(n,n,s.max),ZR.includePositionRadius(l.center,l.radius)}ZR.finishedIncludeStep();for(let i=0,a=o.length;i<a;++i){let{sphere:s}=o[i];ZR.radiusPositionRadius(s.center,s.radius)}return{box:{min:r,max:n},sphere:ZR.getSphere()}}getPrincipalAxes(){let r=H1(this.entries.values());return K.Loci.getPrincipalAxesMany(r.map(n=>n.selection))}modify(r,n){let o=!1;switch(r){case"add":o=this.add(n);break;case"remove":o=this.remove(n);break;case"intersect":o=this.intersect(n);break;case"set":o=this.set(n);break}o&&(this.state.stats=void 0,this.events.changed.next(void 0))}get applicableStructures(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(r=>!!r.cell.obj).map(r=>r.cell.obj.data)}triggerInteraction(r,n,o=!0){switch(r){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:n},o);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:n},o);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:n},o);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:n},o);break}}fromLoci(r,n,o=!0){this.triggerInteraction(r,n,o)}fromCompiledQuery(r,n,o=!0){for(let i of this.applicableStructures){let a=n(new ai(i));this.triggerInteraction(r,at.toLociWithSourceUnits(a),o)}}fromSelectionQuery(r,n,o=!0){this.plugin.runTask(Pe.create("Structure Selection",async i=>{for(let a of this.applicableStructures){let s=await n.getSelection(this.plugin,i,a);this.triggerInteraction(r,at.toLociWithSourceUnits(s),o)}}))}fromSelections(r){let n=Yo.resolveAndCheck(this.plugin.state.data,r);if(!(!n||!n.obj)){if(!re.Molecule.Structure.Selections.is(n.obj)){console.warn("fromSelections applied to wrong object type.",n.obj);return}this.clear();for(let o of n.obj?.data)this.fromLoci("set",o.loci)}}getSnapshot(){let r=[];return this.entries.forEach((n,o)=>{r.push({ref:o,bundle:K.Bundle.fromLoci(n.selection)})}),{entries:r}}setSnapshot(r){this.entries.clear();for(let{ref:n,bundle:o}of r.entries){let i=this.plugin.state.data.select(er.Generators.byRef(n))[0]?.obj?.data;if(!i)continue;let a=K.Bundle.toLoci(o,i);this.fromLoci("set",a,!1)}}};function kpt(){return{structureCount:0,elementCount:0,label:"Nothing Selected"}}var qR=class{constructor(t){this._structure=void 0;this._selection=t}get selection(){return this._selection}set selection(t){this._selection=t,this._structure=void 0}get structure(){return this._structure?this._structure:(Jt.isEmpty(this._selection)?this._structure=void 0:this._structure=K.Loci.toStructure(this._selection),this._structure)}};function Lpt(e,t){return new qR(K.Loci.remap(e.selection,t))}function cZ(e,t){if(!K.Loci.is(e)||!K.Loci.is(t)||e.structure!==t.structure||t.elements.length!==1)return;let r=t.elements[0];if(!r)return;let n;for(let o of e.elements)if(r.unit===o.unit){n=o;break}if(n&&r.unit===n.unit)return Fpt(t.structure,n,r)}function Fpt(e,t,r){let n=Math.min(Se.min(t.indices),Se.min(r.indices)),o=Math.max(Se.max(t.indices),Se.max(r.indices));return K.Loci(e,[{unit:t.unit,indices:Se.ofRange(n,o)}])}var Vpt=8,YV=class extends Bs{constructor(r){super({history:[]});this.plugin=r;this.events={historyUpdated:this.ev()};this.behaviors={current:this.ev.behavior(void 0)};r.state.data.events.object.removed.subscribe(({obj:o})=>{if(!re.Molecule.Structure.is(o))return;this.current?.loci.structure===o.data&&this.clear();let i=[];for(let a of this.history)a.loci.structure===o.data&&i.push(a);i.length!==this.history.length&&(this.history.length=0,this.history.push(...i),this.events.historyUpdated.next(void 0))});let n=ye();r.state.data.events.object.updated.subscribe(({oldData:o,obj:i,action:a})=>{if(re.Molecule.Structure.is(i)&&o!==i.data&&a==="in-place"){let s=this.state.current,l=i.data;if(s&&s.loci.structure===o){let u=K.Loci.remap(s.loci,l);this.state.current={...s,loci:u},this.behaviors.current.next(this.state.current),Jt.getBoundingSphere(u,n);let c=this.plugin.canvas3d?.camera,m=c.getTargetDistance(n.radius+4);(b.distance(c.target,n.center)>n.radius||m>c.viewport.height/c.zoom)&&this.plugin.managers.camera.focusSphere(n,{durationMs:0})}}})}get current(){return this.state.current}get history(){return this.state.history}tryAddHistory(r){if(K.Loci.isEmpty(r.loci))return;let n=0,o;for(let i of this.state.history){if(K.Loci.areEqual(i.loci,r.loci)){o=i;break}n++}if(o){ob(this.state.history,n),this.state.history.unshift(r),this.events.historyUpdated.next(void 0);return}this.state.history.unshift(r),this.state.history.length>Vpt&&this.state.history.pop(),this.events.historyUpdated.next(void 0)}set(r){this.tryAddHistory(r),(!this.state.current||!K.Loci.areEqual(this.state.current.loci,r.loci))&&(this.state.current=r,this.behaviors.current.next(r))}tryGetRange(r){return cZ(this.referenceLoci,r)}setFromLoci(r){let n=Jt.normalize(r);if(!K.Loci.is(n)||K.Loci.isEmpty(n)){this.clear();return}this.set({loci:n,label:mp(n,{reverse:!0,hidePrefix:!0,htmlStyling:!1})}),this.referenceLoci=n}addFromLoci(r){let n=this.state.current&&K.Loci.is(r)&&r.structure===this.state.current.loci.structure?K.Loci.union(r,this.state.current.loci):r;this.setFromLoci(n);let o=Jt.normalize(r);this.referenceLoci=K.Loci.is(o)?o:void 0}toggleFromLoci(r){let{kind:n,loci:o}=Opt(this.state.current?.loci,r);this.setFromLoci(o);let i=Jt.normalize(r);this.referenceLoci=K.Loci.is(i)&&n!=="subtract"?i:void 0}extendFromLoci(r){let n=this.tryGetRange(r)??r;this.toggleFromLoci(n)}clear(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0)),this.referenceLoci=void 0}getSnapshot(){if(!this.current)return{};let n=this.plugin.helpers.substructureParent.get(this.current.loci.structure)?.transform.ref;return n?{current:{label:this.current.label,ref:n,bundle:K.Bundle.fromLoci(this.current.loci),category:this.current.category}}:{}}setSnapshot(r){if(!r.current){this.clear();return}let{label:n,ref:o,bundle:i,category:a}=r.current,s=this.plugin.state.data.select(er.Generators.byRef(o))[0]?.obj?.data;if(!s)return;let l=K.Bundle.toLoci(i,s);this.set({label:n,loci:l,category:a})}};function Opt(e,t){return e&&K.Loci.is(t)&&t.structure===e.structure?K.Loci.isSubset(e,t)?{kind:"subtract",loci:K.Loci.subtract(e,t)}:{kind:"add",loci:K.Loci.union(t,e)}:{kind:"new",loci:t}}var Gpt=[{name:"center-camera",execute:({event:e,args:t,manager:r})=>{e==="click"&&"center-camera"in t&&r.plugin.managers.camera.reset()}},{name:"apply-snapshot",execute:({event:e,args:t,manager:r})=>{if(e!=="click")return;let n=t["apply-snapshot"];n&&r.plugin.managers.snapshot.applyKey(n)}},{name:"focus-refs",execute:({event:e,args:t,manager:r})=>{if(e!=="click")return;let n=t_e(t["focus-refs"]);if(!n?.length)return;let o=r.findCells(n);if(!o.length)return;let i=r_e(r.plugin,o);if(!i.length)return;let a=i.map(s=>_8(r.plugin,s.transform.ref)).filter(s=>!!s);a.length&&r.plugin.managers.camera.focusSpheres(a,s=>s,{extraRadius:3})}},{name:"highlight-refs",execute:({event:e,args:t,manager:r})=>{let n=t_e(t["highlight-refs"]);if(n?.length){if(e==="mouse-leave"&&n.length){r.plugin.managers.interactivity.lociHighlights.clearHighlights();return}else if(e==="mouse-enter"){let o=r.findCells(n);for(let i of r_e(r.plugin,o)){if(!i.obj?.data)continue;let{repr:a}=i.obj.data;for(let s of a.getAllLoci())r.plugin.managers.interactivity.lociHighlights.highlight({loci:s,repr:a},!1)}}}}}],KV=class{constructor(t){this.plugin=t;this.extension=[];this.refResolvers={default:(t,r)=>r.map(n=>t.state.data.cells.get(n)).filter(n=>!!n)};this.uriResolvers={};this.argsParsers=[["default",100,Upt]];for(let r of Gpt)this.registerExtension(r)}registerArgsParser(t,r,n){this.removeArgsParser(t),this.argsParsers.push([t,r,n]),this.argsParsers.sort((o,i)=>i[1]-o[1])}removeArgsParser(t){let r=this.argsParsers.findIndex(n=>n[0]===t);r>=0&&this.argsParsers.splice(r,1)}parseArgs(t){for(let[,,r]of this.argsParsers){let n=r(t);if(n)return n}}registerRefResolver(t,r){this.refResolvers[t]=r}removeRefResolver(t){delete this.refResolvers[t]}registerUriResolver(t,r){this.uriResolvers[t]=r}removeUriResolver(t){delete this.uriResolvers[t]}registerExtension(t){let r=this.extension.findIndex(n=>n.name===t.name);r>=0?this.extension[r]=t:this.extension.push(t)}removeExtension(t){let r=this.extension.findIndex(n=>n.name===t);r>=0&&this.extension.splice(r,1)}_tryRender(t,r){try{return t.reactRenderFn?.(r)}catch(n){return console.error(`Failed to render markdown extension '${t.name}'`,n),null}}tryRender(t,r){let n={args:t,manager:this};for(let o of this.extension){let i=this._tryRender(o,n);if(i)return i}for(let o of r){let i=this._tryRender(o,n);if(i)return i}return null}tryExecute(t,r){let n={event:t,args:r,manager:this};for(let o of this.extension)try{o.execute?.(n)}catch(i){console.error(`Failed to execute markdown extension '${o.name}'`,i)}}tryResolveUri(t){for(let r of Object.values(this.uriResolvers)){let n=r(this.plugin,t);if(n)return n}}findCells(t){let r=new Set,n=[];for(let o of Object.values(this.refResolvers))for(let i of o(this.plugin,t))i&&!r.has(i.transform.ref)&&(r.add(i.transform.ref),n.push(i));return n}};function t_e(e){return e?.split(",").map(t=>t.trim()).filter(t=>t.length>0)??[]}function r_e(e,t){return t.length?e.state.data.selectQ(r=>r.byValue(...t).subtree().filter(n=>re.isRepresentation3D(n.obj))):[]}function Upt(e){if(!e?.startsWith("!"))return;let t=decodeURIComponent(e.substring(1)).split("&").map(r=>r.trim()).filter(r=>r.length>0).map(r=>r.split("=",2).map(n=>n.trim()));if(t.length!==0)return Object.fromEntries(t)}var Npt=[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]],mZ=[["full","Full"],["hidden","Hidden"]],zpt={isExpanded:C.Boolean(!1),showControls:C.Boolean(!0),regionState:C.Group({left:C.Select("full",Npt),top:C.Select("full",mZ),right:C.Select("full",mZ),bottom:C.Select("full",mZ)}),controlsDisplay:C.Value("outside",{isHidden:!0})},JV=class extends Bs{constructor(r){super({...C.getDefaultValues(zpt),...r.spec.layout&&r.spec.layout.initial});this.context=r;this.events={updated:this.ev()};this.rootState=void 0;st.Layout.Update.subscribe(r,n=>this.updateProps(n.state)),typeof document<"u"&&(this.expandedViewport=document.createElement("meta"),this.expandedViewport.name="viewport",this.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")}updateProps(r){let n=!!this.state.isExpanded;this.updateState(r),this.root&&typeof r.isExpanded=="boolean"&&r.isExpanded!==n&&this.handleExpand(),this.events.updated.next(void 0)}setProps(r){this.updateState(r)}setRoot(r){this.root=r,this.state.isExpanded&&this.handleExpand()}getScrollElement(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body}handleExpand(){try{let r=document.getElementsByTagName("body")[0],n=document.getElementsByTagName("head")[0];if(!r||!n||!this.root)return;if(this.state.isExpanded){let o=n.children,i=[],a=!1;for(let m=0;m<o.length;m++)o[m]===this.expandedViewport?a=!0:(o[m].name||"").toLowerCase()==="viewport"&&i.push(o[m]);for(let m of i)n.removeChild(m);a||n.appendChild(this.expandedViewport);let s=r.style,l=this.getScrollElement(),u=l.scrollLeft,c=l.scrollTop;this.rootState={top:s.top,bottom:s.bottom,right:s.right,left:s.left,scrollTop:c,scrollLeft:u,position:s.position,overflow:s.overflow,viewports:i,zIndex:this.root.style.zIndex,width:s.width,height:s.height,maxWidth:s.maxWidth,maxHeight:s.maxHeight,margin:s.margin,marginLeft:s.marginLeft,marginRight:s.marginRight,marginTop:s.marginTop,marginBottom:s.marginBottom},s.overflow="hidden",s.position="fixed",s.top="0",s.bottom="0",s.right="0",s.left="0",s.width="100%",s.height="100%",s.maxWidth="100%",s.maxHeight="100%",s.margin="0",s.marginLeft="0",s.marginRight="0",s.marginTop="0",s.marginBottom="0"}else{let o=n.children;for(let i=0;i<o.length;i++)if(o[i]===this.expandedViewport){n.removeChild(this.expandedViewport);break}if(this.rootState){let i=this.rootState;for(let l of i.viewports)n.appendChild(l);let a=r.style;a.top=i.top,a.bottom=i.bottom,a.left=i.left,a.right=i.right,a.width=i.width,a.height=i.height,a.maxWidth=i.maxWidth,a.maxHeight=i.maxHeight,a.margin=i.margin,a.marginLeft=i.marginLeft,a.marginRight=i.marginRight,a.marginTop=i.marginTop,a.marginBottom=i.marginBottom,a.position=i.position,a.overflow=i.overflow||"";let s=this.getScrollElement();s.scrollTop=i.scrollTop,s.scrollLeft=i.scrollLeft,this.rootState=void 0,this.root.style.zIndex=i.zIndex}}}catch(r){let n="Layout change error, you might have to reload the page.";this.context.log.error(n),console.error(n,r)}}};var pZ={includeTypes:C.MultiSelect($C(ht.Names),C.objectToOptions(ht.Names)),excludeTypes:C.MultiSelect([],C.objectToOptions(ht.Names)),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),aromaticBonds:C.Boolean(!0,{description:"Display aromatic bonds with dashes"}),multipleBonds:C.Select("symmetric",C.arrayToOptions(["off","symmetric","offset"]))},iTn=C.getDefaultValues(pZ),QA={...hd,...pZ,adjustCylinderLength:C.Boolean(!1,{description:"Shorten cylinders to reduce overlap with spheres. Useful for for transparent bonds. Not working well with aromatic bonds."})},aTn=C.getDefaultValues(QA),ZA={...WW,...pZ},sTn=C.getDefaultValues(ZA);function qA(e,t,r){return!ht.is(e,r)||ht.is(t,r)}function $V(e,t,r){let n=t.elements,o=t.bonds,{a:i,b:a,edgeProps:s}=o,{flags:l}=s,{ignoreHydrogens:u,ignoreHydrogensVariant:c,includeTypes:m,excludeTypes:d}=r,p=ht.fromNames(m),h=ht.fromNames(d),f=ht.isAll(p)&&ht.Flag.None===h,{child:y}=e,g=y?.unitMap.get(t.id);if(y&&!g)throw new Error("expected childUnit to exist if child exists");if(!(f&&!u&&!y))return x=>{let S=i[x],I=a[x];return g&&!Be.has(g.elements,n[S])||!f&&qA(p,h,l[x])?!0:u?!!(Mc(e,t,n[S],c)||Mc(e,t,n[I],c)):!1}}function eO(e,t){let r=e.interUnitBonds,{edges:n}=r,{ignoreHydrogens:o,ignoreHydrogensVariant:i,includeTypes:a,excludeTypes:s}=t,l=ht.fromNames(a),u=ht.fromNames(s),c=ht.isAll(l)&&ht.Flag.None===u,{child:m}=e;if(!(c&&!o&&!m))return d=>{if(m){let p=n[d],h=m.unitMap.get(p.unitA);if(!h)return!0;let y=e.unitMap.get(p.unitA).elements[p.indexA];if(!Be.has(h.elements,y))return!0}if(o){let p=n[d],h=e.unitMap.get(p.unitA),f=e.unitMap.get(p.unitB);if(Mc(e,h,h.elements[p.indexA],i)||Mc(e,f,f.elements[p.indexB],i))return!0}return!!(!c&&qA(l,u,n[d].props.flag))}}function Qy(e,t){return me.Traits.is(e.traits,me.Trait.Water)?!t.ignoreHydrogens||t.ignoreHydrogensVariant==="non-polar":!0}function gs(e,t){for(let{units:r}of e.unitSymmetryGroups)if(me.isAtomic(r[0])&&Qy(r[0],t))return!0;return!1}var Am;(n=>{function e(o,i){let{group:a,structure:s}=o,l=a.units[0],u=me.isAtomic(l)?l.bonds.edgeCount*2:0,c=a.units.length,m=Ct.Location(s,void 0,void 0,s,void 0,void 0),d=(p,h)=>{let f=a.units[h];return m.aUnit=f,m.bUnit=f,m.aIndex=f.bonds.a[p],m.bIndex=f.bonds.b[p],m};if(i?.includeLocation2){let p=Ct.Location(s,void 0,void 0,s,void 0,void 0);return Kr(u,c,1,d,!1,()=>!1,(f,y)=>{let g=a.units[y];return p.aUnit=g,p.bUnit=g,p.aIndex=g.bonds.b[f],p.bIndex=g.bonds.a[f],p})}return Kr(u,c,1,d)}n.fromGroup=e;function t(o,i){let a=o.interUnitBonds.edgeCount,s=1,l=Ct.Location(o,void 0,void 0,o,void 0,void 0),u=c=>{let m=o.interUnitBonds.edges[c];return l.aUnit=o.unitMap.get(m.unitA),l.aIndex=m.indexA,l.bUnit=o.unitMap.get(m.unitB),l.bIndex=m.indexB,l};if(i?.includeLocation2){let c=Ct.Location(o,void 0,void 0,o,void 0,void 0);return Kr(a,s,1,u,!0,()=>!1,d=>{let p=o.interUnitBonds.edges[d];return c.aUnit=o.unitMap.get(p.unitB),c.aIndex=p.indexB,c.bUnit=o.unitMap.get(p.unitA),c.bIndex=p.indexA,c})}return Kr(a,s,1,u,!0)}n.fromStructure=t;function r(o,i){let{bondCount:a,unitIndex:s,unitGroupIndex:l,unitEdgeIndex:u}=o.intraUnitBondMapping,c=a,m=1,d=Ct.Location(o,void 0,void 0,o,void 0,void 0),p=h=>{let y=o.unitSymmetryGroups[s[h]].units[l[h]],g=u[h];return d.aUnit=y,d.bUnit=y,d.aIndex=y.bonds.a[g],d.bIndex=y.bonds.b[g],d};if(i?.includeLocation2){let h=Ct.Location(o,void 0,void 0,o,void 0,void 0);return Kr(c,m,1,p,!0,()=>!1,y=>{let x=o.unitSymmetryGroups[s[y]].units[l[y]],S=u[y];return h.aUnit=x,h.bUnit=x,h.aIndex=x.bonds.b[S],h.bIndex=x.bonds.a[S],h})}return Kr(c,m,1,p,!0)}n.fromStructureGroups=r})(Am||={});function YA(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:a,group:s}=t,l=s.units[o];if(me.isAtomic(l)){let{target:u}=a,c=l.bonds.a[i],m=l.bonds.b[i];return Ct.Loci(u,[Ct.Location(u,l,c,u,l,m),Ct.Location(u,l,m,u,l,c)])}}return dr}function YR(e,t,r,n){let o=!1;if(Ct.isLoci(e)){let{structure:i,group:a}=t;if(!De.areEquivalent(e.structure,i))return!1;let s=a.units[0];if(!me.isAtomic(s))return!1;let l=s.bonds.edgeCount*2;for(let u of e.bonds){if(u.aUnit!==u.bUnit)continue;let c=a.unitIndexMap.get(u.aUnit.id);if(c!==void 0){let m=s.bonds.getDirectedEdgeIndex(u.aIndex,u.bIndex);m!==-1&&r(xe.ofSingleton(c*l+m))&&(o=!0)}}}else if(K.Loci.is(e)){let{structure:i,group:a}=t;if(!De.areEquivalent(e.structure,i))return!1;let s=a.units[0];if(!me.isAtomic(s))return!1;let l=s.bonds.edgeCount*2;for(let u of e.elements){let c=a.unitIndexMap.get(u.unit.id);if(c!==void 0){let{offset:m,b:d}=s.bonds;Se.forEach(u.indices,p=>{for(let h=m[p],f=m[p+1];h<f;h++)(!n||Se.has(u.indices,d[h]))&&r(xe.ofSingleton(c*l+h))&&(o=!0)})}}}return o}function KR(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let{target:i}=t,a=t.interUnitBonds.edges[o],s=t.unitMap.get(a.unitA),l=t.unitMap.get(a.unitB);return Ct.Loci(i,[Ct.Location(i,s,a.indexA,i,l,a.indexB),Ct.Location(i,l,a.indexB,i,s,a.indexA)])}return dr}var dZ=new Map;function JR(e,t,r,n){let o=!1;if(Ct.isLoci(e)){if(!De.areEquivalent(e.structure,t))return!1;for(let i of e.bonds){let a=t.interUnitBonds.getBondIndexFromLocation(i);a!==-1&&r(xe.ofSingleton(a))&&(o=!0)}}else if(K.Loci.is(e)){if(!De.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;for(let i of e.elements)dZ.set(i.unit.id,i.indices);for(let i of e.elements){let{unit:a}=i;if(me.isAtomic(a))for(let s of t.interUnitBonds.getConnectedUnits(a.id)){let l=dZ.get(s.unitB);(!n||l)&&Se.forEach(i.indices,u=>{if(s.connectedIndices.includes(u)){for(let c of s.getEdges(u))if(!n||l&&Se.has(l,c.indexB)){let m=t.interUnitBonds.getEdgeIndex(u,a.id,c.indexB,s.unitB);r(xe.ofSingleton(m))&&(o=!0)}}})}}dZ.clear()}return o}function $R(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let i=t.intraUnitBondMapping;return YA({objectId:n,instanceId:i.unitGroupIndex[o],groupId:i.unitEdgeIndex[o]},{structure:t,group:t.unitSymmetryGroups[i.unitIndex[o]]},r)}return dr}function eD(e,t,r,n){let{unitGroupOffset:o}=t.intraUnitBondMapping,i=!1;if(Ct.isLoci(e)){if(!De.areEquivalent(e.structure,t))return!1;for(let a of e.bonds){if(a.aUnit!==a.bUnit)continue;let s=t.unitSymmetryGroupsIndexMap.get(a.aUnit.id),l=t.unitSymmetryGroups[s],u=l.units[0];if(!me.isAtomic(u))continue;let c=o[s],m=u.bonds.edgeCount*2,d=l.unitIndexMap.get(a.aUnit.id);if(d!==void 0){let p=u.bonds.getDirectedEdgeIndex(a.aIndex,a.bIndex);p!==-1&&r(xe.ofSingleton(d*m+p+c))&&(i=!0)}}}else if(K.Loci.is(e)){if(!De.areEquivalent(e.structure,t))return!1;for(let a of e.elements){let s=t.unitSymmetryGroupsIndexMap.get(a.unit.id),l=t.unitSymmetryGroups[s],u=l.units[0];if(!me.isAtomic(u))continue;let c=o[s],m=u.bonds.edgeCount*2,d=l.unitIndexMap.get(a.unit.id);if(d!==void 0){let{offset:p,b:h}=u.bonds;Se.forEach(a.indices,f=>{for(let y=p[f],g=p[f+1];y<g;y++)(!n||Se.has(a.indices,h[y]))&&r(xe.ofSingleton(d*m+y+c))&&(i=!0)})}}}return i}var fZ=ht.is;function hZ(e,t,r,n){let o=e.elements,i=e.bonds,{edgeCount:a,a:s,b:l,edgeProps:u,offset:c}=i,{order:m,flags:d}=u,{sizeFactor:p,sizeAspectRatio:h,adjustCylinderLength:f,aromaticBonds:y,includeTypes:g,excludeTypes:x,multipleBonds:S}=n,I=S==="off",v=S==="symmetric",A=ht.fromNames(g),_=ht.fromNames(x),T=qA(A,_,ht.Flag.Computed),w=b(),D=b(),M=e.conformation,E,R=K.Location.create(t,e),k=Ct.Location(t,e,void 0,t,e,void 0),{child:B}=t;if(n.includeParent&&B){let X=B.unitMap.get(e.id);if(!X)throw new Error("expected childUnit to exist");E=F=>{let Y=o[s[F]],$=o[l[F]];return Be.has(X.elements,Y)&&!Be.has(X.elements,$)}}let L=X=>(k.aIndex=s[X],k.bIndex=l[X],r.size.size(k)*p),V=X=>(R.element=o[s[X]],r.size.size(R)*p),U=X=>(R.element=o[l[X]],r.size.size(R)*p),{elementRingIndices:Q,elementAromaticRingIndices:O}=e.rings,q=y?e.resonance.delocalizedTriplets:void 0;return{linkCount:a*2,referencePosition:X=>{let F=s[X],Y=l[X],$=q?.getThirdElement(F,Y);if($!==void 0)return M.invariantPosition(o[$],w);F>Y&&([F,Y]=[Y,F]),c[F+1]-c[F]===1&&([F,Y]=[Y,F]);let ce=O.get(F)||Q.get(F),ie=0;for(let oe=c[F],W=c[F+1];oe<W;++oe){let N=l[oe];if(N!==Y&&N!==F)if(ce){let j=O.get(N)||Q.get(N);if(!j)continue;let ue=l1(ce,j);ue>ie&&(ie=ue,M.invariantPosition(o[N],w))}else return M.invariantPosition(o[N],w)}return ie>0?w:null},position:(X,F,Y,$)=>{if(M.invariantPosition(o[s[Y]],X),M.invariantPosition(o[l[Y]],F),$&&f){let ce=V(Y),ie=U(Y),oe=Math.min(ce,ie)*h,W=Math.sqrt(Math.max(0,ce*ce-oe*oe))-.05,N=Math.sqrt(Math.max(0,ie*ie-oe*oe))-.05;if(W<=.01&&N<=.01)return;b.normalize(D,b.sub(D,F,X)),b.scaleAndAdd(X,X,D,W),b.scaleAndAdd(F,F,D,-N)}},style:X=>{let F=m[X],Y=d[X];if(fZ(Y,ht.Flag.MetallicCoordination)||fZ(Y,ht.Flag.HydrogenBond))return 1;if(F===3)return I?0:v?4:5;if(y){let $=s[X],ce=l[X],ie=O.get($),oe=O.get(ce),W=ie&&oe?l1(ie,oe):0;if(fZ(Y,ht.Flag.Aromatic)||W&&!T)return W===2?8:7}return F!==2||I?0:v?2:3},radius:X=>L(X)*h,ignore:$V(t,e,n),stub:E}}function Hpt(e,t,r,n,o,i){if(!me.isAtomic(t))return Di.createEmpty(i);if(!Qy(t,o))return Di.createEmpty(i);if(!t.bonds.edgeCount)return Di.createEmpty(i);let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return Di.createEmpty(i);let l=hZ(t,r,n,o),{cylinders:u,boundingSphere:c}=gR(e,l,o,i);if(c)u.setBoundingSphere(c);else if(u.cylinderCount>0){let m=ye.expand(ye(),(s??t).boundary.sphere,1*o.sizeFactor);u.setBoundingSphere(m)}return u}function jpt(e,t,r,n,o,i){if(!me.isAtomic(t))return ft.createEmpty(i);if(!Qy(t,o))return ft.createEmpty(i);if(!t.bonds.edgeCount)return ft.createEmpty(i);let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return ft.createEmpty(i);let l=hZ(t,r,n,o),{mesh:u,boundingSphere:c}=Oc(e,l,o,i);if(c)u.setBoundingSphere(c);else if(u.triangleCount>0){let m=ye.expand(ye(),(s??t).boundary.sphere,1*o.sizeFactor);u.setBoundingSphere(m)}return u}var KA={...ro,...QI,...QA,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:C.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:C.Boolean(!0),includeParent:C.Boolean(!1)};function tO(e,t,r,n){return r.tryUseImpostor&&Ox(n)?Wpt(e):Xpt(e)}function Wpt(e){return ZI({defaultProps:C.getDefaultValues(KA),createGeometry:Hpt,createLocationIterator:(t,r)=>Am.fromGroup(t,{includeLocation2:r.colorMode==="interpolate"}),getLoci:YA,eachLocation:YR,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!ki(r.includeTypes,n.includeTypes)||!ki(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds||r.adjustCylinderLength&&!yo.areEqual(o.size,i.size),r.colorMode!==n.colorMode&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0);let l=a.group.units[0],u=s.group.units[0];me.isAtomic(l)&&me.isAtomic(u)&&(ns.areEqual(l.bonds,u.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function Xpt(e){return So({defaultProps:C.getDefaultValues(KA),createGeometry:jpt,createLocationIterator:t=>Am.fromGroup(t),getLoci:YA,eachLocation:YR,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!ki(r.includeTypes,n.includeTypes)||!ki(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;let l=a.group.units[0],u=s.group.units[0];me.isAtomic(l)&&me.isAtomic(u)&&(ns.areEqual(l.bonds,u.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}function n_e(e,t,r){let n=[],{bondCount:o,unitIndex:i,unitEdgeIndex:a,unitGroupIndex:s}=e.intraUnitBondMapping,{child:l}=e;for(let u of e.unitSymmetryGroups){let c=u.units[0],m=l?.unitMap.get(c.id),d=me.isAtomic(c)&&!(l&&!m)?hZ(c,e,t,r):yF;n.push({group:u,props:d})}return{linkCount:o,referencePosition:u=>{let{group:c,props:m}=n[i[u]];if(!m.referencePosition)return null;let d=m.referencePosition(a[u]);if(!d)return null;let p=c.units[s[u]];return b.transformMat4(d,d,p.conformation.operator.matrix),d},position:(u,c,m,d)=>{let{group:p,props:h}=n[i[m]];h.position(u,c,a[m],d);let f=p.units[s[m]];b.transformMat4(u,u,f.conformation.operator.matrix),b.transformMat4(c,c,f.conformation.operator.matrix)},style:u=>{let{props:c}=n[i[u]];return c.style?c.style(a[u]):0},radius:u=>{let{props:c}=n[i[u]];return c.radius(a[u])},ignore:u=>{let{props:c}=n[i[u]];return c.ignore?c.ignore(a[u]):!1},stub:u=>{let{props:c}=n[i[u]];return c.stub?c.stub(a[u]):!1}}}function Qpt(e,t,r,n,o){if(!gs(t,n))return Di.createEmpty(o);if(!t.intraUnitBondMapping.bondCount)return Di.createEmpty(o);let i=n_e(t,r,n),{cylinders:a,boundingSphere:s}=gR(e,i,n,o);if(s)a.setBoundingSphere(s);else if(a.cylinderCount>0){let{child:l}=t,u=ye.expand(ye(),(l??t).boundary.sphere,1*n.sizeFactor);a.setBoundingSphere(u)}return a}function Zpt(e,t,r,n,o){if(!gs(t,n))return ft.createEmpty(o);if(!t.intraUnitBondMapping.bondCount)return ft.createEmpty(o);let i=n_e(t,r,n),{mesh:a,boundingSphere:s}=Oc(e,i,n,o);if(s)a.setBoundingSphere(s);else if(a.triangleCount>0){let{child:l}=t,u=ye.expand(ye(),(l??t).boundary.sphere,1*n.sizeFactor);a.setBoundingSphere(u)}return a}var o_e={...Qu,...nL,...QA,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:C.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:C.Boolean(!0),includeParent:C.Boolean(!1)};function rO(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?qpt(e):Ypt(e)}function qpt(e){return oL({defaultProps:C.getDefaultValues(o_e),createGeometry:Qpt,createLocationIterator:(t,r)=>gs(t,r)?Am.fromStructureGroups(t,{includeLocation2:r.colorMode==="interpolate"}):wh,getLoci:$R,eachLocation:eD,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!ki(r.includeTypes,n.includeTypes)||!ki(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,r.colorMode!==n.colorMode&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0),gs(a,r)&&a.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function Ypt(e){return cs({defaultProps:C.getDefaultValues(o_e),createGeometry:Zpt,createLocationIterator:(t,r)=>gs(t,r)?Am.fromStructureGroups(t):wh,getLoci:$R,eachLocation:eD,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!ki(r.includeTypes,n.includeTypes)||!ki(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds||r.adjustCylinderLength&&!yo.areEqual(o.size,i.size),gs(a,r)&&a.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var gZ=new Ct.ElementBondIterator;function i_e(e,t,r,n){for(gZ.setElement(t,r,n);gZ.hasNext;){let o=gZ.move();return o.otherUnit.conformation.position(o.otherUnit.elements[o.otherIndex],e),e}return null}var a_e=b();function s_e(e,t,r){let n=K.Location.create(e),o=Ct.Location(e,void 0,void 0,e,void 0,void 0),i=e.interUnitBonds,{edgeCount:a,edges:s}=i,{sizeFactor:l,sizeAspectRatio:u,adjustCylinderLength:c,aromaticBonds:m,multipleBonds:d}=r,p=d==="off",h=d==="symmetric",f=b(),y,{child:g}=e;r.includeParent&&g&&(y=v=>{let A=s[v],_=g.unitMap.get(A.unitA),T=g.unitMap.get(A.unitB),D=e.unitMap.get(A.unitA).elements[A.indexA],E=e.unitMap.get(A.unitB).elements[A.indexB];return _&&Be.has(_.elements,D)&&(!T||!Be.has(T.elements,E))});let x=v=>{let A=s[v];return o.aUnit=e.unitMap.get(A.unitA),o.aIndex=A.indexA,o.bUnit=e.unitMap.get(A.unitB),o.bIndex=A.indexB,t.size.size(o)*l},S=v=>{let A=s[v];return n.unit=e.unitMap.get(A.unitA),n.element=n.unit.elements[A.indexA],t.size.size(n)*l},I=v=>{let A=s[v];return n.unit=e.unitMap.get(A.unitB),n.element=n.unit.elements[A.indexB],t.size.size(n)*l};return{linkCount:a,referencePosition:v=>{let A=s[v],_,T,w,D;if(A.unitA<A.unitB)_=e.unitMap.get(A.unitA),T=e.unitMap.get(A.unitB),w=A.indexA,D=A.indexB;else if(A.unitA>A.unitB)_=e.unitMap.get(A.unitB),T=e.unitMap.get(A.unitA),w=A.indexB,D=A.indexA;else throw new Error("same units in createInterUnitBondCylinderMesh");return i_e(a_e,e,_,w)||i_e(a_e,e,T,D)},position:(v,A,_,T)=>{let w=s[_],D=e.unitMap.get(w.unitA),M=e.unitMap.get(w.unitB);if(D.conformation.position(D.elements[w.indexA],v),M.conformation.position(M.elements[w.indexB],A),T&&c){let E=S(_),R=I(_),k=Math.min(E,R)*u,B=Math.sqrt(Math.max(0,E*E-k*k))-.05,L=Math.sqrt(Math.max(0,R*R-k*k))-.05;if(B<=.01&&L<=.01)return;b.normalize(f,b.sub(f,A,v)),b.scaleAndAdd(v,v,f,B),b.scaleAndAdd(A,A,f,-L)}},style:v=>{let A=s[v].props.order,_=na.create(s[v].props.flag);return ht.is(_,ht.Flag.MetallicCoordination)||ht.is(_,ht.Flag.HydrogenBond)?1:A===3?p?0:h?4:5:m&&ht.is(_,ht.Flag.Aromatic)?7:A!==2||p?0:h?2:3},radius:v=>x(v)*u,ignore:eO(e,r),stub:y}}function Kpt(e,t,r,n,o){if(!gs(t,n))return Di.createEmpty(o);if(!t.interUnitBonds.edgeCount)return Di.createEmpty(o);let i=s_e(t,r,n),{cylinders:a,boundingSphere:s}=gR(e,i,n,o);if(s)a.setBoundingSphere(s);else if(a.cylinderCount>0){let{child:l}=t,u=ye.expand(ye(),(l??t).boundary.sphere,1*n.sizeFactor);a.setBoundingSphere(u)}return a}function Jpt(e,t,r,n,o){if(!gs(t,n))return ft.createEmpty(o);if(!t.interUnitBonds.edgeCount)return ft.createEmpty(o);let i=s_e(t,r,n),{mesh:a,boundingSphere:s}=Oc(e,i,n,o);if(s)a.setBoundingSphere(s);else if(a.triangleCount>0){let{child:l}=t,u=ye.expand(ye(),(l??t).boundary.sphere,1*n.sizeFactor);a.setBoundingSphere(u)}return a}var JA={...Qu,...nL,...QA,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:C.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:C.Boolean(!0),includeParent:C.Boolean(!1)};function nO(e,t,r,n){return r.tryUseImpostor&&Ox(n)?$pt(e):eft(e)}function $pt(e){return oL({defaultProps:C.getDefaultValues(JA),createGeometry:Kpt,createLocationIterator:(t,r)=>gs(t,r)?Am.fromStructure(t,{includeLocation2:r.colorMode==="interpolate"}):wh,getLoci:KR,eachLocation:JR,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!ki(r.includeTypes,n.includeTypes)||!ki(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,r.colorMode!==n.colorMode&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0),gs(a,r)&&a.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function eft(e){return cs({defaultProps:C.getDefaultValues(JA),createGeometry:Jpt,createLocationIterator:(t,r)=>gs(t,r)?Am.fromStructure(t):wh,getLoci:KR,eachLocation:JR,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!ki(r.includeTypes,n.includeTypes)||!ki(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds||r.adjustCylinderLength&&!yo.areEqual(o.size,i.size),gs(a,r)&&a.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var l_e={sizeFactor:C.Numeric(1,{min:0,max:10,step:.1}),detail:C.Numeric(0,{min:0,max:3,step:1},We.CustomQualityParamInfo),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1),tryUseImpostor:C.Boolean(!0),stride:C.Numeric(1,{min:1,max:100,step:1})},$A={...ro,...WI,...l_e};function oO(e,t,r,n){return r.tryUseImpostor&&GI(n)?tft(e):rft(e)}function tft(e){return XI({defaultProps:C.getDefaultValues($A),createGeometry:N0e,createLocationIterator:uo.fromGroup,getLoci:Zs,eachLocation:Qs,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function rft(e){return So({defaultProps:C.getDefaultValues($A),createGeometry:U0e,createLocationIterator:uo.fromGroup,getLoci:Zs,eachLocation:Qs,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var u_e={...Qu,...I0e,...l_e};function iO(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth&&n.extensions.textureFloat?nft(e):oft(e)}function nft(e){return A0e({defaultProps:C.getDefaultValues(u_e),createGeometry:H0e,createLocationIterator:uo.fromStructure,getLoci:Sa,eachLocation:Ca,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function oft(e){return cs({defaultProps:C.getDefaultValues(u_e),createGeometry:z0e,createLocationIterator:uo.fromStructure,getLoci:Sa,eachLocation:Ca,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var c_e={"element-sphere":(e,t)=>Qn("Element sphere",e,t,oO),"intra-bond":(e,t)=>Qn("Intra-unit bond cylinder",e,t,tO),"inter-bond":(e,t)=>to("Inter-unit bond cylinder",e,t,nO),"structure-element-sphere":(e,t)=>to("Structure element sphere",e,t,iO),"structure-intra-bond":(e,t)=>to("Structure intra-unit bond cylinder",e,t,rO)},m_e={...$A,traceOnly:C.Boolean(!1,{isHidden:!0}),...KA,...JA,includeParent:C.Boolean(!1),unitKinds:Ry(["atomic"]),sizeFactor:C.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:C.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:C.MultiSelect(["element-sphere","intra-bond","inter-bond"],C.objectToOptions(c_e)),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},We.ShadingCategory),density:C.Numeric(.1,{min:0,max:1,step:.01},We.ShadingCategory)};function ift(e,t){let r=m_e;return De.getSize(t)>=De.Size.Huge?(r=C.clone(r),r.visuals.defaultValue=["element-sphere","intra-bond"]):t.unitSymmetryGroups.length>5e3&&(r=C.clone(r),r.visuals.defaultValue=["structure-element-sphere","structure-intra-bond"]),r}function aft(e,t){return Vt.createMulti("Ball & Stick",e,t,Gn,c_e)}var d_e={name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:aft,getParams:ift,defaultValues:C.getDefaultValues(m_e),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};function sft(e,t,r,n,o){let{links:i,elements:a}=t.carbohydrates,{linkSizeFactor:s}=n,l=K.Location.create(t),u={linkCount:i.length,position:(d,p,h)=>{let f=i[h];b.copy(d,a[f.carbohydrateIndexA].geometry.center),b.copy(p,a[f.carbohydrateIndexB].geometry.center)},radius:d=>{let p=i[d],h=a[p.carbohydrateIndexA],f=h.unit.rings.all[h.ringIndex];return l.unit=h.unit,l.element=h.unit.elements[f[0]],r.size.size(l)*s}},{mesh:c,boundingSphere:m}=Oc(e,u,n,o);if(m)c.setBoundingSphere(m);else if(c.triangleCount>0){let d=ye.expand(ye(),t.boundary.sphere,1*s);c.setBoundingSphere(d)}return c}var bZ={...ro,...hd,linkSizeFactor:C.Numeric(.3,{min:0,max:3,step:.01})};function p_e(e){return cs({defaultProps:C.getDefaultValues(bZ),createGeometry:sft,createLocationIterator:lft,getLoci:uft,eachLocation:cft,setUpdateState:(t,r,n)=>{t.createGeometry=r.linkSizeFactor!==n.linkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function lft(e){let{elements:t,links:r}=e.carbohydrates,n=r.length,o=1,i=K.Location.create(e);return Kr(n,o,1,s=>{let l=r[s],u=t[l.carbohydrateIndexA],c=u.unit.rings.all[u.ringIndex];return i.unit=u.unit,i.element=u.unit.elements[c[0]],i},!0)}function uft(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let{links:i,elements:a}=t.carbohydrates,s=i[o],l=a[s.carbohydrateIndexA],u=a[s.carbohydrateIndexB];return K.Loci.union(Gx(t,l.unit,l.residueIndex,l.altId),Gx(t,u.unit,u.residueIndex,u.altId))}return dr}var yZ=new Set;function cft(e,t,r){let n=!1;if(!K.Loci.is(e)||!De.areEquivalent(e.structure,t))return!1;let{getLinkIndices:o}=t.carbohydrates;for(let{unit:i,indices:a}of e.elements)me.isAtomic(i)&&(yZ.clear(),Se.forEach(a,s=>{let l=o(i,i.elements[s]);for(let u=0,c=l.length;u<c;++u)yZ.has(l[u])||(yZ.add(l[u]),r(xe.ofSingleton(l[u]))&&(n=!0))}));return n}var mft=b.create(0,0,-.5),dft=b.create(0,0,.5),yC=b(),bC=b(),aO=b(),f_e=b();function pft(e){let t=e.length/3,n=(t===3?1:t===4?2:t)+t,o=t===4?t*3+4:n*3,i=ff(n,o);for(let a=0;a<t;++a){let s=(a+1)%t;b.set(yC,e[a*3],e[a*3+1],-.5),b.set(bC,e[s*3],e[s*3+1],-.5),i.add(yC,bC,dft)}if(t===3)b.set(yC,e[0],e[1],-.5),b.set(bC,e[3],e[4],-.5),b.set(aO,e[6],e[7],-.5),i.add(aO,bC,yC);else if(t===4)b.set(yC,e[0],e[1],-.5),b.set(bC,e[3],e[4],-.5),b.set(aO,e[6],e[7],-.5),b.set(f_e,e[9],e[10],-.5),i.addQuad(f_e,aO,bC,yC);else for(let a=0;a<t;++a){let s=(a+1)%t;b.set(yC,e[a*3],e[a*3+1],-.5),b.set(bC,e[s*3],e[s*3+1],-.5),i.add(mft,bC,yC)}return i.getPrimitive()}var xZ;function h_e(){return xZ||(xZ=pft(Rc(8,!0))),xZ}var CZ;function g_e(){if(!CZ){let e=Rc(8,!0),t=new Float32Array(8*3+6);for(let n=0;n<8;++n)t[n*3]=e[n*3],t[n*3+1]=e[n*3+1],t[n*3+2]=-.5;t[8*3]=0,t[8*3+1]=0,t[8*3+2]=-.5,t[8*3+3]=0,t[8*3+4]=0,t[8*3+5]=.5,CZ=K0(t,[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9])}return CZ}var fft={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},SZ=b.zero(),vZ=b.zero(),IZ=b.zero(),tD=b.zero(),AZ=b.zero();function y_e(e){let{outerRadius:t,innerRadius:r,thickness:n,pointCount:o}={...fft,...e},i=o*2*2,a=ff(i),s=new Float32Array(o*2),l=new Float32Array(o*2);for(let u=0;u<o;++u){let c=u*2,m=u*2+1,d=(c+1)/o*Math.PI,p=(m+1)/o*Math.PI;l[c]=Math.cos(d)*t,l[m]=Math.sin(d)*t,s[c]=Math.cos(p)*r,s[m]=Math.sin(p)*r}b.set(SZ,0,0,n/2),b.set(vZ,0,0,-n/2);for(let u=0;u<o;++u){let c=(u+1)%o;b.set(IZ,l[u*2],l[u*2+1],0),b.set(tD,s[u*2],s[u*2+1],0),b.set(AZ,l[c*2],l[c*2+1],0),a.add(SZ,IZ,tD),a.add(tD,IZ,vZ),a.add(SZ,tD,AZ),a.add(AZ,tD,vZ)}return a.getPrimitive()}var _Z=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],hft=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],gft=[0,2,4,0,4,3,1,2,5,1,5,3],yft=[0,2,1,3,2,1,3,0,0,4,1,4,2,4,3,4,0,5,1,5,2,5,3,5],TZ;function b_e(){return TZ||(TZ=K0(_Z,hft)),TZ}var PZ;function x_e(){return PZ||(PZ=K0(_Z,gft)),PZ}var JPn=Eh(_Z,yft);var gr=Z.identity(),Zy=b(),C_e=b(),bft=2*.806,S_e=Tx(),v_e=Ihe(),xft=h_e(),I_e=g_e(),Cft=y_e({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),Sft=b_e(),A_e=x_e(),T_e=dye(),vft=pye(),Ift=fye(),Aft=hye(),Tft=gye();function Pft(e,t,r,n,o){let i=et.createState(256,128,o),{detail:a,sizeFactor:s}=n,l=t.carbohydrates,u=l.elements.length,c=K.Location.create(t);for(let m=0;m<u;++m){let d=l.elements[m],p=d.unit.rings.all[d.ringIndex],h=cse(d.component.type,p.length);c.unit=d.unit,c.element=d.unit.elements[p[0]];let f=r.size.size(c),y=f*s,g=f*s*bft,{center:x,normal:S,direction:I}=d.geometry;switch(b.add(C_e,x,I),Z.targetTo(gr,x,C_e,S),Z.setTranslation(gr,x),i.currentGroup=m*2,h){case 0:Nr(i,x,y,a);break;case 1:Z.scaleUniformly(gr,gr,g),et.addPrimitive(i,gr,S_e);break;case 2:Z.scaleUniformly(gr,gr,g),et.addPrimitive(i,gr,v_e),Z.mul(gr,gr,Z.rotZ90X180),i.currentGroup+=1,et.addPrimitive(i,gr,v_e);break;case 4:Z.scaleUniformly(gr,gr,g*1.2),et.addPrimitive(i,gr,xft);break;case 5:Z.scaleUniformly(gr,gr,g*1.2),et.addPrimitive(i,gr,I_e),Z.mul(gr,gr,Z.rotZ90),i.currentGroup+=1,et.addPrimitive(i,gr,I_e);break;case 6:Z.mul(gr,gr,Z.rotZY90),Z.scale(gr,gr,b.set(Zy,g,g,g/2)),et.addPrimitive(i,gr,S_e);break;case 7:Z.scaleUniformly(gr,gr,g),Z.mul(gr,gr,Z.rotZY90),et.addPrimitive(i,gr,Cft);break;case 8:Z.mul(gr,gr,Z.rotZY90),Z.scale(gr,gr,b.set(Zy,g*1.4,g*1.4,g*1.4)),et.addPrimitive(i,gr,Sft);break;case 3:Z.mul(gr,gr,Z.rotZY90),Z.scale(gr,gr,b.set(Zy,g*1.4,g*1.4,g*1.4)),et.addPrimitive(i,gr,A_e),Z.mul(gr,gr,Z.rotY90),i.currentGroup+=1,et.addPrimitive(i,gr,A_e);break;case 9:Z.mul(gr,gr,Z.rotZY90),Z.scale(gr,gr,b.set(Zy,g,g/2,g/2)),et.addPrimitive(i,gr,T_e);break;case 12:Z.mul(gr,gr,Z.rotZY90),Z.scale(gr,gr,b.set(Zy,g,g,g/2)),et.addPrimitive(i,gr,T_e);break;case 13:case 11:Z.mul(gr,gr,Z.rotZY90),Z.scale(gr,gr,b.set(Zy,g,g,g/2)),et.addPrimitive(i,gr,vft);break;case 14:Z.mul(gr,gr,Z.rotZY90),Z.scale(gr,gr,b.set(Zy,g,g,g/2)),et.addPrimitive(i,gr,Ift);break;case 15:Z.mul(gr,gr,Z.rotZY90),Z.scale(gr,gr,b.set(Zy,g,g,g/2)),et.addPrimitive(i,gr,Tft);break;case 10:default:Z.mul(gr,gr,Z.rotZYZ90),Z.scale(gr,gr,b.set(Zy,g/1.5,g,g/2)),et.addPrimitive(i,gr,Aft);break}}return et.getMesh(i)}var DZ={...Qu,detail:C.Numeric(0,{min:0,max:3,step:1},We.CustomQualityParamInfo),sizeFactor:C.Numeric(1.75,{min:0,max:10,step:.01})};function P_e(e){return cs({defaultProps:C.getDefaultValues(DZ),createGeometry:Pft,createLocationIterator:_ft,getLoci:Rft,eachLocation:Dft,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function _ft(e){let t=e.carbohydrates.elements,r=t.length*2,n=1,o=K.Location.create(e);function i(s,l){let u=t[Math.floor(s/2)],c=u.unit.rings.all[u.ringIndex];return o.unit=u.unit,o.element=u.unit.elements[c[0]],o}function a(s,l){return s%2===1}return Kr(r,n,1,i,!0,a)}function Rft(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let i=t.carbohydrates.elements[Math.floor(o/2)];return Gx(t,i.unit,i.residueIndex,i.altId)}return dr}var RZ=new Set;function Dft(e,t,r){let{getElementIndices:n}=t.carbohydrates,o=!1;if(!K.Loci.is(e)||!De.areEquivalent(e.structure,t))return!1;for(let{unit:i,indices:a}of e.elements)me.isAtomic(i)&&(RZ.clear(),Se.forEach(a,s=>{let l=n(i,i.elements[s]);for(let u=0,c=l.length;u<c;++u)RZ.has(l[u])||(RZ.add(l[u]),r(xe.ofSingleton(l[u]*2))&&(o=!0))}));return o}function wft(e,t,r,n,o){let{terminalLinks:i,elements:a}=t.carbohydrates,{terminalLinkSizeFactor:s}=n,l=K.Location.create(t),u={linkCount:i.length,position:(d,p,h)=>{let f=i[h];f.fromCarbohydrate?(b.copy(d,a[f.carbohydrateIndex].geometry.center),f.elementUnit.conformation.position(f.elementUnit.elements[f.elementIndex],p)):(f.elementUnit.conformation.position(f.elementUnit.elements[f.elementIndex],d),b.copy(p,a[f.carbohydrateIndex].geometry.center))},radius:d=>{let p=i[d];if(p.fromCarbohydrate){let h=a[p.carbohydrateIndex],f=h.unit.rings.all[h.ringIndex];l.unit=h.unit,l.element=h.unit.elements[f[0]]}else l.unit=p.elementUnit,l.element=p.elementUnit.elements[p.elementIndex];return r.size.size(l)*s},style:d=>{let p=i[d],h=p.elementUnit.elements[p.elementIndex],f=om(p.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(h));return ox.has(f)?1:0}},{mesh:c,boundingSphere:m}=Oc(e,u,n,o);if(m)c.setBoundingSphere(m);else if(c.triangleCount>0){let d=ye.expand(ye(),t.boundary.sphere,1*s);c.setBoundingSphere(d)}return c}var EZ={...ro,...hd,terminalLinkSizeFactor:C.Numeric(.2,{min:0,max:3,step:.01})};function __e(e){return cs({defaultProps:C.getDefaultValues(EZ),createGeometry:wft,createLocationIterator:Eft,getLoci:Mft,eachLocation:Bft,setUpdateState:(t,r,n)=>{t.createGeometry=r.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Eft(e){let{elements:t,terminalLinks:r}=e.carbohydrates,n=r.length,o=1,i=K.Location.create(e);return Kr(n,o,1,s=>{let l=r[s];if(l.fromCarbohydrate){let u=t[l.carbohydrateIndex],c=u.unit.rings.all[u.ringIndex];i.unit=u.unit,i.element=u.unit.elements[c[0]]}else i.unit=l.elementUnit,i.element=l.elementUnit.elements[l.elementIndex];return i},!0)}function Mft(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let{terminalLinks:i,elements:a}=t.carbohydrates,s=i[o],l=a[s.carbohydrateIndex];return K.Loci.union(Gx(t,l.unit,l.residueIndex,l.altId),b0e(t,s.elementUnit,s.elementUnit.elements[s.elementIndex]))}return dr}var wZ=new Set;function Bft(e,t,r){let n=!1;if(!K.Loci.is(e)||!De.areEquivalent(e.structure,t))return!1;let{getTerminalLinkIndices:o}=t.carbohydrates;for(let{unit:i,indices:a}of e.elements)me.isAtomic(i)&&(wZ.clear(),Se.forEach(a,s=>{let l=o(i,i.elements[s]);for(let u=0,c=l.length;u<c;++u)wZ.has(l[u])||(wZ.add(l[u]),r(xe.ofSingleton(l[u]))&&(n=!0))}));return n}var R_e={"carbohydrate-symbol":(e,t)=>to("Carbohydrate symbol mesh",e,t,P_e),"carbohydrate-link":(e,t)=>to("Carbohydrate link cylinder",e,t,p_e),"carbohydrate-terminal-link":(e,t)=>to("Carbohydrate terminal link cylinder",e,t,__e)},D_e={...DZ,...bZ,...EZ,visuals:C.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],C.objectToOptions(R_e)),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},We.ShadingCategory),density:C.Numeric(.2,{min:0,max:1,step:.01},We.ShadingCategory)};function kft(e,t){return D_e}function Lft(e,t){return Vt.createMulti("Carbohydrate",e,t,Gn,R_e)}var w_e={name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:Lft,getParams:kft,defaultValues:C.getDefaultValues(D_e),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.models.some(t=>Ft.hasCarbohydrate(t))};function MZ(e,t){switch(e.kind){case me.Kind.Atomic:return Fft(e,t);case me.Kind.Spheres:case me.Kind.Gaussians:return Vft(e,t)}}function Fft(e,t){let r=e.model.atomicRanges.cyclicPolymerMap,n=kn.transientSegments(QS(e),e.elements),o=Xt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex,{moleculeType:a}=e.model.atomicHierarchy.derived.residue,s=-1,l=-1,u=!0,c=-1,m=0;for(;n.hasNext;){for(u=!0,c=m,o.setSegment(n.move());o.hasNext;){if(u){let p=o.move().index;if(++m,!o.hasNext)continue;u=!1,l=p}let d=o.move().index;s=l,l=d,t(i[s],i[l],m-1,m,a[s]),++m}r.has(l)&&(s=l,l=r.get(s),t(i[s],i[l],m-1,c,a[s]))}}function Vft(e,t){let r=kn.transientSegments(QS(e),e.elements),{elements:n}=e,o=!0,i=0;for(;r.hasNext;){o=!0;let a=r.move(),s=a.start,l=a.end;for(let u=s,c=l;u<c;++u){if(o){if(++u,++i,u>c)continue;o=!1}t(n[u-1],n[u],i-1,i,0),++i}}}function BZ(e,t){switch(e.kind){case me.Kind.Atomic:return Oft(e,t);case me.Kind.Spheres:case me.Kind.Gaussians:return Gft(e,t)}}function Oft(e,t){let r=kn.transientSegments(QS(e),e.elements),n=Xt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),o=e.model.atomicHierarchy.derived.residue.traceElementIndex,i=0;for(;r.hasNext;)for(n.setSegment(r.move());n.hasNext;){let a=n.move().index;t(o[a],i),++i}}function Gft(e,t){let r=kn.transientSegments(QS(e),e.elements),{elements:n}=e,o=0;for(;r.hasNext;){let i=r.move(),a=i.start,s=i.end;for(let l=a,u=s;l<u;++l)t(n[l],o),++o}}function E_e(e,t){switch(t.kind){case me.Kind.Atomic:return new kZ(e,t);case me.Kind.Spheres:case me.Kind.Gaussians:return new LZ(e,t)}}function M_e(e,t){return{centerA:K.Location.create(e,t),centerB:K.Location.create(e,t)}}var kZ=class{constructor(t,r){this.unit=r;this.hasNext=!1;this.traceElementIndex=r.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=kn.transientSegments(FZ(r),r.elements),this.value=M_e(t,r),this.hasNext=this.gapIt.hasNext}move(){let{elements:t,residueIndex:r}=this.unit,n=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[r[t[n.start]]],this.value.centerB.element=this.traceElementIndex[r[t[n.end-1]]],this.hasNext=this.gapIt.hasNext,this.value}},LZ=class{constructor(t,r){this.unit=r;this.hasNext=!1;this.gapIt=kn.transientSegments(FZ(r),r.elements),this.value=M_e(t,r),this.hasNext=this.gapIt.hasNext}move(){let t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value}};function B_e(e){let{x:t,y:r,z:n}=e.atomicConformation,{polymerType:o,traceElementIndex:i}=e.atomicHierarchy.derived.residue,a=o.length,s=Se.ofBounds(0,e.atomicConformation.atomId.rowCount),l=kn.transientSegments(e.atomicRanges.polymerRanges,s),u=Xt.transientSegments(e.atomicHierarchy.residueAtomSegments,s),c=new Float32Array(a*3),m=new Float32Array(a*3),d=0,p=-1,h=-1,f=b(),y=b(),g=b(),x=b(),S=b(),I=b(),v=b(),A=b(),_=b(),T=b(),w=b(),D=b(),M=b(),E=b();for(;l.hasNext;){let R=l.move();for(u.setSegment(R),d=-1,h=-1;u.hasNext;){d+=1;let{index:Q}=u.move();d===0&&(h=Q),p=Q-2;let O=p*3;b.copy(f,y),b.copy(y,g),b.copy(g,x);let q=i[Q];if(b.set(x,t[q],r[q],n[q]),d<3)continue;b.sub(S,y,f),b.sub(I,g,y),b.sub(v,x,g),b.sub(w,S,I),b.sub(D,I,v),b.cross(M,w,D),b.normalize(M,M),b.toArray(M,m,O);let X=Math.cos(b.angle(w,D)),F=b.magnitude(w),Y=b.magnitude(D),$=Math.sqrt(Y*F)/Math.max(2,2*(1-X));b.scale(A,w,$/F),b.sub(A,y,A),b.toArray(A,c,O),b.scale(_,D,$/Y),b.sub(_,g,_),b.toArray(_,c,O+3),b.copy(E,M)}let k=h*3;b.fromArray(A,c,k+3),b.fromArray(_,c,k+6),b.normalize(M,b.sub(M,A,_));let B=i[h];b.set(f,t[B],r[B],n[B]),b.copy(T,f),b.projectPointOnVector(T,T,M,A),b.toArray(T,c,k);let L=p+2,V=L*3;b.fromArray(A,c,V-3),b.fromArray(_,c,V-6),b.normalize(M,b.sub(M,A,_));let U=i[L];b.set(f,t[U],r[U],n[U]),b.copy(T,f),b.projectPointOnVector(T,T,M,A),b.toArray(T,c,V)}return{centers:c}}var rD=ed.createProvider({label:"Helix Orientation",descriptor:{name:"molstar_helix_orientation"},type:"dynamic",defaultParams:{},getParams:()=>({}),isApplicable:e=>!0,obtain:async(e,t)=>({value:B_e(t)})});function Gf(e){return Kt.is(e,Kt.Flag.Helix)}function Uft(e){return Kt.is(e,Kt.Flag.Beta)}function eT(e,t,r={}){switch(e.kind){case me.Kind.Atomic:return new VZ(e,t,r);case me.Kind.Spheres:case me.Kind.Gaussians:return new OZ(e,t)}}var uO=Kt.create(Kt.Flag.NA);function k_e(e,t){return{center:K.Location.create(e,t),centerPrev:K.Location.create(e,t),centerNext:K.Location.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:uO,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,p0:b(),p1:b(),p2:b(),p3:b(),p4:b(),d12:b(),d23:b()}}var Vr=b(),sO=b(),lO=b(),VZ=class{constructor(t,r,n={}){this.unit=t;this.state=0;this.p0=b();this.p1=b();this.p2=b();this.p3=b();this.p4=b();this.p5=b();this.p6=b();this.d01=b();this.d12=b();this.d23=b();this.d34=b();this.hasNext=!1;if(this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=kn.transientSegments(this.polymerRanges,t.elements),this.residueIt=Xt.transientSegments(this.residueAtomSegments,t.elements),this.value=k_e(r,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=zs.get(r).value?.get(t.invariantId)),n.useHelixOrientation){let o=rD.get(t.model).value;if(!o)throw new Error("missing helix-orientation");this.helixOrientationCenters=o.centers}}atomicPos(t,r){r!==-1&&(t[0]=this.atomicConformation.x[r],t[1]=this.atomicConformation.y[r],t[2]=this.atomicConformation.z[r])}pos(t,r,n){let o=this.traceElementIndex[r];this.helixOrientationCenters&&Gf(n)?b.fromArray(t,this.helixOrientationCenters,r*3):this.atomicPos(t,o)}updateResidueSegmentRange(t){let{index:r}=this.residueAtomSegments;this.residueSegmentMin=r[this.polymerRanges[t.index*2]],this.residueSegmentMax=r[this.polymerRanges[t.index*2+1]]}getResidueIndex(t){if(t<this.residueSegmentMin){let r=this.cyclicPolymerMap.get(this.residueSegmentMin);r!==void 0?t=r-(this.residueSegmentMin-t-1):t=this.residueSegmentMin}else if(t>this.residueSegmentMax){let r=this.cyclicPolymerMap.get(this.residueSegmentMax);r!==void 0?t=r+(t-this.residueSegmentMax-1):t=this.residueSegmentMax}return t}getSecStruc(t){if(this.secondaryStructure){let{type:r,getIndex:n}=this.secondaryStructure,o=r[n(t)];return Gf(o)?Kt.Flag.Helix:o}else return uO}setControlPoint(t,r,n,o,i){Uft(i)||this.helixOrientationCenters&&Gf(i)?b.scale(t,b.add(t,r,b.add(t,o,b.add(t,n,n))),1/4):b.copy(t,n)}setFromToVector(t,r,n){this.helixOrientationCenters&&Gf(n)?b.set(t,1,0,0):(this.atomicPos(sO,this.directionFromElementIndex[r]),this.atomicPos(lO,this.directionToElementIndex[r]),b.sub(t,lO,sO))}setDirection(t,r,n,o){b.matchDirection(sO,r,n),b.matchDirection(lO,o,n),b.scale(t,b.add(t,sO,b.add(t,lO,b.add(t,n,n))),1/4)}move(){let{residueIt:t,polymerIt:r,value:n}=this;if(this.state===0){for(;r.hasNext;)if(this.polymerSegment=r.move(),t.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),t.hasNext){this.state=1;let o=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],i=this.getResidueIndex(o-1);this.currSecStrucType=o===i?uO:this.getSecStruc(i),this.nextSecStrucType=this.getSecStruc(o),this.currCoarseBackbone=this.directionFromElementIndex[i]===-1||this.directionToElementIndex[i]===-1,this.nextCoarseBackbone=this.directionFromElementIndex[o]===-1||this.directionToElementIndex[o]===-1;break}}if(this.state===1){let{index:o}=t.move(),i=this.getResidueIndex(o-3),a=this.getResidueIndex(o-2),s=this.getResidueIndex(o-1),l=this.getResidueIndex(o+1),u=this.getResidueIndex(o+2),c=this.getResidueIndex(o+3);this.prevSecStrucType=this.getSecStruc(s),this.currSecStrucType=this.getSecStruc(o),this.nextSecStrucType=o===l?uO:this.getSecStruc(l),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=this.directionFromElementIndex[l]===-1||this.directionToElementIndex[l]===-1,n.secStrucType=this.currSecStrucType,n.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,n.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,n.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,n.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,n.first=o===this.residueSegmentMin,n.last=o===this.residueSegmentMax,n.moleculeType=this.moleculeType[o],n.initial=o===s,n.final=o===l,n.centerPrev.element=this.traceElementIndex[s],n.center.element=this.traceElementIndex[o],n.centerNext.element=this.traceElementIndex[l];let m=this.getSecStruc(i),d=this.getSecStruc(a),p=this.getSecStruc(s),h=this.getSecStruc(o),f=this.getSecStruc(l),y=this.getSecStruc(u),g=this.getSecStruc(c);this.pos(this.p0,i,m),this.pos(this.p1,a,d),this.pos(this.p2,s,p),this.pos(this.p3,o,h),this.pos(this.p4,l,f),this.pos(this.p5,u,y),this.pos(this.p6,c,g);let x=Gf(m),S=Gf(d),I=Gf(p),v=Gf(h),A=Gf(f),_=Gf(y),T=Gf(g);this.helixOrientationCenters&&!(v&&n.secStrucFirst&&n.secStrucLast)&&(v!==I?v?(b.copy(this.p0,this.p3),b.copy(this.p1,this.p3),b.copy(this.p2,this.p3)):I&&(b.scale(Vr,b.sub(Vr,this.p2,this.p3),2),b.add(this.p2,this.p3,Vr),b.add(this.p1,this.p2,Vr),b.add(this.p0,this.p1,Vr)):v!==S?v?(b.copy(this.p0,this.p2),b.copy(this.p1,this.p2)):S&&(b.scale(Vr,b.sub(Vr,this.p1,this.p2),2),b.add(this.p1,this.p2,Vr),b.add(this.p0,this.p1,Vr)):v!==x&&(v?b.copy(this.p0,this.p1):x&&(b.scale(Vr,b.sub(Vr,this.p0,this.p1),2),b.add(this.p0,this.p1,Vr))),v!==A?v?(b.copy(this.p4,this.p3),b.copy(this.p5,this.p3),b.copy(this.p6,this.p3)):A&&(b.scale(Vr,b.sub(Vr,this.p4,this.p3),2),b.add(this.p4,this.p3,Vr),b.add(this.p5,this.p4,Vr),b.add(this.p6,this.p5,Vr)):v!==_?v?(b.copy(this.p5,this.p4),b.copy(this.p6,this.p4)):_&&(b.scale(Vr,b.sub(Vr,this.p5,this.p4),2),b.add(this.p5,this.p4,Vr),b.add(this.p6,this.p5,Vr)):v!==T&&(v?b.copy(this.p6,this.p5):T&&(b.scale(Vr,b.sub(Vr,this.p6,this.p5),2),b.add(this.p6,this.p5,Vr)))),this.currCoarseBackbone?(b.triangleNormal(this.d01,this.p1,this.p2,this.p3),b.triangleNormal(this.d12,this.p2,this.p3,this.p4),b.triangleNormal(this.d23,this.p3,this.p4,this.p5),b.triangleNormal(this.d34,this.p4,this.p5,this.p6)):(this.setFromToVector(this.d01,s,p),this.setFromToVector(this.d12,o,h),this.setFromToVector(this.d23,l,f),this.setFromToVector(this.d34,u,y));let w=v&&this.helixOrientationCenters,D=1.5;o===s||h!==p&&w?(b.setMagnitude(Vr,b.sub(Vr,this.p3,this.p4),D),b.add(this.p2,this.p3,Vr),b.add(this.p1,this.p2,Vr),b.add(this.p0,this.p1,Vr)):s===a||h!==d&&w?(b.setMagnitude(Vr,b.sub(Vr,this.p2,this.p3),D),b.add(this.p1,this.p2,Vr),b.add(this.p0,this.p1,Vr)):(a===i||h!==m&&w)&&(b.setMagnitude(Vr,b.sub(Vr,this.p1,this.p2),D),b.add(this.p0,this.p1,Vr)),o===l||h!==f&&w?(b.setMagnitude(Vr,b.sub(Vr,this.p3,this.p2),D),b.add(this.p4,this.p3,Vr),b.add(this.p5,this.p4,Vr),b.add(this.p6,this.p5,Vr)):l===u||h!==y&&w?(b.setMagnitude(Vr,b.sub(Vr,this.p4,this.p3),D),b.add(this.p5,this.p4,Vr),b.add(this.p6,this.p5,Vr)):(u===c||h!==g&&w)&&(b.setMagnitude(Vr,b.sub(Vr,this.p5,this.p4),D),b.add(this.p6,this.p5,Vr)),this.setControlPoint(n.p0,this.p0,this.p1,this.p2,d),this.setControlPoint(n.p1,this.p1,this.p2,this.p3,p),this.setControlPoint(n.p2,this.p2,this.p3,this.p4,h),this.setControlPoint(n.p3,this.p3,this.p4,this.p5,f),this.setControlPoint(n.p4,this.p4,this.p5,this.p6,y),this.setDirection(n.d12,this.d01,this.d12,this.d23),this.setDirection(n.d23,this.d12,this.d23,this.d34),t.hasNext||(this.state=0)}return this.hasNext=t.hasNext||r.hasNext,this.value}};var OZ=class{constructor(t,r){this.unit=t;this.state=0;this.hasNext=!1;switch(this.polymerIt=kn.transientSegments(QS(t),t.elements),this.value=k_e(r,t),b.set(this.value.d12,1,0,0),b.set(this.value.d23,1,0,0),t.kind){case me.Kind.Spheres:this.conformation=t.model.coarseConformation.spheres;break;case me.Kind.Gaussians:this.conformation=t.model.coarseConformation.gaussians;break}this.hasNext=this.polymerIt.hasNext}getElementIndex(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)}pos(t,r){let n=this.unit.elements[r];t[0]=this.conformation.x[n],t[1]=this.conformation.y[n],t[2]=this.conformation.z[n]}move(){if(this.state===0){for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}}if(this.state===1){let t=this.getElementIndex(this.elementIndex-2),r=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),o=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[r],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,t),this.pos(this.value.p1,r),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,o);let i=.5;this.elementIndex===r?(b.scale(Vr,b.sub(Vr,this.value.p2,this.value.p3),i),b.add(this.value.p1,this.value.p2,Vr),b.add(this.value.p0,this.value.p1,Vr)):r===t&&(b.scale(Vr,b.sub(Vr,this.value.p1,this.value.p2),i),b.add(this.value.p0,this.value.p1,Vr)),this.elementIndex===n?(b.scale(Vr,b.sub(Vr,this.value.p2,this.value.p1),i),b.add(this.value.p3,this.value.p2,Vr),b.add(this.value.p4,this.value.p3,Vr)):n===o&&(b.scale(Vr,b.sub(Vr,this.value.p3,this.value.p2),i),b.add(this.value.p4,this.value.p3,Vr)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value}};var ZS=b.fromArray,nT=b.toArray,jZ=b.normalize,Nft=b.sub,tT=b.spline,zft=b.slerp,L_e=b.copy,F_e=b.cross,GZ=b.orthogonalize,Hft=b.matchDirection,jft=b.scale,V_e=b.add;function oT(e){let t=e+1,r=t*3;return{curvePoints:new Float32Array(r),tangentVectors:new Float32Array(r),normalVectors:new Float32Array(r),binormalVectors:new Float32Array(r),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function iT(e,t,r,n){Wft(e,t,r,n),Qft(e,t)}var UZ=b(),NZ=b(),zZ=b();function Wft(e,t,r,n){let{curvePoints:o,tangentVectors:i,linearSegments:a}=e,{p0:s,p1:l,p2:u,p3:c,p4:m,secStrucFirst:d,secStrucLast:p}=t,h=1-n,f=d?.5:r,y=p?.5:r;for(let g=0;g<=a;++g){let x=g*1/a;if(x<h){let S=$n(f,r,x);tT(zZ,s,l,u,c,x+n,S),tT(UZ,s,l,u,c,x+n+.01,f),tT(NZ,s,l,u,c,x+n-.01,f)}else{let S=$n(r,y,x);tT(zZ,l,u,c,m,x-h,S),tT(UZ,l,u,c,m,x-h+.01,S),tT(NZ,l,u,c,m,x-h-.01,S)}nT(zZ,o,g*3),jZ(xC,Nft(xC,UZ,NZ)),nT(xC,i,g*3)}}var Xft=b(),xC=b(),Uf=b(),rT=b(),nD=b(),O_e=b(),G_e=b(),U_e=b(),HZ=b(),cO=b();function Qft(e,t){let{curvePoints:r,tangentVectors:n,normalVectors:o,binormalVectors:i}=e,{d12:a,d23:s}=t,l=r.length/3;ZS(G_e,n,0),ZS(U_e,n,(l-1)*3),GZ(HZ,G_e,a),GZ(cO,U_e,s),Hft(cO,cO,HZ),L_e(nD,HZ);let u=l-1;for(let c=0;c<l;++c){let m=aw(0,u,c)*u,d=c===0?0:1/(l-m);ZS(xC,n,c*3),GZ(Uf,xC,zft(Xft,nD,cO,d)),nT(Uf,o,c*3),L_e(nD,Uf),jZ(rT,F_e(rT,xC,Uf)),nT(rT,i,c*3)}for(let c=1;c<u;++c)ZS(nD,o,(c-1)*3),ZS(Uf,o,c*3),ZS(O_e,o,(c+1)*3),jft(Uf,V_e(Uf,nD,V_e(Uf,O_e,Uf)),1/3),nT(Uf,o,c*3),ZS(xC,n,c*3),jZ(rT,F_e(rT,xC,Uf)),nT(rT,i,c*3)}function oD(e,t,r,n,o,i,a,s){let{widthValues:l,heightValues:u,linearSegments:c}=e,m=1-s;for(let d=0;d<=c;++d){let p=d*1/c;p<m?(l[d]=$n(t,r,p+s),u[d]=$n(o,i,p+s)):(l[d]=$n(r,n,p-m),u[d]=$n(i,a,p-m))}}var mO=.5,z_e=.9,qS=.5,YS=.3,aT=2;function QS(e){switch(e.kind){case me.Kind.Atomic:return e.model.atomicRanges.polymerRanges;case me.Kind.Spheres:return e.model.coarseHierarchy.spheres.polymerRanges;case me.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.polymerRanges}}function FZ(e){switch(e.kind){case me.Kind.Atomic:return e.model.atomicRanges.gapRanges;case me.Kind.Spheres:return e.model.coarseHierarchy.spheres.gapRanges;case me.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.gapRanges}}var Cd;(t=>{function e(r,n){let{group:o,structure:i}=r,a=o.units[0].polymerElements,s=a.length,l=o.units.length,u=K.Location.create(i),c=(p,h)=>{let f=o.units[h];return u.unit=f,u.element=a[p],u},m=!!n?.asSecondary;function d(p,h){return m}return Kr(s,l,1,c,!1,d)}t.fromGroup=e})(Cd||={});var WZ;(t=>{function e(r,n){let{group:o,structure:i}=r,a=o.units[0].gapElements,s=a.length,l=o.units.length,u=K.Location.create(i),c=(p,h)=>{let f=o.units[h];return u.unit=f,u.element=a[p],u},m=!!n?.asSecondary;function d(p,h){return m}return Kr(s,l,1,c,!1,d)}t.fromGroup=e})(WZ||={});function Sp(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:a,group:s}=t,l=s.units[o];if(me.isAtomic(l))return Xk(a,l,l.polymerElements[i]);{let{elements:u}=l,c=l.polymerElements[i],m=Se.indexOf(u,c);if(m!==-1){let d=Se.ofSingleton(m);return K.Loci(a,[{unit:l,indices:d}])}}}return dr}function N_e(e,t,r,n,o,i){let a=-1,s=-1;for(let u=o;u<=i;u++){let c=r[u];if(!(c<0)&&(a=Se.indexOf(t,c),a>=0)){s=u;break}}if(a<0)return!1;let l=a;for(let u=i;u>s;u--){let c=r[u];if(c<0)continue;let m=Se.indexOf(t,c);if(m>=0){l=m;break}}return n(xe.ofRange(e+a,e+l))}function XZ(e,t,r,n,o){let i=!1,{elements:a}=o.unit,{traceElementIndex:s}=o.unit.model.atomicHierarchy.derived.residue,{index:l}=o.unit.model.atomicHierarchy.residueAtomSegments,u=r(o.unit);if(xe.is(o.indices))if(xe.start(o.indices)===0&&xe.end(o.indices)===o.unit.elements.length)i=n(xe.ofBounds(e,e+t))||i;else{let c=l[a[xe.min(o.indices)]],m=l[a[xe.max(o.indices)]];i=N_e(e,u,s,n,c,m)||i}else{let{indices:c}=o;for(let m=0,d=c.length;m<d;m++){let p=l[a[c[m]]],h=p,f=m+1;for(;f<d;){let y=l[a[c[f]]];if(y-h>1)break;h=y,f++}m=f-1,i=N_e(e,u,s,n,p,h)||i}}return i}function Zft(e){return e.polymerElements}function vp(e,t,r){let n=!1;if(!K.Loci.is(e))return!1;let{structure:o,group:i}=t;if(!De.areEquivalent(e.structure,o))return!1;let a=i.units[0].polymerElements.length;for(let s of e.elements){if(!i.unitIndexMap.has(s.unit.id))continue;let l=i.unitIndexMap.get(s.unit.id)*a;if(me.isAtomic(s.unit))n=XZ(l,a,Zft,r,s)||n;else if(xe.is(s.indices)){let u=l+xe.start(s.indices),c=l+xe.end(s.indices);n=r(xe.ofBounds(u,c))||n}else for(let u=0,c=s.indices.length;u<c;u++){let m=s.indices[u],d=u+1;for(;d<c&&s.indices[d]===m;)d++;u=d-1;let p=s.indices[u];n=r(xe.ofRange(l+m,l+p))||n}}return n}function H_e(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:a,group:s}=t,l=s.units[o],u=Se.indexOf(l.elements,l.gapElements[i]),c=Se.indexOf(l.elements,l.gapElements[i%2?i-1:i+1]);if(u!==-1&&c!==-1)return Ct.Loci(a,[Ct.Location(a,l,u,a,l,c),Ct.Location(a,l,c,a,l,u)])}return dr}function j_e(e,t,r){let n=!1;if(Ct.isLoci(e)){let{structure:o,group:i}=t;if(!De.areRootsEquivalent(e.structure,o))return!1;e=Ct.remapLoci(e,o);let a=i.units[0].gapElements.length;for(let s of e.bonds){let l=i.unitIndexMap.get(s.aUnit.id);if(l!==void 0){let u=Se.indexOf(s.aUnit.gapElements,s.aUnit.elements[s.aIndex]),c=Se.indexOf(s.bUnit.gapElements,s.bUnit.elements[s.bIndex]);u!==-1&&c!==-1&&r(xe.ofSingleton(l*a+u))&&(n=!0)}}}else if(K.Loci.is(e)){let{structure:o,group:i}=t;if(!De.areRootsEquivalent(e.structure,o))return!1;e=K.Loci.remap(e,o);let a=i.units[0].gapElements.length;for(let s of e.elements){let l=i.unitIndexMap.get(s.unit.id);l!==void 0&&Se.forEach(s.indices,u=>{let c=Se.indexOf(s.unit.gapElements,s.unit.elements[u]);c!==-1&&(r(xe.ofSingleton(l*a+c))&&(n=!0),Se.getAt(s.unit.gapElements,c+1)===s.unit.elements[u]&&r(xe.ofSingleton(l*a+c+1))&&(n=!0))})}}return n}var Sd;(t=>{function e(r){let{group:n,structure:o}=r,i=n.units[0],a=me.isAtomic(i)?i.nucleotideElements:[],s=a.length,l=n.units.length,u=K.Location.create(o);return Kr(s,l,1,(m,d)=>{let p=n.units[d];return u.unit=p,u.element=a[m],u})}t.fromGroup=e})(Sd||={});function Ip(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:a,group:s}=t,l=s.units[o];if(me.isAtomic(l))return Xk(a,l,l.nucleotideElements[i])}return dr}function qft(e){return e.nucleotideElements}function Ap(e,t,r){let n=!1;if(!K.Loci.is(e))return!1;let{structure:o,group:i}=t;if(!De.areEquivalent(e.structure,o))return!1;let a=i.units[0];if(!me.isAtomic(a))return!1;let{nucleotideElements:s}=a,l=s.length;for(let u of e.elements){if(!me.isAtomic(u.unit)||!i.unitIndexMap.has(u.unit.id))continue;let c=i.unitIndexMap.get(u.unit.id)*l;me.isAtomic(u.unit)&&(n=XZ(c,l,qft,r,u)||n)}return n}var Yft=b(),Kft=b();function Tp(e,t){let{model:r,conformation:n}=e,{residueAtomSegments:o,atoms:i,index:a}=r.atomicHierarchy,{label_comp_id:s}=i,l=s.value(o.offsets[t]),u=Rse(l),c=Dse(l);if(!u&&!c){let m=a.findAtomOnResidue(t,"C4"),d=a.findAtomOnResidue(t,"N9");m!==-1&&d!==-1&&b.distance(n.invariantPosition(m,Yft),n.invariantPosition(d,Kft))<1.6?u=!0:c=!0}return{isPurine:u,isPyrimidine:c}}function Pp(){return{trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1}}function _p(e,t,r){let n=t.model.atomicHierarchy.index,{traceElementIndex:o}=t.model.atomicHierarchy.derived.residue;return e.trace=o[r],e.N1=n.findAtomOnResidue(r,"N1"),e.C2=n.findAtomOnResidue(r,"C2"),e.N3=n.findAtomOnResidue(r,"N3"),e.C4=n.findAtomOnResidue(r,"C4"),e.C5=n.findAtomOnResidue(r,"C5"),e.C5===-1&&(e.C5=n.findAtomOnResidue(r,"N5")),e.C6=n.findAtomOnResidue(r,"C6"),e.N7=n.findAtomOnResidue(r,"N7"),e.N7===-1&&(e.N7=n.findAtomOnResidue(r,"C7")),e.C8=n.findAtomOnResidue(r,"C8"),e.N9=n.findAtomOnResidue(r,"N9"),e}function dg(e){return e.trace!==-1&&e.N1!==-1&&e.C2!==-1&&e.N3!==-1&&e.C4!==-1&&e.C5!==-1&&e.C6!==-1&&e.N7!==-1&&e.C8!==-1&&e.N9!==-1}function Rp(e,t,r){let n=t.model.atomicHierarchy.index,{traceElementIndex:o}=t.model.atomicHierarchy.derived.residue;return e.trace=o[r],e.N1=n.findAtomOnResidue(r,"N1"),e.N1===-1&&(e.N1=n.findAtomOnResidue(r,"C1")),e.C2=n.findAtomOnResidue(r,"C2"),e.N3=n.findAtomOnResidue(r,"N3"),e.C4=n.findAtomOnResidue(r,"C4"),e.C5=n.findAtomOnResidue(r,"C5"),e.C6=n.findAtomOnResidue(r,"C6"),e}function pg(e){return e.trace!==-1&&e.N1!==-1&&e.C2!==-1&&e.N3!==-1&&e.C4!==-1&&e.C5!==-1&&e.C6!==-1}function CC(e,t,r){let n=t.model.atomicHierarchy.index,{traceElementIndex:o}=t.model.atomicHierarchy.derived.residue;return e.trace=o[r],e.C1_1=n.findAtomOnResidue(r,"C1'"),e.C2_1=n.findAtomOnResidue(r,"C2'"),e.C3_1=n.findAtomOnResidue(r,"C3'"),e.C4_1=n.findAtomOnResidue(r,"C4'"),e.O4_1=n.findAtomOnResidue(r,"O4'"),e}function SC(e){return e.trace!==-1&&e.C1_1!==-1&&e.C2_1!==-1&&e.C3_1!==-1&&e.C4_1!==-1&&e.O4_1!==-1}var dO=b(),QZ=b(),W_e=b(),X_e=b(),Q_e=b(),Z_e=b(),pO=b(),ZZ=b(),qZ=b(),q_e=b(),iD=Z.identity(),Jft=b(),Y_e=Tx(),K_e={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:C.Numeric(1,{min:0,max:2,step:.01}),radialSegments:C.Numeric(16,{min:2,max:56,step:2},We.CustomQualityParamInfo)},ARn=C.getDefaultValues(K_e);function $ft(e,t,r,n,o,i){if(!me.isAtomic(t))return ft.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,thicknessFactor:l,radialSegments:u}=o,c=a*(Y_e.vertices.length/3+u*2),m=et.createState(c,c/4,i),{elements:d,model:p,conformation:h}=t,{chainAtomSegments:f,residueAtomSegments:y}=p.atomicHierarchy,{moleculeType:g}=p.atomicHierarchy.derived.residue,x=Xt.transientSegments(f,d),S=Xt.transientSegments(y,d),I=1*s,v=4.5,A=l*s*2,_={radiusTop:I,radiusBottom:I,radialSegments:u,bottomCap:!0},T=0;for(;x.hasNext;)for(S.setSegment(x.move());S.hasNext;){let{index:M}=S.move();if(Zi(g[M])){let E=Pp(),R=-1,k=-1,B=-1,L=-1,V=-1,U=4.5,{isPurine:Q,isPyrimidine:O}=Tp(t,M);Q?(U=4.5,_p(E,t,M),R=E.N1,k=E.C4,B=E.C6,L=E.C2,V=E.N9):O&&(U=3,Rp(E,t,M),R=E.N3,k=E.C6,B=E.C4,L=E.C2,V=E.N1),V!==-1&&E.trace!==-1&&(h.invariantPosition(V,Q_e),h.invariantPosition(E.trace,Z_e),m.currentGroup=T,nn(m,Q_e,Z_e,1,_),R!==-1&&k!==-1&&B!==-1&&L!==-1&&(h.invariantPosition(R,dO),h.invariantPosition(k,QZ),h.invariantPosition(B,W_e),h.invariantPosition(L,X_e),b.normalize(pO,b.sub(pO,QZ,dO)),b.normalize(ZZ,b.sub(ZZ,X_e,W_e)),b.normalize(qZ,b.cross(qZ,pO,ZZ)),Z.targetTo(iD,dO,QZ,qZ),b.scaleAndAdd(q_e,dO,pO,U/2-.2),Z.scale(iD,iD,b.set(Jft,v,A,U)),Z.setTranslation(iD,q_e),et.addPrimitive(m,iD,Y_e))),++T}}let w=et.getMesh(m),D=ye.expand(ye(),t.boundary.sphere,I);return w.setBoundingSphere(D),w}var YZ={...ro,...K_e};function J_e(e){return So({defaultProps:C.getDefaultValues(YZ),createGeometry:$ft,createLocationIterator:Sd.fromGroup,getLoci:Ip,eachLocation:Ap,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.thicknessFactor!==n.thicknessFactor||r.radialSegments!==n.radialSegments}},e)}var fO=b(),vC=b(),hO=b(),gO=b(),sT=b(),lT=b(),yO=b(),$_e=b(),eRe=b(),bO=b(),IC=b(),nRe={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:C.Numeric(1,{min:0,max:2,step:.01}),radialSegments:C.Numeric(16,{min:2,max:56,step:2},We.CustomQualityParamInfo),detail:C.Numeric(0,{min:0,max:3,step:1},We.CustomQualityParamInfo)},NRn=C.getDefaultValues(nRe),xO=new Float32Array(2*9*3),eht=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),tht=new Uint32Array([8,12,14,16,6,4,2,0,10]),rht=new Uint32Array([9,11,1,3,5,7,17,15,13]),CO=new Float32Array(2*6*3),nht=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),oht=new Uint32Array([0,10,8,6,4,2]),iht=new Uint32Array([1,3,5,7,9,11]),tRe=b();function rRe(e,t,...r){for(let n=0,o=r.length;n<o;++n){let i=r[n];b.toArray(b.add(tRe,i,t),e,n*2*3),b.toArray(b.sub(tRe,i,t),e,(n*2+1)*3)}}function aht(e,t,r,n,o,i){if(!me.isAtomic(t))return ft.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,thicknessFactor:l,radialSegments:u,detail:c}=o,m=a*(26+u*2),d=et.createState(m,m/4,i),{elements:p,model:h,conformation:f}=t,{chainAtomSegments:y,residueAtomSegments:g}=h.atomicHierarchy,{moleculeType:x}=h.atomicHierarchy.derived.residue,S=Xt.transientSegments(y,p),I=Xt.transientSegments(g,p),v=1*s,A=l*s,_={radiusTop:v,radiusBottom:v,radialSegments:u},T=0;for(;S.hasNext;)for(I.setSegment(S.move());I.hasNext;){let{index:M}=I.move();if(Zi(x[M])){let E=Pp();d.currentGroup=T;let{isPurine:R,isPyrimidine:k}=Tp(t,M);R?(_p(E,t,M),E.N9!==-1&&E.trace!==-1&&(f.invariantPosition(E.N9,bO),f.invariantPosition(E.trace,fO),d.currentGroup=T,nn(d,bO,fO,1,_),Nr(d,bO,v,c)),dg(E)&&(f.invariantPosition(E.N1,vC),f.invariantPosition(E.C2,hO),f.invariantPosition(E.N3,gO),f.invariantPosition(E.C4,sT),f.invariantPosition(E.C5,lT),f.invariantPosition(E.C6,yO),f.invariantPosition(E.N7,$_e),f.invariantPosition(E.C8,eRe),b.triangleNormal(IC,vC,sT,lT),b.scale(IC,IC,A),rRe(xO,IC,vC,hO,gO,sT,lT,yO,$_e,eRe,bO),et.addTriangleStrip(d,xO,eht),et.addTriangleFan(d,xO,tht),et.addTriangleFan(d,xO,rht))):k&&(Rp(E,t,M),E.N1!==-1&&E.trace!==-1&&(f.invariantPosition(E.N1,vC),f.invariantPosition(E.trace,fO),d.currentGroup=T,nn(d,vC,fO,1,_),Nr(d,vC,v,c)),pg(E)&&(f.invariantPosition(E.C2,hO),f.invariantPosition(E.N3,gO),f.invariantPosition(E.C4,sT),f.invariantPosition(E.C5,lT),f.invariantPosition(E.C6,yO),b.triangleNormal(IC,vC,sT,lT),b.scale(IC,IC,A),rRe(CO,IC,vC,hO,gO,sT,lT,yO),et.addTriangleStrip(d,CO,nht),et.addTriangleFan(d,CO,oht),et.addTriangleFan(d,CO,iht))),++T}}let w=et.getMesh(d),D=ye.expand(ye(),t.boundary.sphere,v);return w.setBoundingSphere(D),w}var KZ={...ro,...nRe};function oRe(e){return So({defaultProps:C.getDefaultValues(KZ),createGeometry:aht,createLocationIterator:Sd.fromGroup,getLoci:Ip,eachLocation:Ap,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.thicknessFactor!==n.thicknessFactor||r.radialSegments!==n.radialSegments}},e)}var uT=b(),SO=b(),vO=b(),cT=b(),mT=b(),IO=b(),iRe=b(),aRe=b(),sRe=b(),AO=b(),JZ=b(),TO=b(),PO=b(),$Z=b(),dT=b(),Jl=b(),pT=b(),uRe={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:C.Numeric(1,{min:0,max:2,step:.01})},tDn=C.getDefaultValues(uRe),_O=new Float32Array(2*9*3),sht=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),lht=new Uint32Array([8,12,14,16,6,4,2,0,10]),uht=new Uint32Array([9,11,1,3,5,7,17,15,13]),RO=new Float32Array(2*6*3),cht=new Uint32Array([2,3,4,5,6,7,8,9,10,11,2,3]),mht=new Uint32Array([0,10,8,6,4,2,10]),dht=new Uint32Array([1,3,5,7,9,11,3]),DO=new Float32Array(2*6*3),pht=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),fht=new Uint32Array([0,10,8,6,4,2]),hht=new Uint32Array([1,3,5,7,9,11]),lRe=b();function eq(e,t,...r){for(let n=0,o=r.length;n<o;++n){let i=r[n];b.toArray(b.add(lRe,i,t),e,n*2*3),b.toArray(b.sub(lRe,i,t),e,(n*2+1)*3)}}function ght(e,t,r,n,o,i){if(!me.isAtomic(t))return ft.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,thicknessFactor:l}=o,u=a*25,c=et.createState(u,u/4,i),{elements:m,model:d,conformation:p}=t,{chainAtomSegments:h,residueAtomSegments:f}=d.atomicHierarchy,{moleculeType:y}=d.atomicHierarchy.derived.residue,g=Xt.transientSegments(h,m),x=Xt.transientSegments(f,m),S=s*l,I=0;for(;g.hasNext;)for(x.setSegment(g.move());x.hasNext;){let{index:_}=x.move();if(Zi(y[_])){let T=Pp();c.currentGroup=I,CC(T,t,_),SC(T)&&(p.invariantPosition(T.C1_1,AO),p.invariantPosition(T.C2_1,JZ),p.invariantPosition(T.C3_1,TO),p.invariantPosition(T.C4_1,PO),p.invariantPosition(T.O4_1,$Z),b.triangleNormal(Jl,TO,PO,AO),b.scale(dT,b.add(dT,$Z,b.add(dT,PO,b.add(dT,TO,b.add(dT,AO,JZ)))),.2),b.scale(pT,Jl,S),eq(RO,pT,dT,TO,PO,$Z,AO,JZ),et.addTriangleStrip(c,RO,cht),et.addTriangleFanWithNormal(c,RO,mht,Jl),b.negate(Jl,Jl),et.addTriangleFanWithNormal(c,RO,dht,Jl));let{isPurine:w,isPyrimidine:D}=Tp(t,_);w?(_p(T,t,_),dg(T)&&(p.invariantPosition(T.N1,uT),p.invariantPosition(T.C2,SO),p.invariantPosition(T.N3,vO),p.invariantPosition(T.C4,cT),p.invariantPosition(T.C5,mT),p.invariantPosition(T.C6,IO),p.invariantPosition(T.N7,iRe),p.invariantPosition(T.C8,aRe),p.invariantPosition(T.N9,sRe),b.triangleNormal(Jl,uT,cT,mT),b.scale(pT,Jl,S),eq(_O,pT,uT,SO,vO,cT,mT,IO,iRe,aRe,sRe),et.addTriangleStrip(c,_O,sht),et.addTriangleFanWithNormal(c,_O,lht,Jl),b.negate(Jl,Jl),et.addTriangleFanWithNormal(c,_O,uht,Jl))):D&&(Rp(T,t,_),pg(T)&&(p.invariantPosition(T.N1,uT),p.invariantPosition(T.C2,SO),p.invariantPosition(T.N3,vO),p.invariantPosition(T.C4,cT),p.invariantPosition(T.C5,mT),p.invariantPosition(T.C6,IO),b.triangleNormal(Jl,uT,cT,mT),b.scale(pT,Jl,S),eq(DO,pT,uT,SO,vO,cT,mT,IO),et.addTriangleStrip(c,DO,pht),et.addTriangleFanWithNormal(c,DO,fht,Jl),b.negate(Jl,Jl),et.addTriangleFanWithNormal(c,DO,hht,Jl))),++I}}let v=et.getMesh(c),A=ye.expand(ye(),t.boundary.sphere,S);return v.setBoundingSphere(A),v}var tq={...ro,...uRe};function cRe(e){return So({defaultProps:C.getDefaultValues(tq),createGeometry:ght,createLocationIterator:Sd.fromGroup,getLoci:Ip,eachLocation:Ap,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.thicknessFactor!==n.thicknessFactor}},e)}var $l=b(),ri=b(),Ks=b(),Js=b(),Aa=b(),Ta=b(),$s=b(),fg=b(),hg=b(),ys=b(),bs=b(),gg=b(),Tm=b(),yg=b(),bg=b(),wO={...ro,...QI,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:C.Numeric(16,{min:2,max:56,step:2},We.CustomQualityParamInfo),tryUseImpostor:C.Boolean(!0)};function mRe(e,t,r,n){return r.tryUseImpostor&&Ox(n)?bht(e):Cht(e)}function yht(e,t,r,n,o,i){if(!me.isAtomic(t))return Di.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return Di.createEmpty(i);let s=a*15,l=kS.create(s,s/4,i),{elements:u,model:c,conformation:m}=t,{chainAtomSegments:d,residueAtomSegments:p}=c.atomicHierarchy,{moleculeType:h}=c.atomicHierarchy.derived.residue,f=Xt.transientSegments(d,u),y=Xt.transientSegments(p,u),g=0,x=2;for(;f.hasNext;)for(y.setSegment(f.move());y.hasNext;){let{index:v}=y.move();if(Zi(h[v])){let A=Pp();CC(A,t,v),SC(A)&&(m.invariantPosition(A.C1_1,bs),m.invariantPosition(A.C2_1,gg),m.invariantPosition(A.C3_1,Tm),m.invariantPosition(A.C4_1,yg),m.invariantPosition(A.O4_1,bg),m.invariantPosition(A.trace,$l),l.add(Tm[0],Tm[1],Tm[2],$l[0],$l[1],$l[2],1,!0,!0,x,g),l.add(Tm[0],Tm[1],Tm[2],yg[0],yg[1],yg[2],1,!0,!0,x,g),l.add(yg[0],yg[1],yg[2],bg[0],bg[1],bg[2],1,!0,!0,x,g),l.add(bg[0],bg[1],bg[2],bs[0],bs[1],bs[2],1,!0,!0,x,g),l.add(bs[0],bs[1],bs[2],gg[0],gg[1],gg[2],1,!0,!0,x,g),l.add(gg[0],gg[1],gg[2],Tm[0],Tm[1],Tm[2],1,!0,!0,x,g));let{isPurine:_,isPyrimidine:T}=Tp(t,v);_?(_p(A,t,v),A.C1_1!==-1&&A.N9!==-1?(m.invariantPosition(A.C1_1,bs),m.invariantPosition(A.N9,ys),l.add(ys[0],ys[1],ys[2],bs[0],bs[1],bs[2],1,!0,!0,x,g)):A.N9!==-1&&A.trace!==-1&&(m.invariantPosition(A.N9,ys),m.invariantPosition(A.trace,$l),l.add(ys[0],ys[1],ys[2],$l[0],$l[1],$l[2],1,!0,!0,x,g)),dg(A)&&(m.invariantPosition(A.N1,ri),m.invariantPosition(A.C2,Ks),m.invariantPosition(A.N3,Js),m.invariantPosition(A.C4,Aa),m.invariantPosition(A.C5,Ta),m.invariantPosition(A.C6,$s),m.invariantPosition(A.N7,fg),m.invariantPosition(A.C8,hg),m.invariantPosition(A.N9,ys),l.add(ys[0],ys[1],ys[2],hg[0],hg[1],hg[2],1,!0,!0,x,g),l.add(hg[0],hg[1],hg[2],fg[0],fg[1],fg[2],1,!0,!0,x,g),l.add(fg[0],fg[1],fg[2],Ta[0],Ta[1],Ta[2],1,!0,!0,x,g),l.add(Ta[0],Ta[1],Ta[2],$s[0],$s[1],$s[2],1,!0,!0,x,g),l.add($s[0],$s[1],$s[2],ri[0],ri[1],ri[2],1,!0,!0,x,g),l.add(ri[0],ri[1],ri[2],Ks[0],Ks[1],Ks[2],1,!0,!0,x,g),l.add(Ks[0],Ks[1],Ks[2],Js[0],Js[1],Js[2],1,!0,!0,x,g),l.add(Js[0],Js[1],Js[2],Aa[0],Aa[1],Aa[2],1,!0,!0,x,g),l.add(Aa[0],Aa[1],Aa[2],Ta[0],Ta[1],Ta[2],1,!0,!0,x,g),l.add(Aa[0],Aa[1],Aa[2],ys[0],ys[1],ys[2],1,!0,!0,x,g))):T&&(Rp(A,t,v),A.C1_1!==-1&&A.N1!==-1?(m.invariantPosition(A.N1,ri),m.invariantPosition(A.C1_1,bs),l.add(ri[0],ri[1],ri[2],bs[0],bs[1],bs[2],1,!0,!0,x,g)):A.N1!==-1&&A.trace!==-1&&(m.invariantPosition(A.N1,ri),m.invariantPosition(A.trace,$l),l.add(ri[0],ri[1],ri[2],$l[0],$l[1],$l[2],1,!0,!0,x,g)),pg(A)&&(m.invariantPosition(A.N1,ri),m.invariantPosition(A.C2,Ks),m.invariantPosition(A.N3,Js),m.invariantPosition(A.C4,Aa),m.invariantPosition(A.C5,Ta),m.invariantPosition(A.C6,$s),l.add(ri[0],ri[1],ri[2],$s[0],$s[1],$s[2],1,!0,!0,x,g),l.add($s[0],$s[1],$s[2],Ta[0],Ta[1],Ta[2],1,!0,!0,x,g),l.add(Ta[0],Ta[1],Ta[2],Aa[0],Aa[1],Aa[2],1,!0,!0,x,g),l.add(Aa[0],Aa[1],Aa[2],Js[0],Js[1],Js[2],1,!0,!0,x,g),l.add(Js[0],Js[1],Js[2],Ks[0],Ks[1],Ks[2],1,!0,!0,x,g),l.add(Ks[0],Ks[1],Ks[2],ri[0],ri[1],ri[2],1,!0,!0,x,g))),++g}}let S=l.getCylinders(),I=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor);return S.setBoundingSphere(I),S}function bht(e){return ZI({defaultProps:C.getDefaultValues(wO),createGeometry:yht,createLocationIterator:Sd.fromGroup,getLoci:Ip,eachLocation:Ap,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function xht(e,t,r,n,o,i){if(!me.isAtomic(t))return ft.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,radialSegments:l}=o,u=a*(l*15),c=et.createState(u,u/4,i),{elements:m,model:d,conformation:p}=t,{chainAtomSegments:h,residueAtomSegments:f}=d.atomicHierarchy,{moleculeType:y}=d.atomicHierarchy.derived.residue,g=Xt.transientSegments(h,m),x=Xt.transientSegments(f,m),S={radiusTop:1*s,radiusBottom:1*s,radialSegments:l},I=0;for(;g.hasNext;)for(x.setSegment(g.move());x.hasNext;){let{index:_}=x.move();if(Zi(y[_])){let T=Pp();c.currentGroup=I,CC(T,t,_),SC(T)&&(p.invariantPosition(T.C1_1,bs),p.invariantPosition(T.C2_1,gg),p.invariantPosition(T.C3_1,Tm),p.invariantPosition(T.C4_1,yg),p.invariantPosition(T.O4_1,bg),p.invariantPosition(T.trace,$l),nn(c,Tm,$l,1,S),nn(c,Tm,yg,1,S),nn(c,yg,bg,1,S),nn(c,bg,bs,1,S),nn(c,bs,gg,1,S),nn(c,gg,Tm,1,S));let{isPurine:w,isPyrimidine:D}=Tp(t,_);w?(_p(T,t,_),T.C1_1!==-1&&T.N9!==-1?(p.invariantPosition(T.C1_1,bs),p.invariantPosition(T.N9,ys),nn(c,ys,bs,1,S)):T.N9!==-1&&T.trace!==-1&&(p.invariantPosition(T.N9,ys),p.invariantPosition(T.trace,$l),nn(c,ys,$l,1,S)),dg(T)&&(p.invariantPosition(T.N1,ri),p.invariantPosition(T.C2,Ks),p.invariantPosition(T.N3,Js),p.invariantPosition(T.C4,Aa),p.invariantPosition(T.C5,Ta),p.invariantPosition(T.C6,$s),p.invariantPosition(T.N7,fg),p.invariantPosition(T.C8,hg),p.invariantPosition(T.N9,ys),nn(c,ys,hg,1,S),nn(c,hg,fg,1,S),nn(c,fg,Ta,1,S),nn(c,Ta,$s,1,S),nn(c,$s,ri,1,S),nn(c,ri,Ks,1,S),nn(c,Ks,Js,1,S),nn(c,Js,Aa,1,S),nn(c,Aa,Ta,1,S),nn(c,Aa,ys,1,S))):D&&(Rp(T,t,_),T.C1_1!==-1&&T.N1!==-1?(p.invariantPosition(T.N1,ri),p.invariantPosition(T.C1_1,bs),nn(c,ri,bs,1,S)):T.N1!==-1&&T.trace!==-1&&(p.invariantPosition(T.N1,ri),p.invariantPosition(T.trace,$l),nn(c,ri,$l,1,S)),pg(T)&&(p.invariantPosition(T.N1,ri),p.invariantPosition(T.C2,Ks),p.invariantPosition(T.N3,Js),p.invariantPosition(T.C4,Aa),p.invariantPosition(T.C5,Ta),p.invariantPosition(T.C6,$s),nn(c,ri,$s,1,S),nn(c,$s,Ta,1,S),nn(c,Ta,Aa,1,S),nn(c,Aa,Js,1,S),nn(c,Js,Ks,1,S),nn(c,Ks,ri,1,S))),++I}}let v=et.getMesh(c),A=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor);return v.setBoundingSphere(A),v}function Cht(e){return So({defaultProps:C.getDefaultValues(wO),createGeometry:xht,createLocationIterator:Sd.fromGroup,getLoci:Ip,eachLocation:Ap,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var fT=b(),Dp=b(),wp=b(),Ep=b(),Mp=b(),vd=b(),Bp=b(),hT=b(),gT=b(),yT=b(),bT=b(),xT=b(),CT=b(),ST=b(),vT=b(),EO={...ro,...WI,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),detail:C.Numeric(0,{min:0,max:3,step:1},We.CustomQualityParamInfo),tryUseImpostor:C.Boolean(!0)};function dRe(e,t,r,n){return r.tryUseImpostor&&GI(n)?vht(e):Aht(e)}function Sht(e,t,r,n,o,i){if(!me.isAtomic(t))return Ts.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return Ts.createEmpty(i);let s=a*15,l=jh.create(s,s/4,i),{elements:u,model:c,conformation:m}=t,{chainAtomSegments:d,residueAtomSegments:p}=c.atomicHierarchy,{moleculeType:h}=c.atomicHierarchy.derived.residue,f=Xt.transientSegments(d,u),y=Xt.transientSegments(p,u),g=0;for(;f.hasNext;)for(y.setSegment(f.move());y.hasNext;){let{index:I}=y.move();if(Zi(h[I])){let v=Pp();CC(v,t,I),SC(v)&&(m.invariantPosition(v.C1_1,bT),m.invariantPosition(v.C2_1,xT),m.invariantPosition(v.C3_1,CT),m.invariantPosition(v.C4_1,ST),m.invariantPosition(v.O4_1,vT),m.invariantPosition(v.trace,fT),l.add(fT[0],fT[1],fT[2],g),l.add(CT[0],CT[1],CT[2],g),l.add(ST[0],ST[1],ST[2],g),l.add(vT[0],vT[1],vT[2],g),l.add(bT[0],bT[1],bT[2],g),l.add(xT[0],xT[1],xT[2],g));let{isPurine:A,isPyrimidine:_}=Tp(t,I);A?(_p(v,t,I),dg(v)&&(m.invariantPosition(v.N1,Dp),m.invariantPosition(v.C2,wp),m.invariantPosition(v.N3,Ep),m.invariantPosition(v.C4,Mp),m.invariantPosition(v.C5,vd),m.invariantPosition(v.C6,Bp),m.invariantPosition(v.N7,hT),m.invariantPosition(v.C8,gT),m.invariantPosition(v.N9,yT),l.add(yT[0],yT[1],yT[2],g),l.add(gT[0],gT[1],gT[2],g),l.add(hT[0],hT[1],hT[2],g),l.add(vd[0],vd[1],vd[2],g),l.add(Bp[0],Bp[1],Bp[2],g),l.add(Dp[0],Dp[1],Dp[2],g),l.add(wp[0],wp[1],wp[2],g),l.add(Ep[0],Ep[1],Ep[2],g),l.add(Mp[0],Mp[1],Mp[2],g))):_&&(Rp(v,t,I),pg(v)&&(m.invariantPosition(v.N1,Dp),m.invariantPosition(v.C2,wp),m.invariantPosition(v.N3,Ep),m.invariantPosition(v.C4,Mp),m.invariantPosition(v.C5,vd),m.invariantPosition(v.C6,Bp),l.add(Dp[0],Dp[1],Dp[2],g),l.add(Bp[0],Bp[1],Bp[2],g),l.add(vd[0],vd[1],vd[2],g),l.add(Mp[0],Mp[1],Mp[2],g),l.add(Ep[0],Ep[1],Ep[2],g),l.add(wp[0],wp[1],wp[2],g))),++g}}let x=l.getSpheres(),S=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor);return x.setBoundingSphere(S),x}function vht(e){return XI({defaultProps:C.getDefaultValues(EO),createGeometry:Sht,createLocationIterator:Sd.fromGroup,getLoci:Ip,eachLocation:Ap,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function Iht(e,t,r,n,o,i){if(!me.isAtomic(t))return ft.createEmpty(i);let a=t.nucleotideElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,detail:l}=o,u=a*pm(l),c=et.createState(u,u/2,i),{elements:m,model:d,conformation:p}=t,{chainAtomSegments:h,residueAtomSegments:f}=d.atomicHierarchy,{moleculeType:y}=d.atomicHierarchy.derived.residue,g=Xt.transientSegments(h,m),x=Xt.transientSegments(f,m),S=1*s,I=0;for(;g.hasNext;)for(x.setSegment(g.move());x.hasNext;){let{index:_}=x.move();if(Zi(y[_])){let T=Pp();c.currentGroup=I,CC(T,t,_),SC(T)&&(p.invariantPosition(T.C1_1,bT),p.invariantPosition(T.C2_1,xT),p.invariantPosition(T.C3_1,CT),p.invariantPosition(T.C4_1,ST),p.invariantPosition(T.O4_1,vT),p.invariantPosition(T.trace,fT),Nr(c,fT,S,l),Nr(c,ST,S,l),Nr(c,vT,S,l),Nr(c,bT,S,l),Nr(c,xT,S,l),Nr(c,CT,S,l));let{isPurine:w,isPyrimidine:D}=Tp(t,_);w?(_p(T,t,_),dg(T)&&(p.invariantPosition(T.N1,Dp),p.invariantPosition(T.C2,wp),p.invariantPosition(T.N3,Ep),p.invariantPosition(T.C4,Mp),p.invariantPosition(T.C5,vd),p.invariantPosition(T.C6,Bp),p.invariantPosition(T.N7,hT),p.invariantPosition(T.C8,gT),p.invariantPosition(T.N9,yT),Nr(c,gT,S,l),Nr(c,hT,S,l),Nr(c,vd,S,l),Nr(c,Bp,S,l),Nr(c,Dp,S,l),Nr(c,wp,S,l),Nr(c,Ep,S,l),Nr(c,Mp,S,l),Nr(c,vd,S,l),Nr(c,yT,S,l))):D&&(Rp(T,t,_),pg(T)&&(p.invariantPosition(T.N1,Dp),p.invariantPosition(T.C2,wp),p.invariantPosition(T.N3,Ep),p.invariantPosition(T.C4,Mp),p.invariantPosition(T.C5,vd),p.invariantPosition(T.C6,Bp),Nr(c,Bp,S,l),Nr(c,vd,S,l),Nr(c,Mp,S,l),Nr(c,Ep,S,l),Nr(c,wp,S,l),Nr(c,Dp,S,l))),++I}}let v=et.getMesh(c),A=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor);return v.setBoundingSphere(A),v}function Aht(e){return So({defaultProps:C.getDefaultValues(EO),createGeometry:Iht,createLocationIterator:Sd.fromGroup,getLoci:Ip,eachLocation:Ap,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var KS=b.zero(),IT=b.zero(),JS=b.zero(),pRe=b.zero(),el=Rc(3,!1);function Tht(){let e=ff(8);for(let t=0;t<3;++t){let r=(t+1)%3;b.set(KS,el[t*3],el[t*3+1],-.5),b.set(IT,el[r*3],el[r*3+1],-.5),b.set(JS,el[r*3],el[r*3+1],.5),b.set(pRe,el[t*3],el[t*3+1],.5),e.add(KS,IT,JS),e.add(JS,pRe,KS)}return b.set(KS,el[0],el[1],-.5),b.set(IT,el[3],el[4],-.5),b.set(JS,el[6],el[7],-.5),e.add(JS,IT,KS),b.set(KS,el[0],el[1],.5),b.set(IT,el[3],el[4],.5),b.set(JS,el[6],el[7],.5),e.add(KS,IT,JS),e.getPrimitive()}var rq;function fRe(){return rq||(rq=Tht()),rq}var $S=Z.identity(),Pht=b.zero(),hRe=b.zero(),gRe=b.zero(),nq=b.zero(),_ht=4,Rht=4,Dht=6,wht=fRe(),yRe={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01})},i3n=C.getDefaultValues(yRe);function Eht(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s}=o,l=a*24,u=et.createState(l,l/10,i),m=oT(1),{normalVectors:d,binormalVectors:p}=m,h=0,f=eT(t,r);for(;f.hasNext;){let x=f.move();u.currentGroup=h;let S=Zi(x.moleculeType),I=Kt.is(x.secStrucType,Kt.Flag.Beta);if(iT(m,x,S||I?.5:.9,S?.3:.5),I&&!x.secStrucLast||!I){let _=n.size.size(x.center)*s,T=_ht*_,w=Rht*_,D=Dht*_,M=S?p:d;b.fromArray(hRe,M,0),b.fromArray(gRe,M,3),b.normalize(nq,b.add(nq,hRe,gRe)),Z.targetTo($S,x.p3,x.p1,nq),Z.mul($S,$S,Z.rotY90Z180),Z.scale($S,$S,b.set(Pht,D,w,T)),Z.setTranslation($S,x.p2),et.addPrimitive(u,$S,wht)}++h}let y=et.getMesh(u),g=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor);return y.setBoundingSphere(g),y}var oq={...ro,...yRe};function bRe(e){return So({defaultProps:C.getDefaultValues(oq),createGeometry:Eht,createLocationIterator:t=>Cd.fromGroup(t),getLoci:Sp,eachLocation:vp,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor}},e)}var iq=10,xRe={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:C.Numeric(16,{min:2,max:56,step:2},We.CustomQualityParamInfo)},y3n=C.getDefaultValues(xRe);function Mht(e,t,r,n,o,i){let a=t.gapElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,radialSegments:l}=o,u=iq*l*2*a*2,c=et.createState(u,u/10,i),m=b(),d=b(),p={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:l},h=0,f=E_e(r,t);for(;f.hasNext;){let{centerA:x,centerB:S}=f.move();x.element===S.element||(t.conformation.invariantPosition(x.element,m),t.conformation.invariantPosition(S.element,d),p.radiusTop=p.radiusBottom=n.size.size(x)*s,c.currentGroup=h,ep(c,m,d,.5,iq,!1,p),p.radiusTop=p.radiusBottom=n.size.size(S)*s,c.currentGroup=h+1,ep(c,d,m,.5,iq,!1,p)),h+=2}let y=et.getMesh(c),g=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor);return y.setBoundingSphere(g),y}var e1={...ro,...xRe};function AT(e){return So({defaultProps:C.getDefaultValues(e1),createGeometry:Mht,createLocationIterator:t=>WZ.fromGroup(t,{asSecondary:!0}),getLoci:H_e,eachLocation:j_e,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var qn=b(),vo=b(),Bht=b(),Id=b(),xg=b(),MO=b(),BO=b(),aD=b(),Nf=b(),Cg=b(),aq=b(),AC=b(),TC=b(),PC=b(),_C=b(),kp=b.fromArray,TT=b.scale,Lp=b.add,qy=b.sub,kht=b.magnitude,CRe=b.negate,sq=b.copy,SRe=b.cross,Lht=b.set,Oo=Qe.add3,Fht=Qe.add;function kO(e,t,r,n,o,i,a,s,l){let{vertices:u,normals:c,indices:m}=t,d=u.elementCount;if(kp(qn,n,e),TT(BO,qn,a),TT(MO,qn,s),kp(vo,o,e),TT(Id,vo,i),SRe(Cg,vo,qn),kp(Nf,r,e),Lp(AC,Lp(AC,Nf,Id),MO),qy(TC,Lp(TC,Nf,Id),BO),qy(PC,qy(PC,Nf,Id),BO),Lp(_C,qy(_C,Nf,Id),MO),a<s?(Oo(u,_C[0],_C[1],_C[2]),Oo(u,PC[0],PC[1],PC[2]),Oo(u,TC[0],TC[1],TC[2]),Oo(u,AC[0],AC[1],AC[2]),sq(xg,MO)):(Oo(u,AC[0],AC[1],AC[2]),Oo(u,TC[0],TC[1],TC[2]),Oo(u,PC[0],PC[1],PC[2]),Oo(u,_C[0],_C[1],_C[2]),sq(xg,BO)),l){for(let p=0;p<4;++p)Oo(c,-Cg[0],-Cg[1],-Cg[2]);Oo(m,d,d+1,d+2),Oo(m,d+2,d+3,d)}else{for(let p=0;p<4;++p)Oo(c,Cg[0],Cg[1],Cg[2]);Oo(m,d+2,d+1,d),Oo(m,d,d+3,d+2)}}function PT(e,t,r,n,o,i,a,s,l,u){let{currentGroup:c,vertices:m,normals:d,indices:p,groups:h}=e,f=m.elementCount,y=0;s>0?(kp(qn,t,0),kp(vo,t,o*3),y=s/kht(qy(Bht,vo,qn))):Lht(aD,0,0,0);for(let x=0;x<=o;++x){let S=i[x],I=a[x],v=s===0?I:s*(1-x/o),A=x*3;kp(xg,r,A),TT(xg,xg,v),kp(Id,n,A),TT(Id,Id,S),s>0&&(kp(qn,r,A),kp(vo,n,A),TT(aD,SRe(aD,qn,vo),y)),kp(Nf,t,A),kp(Cg,r,A),kp(aq,n,A),Lp(qn,Lp(qn,Nf,Id),xg),Lp(vo,Cg,aD),Oo(m,qn[0],qn[1],qn[2]),Oo(d,vo[0],vo[1],vo[2]),Lp(qn,qy(qn,Nf,Id),xg),Oo(m,qn[0],qn[1],qn[2]),Oo(d,vo[0],vo[1],vo[2]),CRe(vo,aq),Oo(m,qn[0],qn[1],qn[2]),Oo(d,vo[0],vo[1],vo[2]),qy(qn,qy(qn,Nf,Id),xg),Oo(m,qn[0],qn[1],qn[2]),Oo(d,vo[0],vo[1],vo[2]),Lp(vo,CRe(vo,Cg),aD),Oo(m,qn[0],qn[1],qn[2]),Oo(d,vo[0],vo[1],vo[2]),qy(qn,Lp(qn,Nf,Id),xg),Oo(m,qn[0],qn[1],qn[2]),Oo(d,vo[0],vo[1],vo[2]),sq(vo,aq),Oo(m,qn[0],qn[1],qn[2]),Oo(d,vo[0],vo[1],vo[2]),Lp(qn,Lp(qn,Nf,Id),xg),Oo(m,qn[0],qn[1],qn[2]),Oo(d,vo[0],vo[1],vo[2])}for(let x=0;x<o;++x){for(let S=0;S<2;S++)Oo(p,f+x*8+2*S,f+(x+1)*8+2*S+1,f+x*8+2*S+1),Oo(p,f+x*8+2*S,f+(x+1)*8+2*S,f+(x+1)*8+2*S+1);for(let S=2;S<4;S++)Oo(p,f+x*8+2*S,f+(x+1)*8+2*S,f+x*8+2*S+1),Oo(p,f+(x+1)*8+2*S,f+(x+1)*8+2*S+1,f+x*8+2*S+1)}if(l){let x=i[0],S=a[0],I=s===0?S:s;kO(0,e,t,r,n,x,I,I,!1)}else if(s>0){let x=i[0],S=a[0];kO(0,e,t,r,n,x,s,-S,!1),kO(0,e,t,r,n,x,-s,S,!1)}if(u&&s===0){let x=i[o],S=a[o];kO(o*3,e,t,r,n,x,S,S,!0)}let g=(o+1)*8+(l?4:s>0?8:0)+(u&&s===0?4:0);for(let x=0,S=g;x<S;++x)Fht(h,c)}var la=b(),LO=b(),Es=b(),Nc=b(),tl=b(),eu=b();function FO(e,t,r,n,o){e[0]=t[0]*n+r[0]*o,e[1]=t[1]*n+r[1]*o,e[2]=t[2]*n+r[2]*o}function _T(e,t,r,n,o,i){e[0]=t[0]*o+r[0]*i+n[0],e[1]=t[1]*o+r[1]*i+n[1],e[2]=t[2]*o+r[2]*i+n[2]}var Yy=b.fromArray,vRe=b.normalize,lq=b.scaleAndAdd,uq=b.cross,Vht=b.slerp,Oht=b.dot,Ght=b.unitX,ec=Qe.add3,cq=new Map;function Uht(e,t){let r=t?1:0,n=Xi(e,r);if(!cq.has(n)){let o=[],i=[];for(let a=0;a<e;++a){let s=(a*2+r)/e*Math.PI;o[a]=Math.cos(s),i[a]=Math.sin(s)}cq.set(n,{cos:o,sin:i})}return cq.get(n)}function sD(e,t,r,n,o,i,a,s,l,u,c,m=!1){let{currentGroup:d,vertices:p,normals:h,indices:f,groups:y}=e,g=p.elementCount,{cos:x,sin:S}=Uht(i,c==="rounded"),I=Math.round(i/4),v=I*3,A=m&&o&&(l||u),_,T=A&&l&&u;T&&(_=o/2);for(let M=0;M<=o;++M){let E=M*3;Yy(tl,r,E),Yy(eu,n,E),Yy(Nc,t,E);let R=a[M],k=s[M],B;if(A){let V=T?M<=_:l;T?B=Math.max(Number.EPSILON,Math.sqrt(1-Math.pow((V?_-M:M-_)/_,2))):B=Math.max(Number.EPSILON,Math.sqrt(1-Math.pow((V?o-M:M)/o,2))),R*=B,k*=B,uq(LO,V?eu:tl,V?tl:eu),vRe(LO,LO)}let L=c==="rounded"&&k>R;for(let V=0;V<i;++V){if(L){_T(Es,tl,eu,Nc,R*x[V],R*S[V]);let U=Oht(eu,Ght)<0?V<I||V>=v?k-R:-k+R:V>=I&&V<v?-k+R:k-R;lq(Es,Es,tl,U),V===I||V===I-1?FO(la,tl,eu,0,1):V===v||V===v-1?FO(la,tl,eu,0,-1):FO(la,tl,eu,x[V],S[V])}else _T(Es,tl,eu,Nc,k*x[V],R*S[V]),FO(la,tl,eu,R*x[V],k*S[V]);vRe(la,la),ec(p,Es[0],Es[1],Es[2]),A&&Vht(la,LO,la,B),ec(h,la[0],la[1],la[2])}}let w=Math.round(i/2);for(let M=0;M<o;++M){for(let E=0;E<w;++E)ec(f,g+M*i+(E+1)%i,g+(M+1)*i+(E+1)%i,g+M*i+E),ec(f,g+(M+1)*i+(E+1)%i,g+(M+1)*i+E,g+M*i+E);for(let E=w;E<i;++E)ec(f,g+M*i+(E+1)%i,g+(M+1)*i+E,g+M*i+E),ec(f,g+(M+1)*i+(E+1)%i,g+(M+1)*i+E,g+M*i+(E+1)%i)}if(l){let E=p.elementCount;Yy(tl,r,0),Yy(eu,n,0),Yy(Nc,t,0),uq(la,eu,tl),ec(p,Nc[0],Nc[1],Nc[2]),ec(h,la[0],la[1],la[2]);let R=A?0:a[0],k=A?0:s[0],B=c==="rounded"&&k>R;B&&(k-=R),g=p.elementCount;for(let L=0;L<i;++L)B?(_T(Es,tl,eu,Nc,R*x[L],R*S[L]),lq(Es,Es,tl,L<I||L>=v?k:-k)):_T(Es,tl,eu,Nc,k*x[L],R*S[L]),ec(p,Es[0],Es[1],Es[2]),ec(h,la[0],la[1],la[2]),ec(f,g+(L+1)%i,g+L,E)}if(u){let M=o*3,E=p.elementCount;Yy(tl,r,M),Yy(eu,n,M),Yy(Nc,t,M),uq(la,tl,eu),ec(p,Nc[0],Nc[1],Nc[2]),ec(h,la[0],la[1],la[2]);let R=A?0:a[o],k=A?0:s[o],B=c==="rounded"&&k>R;B&&(k-=R),g=p.elementCount;for(let L=0;L<i;++L)B?(_T(Es,tl,eu,Nc,R*x[L],R*S[L]),lq(Es,Es,tl,L<I||L>=v?k:-k)):_T(Es,tl,eu,Nc,k*x[L],R*S[L]),ec(p,Es[0],Es[1],Es[2]),ec(h,la[0],la[1],la[2]),ec(f,g+L,g+(L+1)%i,E)}let D=(o+1)*i+(l?i+1:0)+(u?i+1:0);Qe.addRepeat(y,D,d)}var Ky=b.fromArray,Nht=b.magnitude,mq=b.sub,IRe=b.add,dq=b.scale,zht=b.negate,Hht=b.copy,jht=b.cross,Fp=Qe.add3,Wht=Qe.add,rl=b(),tu=b(),Xht=b(),pq=b(),t1=b(),ARe=b(),lD=b(),Qht=b(),fq=b();function RT(e,t,r,n,o,i,a,s){let{currentGroup:l,vertices:u,normals:c,indices:m,groups:d}=e,p=u.elementCount,h=0;s>0&&(Ky(rl,t,0),Ky(tu,t,o*3),h=s/Nht(mq(Xht,tu,rl)));for(let y=0;y<=o;++y){let g=i[y],x=a[y],S=s===0?x:s*(1-y/o),I=y*3;Ky(t1,r,I),dq(t1,t1,S),Ky(pq,n,I),dq(pq,pq,g),s>0&&(Ky(rl,r,I),Ky(tu,n,I),dq(ARe,jht(ARe,rl,tu),h)),Ky(lD,t,I),Ky(Qht,r,I),Ky(fq,n,I),IRe(rl,lD,t1),zht(tu,fq),Fp(u,rl[0],rl[1],rl[2]),Fp(c,tu[0],tu[1],tu[2]),mq(rl,lD,t1),Fp(u,rl[0],rl[1],rl[2]),Fp(c,tu[0],tu[1],tu[2]),IRe(rl,lD,t1),Hht(tu,fq),Fp(u,rl[0],rl[1],rl[2]),Fp(c,tu[0],tu[1],tu[2]),mq(rl,lD,t1),Fp(u,rl[0],rl[1],rl[2]),Fp(c,tu[0],tu[1],tu[2])}for(let y=0;y<o;++y)Fp(m,p+y*4,p+(y+1)*4+1,p+y*4+1),Fp(m,p+y*4,p+(y+1)*4,p+(y+1)*4+1),Fp(m,p+y*4+2+1,p+(y+1)*4+2+1,p+y*4+2),Fp(m,p+y*4+2,p+(y+1)*4+2+1,p+(y+1)*4+2);let f=(o+1)*4;for(let y=0,g=f;y<g;++y)Wht(d,l)}var TRe={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:C.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:C.Numeric(1.5,{min:0,max:3,step:.1},{description:"Size factor for sheet arrows"}),tubularHelices:C.Boolean(!1,{description:"Draw alpha helices as tubes"}),roundCap:C.Boolean(!1,{description:"Draw round caps on tubular alpha helices"}),helixProfile:C.Select("elliptical",C.arrayToOptions(["elliptical","rounded","square"]),{description:"Protein helix trace profile"}),nucleicProfile:C.Select("square",C.arrayToOptions(["elliptical","rounded","square"]),{description:"Nucleic strand trace profile"}),detail:C.Numeric(0,{min:0,max:3,step:1},We.CustomQualityParamInfo),linearSegments:C.Numeric(8,{min:1,max:48,step:1},We.CustomQualityParamInfo),radialSegments:C.Numeric(16,{min:2,max:56,step:2},We.CustomQualityParamInfo)},W3n=C.getDefaultValues(TRe),Pm=b();function Zht(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,detail:l,linearSegments:u,radialSegments:c,aspectRatio:m,arrowFactor:d,tubularHelices:p,roundCap:h,helixProfile:f,nucleicProfile:y}=o,g=u*c*a+(c+1)*a*2,x=et.createState(g,g/10,i),S=me.isCoarse(t),I=oT(u),{curvePoints:v,normalVectors:A,binormalVectors:_,widthValues:T,heightValues:w}=I,D=0,M=eT(t,r,{ignoreSecondaryStructure:!1,useHelixOrientation:p});for(;M.hasNext;){let k=M.move();x.currentGroup=D;let B=Zi(k.moleculeType),L=Kt.is(k.secStrucType,Kt.Flag.Beta),V=Kt.is(k.secStrucType,Kt.Flag.Helix),U=V&&!p?z_e:mO,Q=B?YS:qS;iT(I,k,U,Q);let O=n.size.size(k.centerPrev)*s,q=n.size.size(k.center)*s,X=n.size.size(k.centerNext)*s;S&&(O*=m/2,q*=m/2,X*=m/2);let F=k.secStrucFirst||k.coarseBackboneFirst||k.first,Y=k.secStrucLast||k.coarseBackboneLast||k.last,$=V&&p&&h,ce=u;if(k.initial){ce=Math.max(Math.round(u*Q),1);let ie=u-ce;v.copyWithin(0,ie*3),_.copyWithin(0,ie*3),A.copyWithin(0,ie*3),b.fromArray(Pm,v,3),b.normalize(Pm,b.sub(Pm,k.p2,Pm)),b.scaleAndAdd(Pm,k.p2,Pm,q*aT),b.toArray(Pm,v,0)}else k.final&&(ce=Math.max(Math.round(u*(1-Q)),1),b.fromArray(Pm,v,ce*3-3),b.normalize(Pm,b.sub(Pm,k.p2,Pm)),b.scaleAndAdd(Pm,k.p2,Pm,q*aT),b.toArray(Pm,v,ce*3));if(k.initial===!0&&k.final===!0)Nr(x,k.p2,q*2,l);else if(L){let ie=O*m,oe=q*m,W=X*m,N=k.secStrucLast?oe*d:0;oD(I,O,q,X,ie,oe,W,Q),c===2?RT(x,v,A,_,ce,T,w,N):PT(x,v,A,_,ce,T,w,N,F,Y)}else{let ie,oe,W;V?p?(O*=m*1.5,q*=m*1.5,X*=m*1.5,ie=O,oe=q,W=X):(ie=O*m,oe=q*m,W=X*m):B?(ie=O*m,oe=q*m,W=X*m):(ie=O,oe=q,W=X),oD(I,O,q,X,ie,oe,W,Q);let[N,j]=B?[_,A]:[A,_];if(B)for(let be=0,ee=N.length;be<ee;be++)N[be]*=-1;let ue=B?y:f;c===2?B?RT(x,v,N,j,ce,w,T,0):RT(x,v,N,j,ce,T,w,0):c===4?PT(x,v,N,j,ce,T,w,0,F,Y):oe===q?sD(x,v,N,j,ce,c,T,w,F,Y,"elliptical",$):ue==="square"?PT(x,v,N,j,ce,T,w,0,F,Y):sD(x,v,N,j,ce,c,T,w,F,Y,ue)}++D}let E=et.getMesh(x),R=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor);return E.setBoundingSphere(R),E}var hq={...ro,...TRe};function PRe(e){return So({defaultProps:C.getDefaultValues(hq),createGeometry:Zht,createLocationIterator:t=>Cd.fromGroup(t,{asSecondary:!0}),getLoci:Sp,eachLocation:vp,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.tubularHelices!==n.tubularHelices||r.roundCap!==n.roundCap||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments||r.aspectRatio!==n.aspectRatio||r.arrowFactor!==n.arrowFactor||r.helixProfile!==n.helixProfile||r.nucleicProfile!==n.nucleicProfile;let l=zs.get(a.structure).version;t.info.secondaryStructureHash!==l&&(t.info.secondaryStructureHash!==void 0&&(t.createGeometry=!0),t.info.secondaryStructureHash=l)},initUpdateState:(t,r,n,o)=>{let i=zs.get(o.structure).version;t.info.secondaryStructureHash=i}},e)}var _Re={"polymer-trace":(e,t)=>Qn("Polymer trace mesh",e,t,PRe),"polymer-gap":(e,t)=>Qn("Polymer gap cylinder",e,t,AT),"nucleotide-block":(e,t)=>Qn("Nucleotide block mesh",e,t,J_e),"nucleotide-ring":(e,t)=>Qn("Nucleotide ring mesh",e,t,oRe),"nucleotide-atomic-ring-fill":(e,t)=>Qn("Nucleotide atomic ring fill",e,t,cRe),"nucleotide-atomic-bond":(e,t)=>Qn("Nucleotide atomic bond",e,t,mRe),"nucleotide-atomic-element":(e,t)=>Qn("Nucleotide atomic element",e,t,dRe),"direction-wedge":(e,t)=>Qn("Polymer direction wedge",e,t,bRe)},RRe={...hq,...e1,...YZ,...KZ,...wO,...EO,...tq,...oq,sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),visuals:C.MultiSelect(["polymer-trace","polymer-gap","nucleotide-ring","nucleotide-atomic-ring-fill","nucleotide-atomic-bond","nucleotide-atomic-element"],C.objectToOptions(_Re)),bumpFrequency:C.Numeric(2,{min:0,max:10,step:.1},We.ShadingCategory),density:C.Numeric(.1,{min:0,max:1,step:.01},We.ShadingCategory),colorMode:C.Select("default",C.arrayToOptions(["default","interpolate"]),{...We.ShadingCategory,isHidden:!0})};function qht(e,t){let r=C.clone(RRe),n=!1,o=!1;return t.units.forEach(i=>{!n&&me.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!o&&i.gapElements.length&&(o=!0)}),r.visuals.defaultValue=["polymer-trace"],n&&r.visuals.defaultValue.push("nucleotide-ring"),o&&r.visuals.defaultValue.push("polymer-gap"),r}function Yht(e,t){return Vt.createMulti("Cartoon",e,t,Gn,_Re)}var DRe={name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:Yht,getParams:qht,defaultValues:C.getDefaultValues(RRe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.polymerResidueCount>0,ensureCustomProperties:{attach:async(e,t)=>{await zs.attach(e,t,void 0,!0);for(let r of t.models)await rD.attach(e,r,void 0,!0)},detach:e=>{zs.ref(e,!1);for(let t of e.models)rD.ref(t,!1)}}};var wRe=b.add;function Kht(e,t,r,n,o,i){let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return ft.createEmpty(i);let{detail:l,sizeFactor:u}=o,{elements:c,model:m}=t,d=c.length,p=d*pm(l),h=et.createState(p,p/2,i),f=am.Provider.get(m);if(!f)return ft.createEmpty(i);let y=b(),g=Ot(),x=b(),S=b(),I=b(),{elementToAnsiotrop:v,data:A}=f,{U:_}=A,T=A._schema.U.space,w=t.conformation,D=K.Location.create(r);D.unit=t;let M=Bc(r,t,o),E=b(),R=0;for(let V=0;V<d;V++){let U=c[V],Q=v[U];if(Q!==-1&&!(M&&M(c[V]))){D.element=U,w.invariantPosition(U,y),wRe(E,E,y),R+=1,h.currentGroup=V,xr.toMat3(g,T,_.value(Q)),Ot.symmtricFromLower(g,g),Ot.symmetricEigenvalues(x,g),Ot.eigenvector(S,g,x[1]),Ot.eigenvector(I,g,x[2]);for(let O=0;O<3;++O)x[O]=u*1.5958*Math.sqrt(Math.abs(x[O]));eo(x[0],x[1],1e-6)&&eo(x[1],x[2],1e-6)?Nr(h,y,x[0],l):_y(h,y,I,S,x,l)}}let k=et.getMesh(h);if(R===0)return k;let B;b.scale(E,E,1/R);let L=i?ye.clone(i.boundingSphere):void 0;return L&&b.distance(E,L.center)/L.radius<.1?B=L:B=ye.expand(ye(),(s??t).boundary.sphere,1*u*2),k.setBoundingSphere(B),k}var gq={...ro,sizeFactor:C.Numeric(1,{min:0,max:10,step:.1}),detail:C.Numeric(0,{min:0,max:3,step:1},We.CustomQualityParamInfo),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1)};function ERe(e){return So({defaultProps:C.getDefaultValues(gq),createGeometry:Kht,createLocationIterator:uo.fromGroup,getLoci:Zs,eachLocation:Qs,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}function Jht(e,t,r,n,o){let{child:i}=t,{detail:a,sizeFactor:s}=n,{getSerialIndex:l}=t.serialMapping,c=t.elementCount*pm(a),m=et.createState(c,c/2,o),d=b(),p=Ot(),h=b(),f=b(),y=b(),g=b(),x=0;for(let A of t.units){let _=i?.unitMap.get(A.id);if(i&&!_)return ft.createEmpty(o);let{elements:T,model:w}=A,D=T.length,M=am.Provider.get(w);if(!M)return ft.createEmpty(o);let E=Bc(t,A,n),{elementToAnsiotrop:R,data:k}=M,{U:B}=k,L=k._schema.U.space,V=A.conformation,U=K.Location.create(t);U.unit=A;for(let Q=0;Q<D;Q++){let O=T[Q],q=R[O];if(q!==-1&&!(E&&E(T[Q]))){U.element=O,V.position(O,d),wRe(g,g,d),x+=1,m.currentGroup=l(A,T[Q]),xr.toMat3(p,L,B.value(q)),Ot.symmtricFromLower(p,p),Ot.symmetricEigenvalues(h,p),Ot.eigenvector(f,p,h[1]),Ot.eigenvector(y,p,h[2]);for(let X=0;X<3;++X)h[X]=s*1.5958*Math.sqrt(Math.abs(h[X]));eo(h[0],h[1],1e-6)&&eo(h[1],h[2],1e-6)?Nr(m,d,h[0],a):_y(m,d,y,f,h,a)}}}let S=et.getMesh(m);if(x===0)return S;let I;b.scale(g,g,1/x);let v=o?ye.clone(o.boundingSphere):void 0;return v&&b.distance(g,v.center)/v.radius<1?I=v:I=ye.expand(ye(),(i??t).boundary.sphere,1*s*2),S.setBoundingSphere(I),S}var $ht={...Qu,sizeFactor:C.Numeric(1,{min:0,max:10,step:.1}),detail:C.Numeric(0,{min:0,max:3,step:1},We.CustomQualityParamInfo),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1)};function MRe(e){return cs({defaultProps:C.getDefaultValues($ht),createGeometry:Jht,createLocationIterator:uo.fromStructure,getLoci:Sa,eachLocation:Ca,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}var BRe={"ellipsoid-mesh":(e,t)=>Qn("Ellipsoid Mesh",e,t,ERe),"intra-bond":(e,t)=>Qn("Intra-unit bond cylinder",e,t,tO),"inter-bond":(e,t)=>to("Inter-unit bond cylinder",e,t,nO),"structure-ellipsoid-mesh":(e,t)=>to("Structure Ellipsoid Mesh",e,t,MRe),"structure-intra-bond":(e,t)=>to("Structure intra-unit bond cylinder",e,t,rO)},kRe={...gq,...KA,...JA,includeParent:C.Boolean(!1),adjustCylinderLength:C.Boolean(!1,{isHidden:!0}),unitKinds:Ry(["atomic"]),sizeFactor:C.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:C.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:C.Boolean(!0),visuals:C.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],C.objectToOptions(BRe)),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},We.ShadingCategory)};function egt(e,t){let r=kRe;return De.getSize(t)>=De.Size.Huge?(r=C.clone(r),r.visuals.defaultValue=["ellipsoid-mesh","intra-bond"]):t.unitSymmetryGroups.length>5e3&&(r=C.clone(r),r.visuals.defaultValue=["structure-ellipsoid-mesh","structure-intra-bond"]),r}function tgt(e,t){return Vt.createMulti("Ellipsoid",e,t,Gn,BRe)}var LRe={name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:tgt,getParams:egt,defaultValues:C.getDefaultValues(kRe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0&&e.models.some(t=>am.Provider.isApplicable(t)),getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};var FRe=`
precision highp float;

attribute vec3 aPosition;
attribute float aRadius;

varying vec3 vPosition;
varying float vRadiusSqInv;

#if defined(dCalcType_groupId)
    attribute float aGroup;
    varying float vGroup;
#endif

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vRadiusSqInv = 1.0 / (aRadius * aRadius);
    #if defined(dCalcType_groupId)
        vGroup = aGroup;
    #endif
    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);
    vPosition = (aPosition - uBboxMin) / uResolution;
    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);
}
`;var VRe=`
precision highp float;

varying vec3 vPosition;
varying float vRadiusSqInv;
#if defined(dCalcType_groupId)
    #if defined(dGridTexType_2d)
        precision highp sampler2D;
        uniform sampler2D tMinDistanceTex;
        uniform vec3 uGridTexDim;
    #elif defined(dGridTexType_3d)
        precision highp sampler3D;
        uniform sampler3D tMinDistanceTex;
    #endif
    varying float vGroup;
#endif

#include common

uniform vec3 uGridDim;
uniform vec2 uGridTexScale;
uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uAlpha;
uniform float uResolution;
uniform float uRadiusFactorInv;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition) * uResolution;

    #if defined(dCalcType_density)
        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));
        gl_FragColor.a = density * uRadiusFactorInv;
    #elif defined(dCalcType_minDistance)
        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;
    #elif defined(dCalcType_groupId)
        #if defined(dGridTexType_2d)
            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;
        #elif defined(dGridTexType_3d)
            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;
        #endif
        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)
            discard;
        gl_FragColor.rgb = packIntToRGB(vGroup);
    #endif
}
`;var rgt={drawCount:Vn("number"),instanceCount:Vn("number"),aRadius:Sn("float32",1,0),aPosition:Sn("float32",3,0),aGroup:Sn("float32",1,0),uCurrentSlice:he("f"),uCurrentX:he("f"),uCurrentY:he("f"),uBboxMin:he("v3","material"),uBboxSize:he("v3","material"),uGridDim:he("v3","material"),uGridTexDim:he("v3","material"),uGridTexScale:he("v2","material"),uAlpha:he("f","material"),uResolution:he("f","material"),uRadiusFactorInv:he("f","material"),tMinDistanceTex:pt("texture","rgba","float","nearest","material"),dGridTexType:ct("string",["2d","3d"]),dCalcType:ct("string",["density","minDistance","groupId"])},Sg="gaussian-density";function ORe(e){return e.namedFramebuffers[Sg]||(e.namedFramebuffers[Sg]=e.resources.framebuffer()),e.namedFramebuffers[Sg]}function GRe(e,t,r,n,o,i){let a=`${Sg}-${e}`;return t.namedTextures[a]||(t.namedTextures[a]=t.resources.texture(r,n,o,i)),t.namedTextures[a]}function yq(e,t,r,n,o,i){return e.isWebGL2?ngt(e,t,r,n,o,i):VO(e,t,r,n,!1,o,i)}function VO(e,t,r,n,o,i,a){He&&e.timer.mark("GaussianDensityTexture2d");let s=igt(e,t,r,n,o,i,a);return He&&e.timer.markEnd("GaussianDensityTexture2d"),URe(s)}function ngt(e,t,r,n,o,i){He&&e.timer.mark("GaussianDensityTexture3d");let a=agt(e,t,r,n,o,i);return He&&e.timer.markEnd("GaussianDensityTexture3d"),URe(a)}function URe({texture:e,scale:t,bbox:r,gridDim:n,gridTexDim:o,gridTexScale:i,radiusFactor:a,resolution:s,maxRadius:l}){return{transform:ogt(t,r),texture:e,bbox:r,gridDim:n,gridTexDim:o,gridTexScale:i,radiusFactor:a,resolution:s,maxRadius:l}}function ogt(e,t){let r=Z.identity();return Z.fromScaling(r,e),Z.setTranslation(r,t.min),r}function igt(e,t,r,n,o,i,a){let{gl:s,resources:l,state:u,extensions:{colorBufferFloat:c,textureFloat:m,colorBufferHalfFloat:d,textureHalfFloat:p,blendMinMax:h}}=e,{smoothness:f,resolution:y}=i,{drawCount:g,positions:x,radii:S,groups:I,scale:v,expandedBox:A,dim:_,maxRadius:T}=NRe(t,r,n,i),[w,D,M]=_,{texDimX:E,texDimY:R,texCols:k,powerOfTwoSize:B}=lgt(_),L=b.create(E,R,0),V=Ie.create(E/B,R/B),U=T*2,Q=o?B:E,O=o?B:R,q=GRe("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");q.define(Q,O);let X=zRe(e,g,x,S,I,q,A,_,L,V,f,y,U),{uCurrentSlice:F,uCurrentX:Y,uCurrentY:$}=X.values,ce=ORe(e);ce.bind(),HRe(e),a||(a=d&&p?l.texture("image-float16","rgba","fp16","linear"):c&&m?l.texture("image-float32","rgba","float","linear"):l.texture("image-uint8","rgba","ubyte","linear")),a.define(Q,O);function ie(oe,W){u.currentRenderItemId=-1,oe.attachFramebuffer(ce,0),W&&(u.viewport(0,0,Q,O),u.scissor(0,0,Q,O),s.clear(s.COLOR_BUFFER_BIT)),P.update($,0);let N=0,j=0,ue=0;for(let be=0;be<M;++be)N>=k&&(N-=k,j+=D,ue=0,P.update($,j)),P.update(Y,ue),P.update(F,be),u.viewport(ue,j,w,D),u.scissor(ue,j,w,D),X.render(),++N,ue+=w;s.flush()}return WRe(e,X),ie(a,!0),h&&(jRe(e,X),ie(q,!0),XRe(e,X),ie(a,!1)),{texture:a,scale:v,bbox:A,gridDim:_,gridTexDim:L,gridTexScale:V,radiusFactor:U,resolution:y,maxRadius:T}}function agt(e,t,r,n,o,i){let{gl:a,resources:s,state:l,extensions:{colorBufferFloat:u,textureFloat:c,colorBufferHalfFloat:m,textureHalfFloat:d}}=e,{smoothness:p,resolution:h}=o,{drawCount:f,positions:y,radii:g,groups:x,scale:S,expandedBox:I,dim:v,maxRadius:A}=NRe(t,r,n,o),[_,T,w]=v,D=GRe("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");D.define(_,T,w);let M=Ie.create(1,1),E=A*2,R=zRe(e,f,y,g,x,D,I,v,v,M,p,h,E),{uCurrentSlice:k}=R.values,B=ORe(e);B.bind(),HRe(e),l.viewport(0,0,_,T),l.scissor(0,0,_,T),i||(i=m&&d?s.texture("volume-float16","rgba","fp16","linear"):u&&c?s.texture("volume-float32","rgba","float","linear"):s.texture("volume-uint8","rgba","ubyte","linear")),i.define(_,T,w);function L(V,U){l.currentRenderItemId=-1;for(let Q=0;Q<w;++Q)P.update(k,Q),V.attachFramebuffer(B,0,Q),U&&a.clear(a.COLOR_BUFFER_BIT),R.render();a.flush()}return WRe(e,R),L(i,!0),jRe(e,R),L(D,!0),XRe(e,R),L(i,!1),{texture:i,scale:S,bbox:I,gridDim:v,gridTexDim:v,gridTexScale:M,radiusFactor:E,resolution:h,maxRadius:A}}function NRe(e,t,r,n){let{resolution:o,radiusOffset:i}=n,a=1/o,{indices:s,x:l,y:u,z:c,id:m}=e,d=Se.size(s),p=new Float32Array(d*3),h=new Float32Array(d),f=new Float32Array(d),y=0;for(let A=0;A<d;++A){let _=Se.getAt(s,A);p[A*3]=l[_],p[A*3+1]=u[_],p[A*3+2]=c[_];let T=r(_)+i;y<T&&(y=T),h[A]=T,f[A]=m?m[A]:A}let g=y*2+o*4,x=ut.expand(ut(),t,b.create(g,g,g)),S=ut.scale(ut(),x,a),I=ut.size(b(),S);b.ceil(I,I);let v=b.create(o,o,o);return{drawCount:d,positions:p,radii:h,groups:f,scale:v,expandedBox:x,dim:I,maxRadius:y}}function zRe(e,t,r,n,o,i,a,s,l,u,c,m,d){if(e.namedComputeRenderables[Sg]){let p=b.sub(b(),a.max,a.min),h=e.namedComputeRenderables[Sg].values;P.updateIfChanged(h.drawCount,t),P.updateIfChanged(h.instanceCount,1),P.update(h.aRadius,n),P.update(h.aPosition,r),P.update(h.aGroup,o),P.updateIfChanged(h.uCurrentSlice,0),P.updateIfChanged(h.uCurrentX,0),P.updateIfChanged(h.uCurrentY,0),P.update(h.uBboxMin,a.min),P.update(h.uBboxSize,p),P.update(h.uGridDim,s),P.update(h.uGridTexDim,l),P.update(h.uGridTexScale,u),P.updateIfChanged(h.uAlpha,c),P.updateIfChanged(h.uResolution,m),P.updateIfChanged(h.uRadiusFactorInv,1/d),P.update(h.tMinDistanceTex,i),P.updateIfChanged(h.dGridTexType,i.getDepth()>0?"3d":"2d"),P.updateIfChanged(h.dCalcType,"density"),e.namedComputeRenderables[Sg].update()}else e.namedComputeRenderables[Sg]=sgt(e,t,r,n,o,i,a,s,l,u,c,m,d);return e.namedComputeRenderables[Sg]}function sgt(e,t,r,n,o,i,a,s,l,u,c,m,d){let p=b.sub(b(),a.max,a.min),h={drawCount:P.create(t),instanceCount:P.create(1),aRadius:P.create(n),aPosition:P.create(r),aGroup:P.create(o),uCurrentSlice:P.create(0),uCurrentX:P.create(0),uCurrentY:P.create(0),uBboxMin:P.create(a.min),uBboxSize:P.create(p),uGridDim:P.create(s),uGridTexDim:P.create(l),uGridTexScale:P.create(u),uAlpha:P.create(c),uResolution:P.create(m),uRadiusFactorInv:P.create(1/d),tMinDistanceTex:P.create(i),dGridTexType:P.create(i.getDepth()>0?"3d":"2d"),dCalcType:P.create("density")},f={...rgt},y=Dr(Sg,FRe,VRe),g=Wr(e,"points",y,f,h);return Xr(g,h)}function HRe(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0)}function jRe(e,t){let{gl:r,state:n}=e;if(P.update(t.values.dCalcType,"minDistance"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");n.blendEquation(e.extensions.blendMinMax.MAX)}function WRe(e,t){let{gl:r,state:n}=e;P.update(t.values.dCalcType,"density"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD)}function XRe(e,t){let{gl:r,state:n}=e;P.update(t.values.dCalcType,"groupId"),t.update(),n.colorMask(!0,!0,!0,!1),n.blendFunc(r.ONE,r.ZERO),n.blendEquation(r.FUNC_ADD)}function lgt(e){let t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),o=0,i=e[1],a=1,s=e[2];return n<e[0]*e[2]?(s=Math.floor(n/e[0]),a=Math.ceil(e[2]/s),o=s*e[0],i*=a):o=e[0]*e[2],{texDimX:o,texDimY:i,texRows:a,texCols:s,powerOfTwoSize:i<n?n:n*2}}async function bq(e,t,r,n,o){let{resolution:i,radiusOffset:a,smoothness:s}=o,l=1/i,{indices:u,x:c,y:m,z:d,id:p}=t,h=Se.size(u),f=new Float32Array(h),y=0;for(let ce=0;ce<h;++ce){let ie=n(Se.getAt(u,ce))+a;y<ie&&(y=ie),f[ce]=ie}let g=y*2+i,x=ut.expand(ut(),r,b.create(g,g,g)),S=x.min,I=ut.scale(ut(),x,l),v=ut.size(b(),I);b.ceil(v,v);let A=xr.Space(v,[0,1,2],Float32Array),_=A.create(),T=xr.create(A,_),w=A.create();w.fill(-1);let D=xr.create(A,w),[M,E,R]=v,k=R,B=E,L=k*B,V=rx(v[0],S[0],i),U=rx(v[1],S[1],i),Q=rx(v[2],S[2],i),O=A.create(),q=s,X=Math.ceil(1e5/(Math.pow(Math.pow(y,3),3)*l));function F(ce,ie){for(let oe=ce;oe<ie;++oe){let W=Se.getAt(u,oe),N=c[W],j=m[W],ue=d[W],be=f[oe],le=1/(be*be),Ae=be*2,Ce=Ae*Ae,J=Math.ceil(Ae*l),z=Math.floor(l*(N-S[0])),ae=Math.floor(l*(j-S[1])),ge=Math.floor(l*(ue-S[2])),ve=Math.max(0,z-J),Oe=Math.max(0,ae-J),ze=Math.max(0,ge-J),Re=Math.min(M,z+J+2),Ke=Math.min(E,ae+J+2),tt=Math.min(R,ge+J+2);for(let bt=ve;bt<Re;++bt){let Pt=V[bt]-N,fr=bt*L;for(let gt=Oe;gt<Ke;++gt){let Sr=U[gt]-j,zr=Pt*Pt+Sr*Sr,Nn=gt*k+fr;for(let xn=ze;xn<tt;++xn){let In=Q[xn]-ue,zn=zr+In*In;if(zn<=Ce){let hi=d1e(-q*(zn*le)),nl=xn+Nn;_[nl]+=hi,hi>O[nl]&&(O[nl]=hi,w[nl]=p?p[oe]:oe)}}}}}}async function Y(){for(let ce=0;ce<h;ce+=X)F(ce,Math.min(ce+X,h)),e.shouldUpdate&&await e.update({message:"filling density grid",current:ce,max:h})}await Y();let $=Z.identity();return Z.fromScaling($,b.create(i,i,i)),Z.setTranslation($,x.min),{field:T,idField:D,transform:$,radiusFactor:1,resolution:i,maxRadius:y}}var RC={resolution:C.Numeric(1,{min:.1,max:20,step:.1},{description:"Grid resolution/cell spacing.",...We.CustomQualityParamInfo}),radiusOffset:C.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:C.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."}),...pS},AEn=C.getDefaultValues(RC);function QRe(e,t){let r=e.maxTextureSize/3;return r*r/Math.max(1,t?t.units.length/16:1)}function OO(e,t,r,n){let{position:o,boundary:i,radius:a}=UI(e,t,r,n),s=zh(i.box,n);return Pe.create("Gaussian Density",async l=>await bq(l,o,i.box,a,s))}function ZRe(e,t,r,n,o,i){let{position:a,boundary:s,radius:l}=UI(e,t,r,n),u=zh(s.box,n,QRe(o,e));return yq(o,a,s.box,l,u,i)}function qRe(e,t,r,n,o,i,a){let{position:s,boundary:l,radius:u}=UI(e,t,r,o),c=zh(l.box,o,QRe(i,e));return VO(i,s,l.box,u,n,c,a)}function YRe(e,t,r){let{position:n,boundary:o,radius:i}=NI(e,t,r),a=zh(o.box,r);return Pe.create("Gaussian Density",async s=>await bq(s,n,o.box,i,a))}function KRe(e,t,r,n,o){let{position:i,boundary:a,radius:s}=NI(e,t,r),l=zh(a.box,r);return yq(n,i,a.box,s,l,o)}function JRe(e,t,r,n,o,i){let{box:a}=e.lookup3d.boundary,{position:s,boundary:l,radius:u}=NI(e,t,n),c=zh(l.box,n);return VO(o,s,a,u,r,c,i)}var $Re={...RC,...FB,ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),tryUseGpu:C.Boolean(!0),includeParent:C.Boolean(!1,{isHidden:!0})},GO={...ro,...O0e,...$Re},eDe={...Qu,...w0e,...$Re};function tDe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.textureFloatLinear&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function wT(e,t,r){if(t.resolution>1)return!1;let n=r.maxTextureSize/3,{areaCells:o,maxAreaCells:i}=$j(e.boundary.box,t.resolution,n*n);return o<i}function rDe(e,t,r,n){return r.tryUseGpu&&n&&tDe(n)&&wT(t,r,n)?fgt(e):cgt(e)}function nDe(e,t,r,n){return r.tryUseGpu&&n&&tDe(n)&&wT(t,r,n)?ggt(e):dgt(e)}async function ugt(e,t,r,n,o,i){let{smoothness:a}=o,{transform:s,field:l,idField:u,radiusFactor:c,resolution:m,maxRadius:d}=await OO(r,t,n.size,o).runInContext(e.runtime),p={isoLevel:Math.exp(-a)/c,scalarField:l,idField:u},h=await sg(p,i).runAsChild(e.runtime);h.meta.resolution=m,ft.transform(h,s),e.webgl&&!e.webgl.isWebGL2?(ft.uniformTriangleGroup(h),P.updateIfChanged(h.varyingGroup,!1)):P.updateIfChanged(h.varyingGroup,!0);let f=ye.expand(ye(),t.boundary.sphere,d);return h.setBoundingSphere(f),h}function cgt(e){return So({defaultProps:C.getDefaultValues(GO),createGeometry:ugt,createLocationIterator:uo.fromGroup,getLoci:Zs,eachLocation:Qs,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,r,n)=>r.tryUseGpu&&!!n&&wT(t.structure,r,n),processValues:(t,r,n,o,i)=>{let{resolution:a,colorTexture:s}=r.meta,l=fu(n.smoothColors,o.color.preferSmoothing,a);l&&(PI(t,l.resolution,l.stride,i,s),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{t.meta.colorTexture?.destroy()}},e)}async function mgt(e,t,r,n,o){let{smoothness:i}=n,{transform:a,field:s,idField:l,radiusFactor:u,resolution:c,maxRadius:m}=await YRe(t,r.size,n).runInContext(e.runtime),d={isoLevel:Math.exp(-i)/u,scalarField:s,idField:l},p=await sg(d,o).runAsChild(e.runtime);p.meta.resolution=c,ft.transform(p,a),e.webgl&&!e.webgl.isWebGL2?(ft.uniformTriangleGroup(p),P.updateIfChanged(p.varyingGroup,!1)):P.updateIfChanged(p.varyingGroup,!0);let h=ye.expand(ye(),t.boundary.sphere,m);return p.setBoundingSphere(h),p}function dgt(e){return cs({defaultProps:C.getDefaultValues(eDe),createGeometry:mgt,createLocationIterator:uo.fromStructure,getLoci:Sa,eachLocation:Ca,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,r,n)=>r.tryUseGpu&&!!n&&wT(t,r,n),processValues:(t,r,n,o,i)=>{let{resolution:a,colorTexture:s}=r.meta,l=fu(n.smoothColors,o.color.preferSmoothing,a);l&&(PI(t,l.resolution,l.stride,i,s),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{t.meta.colorTexture?.destroy()}},e)}var DT="gaussian-surface";function pgt(e,t,r,n,o,i){let{webgl:a}=e;if(!a)throw new Error("webgl context required to create gaussian surface texture-mesh");let{namedTextures:s,resources:l,extensions:{colorBufferFloat:u,textureFloat:c,colorBufferHalfFloat:m,textureHalfFloat:d}}=a;s[DT]||(s[DT]=m&&d?l.texture("image-float16","rgba","fp16","linear"):u&&c?l.texture("image-float32","rgba","float","linear"):l.texture("image-uint8","rgba","ubyte","linear"));let p=b.create(0,1,2),h=t.elements.length,f=g=>{He&&a.timer.mark("createGaussianSurfaceTextureMesh");let x=qRe(r,t,n.size,!0,o,a,s[DT]),S=Math.exp(-o.smoothness)/x.radiusFactor,I=g?.doubleBuffer.get(),v=zS(a,x.texture,x.gridDim,x.gridTexDim,x.gridTexScale,x.transform,S,!1,!0,p,!0,I?.vertex,I?.group,I?.normal);He&&a.timer.markEnd("createGaussianSurfaceTextureMesh");let A=ye.expand(ye(),t.boundary.sphere,x.maxRadius),_=is.create(v.vertexCount,h,v.vertexTexture,v.groupTexture,v.normalTexture,A,g);return _.meta.resolution=x.resolution,_},y=f(i);return y.meta.webgl=a,y.meta.reset=()=>{f(y)},y}function fgt(e){return G0e({defaultProps:C.getDefaultValues(GO),createGeometry:pgt,createLocationIterator:uo.fromGroup,getLoci:Zs,eachLocation:Qs,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,r,n)=>!r.tryUseGpu||!n||!wT(t.structure,r,n),processValues:(t,r,n,o,i)=>{let{resolution:a,colorTexture:s}=r.meta,l=fu(n.smoothColors,o.color.preferSmoothing,a);l&&i&&(Pj(t,l.resolution,l.stride,i,s),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),t.meta.colorTexture?.destroy()}},e)}function hgt(e,t,r,n,o){let{webgl:i}=e;if(!i)throw new Error("webgl context required to create structure gaussian surface texture-mesh");let{namedTextures:a,resources:s,extensions:{colorBufferFloat:l,textureFloat:u,colorBufferHalfFloat:c,textureHalfFloat:m}}=i;a[DT]||(a[DT]=c&&m?s.texture("image-float16","rgba","fp16","linear"):l&&u?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear"));let d=b.create(0,1,2),p=t.elementCount,h=y=>{He&&i.timer.mark("createStructureGaussianSurfaceTextureMesh");let g=JRe(t,r.size,!0,n,i,a[DT]),x=Math.exp(-n.smoothness)/g.radiusFactor,S=y?.doubleBuffer.get(),I=zS(i,g.texture,g.gridDim,g.gridTexDim,g.gridTexScale,g.transform,x,!1,!0,d,!0,S?.vertex,S?.group,S?.normal);He&&i.timer.markEnd("createStructureGaussianSurfaceTextureMesh");let v=ye.expand(ye(),t.boundary.sphere,g.maxRadius),A=is.create(I.vertexCount,p,I.vertexTexture,I.groupTexture,I.normalTexture,v,y);return A.meta.resolution=g.resolution,A},f=h(o);return f.meta.webgl=i,f.meta.reset=()=>{h(f)},f}function ggt(e){return E0e({defaultProps:C.getDefaultValues(eDe),createGeometry:hgt,createLocationIterator:uo.fromStructure,getLoci:Sa,eachLocation:Ca,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,r,n)=>!r.tryUseGpu||!n||!wT(t,r,n),processValues:(t,r,n,o,i)=>{let{resolution:a,colorTexture:s}=r.meta,l=fu(n.smoothColors,o.color.preferSmoothing,a);l&&i&&(Pj(t,l.resolution,l.stride,i,s),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),t.meta.colorTexture?.destroy()}},e)}async function ygt(e,t,r,n,o,i){let{smoothness:a}=o,{transform:s,field:l,idField:u,maxRadius:c}=await OO(r,t,n.size,o).runInContext(e.runtime),m={isoLevel:Math.exp(-a),scalarField:l,idField:u},d=await UA(m,i).runAsChild(e.runtime);ln.transform(d,s);let p=ye.expand(ye(),t.boundary.sphere,c);return d.setBoundingSphere(p),d}var xq={...Nx,...RC,sizeFactor:C.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:C.Boolean(!1),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),includeParent:C.Boolean(!1,{isHidden:!0})};function oDe(e){return zx({defaultProps:C.getDefaultValues(xq),createGeometry:ygt,createLocationIterator:uo.fromGroup,getLoci:Zs,eachLocation:Qs,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var iDe={"gaussian-surface-mesh":(e,t)=>Qn("Gaussian surface mesh",e,t,rDe),"structure-gaussian-surface-mesh":(e,t)=>to("Structure-Gaussian surface mesh",e,t,nDe),"gaussian-surface-wireframe":(e,t)=>Qn("Gaussian surface wireframe",e,t,oDe)},aDe={...GO,...xq,visuals:C.MultiSelect(["gaussian-surface-mesh"],C.objectToOptions(iDe)),bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},We.ShadingCategory),density:C.Numeric(.5,{min:0,max:1,step:.01},We.ShadingCategory)};function bgt(e,t){return aDe}function xgt(e,t){return Vt.createMulti("Gaussian Surface",e,t,Gn,iDe)}var sDe={name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:xgt,getParams:bgt,defaultValues:C.getDefaultValues(aDe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};var lDe={"label-text":(e,t)=>to("Label text",e,t,j0e)},uDe={...Dy,visuals:C.MultiSelect(["label-text"],C.objectToOptions(lDe))};function Cgt(e,t){return uDe}function Sgt(e,t){let r=Vt.createMulti("Label",e,t,Gn,lDe);return r.setState({pickable:!1,markerActions:0}),r}var cDe={name:"label",label:"Label",description:"Displays labels.",factory:Sgt,getParams:Cgt,defaultValues:C.getDefaultValues(uDe),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};function vgt(e,t){return e[0]=e[1]=e[2]=1,t[0]!==0?e[0]=(t[1]+t[2])/-t[0]:t[1]!==0?e[1]=(t[0]+t[2])/-t[1]:t[2]!==0&&(e[2]=(t[0]+t[1])/-t[2]),e}function Igt(e){let t=0,r=2*Math.PI/e,n=new Float32Array(e),o=new Float32Array(e);for(let i=0;i<e;i++)n[i]=Math.cos(t),o[i]=Math.sin(t),t+=r;return{cosTable:n,sinTable:o}}var uD={probeRadius:C.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:C.Numeric(.5,{min:.01,max:20,step:.01},{description:"Grid resolution/cell spacing.",...We.CustomQualityParamInfo}),probePositions:C.Numeric(36,{min:12,max:90,step:1},{description:"Number of positions tested for probe target intersection.",...We.CustomQualityParamInfo})},EMn=C.getDefaultValues(uD);async function mDe(e,t,r,n,o,i){let a=-1;function s(ve,Oe,ze,Re,Ke){if(a!==-1){let tt=a;if(tt!==Re&&tt!==Ke&&l(tt,ve,Oe,ze))return tt;a=-1}for(let tt=0,bt=w.count;tt<bt;++tt){let Pt=Se.getAt(D,w.indices[tt]);if(Pt!==Re&&Pt!==Ke&&l(Pt,ve,Oe,ze))return a=Pt,Pt}return-1}function l(ve,Oe,ze,Re){let Ke=B[ve],tt=M[ve]-Oe,bt=E[ve]-ze,Pt=R[ve]-Re;return tt*tt+bt*bt+Pt*Pt<Ke*Ke}function u(ve,Oe){for(let ze=ve;ze<Oe;++ze){let Re=Se.getAt(D,ze),Ke=M[Re],tt=E[Re],bt=R[Re],Pt=B[Re],fr=Pt*Pt;T.find(Ke,tt,bt,Pt);let gt=Math.ceil(Pt*v),Sr=Math.floor(v*(Ke-Q)),zr=Math.floor(v*(tt-O)),Nn=Math.floor(v*(bt-q)),xn=Math.max(0,Sr-gt),In=Math.max(0,zr-gt),zn=Math.max(0,Nn-gt),hi=Math.min(Y,Sr+gt+2),nl=Math.min($,zr+gt+2),fo=Math.min(ce,Nn+gt+2);for(let G=xn;G<hi;++G){let te=le[G]-Ke,Ge=G*W;for(let Ze=In;Ze<nl;++Ze){let lt=Ae[Ze]-tt,xt=te*te+lt*lt,At=Ze*ie+Ge;for(let Dt=zn;Dt<fo;++Dt){let Mt=Ce[Dt]-bt,wt=xt+Mt*Mt;if(wt<fr){let ke=Dt+At;be[ke]<0&&(be[ke]*=-1);let nt=Math.sqrt(wt),Ue=Pt/nt,ot=te*Ue+Ke,Tt=lt*Ue+tt,kt=Mt*Ue+bt;if(s(ot,Tt,kt,Re,-1)===-1){let qt=Pt-nt;qt<be[ke]&&(be[ke]=qt,ee[ke]=k[ze])}}}}}}}async function c(){for(let ve=0;ve<L;ve+=J)u(ve,Math.min(ve+J,L)),e.shouldUpdate&&await e.update({message:"projecting points",current:ve,max:L})}let m=b(),d=b(),p=b(),h=b();function f(ve,Oe){let ze=B[ve],Re=B[Oe],Ke=m[0]=M[Oe]-M[ve],tt=m[1]=E[Oe]-E[ve],bt=m[2]=R[Oe]-R[ve],Pt=Ke*Ke+tt*tt+bt*bt,fr=Math.sqrt(Pt),gt=(ze*ze+fr*fr-Re*Re)/(2*ze*fr),Sr=ze*gt;b.normalize(m,m),vgt(p,m),b.normalize(p,p),b.cross(h,m,p),b.normalize(h,h);let zr=Math.sqrt(ze*ze-Sr*Sr);b.scale(p,p,zr),b.scale(h,h,zr),b.scale(m,m,Sr),d[0]=m[0]+M[ve],d[1]=m[1]+E[ve],d[2]=m[2]+R[ve],a=-1;for(let Nn=0;Nn<I;++Nn){let xn=N[Nn],In=j[Nn],zn=d[0]+xn*p[0]+In*h[0],hi=d[1]+xn*p[1]+In*h[1],nl=d[2]+xn*p[2]+In*h[2];if(s(zn,hi,nl,ve,Oe)===-1){let fo=Math.floor(v*(zn-Q)),G=Math.floor(v*(hi-O)),te=Math.floor(v*(nl-q)),Ge=Math.max(0,fo-A),Ze=Math.max(0,G-A),lt=Math.max(0,te-A),xt=Math.min(Y,fo+A+2),At=Math.min($,G+A+2),Dt=Math.min(ce,te+A+2);for(let Mt=Ge;Mt<xt;++Mt){let wt=zn-le[Mt],ke=Mt*W;for(let nt=Ze;nt<At;++nt){let Ue=hi-Ae[nt],ot=wt*wt+Ue*Ue,Tt=nt*ie+ke;for(let kt=lt;kt<Dt;++kt){let qt=nl-Ce[kt],pe=ot+qt*qt,_e=kt+Tt,de=be[_e];if(de>0&&pe<de*de){be[_e]=Math.sqrt(pe);let Me=wt*m[0]+Ue*m[1]+qt*m[2];ee[_e]=k[Se.indexOf(D,Me<0?Oe:ve)]}}}}}}}function y(ve,Oe){for(let ze=ve;ze<Oe;++ze){let Re=Se.getAt(D,ze);T.find(M[Re],E[Re],R[Re],B[Re]);for(let Ke=0,tt=w.count;Ke<tt;++Ke){let bt=Se.getAt(D,w.indices[Ke]);Re<bt&&f(Re,bt)}}}async function g(){for(let ve=0;ve<L;ve+=J)y(ve,Math.min(ve+J,L)),e.shouldUpdate&&await e.update({message:"projecting torii",current:ve,max:L})}let{resolution:x,probeRadius:S,probePositions:I}=i,v=1/x,A=Math.max(5,2+Math.floor(S*v)),_=b.create(n,n,n);b.scale(_,_,2);let T=Cc(t,r,_),w=T.result;o===null&&(o=T.boundary.box);let{indices:D,x:M,y:E,z:R,id:k,radius:B}=t,L=Se.size(D),V=n+x,U=ut.expand(ut(),o,b.create(V,V,V)),[Q,O,q]=U.min,X=ut.scale(ut(),U,v),F=ut.size(b(),X);b.ceil(F,F);let[Y,$,ce]=F,ie=ce,oe=$,W=ie*oe,{cosTable:N,sinTable:j}=Igt(I),ue=xr.Space(F,[0,1,2],Float32Array),be=ue.create(),ee=ue.create();be.fill(-1001),ee.fill(-1);let le=rx(Y,Q,x),Ae=rx($,O,x),Ce=rx(ce,q,x),J=Math.ceil(1e5/(Math.pow(Math.pow(n,3),3)*v));await c(),await g();let z=xr.create(ue,be),ae=xr.create(ue,ee),ge=Z.identity();return Z.fromScaling(ge,b.create(x,x,x)),Z.setTranslation(ge,U.min),{field:z,idField:ae,transform:ge,resolution:x,maxRadius:n}}function Agt(e,t,r,n){let{probeRadius:o}=n,{position:i,boundary:a,radius:s}=UI(e,t,r,n),{indices:l}=i,u=Se.size(l),c=new Float32Array(Se.end(l)),m=0;for(let d=0;d<u;++d){let p=Se.getAt(l,d),h=s(p);m<h&&(m=h),c[p]=h+o}return{position:{...i,radius:c},boundary:a,maxRadius:m}}function UO(e,t,r,n){let{position:o,boundary:i,maxRadius:a}=Agt(e,t,r,n),s=zh(i.box,n);return Pe.create("Molecular Surface",async l=>await pDe(l,o,i,a,i.box,s))}function Tgt(e,t,r){let{probeRadius:n}=r,{position:o,boundary:i,radius:a}=NI(e,t,r),{indices:s}=o,l=Se.size(s),u=new Float32Array(Se.end(s)),c=0;for(let m=0;m<l;++m){let d=Se.getAt(s,m),p=a(d);c<p&&(c=p),u[d]=p+n}return{position:{...o,radius:u},boundary:i,maxRadius:c}}function dDe(e,t,r){let{position:n,boundary:o,maxRadius:i}=Tgt(e,t,r),a=zh(o.box,r);return Pe.create("Molecular Surface",async s=>await pDe(s,n,o,i,o.box,a))}async function pDe(e,t,r,n,o,i){return mDe(e,t,r,n,o,i)}var NO={...ro,...uD,...pS,...FB};async function Pgt(e,t,r,n,o,i){let{transform:a,field:s,idField:l,resolution:u,maxRadius:c}=await UO(r,t,n.size,o).runInContext(e.runtime),m={isoLevel:o.probeRadius,scalarField:s,idField:l},d=await sg(m,i).runAsChild(e.runtime);if(o.includeParent){let h=Math.ceil(2/o.resolution);ft.smoothEdges(d,{iterations:h,maxNewEdgeLength:Math.sqrt(2)})}ft.transform(d,a),e.webgl&&!e.webgl.isWebGL2?(ft.uniformTriangleGroup(d),P.updateIfChanged(d.varyingGroup,!1)):P.updateIfChanged(d.varyingGroup,!0);let p=ye.expand(ye(),t.boundary.sphere,c);return d.setBoundingSphere(p),d.meta.resolution=u,d}function fDe(e){return So({defaultProps:C.getDefaultValues(NO),createGeometry:Pgt,createLocationIterator:uo.fromGroup,getLoci:Zs,eachLocation:Qs,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:(t,r,n,o,i)=>{let{resolution:a,colorTexture:s}=r.meta,l=fu(n.smoothColors,o.color.preferSmoothing,a);l&&(PI(t,l.resolution,l.stride,i,s),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{t.meta.colorTexture?.destroy()}},e)}async function _gt(e,t,r,n,o){let{transform:i,field:a,idField:s,resolution:l,maxRadius:u}=await dDe(t,r.size,n).runInContext(e.runtime),c={isoLevel:n.probeRadius,scalarField:a,idField:s},m=await sg(c,o).runAsChild(e.runtime);if(n.includeParent){let p=Math.ceil(2/n.resolution);ft.smoothEdges(m,{iterations:p,maxNewEdgeLength:Math.sqrt(2)})}ft.transform(m,i),e.webgl&&!e.webgl.isWebGL2?(ft.uniformTriangleGroup(m),P.updateIfChanged(m.varyingGroup,!1)):P.updateIfChanged(m.varyingGroup,!0);let d=ye.expand(ye(),t.boundary.sphere,u);return m.setBoundingSphere(d),m.meta.resolution=l,m}function hDe(e){return cs({defaultProps:C.getDefaultValues(NO),createGeometry:_gt,createLocationIterator:uo.fromStructure,getLoci:Sa,eachLocation:Ca,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:(t,r,n,o,i)=>{let{resolution:a,colorTexture:s}=r.meta,l=fu(n.smoothColors,o.color.preferSmoothing,a);l&&(PI(t,l.resolution,l.stride,i,s),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{t.meta.colorTexture?.destroy()}},e)}var Cq={...Nx,...uD,...pS,sizeFactor:C.Numeric(1.5,{min:0,max:10,step:.1})};async function Rgt(e,t,r,n,o,i){let{transform:a,field:s,idField:l,maxRadius:u}=await UO(r,t,n.size,o).runInContext(e.runtime),c={isoLevel:o.probeRadius,scalarField:s,idField:l},m=await UA(c,i).runAsChild(e.runtime);ln.transform(m,a);let d=ye.expand(ye(),t.boundary.sphere,u);return m.setBoundingSphere(d),m}function gDe(e){return zx({defaultProps:C.getDefaultValues(Cq),createGeometry:Rgt,createLocationIterator:uo.fromGroup,getLoci:Zs,eachLocation:Qs,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var yDe={"molecular-surface-mesh":(e,t)=>Qn("Molecular surface mesh",e,t,fDe),"structure-molecular-surface-mesh":(e,t)=>to("Structure Molecular surface mesh",e,t,hDe),"molecular-surface-wireframe":(e,t)=>Qn("Molecular surface wireframe",e,t,gDe)},bDe={...NO,...Cq,visuals:C.MultiSelect(["molecular-surface-mesh"],C.objectToOptions(yDe)),bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},We.ShadingCategory),density:C.Numeric(.5,{min:0,max:1,step:.01},We.ShadingCategory)};function Dgt(e,t){return bDe}function wgt(e,t){return Vt.createMulti("Molecular Surface",e,t,Gn,yDe)}var xDe={name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:wgt,getParams:Dgt,defaultValues:C.getDefaultValues(bDe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};var Sq={...ro,sizeFactor:C.Numeric(1,{min:0,max:2,step:.1}),detail:C.Numeric(0,{min:0,max:3,step:1},We.CustomQualityParamInfo)};function CDe(e){return So({defaultProps:C.getDefaultValues(Sq),createGeometry:Mgt,createLocationIterator:Bgt,getLoci:kgt,eachLocation:Lgt,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function Egt(e){if(me.Traits.is(e.traits,me.Trait.MultiChain)||me.Traits.is(e.traits,me.Trait.Partitioned))return!1;if(me.isCoarse(e))return!0;if(e.elements.length===0)return!1;e.model.atomicHierarchy.derived.residue.moleculeType;let t=e.residueIndex[e.elements[0]],r=e.model.atomicHierarchy.derived.residue.moleculeType[t];return!(r===3||r===2)}function Mgt(e,t,r,n,o,i){if(!Egt(t))return ft.createEmpty(i);let{detail:a,sizeFactor:s}=o,l=256,u=et.createState(l,l/2,i),c=t.principalAxes.boxAxes,{origin:m,dirA:d,dirB:p}=c,h=Vi.size(b(),c);b.scale(h,h,s/2);let f=b.create(h[2],h[1],h[0]);u.currentGroup=0,_y(u,m,d,p,f,a+1);let y=et.getMesh(u),g=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor);return y.setBoundingSphere(g),y}function Bgt(e){let{group:t,structure:r}=e,n=1,o=t.units.length,i=K.Location.create(r);return Kr(n,o,1,(s,l)=>{let u=t.units[l];return i.unit=u,i.element=u.elements[s],i})}function kgt(e,t,r){let{objectId:n,instanceId:o}=e;if(r===n){let{structure:i,group:a}=t,s=a.units[o],l=Se.ofBounds(0,s.elements.length);return K.Loci(i,[{unit:s,indices:l}])}return dr}function Lgt(e,t,r){let n=!1;if(!K.Loci.is(e))return!1;let{structure:o,group:i}=t;if(!De.areEquivalent(e.structure,o))return!1;let a=i.elements.length;for(let s of e.elements){let l=i.unitIndexMap.get(s.unit.id);l!==void 0&&Se.size(s.indices)===a&&r(xe.ofSingleton(l))&&(n=!0)}return n}var SDe={"orientation-ellipsoid-mesh":(e,t)=>Qn("Orientation ellipsoid mesh",e,t,CDe)},vDe={...Sq,visuals:C.MultiSelect(["orientation-ellipsoid-mesh"],C.objectToOptions(SDe)),bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},We.ShadingCategory)};function Fgt(e,t){return vDe}function Vgt(e,t){return Vt.createMulti("Orientation",e,t,Gn,SDe)}var IDe={name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:Vgt,getParams:Fgt,defaultValues:C.getDefaultValues(vDe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0};var zO=b.add,cD={...k0e,pointSizeAttenuation:C.Boolean(!1),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1),stride:C.Numeric(1,{min:1,max:100,step:1})};function Ogt(e,t,r,n,o,i){let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return ml.createEmpty(i);let{stride:l}=o,u=t.elements,c=u.length,m=NA.create(c,c/10,i),d=b(),p=t.conformation,h=Bc(r,t,o),f=b(),y=0;if(l&&l>1||h)for(let I=0;I<c;++I)l&&I%l!==0||h&&h(u[I])||(p.invariantPosition(u[I],d),zO(f,f,d),y+=1,m.add(d[0],d[1],d[2],I));else for(let I=0;I<c;++I)p.invariantPosition(u[I],d),zO(f,f,d),y+=1,m.add(d[0],d[1],d[2],I);let g=m.getPoints();if(y===0)return g;let x;b.scale(f,f,1/y);let S=i?ye.clone(i.boundingSphere):void 0;return S&&b.distance(f,S.center)/S.radius<.1?x=S:x=ye.expand(ye(),(s??t).boundary.sphere,1*o.sizeFactor),g.setBoundingSphere(x),g}function HO(e){return L0e({defaultProps:C.getDefaultValues(cD),createGeometry:Ogt,createLocationIterator:uo.fromGroup,getLoci:Zs,eachLocation:Qs,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride}},e)}function Ggt(e,t,r,n,o){let{child:i}=t,{stride:a}=n,{getSerialIndex:s}=t.serialMapping,l=t.elementCount,u=NA.create(l,l/2,o),c=b(),m=0;for(let f of t.units){let y=i?.unitMap.get(f.id);if(i&&!y)return ml.createEmpty(o);let{elements:g,conformation:x}=f,S=g.length,I=b(),v=Bc(t,f,n);if(a&&a>1||v)for(let A=0;A<S;A++){let _=g[A];a&&A%a!==0||v&&v(_)||(x.position(_,I),u.add(I[0],I[1],I[2],s(f,_)),zO(c,c,I),m+=1)}else{for(let A=0;A<S;A++){let _=g[A];x.position(_,I),u.add(I[0],I[1],I[2],s(f,_)),zO(c,c,I)}m+=S}}let d=u.getPoints();if(m===0)return d;let p;b.scale(c,c,1/m);let h=o?ye.clone(o.boundingSphere):void 0;return h&&b.distance(c,h.center)/h.radius<1?p=h:p=ye.expand(ye(),(i??t).boundary.sphere,1*n.sizeFactor),d.setBoundingSphere(p),d}var Ugt={...T0e,pointSizeAttenuation:C.Boolean(!1),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1),stride:C.Numeric(1,{min:1,max:100,step:1})};function jO(e){return P0e({defaultProps:C.getDefaultValues(Ugt),createGeometry:Ggt,createLocationIterator:uo.fromStructure,getLoci:Sa,eachLocation:Ca,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride}},e)}var ADe={"element-point":(e,t)=>Qn("Element points",e,t,HO),"structure-element-point":(e,t)=>to("Structure element points",e,t,jO)},TDe={...cD,density:C.Numeric(.1,{min:0,max:1,step:.01},We.ShadingCategory),visuals:C.MultiSelect(["element-point"],C.objectToOptions(ADe))};function Ngt(e,t){let r=TDe;return t.unitSymmetryGroups.length>5e3&&(r=C.clone(r),r.visuals.defaultValue=["structure-element-point"]),r}function zgt(e,t){return Vt.createMulti("Point",e,t,Gn,ADe)}var PDe={name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as points.",factory:zgt,getParams:Ngt,defaultValues:C.getDefaultValues(TDe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0};var _De={sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),detail:C.Numeric(0,{min:0,max:3,step:1},We.CustomQualityParamInfo),linearSegments:C.Numeric(8,{min:1,max:48,step:1},We.CustomQualityParamInfo),radialSegments:C.Numeric(16,{min:2,max:56,step:2},We.CustomQualityParamInfo)},kkn=C.getDefaultValues(_De),_m=b();function Hgt(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return ft.createEmpty(i);let{sizeFactor:s,detail:l,linearSegments:u,radialSegments:c}=o,m=u*c*a+(c+1)*a*2,d=et.createState(m,m/10,i),p=oT(u),{curvePoints:h,normalVectors:f,binormalVectors:y,widthValues:g,heightValues:x}=p,S=0,I=eT(t,r,{ignoreSecondaryStructure:!0});for(;I.hasNext;){let _=I.move();d.currentGroup=S;let w=Zi(_.moleculeType)?YS:qS;iT(p,_,mO,w);let D=_.coarseBackboneFirst||_.first,M=_.coarseBackboneLast||_.last,E=n.size.size(_.centerPrev)*s,R=n.size.size(_.center)*s,k=n.size.size(_.centerNext)*s;oD(p,E,R,k,E,R,k,w);let B=u;if(_.initial){B=Math.max(Math.round(u*w),1);let L=u-B;h.copyWithin(0,L*3),y.copyWithin(0,L*3),f.copyWithin(0,L*3),g.copyWithin(0,L*3),x.copyWithin(0,L*3),b.fromArray(_m,h,3),b.normalize(_m,b.sub(_m,_.p2,_m)),b.scaleAndAdd(_m,_.p2,_m,R*aT),b.toArray(_m,h,0)}else _.final&&(B=Math.max(Math.round(u*(1-w)),1),b.fromArray(_m,h,B*3-3),b.normalize(_m,b.sub(_m,_.p2,_m)),b.scaleAndAdd(_m,_.p2,_m,R*aT),b.toArray(_m,h,B*3));_.initial===!0&&_.final===!0?Nr(d,_.p2,R*2,l):c===2?RT(d,h,f,y,B,g,x,0):c===4?PT(d,h,f,y,B,g,x,0,D,M):sD(d,h,f,y,B,c,g,x,D,M,"elliptical"),++S}let v=et.getMesh(d),A=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor);return v.setBoundingSphere(A),v}var vq={...ro,..._De};function RDe(e){return So({defaultProps:C.getDefaultValues(vq),createGeometry:Hgt,createLocationIterator:t=>Cd.fromGroup(t,{asSecondary:!0}),getLoci:Sp,eachLocation:vp,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments}},e)}var DDe={"polymer-tube":(e,t)=>Qn("Polymer tube mesh",e,t,RDe),"polymer-gap":(e,t)=>Qn("Polymer gap cylinder",e,t,AT)},wDe={...vq,...e1,sizeFactor:C.Numeric(.2,{min:0,max:10,step:.01}),visuals:C.MultiSelect(["polymer-tube","polymer-gap"],C.objectToOptions(DDe)),bumpFrequency:C.Numeric(2,{min:0,max:10,step:.1},We.ShadingCategory),density:C.Numeric(.1,{min:0,max:1,step:.01},We.ShadingCategory)};function jgt(e,t){let r=C.clone(wDe),n=!1,o=!1;return t.units.forEach(i=>{!n&&me.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!o&&i.gapElements.length&&(o=!0)}),r.visuals.defaultValue=["polymer-tube"],o&&r.visuals.defaultValue.push("polymer-gap"),r}function Wgt(e,t){return Vt.createMulti("Putty",e,t,Gn,DDe)}var EDe={name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:Wgt,getParams:jgt,defaultValues:C.getDefaultValues(wDe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:e=>e.polymerResidueCount>0};var MDe={"element-sphere":(e,t)=>Qn("Sphere mesh/impostor",e,t,oO),"structure-element-sphere":(e,t)=>to("Structure sphere mesh/impostor",e,t,iO)},Iq={...$A,bumpFrequency:C.Numeric(1,{min:0,max:10,step:.1},We.ShadingCategory),density:C.Numeric(.5,{min:0,max:1,step:.01},We.ShadingCategory),visuals:C.MultiSelect(["element-sphere"],C.objectToOptions(MDe))},WO;function Xgt(e,t){let r=Iq;return t.isCoarseGrained&&(WO||(WO=C.clone(Iq),WO.sizeFactor.defaultValue=2),r=WO),t.unitSymmetryGroups.length>5e3&&(r=C.clone(r),r.visuals.defaultValue=["structure-element-sphere"]),r}function Qgt(e,t){return Vt.createMulti("Spacefill",e,t,Gn,MDe)}var BDe={name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:Qgt,getParams:Xgt,defaultValues:C.getDefaultValues(Iq),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};var Aq=ht.is;function kDe(e,t,r,n){let o=K.Location.create(t,e),i=e.elements,a=e.bonds,{edgeCount:s,a:l,b:u,edgeProps:c,offset:m}=a,{order:d,flags:p}=c,{sizeFactor:h,aromaticBonds:f,includeTypes:y,excludeTypes:g,multipleBonds:x}=n,S=x==="off",I=x==="symmetric",v=ht.fromNames(y),A=ht.fromNames(g),_=qA(v,A,ht.Flag.Computed),T=b(),w=e.conformation,{elementRingIndices:D,elementAromaticRingIndices:M}=e.rings,E=f?e.resonance.delocalizedTriplets:void 0;return{linkCount:s*2,referencePosition:R=>{let k=l[R],B=u[R],L=E?.getThirdElement(k,B);if(L!==void 0)return w.invariantPosition(i[L],T);k>B&&([k,B]=[B,k]),m[k+1]-m[k]===1&&([k,B]=[B,k]);let V=M.get(k)||D.get(k),U=0;for(let Q=m[k],O=m[k+1];Q<O;++Q){let q=u[Q];if(q!==B&&q!==k)if(V){let X=M.get(q)||D.get(q);if(!X)continue;let F=l1(V,X);F>U&&(U=F,w.invariantPosition(i[q],T))}else return w.invariantPosition(i[q],T)}return U>0?T:null},position:(R,k,B,L)=>{w.invariantPosition(i[l[B]],R),w.invariantPosition(i[u[B]],k)},style:R=>{let k=d[R],B=p[R];if(Aq(B,ht.Flag.MetallicCoordination)||Aq(B,ht.Flag.HydrogenBond))return 1;if(k===3)return S?0:I?4:5;if(f){let L=l[R],V=u[R],U=M.get(L),Q=M.get(V),O=U&&Q?l1(U,Q):0;if(Aq(B,ht.Flag.Aromatic)||O&&!_)return O===2?8:7}return k!==2||S?0:I?2:3},radius:R=>{o.element=i[l[R]];let k=r.size.size(o);o.element=i[u[R]];let B=r.size.size(o);return Math.min(k,B)*h},ignore:$V(t,e,n)}}function Zgt(e,t,r,n,o,i){if(!me.isAtomic(t))return ln.createEmpty(i);if(!Qy(t,o))return ln.createEmpty(i);if(!t.bonds.edgeCount)return ln.createEmpty(i);let{child:a}=r,s=a?.unitMap.get(t.id);if(a&&!s)return ln.createEmpty(i);let l=kDe(t,r,n,o),{lines:u,boundingSphere:c}=yR(e,l,o,i);if(c)u.setBoundingSphere(c);else if(u.lineCount>0){let m=ye.expand(ye(),(s??t).boundary.sphere,1*o.sizeFactor);u.setBoundingSphere(m)}return u}var Tq={...Nx,...ZA,includeParent:C.Boolean(!1)};function LDe(e){return zx({defaultProps:C.getDefaultValues(Tq),createGeometry:Zgt,createLocationIterator:t=>Am.fromGroup(t),getLoci:YA,eachLocation:YR,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!ki(r.includeTypes,n.includeTypes)||!ki(r.excludeTypes,n.excludeTypes)||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;let l=a.group.units[0],u=s.group.units[0];me.isAtomic(l)&&me.isAtomic(u)&&(ns.areEqual(l.bonds,u.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}function qgt(e,t,r){let n=[],{bondCount:o,unitIndex:i,unitEdgeIndex:a,unitGroupIndex:s}=e.intraUnitBondMapping,{child:l}=e;for(let u of e.unitSymmetryGroups){let c=u.units[0],m=l?.unitMap.get(c.id),d=me.isAtomic(c)&&!(l&&!m)?kDe(c,e,t,r):yF;n.push({group:u,props:d})}return{linkCount:o,referencePosition:u=>{let{group:c,props:m}=n[i[u]];if(!m.referencePosition)return null;let d=m.referencePosition(a[u]);if(!d)return null;let p=c.units[s[u]];return b.transformMat4(d,d,p.conformation.operator.matrix),d},position:(u,c,m,d)=>{let{group:p,props:h}=n[i[m]];h.position(u,c,a[m],d);let f=p.units[s[m]];b.transformMat4(u,u,f.conformation.operator.matrix),b.transformMat4(c,c,f.conformation.operator.matrix)},style:u=>{let{props:c}=n[i[u]];return c.style?c.style(a[u]):0},radius:u=>{let{props:c}=n[i[u]];return c.radius(a[u])},ignore:u=>{let{props:c}=n[i[u]];return c.ignore?c.ignore(a[u]):!1},stub:u=>{let{props:c}=n[i[u]];return c.stub?c.stub(a[u]):!1}}}function Ygt(e,t,r,n,o){if(!gs(t,n))return ln.createEmpty(o);if(!t.intraUnitBondMapping.bondCount)return ln.createEmpty(o);let i=qgt(t,r,n),{lines:a,boundingSphere:s}=yR(e,i,n,o);if(s)a.setBoundingSphere(s);else if(a.lineCount>0){let{child:l}=t,u=ye.expand(ye(),(l??t).boundary.sphere,1*n.sizeFactor);a.setBoundingSphere(u)}return a}var Kgt={...zI,...ZA,includeParent:C.Boolean(!1)};function FDe(e){return HI({defaultProps:C.getDefaultValues(Kgt),createGeometry:Ygt,createLocationIterator:(t,r)=>gs(t,r)?Am.fromStructureGroups(t):wh,getLoci:$R,eachLocation:eD,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!ki(r.includeTypes,n.includeTypes)||!ki(r.excludeTypes,n.excludeTypes)||r.multipleBonds!==n.multipleBonds,gs(a,r)&&a.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)}},e)}var Pq=new Ct.ElementBondIterator;function VDe(e,t,r,n){for(Pq.setElement(t,r,n);Pq.hasNext;){let o=Pq.move();return o.otherUnit.conformation.position(o.otherUnit.elements[o.otherIndex],e),e}return null}function Jgt(e,t,r){let n=e.interUnitBonds,{edgeCount:o,edges:i}=n,{sizeFactor:a,aromaticBonds:s,multipleBonds:l}=r,u=l==="off",c=l==="symmetric",m=b(),d=K.Location.create();return{linkCount:o,referencePosition:p=>{let h=i[p],f,y,g,x;if(h.unitA<h.unitB)f=e.unitMap.get(h.unitA),y=e.unitMap.get(h.unitB),g=h.indexA,x=h.indexB;else if(h.unitA>h.unitB)f=e.unitMap.get(h.unitB),y=e.unitMap.get(h.unitA),g=h.indexB,x=h.indexA;else throw new Error("same units in createInterUnitBondLines");return VDe(m,e,f,g)||VDe(m,e,y,x)},position:(p,h,f,y)=>{let g=i[f],x=e.unitMap.get(g.unitA),S=e.unitMap.get(g.unitB);x.conformation.position(x.elements[g.indexA],p),S.conformation.position(S.elements[g.indexB],h)},style:p=>{let h=i[p].props.order,f=na.create(i[p].props.flag);return ht.is(f,ht.Flag.MetallicCoordination)||ht.is(f,ht.Flag.HydrogenBond)?1:h===3?u?0:c?4:5:s&&ht.is(f,ht.Flag.Aromatic)?7:h!==2||u?0:c?2:3},radius:p=>{let h=i[p];d.structure=e,d.unit=e.unitMap.get(h.unitA),d.element=d.unit.elements[h.indexA];let f=t.size.size(d);d.unit=e.unitMap.get(h.unitB),d.element=d.unit.elements[h.indexB];let y=t.size.size(d);return Math.min(f,y)*a},ignore:eO(e,r)}}function $gt(e,t,r,n,o){if(!gs(t,n))return ln.createEmpty(o);if(!t.interUnitBonds.edgeCount)return ln.createEmpty(o);let i=Jgt(t,r,n),{lines:a,boundingSphere:s}=yR(e,i,n,o);if(s)a.setBoundingSphere(s);else if(a.lineCount>0){let{child:l}=t,u=ye.expand(ye(),(l??t).boundary.sphere,1*n.sizeFactor);a.setBoundingSphere(u)}return a}var _q={...zI,...ZA,includeParent:C.Boolean(!1)};function ODe(e){return HI({defaultProps:C.getDefaultValues(_q),createGeometry:$gt,createLocationIterator:(t,r)=>gs(t,r)?Am.fromStructure(t):wh,getLoci:KR,eachLocation:JR,setUpdateState:(t,r,n,o,i,a,s)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!ki(r.includeTypes,n.includeTypes)||!ki(r.excludeTypes,n.excludeTypes)||r.multipleBonds!==n.multipleBonds,gs(a,r)&&a.interUnitBonds!==s.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)}},e)}var GDe=b.add,Vp=b.scaleAndAdd,XO=b.unitX,QO=b.unitY,ZO=b.unitZ,Rq={...Nx,lineSizeAttenuation:C.Boolean(!1),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1),crosses:C.Select("lone",C.arrayToOptions(["lone","all"])),crossSize:C.Numeric(.35,{min:0,max:2,step:.01})};function eyt(e,t,r,n,o,i){let{child:a}=r;if(a&&!a.unitMap.get(t.id))return ln.createEmpty(i);let s=t.elements,l=s.length,u=Ua.create(l,l/10,i),c=b(),m=b(),d=b(),p=t.conformation,h=Bc(r,t,o),f=o.crossSize/2,y=o.crosses==="lone",g=b(),x=0;for(let A=0;A<l;++A)h&&h(s[A])||y&&me.isAtomic(t)&&Qy(t,o)&&Ec(r,t,A)!==0||(p.invariantPosition(s[A],c),GDe(g,g,c),x+=1,Vp(m,c,XO,f),Vp(d,c,XO,-f),u.add(m[0],m[1],m[2],d[0],d[1],d[2],A),Vp(m,c,QO,f),Vp(d,c,QO,-f),u.add(m[0],m[1],m[2],d[0],d[1],d[2],A),Vp(m,c,ZO,f),Vp(d,c,ZO,-f),u.add(m[0],m[1],m[2],d[0],d[1],d[2],A));let S=u.getLines();if(x===0)return S;let I;b.scale(g,g,1/x);let v=i?ye.clone(i.boundingSphere):void 0;return v&&b.distance(g,v.center)/v.radius<.1?I=v:I=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor),S.setBoundingSphere(I),S}function UDe(e){return zx({defaultProps:C.getDefaultValues(Rq),createGeometry:eyt,createLocationIterator:uo.fromGroup,getLoci:Zs,eachLocation:Qs,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.crosses!==n.crosses||r.crossSize!==n.crossSize}},e)}function tyt(e,t,r,n,o){let{child:i}=t,{getSerialIndex:a}=t.serialMapping,s=t.elementCount,l=Ua.create(s,s/2,o),u=b(),c=b(),m=b(),d=n.crossSize/2,p=n.crosses==="lone",h=b(),f=0;for(let S of t.units){let I=i?.unitMap.get(S.id);if(i&&!I)return ln.createEmpty(o);let{elements:v,conformation:A}=S,_=v.length,T=Bc(t,S,n);for(let w=0;w<_;w++){if(T&&T(v[w])||p&&me.isAtomic(S)&&Qy(S,n)&&Ec(t,S,w)!==0)continue;A.position(v[w],u),GDe(h,h,u),f+=1;let D=a(S,v[w]);Vp(c,u,XO,d),Vp(m,u,XO,-d),l.add(c[0],c[1],c[2],m[0],m[1],m[2],D),Vp(c,u,QO,d),Vp(m,u,QO,-d),l.add(c[0],c[1],c[2],m[0],m[1],m[2],D),Vp(c,u,ZO,d),Vp(m,u,ZO,-d),l.add(c[0],c[1],c[2],m[0],m[1],m[2],D)}}let y=l.getLines();if(f===0)return y;let g;b.scale(h,h,1/f);let x=o?ye.clone(o.boundingSphere):void 0;return x&&b.distance(h,x.center)/x.radius<1?g=x:g=ye.expand(ye(),(i??t).boundary.sphere,1*n.sizeFactor),y.setBoundingSphere(g),y}var ryt={...zI,lineSizeAttenuation:C.Boolean(!1),ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),traceOnly:C.Boolean(!1),crosses:C.Select("lone",C.arrayToOptions(["lone","all"])),crossSize:C.Numeric(.35,{min:0,max:2,step:.01})};function NDe(e){return HI({defaultProps:C.getDefaultValues(ryt),createGeometry:tyt,createLocationIterator:uo.fromStructure,getLoci:Sa,eachLocation:Ca,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.crosses!==n.crosses||r.crossSize!==n.crossSize}},e)}var zDe={"intra-bond":(e,t)=>Qn("Intra-unit bond line",e,t,LDe),"inter-bond":(e,t)=>to("Inter-unit bond line",e,t,ODe),"element-point":(e,t)=>Qn("Points",e,t,HO),"element-cross":(e,t)=>Qn("Crosses",e,t,UDe),"structure-intra-bond":(e,t)=>to("Structure intra-unit bond line",e,t,FDe),"structure-element-point":(e,t)=>to("Structure element points",e,t,jO),"structure-element-cross":(e,t)=>to("Structure element crosses",e,t,NDe)},HDe={...Tq,..._q,...cD,...Rq,pointStyle:C.Select("circle",C.objectToOptions(ml.StyleTypes)),multipleBonds:C.Select("offset",C.arrayToOptions(["off","symmetric","offset"])),includeParent:C.Boolean(!1),sizeFactor:C.Numeric(2,{min:.01,max:10,step:.01}),unitKinds:Ry(["atomic"]),visuals:C.MultiSelect(["intra-bond","inter-bond","element-point","element-cross"],C.objectToOptions(zDe)),density:C.Numeric(.1,{min:0,max:1,step:.01},We.ShadingCategory)};function nyt(e,t){let r=HDe;return De.getSize(t)>=De.Size.Huge?(r=C.clone(r),r.visuals.defaultValue=["intra-bond","element-point","element-cross"]):t.unitSymmetryGroups.length>5e3&&(r=C.clone(r),r.visuals.defaultValue=["structure-intra-bond","structure-element-point","structure-element-cross"]),r}function oyt(e,t){return Vt.createMulti("Line",e,t,Gn,zDe)}var jDe={name:"line",label:"Line",description:"Displays bonds as lines and atoms as points or croses.",factory:oyt,getParams:nyt,defaultValues:C.getDefaultValues(HDe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};function iyt(e,t,r,n,o){let{webgl:i}=e;if(!i)throw new Error("GaussianDensityVolume requires `webgl`");let a=b.create(0,1,2),s={min:0,max:1,mean:.04,sigma:.01},l=c=>{let m=c?c.gridTexture.ref.value:void 0,d=KRe(t,r.size,n,i,m),{transform:p,texture:h,bbox:f,gridDim:y}=d,g=Z.mul(Z(),p,Z.fromScaling(Z(),y)),x=Z.getScaling(b(),p),S=Bl.create(f,y,p,g,x,h,s,!0,a,"byte",c),I=ye.expand(ye(),t.boundary.sphere,d.maxRadius);return S.setBoundingSphere(I),S},u=l(o);return u.meta.reset=()=>{l(u)},u}var Dq={...R0e,...RC,ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),includeParent:C.Boolean(!1,{isHidden:!0})};function WDe(e){return D0e({defaultProps:C.getDefaultValues(Dq),createGeometry:iyt,createLocationIterator:uo.fromStructure,getLoci:Sa,eachLocation:Ca,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:t=>{t.gridTexture.ref.value.destroy()}},e)}function ayt(e,t,r,n,o,i){let{webgl:a}=e;if(!a)throw new Error("GaussianDensityVolume requires `webgl`");let s=b.create(0,1,2),l={min:0,max:1,mean:.04,sigma:.01},u=m=>{let d=m?m.gridTexture.ref.value:void 0,p=ZRe(r,t,n.size,o,a,d),{transform:h,texture:f,bbox:y,gridDim:g}=p,x=Z.mul(Z(),h,Z.fromScaling(Z(),g)),S=Z.getScaling(b(),h),I=Bl.create(y,g,h,x,S,f,l,!0,s,"byte",m),v=ye.expand(ye(),t.boundary.sphere,p.maxRadius);return I.setBoundingSphere(v),I},c=u(i);return c.meta.reset=()=>{u(c)},c}var syt={...F0e,...RC,ignoreHydrogens:C.Boolean(!1),ignoreHydrogensVariant:C.Select("all",C.arrayToOptions(["all","non-polar"])),includeParent:C.Boolean(!1,{isHidden:!0})};function XDe(e){return V0e({defaultProps:C.getDefaultValues(syt),createGeometry:ayt,createLocationIterator:uo.fromGroup,getLoci:Zs,eachLocation:Qs,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:t=>{t.gridTexture.ref.value.destroy()}},e)}var QDe={"gaussian-volume":(e,t)=>to("Gaussian volume",e,t,WDe),"units-gaussian-volume":(e,t)=>Qn("Units-Gaussian volume",e,t,XDe)},ZDe={...Dq,jumpLength:C.Numeric(4,{min:0,max:20,step:.1}),visuals:C.MultiSelect(["gaussian-volume"],C.objectToOptions(QDe))};function lyt(e,t){return ZDe}function uyt(e,t){return Vt.createMulti("Gaussian Volume",e,t,Gn,QDe)}var qDe={name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:uyt,getParams:lyt,defaultValues:C.getDefaultValues(ZDe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};var cyt=b.scale,myt=b.add,dyt=b.sub,qO={...ro,...QI,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:C.Numeric(16,{min:2,max:56,step:2},We.CustomQualityParamInfo),tryUseImpostor:C.Boolean(!0)};function YDe(e,t,r,n){return r.tryUseImpostor&&Ox(n)?fyt(e):gyt(e)}function pyt(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return Di.createEmpty(i);let s=a*2,l=kS.create(s,s/4,i),u=t.conformation,c=b(),m=b(),d=b();MZ(t,function(y,g,x,S,I){u.invariantPosition(y,c),u.invariantPosition(g,m);let A=Zi(I)?YS:qS;myt(d,c,cyt(d,dyt(d,m,c),A)),l.add(c[0],c[1],c[2],d[0],d[1],d[2],1,!1,!1,2,x),l.add(d[0],d[1],d[2],m[0],m[1],m[2],1,!1,!1,2,S)});let h=l.getCylinders(),f=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor);return h.setBoundingSphere(f),h}function fyt(e){return ZI({defaultProps:C.getDefaultValues(qO),createGeometry:pyt,createLocationIterator:t=>Cd.fromGroup(t),getLoci:Sp,eachLocation:vp,setUpdateState:(t,r,n)=>{},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function hyt(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return ft.createEmpty(i);let{radialSegments:s,sizeFactor:l}=o,u=s*2*a*2,c=et.createState(u,u/10,i),m=t.conformation,d=b(),p=b(),h={radiusTop:1,radiusBottom:1,radialSegments:s},f=K.Location.create(r,t),y=K.Location.create(r,t);MZ(t,function(I,v,A,_,T){f.element=I,y.element=v,m.invariantPosition(f.element,d),m.invariantPosition(y.element,p);let D=Zi(T)?YS:qS;h.radiusTop=h.radiusBottom=n.size.size(f)*l,c.currentGroup=A,nn(c,d,p,D,h),h.radiusTop=h.radiusBottom=n.size.size(y)*l,c.currentGroup=_,nn(c,p,d,1-D,h)});let x=et.getMesh(c),S=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor);return x.setBoundingSphere(S),x}function gyt(e){return So({defaultProps:C.getDefaultValues(qO),createGeometry:hyt,createLocationIterator:t=>Cd.fromGroup(t),getLoci:Sp,eachLocation:vp,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var YO={...ro,...WI,sizeFactor:C.Numeric(.3,{min:0,max:10,step:.01}),detail:C.Numeric(0,{min:0,max:3,step:1},We.CustomQualityParamInfo),tryUseImpostor:C.Boolean(!0)};function KDe(e,t,r,n){return r.tryUseImpostor&&GI(n)?byt(e):Cyt(e)}function yyt(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return Ts.createEmpty(i);let s=jh.create(a,a/2,i),l=t.conformation,u=b();BZ(t,(p,h)=>{l.invariantPosition(p,u),s.add(u[0],u[1],u[2],h)});let m=s.getSpheres(),d=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor);return m.setBoundingSphere(d),m}function byt(e){return XI({defaultProps:C.getDefaultValues(YO),createGeometry:yyt,createLocationIterator:t=>Cd.fromGroup(t),getLoci:Sp,eachLocation:vp,setUpdateState:(t,r,n)=>{},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function xyt(e,t,r,n,o,i){let a=t.polymerElements.length;if(!a)return ft.createEmpty(i);let{detail:s,sizeFactor:l}=o,u=a*pm(s),c=et.createState(u,u/2,i),m=t.conformation,d=b(),p=K.Location.create(r,t);BZ(t,(g,x)=>{p.element=g,m.invariantPosition(p.element,d),c.currentGroup=x,Nr(c,d,n.size.size(p)*l,s)});let f=et.getMesh(c),y=ye.expand(ye(),t.boundary.sphere,1*o.sizeFactor);return f.setBoundingSphere(y),f}function Cyt(e){return So({defaultProps:C.getDefaultValues(YO),createGeometry:xyt,createLocationIterator:t=>Cd.fromGroup(t),getLoci:Sp,eachLocation:vp,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var JDe={"polymer-backbone-cylinder":(e,t)=>Qn("Polymer backbone cylinder",e,t,YDe),"polymer-backbone-sphere":(e,t)=>Qn("Polymer backbone sphere",e,t,KDe),"polymer-gap":(e,t)=>Qn("Polymer gap cylinder",e,t,AT)},$De={...YO,...qO,...e1,sizeAspectRatio:C.Numeric(1,{min:.1,max:3,step:.1}),visuals:C.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],C.objectToOptions(JDe)),bumpFrequency:C.Numeric(0,{min:0,max:10,step:.1},We.ShadingCategory),density:C.Numeric(.1,{min:0,max:1,step:.01},We.ShadingCategory),colorMode:C.Select("default",C.arrayToOptions(["default","interpolate"]),{...We.ShadingCategory,isHidden:!0})};function Syt(e,t){let r=C.clone($De),n=!1;return t.units.forEach(o=>{!n&&o.gapElements.length&&(n=!0)}),r.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],n&&r.visuals.defaultValue.push("polymer-gap"),r}function vyt(e,t){return Vt.createMulti("Backbone",e,t,Gn,JDe)}var e3e={name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:vyt,getParams:Syt,defaultValues:C.getDefaultValues($De),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.polymerResidueCount>0};var Iyt=b.set,Ayt=b.transformMat4,Tyt=b.squaredDistance,wq={...M0e,interpolation:C.Select("nearest",C.objectToOptions(QB)),imageResolution:C.Numeric(.5,{min:.01,max:20,step:.01},{description:"Grid resolution/cell spacing.",...We.CustomQualityParamInfo}),mode:C.Select("frame",C.arrayToOptions(["frame","plane"]),{description:"Frame: slice through the structure along arbitrary axes in any step size. Plane: an arbitrary plane defined by point and normal."}),offset:C.Numeric(0,{min:-1,max:1,step:.01},{isEssential:!0,immediateUpdate:!0,hideIf:e=>e.mode!=="frame",description:"Relative offset from center."}),axis:C.Select("c",C.arrayToOptions(["a","b","c"]),{isEssential:!0,hideIf:e=>e.mode!=="frame"}),rotation:C.Group({axis:C.Vec3(b.create(1,0,0),{},{description:"Axis of rotation"}),angle:C.Numeric(0,{min:-180,max:180,step:1},{immediateUpdate:!0,description:"Axis rotation angle in Degrees"})},{isExpanded:!0,hideIf:e=>e.mode!=="frame"}),plane:C.Group({point:C.Vec3(b.create(0,0,0),{},{description:"Plane point"}),normal:C.Vec3(b.create(1,0,0),{},{description:"Plane normal"})},{isExpanded:!0,hideIf:e=>e.mode!=="plane"}),extent:C.Select("frame",C.arrayToOptions(["frame","sphere"]),{description:"Extent of the plane, either box (frame) or sphere."}),margin:C.Numeric(4,{min:0,max:50,step:1},{immediateUpdate:!0,description:"Margin around the structure in Angstrom"}),frame:C.Select("principalAxes",C.arrayToOptions(["principalAxes","boundingBox"])),antialias:C.Boolean(!0,{description:"Antialiasing of structure edges."}),cutout:C.Boolean(!1,{description:"Cutout the structure from the image."}),defaultColor:C.Color(13421772,{description:"Default color for parts of the image that are not covered by the color theme."}),includeParent:C.Boolean(!1,{description:"Show parent structure (but within extent of this structure)."})};function t3e(e){return B0e({defaultProps:C.getDefaultValues(wq),createGeometry:_yt,createLocationIterator:uo.fromStructure,getLoci:Sa,eachLocation:Ca,setUpdateState:(t,r,n,o,i)=>{t.createGeometry=r.imageResolution!==n.imageResolution||r.mode!==n.mode||r.margin!==n.margin||r.frame!==n.frame||r.extent!==n.extent||!b.equals(r.rotation.axis,n.rotation.axis)||r.rotation.angle!==n.rotation.angle||r.offset!==n.offset||r.axis!==n.axis||!b.equals(r.plane.point,n.plane.point)||!b.equals(r.plane.normal,n.plane.normal)||r.antialias!==n.antialias||r.cutout!==n.cutout||r.defaultColor!==n.defaultColor||!as.areEqual(o.color,i.color)||!yo.areEqual(o.size,i.size)}},e)}function Pyt(e,t){let{mode:r,axis:n,frame:o,extent:i,margin:a,rotation:s,plane:l,includeParent:u}=t;u&&e.child&&(e=e.child);let c=b(),m=b(),d=b(),p=b(),h=b(),f=b(),y=0,g=0,x=0,S,I,v;if(o==="principalAxes"){let T=De.getPrincipalAxes(e).boxAxes;[y,g,x]=Vi.size(b(),T),S=T.dirA,I=T.dirB,v=T.dirC,b.copy(f,T.origin)}else[y,g,x]=ut.size(b(),e.boundary.box),S=b.create(1,0,0),I=b.create(0,1,0),v=b.create(0,0,1),b.copy(f,e.boundary.sphere.center);if(b.set(m,y,g,x),n==="c"?(b.set(c,y,g,x),b.copy(d,S),b.copy(p,I),b.copy(h,v)):n==="b"?(b.set(c,y,x,g),b.copy(d,S),b.copy(h,I),b.copy(p,v)):(b.set(c,g,x,y),b.copy(h,S),b.copy(d,I),b.copy(p,v)),s.angle!==0){let T=b();b.scaleAndAdd(T,T,S,s.axis[0]),b.scaleAndAdd(T,T,I,s.axis[1]),b.scaleAndAdd(T,T,v,s.axis[2]),b.normalize(T,T);let w=Z.fromRotation(Z(),vr(s.angle),T);b.transformDirection(d,d,w),b.transformDirection(p,p,w),b.transformDirection(h,h,w)}if(i==="sphere"||s.angle!==0){let T=e.boundary.sphere.radius*2,w=b.magnitude(ut.size(b(),ut.fromSphere3D(ut(),e.boundary.sphere)));b.set(c,w,w,T),i==="sphere"&&b.set(m,T,T,T)}b.addScalar(c,c,a*2),b.addScalar(m,m,a*2);let A=Tr.identity();o==="principalAxes"&&Tr.fromBasis(A,b.normalize(b(),S),b.normalize(b(),I),b.normalize(b(),v)),r==="plane"&&(b.copy(f,l.point),b.copy(h,l.normal),b.cross(d,h,b.unitX),b.dot(d,d)<1e-6&&b.cross(d,h,b.unitY),b.normalize(d,d),b.cross(p,h,d),b.normalize(p,p));let _={type:i==="sphere"?2:3,center:f,scale:m,rotation:A,transform:Z.identity()};return{size:c,major:d,minor:p,normal:h,center:f,trim:_}}function _yt(e,t,r,n,o){let{imageResolution:i,offset:a,antialias:s,cutout:l,defaultColor:u}=n,c=1/i,m="color"in r.color&&r.color.color?r.color.color:()=>16777215,{size:d,major:p,minor:h,normal:f,center:y,trim:g}=Pyt(t,n),x=b.create(d[0],d[1],1),S=b.setMagnitude(b(),f,d[2]/2),I=Math.floor(d[1]*c),v=Math.floor(d[0]*c),A=Z.identity(),_=b(),T=b();b.add(_,y,p),Z.targetTo(A,y,_,h),b.scaleAndAdd(T,y,S,a),Z.setTranslation(A,T),Z.mul(A,A,Z.rotY90),Z.scale(A,A,x);let{getSerialIndex:w}=t.serialMapping,D=r.color.granularity.startsWith("vertex"),M=jo.fromNormalAndCoplanarPoint(jo(),b.normalize(b(),f),T),E=Z.invert(Z(),A),R=As(b(),b()),k=K.Location.create(t),{units:B}=t,L=0;for(let ie=0,oe=B.length;ie<oe;++ie){let{elements:W}=B[ie];k.unit=B[ie];for(let N=0,j=W.length;N<j;++N){k.element=W[N];let ue=r.size.size(k);ue>L&&(L=ue)}}let V=new Uint8Array(I*v*4),U=new Uint8Array(I*v*4),Q=new Float32Array(I*v);Q.fill(Number.MAX_VALUE);let O=b(),q=b(),X=b();if(D){let ie=0;for(let oe=0;oe<v;++oe)for(let W=0;W<I;++W){let N=Br(W+.5,0,I-1)/I-.5,j=Br(oe+.5,0,v-1)/v-.5;b.set(_,j,-N,0),b.transformMat4(_,_,A),b.copy(R.position,_);let ue=m(R,!1);Fe.toArray(ue,V,ie),V[ie+3]=l?0:255,ie+=4}}else for(let ie=0,oe=I*v*4;ie<oe;ie+=4)Fe.toArray(u,V,ie),V[ie+3]=l?0:255;for(let ie=0,oe=B.length;ie<oe;++ie){let W=B[ie],{elements:N,conformation:j}=W;k.unit=B[ie];for(let ue=0,be=N.length;ue<be;++ue){let ee=N[ue];k.element=ee,j.position(ee,O);let le=jo.distanceToPoint(M,O);if(Math.abs(le)>L)continue;let Ae=r.size.size(k);if(Math.abs(le)>Ae)continue;let Ce=Math.cos(Math.abs(le)/Ae),J=s?i*Ce:0,z=Ae+J/2,ae=z*z;b.scaleAndAdd(q,O,M.normal,-le),b.transformMat4(X,q,E),b.addScalar(X,X,.5);let ge=Math.floor(X[0]*v),ve=I-Math.ceil(X[1]*I),Oe=Math.ceil(Ae*c),ze=Math.max(0,ge-Oe),Re=Math.max(0,ve-Oe),Ke=Math.min(v,ge+Oe+2),tt=Math.min(I,ve+Oe+2);b.copy(R.position,q);let bt=D?u:m(k,!1),Pt=w(k.unit,k.element);for(let fr=ze;fr<Ke;++fr)for(let gt=Re;gt<tt;++gt){let Sr=Br(fr+.5,0,v-1)/v-.5,zr=Br(gt+.5,0,I-1)/I-.5;Iyt(_,Sr,-zr,0),Ayt(_,_,A);let Nn=Tyt(_,O);if(Nn>ae)continue;let xn=fr*I+gt;if(Nn<Q[xn]){let In=xn*4,zn=Math.sqrt(Nn)-Ae+J/2,hi=zn>0?1-zn/J:1;D?hi===1?Q[xn]=Nn:l&&(U[In]!==0||U[In+1]!==0||U[In+2]!==0)&&(hi=1):hi===1?(Q[xn]=Nn,Fe.toArray(bt,V,In)):l?(Fe.toArray(bt,V,In),(U[In]!==0||U[In+1]!==0||U[In+2]!==0)&&(hi=1)):Fe.toArray(Fe.interpolate(Fe.fromArray(V,In),bt,hi),V,In),df(Pt,U,In),U[In+3]=s?Math.round(255*hi):255,l&&(V[xn*4+3]=s?Math.round(255*hi):255)}}}}let F={width:I,height:v,array:V,flipY:!0},Y={width:I,height:v,array:U,flipY:!0},$={width:1,height:1,array:new Float32Array(1),flipY:!0},ce=new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]);return Pc(A,ce,0,4),hu.create(F,ce,Y,$,g,-1,o)}var r3e={"plane-image":(e,t)=>to("Plane image",e,t,t3e)},n3e={...wq,visuals:C.MultiSelect(["plane-image"],C.objectToOptions(r3e))};function Ryt(e,t){return n3e}function Dyt(e,t){return Vt.createMulti("Plane",e,t,Gn,r3e)}var o3e={name:"plane",label:"Plane",description:"Displays planes.",factory:Dyt,getParams:Ryt,defaultValues:C.getDefaultValues(n3e),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};var ET=class e extends OI{constructor(){super(),gi(e.BuiltIn,(t,r)=>{if(t.name!==r)throw new Error(`Fix BuiltInStructureRepresentations to have matching names. ${t.name} ${r}`);this.add(t)})}};(t=>t.BuiltIn={cartoon:DRe,backbone:e3e,"ball-and-stick":d_e,carbohydrate:w_e,ellipsoid:LRe,"gaussian-surface":sDe,"gaussian-volume":qDe,label:cDe,line:jDe,"molecular-surface":xDe,orientation:IDe,plane:o3e,point:PDe,putty:EDe,spacefill:BDe})(ET||={});var KO=class{constructor(t){this.plugin=t;this.currentFrame=void 0;this._isAnimating=!1;this.frame=()=>{this.tick(Mn()),this._isAnimating&&(this.currentFrame=requestAnimationFrame(this.frame))}}get isAnimating(){return this._isAnimating}async tick(t,r){if(await this.plugin.managers.animation.tick(t,r?.isSynchronous,r?.animation),this.plugin.canvas3d?.tick(t,r),He){let n=this.plugin.canvas3d?.webgl.timer.resolve();if(n)for(let o of n)sI([o])}}resetTime(t=Mn()){this.plugin.canvas3d?.resetTime(t)}start(t){this.plugin.canvas3d?.resume(),this._isAnimating=!0,this.resetTime(),t?.immediate?this.frame():this.currentFrame=requestAnimationFrame(this.frame)}stop(t){this._isAnimating=!1,this.currentFrame!==void 0&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),t?.noDraw&&this.plugin.canvas3d?.pause(t?.noDraw)}};var JO=class{constructor(t){this.plugin=t;this.ev=oc.create();this.events={updated:this.ev(),removed:this.ev()};this.root=new Map;this.tracked=new Map;t.state.data.events.object.created.subscribe(r=>{this.addMapping(r.state,r.ref,r.obj)}),t.state.data.events.object.removed.subscribe(r=>{this.removeMapping(r.ref)&&this.events.removed.next({ref:r.ref,obj:r.obj})}),t.state.data.events.object.updated.subscribe(r=>{this.updateMapping(r.state,r.ref,r.oldObj,r.obj)&&this.events.updated.next({ref:r.ref,oldObj:r.oldObj,obj:r.obj})})}getDecorator(t){let r=this.plugin.state.data.tree,n=r.children.get(t);if(n.size!==1)return t;let o=n.first();return o&&r.transforms.get(o).transformer.definition.isDecorator?this.getDecorator(o):t}get(t,r=!1){let n=this.root.get(t);if(n)return r?this.plugin.state.data.cells.get(n.ref):this.plugin.state.data.cells.get(this.getDecorator(n.ref))}addMapping(t,r,n){if(!re.Molecule.Structure.is(n))return!1;if(this.tracked.set(r,n.data),this.root.has(n.data)){let o=this.root.get(n.data);o.count++}else{let o=t.select(er.Generators.byRef(r).rootOfType([re.Molecule.Structure]))[0];o?this.root.set(n.data,{ref:o.transform.ref,count:1}):this.root.set(n.data,{ref:r,count:1})}return!0}removeMapping(t){if(!this.tracked.has(t))return!1;let r=this.tracked.get(t);this.tracked.delete(t);let n=this.root.get(r);return n.count>1?n.count--:this.root.delete(r),!0}updateMapping(t,r,n,o){return re.Molecule.Structure.is(o)?(this.removeMapping(r),this.addMapping(t,r,o),!0):!1}dispose(){this.ev.dispose()}};var MT=class{constructor(){this.ev=oc.create();this.id=0;this.runningTasks=new Set;this.abortRequests=new Map;this.options=new Map;this.currentContext=[];this.events={progress:this.ev(),finished:this.ev()}}tryGetAbortTaskId(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(let r of t.children){let n=this.tryGetAbortTaskId(r);if(n!==void 0)return n}}track(t,r){return n=>{if(n.canAbort&&n.requestAbort){let i=this.tryGetAbortTaskId(n.root);i!==void 0&&n.requestAbort(this.abortRequests.get(i))}let o=Mn()-n.root.progress.startedTime;this.events.progress.next({id:t,useOverlay:this.options.get(r)?.useOverlay,level:o<250?"none":"background",progress:n})}}async run(t,r){let n=this.id++,o;r?.createNewContext||this.currentContext.length===0?o={ctx:uae(t,this.track(n,t.id),100),refCount:1}:(o=this.currentContext[this.currentContext.length-1],o.refCount++);try{return this.options.set(t.id,{useOverlay:!!r?.useOverlay}),this.runningTasks.add(t.id),await OE(o.ctx,t)}finally{this.options.delete(t.id),this.runningTasks.delete(t.id),this.events.finished.next({id:n}),this.abortRequests.delete(t.id),o.refCount--,o.refCount===0&&_g(this.currentContext,o)}}requestAbortAll(t){this.runningTasks.forEach(r=>this.abortRequests.set(r,t))}requestAbort(t,r){let n=typeof t=="number"?t:t.root.progress.taskId;this.abortRequests.set(n,r)}dispose(){this.ev.dispose()}};(r=>{function e(n){return new Promise(o=>setTimeout(o,n))}function t(n){return Pe.create("Test",async o=>{let i=0;for(;i<n;)await e(100+Math.random()*200),o.shouldUpdate&&await o.update({message:"Step "+i,current:i,max:n,isIndeterminate:!1}),i++})}r.testTask=t})(MT||={});var $O=class extends Bs{constructor(r){super({entries:Us()});this.events={changed:this.ev()};this.serialNumber=0;this.serialId=0;st.Toast.Show.subscribe(r,n=>this.show(n)),st.Toast.Hide.subscribe(r,n=>this.hide(this.findByKey(n.key)))}findByKey(r){return this.state.entries.find(n=>!!n&&n.key===r)}show(r){let n=this.state.entries,o,i=++this.serialId,a;r.key&&(o=this.findByKey(r.key))?(o.timeout!==void 0&&clearTimeout(o.timeout),a=o.serialNumber,n=n.remove(o.id)):a=++this.serialNumber,o={id:i,serialNumber:a,key:r.key,title:r.title,message:r.message,timeout:this.timeout(i,r.timeoutMs),hide:()=>this.hideId(i)},this.updateState({entries:n.set(i,o)})&&this.events.changed.next(void 0)}timeout(r,n){if(n!==void 0)return n<0&&(n=500),setTimeout(()=>{let o=this.state.entries.get(r);o.timeout=void 0,this.hide(o)},n)}hideId(r){this.hide(this.state.entries.get(r))}hide(r){r&&(r.timeout!==void 0&&clearTimeout(r.timeout),r.hide=void 0,this.updateState({entries:this.state.entries.delete(r.id)})&&this.events.changed.next(void 0))}};function wyt(){let e=document.createElement("canvas");return e.getContext&&e.getContext("2d")?e.toDataURL("image/webp").indexOf("data:image/webp")===0:!1}var eG=class extends ic{constructor(r){super();this.plugin=r;this._params=void 0;this.behaviors={values:this.ev.behavior({transparent:this.params.transparent.defaultValue,format:{name:"png",params:{}},axes:{name:"off",params:{}},resolution:this.params.resolution.defaultValue,illumination:this.params.illumination.defaultValue}),cropParams:this.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:this.ev.behavior({x:0,y:0,width:1,height:1})};this.events={previewed:this.ev()};this.canvas=function(){return document.createElement("canvas")}();this.previewCanvas=function(){return document.createElement("canvas")}();this.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:0,transparent:!1}}createParams(){let r=8192;if(this.plugin.canvas3d){let{webgl:n}=this.plugin.canvas3d;r=Math.floor(Math.min(n.maxRenderbufferSize,n.maxTextureSize)/2)}return{resolution:C.MappedStatic("viewport",{viewport:C.Group({}),hd:C.Group({}),"full-hd":C.Group({}),"ultra-hd":C.Group({}),custom:C.Group({width:C.Numeric(1920,{min:128,max:r,step:1}),height:C.Numeric(1080,{min:128,max:r,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),format:C.MappedStatic("png",{png:C.Group({}),webp:C.Group({quality:C.Numeric(.9,{min:0,max:1,step:.01})}),jpeg:C.Group({quality:C.Numeric(.9,{min:0,max:1,step:.01})})},{options:[["png","PNG"],["jpeg","JPEG"],...wyt()?[["webp","WebP"]]:[]]}),transparent:C.Boolean(!1),axes:qx.axes,illumination:C.Group({extraIterations:C.Numeric(1,{min:0,max:5,step:1}),targetIterationTimeMs:C.Numeric(300,{min:100,max:3e3,step:10})})}}get params(){return this._params?this._params:this._params=this.createParams()}get values(){return this.behaviors.values.value}get cropParams(){return this.behaviors.cropParams.value}get relativeCrop(){return this.behaviors.relativeCrop.value}getCanvasSize(){return{width:this.plugin.canvas3d?.webgl.gl.drawingBufferWidth||0,height:this.plugin.canvas3d?.webgl.gl.drawingBufferHeight||0}}getSize(){let r=this.values;switch(r.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:r.resolution.params.width,height:r.resolution.params.height}}}getPostprocessingProps(){let r=this.plugin.canvas3d,n=r.props.postprocessing.occlusion;return{...r.props.postprocessing,occlusion:n.name==="on"?{name:"on",params:{...n.params,samples:128,resolutionScale:r.webgl.pixelRatio,transparentThreshold:1}}:n}}getIlluminationProps(r){let o=this.plugin.canvas3d.props.illumination,{extraIterations:i,targetIterationTimeMs:a}=this.values.illumination;return{...o,enabled:r?!1:o.enabled,maxIterations:Math.ceil(Math.log2(Math.pow(2,o.maxIterations+i)*o.rendersPerFrame[1])),targetFps:1e3/a,denoiseThreshold:[o.denoiseThreshold[0],o.denoiseThreshold[0]],rendersPerFrame:[1,1]}}createPass(r){let n=this.plugin.canvas3d,{colorBufferFloat:o,textureFloat:i}=n.webgl.extensions;return n.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{...n.props.multiSample,mode:r?"off":"on",sampleLevel:o&&i?4:2,reuseOcclusion:!1},postprocessing:this.getPostprocessingProps(),marking:{...n.props.marking},illumination:this.getIlluminationProps(r)})}get previewPass(){return this._previewPass||(this._previewPass=this.createPass(!0))}get imagePass(){if(this._imagePass){let r=this.plugin.canvas3d;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:this.getPostprocessingProps(),marking:{...r.props.marking},illumination:this.getIlluminationProps(!1)}),this._imagePass}return this._imagePass=this.createPass(!1)}getFilename(r){typeof r!="string"&&(r=this.extension);let n=this.plugin.state.data.select(er.Generators.rootsOfType(re.Molecule.Model)).map(a=>a.obj.data),o=new Set;return n.forEach(a=>o.add(a.entryId.toUpperCase())),`${no.toArray(o).join("-")||"molstar-image"}${r}`}resetCrop(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})}toggleAutocrop(){this.cropParams.auto?(this.behaviors.cropParams.next({...this.cropParams,auto:!1}),this.resetCrop()):this.behaviors.cropParams.next({...this.cropParams,auto:!0})}get isFullFrame(){let r=this.relativeCrop;return eo(r.x,0,1e-5)&&eo(r.y,0,1e-5)&&eo(r.width,1,1e-5)&&eo(r.height,1,1e-5)}autocrop(r=this.cropParams.relativePadding){let{data:n,width:o,height:i}=this.previewData.image,a=this.previewData.transparent,s=a?this.previewData.background:4278190080|this.previewData.background,l=o,u=0,c=i,m=0;for(let f=0;f<i;f++){let y=f*o;for(let g=0;g<o;g++){let x=4*(y+g);if(a){if(n[x+3]===0)continue}else if((n[x]<<16|n[x+1]<<8|n[x+2]|n[x+3]<<24)===s)continue;g<l&&(l=g),g>u&&(u=g),f<c&&(c=f),f>m&&(m=f)}}if(l>u){let f=l;l=u,u=f}if(c>m){let f=c;c=m,m=f}let d=u-l+1,p=m-c+1;l-=r*d,u+=r*d,c-=r*p,m+=r*p;let h={x:Math.max(0,l/o),y:Math.max(0,c/i),width:Math.min(1,(u-l+1)/o),height:Math.min(1,(m-c+1)/i)};this.behaviors.relativeCrop.next(h)}async getPreview(r,n=320){let{width:o,height:i}=this.getSize();if(o<=0||i<=0)return;let a=o/i,s=0,l=0;a>1?(s=n,l=Math.round(n/a)):(l=n,s=Math.round(n*a));let u=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:u.postprocessing,marking:u.marking});let c=await this.previewPass.getImageData(r,s,l),m=this.previewCanvas;m.width=c.width,m.height=c.height,this.previewData.image=c,this.previewData.background=u.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;let d=m.getContext("2d");if(!d)throw new Error("Could not create canvas 2d context");return d.putImageData(c,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(void 0),{canvas:m,width:s,height:l}}getSizeAndViewport(){let{width:r,height:n}=this.getSize(),o=this.relativeCrop,i={x:Math.floor(o.x*r),y:Math.floor(o.y*n),width:Math.ceil(o.width*r),height:Math.ceil(o.height*n)};return i.width+i.x>r&&(i.width=r-i.x),i.height+i.y>n&&(i.height=n-i.y),{width:r,height:n,viewport:i}}async draw(r){let{width:n,height:o,viewport:i}=this.getSizeAndViewport();if(!(n<=0||o<=0)){this.plugin.canvas3d?.pause(!0);try{await r.update("Rendering image...");let a=this.imagePass;await a.updateBackground();let s=await a.getImageData(r,n,o,i);await r.update("Encoding image...");let l=this.canvas;l.width=s.width,l.height=s.height;let u=l.getContext("2d");if(!u)throw new Error("Could not create canvas 2d context");u.putImageData(s,0,0)}finally{this.plugin.canvas3d?.animate()}}}copyToClipboardTask(){let r=navigator.clipboard;if(!r?.write){this.plugin.log.error("clipboard.write not supported!");return}return Pe.create("Copy Image",async n=>{await this.draw(n),await n.update("Converting image...");let o=this.mimeType,i=await Z_(this.canvas,o,this.quality),a=new ClipboardItem({[o]:i});await r.write([a]),this.plugin.log.message("Image copied to clipboard.")})}get mimeType(){return`image/${this.values.format?.name??"png"}`}get extension(){switch(this.values.format?.name){case"jpeg":return".jpg";default:return`.${this.values.format?.name??"png"}`}}get quality(){switch(this.values.format?.name){case"webp":case"jpeg":return this.values.format?.params?.quality??.9;default:return}}getImageDataUri(){return this.plugin.runTask(Pe.create("Generate Image",async r=>(await this.draw(r),await r.update("Converting image..."),this.canvas.toDataURL(this.mimeType))))}copyToClipboard(){let r=this.copyToClipboardTask();if(r)return this.plugin.runTask(r)}downloadTask(r){return Pe.create("Download Image",async n=>{await this.draw(n),await n.update("Downloading image...");let o=await Z_(this.canvas,this.mimeType,this.quality);DA(o,r??this.getFilename(this.extension))})}download(r){return this.plugin.runTask(this.downloadTask(r),{useOverlay:!0})}};var tG=class{constructor(t){this.plugin=t;this.handlers=[]}addHandler(t,r){let n=this.handlers.findIndex(o=>o[0]===t);n<0?this.handlers.push([t,r]):this.handlers[n][1]=r}removeHandler(t){let r=this.handlers.findIndex(n=>n[0]===t);r>=0&&this.handlers.splice(r,1)}async handle(t){for(let r=this.handlers.length-1;r>=0;r--){let n=this.handlers[r][1];if(await n(t,this.plugin))return}Eyt(this.plugin,t)}dispose(){this.handlers.length=0}};function Eyt(e,t){let r=t.filter(n=>{let o=n.name.toLowerCase();return o.endsWith(".molx")||o.endsWith(".molj")});r.length>0?st.State.Snapshots.OpenFile(e,{file:r[0]}):e.runTask(e.state.data.applyAction(XR,{files:t.map(n=>Zr.File(n)),format:{name:"auto",params:{}},visuals:!0}))}var rG=class{constructor(){this.errors=Object.create(null)}get(t){return this.errors[t]??[]}add(t,r){t in this.errors&&Array.isArray(this.errors[t])?this.errors[t].push(r):this.errors[t]=[r]}clear(t){delete this.errors[t]}};var nG=class{constructor(t){this.options=t;let r=document.createElement("div");Object.assign(r.style,{position:"absolute",left:0,top:0,right:0,bottom:0,"-webkit-user-select":"none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none","touch-action":"manipulation"});let n=t?.canvas;n||(n=document.createElement("canvas"),t?.checkeredCanvasBackground&&Object.assign(n.style,{"background-image":"linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey), linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey)","background-size":"60px 60px","background-position":"0 0, 30px 30px"}),r.appendChild(n)),this.canvas=n,this.parent=r}mount(t){this.parent.parentElement!==t&&this.parent.parentElement?.removeChild(this.parent),t.appendChild(this.parent)}unmount(){this.parent.parentElement?.removeChild(this.parent)}};var oG=class{constructor(t){this.spec=t;this.runTask=(t,r)=>this.managers.task.run(t,r);this.resolveTask=t=>{if(t)return Pe.is(t)?this.runTask(t):t};this.subs=[];this.initCanvas3dPromiseCallbacks=[()=>{},()=>{}];this._isInitialized=!1;this.initializedPromiseCallbacks=[()=>{},()=>{}];this.disposed=!1;this.container=void 0;this.ev=oc.create();this.config=new uF(this.spec.config);this.state=new gC(this);this.commands=new uL;this.canvas3dInit=this.ev.behavior(!1);this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:Vt.Loci.Empty,modifiers:Ql.None,buttons:0,button:0}),click:this.ev.behavior({current:Vt.Loci.Empty,modifiers:Ql.None,buttons:0,button:0}),drag:this.ev.behavior({current:Vt.Loci.Empty,modifiers:Ql.None,buttons:0,button:0,pageStart:Ie(),pageEnd:Ie()}),key:this.ev.behavior(l8),keyReleased:this.ev.behavior(l8),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(zf(t=>!!t),vG(1))}};this.canvas3dInitialized=new Promise((t,r)=>{this.initCanvas3dPromiseCallbacks=[t,r]});this.initialized=new Promise((t,r)=>{this.initializedPromiseCallbacks=[t,r]});this.layout=new JV(this);this.animationLoop=new KO(this);this.representation={structure:{registry:new ET,themes:{colorThemeRegistry:as.createRegistry(),sizeThemeRegistry:yo.createRegistry()}},volume:{registry:new fC,themes:{colorThemeRegistry:as.createRegistry(),sizeThemeRegistry:yo.createRegistry()}}};this.query={structure:{registry:new Gk}};this.dataFormats=new jV;this.builders={data:new VV(this),structure:void 0};this.helpers={substructureParent:new JO(this),viewportScreenshot:void 0};this.managers={structure:{hierarchy:new ig(this),component:new gp(this),measurement:new HF(this),selection:new qV(this),focus:new YV(this)},volume:{hierarchy:new uC(this)},interactivity:void 0,camera:new QV(this),animation:new WV(this),snapshot:new pp(this),lociLabels:void 0,toast:new $O(this),asset:new WE,task:new MT,markdownExtensions:new KV(this),dragAndDrop:new tG(this)};this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}};this.customModelProperties=new FV.Registry;this.customStructureProperties=new FV.Registry;this.customStructureControls=new Map;this.customImportControls=new Map;this.genericRepresentationControls=new Map;this.errorContext=new rG;this.customState=Object.create(null);this.handleResize=()=>{let t=this.canvas3dContext?.canvas,r=this.layout.root;r&&t&&(iSe(t,r,this.canvas3dContext.pixelScale),this.canvas3dContext.syncPixelScale(),this.canvas3d?.requestResize())};this.log={entries:ah(),entry:t=>this.events.log.next(t),error:t=>this.events.log.next(nf.error(t)),message:t=>this.events.log.next(nf.message(t)),info:t=>this.events.log.next(nf.info(t)),warn:t=>this.events.log.next(nf.warning(t))};this.fetch=w2;$ae(!1),gse(this.config.get(Lr.Structure.SaccharideCompIdMapType)??"default")}get isInitialized(){return this._isInitialized}build(){return this.state.data.build()}async initViewerAsync(t,r,n){return this._initViewer(t,r,n)}async initContainerAsync(t){return this._initContainer(t)}async mountAsync(t,r){return this._mount(t,r)}_initContainer(t){if(this.container)return!0;let r=new nG({checkeredCanvasBackground:t?.checkeredCanvasBackground,canvas:t?.canvas3dContext?.canvas});return this._initViewer(r.canvas,r.parent,t?.canvas3dContext)?(this.container=r,!0):!1}_mount(t,r){if(this.disposed)throw new Error("Cannot mount a disposed context");return this._initContainer(r)?(this.container?.mount(t),this.handleResize(),!0):!1}unmount(){this.container?.unmount()}_initViewer(t,r,n){try{this.layout.setRoot(r),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n||(n=Tf.fromCanvas(t,this.managers.asset,{antialias:!(this.config.get(Lr.General.DisableAntialiasing)??!1),preserveDrawingBuffer:!(this.config.get(Lr.General.DisablePreserveDrawingBuffer)??!1),preferWebGl1:this.config.get(Lr.General.PreferWebGl1)||!1,failIfMajorPerformanceCaveat:!(this.config.get(Lr.General.AllowMajorPerformanceCaveat)??!1),powerPreference:this.config.get(Lr.General.PowerPreference)||"high-performance",handleResize:this.handleResize},{pixelScale:this.config.get(Lr.General.PixelScale)||1,pickScale:this.config.get(Lr.General.PickScale)||.25,transparency:this.config.get(Lr.General.Transparency)||"wboit",resolutionMode:this.config.get(Lr.General.ResolutionMode)||"auto"})),this.canvas3dContext=n,this.canvas3d=A8.create(this.canvas3dContext),this.canvas3dInit.next(!0);let o=this.spec.canvas3d,i=16579577;return o?(o.renderer?.backgroundColor===void 0&&(o=su(o,a=>{a.renderer?a.renderer.backgroundColor=i:a.renderer={backgroundColor:i}})),this.canvas3d?.setProps(o)):this.canvas3d?.setProps({renderer:{backgroundColor:i}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new eG(this),this.subs.push(this.canvas3d.interaction.click.subscribe(a=>this.behaviors.interaction.click.next(a))),this.subs.push(this.canvas3d.interaction.drag.subscribe(a=>this.behaviors.interaction.drag.next(a))),this.subs.push(this.canvas3d.interaction.hover.subscribe(a=>this.behaviors.interaction.hover.next(a))),this.subs.push(this.canvas3d.input.resize.pipe($y(50),Cu(100,void 0,{leading:!1,trailing:!0})).subscribe(()=>this.handleResize())),this.subs.push(this.canvas3d.input.keyDown.subscribe(a=>this.behaviors.interaction.key.next(a))),this.subs.push(this.canvas3d.input.keyUp.subscribe(a=>this.behaviors.interaction.keyReleased.next(a))),this.subs.push(this.layout.events.updated.subscribe(()=>requestAnimationFrame(()=>this.handleResize()))),this.handleResize(),$g.setImmediate(()=>this.initCanvas3dPromiseCallbacks[0]()),!0}catch(o){return this.log.error(""+o),console.error(o),$g.setImmediate(()=>this.initCanvas3dPromiseCallbacks[1](o)),!1}}get isBusy(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value}get selectionMode(){return this.behaviors.interaction.selectionMode.value}set selectionMode(t){this.behaviors.interaction.selectionMode.next(t)}dataTransaction(t,r){return this.runTask(this.state.data.transaction(t,r))}clear(t=!1){return t&&this.canvas3d?.setProps(eR),st.State.RemoveObject(this,{state:this.state.data,ref:Ar.RootRef})}dispose(t){if(!this.disposed){for(let r of this.subs)r.unsubscribe();this.subs=[],this.animationLoop.stop(),this.commands.dispose(),this.canvas3d?.dispose(),t?.doNotDisposeCanvas3DContext||this.canvas3dContext?.dispose(t),this.ev.dispose(),this.state.dispose(),this.helpers.substructureParent.dispose(),gi(this.managers,r=>r?.dispose?.()),gi(this.managers.structure,r=>r?.dispose?.()),gi(this.managers.volume,r=>r?.dispose?.()),this.unmount(),this.container=void 0,this.customState={},this.disposed=!0}}initBehaviorEvents(){this.subs.push(jc(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(a=>{this.behaviors.state.isUpdating.value!==a&&this.behaviors.state.isUpdating.next(a)}));let t=this.config.get(Lr.General.IsBusyTimeoutMs)||750,r=this.behaviors.state.isBusy,n,o=()=>{r.value||r.next(!0)},i=()=>{n!==void 0&&clearTimeout(n),n=void 0};this.subs.push(jc(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(a=>{let s=this.behaviors.state.isUpdating.value,l=this.behaviors.state.isAnimating.value;s||l?r.value||(i(),n=setTimeout(o,t)):(i(),r.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(a=>{a||this.managers.interactivity?.lociSelects.deselectAll()}))}initBuiltInBehavior(){IR.State.registerDefault(this),IR.Representation.registerDefault(this),IR.Camera.registerDefault(this),IR.Misc.registerDefault(this),this.subs.push(jc(this.state.data.events.log,this.state.behaviors.events.log).subscribe(t=>this.events.log.next(t)))}async initBehaviors(){let t=this.state.behaviors.build();for(let r of Object.keys(qr.Categories))t.toRoot().apply(qr.CreateCategory,{label:qr.Categories[r]},{ref:r,state:{isLocked:!0}});for(let r of this.spec.behaviors)qr.getCategoryId(r.transformer)==="custom-props"&&t.to(qr.getCategoryId(r.transformer)).apply(r.transformer,r.defaultParams,{ref:r.transformer.id});await this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0})),t=this.state.behaviors.build();for(let r of this.spec.behaviors)qr.getCategoryId(r.transformer)!=="custom-props"&&t.to(qr.getCategoryId(r.transformer)).apply(r.transformer,r.defaultParams,{ref:r.transformer.id});await this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))}initCustomFormats(){if(this.spec.customFormats)for(let t of this.spec.customFormats)this.dataFormats.add(t[0],t[1])}initAnimations(){if(this.spec.animations)for(let t of this.spec.animations)this.managers.animation.register(t)}initDataActions(){if(this.spec.actions)for(let t of this.spec.actions)this.state.data.actions.add(t.action)}async init(){try{this.subs.push(this.events.log.subscribe(t=>this.log.entries=this.log.entries.push(t))),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new sC(this),this.managers.lociLabels=new ZV(this),this.builders.structure=new zV(this),this.initAnimations(),this.initDataActions(),await this.initBehaviors(),this.log.message(`Mol* Plugin ${Q_} [${oSe.toLocaleString()}]`),Yb||this.log.message("Development mode enabled"),$t&&this.log.message("Debug mode enabled"),this._isInitialized=!0,this.initializedPromiseCallbacks[0]()}catch(t){throw this.initializedPromiseCallbacks[1](t),t}}};var iG=class extends oG{constructor(r){super(r);this.spec=r;this.customParamEditors=new Map;this.initCustomParamEditors()}initCustomParamEditors(){if(this.spec.customParamEditors)for(let[r,n]of this.spec.customParamEditors)this.customParamEditors.set(r.id,n)}dispose(r){super.dispose(r),this.layout.dispose()}};var zc;(r=>{function e(n){return n}r.create=e;function t(n,o){if(o.customDurationMs)return o.customDurationMs;let i=o.definition.getDuration?.(o.params,n);if(i?.kind==="fixed")return i.durationMs}r.getDuration=t})(zc||={});var i3e=zc.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:e=>{let t=[["all","All"]],r=e.state.data.select(er.Generators.rootsOfType(re.Molecule.Structure));for(let n of r)t.push([n.transform.ref,n.obj.data.models[0].label]);return{durationInMs:C.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:C.Boolean(!1),target:C.Select(t[0][0],t)}},canApply(e){let t=e.state.data,r=Ar.RootRef;return{canApply:t.select(er.Generators.ofType(re.Molecule.Structure.Representation3D,r)).length>0}},getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),initialState:()=>({t:0}),setup(e,t,r){let n=r.state.data,o=!e.target||e.target==="all"?Ar.RootRef:e.target,i=n.select(er.Generators.ofType(re.Molecule.Structure.Representation3D,o)),a=n.build(),s=!1;for(let l of i)n.select(er.Generators.ofTransformer(Xe.Representation.UnwindStructureAssemblyRepresentation3D,l.transform.ref)).length>0||(s=!0,a.to(l).apply(Xe.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}));if(s)return a.commit({doNotUpdateCurrent:!0})},teardown(e,t,r){let n=r.state.data,o=n.select(er.Generators.ofType(re.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(o.length===0)return;let i=n.build();for(let a of o)i.delete(a.transform.ref);return i.commit()},async apply(e,t,r){let n=r.plugin.state.data,o=!r.params.target||r.params.target==="all"?Ar.RootRef:r.params.target,i=n.select(er.Generators.ofTransformer(Xe.Representation.UnwindStructureAssemblyRepresentation3D,o));if(i.length===0)return{kind:"finished"};let a=n.build(),s=(t.current-t.lastApplied)/r.params.durationInMs,l=e.t+s,u=!1;r.params.playOnce&&l>=1?(u=!0,l=1):l=l%1;for(let c of i)a.to(c).update({t:l});return await st.State.Update(r.plugin,{state:n,tree:a,options:{doNotLogTiming:!0}}),u?{kind:"finished"}:{kind:"next",state:{t:l}}}});var aG=b(),a3e=b(),s3e=Tr(),l3e=zc.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin",description:"Spin the 3D scene around the x-axis in view space"},isExportable:!0,params:()=>({durationInMs:C.Numeric(4e3,{min:100,max:2e4,step:100}),speed:C.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified duration."}),direction:C.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}),initialState:(e,t)=>({snapshot:t.canvas3d?.camera.getSnapshot()}),getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),teardown:(e,t,r)=>{r.canvas3d?.requestCameraReset({snapshot:t.snapshot,durationMs:0})},async apply(e,t,r){if(t.current===0)return{kind:"next",state:e};let n=e.snapshot;if(n.radiusMax<1e-4)return{kind:"finished"};let o=t.animation?t.animation?.currentFrame/(t.animation.frameCount+1):Br(t.current/r.params.durationInMs,0,1),i=2*Math.PI*o*r.params.speed*(r.params.direction==="ccw"?-1:1);b.sub(aG,n.position,n.target),b.normalize(a3e,n.up),Tr.setAxisAngle(s3e,a3e,i),b.transformQuat(aG,aG,s3e);let a=b.add(b(),n.target,aG);return r.plugin.canvas3d?.requestCameraReset({snapshot:{...n,position:a},durationMs:0}),o>=.99999?{kind:"finished"}:{kind:"next",state:e}}});var u3e=zc.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:()=>({mode:C.MappedStatic("loop",{palindrome:C.Group({}),loop:C.Group({direction:C.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:C.Group({direction:C.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:C.MappedStatic("fixed",{fixed:C.Group({durationInS:C.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:C.Group({targetFps:C.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:C.Group({maxFps:C.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}),canApply(e){let t=e.state.data,r=t.select(er.Generators.ofTransformer(Xe.Model.ModelFromTrajectory));for(let n of r){let o=er.findAncestorOfType(t.tree,t.cells,n.transform.ref,re.Molecule.Trajectory);if(o&&o.obj&&o.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:(e,t)=>{if(e.duration?.name==="fixed")return{kind:"fixed",durationMs:e.duration.params.durationInS*1e3};if(e.duration.name==="computed"){let r=t.state.data,n=r.select(er.Generators.ofTransformer(Xe.Model.ModelFromTrajectory)),o=0;for(let i of n){let a=er.findAncestorOfType(r.tree,r.cells,i.transform.ref,re.Molecule.Trajectory);if(!a||!a.obj)continue;let s=a.obj;o=Math.max(Math.ceil(1e3*s.data.frameCount/e.duration.params.targetFps),o)}return{kind:"fixed",durationMs:o}}return{kind:"unknown"}},initialState:()=>({}),async apply(e,t,r){if(r.params.duration.name==="sequential"&&t.current>0&&t.current-t.lastApplied<1e3/r.params.duration.params.maxFps)return{kind:"skip"};let n=r.plugin.state.data,o=n.select(er.Generators.ofTransformer(Xe.Model.ModelFromTrajectory));if(o.length===0)return{kind:"finished"};let i=n.build(),a=r.params,s=e.palindromeDirections||{},l=!1,u=!0;for(let c of o){let m=er.findAncestorOfType(n.tree,n.cells,c.transform.ref,re.Molecule.Trajectory);if(!m||!m.obj)continue;let d=m.obj;d.data.frameCount<=1||i.to(c).update(p=>{let h=d.data.frameCount;if(h!==1)u=!1;else return p;if(a.duration.name==="sequential"){let f=1;if(a.mode.name==="once"){if(f=a.mode.params.direction==="backward"?-1:1,f===-1&&p.modelIndex===0||f===1&&p.modelIndex===h-1)return l=!0,p}else a.mode.name==="palindrome"&&(p.modelIndex===0?f=1:p.modelIndex===h-1?f=-1:f=s[c.transform.ref]||1);s[c.transform.ref]=f;let y=(p.modelIndex+f)%h;return y<0&&(y+=h),l=l||f===-1&&y===0||f===1&&y===h-1,{modelIndex:y}}else{let f=a.duration.name==="fixed"?a.duration.params.durationInS*1e3:Math.ceil(1e3*d.data.frameCount/a.duration.params.targetFps);if(a.mode.name==="once"&&t.current>=f)return l=!0,{modelIndex:d.data.frameCount-1};let y=t.current%f/f;return a.mode.name==="loop"&&a.mode.params.direction==="backward"&&(y=1-y),a.mode.name==="palindrome"&&(y=2*y,y>1&&(y=2-y)),{modelIndex:Math.min(Math.floor(d.data.frameCount*y),d.data.frameCount-1)}}})}return u||await st.State.Update(r.plugin,{state:n,tree:i,options:{doNotLogTiming:!0}}),u||a.mode.name==="once"&&l?{kind:"finished"}:a.mode.name==="palindrome"?{kind:"next",state:{palindromeDirections:s}}:{kind:"next",state:{}}}});async function c3e(e,t,r=!1){t.snapshot.data&&(await e.runTask(e.state.data.setSnapshot(t.snapshot.data)),e.canvas3d?.setProps({trackball:t.snapshot.canvas3d?.props?.trackball})),t.snapshot.camera?.current?e.canvas3d?.requestCameraReset({snapshot:t.snapshot.camera.current,durationMs:r||t.snapshot.camera.transitionStyle==="instant"?0:t.snapshot.camera.transitionDurationInMs}):t.snapshot.camera?.focus&&e.managers.camera.focusObject({...t.snapshot.camera.focus,durationMs:r||t.snapshot.camera.transitionStyle==="instant"?0:t.snapshot.camera.transitionDurationInMs})}var m3e=zc.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:()=>({}),canApply(e){let t=e.managers.snapshot.state.entries;return t.size<2?{canApply:!1,reason:"At least 2 states required."}:t.some(r=>!!r?.snapshot.startAnimation)?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>1}},setup(e,t,r){let n=r.managers.snapshot.state.entries.get(0);c3e(r,n,!0)},getDuration:(e,t)=>({kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce((r,n)=>r+(n.snapshot.durationInMs??0),0)}),initialState:(e,t)=>{let r=t.managers.snapshot.state.entries.toArray();return{totalDuration:r.reduce((n,o)=>n+(o.snapshot.durationInMs??0),0),snapshots:r,currentIndex:0}},async apply(e,t,r){if(t.current>=e.totalDuration)return{kind:"finished"};let n=0,o=0;for(let i of e.snapshots){if(n+=i.snapshot.durationInMs??0,t.current<n)break;o++}return o>=e.snapshots.length?{kind:"finished"}:o===e.currentIndex?{kind:"skip"}:(await c3e(r.plugin,e.snapshots[o]),{kind:"next",state:{...e,currentIndex:o}})}});var Mq={};Bi(Mq,{AssignColorVolume:()=>Eq,DownloadDensity:()=>Myt});var Myt=Ss.build({from:re.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:(e,t)=>{let{options:r}=t.dataFormats;return{source:C.MappedStatic("pdb-xray",{"pdb-xray":C.Group({provider:C.Group({id:C.Text("1tqn",{label:"Id"}),server:C.Select("pdbe",[["pdbe","PDBe"]])},{pivot:"id"}),type:C.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":C.Group({provider:C.Group({id:C.Text("1tqn",{label:"Id"}),server:C.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:C.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":C.Group({provider:C.Group({id:C.Text("emd-8004",{label:"Id"}),server:C.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:C.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:C.Group({url:C.Url(""),isBinary:C.Boolean(!1),format:C.Select("auto",r)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(({params:e},t)=>Pe.create("Download Density",async r=>{let n=e.source,o,i;switch(n.name){case"url":o=n.params;break;case"pdb-xray":o={url:Zr.Url(n.params.type==="2fofc"?`https://www.ebi.ac.uk/pdbe/coordinates/files/${n.params.provider.id.toLowerCase()}.ccp4`:`https://www.ebi.ac.uk/pdbe/coordinates/files/${n.params.provider.id.toLowerCase()}_diff.ccp4`),isBinary:!0,label:`PDBe X-ray map: ${n.params.provider.id}`};break;case"pdb-emd-ds":o=n.params.provider.server==="pdbe"?{url:Zr.Url(`https://www.ebi.ac.uk/pdbe/densities/emd/${n.params.provider.id.toLowerCase()}/cell?detail=${n.params.detail}`),isBinary:!0,label:`PDBe EMD Density Server: ${n.params.provider.id}`}:{url:Zr.Url(`https://maps.rcsb.org/em/${n.params.provider.id.toLowerCase()}/cell?detail=${n.params.detail}`),isBinary:!0,label:`RCSB PDB EMD Density Server: ${n.params.provider.id}`};break;case"pdb-xray-ds":o=n.params.provider.server==="pdbe"?{url:Zr.Url(`https://www.ebi.ac.uk/pdbe/densities/x-ray/${n.params.provider.id.toLowerCase()}/cell?detail=${n.params.detail}`),isBinary:!0,label:`PDBe X-ray Density Server: ${n.params.provider.id}`}:{url:Zr.Url(`https://maps.rcsb.org/x-ray/${n.params.provider.id.toLowerCase()}/cell?detail=${n.params.detail}`),isBinary:!0,label:`RCSB PDB X-ray Density Server: ${n.params.provider.id}`};break;default:Rr(n)}let a=await t.builders.data.download(o),s;switch(n.name){case"url":o=n.params,i=n.params.format==="auto"?t.dataFormats.auto(Hy(Zr.getUrl(o.url)),a.cell?.obj):t.dataFormats.get(n.params.format);break;case"pdb-xray":s=n.params.provider.id,i=t.dataFormats.get("ccp4");break;case"pdb-emd-ds":case"pdb-xray-ds":s=n.params.provider.id,i=t.dataFormats.get("dscif");break;default:Rr(n)}if(!i){t.log.warn("DownloadDensity: Format provider not found.");return}let l=await i.parse(t,a,{entryId:s});await i.visuals?.(t,l)})),Eq=Ss.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:re.Volume.Data,isApplicable(e){return!e.data.colorVolume},params(e,t){let r=t.state.data.select(er.Generators.root.subtree().ofType(re.Volume.Data).filter(n=>!!n.obj&&!n.obj?.data.colorVolume&&n.obj!==e));return r.length===0?{ref:C.Text("",{isHidden:!0,label:"Volume"})}:{ref:C.Select(r[0].transform.ref,r.map(n=>[n.transform.ref,n.obj.label]),{label:"Volume"})}}})(({ref:e,params:t,state:r},n)=>n.build().to(e).apply(Xe.Volume.AssignColorVolume,{ref:t.ref},{dependsOn:[t.ref]}).commit());var DC={Structure:CX,Volume:Mq,DataFormat:rZ};var d3e=zc.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:()=>({transtionDurationInMs:C.Numeric(2e3,{min:100,max:3e4,step:10})}),canApply(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:()=>({}),async apply(e,t,r){let n=r.plugin.managers.snapshot.state.entries;if(n.size<2)return{kind:"finished"};let o=t.current%r.params.transtionDurationInMs/r.params.transtionDurationInMs,i=Math.floor(t.current/r.params.transtionDurationInMs)%n.size,a=Math.ceil(t.current/r.params.transtionDurationInMs);a===i&&a++,a=a%n.size;let s=n.get(i).snapshot,l=n.get(a).snapshot;if(!s.data||!l.data)return{kind:"skip"};let u=s.data.tree.transforms,c=l.data.tree.transforms,m=r.plugin.state.data,d=m.build();for(let p of u)for(let h of c){if(h.ref!==p.ref||h.version===p.version)continue;let f=Ar.fromJSON(p),y=Ar.fromJSON(h),g=m.cells.get(p.ref);if(!g)continue;let x;f.transformer.definition.interpolate?x=f.transformer.definition.interpolate(f.params,y.params,o,r.plugin):x=o<=.5?f.params:y.params,Ng(g,x)||d.to(p.ref).update(x)}return await st.State.Update(r.plugin,{state:m,tree:d,options:{doNotLogTiming:!0}}),{kind:"next",state:{}}}});var p3e=zc.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:()=>({durationInMs:C.Numeric(3e3,{min:100,max:1e4,step:100})}),initialState:()=>({t:0}),getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),async setup(e,t,r){let n=r.state.data,o=n.select(er.Generators.ofType(re.Molecule.Structure.Representation3D)),i=n.build(),a=!1;for(let s of o)n.select(er.Generators.ofTransformer(Xe.Representation.SpinStructureRepresentation3D,s.transform.ref)).length>0||(a=!0,i.to(s.transform.ref).apply(Xe.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));if(a)return i.commit({doNotUpdateCurrent:!0})},teardown(e,t,r){let n=r.state.data,o=n.select(er.Generators.ofType(re.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(o.length===0)return;let i=n.build();for(let a of o)i.delete(a.transform.ref);return i.commit()},async apply(e,t,r){let n=r.plugin.state.data,o=n.select(er.Generators.ofTransformer(Xe.Representation.SpinStructureRepresentation3D));if(o.length===0)return{kind:"finished"};let i=n.build(),a=(t.current-t.lastApplied)/r.params.durationInMs,s=(e.t+a)%1;for(let l of o)i.to(l).update({...l.params?.values,t:s});return await st.State.Update(r.plugin,{state:n,tree:i,options:{doNotLogTiming:!0}}),{kind:"next",state:{t:s}}}});var sG=b(),f3e=b(),h3e=Tr(),g3e=zc.create({name:"built-in.animate-camera-rock",display:{name:"Camera Rock",description:"Rock the 3D scene around the x-axis in view space"},isExportable:!0,params:()=>({durationInMs:C.Numeric(4e3,{min:100,max:2e4,step:100}),speed:C.Numeric(1,{min:1,max:10,step:1},{description:"How many times to rock from side to side."}),angle:C.Numeric(10,{min:0,max:180,step:1},{description:"How many degrees to rotate in each direction."})}),initialState:(e,t)=>({snapshot:t.canvas3d.camera.getSnapshot()}),getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),teardown:(e,t,r)=>{r.canvas3d?.requestCameraReset({snapshot:t.snapshot,durationMs:0})},async apply(e,t,r){if(t.current===0)return{kind:"next",state:e};let n=e.snapshot;if(n.radiusMax<1e-4)return{kind:"finished"};let o=t.animation?t.animation?.currentFrame/(t.animation.frameCount+1):Br(t.current/r.params.durationInMs,0,1),i=Math.sin(o*r.params.speed*Math.PI*2)*vr(r.params.angle);b.sub(sG,n.position,n.target),b.normalize(f3e,n.up),Tr.setAxisAngle(h3e,f3e,i),b.transformQuat(sG,sG,h3e);let a=b.add(b(),n.target,sG);return r.plugin.canvas3d?.requestCameraReset({snapshot:{...n,position:a},durationMs:0}),o>=.99999?{kind:"finished"}:{kind:"next",state:e}}});var Mr;(r=>{function e(n,o){return{action:n,customControl:o&&o.customControl,autoUpdate:o&&o.autoUpdate}}r.Action=e;function t(n,o={}){return{transformer:n,defaultParams:o}}r.Behavior=t})(Mr||={});var y3e=()=>({actions:[Mr.Action(DC.Structure.DownloadStructure),Mr.Action(DC.Volume.DownloadDensity),Mr.Action(DC.DataFormat.DownloadFile),Mr.Action(DC.DataFormat.OpenFiles),Mr.Action(DC.Structure.LoadTrajectory),Mr.Action(DC.Structure.EnableModelCustomProps),Mr.Action(DC.Structure.EnableStructureCustomProps),Mr.Action(FR),Mr.Action(f2e),Mr.Action(VR),Mr.Action(Xe.Data.Download),Mr.Action(Xe.Data.ParseCif),Mr.Action(Xe.Data.ParseCcp4),Mr.Action(Xe.Data.ParseDsn6),Mr.Action(Xe.Model.TrajectoryFromMmCif),Mr.Action(Xe.Model.TrajectoryFromCifCore),Mr.Action(Xe.Model.TrajectoryFromPDB),Mr.Action(Xe.Model.TransformStructureConformation),Mr.Action(Xe.Model.StructureInstances),Mr.Action(Xe.Model.StructureFromModel),Mr.Action(Xe.Model.StructureFromTrajectory),Mr.Action(Xe.Model.ModelFromTrajectory),Mr.Action(Xe.Model.StructureSelectionFromScript),Mr.Action(Xe.Representation.StructureRepresentation3D),Mr.Action(Xe.Representation.StructureSelectionsDistance3D),Mr.Action(Xe.Representation.StructureSelectionsAngle3D),Mr.Action(Xe.Representation.StructureSelectionsDihedral3D),Mr.Action(Xe.Representation.StructureSelectionsLabel3D),Mr.Action(Xe.Representation.StructureSelectionsOrientation3D),Mr.Action(Xe.Representation.ModelUnitcell3D),Mr.Action(Xe.Representation.StructureBoundingBox3D),Mr.Action(Xe.Representation.ExplodeStructureRepresentation3D),Mr.Action(Xe.Representation.SpinStructureRepresentation3D),Mr.Action(Xe.Representation.UnwindStructureAssemblyRepresentation3D),Mr.Action(Xe.Representation.OverpaintStructureRepresentation3DFromScript),Mr.Action(Xe.Representation.TransparencyStructureRepresentation3DFromScript),Mr.Action(Xe.Representation.ClippingStructureRepresentation3DFromScript),Mr.Action(Xe.Representation.SubstanceStructureRepresentation3DFromScript),Mr.Action(Xe.Representation.ThemeStrengthRepresentation3D),Mr.Action(Eq),Mr.Action(Xe.Volume.VolumeFromCcp4),Mr.Action(Xe.Volume.VolumeFromDsn6),Mr.Action(Xe.Volume.VolumeFromCube),Mr.Action(Xe.Volume.VolumeFromDx),Mr.Action(Xe.Representation.VolumeRepresentation3D),Mr.Action(Xe.Volume.VolumeTransform),Mr.Action(Xe.Volume.VolumeInstances)],behaviors:[Mr.Behavior(Gc.Representation.HighlightLoci),Mr.Behavior(Gc.Representation.SelectLoci),Mr.Behavior(Gc.Representation.DefaultLociLabelProvider),Mr.Behavior(Gc.Representation.FocusLoci),Mr.Behavior(Gc.Camera.FocusLoci),Mr.Behavior(Gc.Camera.CameraAxisHelper),Mr.Behavior(Gc.Camera.CameraControls),Mr.Behavior(FS),Mr.Behavior(Gc.CustomProps.StructureInfo),Mr.Behavior(Gc.CustomProps.AccessibleSurfaceArea),Mr.Behavior(Gc.CustomProps.BestDatabaseSequenceMapping),Mr.Behavior(Gc.CustomProps.Interactions),Mr.Behavior(Gc.CustomProps.SecondaryStructure),Mr.Behavior(Gc.CustomProps.ValenceModel),Mr.Behavior(Gc.CustomProps.CrossLinkRestraint)],animations:[u3e,l3e,g3e,m3e,i3e,p3e,d3e]});var tc=Rt(nr()),Byt={color:C.Color(Lt.black,{description:"Display color of the volume."}),wireframe:C.Boolean(!1,{description:"Control display of the volume as a wireframe."}),opacity:C.Numeric(.3,{min:0,max:1,step:.01},{description:"Opacity of the volume."})},kyt=new Map([["em",[-5,5]],["2fo-fc",[0,3]],["fo-fc(+ve)",[1,5]],["fo-fc(-ve)",[-5,-1]]]),BT=class extends Ir{constructor(){super(...arguments);this.ref=er.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name);this.getVisible=()=>{let r=this.plugin.state.data,n=this.ref;return n?!r.cells.get(n).state.isHidden:!1};this.toggleVisible=()=>{let r=this.plugin.state.data,n=this.ref;n&&Ef(r,n,!r.cells.get(n).state.isHidden)}}componentDidUpdate(){this.ref=er.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)}componentDidMount(){this.subscribe(this.plugin.state.data.events.cell.stateUpdated,r=>{this.ref===r.ref&&this.forceUpdate()})}render(){let r=this.props,{isRelative:n,stats:o}=r,i=r.channels[r.name],{min:a,max:s,mean:l,sigma:u}=o,c=Math.round(100*(i.isoValue.kind==="relative"?i.isoValue.relativeValue:i.isoValue.absoluteValue))/100,m=(a-l)/u,d=(s-l)/u;if(!this.props.isUnbounded){let x=kyt.get(this.props.name);this.props.name==="em"?(m=Math.max(x[0],m),d=Math.min(x[1],d)):(m=x[0],d=x[1])}let p=l+u*m,h=l+u*d,f=N2(n?Math.round((h-p)/u)/100:u/100,2),y=n?m:p,g=n?d:h;return(0,tc.jsx)(Mw,{label:r.label+(r.isRelative?" \u03C3":""),colorStripe:i.color,pivot:(0,tc.jsxs)("div",{className:"msp-volume-channel-inline-controls",children:[(0,tc.jsx)(BA,{value:c,min:y,max:g,step:f,onChange:x=>r.changeIso(r.name,x,n),onChangeImmediate:x=>r.changeIso(r.name,x,n),disabled:r.params.isDisabled,onEnter:r.params.events.onEnter}),(0,tc.jsx)(or,{svg:this.getVisible()?Jc:Fm,onClick:this.toggleVisible,toggleState:!1,disabled:r.params.isDisabled})]}),controls:(0,tc.jsx)(Kn,{onChange:({name:x,value:S})=>r.changeParams(r.name,x,S),params:Byt,values:i,onEnter:r.params.events.onEnter,isDisabled:r.params.isDisabled})})}},lG=class extends Ir{constructor(){super(...arguments);this.changeIso=(r,n,o)=>{let i=this.props.params;this.newParams({...i,entry:{name:i.entry.name,params:{...i.entry.params,channels:{...i.entry.params.channels,[r]:{...i.entry.params.channels[r],isoValue:o?Ve.IsoValue.relative(n):Ve.IsoValue.absolute(n)}}}}})};this.changeParams=(r,n,o)=>{let i=this.props.params;this.newParams({...i,entry:{name:i.entry.name,params:{...i.entry.params,channels:{...i.entry.params.channels,[r]:{...i.entry.params.channels[r],[n]:o}}}}})};this.changeOption=({name:r,value:n})=>{let o=this.props.params;if(r==="entry")this.newParams({...o,entry:{name:n,params:o.entry.params}});else{let i=this.props.b.data,a=i.info.kind==="em",s=n.params.isRelative,l=i.info.header.sampling[0],u=o.entry.params.channels,m={...o.entry.params.view.name===n.name?o.entry.params.view.params:this.props.info.params.entry.map(o.entry.name).params.view.map(n.name).defaultValue};n.name==="selection-box"?m.radius=n.params.radius:n.name==="camera-target"?(m.radius=n.params.radius,m.dynamicDetailLevel=n.params.dynamicDetailLevel):n.name==="box"?(m.bottomLeft=n.params.bottomLeft,m.topRight=n.params.topRight):n.name==="auto"&&(m.radius=n.params.radius,m.selectionDetailLevel=n.params.selectionDetailLevel),m.isUnbounded=!!n.params.isUnbounded,this.newParams({...o,entry:{name:o.entry.name,params:{...o.entry.params,view:{name:n.name,params:m},detailLevel:n.params.detailLevel,channels:a?{em:this.convert(u.em,l.valuesInfo[0],s)}:{"2fo-fc":this.convert(u["2fo-fc"],l.valuesInfo[0],s),"fo-fc(+ve)":this.convert(u["fo-fc(+ve)"],l.valuesInfo[1],s),"fo-fc(-ve)":this.convert(u["fo-fc(-ve)"],l.valuesInfo[1],s)}}}})}}}areInitial(r){return C.areEqual(this.props.info.params,r,this.props.info.initialValues)}newParams(r){this.props.events.onChange(r,this.areInitial(r))}convert(r,n,o){return{...r,isoValue:o?Ve.IsoValue.toRelative(r.isoValue,n):Ve.IsoValue.toAbsolute(r.isoValue,n)}}render(){if(!this.props.b)return null;let r=this.props.b.data,n=r.info.kind==="em",o=n?"em":"2fo-fc",i=this.props.params,a=this.props.info.params.entry.map(i.entry.name),s=a.params.detailLevel,l={...s,label:"Dynamic Detail",defaultValue:a.params.view.map("camera-target").params.dynamicDetailLevel.defaultValue},u={...s,label:"Selection Detail",defaultValue:a.params.view.map("auto").params.selectionDetailLevel.defaultValue},c=r.info.header.sampling[0],m=i.entry.params.channels[o].isoValue.kind==="relative",d=C.Boolean(m,{description:"Use normalized or absolute isocontour scale.",label:"Normalized"}),p=!!i.entry.params.view.params.isUnbounded,h=C.Boolean(p,{description:"Show full/limited range of iso-values for more fine-grained control.",label:"Unbounded"}),f=i.entry.params.view.name==="off",y={entry:C.Select(i.entry.name,r.data.entries.map(x=>[x.dataId,x.dataId]),{isHidden:f,description:"Which entry with volume data to display."}),view:C.MappedStatic(i.entry.params.view.name,{off:C.Group({isRelative:C.Boolean(m,{isHidden:!0}),isUnbounded:C.Boolean(p,{isHidden:!0})},{description:"Display off."}),box:C.Group({bottomLeft:C.Vec3(b.zero()),topRight:C.Vec3(b.zero()),detailLevel:s,isRelative:d,isUnbounded:h},{description:"Static box defined by cartesian coords."}),"selection-box":C.Group({radius:C.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),detailLevel:s,isRelative:d,isUnbounded:h},{description:"Box around focused element."}),"camera-target":C.Group({radius:C.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),detailLevel:{...s,isHidden:!0},dynamicDetailLevel:l,isRelative:d,isUnbounded:h},{description:"Box around camera target."}),cell:C.Group({detailLevel:s,isRelative:d,isUnbounded:h},{description:"Box around the structure's bounding box."}),auto:C.Group({radius:C.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),detailLevel:s,selectionDetailLevel:u,isRelative:d,isUnbounded:h},{description:"Box around focused element."})},{options:ps.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Around Camera" shows the volume around the point the camera is targeting. "Whole Structure" shows the volume for the whole structure.'})},g={entry:i.entry.name,view:{name:i.entry.params.view.name,params:{detailLevel:i.entry.params.detailLevel,radius:i.entry.params.view.params.radius,bottomLeft:i.entry.params.view.params.bottomLeft,topRight:i.entry.params.view.params.topRight,selectionDetailLevel:i.entry.params.view.params.selectionDetailLevel,dynamicDetailLevel:i.entry.params.view.params.dynamicDetailLevel,isRelative:m,isUnbounded:p}}};return f?(0,tc.jsx)(Kn,{onChange:this.changeOption,params:y,values:g,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled}):(0,tc.jsxs)(tc.Fragment,{children:[!n&&(0,tc.jsx)(BT,{label:"2Fo-Fc",name:"2fo-fc",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:m,params:this.props,stats:c.valuesInfo[0],isUnbounded:p}),!n&&(0,tc.jsx)(BT,{label:"Fo-Fc(+ve)",name:"fo-fc(+ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:m,params:this.props,stats:c.valuesInfo[1],isUnbounded:p}),!n&&(0,tc.jsx)(BT,{label:"Fo-Fc(-ve)",name:"fo-fc(-ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:m,params:this.props,stats:c.valuesInfo[1],isUnbounded:p}),n&&(0,tc.jsx)(BT,{label:"EM",name:"em",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:m,params:this.props,stats:c.valuesInfo[0],isUnbounded:p}),(0,tc.jsx)(Kn,{onChange:this.changeOption,params:y,values:g,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})]})}};var uG=()=>({...y3e(),customParamEditors:[[VR,lG]]});async function x3e(e){let{spec:t,target:r,onBeforeUIRender:n,render:o}=e,i=new iG(t||uG());await i.init(),n&&await n(i),o((0,b3e.createElement)(j2e,{plugin:i}),r);try{await i.canvas3dInitialized}catch{}return i}var C3e=Rt(QU());function S3e(e,t){(0,C3e.createRoot)(t).render(e)}var cG=Rt(nr()),Bq=class extends ic{constructor(r){super();this.options=r;this.plugin=void 0;this.context=a1(r?.context);let n=this.context.state.viewers.value,o=n.findIndex(i=>i.name===r?.name);if(o>=0){let i=[...n];i[o].model.dispose(),i.splice(o,0),this.context.state.viewers.next(i)}}async mount(r){let n=uG();this.plugin=await x3e({target:r,render:S3e,spec:{...n,layout:{initial:{isExpanded:!1,showControls:!1,controlsDisplay:"landscape"}},components:{remoteState:"none",viewport:{snapshotDescription:Lyt}},behaviors:[...n.behaviors,Mr.Behavior(aF)],config:[[Lr.Viewport.ShowAnimation,!1]]}}),this.subscribe(this.context.commands,async a=>{if(!(!a||!this.plugin))try{if(this.context.state.isLoading.next(!0),a.kind==="load-mvs"){let s;if(a.url){let l=await this.plugin.runTask(this.plugin.fetch({url:a.url,type:a.format==="mvsx"?"binary":"string"}));s=await xW(this.plugin,l,a.format??"mvsj",{sourceUrl:a.url})}else a.data&&(s=await xW(this.plugin,a.data,a.format??"mvsj"));tm.is(s)||s instanceof Uint8Array?this.context.state.currentStoryData.next(s):s&&this.context.state.currentStoryData.next(JSON.stringify(s))}}catch(s){console.error(s),st.Toast.Show(this.plugin,{key:"<mvsload>",title:"Error",message:s?.message?`${s?.message}`:`${s}`,timeoutMs:1e4})}finally{this.context.state.isLoading.next(!1)}});let i=[...this.context.state.viewers.value,{name:this.options?.name,model:this}];this.context.state.viewers.next(i)}};function Lyt(){return(0,cG.jsx)(cG.Fragment,{})}var kq=class extends HTMLElement{constructor(){super();this.model=void 0}async connectedCallback(){this.model=new Bq({name:this.getAttribute("name")??void 0,context:{name:this.getAttribute("context-name")??void 0}}),await this.model.mount(this)}disconnectedCallback(){this.model?.dispose(),this.model=void 0}};window.customElements.define("mvs-stories-viewer",kq);function mG(e){return a1({name:e})}function v3e(e,t){setTimeout(()=>{mG(t?.contextName).dispatch({kind:"load-mvs",format:t?.format??"mvsj",url:e})},0)}function Fyt(e,t){setTimeout(()=>{mG(t?.contextName).dispatch({kind:"load-mvs",format:t?.format??"mvsj",data:e})},0)}function Vyt(e,t="mvsj"){return`https://stories.molstar.org/api/story/${e}/data`}function Oyt(e,t){v3e(Vyt(e,t?.format),{format:t?.format??"mvsj",contextName:t?.contextName})}function Gyt(e){let t=mG(e?.contextName).state.currentStoryData.value;if(!t)return;let r=typeof t=="string",n=`${e?.filename??"story"}.${r?"mvsj":"mvsx"}`;DA(new Blob([typeof t=="string"?t:t.buffer],{type:r?"application/json":"application/octet-stream"}),n)}return D3e(Uyt);})();
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

scheduler/cjs/scheduler.production.min.js:
  (**
   * @license React
   * scheduler.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react-dom/cjs/react-dom.production.min.js:
  (**
   * @license React
   * react-dom.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

immutable/dist/immutable.es.js:
  (**
   * @license
   * MIT License
   * 
   * Copyright (c) 2014-present, Lee Byron and other contributors.
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   *)
*/
//# sourceMappingURL=mvs-stories.js.map
