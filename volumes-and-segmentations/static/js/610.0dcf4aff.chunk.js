"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[610],{610:function(e,t,n){n.r(t),n.d(t,{default:function(){return Mt}});var r=n(1413),a=n(885),i=n(2791),o=n(3904),s=(n(1253),n(5861)),u=n(5671),c=n(3144),l=n(7757),d=n.n(l),m=n(2545),p=n(7899),h=n(6700),v=n(9462);var f,g,x,y=function(){var e={NODE_ENV:"production",PUBLIC_URL:"https://molstar.org/volumes-and-segmentations",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_HOSTNAME?{NODE_ENV:"production",PUBLIC_URL:"https://molstar.org/volumes-and-segmentations",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_HOSTNAME:"".concat(window.location.protocol,"//").concat(window.location.hostname),t={NODE_ENV:"production",PUBLIC_URL:"https://molstar.org/volumes-and-segmentations",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_PORT,n={NODE_ENV:"production",PUBLIC_URL:"https://molstar.org/volumes-and-segmentations",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_PREFIX?"/".concat({NODE_ENV:"production",PUBLIC_URL:"https://molstar.org/volumes-and-segmentations",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_PREFIX):"";return"".concat(e).concat(t?":"+t:"").concat(n)}(),b=function(){var e;return"".concat(null!==(e={NODE_ENV:"production",PUBLIC_URL:"https://molstar.org/volumes-and-segmentations",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_GIT_TAG)&&void 0!==e?e:"")}(),S=function(){var e;return"".concat(null!==(e={NODE_ENV:"production",PUBLIC_URL:"https://molstar.org/volumes-and-segmentations",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_GIT_SHA)&&void 0!==e?e:"")}(),w=("".concat(y,"/v1"),"".concat(y,"/v2")),k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S;(0,u.Z)(this,e),this.volumeServerUrl=void 0,this.volumeServerGitTag=void 0,this.volumeServerGitSha=void 0,this.volumeServerUrl=t.replace(/\/$/,""),this.volumeServerGitTag=n,this.volumeServerGitSha=r,console.log("API V2",this.volumeServerUrl),console.log("SHA: ".concat(this.volumeServerGitSha)),console.log("GIT TAG: ".concat(this.volumeServerGitTag))}return(0,c.Z)(e,[{key:"entryListUrl",value:function(e,t){return"".concat(this.volumeServerUrl,"/list_entries/").concat(e,"/").concat(null!==t&&void 0!==t?t:"")}},{key:"metadataUrl",value:function(e,t){return"".concat(this.volumeServerUrl,"/").concat(e,"/").concat(t,"/metadata")}},{key:"volumeUrl",value:function(e,t,n,r){if(n){var i=(0,a.Z)(n,2),o=(0,a.Z)(i[0],3),s=o[0],u=o[1],c=o[2],l=(0,a.Z)(i[1],3),d=l[0],m=l[1],p=l[2];return"".concat(this.volumeServerUrl,"/").concat(e,"/").concat(t,"/volume/box/").concat(s,"/").concat(u,"/").concat(c,"/").concat(d,"/").concat(m,"/").concat(p,"?max_points=").concat(r)}return"".concat(this.volumeServerUrl,"/").concat(e,"/").concat(t,"/volume/cell?max_points=").concat(r)}},{key:"latticeUrl",value:function(e,t,n,r,i){if(r){var o=(0,a.Z)(r,2),s=(0,a.Z)(o[0],3),u=s[0],c=s[1],l=s[2],d=(0,a.Z)(o[1],3),m=d[0],p=d[1],h=d[2];return"".concat(this.volumeServerUrl,"/").concat(e,"/").concat(t,"/segmentation/box/").concat(n,"/").concat(u,"/").concat(c,"/").concat(l,"/").concat(m,"/").concat(p,"/").concat(h,"?max_points=").concat(i)}return"".concat(this.volumeServerUrl,"/").concat(e,"/").concat(t,"/segmentation/cell/").concat(n,"?max_points=").concat(i)}},{key:"meshUrl_Json",value:function(e,t,n,r){return"".concat(this.volumeServerUrl,"/").concat(e,"/").concat(t,"/mesh/").concat(n,"/").concat(r)}},{key:"meshUrl_Bcif",value:function(e,t,n,r){return"".concat(this.volumeServerUrl,"/").concat(e,"/").concat(t,"/mesh_bcif/").concat(n,"/").concat(r)}},{key:"volumeInfoUrl",value:function(e,t){return"".concat(this.volumeServerUrl,"/").concat(e,"/").concat(t,"/volume_info")}},{key:"getEntryList",value:function(){var e=(0,s.Z)(d().mark((function e(t,n){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.entryListUrl(t,n));case 2:return r=e.sent,e.next=5,r.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMetadata",value:function(){var e=(0,s.Z)(d().mark((function e(t,n){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.metadataUrl(t,n));case 2:return r=e.sent,e.next=5,r.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),_=n(2982),Z=n(7762),E=n(6857),M=n(6554),A=n(8310),D=n(9750),I=n(329);!function(e){function t(e,t){var n=e.grid.segmentation_meshes.mesh_component_numbers.segment_ids;if(void 0===n)return[];var r=n[t].detail_lvls;return Object.keys(r).map((function(e){return parseInt(e)}))}e.meshSegments=function(e){var t=e.grid.segmentation_meshes.mesh_component_numbers.segment_ids;return void 0===t?[]:Object.keys(t).map((function(e){return parseInt(e)}))},e.meshSegmentDetails=t,e.getSufficientDetail=function(e,n,r){var a=t(e,n);return null!==r&&(a=a.filter((function(e){return e<=r}))),Math.max.apply(Math,(0,_.Z)(a))},e.annotationsBySegment=function(e){var t,n={},r=(0,Z.Z)(e.annotation.segment_list);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(a.id in n)throw new Error("Duplicate segment annotation for segment ".concat(a.id));n[a.id]=a}}catch(i){r.e(i)}finally{r.f()}return n},e.dropSegments=function(e,t){if(void 0!==e.grid.segmentation_meshes.mesh_component_numbers.segment_ids){var n=new Set(t);e.annotation.segment_list=e.annotation.segment_list.filter((function(e){return!n.has(e.id)}));var r,a=(0,Z.Z)(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;delete e.grid.segmentation_meshes.mesh_component_numbers.segment_ids[i]}}catch(o){a.e(o)}finally{a.f()}}}}(f||(f={})),(x=g||(g={})).get=function(){var e=window.location.hash.replace("#","");return Object.fromEntries(new URLSearchParams(e).entries())},x.set=function(e){var t=new URLSearchParams(e).toString();window.location.hash=t};var j,T=D.td.builderFactory("cellstar")({name:"create-transformer",from:E.G.Root,to:E.G.Volume.Data,params:{label:I.e.Text("Volume",{isHidden:!0}),description:I.e.Text("",{isHidden:!0}),volume:I.e.Value(void 0,{isHidden:!0})}})({apply:function(e){var t=e.params;return new E.G.Volume.Data(t.volume,{label:t.label,description:t.description})}}),P=function(){function e(){(0,u.Z)(this,e),this.nodes=void 0,this.nodes={}}return(0,c.Z)(e,[{key:"getNode",value:function(t){var n=this.nodes[t];if(!n||e.nodeExists(n))return n;delete this.nodes[t]}},{key:"getNodes",value:function(){var e=this;return Object.keys(this.nodes).map((function(t){return e.getNode(t)})).filter((function(e){return e}))}},{key:"deleteAllNodes",value:function(e){var t,n=(0,Z.Z)(this.getNodes());try{for(n.s();!(t=n.n()).done;){var r=t.value;e.delete(r)}}catch(a){n.e(a)}finally{n.f()}this.nodes={}}},{key:"hideAllNodes",value:function(){var e,t=(0,Z.Z)(this.getNodes());try{for(t.s();!(e=t.n()).done;){var n=e.value;(0,A.setSubtreeVisibility)(n.state,n.ref,!0)}}catch(r){t.e(r)}finally{t.f()}}},{key:"showNode",value:function(){var e=(0,s.Z)(d().mark((function e(t,n){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.getNode(t))){e.next=5;break}(0,A.setSubtreeVisibility)(r.state,r.ref,!1),e.next=9;break;case 5:return e.next=7,n();case 7:r=e.sent,this.nodes[t]=r;case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}],[{key:"nodeExists",value:function(e){try{return e.checkValid()}catch(t){return!1}}}]),e}();function C(e){var t=e.split("-"),n=(0,a.Z)(t,2),r=n[0],i=n[1];return{source:{empiar:"empiar",emd:"emdb",idr:"idr"}[r],entryNumber:i}}function B(e,t){return"".concat({empiar:"empiar",emdb:"emd",idr:"idr"}[e],"-").concat(t)}!function(e){function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=10;console.log("CifFile",t),e.blocks.forEach((function(e){console.log("    ".concat(e.header)),e.categoryNames.forEach((function(t){var r=e.categories[t],a=r.rowCount;console.log("        _".concat(t," [").concat(a," rows]")),r.fieldNames.forEach((function(e){var t=r.getField(e),i=null===t||void 0===t?void 0:t.toStringArray().slice(0,n).join(", ");a>n&&(i+="..."),console.log("            .".concat(e,":  ").concat(i))}))}))}))}function n(){return(n=(0,s.Z)(d().mark((function e(n,a){var i,o,s,u,c,l;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Math.pow(10,5),o=[[-i,-i,-i],[i,i,i]],s=Math.pow(10,7),u={"VOLUME BOX EMD-1832":a.volumeUrl("emdb","emd-1832",o,s),"LATTICE BOX EMD-1832":a.latticeUrl("emdb","emd-1832",0,o,s),"VOLUME CELL EMD-1832":a.volumeUrl("emdb","emd-1832",null,s),"LATTICE CELL EMD-1832":a.latticeUrl("emdb","emd-1832",0,null,s),"VOLUME BOX EMPIAR-10070":a.volumeUrl("empiar","empiar-10070",o,s),"VOLUME CELL EMPIAR-10070":a.volumeUrl("empiar","empiar-10070",null,s)},e.t0=d().keys(u);case 5:if((e.t1=e.t0()).done){e.next=26;break}return c=e.t1.value,console.log("\n<<< ".concat(c," >>>")),console.log(u[c]),e.prev=9,e.next=12,n.builders.data.download({url:u[c],isBinary:!0});case 12:return l=e.sent,e.next=15,n.build().to(l).apply(M.L.Data.ParseCif).commit();case 15:return t(e.sent.data,u[c]),e.next=19,r(n,u[c],1);case 19:e.next=24;break;case 21:e.prev=21,e.t2=e.catch(9),console.error("Failed",e.t2);case 24:e.next=5;break;case 26:case"end":return e.stop()}}),e,null,[[9,21]])})))).apply(this,arguments)}function r(e,t,n){return i.apply(this,arguments)}function i(){return(i=(0,s.Z)(d().mark((function e(t,n,r){var i,o,s,u,c,l,m,p,h,v,f,g,x,y,b,S,w,k,_,Z,E;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.builders.data.download({url:n,isBinary:!0});case 2:return s=e.sent,e.next=5,t.dataFormats.get("dscif").parse(t,s,{entryId:n});case 5:for(u=e.sent,c=null!==(i=null===(o=u.volumes)||void 0===o?void 0:o[0])&&void 0!==i?i:u.volume,l=c.cell.obj.data,m=l.grid.cells.space,p=l.grid.cells.data,console.log("testVolumeBbox",n,"axisOrderSlowToFast:",m.axisOrderSlowToFast,"dimensions:",m.dimensions),h=(0,a.Z)(m.dimensions,3),v=h[0],f=h[1],g=h[2],x=v,y=f,b=g,S=-1,w=-1,k=-1,_=0;_<g;_++)for(Z=0;Z<f;Z++)for(E=0;E<v;E++)m.get(p,E,Z,_)>=r&&(E<x&&(x=E),Z<y&&(y=Z),_<b&&(b=_),E>S&&(S=E),Z>w&&(w=Z),_>k&&(k=_));console.log("bbox (value>=".concat(r,"):"),[x,y,b],[S+1,w+1,k+1],"size:",[S-x+1,w-y+1,k-b+1]);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.logCifOverview=t,e.testApiV2=function(e,t){return n.apply(this,arguments)},e.testVolumeBbox=r}(j||(j={}));var R=n(3603),N=n(9901),O=n(4932),U=n(1415),V=n(1862),F=n(8335),L=n(6170),G=n(5137),W=n(3802),H=n(60),K=n(6933),z=n(1491),q=n(9001),X=n(21),Q=n(4505),Y=n(9558),$=(n(4571),n(9917)),J=(n(6698),n(1117)),ee=(n(7636),n(8935)),te=(n(6686),n(355)),ne=n(6471),re=n(8695),ae=(n(3295),n(5911)),ie=n(136),oe=n(8505),se=G.sg.Schema,ue=se.int,ce=se.float,le={mesh:{id:ue},mesh_vertex:{mesh_id:ue,vertex_id:ue,x:ce,y:ce,z:ce},mesh_triangle:{mesh_id:ue,vertex_id:ue}},de=function(e){return z.IH(le,e)};function me(e,t){if(void 0!==t.scale)for(var n=(0,a.Z)(t.scale,3),r=n[0],i=n[1],o=n[2],s=e.vertexBuffer.ref.value,u=0;u<s.length;u+=3)s[u]*=r,s[u+1]*=i,s[u+2]*=o;if(void 0!==t.shift)for(var c=(0,a.Z)(t.shift,3),l=c[0],d=c[1],m=c[2],p=e.vertexBuffer.ref.value,h=0;h<p.length;h+=3)p[h]+=l,p[h+1]+=d,p[h+2]+=m;if(void 0!==t.matrix)for(var v=e.vertexBuffer.ref.value,f=t.matrix,g=3*e.vertexCount,x=0;x<g;x+=3)X.AO.transformMat4Offset(v,v,f,x,x,0);if(void 0!==t.group)for(var y=e.groupBuffer.ref.value,b=0;b<y.length;b++)y[b]=t.group;if(t.invertSides){for(var S,w=e.indexBuffer.ref.value,k=0;k<w.length;k+=3)S=w[k],w[k]=w[k+1],w[k+1]=S;for(var _=e.normalBuffer.ref.value,Z=0;Z<_.length;Z++)_[Z]*=-1}}function pe(e){return he.apply(this,arguments)}function he(){return he=(0,s.Z)(d().mark((function e(t){var n,r,a,i,o,s,u,c,l,m,p,h,v,f,g,x,y,b,S,w,k,_,Z,E,M,A,D,I,j,T=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(T.length>1&&void 0!==T[1])||T[1],r=T.length>2&&void 0!==T[2]?T[2]:"cartesian",a=t.blocks.find((function(e){return"VOLUME_INFO"===e.header})),i=t.blocks.find((function(e){return"MESHES"===e.header})),a&&i){e.next=6;break}throw new Error("Missing VOLUME_INFO or MESHES block in mesh CIF file");case 6:for(o=K.pe.schema.densityServer(a),s=de(i),u=s.mesh_vertex._rowCount,c=Math.floor(s.mesh_triangle._rowCount/3),l=s.mesh.id.toArray(),m=s.mesh_vertex.mesh_id.toArray(),p=s.mesh_vertex.x.toArray(),h=s.mesh_vertex.y.toArray(),v=s.mesh_vertex.z.toArray(),f=s.mesh_triangle.mesh_id.toArray(),g=s.mesh_triangle.vertex_id.toArray(),x=new Uint32Array(3*c),y=fe(m),b=0;b<3*c;b++)S=y.get(f[b]),x[b]=S+g[b];if(w=ve(p,h,v),k=new Float32Array(3*u),_=new Float32Array(m),Z=H.K.create(w,x,k,_,u,c),n&&me(Z,{invertSides:!0}),"cartesian"!==r){e.next=33;break}return e.next=28,Q.N(o).run();case 28:E=e.sent,M=N.r.getGridToCartesianTransform(E.grid),me(Z,{matrix:M}),e.next=41;break;case 33:if("fractional"!==r){e.next=41;break}if(A=o.volume_data_3d_info.sample_count.value(0),D=o.volume_data_3d_info.origin.value(0),1===(I=o.volume_data_3d_info.dimensions.value(0))[0]&&1===I[1]&&1===I[2]){e.next=39;break}throw new Error("Asserted the fractional dimensions are [1,1,1], but are actually [".concat(I,"]"));case 39:j=[1/A[0],1/A[1],1/A[2]],me(Z,{scale:j,shift:Array.from(D)});case 41:return H.K.computeNormals(Z),e.abrupt("return",{mesh:Z,meshIds:Array.from(l)});case 43:case"end":return e.stop()}}),e)}))),he.apply(this,arguments)}function ve(e,t,n){for(var r=e.length,a=new Float32Array(3*r),i=0;i<r;i++)a[3*i]=e[i],a[3*i+1]=t[i],a[3*i+2]=n[i];return a}function fe(e){for(var t=new Map,n=0;n<e.length;n++)t.has(e[n])||t.set(e[n],n);return t}var ge=d().mark((function e(){var t,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=xe(Object.values(F.t)),n=0;case 2:return e.next=5,t[n];case 5:++n>=t.length&&(n=0),e.next=2;break;case 9:case"end":return e.stop()}}),e)}))();function xe(e){for(var t=e.length;0!==t;){var n=Math.floor(Math.random()*t),r=e[t-=1];e[t]=e[n],e[n]=r}return e}var ye,be=I.e,Se=D.td.builderFactory("cellstar");!function(e){function t(){return(t=(0,s.Z)(d().mark((function e(t,n,r,a){var i,o,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe(t);case 2:return i=e.sent,o=i.mesh,s=i.meshIds,e.abrupt("return",{segmentId:n,segmentName:r,detail:a,meshIds:s,mesh:o});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.empty=function(){return{segmentId:0,segmentName:"Empty",detail:0,meshIds:[],mesh:H.K.createEmpty()}},e.fromCIF=function(e,n,r,a){return t.apply(this,arguments)},e.stats=function(e){return'Meshlist "'.concat(e.segmentName,'" (detail ').concat(e.detail,"): ").concat(e.meshIds.length," meshes, ").concat(e.mesh.vertexCount," vertices, ").concat(e.mesh.triangleCount," triangles")},e.getShape=function(e,t){var n=e.mesh;return Y.b.create("MyShape",e,n,(function(){return t}),(function(){return 1}),(function(t){return"".concat(e.segmentName," | Segment ").concat(e.segmentId," | Detail ").concat(e.detail," | Mesh ").concat(t)}))},e.combineBBoxes=function(e){var t,n=null,r=(0,Z.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;a&&(n?(X.AO.min(n.min,n.min,a.min),X.AO.max(n.max,n.max,a.max)):(n=q.XZ.zero(),q.XZ.copy(n,a)))}}catch(i){r.e(i)}finally{r.f()}return n},e.bbox=function(e){return function(e){var t=e.vertexCount,n=e.vertexBuffer.ref.value;if(0===t)return null;for(var r=n[0],a=n[1],i=n[2],o=r,s=a,u=i,c=0;c<3*t;c+=3){var l=n[c],d=n[c+1],m=n[c+2];l<r&&(r=l),d<a&&(a=d),m<i&&(i=m),l>o&&(o=l),d>s&&(s=d),m>u&&(u=m)}return q.XZ.create(X.AO.create(r,a,i),X.AO.create(o,s,u))}(e.mesh)},e.allVerticesUsed=function(e){for(var t=new Set,n=0;n<e.mesh.vertexCount;n++)t.add(n);for(var r=0;r<3*e.mesh.triangleCount;r++){var a=e.mesh.vertexBuffer.ref.value[r];t.delete(a)}return 0===t.size}}(ye||(ye={}));var we,ke=function(e){(0,ie.Z)(n,e);var t=(0,oe.Z)(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(E.G.Create({name:"Parsed Meshlist",typeClass:"Object"})),_e=Se({name:"meshlist-from-string",from:E.G.Format.Cif,to:ke,params:{label:be.Text(ke.type.name,{isHidden:!0}),segmentId:be.Numeric(1,{},{isHidden:!0}),segmentName:be.Text("Segment"),detail:be.Numeric(1,{},{isHidden:!0})}})({apply:function(e,t){var n=e.a,r=e.params;return ne.iQ.create("Create Parsed Meshlist",function(){var e=(0,s.Z)(d().mark((function e(t){var a,i;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye.fromCIF(n.data,r.segmentId,r.segmentName,r.detail);case 2:return a=e.sent,i=1===a.meshIds.length?"":"es",e.abrupt("return",new ke(a,{label:r.label,description:"".concat(a.segmentName," (").concat(a.meshIds.length," mesh").concat(i,")")}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}});(we||(we={})).fromMeshlistData=function(e,t){var n=null!==t&&void 0!==t?t:ge.next().value;return{label:"Mesh",data:e,params:Ee,geometryUtils:H.K.Utils,getShape:function(e,t){return ye.getShape(t,n)}}};var Ze={color:be.Value(void 0)},Ee={alpha:be.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:be.Select("auto",W.w_,{isEssential:!0,description:"Visual/rendering quality of the representation."}),material:ae.F.getParam(),clip:H.K.Params.clip,instanceGranularity:be.Boolean(!1,{description:"Use instance granularity for marker, transparency, clipping, overpaint, substance data to save memory."}),doubleSided:be.Boolean(!1,W.ev.CustomQualityParamInfo),flipSided:be.Boolean(!1,W.ev.ShadingCategory),flatShaded:be.Boolean(!0,W.ev.ShadingCategory),ignoreLight:be.Boolean(!1,W.ev.ShadingCategory),xrayShaded:be.Boolean(!1,W.ev.ShadingCategory),transparentBackfaces:be.Select("off",be.arrayToOptions(["off","on","opaque"]),W.ev.ShadingCategory),bumpFrequency:be.Numeric(0,{min:0,max:10,step:.1},W.ev.ShadingCategory),bumpAmplitude:be.Numeric(1,{min:0,max:5,step:.1},W.ev.ShadingCategory)},Me=Se({name:"shape-from-meshlist",display:{name:"Shape from Meshlist",description:"Create Shape from Meshlist data"},from:ke,to:E.G.Shape.Provider,params:Ze})({apply:function(e){var t=e.a,n=e.params,r=we.fromMeshlistData(t.data,n.color);return new E.G.Shape.Provider(r,{label:E.G.Shape.Provider.type.name,description:t.description})}}),Ae=function(){function e(t,n){(0,u.Z)(this,e),this.defaultValue=void 0,this.options=void 0,this.nameDict=void 0,this.defaultValue=n,this.options=Object.keys(t).map((function(e){return[e,t[e]]})),this.nameDict=t}return(0,c.Z)(e,[{key:"PDSelect",value:function(e,t){return I.e.Select(null!==e&&void 0!==e?e:this.defaultValue,this.options,t)}},{key:"prettyName",value:function(e){return this.nameDict[e]}}]),e}();Ae||(Ae={});var De=I.e,Ie=function(e){(0,ie.Z)(n,e);var t=(0,oe.Z)(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(E.G.Create({name:"Volume Server",typeClass:"Object"}));!function(e){var t=e.MeshSourceChoice=new Ae({empiar:"EMPIAR",emdb:"EMDB"},"empiar");e.Params={serverUrl:De.Text("http://localhost:9000/v2"),source:t.PDSelect(),entryId:De.Text("")}}(Ie||(Ie={}));var je,Te=n(5153),Pe=n(23);!function(e){function t(e,t){var n=e.grid.segmentation_meshes.mesh_component_numbers.segment_ids;if(void 0===n)return[];var r=n[t].detail_lvls;return Object.keys(r).map((function(e){return parseInt(e)}))}e.meshSegments=function(e){var t=e.grid.segmentation_meshes.mesh_component_numbers.segment_ids;return void 0===t?[]:Object.keys(t).map((function(e){return parseInt(e)}))},e.meshSegmentDetails=t,e.getSufficientDetail=function(e,n,r){var a=t(e,n);return null!==r&&(a=a.filter((function(e){return e<=r}))),Math.max.apply(Math,(0,_.Z)(a))},e.annotationsBySegment=function(e){var t,n={},r=(0,Z.Z)(e.annotation.segment_list);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(a.id in n)throw new Error("Duplicate segment annotation for segment ".concat(a.id));n[a.id]=a}}catch(i){r.e(i)}finally{r.f()}return n},e.dropSegments=function(e,t){if(void 0!==e.grid.segmentation_meshes.mesh_component_numbers.segment_ids){var n=new Set(t);e.annotation.segment_list=e.annotation.segment_list.filter((function(e){return!n.has(e.id)}));var r,a=(0,Z.Z)(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;delete e.grid.segmentation_meshes.mesh_component_numbers.segment_ids[i]}}catch(o){a.e(o)}finally{a.f()}}},e.namesAndColorsBySegment=function(e){var t,n={},r=(0,Z.Z)(e.annotation.segment_list);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(a.id in n)throw new Error("Duplicate segment annotation for segment ".concat(a.id));n[a.id]={name:a.biological_annotation.name,color:V.Il.fromNormalizedArray(a.colour,0)}}}catch(i){r.e(i)}finally{r.f()}return n}}(je||(je={}));var Ce=I.e,Be=F.t.lightgray,Re=new Set,Ne=function(e){(0,ie.Z)(n,e);var t=(0,oe.Z)(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(E.G.CreateBehavior({name:"Mesh Streaming"}));!function(e){var t,n;!function(e){e.ViewTypeChoice=new Ae({off:"Off",select:"Select",all:"All"},"select");e.create=function(e){return{view:Ce.MappedStatic("select",{off:Ce.Group({}),select:Ce.Group({baseDetail:Ce.Numeric(7,{min:1,max:10,step:1},{description:"Detail level for the non-selected segments (lower number = better)"}),focusDetail:Ce.Numeric(1,{min:1,max:10,step:1},{description:"Detail level for the selected segment (lower number = better)"}),selectedSegment:Ce.Numeric(-1,{},{isHidden:!0})},{isFlat:!0}),all:Ce.Group({detail:Ce.Numeric(7,{min:1,max:10,step:1},{description:"Detail level for all segments (lower number = better)"})},{isFlat:!0})},{description:'"Off" hides all segments. \n"Select" shows all segments in lower detail, clicked segment in better detail. "All" shows all segment in the same level.'})}},e.copyValues=function(e){return{view:{name:e.view.name,params:(0,r.Z)({},e.view.params)}}},e.valuesEqual=function(e,t){if(e.view.name!==t.view.name)return!1;for(var n in e.view.params)if(e.view.params[n]!==t.view.params[n])return!1;return!0},e.detailsEqual=function(e,t){switch(e.view.name){case"off":return"off"===t.view.name;case"select":return"select"===t.view.name&&e.view.params.baseDetail===t.view.params.baseDetail&&e.view.params.focusDetail===t.view.params.focusDetail;case"all":return"all"===t.view.name&&e.view.params.detail===t.view.params.detail;default:throw new Error("Not implemented")}}}(t||(t=e.Params||(e.Params={}))),function(e){e.DetailTypes=["low","high"];e.tagFor=function(e,t){return"".concat(t,"-").concat(e)}}(n||(n=e.VisualInfo||(e.VisualInfo={})));var a=function(e){(0,ie.Z)(a,e);var r=(0,oe.Z)(a);function a(e,t,n){var i;return(0,u.Z)(this,a),(i=r.call(this,e,n)).id=void 0,i.ref="",i.parentData=void 0,i.metadata=void 0,i.visuals=void 0,i.backgroundSegments={},i.focusObservable=i.plugin.behaviors.interaction.click.pipe((0,Te.U)((function(e){return e.current.loci})),(0,Te.U)((function(e){return"group-loci"===e.kind?e.shape.sourceData:null})),(0,Te.U)((function(e){return(null===e||void 0===e?void 0:e.ownerId)===i.id?e:null})),(0,Pe.x)((function(e,t){return(null===e||void 0===e?void 0:e.segmentId)===(null===t||void 0===t?void 0:t.segmentId)}))),i.focusSubscription=void 0,i.backgroundSegmentsInitialized=!1,i.id=re.hb.create22(),i.parentData=t,i}return(0,c.Z)(a,[{key:"register",value:function(e){this.ref=e}},{key:"unregister",value:function(){this.focusSubscription&&(this.focusSubscription.unsubscribe(),this.focusSubscription=void 0)}},{key:"selectSegment",value:function(e){if("select"===this.params.view.name){if(this.params.view.params.selectedSegment===e)return;var n=t.copyValues(this.params);"select"===n.view.name&&(n.view.params.selectedSegment=e);var r=this.plugin.state.data,a=r.build().to(this.ref).update(n);ee.I.State.Update(this.plugin,{state:r,tree:a,options:{doNotUpdateCurrent:!0}})}}},{key:"update",value:function(){var e=(0,s.Z)(d().mark((function e(n){var r,a,i=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.params,this.params=n,this.metadata){e.next=9;break}return e.next=5,fetch(this.getMetadataUrl());case 5:return a=e.sent,e.next=8,a.json();case 8:this.metadata=e.sent;case 9:this.visuals?t.detailsEqual(this.params,r)||this.updateVisualInfoDetails():this.initVisualInfos(),e.t0=n.view.name,e.next="off"===e.t0?13:"select"===e.t0?16:"all"===e.t0?19:22;break;case 13:return e.next=15,this.disableVisuals();case 15:return e.abrupt("break",23);case 16:return e.next=18,this.enableVisuals(n.view.params.selectedSegment);case 18:return e.abrupt("break",23);case 19:return e.next=21,this.enableVisuals();case 21:return e.abrupt("break",23);case 22:throw new Error("Not implemented");case 23:return"off"===n.view.name||this.backgroundSegmentsInitialized||(this.guessBackgroundSegments(),this.backgroundSegmentsInitialized=!0),"select"!==n.view.name||this.focusSubscription?"select"!==n.view.name&&this.focusSubscription&&(this.focusSubscription.unsubscribe(),this.focusSubscription=void 0):this.focusSubscription=this.subscribeObservable(this.focusObservable,(function(e){var t;i.selectSegment(null!==(t=null===e||void 0===e?void 0:e.segmentId)&&void 0!==t?t:-1)})),e.abrupt("return",!0);case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMetadataUrl",value:function(){return"".concat(this.parentData.serverUrl,"/").concat(this.parentData.source,"/").concat(this.parentData.entryId,"/metadata")}},{key:"getMeshUrl",value:function(e,t){return"".concat(this.parentData.serverUrl,"/").concat(this.parentData.source,"/").concat(this.parentData.entryId,"/mesh_bcif/").concat(e,"/").concat(t)}},{key:"initVisualInfos",value:function(){var e,t=je.namesAndColorsBySegment(this.metadata),r={},a=(0,Z.Z)(je.meshSegments(this.metadata));try{for(a.s();!(e=a.n()).done;){var i,o,s,u,c=e.value;if(!Re.has(c)){var l,d=null!==(i=null===(o=t[c])||void 0===o?void 0:o.name)&&void 0!==i?i:"Untitled segment",m=null!==(s=null===(u=t[c])||void 0===u?void 0:u.color)&&void 0!==s?s:Be,p=(0,Z.Z)(n.DetailTypes);try{for(p.s();!(l=p.n()).done;){var h=l.value,v={tag:n.tagFor(c,h),segmentId:c,segmentName:d,detailType:h,detail:-1,color:m,visible:!1,data:void 0};r[v.tag]=v}}catch(f){p.e(f)}finally{p.f()}}}}catch(f){a.e(f)}finally{a.f()}this.visuals=r,this.updateVisualInfoDetails()}},{key:"updateVisualInfoDetails",value:function(){var e,t;switch(this.params.view.name){case"off":t=void 0,e=void 0;break;case"select":t=this.params.view.params.baseDetail,e=this.params.view.params.focusDetail;break;case"all":t=this.params.view.params.detail,e=void 0}for(var n in this.visuals){var r=this.visuals[n],a="high"===r.detailType?e:t;void 0!==a&&(r.detail=je.getSufficientDetail(this.metadata,r.segmentId,a))}}},{key:"enableVisuals",value:function(){var e=(0,s.Z)(d().mark((function e(t){var n,r,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=d().keys(this.visuals);case 1:if((e.t1=e.t0()).done){e.next=15;break}if(n=e.t1.value,r=this.visuals[n],a=r.segmentId===t?"high":"low",r.detailType!==a){e.next=12;break}return e.next=8,this.getMeshData(r);case 8:r.data=e.sent,r.visible=!0,e.next=13;break;case 12:r.visible=!1;case 13:e.next=1;break;case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disableVisuals",value:function(){var e=(0,s.Z)(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t in this.visuals)this.visuals[t].visible=!1;case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMeshData",value:function(){var e=(0,s.Z)(d().mark((function e(t){var n,r,a,i,o;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.data||t.data.detail!==t.detail){e.next=2;break}return e.abrupt("return",t.data);case 2:return n=this.getMeshUrl(t.segmentId,t.detail),r=U.x.getUrlAsset(this.plugin.managers.asset,n),e.next=6,this.plugin.runTask(this.plugin.managers.asset.resolve(r,"binary"));case 6:return a=e.sent,e.next=9,this.plugin.runTask(K.pe.parseBinary(a.data));case 9:if(!(i=e.sent).isError){e.next=12;break}throw new Error("Failed parsing CIF file from ".concat(n));case 12:return e.next=14,ye.fromCIF(i.result,t.segmentId,t.segmentName,t.detail);case 14:return(o=e.sent).ownerId=this.id,e.abrupt("return",o);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"guessBackgroundSegments",value:function(){var e=(0,s.Z)(d().mark((function e(){var t,n,r,a,i,o,s,u,c,l;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n in t={},this.visuals)"low"===(r=this.visuals[n]).detailType&&r.data&&(a=ye.bbox(r.data))&&(t[r.segmentId]=a);for(u in i=ye.combineBBoxes(Object.values(t)),o=i?q.XZ.volume(i):0,s={},t)c=t[u],l=q.XZ.volume(c),s[u]=l>.5*o;this.backgroundSegments=s;case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDescription",value:function(){return t.ViewTypeChoice.prettyName(this.params.view.name)}}]),a}(J.qZ.WithSubscribers);e.Behavior=a}(Ne||(Ne={}));var Oe=I.e,Ue=Se({name:"mesh-server-info",from:E.G.Root,to:Ie,params:Ie.Params})({apply:function(e,t){e.a;var n=e.params;n.serverUrl=n.serverUrl.replace(/\/*$/,"");var a=n.entryId;return new Ie((0,r.Z)({},n),{label:"Mesh Server",description:a})}}),Ve=Se({name:"mesh-streaming-from-server-info",display:{name:"Mesh Streaming"},from:Ie,to:Ne,params:function(e){return Ne.Params.create(e.data)}})({canAutoUpdate:function(){return!0},apply:function(e,t){var n=e.a,r=e.params;return ne.iQ.create("Mesh Streaming",function(){var e=(0,s.Z)(d().mark((function e(a){var i;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Ne.Behavior(t,n.data,r),e.next=3,i.update(r);case 3:return e.abrupt("return",new Ne(i,{label:"Mesh Streaming",description:i.getDescription()}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},update:function(e){var t=e.a,n=e.b,r=(e.oldParams,e.newParams);return ne.iQ.create("Update Mesh Streaming",function(){var e=(0,s.Z)(d().mark((function e(a){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.data.source===n.data.parentData.source&&t.data.entryId===n.data.parentData.entryId){e.next=2;break}return e.abrupt("return",D.td.UpdateResult.Recreate);case 2:return n.data.parentData=t.data,e.next=5,n.data.update(r);case 5:return n.description=n.data.getDescription(),e.abrupt("return",D.td.UpdateResult.Updated);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}),Fe=Se({name:"mesh-visual-group-from-streaming",display:{name:"Mesh Visuals for a Segment"},from:Ne,to:E.G.Group,params:{label:Oe.Text("",{isHidden:!0}),description:Oe.Text(""),segmentId:Oe.Numeric(-1,{},{isHidden:!0}),opacity:Oe.Numeric(-1,{min:0,max:1,step:.01})}})({apply:function(e,t){var n=e.a,r=e.params;return Le(r,n),new E.G.Group({opacity:r.opacity},r)},update:function(e,t){var n=e.a,r=e.b,a=e.oldParams,i=e.newParams;return re.VS(a,i)?D.td.UpdateResult.Unchanged:(i.label||(i.label=a.label),-1===i.segmentId&&(i.segmentId=a.segmentId),Le(i,n),r.label=i.label,r.description=i.description,r.data.opacity=i.opacity,D.td.UpdateResult.Updated)},canAutoUpdate:function(e,t){var n=e.oldParams;return e.newParams.description===n.description}});function Le(e,t){if(-1===e.opacity){var n=t.data.backgroundSegments[e.segmentId];void 0!==n&&(e.opacity=n?.2:1)}}var Ge=Se({name:"mesh-visual-from-streaming",display:{name:"Mesh Visual from Streaming"},from:Ne,to:E.G.Shape.Representation3D,params:{ref:Oe.Text("",{isHidden:!0,isEssential:!0}),tag:Oe.Text("",{isHidden:!0,isEssential:!0}),opacity:Oe.Numeric(-1,{min:0,max:1,step:.01},{isHidden:!0})}})({apply:function(e,t){var n=e.a,r=e.params,a=e.spine;return ne.iQ.create("Mesh Visual",function(){var e=(0,s.Z)(d().mark((function e(t){var i,o,s,u,c,l,m;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=n.data.visuals[r.tag]){e.next=3;break}throw new Error("VisualInfo with tag '".concat(r.tag,"' is missing."));case 3:return c=null===(i=a.getAncestorOfType(E.G.Group))||void 0===i?void 0:i.data,r.opacity=u.visible?null!==(o=null===c||void 0===c?void 0:c.opacity)&&void 0!==o?o:1:0,(l=Oe.getDefaultValues(H.K.Params)).flatShaded=!0,l.alpha=r.opacity,m=te.a((function(e,t){return ye.getShape(t,u.color)}),H.K.Utils),e.next=11,m.createOrUpdate(l,null!==(s=u.data)&&void 0!==s?s:ye.empty()).runInContext(t);case 11:return e.abrupt("return",new E.G.Shape.Representation3D({repr:m,sourceData:u.data},{label:"Mesh Visual",description:r.tag}));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},update:function(e,t){var n=e.a,r=e.b,a=e.oldParams,i=e.newParams,o=e.spine;return ne.iQ.create("Update Mesh Visual",function(){var e=(0,s.Z)(d().mark((function e(t){var s,u,c,l,m,p,h;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.ref||(i.ref=a.ref),i.tag||(i.tag=a.tag),l=n.data.visuals[i.tag]){e.next=5;break}throw new Error("VisualInfo with tag '".concat(i.tag,"' is missing."));case 5:if(m=r.data.sourceData,(null===(s=l.data)||void 0===s?void 0:s.detail)===(null===m||void 0===m?void 0:m.detail)){e.next=8;break}return e.abrupt("return",D.td.UpdateResult.Recreate);case 8:if(p=null===(u=o.getAncestorOfType(E.G.Group))||void 0===u?void 0:u.data,(h=l.visible?null!==(c=null===p||void 0===p?void 0:p.opacity)&&void 0!==c?c:1:0)===a.opacity){e.next=17;break}return i.opacity=h,e.next=14,r.data.repr.createOrUpdate({alpha:i.opacity}).runInContext(t);case 14:return e.abrupt("return",D.td.UpdateResult.Updated);case 17:return e.abrupt("return",D.td.UpdateResult.Unchanged);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},canAutoUpdate:function(e,t){return!0},dispose:function(e,t){var n=e.b;e.params;null===n||void 0===n||n.data.repr.destroy()}}),We=D.lQ.build({display:{name:"Mesh Streaming"},from:E.G.Root,params:Ie.Params,isApplicable:function(e,t,n){return!0}})((function(e,t){return ne.iQ.create("Mesh Streaming",function(){var n=(0,s.Z)(d().mark((function n(r){var a,i,o,s,u,c,l,m,p,h,v,f,g,x,y,b,S,w;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return u=e.params,n.next=3,t.build().to(e.ref).apply(Ue,u).commit();case 3:return c=n.sent,n.next=6,t.build().to(c).apply(Ve,{}).commit();case 6:l=n.sent,m=null!==(a=null===(i=l.data)||void 0===i?void 0:i.visuals)&&void 0!==a?a:{},p=null!==(o=null===(s=l.data)||void 0===s?void 0:s.backgroundSegments)&&void 0!==o?o:{},h={},n.t0=d().keys(m);case 11:if((n.t1=n.t0()).done){n.next=23;break}if(v=n.t1.value,f=m[v].segmentId,h[f]){n.next=21;break}return g=m[v].segmentName,p[f]&&(g+=" (background)"),n.next=19,t.build().to(l).apply(Fe,{label:"Segment ".concat(f),description:g,segmentId:f},{state:{isCollapsed:!0}}).commit();case 19:x=n.sent,h[f]=x.ref;case 21:n.next=11;break;case 23:for(b in y=t.build(),m)S="".concat(l.ref,"-").concat(b),w=m[b].segmentId,y.to(h[w]).apply(Ge,{ref:S,tag:b},{ref:S});return n.next=27,t.state.data.updateTree(y).runInContext(r);case 27:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}));function He(e,t,n,r,a,i,o,s){return Ke.apply(this,arguments)}function Ke(){return(Ke=(0,s.Z)(d().mark((function e(t,n,r,a,i,o,s,u){var c,l,m,p,h,v;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=u?t.build().to(u):t.build().toRoot(),e.next=3,c.apply(L.Download,{url:n,isBinary:!0,label:"Downloaded Data ".concat(r)},{tags:["What","are","tags","good","for?"],state:{isCollapsed:i}}).commit();case 3:return l=e.sent,o&&console.log("rawDataNode:",l),e.next=7,t.build().to(l).apply(M.L.Data.ParseCif).commit();case 7:return m=e.sent,o&&console.log("cifNode:",l),e.next=11,t.build().to(m).apply(_e,{label:void 0,segmentId:r,segmentName:"Segment ".concat(r),detail:a},{ref:"ref-parsed-data-node-".concat(r)}).commit();case 11:return p=e.sent,o&&console.log("parsedDataNode:",p),o&&console.log("parsedDataNode.data:",p.data),o&&console.log("parsedDataNode mesh list stats:\n",ye.stats(p.data)),e.next=17,t.build().to(p).apply(Me,{color:s},{ref:"ref-shape-node-".concat(r)}).commit();case 17:return h=e.sent,o&&console.log("shapeNode:",h),o&&console.log("shapeNode.data:",h.data),e.next=22,t.build().to(h).apply($.ShapeRepresentation3D,{},{ref:"ref-repr-nod+e".concat(r)}).commit();case 22:return v=e.sent,o&&console.log("reprNode:",v),o&&console.log("reprNode.data:",v.data),e.abrupt("return",l);case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ze(e){return qe.apply(this,arguments)}function qe(){return qe=(0,s.Z)(d().mark((function e(t){var n,r,a,i,o,s=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:"empiar",r=s.length>2&&void 0!==s[2]?s[2]:"empiar-10070",a=s.length>3?s[3]:void 0,i=s.length>4?s[4]:void 0,o=I.e.getDefaultValues(Ie.Params),a&&(o.serverUrl=a),o.source=n,o.entryId=r,e.next=10,t.runTask(t.state.data.applyAction(We,o,null===i||void 0===i?void 0:i.ref),{useOverlay:!1});case 10:case"end":return e.stop()}}),e)}))),qe.apply(this,arguments)}function Xe(e){return Qe.apply(this,arguments)}function Qe(){return(Qe=(0,s.Z)(d().mark((function e(t){var n,r,a,i,o,s,u;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("emdb"!==(n=C(t)).source){e.next=19;break}return e.prev=2,e.next=5,fetch("https://www.ebi.ac.uk/emdb/api/entry/map/".concat(n.entryNumber));case 5:return i=e.sent,e.next=8,i.json();case 8:if(o=e.sent,!((s=null===o||void 0===o||null===(r=o.map)||void 0===r||null===(a=r.contour_list)||void 0===a?void 0:a.contour)&&s.length>0)){e.next=15;break}if(void 0!==(u=s.find((function(e){return e.primary}))||s[0]).level){e.next=14;break}throw new Error("EMDB API response missing contour level.");case 14:return e.abrupt("return",{kind:"absolute",value:u.level});case 15:e.next=19;break;case 17:e.prev=17,e.t0=e.catch(2);case 19:return e.abrupt("return",{kind:"relative",value:1});case 20:case"end":return e.stop()}}),e,null,[[2,17]])})))).apply(this,arguments)}function Ye(e){return $e.apply(this,arguments)}function $e(){return($e=(0,s.Z)(d().mark((function e(t){var n,r,a,i,o,s,u,c,l,m,p,h,v;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=C(t),r=[],"emdb"!==n.source){e.next=20;break}return t=t.toUpperCase(),a="https://www.ebi.ac.uk/pdbe/api/emdb/entry/fitted/".concat(t),e.prev=5,e.next=8,fetch(a);case 8:if(!(i=e.sent).ok){e.next=16;break}return e.next=12,i.json();case 12:s=e.sent,u=null!==(o=s[t])&&void 0!==o?o:[],c=(0,Z.Z)(u);try{for(c.s();!(l=c.n()).done;)h=l.value,v=null!==(m=null===h||void 0===h||null===(p=h.fitted_emdb_id_list)||void 0===p?void 0:p.pdb_id)&&void 0!==m?m:[],r.push.apply(r,(0,_.Z)(v))}catch(d){c.e(d)}finally{c.f()}case 16:e.next=20;break;case 18:e.prev=18,e.t0=e.catch(5);case 20:return e.abrupt("return",r);case 21:case"end":return e.stop()}}),e,null,[[5,18]])})))).apply(this,arguments)}var Je,et=function(){function e(t,n){var r,a=this;(0,u.Z)(this,e),this.segments=void 0,this.sets=void 0,this.segmentMap=void 0,this.inverseSegmentMap=void 0,this.grid=void 0,this.getSegmentBoundingBoxes=tt((function(){return e._getSegmentBoundingBoxes(a)}));var i=null===(r=t.categories.segmentation_data_3d.getField("values"))||void 0===r?void 0:r.toIntArray();this.segmentMap=e.makeSegmentMap(t),this.inverseSegmentMap=e.invertMultimap(this.segmentMap),this.segments=Array.from(this.inverseSegmentMap.keys()),this.sets=Array.from(this.segmentMap.keys()),this.grid=n,this.grid.cells.data=X.es.Data1(i)}return(0,c.Z)(e,[{key:"createSegment_old",value:function(e){for(var t=this.grid.cells.data.length,n=new Float32Array(t),a=0;a<t;a++){var i;n[a]=null!==(i=this.segmentMap.get(this.grid.cells.data[a]))&&void 0!==i&&i.has(e)?1:0}return{sourceData:{kind:"custom",name:"test",data:n},customProperties:new R.S,_propertyData:{},grid:(0,r.Z)((0,r.Z)({},this.grid),{},{stats:{min:0,max:1,mean:0,sigma:1},cells:(0,r.Z)((0,r.Z)({},this.grid.cells),{},{data:n})})}}},{key:"createSegment",value:function(e){var t=this.grid.cells,n=t.space,i=t.data,o=(0,a.Z)(n.dimensions,3),s=o[0],u=o[1],c=o[2],l=(0,_.Z)(n.axisOrderSlowToFast),d=n.get,m=Je.create(0,s,0,u,0,c),p=this.getSegmentBoundingBoxes()[e];p=Je.expand(p,2,1),p=Je.confine(p,m);var h=Je.origin(p),v=(0,a.Z)(h,3),f=v[0],g=v[1],x=v[2],y=Je.size(p),b=(0,a.Z)(y,3),S=b[0],w=b[1],k=b[2],Z=X.es.Space([S,w,k],l,Uint8Array),E=X.es.create(Z,Z.create()),M=E.data,A=Z.set,D=this.inverseSegmentMap.get(e);if(!D)throw new Error("This LatticeSegmentation does not contain segment ".concat(e));for(var I=0;I<k;I++)for(var j=0;j<w;j++)for(var T=0;T<S;T++){var P=d(i,f+T,g+j,x+I);A(M,T,j,I,D.has(P)?1:0)}var C,B=this.grid.transform;if("matrix"===B.kind)throw new Error('Not implemented for transform of kind "matrix"');if("spacegroup"!==B.kind)throw new Error("Unknown transform kind: ".concat(B));var N=Je.toFractional(p,m),O=X.AO.sub(X.AO.zero(),B.fractionalBox.max,B.fractionalBox.min);return X.AO.mul(N.min,N.min,O),X.AO.mul(N.max,N.max,O),X.AO.add(N.min,N.min,B.fractionalBox.min),X.AO.add(N.max,N.max,B.fractionalBox.min),C=(0,r.Z)((0,r.Z)({},B),{},{fractionalBox:N}),{sourceData:{kind:"custom",name:"test",data:E.data},customProperties:new R.S,_propertyData:{},grid:{stats:{min:0,max:1,mean:0,sigma:1},cells:E,transform:C}}}},{key:"getBoundingBox",value:function(e){var t=this.grid.cells,n=t.space,r=t.data,i=(0,a.Z)(n.dimensions,3),o=i[0],s=i[1],u=i[2],c=n.get,l=o,d=s,m=u,p=-1,h=-1,v=-1,f=this.inverseSegmentMap.get(e);if(!f)throw new Error("This LatticeSegmentation does not contain segment ".concat(e));for(var g=0;g<u;g++)for(var x=0;x<s;x++)for(var y=0;y<o;y++){var b=c(r,y,x,g);f.has(b)&&(y<l&&(l=y),x<d&&(d=x),g<m&&(m=g),y>p&&(p=y),x>h&&(h=x),g>v&&(v=g))}return-1===p?Je.create(0,1,0,1,0,1):Je.create(l,p+1,d,h+1,m,v+1)}},{key:"benchmark",value:function(t){var n=this;console.time("createSegment ".concat(t," ").concat(100,"x"));for(var r=0;r<100;r++)this.getSegmentBoundingBoxes=tt((function(){return e._getSegmentBoundingBoxes(n)})),this.createSegment(t);console.timeEnd("createSegment ".concat(t," ").concat(100,"x"))}},{key:"benchmarkAll",value:function(){var t=this,n=[];this.inverseSegmentMap.forEach((function(e,t){return n.push(t)})),console.time("createSegment ALL ".concat(100,"x"));for(var r=0;r<100;r++){this.getSegmentBoundingBoxes=tt((function(){return e._getSegmentBoundingBoxes(t)}));var a,i=(0,Z.Z)(n);try{for(i.s();!(a=i.n()).done;){var o=a.value;this.createSegment(o)}}catch(s){i.e(s)}finally{i.f()}}console.timeEnd("createSegment ALL ".concat(100,"x"))}}],[{key:"fromCifBlock",value:function(){var t=(0,s.Z)(d().mark((function t(n){var r,a,i;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=K.pe.schema.densityServer(n),t.next=3,(0,Q.N)(r).run();case 3:return a=t.sent,i=a.grid,t.abrupt("return",new e(n,i));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"_getSegmentBoundingBoxes",value:function(e){var t=e.grid.cells,n=t.space,r=t.data,i=(0,a.Z)(n.dimensions,3),o=i[0],s=i[1],u=i[2],c=n.get,l={};e.sets.forEach((function(e){return l[e]=Je.create(o,-1,s,-1,u,-1)}));for(var d=0;d<u;d++)for(var m=0;m<s;m++)for(var p=0;p<o;p++){var h=c(r,p,m,d);Je.addPoint_InclusiveEnd(l[h],p,m,d)}var v={};for(var f in e.segments.forEach((function(e){return v[e]=Je.create(o,-1,s,-1,u,-1)})),e.inverseSegmentMap.forEach((function(e,t){e.forEach((function(e){v[t]=Je.cover(v[t],l[e])}))})),v)-1===v[f][5]?v[f]=Je.create(0,1,0,1,0,1):v[f]=Je.expand(v[f],0,1);return v}},{key:"invertMultimap",value:function(e){var t=new Map;return e.forEach((function(e,n){e.forEach((function(e){var r;t.has(e)||t.set(e,new Set),null===(r=t.get(e))||void 0===r||r.add(n)}))})),t}},{key:"makeSegmentMap",value:function(e){for(var t,n,r=null===(t=e.categories.segmentation_data_table.getField("set_id"))||void 0===t?void 0:t.toIntArray(),a=null===(n=e.categories.segmentation_data_table.getField("segment_id"))||void 0===n?void 0:n.toIntArray(),i=new Map,o=0;o<a.length;o++)i.has(r[o])||i.set(r[o],new Set),i.get(r[o]).add(a[o]);return i}}]),e}();function tt(e){var t=void 0;return function(){return void 0===t&&(t=e()),t}}!function(e){function t(e){var t=(0,a.Z)(e,6),n=t[0],r=t[1],i=t[2],o=t[3],s=t[4];return[r-n,o-i,t[5]-s]}function n(e){return[e[0],e[2],e[4]]}e.create=function(e,t,n,r,a,i){return[e,t,n,r,a,i]},e.expand=function(e,t,n){var r=(0,a.Z)(e,6);return[r[0]-t,r[1]+n,r[2]-t,r[3]+n,r[4]-t,r[5]+n]},e.confine=function(e,t){var n=(0,a.Z)(e,6),r=n[0],i=n[1],o=n[2],s=n[3],u=n[4],c=n[5],l=(0,a.Z)(t,6),d=l[0],m=l[1],p=l[2],h=l[3],v=l[4],f=l[5];return[Math.max(r,d),Math.min(i,m),Math.max(o,p),Math.min(s,h),Math.max(u,v),Math.min(c,f)]},e.cover=function(e,t){var n=(0,a.Z)(e,6),r=n[0],i=n[1],o=n[2],s=n[3],u=n[4],c=n[5],l=(0,a.Z)(t,6),d=l[0],m=l[1],p=l[2],h=l[3],v=l[4],f=l[5];return[Math.min(r,d),Math.max(i,m),Math.min(o,p),Math.max(s,h),Math.min(u,v),Math.max(c,f)]},e.size=t,e.origin=n,e.log=function(e,n){var r=(0,a.Z)(n,6),i=r[0],o=r[1],s=r[2],u=r[3],c=r[4],l=r[5];console.log("Box ".concat(e,": [").concat(i,":").concat(o,", ").concat(s,":").concat(u,", ").concat(c,":").concat(l,"], size: ").concat(t(n)))},e.toFractional=function(e,r){var i=(0,a.Z)(e,6),o=i[0],s=i[1],u=i[2],c=i[3],l=i[4],d=i[5],m=n(r),p=(0,a.Z)(m,3),h=p[0],v=p[1],f=p[2],g=t(r),x=(0,a.Z)(g,3),y=x[0],b=x[1],S=x[2],w=X.AO.create((o-h)/y,(u-v)/b,(l-f)/S),k=X.AO.create((s-h)/y,(c-v)/b,(d-f)/S);return q.XZ.create(w,k)},e.addPoint_InclusiveEnd=function(e,t,n,r){t<e[0]&&(e[0]=t),t>e[1]&&(e[1]=t),n<e[2]&&(e[2]=n),n>e[3]&&(e[3]=n),r<e[4]&&(e[4]=r),r>e[5]&&(e[5]=r)},e.equal=function(e,t){return e.every((function(e,n){return e===t[n]}))}}(Je||(Je={}));var nt=n(2029),rt=!1,at=function(){function e(t,n,r){var a=this;(0,u.Z)(this,e),this.id=t,this.model=n,this.plugin=r,this.metadata=void 0,this.volume=void 0,this.segmentation=void 0,this.currentSegments=[],this.volumeRepr=void 0,this.entryRoot=void 0,this.groupNodeMgr=new P,this.segmentationNodeMgr=new P,this.pdbModelNodeMgr=new P,this.meshSegmentNodeMgr=new P,this.exampleEmdb={exampleType:"emdb",defaultEntryId:"emd-1832",action:function(){var e=(0,s.Z)(d().mark((function e(t){var n,r,i,o,s,u,c,l,m,p,h,v,f,g,x,y,b,S,w,k;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.initMetadata(t);case 2:return a.metadata=e.sent,e.next=5,Xe(null!==(n=a.metadata.grid.general.source_db_id)&&void 0!==n?n:t);case 5:return r=e.sent,i=C(t).source,o=0,s=a.plugin,e.next=11,a.plugin.build().toRoot().apply(nt.CreateGroup,{label:t,description:"Meshes"}).commit();case 11:if(a.entryRoot=e.sent,u=Math.pow(10,7),c=a.metadata.grid.volumes.volume_downsamplings.length>0,l=a.metadata.grid.segmentation_lattices.segmentation_lattice_ids.length>0,!c){e.next=30;break}return h=ct.volumeUrl(i,t,null,u),e.next=19,s.build().to(a.entryRoot).apply(L.Download,{url:h,isBinary:!0},{state:{isGhost:rt}}).commit();case 19:return v=e.sent,e.next=22,s.dataFormats.get("dscif").parse(s,v);case 22:return f=e.sent,g=null!==(m=null===(p=f.volumes)||void 0===p?void 0:p[0])&&void 0!==m?m:f.volume,x=g.cell.obj.data,a.volume=x,(y=s.build()).to(g).apply(M.L.Representation.VolumeRepresentation3D,(0,O.qm)(a.plugin,x,{type:"isosurface",typeParams:{alpha:.2,isoValue:N.f.adjustedIsoValue(x,r.value,r.kind)},color:"uniform",colorParams:{value:(0,V.Il)(1184274)}})),e.next=30,y.commit();case 30:if(!l){e.next=44;break}return b=ct.latticeUrl(i,t,o,null,u),e.next=34,s.build().to(a.entryRoot).apply(L.Download,{url:b,isBinary:!0},{state:{isGhost:rt}}).commit();case 34:return S=e.sent,e.next=37,s.build().to(S).apply(M.L.Data.ParseCif).commit();case 37:return w=e.sent,k=w.data.blocks.find((function(e){return"SEGMENTATION_DATA"===e.header})),e.next=41,et.fromCifBlock(k);case 41:return a.segmentation=e.sent,e.next=44,a.showSegments(a.metadata.annotation.segment_list);case 44:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},this.exampleBioimage={exampleType:"bioimage",defaultEntryId:"emd-99999",action:function(){var e=(0,s.Z)(d().mark((function e(t){var n,r,i,o,s,u,c;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.initMetadata(t);case 2:return a.metadata=e.sent,i=ct.volumeUrl("emdb",t,null,Math.pow(10,7)),e.next=6,a.plugin.build().toRoot().apply(nt.CreateGroup,{label:t,description:"Bioimage"}).commit();case 6:return a.entryRoot=e.sent,e.next=9,a.plugin.build().to(a.entryRoot).apply(L.Download,{url:i,isBinary:!0},{state:{isGhost:rt}}).commit();case 9:return o=e.sent,e.next=12,a.plugin.dataFormats.get("dscif").parse(a.plugin,o);case 12:return s=e.sent,u=null!==(n=null===(r=s.volumes)||void 0===r?void 0:r[0])&&void 0!==n?n:s.volume,c=u.cell.obj.data,a.volume=c,a.volumeRepr=a.plugin.build().to(u).apply(M.L.Representation.VolumeRepresentation3D,(0,O.qm)(a.plugin,c,{type:"isosurface",typeParams:{alpha:1,isoValue:N.f.IsoValue.relative(-.55),tryUseGpu:!1},color:"uniform",colorParams:{value:(0,V.Il)(2246809)}})),e.next=19,a.volumeRepr.commit();case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},this.exampleMeshes={exampleType:"meshes",defaultEntryId:"empiar-10070",action:function(){var e=(0,s.Z)(d().mark((function e(t){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.initMetadata(t);case 2:return a.metadata=e.sent,e.next=5,a.plugin.build().toRoot().apply(nt.CreateGroup,{label:t,description:"Meshes"}).commit();case 5:return a.entryRoot=e.sent,"empiar-10070"===t&&(n=[13,15],f.dropSegments(a.metadata,n)),e.next=9,a.showMeshSegments(a.metadata.annotation.segment_list,t);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},this.exampleMeshStreaming={exampleType:"meshStreaming",defaultEntryId:"empiar-10070",action:function(){var e=(0,s.Z)(d().mark((function e(t){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.initMetadata(t);case 2:return a.metadata=e.sent,e.next=5,a.plugin.build().toRoot().apply(nt.CreateGroup,{label:t,description:"Mesh Streaming"}).commit();case 5:return a.entryRoot=e.sent,n=C(t).source,e.next=9,ze(a.plugin,n,t,ct.volumeServerUrl,a.entryRoot);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},this.exampleAuto={exampleType:"auto",defaultEntryId:"emd-1832",action:function(){var e=(0,s.Z)(d().mark((function e(t){var n,r,i,o,s,u,c,l,m,p,h,v,f,g,x,y,b,S,w,k,_,Z;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.initMetadata(t);case 2:return a.metadata=e.sent,i=C(t).source,o=Xe(null!==(n=a.metadata.grid.general.source_db_id)&&void 0!==n?n:t),s=Ye(null!==(r=a.metadata.grid.general.source_db_id)&&void 0!==r?r:t),u=a.metadata.grid.volumes.volume_downsamplings.length>0,c=a.metadata.grid.segmentation_lattices.segmentation_lattice_ids.length>0,l=void 0!==a.metadata.grid.segmentation_meshes.mesh_component_numbers.segment_ids,m=null,p=Math.pow(10,7),e.next=13,a.plugin.build().toRoot().apply(nt.CreateGroup,{label:t,description:"Auto"}).commit();case 13:if(a.entryRoot=e.sent,!u){e.next=30;break}return f=ct.volumeUrl(i,t,m,p),e.next=18,a.plugin.build().to(a.entryRoot).apply(L.Download,{url:f,isBinary:!0,label:"Volume Data: ".concat(f)},{state:{isGhost:rt}}).commit();case 18:return g=e.sent,e.next=21,a.plugin.dataFormats.get("dscif").parse(a.plugin,g,{entryId:t});case 21:return x=e.sent,y=null!==(h=null===(v=x.volumes)||void 0===v?void 0:v[0])&&void 0!==h?h:x.volume,b=y.cell.obj.data,a.volume=b,e.next=27,o;case 27:return S=e.sent,e.next=30,a.plugin.build().to(y).apply(M.L.Representation.VolumeRepresentation3D,(0,O.qm)(a.plugin,b,{type:"isosurface",typeParams:{alpha:.2,isoValue:N.f.adjustedIsoValue(b,S.value,S.kind),tryUseGpu:!1},color:"uniform",colorParams:{value:(0,V.Il)(1184274)}})).commit();case 30:if(!c){e.next=48;break}return w=ct.latticeUrl(i,t,0,m,p),e.next=34,a.plugin.build().to(a.entryRoot).apply(L.Download,{url:w,isBinary:!0,label:"Segmentation Data: ".concat(w)},{state:{isGhost:rt}}).commit();case 34:return k=e.sent,e.next=37,a.plugin.build().to(k).apply(M.L.Data.ParseCif).commit();case 37:if(_=e.sent,!(Z=_.data.blocks.find((function(e){return"SEGMENTATION_DATA"===e.header})))){e.next=47;break}return e.next=42,et.fromCifBlock(Z);case 42:return a.segmentation=e.sent,e.next=45,a.showSegments(a.metadata.annotation.segment_list);case 45:e.next=48;break;case 47:console.log("WARNING: Block SEGMENTATION_DATA is missing. Not showing segmentations.");case 48:if(!l){e.next=51;break}return e.next=51,ze(a.plugin,i,t,ct.volumeServerUrl,a.entryRoot);case 51:return e.t0=a.model.pdbs,e.next=54,s;case 54:e.t1=e.sent,e.t2=a.id,e.t0.nextWithinSession.call(e.t0,e.t1,e.t2);case 57:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},this.examples={emdb:this.exampleEmdb,bioimage:this.exampleBioimage,meshes:this.exampleMeshes,meshStreaming:this.exampleMeshStreaming,auto:this.exampleAuto}}return(0,c.Z)(e,[{key:"initMetadata",value:function(){var e=(0,s.Z)(d().mark((function e(t){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=6;break}return n=C(t).source,e.next=4,ct.getMetadata(n,t);case 4:this.metadata=e.sent,this.model.annotation.nextWithinSession(this.metadata.annotation,this.id);case 6:return e.abrupt("return",this.metadata);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadPdb",value:function(){var e=(0,s.Z)(d().mark((function e(t,n){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://www.ebi.ac.uk/pdbe/entry-files/download/".concat(t,".bcif"),e.next=3,this.loadPdbStructureFromBcif(r,{dataLabel:"PDB Data: ".concat(r)},n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadPdbStructureFromBcif",value:function(){var e=(0,s.Z)(d().mark((function e(t,n,r){var a,i,o,s,u,c;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=U.x.getUrlAsset(this.plugin.managers.asset,t),e.next=3,this.plugin.runTask(this.plugin.managers.asset.resolve(a,"binary"));case 3:return i=e.sent,o=i.data,s=r?this.plugin.build().to(r):this.plugin.build().toRoot(),e.next=8,s.apply(L.RawData,{data:o,label:null===n||void 0===n?void 0:n.dataLabel}).commit();case 8:return u=e.sent,e.next=11,this.plugin.builders.structure.parseTrajectory(u,"mmcif");case 11:return c=e.sent,e.next=14,this.plugin.builders.structure.hierarchy.applyPreset(c,"default");case 14:return e.abrupt("return",u);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"showPdb",value:function(){var e=(0,s.Z)(d().mark((function e(t){var n,r,a=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.model.status.nextWithinSession("loading",this.id),e.prev=1,this.pdbModelNodeMgr.hideAllNodes(),!t){e.next=12;break}return n=this.entryRoot?this.plugin.build().to(this.entryRoot):this.plugin.build().toRoot(),e.next=7,this.groupNodeMgr.showNode("Fitted Models",(function(){return n.apply(nt.CreateGroup,{label:"Fitted Models"}).selector}));case 7:return r=e.sent,e.next=10,n.commit();case 10:return e.next=12,this.pdbModelNodeMgr.showNode(t,(0,s.Z)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.loadPdb(t,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 12:this.model.currentPdb.nextWithinSession(t,this.id),this.model.status.nextWithinSession("ready",this.id),e.next=20;break;case 16:throw e.prev=16,e.t0=e.catch(1),this.model.status.nextWithinSession("error",this.id),e.t0;case 20:case"end":return e.stop()}}),e,this,[[1,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"showSegments",value:function(){var e=(0,s.Z)(d().mark((function e(t){var n,r,a,i,o,s=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 1===t.length?this.model.currentSegment.nextWithinSession(t[0],this.id):this.model.currentSegment.nextWithinSession(void 0,this.id),n=this.entryRoot?this.plugin.build().to(this.entryRoot):this.plugin.build().toRoot(),e.next=4,this.groupNodeMgr.showNode("Segmentation",(function(){return n.apply(nt.CreateGroup,{label:"Segmentation"}).selector}));case 4:r=e.sent,this.segmentationNodeMgr.hideAllNodes(),a=(0,Z.Z)(t);try{for(o=function(){var e=i.value;s.segmentationNodeMgr.showNode(e.id.toString(),(function(){var t,a,i=null===(t=s.segmentation)||void 0===t?void 0:t.createSegment(e.id);N.f.PickingGranularity.set(i,"volume");var o=n.to(r).apply(T,{volume:i,label:"Segment ".concat(e.id),description:null===(a=e.biological_annotation)||void 0===a?void 0:a.name},{state:{isCollapsed:!0}});return o.apply(M.L.Representation.VolumeRepresentation3D,(0,O.qm)(s.plugin,i,{type:"isosurface",typeParams:{alpha:1,isoValue:N.f.IsoValue.absolute(.95),tryUseGpu:!1},color:"uniform",colorParams:{value:V.Il.fromNormalizedArray(e.colour,0)}})),o.selector}))},a.s();!(i=a.n()).done;)o()}catch(u){a.e(u)}finally{a.f()}return e.next=10,n.commit();case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"showMeshSegments",value:function(){var e=(0,s.Z)(d().mark((function e(t,n){var r,a,i,o=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:1===t.length?this.model.currentSegment.nextWithinSession(t[0],this.id):this.model.currentSegment.nextWithinSession(void 0,this.id),this.meshSegmentNodeMgr.hideAllNodes(),r=(0,Z.Z)(t),e.prev=3,i=d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.value,e.next=3,o.meshSegmentNodeMgr.showNode(t.id.toString(),(0,s.Z)(d().mark((function e(){var r,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.getSufficientDetail(o.metadata,t.id,5),a=t.colour.length>=3?V.Il.fromNormalizedArray(t.colour,0):F.t.gray,e.next=4,He(o.plugin,ct.meshUrl_Bcif(C(n).source,n,t.id,r),t.id,r,!0,!1,a,o.entryRoot);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})),r.s();case 6:if((a=r.n()).done){e.next=10;break}return e.delegateYield(i(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),r.e(e.t1);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createFakeSegment",value:function(e,t){for(var n=e.grid.stats,a=n.mean,i=n.sigma,o=e.grid.cells,s=o.data,u=o.space,c=new Float32Array(s.length),l=0;l<u.dimensions[0];l++)if(Math.floor(10*l/u.dimensions[0])===t)for(var d=0;d<u.dimensions[1];d++)for(var m=0;m<u.dimensions[2];m++){var p=u.dataOffset(l,d,m);(s[p]-a)/i>2.5&&(c[p]=1)}return{sourceData:{kind:"custom",name:"test",data:c},customProperties:new R.S,_propertyData:{},grid:(0,r.Z)((0,r.Z)({},e.grid),{},{stats:{min:0,max:1,mean:0,sigma:1},cells:(0,r.Z)((0,r.Z)({},e.grid.cells),{},{data:c})})}}},{key:"createSegment99999Plus",value:function(e,t){for(var n=e.grid.stats,a=n.mean,i=n.sigma,o=e.grid.cells,s=o.data,u=o.space,c=new Float32Array(s.length),l=0;l<u.dimensions[0];l++)for(var d=0;d<u.dimensions[1];d++)for(var m=0;m<u.dimensions[2];m++){var p=u.dataOffset(l,d,m);(s[p]-a)/i>t&&(c[p]=1)}return{sourceData:{kind:"custom",name:"test",data:c},customProperties:new R.S,_propertyData:{},grid:(0,r.Z)((0,r.Z)({},e.grid),{},{stats:{min:0,max:1,mean:0,sigma:1},cells:(0,r.Z)((0,r.Z)({},e.grid.cells),{},{data:c})})}}},{key:"createSegment99999Minus",value:function(e,t){for(var n=e.grid.stats,a=n.mean,i=n.sigma,o=e.grid.cells,s=o.data,u=o.space,c=new Float32Array(s.length),l=0;l<u.dimensions[0];l++)for(var d=0;d<u.dimensions[1];d++)for(var m=0;m<u.dimensions[2];m++){var p=u.dataOffset(l,d,m),h=(s[p]-a)/i;h>t&&h<-.35&&(c[p]=1)}return{sourceData:{kind:"custom",name:"test",data:c},customProperties:new R.S,_propertyData:{},grid:(0,r.Z)((0,r.Z)({},e.grid),{},{stats:{min:0,max:1,mean:0,sigma:1},cells:(0,r.Z)((0,r.Z)({},e.grid.cells),{},{data:c})})}}},{key:"showSegment",value:function(){var e=(0,s.Z)(d().mark((function e(t,n){var r,a,i,o,s=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:1,a=this.plugin.build(),i=a.toRoot().apply(T,{volume:t}),o=i.apply(M.L.Representation.VolumeRepresentation3D,(0,O.qm)(this.plugin,t,{type:"isosurface",typeParams:{alpha:r,isoValue:N.f.IsoValue.absolute(.95),transparentBackfaces:"off",doubleSided:!1,flatShaded:!0,tryUseGpu:!1},color:"uniform",colorParams:{value:V.Il.fromNormalizedArray(n,0)}})),this.currentSegments.push(o.selector),e.next=7,a.commit();case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setIsoValue",value:function(){var e=(0,s.Z)(d().mark((function e(t,n){var r,a,i,o,s,u,c;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.volumeRepr){e.next=2;break}return e.abrupt("return");case 2:return r=this.plugin,e.next=5,r.build().to(this.volumeRepr).update((0,O.qm)(this.plugin,this.volume,{type:"isosurface",typeParams:{alpha:n?0:1,isoValue:N.f.IsoValue.relative(t)},color:"uniform",colorParams:{value:n?(0,V.Il)(7829367):(0,V.Il)(2246809)}})).commit();case 5:a=this.plugin.build(),i=(0,Z.Z)(this.currentSegments);try{for(i.s();!(o=i.n()).done;)s=o.value,a.delete(s)}catch(l){i.e(l)}finally{i.f()}return this.currentSegments=[],e.next=11,a.commit();case 11:if(!n){e.next=18;break}return u=this.createSegment99999Plus(this.volume,-.35),c=this.createSegment99999Minus(this.volume,t),e.next=16,this.showSegment(u,[.3,.7,.6],.5);case 16:return e.next=18,this.showSegment(c,[.1,.3,.7]);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),it=n(1752),ot=n(1120),st=function(){function e(){(0,u.Z)(this,e),this.currentSession=re.hb.createv4(),this.subjects=[]}return(0,c.Z)(e,[{key:"startNewSession",value:function(){return this.currentSession=re.hb.createv4(),this.currentSession}},{key:"behaviorSubject",value:function(e){var t=new ut(e,this);return this.subjects.push(t),t}},{key:"resetAllSubjects",value:function(){var e,t=(0,Z.Z)(this.subjects);try{for(t.s();!(e=t.n()).done;){e.value.reset()}}catch(n){t.e(n)}finally{t.f()}}}]),e}(),ut=function(e){(0,ie.Z)(n,e);var t=(0,oe.Z)(n);function n(e,r){var a;return(0,u.Z)(this,n),(a=t.call(this,e)).sessionManager=void 0,a.default=void 0,a.sessionManager=r,a.default=e,a}return(0,c.Z)(n,[{key:"next",value:function(e){console.error("Calling BehaviorSubjectWithinSession.next is not recommended. Call BehaviorSubjectWithinSession.nextWithinSession instead."),(0,it.Z)((0,ot.Z)(n.prototype),"next",this).call(this,e)}},{key:"nextWithinSession",value:function(e,t){t===this.sessionManager.currentSession&&(0,it.Z)((0,ot.Z)(n.prototype),"next",this).call(this,e)}},{key:"reset",value:function(){(0,it.Z)((0,ot.Z)(n.prototype),"next",this).call(this,this.default)}}]),n}(v.X),ct=new k,lt="auto",dt=function(){function e(){(0,u.Z)(this,e),this.entryList=new v.X({}),this.subjectMgr=new st,this.exampleType=this.subjectMgr.behaviorSubject(void 0),this.entryId=this.subjectMgr.behaviorSubject(""),this.status=this.subjectMgr.behaviorSubject("ready"),this.error=this.subjectMgr.behaviorSubject(void 0),this.annotation=this.subjectMgr.behaviorSubject(void 0),this.currentSegment=this.subjectMgr.behaviorSubject(void 0),this.pdbs=this.subjectMgr.behaviorSubject([]),this.currentPdb=this.subjectMgr.behaviorSubject(void 0),this.session=void 0,this.plugin=void 0}return(0,c.Z)(e,[{key:"init",value:function(){var e=(0,s.Z)(d().mark((function e(t){var n,a,i=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,p.q)(),e.next=3,(0,m.a)(t,(0,r.Z)((0,r.Z)({},n),{},{layout:{initial:{isExpanded:!1,showControls:!0,controlsDisplay:"landscape"}},components:{controls:{right:"none",top:"none",bottom:"none"}},canvas3d:{camera:{helper:{axes:{name:"off",params:{}}}}},config:[[h.OW.Viewport.ShowExpand,!0],[h.OW.Viewport.ShowControls,!0],[h.OW.Viewport.ShowSelectionMode,!1],[h.OW.Viewport.ShowAnimation,!1]]}));case 3:this.plugin=e.sent,ct.getEntryList(1e3).then((function(e){return i.entryList.next(e)})),a=g.get(),setTimeout((function(){var e;return i.loadExample(null!==(e=a.example)&&void 0!==e?e:lt,a.entry)}),50);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadExample",value:function(){var e=(0,s.Z)(d().mark((function e(t,n){var r,a,i,o;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.subjectMgr.startNewSession(),this.subjectMgr.resetAllSubjects(),this.session=new at(i,this,this.plugin),o=null!==(r=this.session.examples[t])&&void 0!==r?r:this.session.examples.auto,null!==(a=n)&&void 0!==a||(n=o.defaultEntryId),console.time("Load example ".concat(o.exampleType," ").concat(n)),this.exampleType.nextWithinSession(o.exampleType,i),this.entryId.nextWithinSession(n,i),this.status.nextWithinSession("loading",i),g.set({example:o.exampleType,entry:n}),e.prev=10,e.next=13,this.plugin.clear();case 13:return this.plugin.behaviors.layout.leftPanelTabName.next("data"),e.next=16,o.action(n);case 16:this.status.nextWithinSession("ready",i),e.next=24;break;case 19:throw e.prev=19,e.t0=e.catch(10),this.error.nextWithinSession(e.t0,i),this.status.nextWithinSession("error",i),e.t0;case 24:return e.prev=24,console.timeEnd("Load example ".concat(o.exampleType," ").concat(n)),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[10,19,24,27]])})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),mt=n(4708),pt=n(2199),ht=n(4518),vt=n(1123),ft=n(4721),gt=n(4925),xt=n(9221),yt=n(5523),bt=n(9174),St=n(8362),wt=n(4387),kt=n(1462),_t=n(9637),Zt=n(7482),Et=n(184);function Mt(){return(0,Et.jsx)("div",{className:"App",children:(0,Et.jsx)(mt.ZP,{children:(0,Et.jsx)(At,{})})})}function At(){var e=(0,i.useRef)();e.current||(e.current=new dt);var t=e.current,n=(0,o.A)(t.exampleType);return(0,Et.jsxs)(Et.Fragment,{children:[(0,Et.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:360,position:"absolute",right:0,top:0,bottom:0,padding:"8px 8px 8px 0",overflow:"hidden",overflowY:"auto"},children:[(0,Et.jsx)("div",{style:{marginBottom:8},children:(0,Et.jsxs)(pt.Z,{fullWidth:!0,children:[(0,Et.jsx)(ht.Z,{variant:"emdb"===n?"contained":"outlined",onClick:function(){return t.loadExample("emdb")},children:"EMDB SFF"}),(0,Et.jsx)(ht.Z,{variant:"bioimage"===n?"contained":"outlined",onClick:function(){return t.loadExample("bioimage")},children:"BioImage Archive"}),(0,Et.jsx)(ht.Z,{variant:"meshes"===n?"contained":"outlined",onClick:function(){return t.loadExample("meshes")},children:"Meshes"}),(0,Et.jsx)(ht.Z,{variant:"auto"===n?"contained":"outlined",onClick:function(){return t.loadExample("auto")},children:"Auto"})]})}),"emdb"===n&&(0,Et.jsx)(Dt,{model:t}),"bioimage"===n&&(0,Et.jsx)(It,{model:t}),"meshes"===n&&(0,Et.jsx)(jt,{model:t}),"meshStreaming"===n&&(0,Et.jsx)(Tt,{model:t}),"auto"===n&&(0,Et.jsx)(Pt,{model:t})]}),"bioimage"===n&&(0,Et.jsx)("img",{src:"/emd-99999.png",alt:"",style:{width:"33%",position:"absolute",right:8,bottom:8,border:"1px solid #777"}}),(0,Et.jsx)(Nt,{model:t})]})}function Dt(e){var t=e.model,n=(0,o.A)(t.annotation),r=(0,o.A)(t.currentSegment);return(0,Et.jsxs)(Et.Fragment,{children:[(0,Et.jsx)(Ct,{model:t,action:function(e){return t.loadExample("emdb",e)}}),(0,Et.jsx)(Bt,{model:t}),(0,Et.jsx)(Rt,{model:t}),n&&(0,Et.jsxs)(Et.Fragment,{children:[(0,Et.jsx)(vt.Z,{variant:"h6",style:{marginTop:8},children:"Segmentation"}),(0,Et.jsx)(ht.Z,{variant:r?"outlined":"contained",size:"small",onClick:function(){var e,r;return null===(e=t.session)||void 0===e?void 0:e.showSegments(null!==(r=null===n||void 0===n?void 0:n.segment_list)&&void 0!==r?r:[])},children:"Show All"}),null===n||void 0===n?void 0:n.segment_list.map((function(e){var n;return(0,Et.jsx)(ht.Z,{size:"small",style:{marginTop:4},variant:r===e?"contained":"outlined",onClick:function(){var n;return null===(n=t.session)||void 0===n?void 0:n.showSegments([e])},children:null!==(n=e.biological_annotation.name)&&void 0!==n?n:"(Unnamed segment ".concat(e.id,")")},e.id)})),(0,Et.jsx)(ft.Z,{style:{margin:"8px 0"}}),r&&(0,Et.jsx)(vt.Z,{variant:"h6",children:r.biological_annotation.name}),r&&(0,Et.jsx)("div",{children:r.biological_annotation.external_references.map((function(e){return(0,Et.jsx)("div",{children:(0,Et.jsxs)(vt.Z,{variant:"caption",style:{marginBottom:8},children:[(0,Et.jsxs)("b",{children:[e.resource,":",e.accession]}),(0,Et.jsx)("br",{}),e.description]})},e.id)}))})]})]})}function It(e){var t=e.model,n=(0,i.useState)(-.55),r=(0,a.Z)(n,2),o=r[0],s=r[1],u=(0,i.useState)(!1),c=(0,a.Z)(u,2),l=c[0],d=c[1];return(0,Et.jsxs)(Et.Fragment,{children:[(0,Et.jsx)(Bt,{model:t,style:{marginBlock:8,height:6,borderRadius:3}}),(0,Et.jsx)(vt.Z,{variant:"h6",children:"Benchmark Airyscan data matching FIB SEM data deposited on EMPIAR"}),(0,Et.jsx)("a",{href:"https://www.ebi.ac.uk/biostudies/studies/S-BSST707",target:"_blank",rel:"noreferrer",children:"Archive Link"}),(0,Et.jsx)(ft.Z,{style:{margin:"8px 0"}}),(0,Et.jsx)(gt.Z,{style:{marginTop:6,marginBottom:-6},children:"Isovalue"}),(0,Et.jsx)(xt.ZP,{min:-1,max:-.35,step:.025,value:o,valueLabelDisplay:"auto",marks:!0,onChange:function(e,t){return s(t)},onChangeCommitted:function(e,n){var r;return null===(r=t.session)||void 0===r?void 0:r.setIsoValue(n,l)}}),(0,Et.jsx)(yt.Z,{control:(0,Et.jsx)(bt.Z,{value:l,onChange:function(e){var n;d(!!e.target.checked),null===(n=t.session)||void 0===n||n.setIsoValue(o,!l)}}),label:"Auto-segmentation"}),(0,Et.jsxs)(vt.Z,{variant:"body1",style:{textAlign:"center",marginTop:16},children:[(0,Et.jsx)("b",{children:"~500kB of volumetric data"})," to create this rendering.",(0,Et.jsx)("br",{}),"Obtained by converting 600MB of downsampled TIFFs from EMPIAR to MAP (using imod), original dataset size 1.7TB."]})]})}function jt(e){var t=e.model,n=(0,o.A)(t.entryId),r=(0,o.A)(t.annotation),a=(0,o.A)(t.currentSegment);return(0,Et.jsxs)(Et.Fragment,{children:[(0,Et.jsx)(Ct,{model:t,action:function(e){return t.loadExample("meshes",e)}}),(0,Et.jsx)(Bt,{model:t}),(0,Et.jsx)(Rt,{model:t}),r&&(0,Et.jsxs)(Et.Fragment,{children:[(0,Et.jsx)(ht.Z,{variant:a?"outlined":"contained",size:"small",onClick:function(){var e,a;return null===(e=t.session)||void 0===e?void 0:e.showMeshSegments(null!==(a=null===r||void 0===r?void 0:r.segment_list)&&void 0!==a?a:[],n)},children:"Show All"}),null===r||void 0===r?void 0:r.segment_list.map((function(e){return(0,Et.jsxs)(ht.Z,{size:"small",style:{marginTop:4},variant:a===e?"contained":"outlined",onClick:function(){var r;return null===(r=t.session)||void 0===r?void 0:r.showMeshSegments([e],n)},children:[e.id,". ",e.biological_annotation.name]},e.id)})),(0,Et.jsx)(vt.Z,{variant:"caption",marginTop:2,children:'If you are viewing "empiar-10070", two "background" segments are artificially removed.'})]})]})}function Tt(e){var t=e.model;return(0,Et.jsxs)(Et.Fragment,{children:[(0,Et.jsx)(Ct,{model:t,action:function(e){return t.loadExample("meshStreaming",e)}}),(0,Et.jsx)(Bt,{model:t}),(0,Et.jsx)(Rt,{model:t})]})}function Pt(e){var t=e.model,n=(0,o.A)(t.pdbs),r=(0,o.A)(t.currentPdb);return(0,Et.jsxs)(Et.Fragment,{children:[(0,Et.jsx)(vt.Z,{variant:"caption",children:"This example shows volume isosurface, lattice segmentation, mesh streaming, and/or fitted PDB models, depending on what data are available."}),(0,Et.jsx)(vt.Z,{variant:"caption",children:"Try: EMDB 1832 (lattice), EMDB 1181 (lattice+PDB), EMPIAR 10070 (mesh)."}),(0,Et.jsx)(ft.Z,{style:{marginBlock:16}}),(0,Et.jsx)(Ct,{model:t,action:function(e){return t.loadExample("auto",e)}}),(0,Et.jsx)(Bt,{model:t}),(0,Et.jsx)(Rt,{model:t}),n.length>0&&(0,Et.jsxs)("div",{children:[(0,Et.jsx)(vt.Z,{variant:"body2",style:{marginTop:12,marginBottom:4},children:"Fitted models in PDB:"}),n.map((function(e){return(0,Et.jsx)(ht.Z,{size:"small",variant:e===r?"contained":"outlined",style:{margin:2,textTransform:"lowercase"},title:e===r?"Remove ".concat(e):"Load ".concat(e),onClick:function(){var n;return null===(n=t.session)||void 0===n?void 0:n.showPdb(e===r?void 0:e)},children:e},e)}))]})]})}function Ct(e){var t,n,s=e.model,u=e.action,c=(0,i.useState)(""),l=(0,a.Z)(c,2),d=l[0],m=l[1],p=(0,i.useState)(""),h=(0,a.Z)(p,2),v=h[0],f=h[1],g=null!==(t=null===(n=(0,o.A)(s.entryList)[d])||void 0===n?void 0:n.map((function(e){return C(e).entryNumber})).sort())&&void 0!==t?t:[],x=(0,o.A)(s.entryId),y=(0,o.A)(s.status);return(0,i.useEffect)((function(){var e,t,n=C(x);m(null!==(e=n.source)&&void 0!==e?e:""),f(null!==(t=n.entryNumber)&&void 0!==t?t:"")}),[x]),(0,Et.jsx)(Et.Fragment,{children:(0,Et.jsxs)("form",{onSubmit:function(e){e.preventDefault(),u(B(d,v))},children:[(0,Et.jsx)(gt.Z,{children:"Source"}),(0,Et.jsxs)(St.Z,{id:"input-source",label:"Source",value:d,onChange:function(e){return m(e.target.value)},size:"small",fullWidth:!0,style:{marginBottom:8},children:[(0,Et.jsx)(wt.Z,{value:"empiar",children:"EMPIAR"}),(0,Et.jsx)(wt.Z,{value:"emdb",children:"EMDB"}),(0,Et.jsx)(wt.Z,{value:"idr",children:"IDR"})]}),(0,Et.jsx)(gt.Z,{children:"Entry ID"}),(0,Et.jsx)(kt.Z,{size:"small",fullWidth:!0,style:{marginBottom:8},disablePortal:!0,freeSolo:!0,selectOnFocus:!0,id:"combo-entry-id",options:g,inputValue:v,value:v,onInputChange:function(e,t){f(null!==t&&void 0!==t?t:"")},onChange:function(e,t){u(B(d,null!==t&&void 0!==t?t:""))},renderInput:function(e){return(0,Et.jsx)(_t.Z,(0,r.Z)({},e))}}),(0,Et.jsx)(ht.Z,{type:"submit",variant:"contained",fullWidth:!0,disabled:"loading"===y,children:"Load"})]})})}function Bt(e){var t=e.model,n=e.style,a=(0,o.A)(t.status);return(0,Et.jsx)("div",{children:(0,Et.jsx)(Zt.Z,{variant:"loading"===a?"indeterminate":"determinate",value:100,color:"error"===a?"error":"primary",style:(0,r.Z)({marginBlock:16},n)})})}function Rt(e){var t,n=e.model,r=(0,o.A)(n.entryId),a=(0,o.A)(n.annotation),i=(0,o.A)(n.error);return i?(0,Et.jsxs)(Et.Fragment,{children:[(0,Et.jsx)(vt.Z,{variant:"caption",children:r}),(0,Et.jsx)(vt.Z,{variant:"h6",color:"error",children:"Error"}),(0,Et.jsx)(vt.Z,{variant:"body1",color:"error",children:i.toString()})]}):a?(0,Et.jsxs)(Et.Fragment,{children:[(0,Et.jsx)(vt.Z,{variant:"caption",children:r}),(0,Et.jsx)(vt.Z,{variant:"h6",children:null!==(t=null===a||void 0===a?void 0:a.name)&&void 0!==t?t:"Untitled"}),(0,Et.jsx)(vt.Z,{variant:"caption",children:null===a||void 0===a?void 0:a.details})]}):(0,Et.jsx)(vt.Z,{variant:"caption",children:r})}function Nt(e){var t=e.model,n=(0,i.useRef)(null);return(0,i.useEffect)((function(){n.current&&t.init(n.current)}),[t]),(0,Et.jsx)("div",{ref:n,style:{position:"absolute",top:0,bottom:0,left:0,right:376}})}}}]);
//# sourceMappingURL=610.0dcf4aff.chunk.js.map